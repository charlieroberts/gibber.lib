!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.Gibber=e()}}(function(){var define,module,exports;return function e(t,i,n){function r(a,s){if(!i[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);throw new Error("Cannot find module '"+a+"'")}var u=i[a]={exports:{}};t[a][0].call(u.exports,function(e){var i=t[a][1][e];return r(i?i:e)},u,u.exports,e,t,i,n)}return i[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)r(n[a]);return r}({1:[function(_dereq_,module,exports){(function(global){!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.Gibberish=t()}(this,function(){function createInput(){console.log("connecting audio input..."),navigator.getUserMedia({audio:!0},function(e){console.log("audio input connected"),Gibberish.mediaStreamSource=Gibberish.context.createMediaStreamSource(e),Gibberish.mediaStreamSource.connect(Gibberish.node),_hasInput=!0},function(e){console.log(e),console.log("error opening audio input")})}var Gibberish={memo:{},codeblock:[],analysisCodeblock:[],analysisUgens:[],dirtied:[],id:0,isDirty:!1,out:null,debug:!1,callback:"",audioFiles:{},sequencers:[],callbackArgs:["input"],callbackObjects:[],analysisCallbackArgs:[],analysisCallbackObjects:[],onBlock:null,createCallback:function(){this.memo={},this.codeblock.length=0,this.callbackArgs.length=0,this.callbackObjects.length=0,this.analysisCallbackArgs.length=0,this.dirtied.length=0,this.codestring="	",this.args=["input"],this.out.codegen();var e=this.codeblock.slice(0);if(this.analysisUgens.length>0){this.analysisCodeblock.length=0;for(var t=0;t<this.analysisUgens.length;t++)this.analysisCallbackArgs.push(this.analysisUgens[t].analysisSymbol)}if(this.args=this.args.concat(this.callbackArgs),this.args=this.args.concat(this.analysisCallbackArgs),this.codestring+=e.join("	"),this.codestring+="\n	",this.analysisUgens.length>0){this.analysisCodeblock.length=0;for(var t=0;t<this.analysisUgens.length;t++)this.codeblock.length=0,this.analysisUgens[t].analysisCodegen();this.codestring+=this.analysisCodeblock.join("\n	"),this.codestring+="\n	"}return this.codestring+="return "+this.out.variable+";\n",this.callbackString=this.codestring,this.debug&&console.log(this.callbackString),[this.args,this.codestring]},audioProcess:function(e){var t,i,n=e.outputBuffer.getChannelData(0),r=e.outputBuffer.getChannelData(1),o=e.inputBuffer.getChannelData(0),a=Gibberish,s=a.callback,l=a.sequencers,u=(Gibberish.out.callback,a.callbackObjects.slice(0));null!==a.onBlock&&a.onBlock(a.context),u.unshift(0);for(var c=0,h=e.outputBuffer.length;h>c;c++){for(var f=0;f<l.length;f++)l[f].tick();if(a.isDirty){t=a.createCallback();try{s=a.callback=new Function(t[0],t[1])}catch(e){console.error("ERROR WITH CALLBACK : \n\n",t)}a.isDirty=!1,u=a.callbackObjects.slice(0),u.unshift(0)}u[0]=o[c],i=s.apply(null,u),n[c]=i[0],r[c]=i[1]}},audioProcessFirefox:function(e){var t,i=Gibberish,n=i.callback,r=i.sequencers,o=i.callbackObjects.slice(0);o.unshift(0);for(var a=0,s=e.length;s>a;a+=2){for(var l=0;l<r.length;l++)r[l].tick();if(i.isDirty){t=i.createCallback();try{n=i.callback=new Function(t[0],t[1])}catch(u){console.error("ERROR WITH CALLBACK : \n\n",n)}i.isDirty=!1,o=i.callbackObjects.slice(0),o.unshift(0)}var c=n.apply(null,o);e[a]=c[0],e[a+1]=c[1]}},clear:function(){this.out.inputs.length=0,this.analysisUgens.length=0,this.sequencers.length=0,this.callbackArgs.length=2,this.callbackObjects.length=1,Gibberish.dirty(this.out)},dirty:function(e){if("undefined"!=typeof e){for(var t=!1,i=0;i<this.dirtied.length;i++)this.dirtied[i].variable===e.variable&&(t=!0);t||(this.isDirty=!0,this.dirtied.push(e))}else this.isDirty=!0},generateSymbol:function(e){return e+"_"+this.id++},AudioDataDestination:function(e,t){var i=new Audio;i.mozSetup(2,e);var n,r=0,o=e/2,a=null;setInterval(function(){var e;if(a){if(e=i.mozWriteAudio(a.subarray(n)),r+=e,n+=e,n<a.length)return;a=null}var s=i.mozCurrentSampleOffset(),l=s+o-r;if(l>0){var u=new Float32Array(l);t(u),e=i.mozWriteAudio(u),s=i.mozCurrentSampleOffset(),e<u.length&&(a=u,n=e),r+=e}},100)},init:function(){var e,t,i="undefined"==typeof arguments[0]?1024:arguments[0];return"undefined"!=typeof webkitAudioContext?e=webkitAudioContext:"undefined"!=typeof AudioContext&&(e=AudioContext),t=function(){if("undefined"!=typeof e){if(document&&document.documentElement&&"ontouchstart"in document.documentElement&&(window.removeEventListener("touchstart",t),"ontouchstart"in document.documentElement)){var i=Gibberish.context.createBufferSource();i.connect(Gibberish.context.destination),i.noteOn(0)}}else alert("Your browser does not support javascript audio synthesis. Please download a modern web browser that is not Internet Explorer.");Gibberish.onstart&&Gibberish.onstart()},Gibberish.context=new e,Gibberish.node=Gibberish.context.createScriptProcessor(i,2,2,Gibberish.context.sampleRate),Gibberish.node.onaudioprocess=Gibberish.audioProcess,Gibberish.node.connect(Gibberish.context.destination),Gibberish.out=new Gibberish.Bus2,Gibberish.out.codegen(),Gibberish.dirty(Gibberish.out),document&&document.documentElement&&"ontouchstart"in document.documentElement?window.addEventListener("touchstart",t):t(),this},makePanner:function(){for(var e=[],t=[],i=Math.sqrt(2)/2,n=0;1024>n;n++){var r=-1+n/1024*2;e[n]=i*(Math.cos(r)-Math.sin(r)),t[n]=i*(Math.cos(r)+Math.sin(r))}return function(i,n,r){var o,a,s,l,u,c,h="object"==typeof i,f=h?i[0]:i,p=h?i[1]:i;return o=1023*(n+1)/2,a=0|o,s=o-a,a=1023&a,l=1023===a?0:a+1,u=e[a],c=e[l],r[0]=(u+s*(c-u))*f,u=t[a],c=t[l],r[1]=(u+s*(c-u))*p,r}},defineUgenProperty:function(e,t,i){var n=i.properties[e]={value:t,binops:[],parent:i,name:e};Object.defineProperty(i,e,{configurable:!0,get:function(){return n.value},set:function(e){n.value=e,Gibberish.dirty(i)}})},polyInit:function(e){e.mod=e.polyMod,e.removeMod=e.removePolyMod,e.voicesClear=function(){if(e.children.length>0){for(var t=0;t<e.children.length;t++)e.children[t].disconnect();e.children.length=0,e.voiceCount=0}};for(var t in e.polyProperties)!function(t){var i=e.polyProperties[t];Object.defineProperty(e,t,{configurable:!0,get:function(){return i},set:function(n){i=n;for(var r=0;r<e.children.length;r++)e.children[r][t]=i}})}(t);var i=e.maxVoices;Object.defineProperty(e,"maxVoices",{get:function(){return i},set:function(e){i=e,this.voicesClear(),this.initVoices()}})},interpolate:function(e,t){var i=0|t,n=i+1>e.length-1?0:i+1;return frac=t-i,e[i]+frac*(e[n]-e[i])},pushUnique:function(e,t){for(var i=e,n=!0,r=0;r<t.length;r++)if(i===t[r]){n=!1;break}n&&t.push(i)},"export":function(e,t){for(var i in Gibberish[e])t[i]=Gibberish[e][i]},ugen:function(){Gibberish.extend(this,{processProperties:function(){if("object"!=typeof arguments[0][0]||"undefined"!=typeof arguments[0][0].type||Array.isArray(arguments[0][0])||"op"===arguments[0][0].name){var e=0;for(var t in this.properties)"object"==typeof this.properties[t]&&"undefined"!=typeof this.properties[t].binops?"undefined"!=typeof arguments[0][e]&&(this.properties[t].value=arguments[0][e++]):"undefined"!=typeof arguments[0][e]&&(this.properties[t]=arguments[0][e++])}else{var i=arguments[0][0];for(var t in i)"undefined"!=typeof i[t]&&("object"==typeof this.properties[t]&&"undefined"!=typeof this.properties[t].binops?this.properties[t].value=i[t]:this[t]=i[t])}return this},valueOf:function(){return this.codegen(),this.variable},codegen:function(){var e="",t=null;if(Gibberish.memo[this.symbol])return Gibberish.memo[this.symbol];t=this.variable?this.variable:Gibberish.generateSymbol("v"),Gibberish.memo[this.symbol]=t,this.variable=t,e+="var "+t+" = "+this.symbol+"(";for(var i in this.properties){var n=this.properties[i],r="";if(Array.isArray(n.value)){0===n.value.length&&(r=0);for(var o=0;o<n.value.length;o++){var a=n.value[o];r+="object"==typeof a?null!==a?a.valueOf():"null":"function"==typeof n.value?n.value():n.value,r+=o<n.value.length-1?", ":""}}else"object"==typeof n.value?null!==n.value&&(r=n.value.codegen?n.value.valueOf():n.value):"undefined"!==n.name&&(r="function"==typeof n.value?n.value():n.value);if(0!=n.binops.length){for(var s=0;s<n.binops.length;s++)e+="(";for(var l=0;l<n.binops.length;l++){var u,c=n.binops[l];u="number"==typeof c.ugen?c.ugen:null!==c.ugen?c.ugen.valueOf():"null","="===c.binop?(e=e.replace(r,""),e+=u):"++"===c.binop?e+=" + Math.abs("+u+")":(0===l&&(e+=r),e+=" "+c.binop+" "+u+")")}}else e+=r;e+=", "}return" "===e.charAt(e.length-1)&&(e=e.slice(0,-2)),e+=");\n",this.codeblock=e,-1===Gibberish.codeblock.indexOf(this.codeblock)&&Gibberish.codeblock.push(this.codeblock),-1===Gibberish.callbackArgs.indexOf(this.symbol)&&"op"!==this.name&&Gibberish.callbackArgs.push(this.symbol),-1===Gibberish.callbackObjects.indexOf(this.callback)&&"op"!==this.name&&Gibberish.callbackObjects.push(this.callback),this.dirty=!1,t},init:function(){if(this.initalized||(this.symbol=Gibberish.generateSymbol(this.name),this.codeblock=null,this.variable=null),"undefined"==typeof this.properties&&(this.properties={}),!this.initialized){this.destinations=[];for(var e in this.properties)Gibberish.defineUgenProperty(e,this.properties[e],this)}if(arguments.length>0&&"object"==typeof arguments[0][0]&&"undefined"===arguments[0][0].type){var t=arguments[0][0];for(var e in t)this[e]=t[e]}return this.initialized=!0,this},mod:function(e,t,i){var n=this.properties[e],r={ugen:t,binop:i};n.binops.push(r),Gibberish.dirty(this)},removeMod:function(e,t){if("undefined"==typeof t)this.properties[e].binops.length=0;else if("number"==typeof t)this.properties[e].binops.splice(t,1);else if("object"==typeof t)for(var i=0,n=this.properties[e].binops.length;n>i;i++)this.properties[e].binops[i].ugen===t&&this.properties[e].binops.splice(i,1);Gibberish.dirty(this)},polyMod:function(e,t,i){for(var n=0;n<this.children.length;n++)this.children[n].mod(e,t,i);Gibberish.dirty(this)},removePolyMod:function(){var e=Array.prototype.slice.call(arguments,0);if("amp"!==arguments[0]&&"pan"!==arguments[0])for(var t=0;t<this.children.length;t++)this.children[t].removeMod.apply(this.children[t],e);else this.removeMod.apply(this,e);Gibberish.dirty(this)},smooth:function(e){var t=new Gibberish.OnePole;this.mod(e,t,"=")},connect:function(e,t){return"undefined"==typeof e&&(e=Gibberish.out),-1===this.destinations.indexOf(e)&&(e.addConnection(this,1,t),this.destinations.push(e)),this},send:function(e,t){return-1===this.destinations.indexOf(e)?(e.addConnection(this,t),this.destinations.push(e)):e.adjustSendAmount(this,t),this},disconnect:function(e,t){var i;if(e)i=this.destinations.indexOf(e),i>-1&&this.destinations.splice(i,1),e.removeConnection(this);else{for(var n=0;n<this.destinations.length;n++)this.destinations[n].removeConnection(this);this.destinations=[]}return Gibberish.dirty(this),this}})}};Array2=function(){this.length=0},Array2.prototype=[],Array2.prototype.remove=function(e,t){if(t="undefined"==typeof t?!0:t,"undefined"==typeof e){for(var i=0;i<this.length;i++)delete this[i];this.length=0}else if("number"==typeof e)this.splice(e,1);else if("string"==typeof e){for(var n=[],i=0;i<this.length;i++){var r=this[i];if(r.type===e||r.name===e){if(!t)return void this.splice(i,1);n.push(i)}}for(var i=0;i<n.length;i++)this.splice(n[i],1)}else if("object"==typeof e)for(var o=this.indexOf(e);o>-1;)this.splice(o,1),o=this.indexOf(e);this.parent&&Gibberish.dirty(this.parent)},Array2.prototype.get=function(e){if("number"==typeof e)return this[e];if("string"==typeof e)for(var t=0;t<this.length;t++){var i=this[t];if(i.name===e)return i}else if("object"==typeof e){var n=this.indexOf(e);if(n>-1)return this[n]}return null},Array2.prototype.replace=function(e,t){if(t.parent=this,t.input=e.input,"number"!=typeof e){var i=this.indexOf(e);i>-1&&this.splice(i,1,t)}else this.splice(e,1,t);this.parent&&Gibberish.dirty(this.parent)},Array2.prototype.insert=function(e,t){if(e.parent=this,this.input=this.parent,Array.isArray(e))for(var i=0;i<e.length;i++)this.splice(t+i,0,e[i]);else this.splice(t,0,e);this.parent&&Gibberish.dirty(this.parent)},Array2.prototype.add=function(){for(var e=0;e<arguments.length;e++)arguments[e].parent=this,arguments[e].input=this.parent,this.push(arguments[e]);this.parent&&(console.log("DIRTYING"),Gibberish.dirty(this.parent))};var rnd=Math.random;Gibberish.rndf=function(e,t,i,n){if(n="undefined"==typeof n?!0:n,"undefined"==typeof i&&"object"!=typeof e){1==arguments.length?(t=arguments[0],e=0):2==arguments.length?(e=arguments[0],t=arguments[1]):(e=0,t=1);var r=t-e,o=Math.random(),a=r*o;return e+a}var s=[],l=[];"undefined"==typeof i&&(i=t||e.length);for(var u=0;i>u;u++){var c;if("object"==typeof arguments[0])c=arguments[0][rndi(0,arguments[0].length-1)];else if(n)c=Gibberish.rndf(e,t);else{for(c=Gibberish.rndf(e,t);l.indexOf(c)>-1;)c=Gibberish.rndf(e,t);l.push(c)}s.push(c)}return s},Gibberish.Rndf=function(){{var e,t,i,n;Math.random}return 0===arguments.length?(e=0,t=1):1===arguments.length?(t=arguments[0],e=0):2===arguments.length?(e=arguments[0],t=arguments[1]):3===arguments.length?(e=arguments[0],t=arguments[1],i=arguments[2]):(e=arguments[0],t=arguments[1],i=arguments[2],n=arguments[3]),function(){var r,o,a;return o="function"==typeof e?e():e,a="function"==typeof t?t():t,r="undefined"==typeof i?Gibberish.rndf(o,a):Gibberish.rndf(o,a,i,n)}},Gibberish.rndi=function(e,t,i,n){var r;if(0===arguments.length?(e=0,t=1):1===arguments.length?(t=arguments[0],e=0):2===arguments.length?(e=arguments[0],t=arguments[1]):(e=arguments[0],t=arguments[1],i=arguments[2],n=arguments[3]),r=t-e,i>r&&(n=!0),"undefined"==typeof i)return r=t-e,Math.round(e+Math.random()*r);for(var o=[],a=[],s=0;i>s;s++){var l;if(n)l=Gibberish.rndi(e,t);else{for(l=Gibberish.rndi(e,t);a.indexOf(l)>-1;)l=Gibberish.rndi(e,t);a.push(l)}o.push(l)}return o},Gibberish.Rndi=function(){{var e,t,i,n,r;Math.random,Math.round}return 0===arguments.length?(e=0,t=1):1===arguments.length?(t=arguments[0],e=0):2===arguments.length?(e=arguments[0],t=arguments[1]):3===arguments.length?(e=arguments[0],t=arguments[1],i=arguments[2]):(e=arguments[0],t=arguments[1],i=arguments[2],n=arguments[3]),r=t-e,"number"==typeof i&&i>r&&(n=!0),function(){var r,o,a;return o="function"==typeof e?e():e,a="function"==typeof t?t():t,r="undefined"==typeof i?Gibberish.rndi(o,a):Gibberish.rndi(o,a,i,n)}},Gibberish.extend=function(e,t){for(var i in t){{i.split(".")}t[i]instanceof Array&&t[i].length<100?(e[i]=t[i].slice(0),"fx"===i&&(e[i].parent=t[i].parent)):"object"!=typeof t[i]||null===t[i]||t[i]instanceof Float32Array?e[i]=t[i]:(e[i]=e[i]||{},arguments.callee(e[i],t[i]))}return e},Function.prototype.clone=function(){return eval("["+this.toString()+"]")[0]},String.prototype.format=function(e,t,i){function n(){var n=this,r=arguments.length+1;for(e=0;r>e;i=arguments[e++])t=i,n=n.replace(RegExp("\\{"+(e-1)+"\\}","g"),t);return n}return n.native=String.prototype.format,n}(),Gibberish.future=function(e,t){var i=new Gibberish.Sequencer({values:[function(){},function(){e(),i.stop(),i.disconnect()}],durations:[t]}).start();return i.cancel=function(){i.stop(),i.disconnect()},i},Gibberish.Proxy=function(){var e=0;Gibberish.extend(this,{name:"proxy",type:"effect",properties:{},callback:function(){return e}}).init(),this.input=arguments[0],e=this.input.parent[this.input.name],delete this.input.parent[this.input.name],this.input.parent.properties[this.input.name].value=this,Object.defineProperty(this.input.parent,this.input.name,{get:function(){return e},set:function(t){e=t}}),Gibberish.dirty(this.input.parent)},Gibberish.Proxy.prototype=new Gibberish.ugen,Gibberish.Proxy2=function(){var e=arguments[0],t=arguments[1];Gibberish.extend(this,{name:"proxy2",type:"effect",properties:{},callback:function(){var i=e[t];return Array.isArray(i)?(i[0]+i[1]+i[2])/3:i}}).init(),this.getInput=function(){return e},this.setInput=function(t){e=t},this.getName=function(){return t},this.setName=function(e){t=e}},Gibberish.Proxy2.prototype=new Gibberish.ugen,Gibberish.Proxy3=function(){var e=arguments[0],t=arguments[1];Gibberish.extend(this,{name:"proxy3",type:"effect",properties:{},callback:function(){var i=e[t];return i||0}}),this.init(),this.codegen=function(){console.log(" CALLED "),this.variable||(this.variable=Gibberish.generateSymbol("v")),Gibberish.callbackArgs.push(this.symbol),Gibberish.callbackObjects.push(this.callback),this.codeblock="var "+this.variable+" = "+this.symbol+"("+e.properties[t].codegen()+");\n"}},Gibberish.Proxy3.prototype=new Gibberish.ugen,Gibberish.oscillator=function(){this.type="oscillator",this.oscillatorInit=function(){return this.fx=new Array2,this.fx.parent=this,this}},Gibberish.oscillator.prototype=new Gibberish.ugen,Gibberish._oscillator=new Gibberish.oscillator,Gibberish.Wavetable=function(){var e=0,t=null,i=Gibberish.context.sampleRate/1024;this.properties={frequency:440,amp:.25,sync:0},this.getTable=function(){return t},this.setTable=function(e){t=e,i=Gibberish.context.sampleRate/t.length},this.getTableFreq=function(){return i},this.setTableFreq=function(e){i=e},this.getPhase=function(){return e},this.setPhase=function(t){e=t},this.callback=function(n,r){var o,a,s,l,u;for(e+=n/i;e>=1024;)e-=1024;return o=0|e,a=e-o,o=1023&o,s=1023===o?0:o+1,l=t[o],u=t[s],(l+a*(u-l))*r}},Gibberish.Wavetable.prototype=Gibberish._oscillator,Gibberish.Table=function(e){this.__proto__=new Gibberish.Wavetable,this.name="table";var t=2*Math.PI;if("undefined"==typeof e){e=new Float32Array(1024);for(var i=1024;i--;)e[i]=Math.sin(i/1024*t)}this.setTable(e),this.init(),this.oscillatorInit()},Gibberish.asmSine=function(e,t,i){"use asm";function n(){for(var e=1024,t=1024;e=e-1|0;)t-=1,l[e>>2]=+a(+(t/1024)*6.2848);c=44100/1024}function r(e,t,i){e=+e,t=+t,i=+i;var n=0,r=0,o=0,a=0,h=0,f=0;return s=+(s+e/c),s>=1024&&(s=+(s-1024)),n=+u(s),a=s-n,r=~~n,o=(r|0)==1024?0:r+1|0,h=+l[r>>2],f=+l[o>>2],+((h+a*(f-h))*t)}function o(e){return e|=0,+l[e>>2]}var a=e.Math.sin,s=0,l=new e.Float32Array(i),u=e.Math.floor,c=0;return{init:n,gen:r,get:o}},Gibberish.asmSine2=function(){this.properties={frequency:440,amp:.5,sr:Gibberish.context.sampleRate},this.name="sine";var e=new ArrayBuffer(4096),t=Gibberish.asmSine(window,null,e);return t.init(),this.getTable=function(){return e},this.get=t.get,this.callback=t.gen,this.init(),this.oscillatorInit(),this.processProperties(arguments),this},Gibberish.asmSine2.prototype=Gibberish._oscillator,Gibberish.Sine=function(){this.__proto__=new Gibberish.Wavetable,this.name="sine";for(var e=2*Math.PI,t=new Float32Array(1024),i=1024;i--;)t[i]=Math.sin(i/1024*e);this.setTable(t),this.init(arguments),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.Sine2=function(){this.__proto__=new Gibberish.Sine,this.name="sine2";var e=this.__proto__.callback,t=Gibberish.makePanner(),i=[0,0];this.callback=function(n,r,o){var a=e(n,r);return i=t(a,o,i)},this.init(),this.oscillatorInit(),Gibberish.defineUgenProperty("pan",0,this),this.processProperties(arguments)},Gibberish.Square=function(){this.__proto__=new Gibberish.Wavetable,this.name="square";for(var e=(2*Math.PI,new Float32Array(1024)),t=1024;t--;)e[t]=t/1024>.5?1:-1;this.setTable(e),this.init(arguments),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.Saw=function(){this.__proto__=new Gibberish.Wavetable,this.name="saw";for(var e=new Float32Array(1024),t=1024;t--;)e[t]=4*((t/1024/2+.25)%.5-.25);this.setTable(e),this.init(arguments),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.Saw2=function(){this.__proto__=new Gibberish.Saw,this.name="saw2";var e=this.__proto__.callback,t=Gibberish.makePanner(),i=[0,0];this.callback=function(n,r,o){var a=e(n,r);return i=t(a,o,i)},this.init(),Gibberish.defineUgenProperty("pan",0,this)},Gibberish.Triangle=function(){this.__proto__=new Gibberish.Wavetable,this.name="triangle";for(var e=new Float32Array(1024),t=Math.abs,i=1024;i--;)e[i]=1-4*t((i/1024+.25)%1-.5);this.setTable(e),this.init(arguments),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.Triangle2=function(){this.__proto__=new Gibberish.Triangle,this.name="triangle2";var e=this.__proto__.callback,t=Gibberish.makePanner(),i=[0,0];this.callback=function(n,r,o){var a=e(n,r);return t(a,o,i)},this.init(),this.oscillatorInit(),Gibberish.defineUgenProperty("pan",0,this),this.processProperties(arguments)},Gibberish.Saw3=function(){var e=0,t=0,i=2.5,n=-1.5,r=0,o=Math.sin,a=11;pi_2=2*Math.PI,flip=0,signHistory=0,ignore=!1,sr=Gibberish.context.sampleRate,Gibberish.extend(this,{name:"saw",properties:{frequency:440,amp:.15,sync:0,sr:Gibberish.context.sampleRate},callback:function(s,l){var u=s/sr,c=.5-u,h=a*c*c*c*c,f=.376-.752*u,p=1-2*u,d=0;return t+=u,t-=t>1?2:0,e=.5*(e+o(pi_2*(t+e*h))),d=i*e+n*r,r=e,d+=f,d*=p,d*l}}),Object.defineProperty(this,"scale",{get:function(){return a},set:function(e){a=e}}),this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.Saw3.prototype=Gibberish._oscillator,Gibberish.PWM=function(){var e=0,t=0,i=0,n=0,r=0,o=2.5,a=-1.5,s=Math.sin,l=11;pi_2=2*Math.PI,test=0,sr=Gibberish.context.sampleRate,Gibberish.extend(this,{name:"pwm",properties:{frequency:440,amp:.15,pulsewidth:.05,sr:Gibberish.context.sampleRate},callback:function(u,c,h){var f=u/sr,p=.5-f,d=l*p*p*p*p,m=1-2*f,g=0;return r+=f,r-=r>1?2:0,e=.5*(e+s(pi_2*(r+e*d))),t=.5*(t+s(pi_2*(r+t*d+h))),g=t-e,g=o*g+a*(i-n),i=e,n=t,g*m*c}}),Object.defineProperty(this,"scale",{get:function(){return l},set:function(e){l=e}}),this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.PWM.prototype=Gibberish._oscillator,Gibberish.Noise=function(){var e=Math.random;Gibberish.extend(this,{name:"noise",properties:{amp:1},callback:function(t){return(2*e()-1)*t}}),this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.Noise.prototype=Gibberish._oscillator,Gibberish.KarplusStrong=function(){var e=[0],t=0,i=Math.random,n=Gibberish.makePanner(),r=Gibberish.context.sampleRate,o=[0,0];Gibberish.extend(this,{name:"karplus_strong",frequency:0,properties:{blend:1,damping:0,amp:1,channels:2,pan:0,velocity:1},note:function(t,n){if("undefined"!=typeof t){var o=Math.floor(r/t);e.length=0;for(var a=0;o>a;a++)e[a]=2*i()-1;n&&(this.velocity=n),this.frequency=t}},callback:function(r,a,s,l,u,c){var h=e.shift(),f=i()>r?-1:1;a=a>0?a:0;var p=f*(h+t)*(.5-a/100);return t=p,e.push(p),p*=s*c,1===l?p:n(p,u,o)}}).init().oscillatorInit().processProperties(arguments)},Gibberish.KarplusStrong.prototype=Gibberish._oscillator,Gibberish.PolyKarplusStrong=function(){this.__proto__=new Gibberish.Bus2,Gibberish.extend(this,{name:"poly_karplus_strong",maxVoices:5,voiceCount:0,_frequency:0,polyProperties:{blend:1,damping:0,velocity:1},note:function(e,t){var i=this.children[this.voiceCount++];this.voiceCount>=this.maxVoices&&(this.voiceCount=0),i.note(e,t),this._frequency=e},initVoices:function(){for(var e=0;e<this.maxVoices;e++){var t={blend:this.blend,damping:this.damping,channels:2,amp:1},i=new Gibberish.KarplusStrong(t).connect(this);this.children.push(i)}}}),this.amp=1/this.maxVoices,this.children=[],"object"==typeof arguments[0]&&(this.maxVoices=arguments[0].maxVoices?arguments[0].maxVoices:this.maxVoices),Gibberish.polyInit(this),this.initVoices(),this.processProperties(arguments),this.initialized=!1,Gibberish._synth.oscillatorInit.call(this),Gibberish.dirty(this)},Gibberish.bus=function(){this.type="bus",this.inputCodegen=function(){var e,t=this.value.valueOf();return e=t+", "+this.amp,this.codeblock=e,e},this.addConnection=function(){var e=arguments[2],t={value:arguments[0],amp:arguments[1],codegen:this.inputCodegen,valueOf:function(){return this.codegen()}};"undefined"!=typeof e?this.inputs.splice(e,0,t):this.inputs.push(t),Gibberish.dirty(this)},this.removeConnection=function(e){for(var t=0;t<this.inputs.length;t++)if(this.inputs[t].value===e){this.inputs.splice(t,1),Gibberish.dirty(this);break}},this.adjustSendAmount=function(e,t){for(var i=0;i<this.inputs.length;i++)if(this.inputs[i].value===e){this.inputs[i].amp=t,Gibberish.dirty(this);break}},this.callback=function(){var e=arguments[arguments.length-2],t=arguments[arguments.length-1];output[0]=output[1]=0;for(var i=0;i<arguments.length-2;i+=2){var n="object"==typeof arguments[i],r=arguments[i+1];output[0]+=n?arguments[i][0]*r:arguments[i]*r,output[1]+=n?arguments[i][1]*r:arguments[i]*r}return output[0]*=e,output[1]*=e,panner(output,t,output)}},Gibberish.bus.prototype=new Gibberish.ugen,Gibberish._bus=new Gibberish.bus,Gibberish.Bus=function(){return Gibberish.extend(this,{name:"bus",properties:{inputs:[],amp:1},callback:function(){for(var e=0,t=arguments.length-1,i=arguments[t],n=0;t>n;n++)e+=arguments[n];return e*=i}}),this.init(),this.processProperties(arguments),this},Gibberish.Bus.prototype=Gibberish._bus,Gibberish.Bus2=function(){this.name="bus2",this.type="bus",this.properties={inputs:[],amp:1,pan:0};var e=[0,0],t=Gibberish.makePanner();this.callback=function(){var i=arguments,n=i.length,r=i[n-2],o=i[n-1];e[0]=e[1]=0;for(var a=0,s=n-2;s>a;a+=2){var l="object"==typeof i[a],u=i[a+1];e[0]+=l?i[a][0]*u||0:i[a]*u||0,e[1]+=l?i[a][1]*u||0:i[a]*u||0}return e[0]*=r,e[1]*=r,t(e,o,e)},this.show=function(){console.log(e,args)},this.getOutput=function(){return e},this.getArgs=function(){return args},this.init(arguments),this.processProperties(arguments)},Gibberish.Bus2.prototype=Gibberish._bus,Gibberish.envelope=function(){this.type="envelope"},Gibberish.envelope.prototype=new Gibberish.ugen,Gibberish._envelope=new Gibberish.envelope,Gibberish.ExponentialDecay=function(){var e=Math.pow,t=0,i=0;Gibberish.extend(this,{name:"ExponentialDecay",properties:{decay:.5,length:11050},callback:function(n,r){return t=e(n,i),i+=1/r,t},trigger:function(){i="number"==typeof arguments[0]?arguments[0]:0}}).init()},Gibberish.ExponentialDecay.prototype=Gibberish._envelope,Gibberish.Line=function(e,t,i,n){var r,o={name:"line",properties:{start:e||0,end:isNaN(t)?1:t,time:i||Gibberish.context.sampleRate,loops:n||!1},retrigger:function(e,t){a=0,this.start=r,this.end=e,this.time=t,s=(e-r)/t},getPhase:function(){return a},getIncr:function(){return s},getOut:function(){return r}},a=0,s=(t-e)/i;return this.callback=function(e,t,i,n){var o=(t-e)/i;return r=i>a?e+a++*o:t,a=r>=t&&n?0:a,r},this.setPhase=function(e){a=e},Gibberish.extend(this,o),this.init(),this},Gibberish.Line.prototype=Gibberish._envelope,Gibberish.Ease=function(e,t,i,n,r){var o=Math.sqrt,a=0,s=0;e=e||0,t=t||1,i=i||Gibberish.context.sampleRate,r=r||!1,n="undefined"==typeof n?1:n;var l={name:"ease",properties:{},retrigger:function(e,t){s=0,this.start=a,this.end=e,this.time=t},getPhase:function(){return s},getOut:function(){return a}};return this.callback=function(){var l=s++/i,u=n?1-o(1-l*l):o(1-(1-l)*(1-l));return a=i>s?e+u*(t-e):t,s=a>=t&&r?0:s,a},this.setPhase=function(e){s=e},this.setEase=function(e){n=e},Gibberish.extend(this,l),this.init(),this},Gibberish.Ease.prototype=Gibberish._envelope,Gibberish.Curve=function(e,t,i,n,r,o,a){var s=Math.sqrt,l=0,u=0;e=e||0,t=t||1,i=i||Gibberish.context.sampleRate,n=n||.94,r=r||.26,a=a||!1,o="undefined"==typeof o?1:o;var c={name:"curve",properties:{},retrigger:function(e,t){u=0,this.start=l,this.end=e,this.time=t,incr=(e-l)/t},getPhase:function(){return u},getOut:function(){return l}};return this.callback=function(){var c=u++/i,h=1-2*n,f=(s(n*n+h*c)-n)/h,p=(1-2*r)*f*f+2*r*f;return l=i>u?e+p*(t-e):t,o||(l=1-l),u=l>=t&&a?0:u,l},this.setPhase=function(e){u=e},Gibberish.extend(this,c),this.init(),this},Gibberish.Curve.prototype=Gibberish._envelope,Gibberish.Lines=function(e,t,i){var n,r=e[0],o=0,a=1,s=0,l=0,u=0,c=!1;"undefined"==typeof e&&(e=[0,1]),"undefined"==typeof t&&(t=[44100]),l=e[a],u=t[0],n=(l-e[0])/u,i=i||!1;var h={name:"lines",properties:{},retrigger:function(){o=0,r=e[0],u=t[0],l=e[1],a=1,s=0,n=(l-r)/u,c=!1},getPhase:function(){return o},getOut:function(){return r}};return h.run=h.retrigger,this.callback=function(){if(o>=u&&!c)if(a<e.length-1){var h=t[++s%t.length];u=o+h,l=e[++a%e.length],n=(l-r)/h}else i?(o=0,r=e[0],u=t[0],l=e[1],a=1,s=0,n=(l-r)/u):(c=!0,r=e[e.length-1]);else c||(r+=n,o++);return r},this.setPhase=function(e){o=e},Gibberish.extend(this,h),this.init(),this},Gibberish.Lines.prototype=Gibberish._envelope,Gibberish.AD=function(e,t){var i=0,n=0;Gibberish.extend(this,{name:"AD",properties:{attack:e||1e4,decay:t||1e4},run:function(){return n=0,i=0,this},callback:function(e,t){if(e=0>e?22050:e,t=0>t?22050:t,0===n){var r=1/e;i+=r,i>=1&&n++}else if(1===n){var r=1/t;i-=r,0>=i&&(i=0,n++)}return i},getState:function(){return n}}).init().processProperties(arguments)},Gibberish.AD.prototype=Gibberish._envelope,Gibberish.ADSR=function(e,t,i,n,r,o,a){var s={name:"adsr",type:"envelope",requireReleaseTrigger:"undefined"!=typeof a?a:!1,properties:{attack:isNaN(e)?1e4:e,decay:isNaN(t)?1e4:t,sustain:isNaN(i)?22050:i,release:isNaN(n)?1e4:n,attackLevel:r||1,sustainLevel:o||.5,releaseTrigger:0},run:function(){this.setPhase(0),this.setState(0)},stop:function(){this.releaseTrigger=1}};Gibberish.extend(this,s);var l=0,u=0,c=0,h=this;return this.callback=function(e,t,i,n,r,o,a){var s=0;return c=1===c?1:a,0===u?(s=l/e*r,++l/e>=1&&(u++,l=t)):1===u?(s=l/t*(r-o)+o,--l<=0&&(null!==i?(u+=1,l=i):(u+=2,l=n))):2===u?(s=o,h.requireReleaseTrigger&&c?(u++,l=n,h.releaseTrigger=0,c=0):l--<=0&&!h.requireReleaseTrigger&&(u++,l=n)):3===u&&(l--,s=l/n*o,0>=l&&u++),s},this.call=function(){return this.callback(this.attack,this.decay,this.sustain,this.release,this.attackLevel,this.sustainLevel,this.releaseTrigger)},this.getPhase=function(){return l},this.setPhase=function(e){l=e},this.setState=function(e){u=e,l=0},this.getState=function(){return u},this.init(),this},Gibberish.ADSR.prototype=Gibberish._envelope,Gibberish.ADR=function(e,t,i,n,r){var o={name:"adr",type:"envelope",properties:{attack:isNaN(e)?11025:e,decay:isNaN(t)?11025:t,release:isNaN(i)?22050:i,attackLevel:n||1,releaseLevel:r||.2},run:function(){this.setPhase(0),this.setState(0)}};Gibberish.extend(this,o);var a=0,s=0;return this.callback=function(e,t,i,n,r){var o=0;return 0===s?(o=a/e*n,++a/e===1&&(s++,a=t)):1===s?(o=a/t*(n-r)+r,--a<=0&&(s+=1,a=i)):2===s&&(a--,o=a/i*r,0>=a&&s++),o},this.setPhase=function(e){a=e},this.setState=function(e){s=e,a=0},this.getState=function(){return s},this.init(),this},Gibberish.ADR.prototype=Gibberish._envelope,Gibberish.analysis=function(){this.type="analysis",this.codegen=function(){if(Gibberish.memo[this.symbol])return Gibberish.memo[this.symbol];var e=this.variable?this.variable:Gibberish.generateSymbol("v");return Gibberish.memo[this.symbol]=e,this.variable=e,Gibberish.callbackArgs.push(this.symbol),Gibberish.callbackObjects.push(this.callback),this.codeblock="var "+this.variable+" = "+this.symbol+"();\n",-1===Gibberish.codeblock.indexOf(this.codeblock)&&Gibberish.codeblock.push(this.codeblock),this.variable},this.analysisCodegen=function(){var e=0;this.input.codegen?(e=this.input.codegen(),e.indexOf("op")>-1&&console.log("ANALYSIS BUG")):e=this.input.value?"undefined"!=typeof this.input.value.codegen?this.input.value.codegen():this.input.value:"null";var t=this.analysisSymbol+"("+e+",";for(var i in this.properties)"input"!==i&&(t+=this[i]+",");return t=t.slice(0,-1),t+=");",this.analysisCodeblock=t,-1===Gibberish.analysisCodeblock.indexOf(this.analysisCodeblock)&&Gibberish.analysisCodeblock.push(this.analysisCodeblock),-1===Gibberish.callbackObjects.indexOf(this.analysisCallback)&&Gibberish.callbackObjects.push(this.analysisCallback),t},this.remove=function(){Gibberish.analysisUgens.splice(Gibberish.analysisUgens.indexOf(this),1)},this.analysisInit=function(){this.analysisSymbol=Gibberish.generateSymbol(this.name),Gibberish.analysisUgens.push(this),Gibberish.dirty()}},Gibberish.analysis.prototype=new Gibberish.ugen,Gibberish._analysis=new Gibberish.analysis,Gibberish.Follow=function(){this.name="follow",this.properties={input:0,bufferSize:4410,mult:1,useAbsoluteValue:!0},this.storage=[];
var e=Math.abs,t=[0],i=0,n=0,r=0;this.analysisCallback=function(o,a,s,l){"object"==typeof o&&(o=o[0]+o[1]),i+=l?e(o):o,i-=t[n],t[n]=l?e(o):o,n=(n+1)%a,t[n]=t[n]?t[n]:0,r=i/a*s},this.callback=this.getValue=function(){return r},this.init(),this.analysisInit(),this.processProperties(arguments);var o=(this.__lookupSetter__("bufferSize"),this.bufferSize);Object.defineProperty(this,"bufferSize",{get:function(){return o},set:function(e){o=e,i=0,t=[0],n=0}}),this.getStorage=function(){return this.storage}},Gibberish.Follow.prototype=Gibberish._analysis,Gibberish.SingleSampleDelay=function(){this.name="single_sample_delay",this.properties={input:arguments[0]||0,amp:arguments[1]||1};var e=0;this.analysisCallback=function(t){e=t},this.callback=function(){return e},this.getValue=function(){return e},this.init(),this.analysisInit(),this.processProperties(arguments)},Gibberish.SingleSampleDelay.prototype=Gibberish._analysis,Gibberish.Record=function(e,t,i){var n=new Float32Array(t),r=0,o=!1,a=this;Gibberish.extend(this,{name:"record",oncomplete:i,properties:{input:0,size:t||0},analysisCallback:function(e,t){o&&(n[r++]="object"==typeof e?e[0]+e[1]:e,r>=t&&(o=!1,a.remove()))},record:function(){return r=0,o=!0,this},getBuffer:function(){return n},getPhase:function(){return r},remove:function(){"undefined"!=typeof this.oncomplete&&this.oncomplete();for(var e=0;e<Gibberish.analysisUgens.length;e++){var t=Gibberish.analysisUgens[e];if(t===this)return Gibberish.callbackArgs.indexOf(this.analysisSymbol)>-1&&Gibberish.callbackArgs.splice(Gibberish.callbackArgs.indexOf(this.analysisSymbol),1),Gibberish.callbackObjects.indexOf(this.analysisCallback)>-1&&Gibberish.callbackObjects.splice(Gibberish.callbackObjects.indexOf(this.analysisCallback),1),void Gibberish.analysisUgens.splice(e,1)}}}),this.properties.input=e,this.init(),this.analysisInit(),Gibberish.dirty()},Gibberish.Record.prototype=Gibberish._analysis,Gibberish.effect=function(){this.type="effect"},Gibberish.effect.prototype=new Gibberish.ugen,Gibberish._effect=new Gibberish.effect,Gibberish.Distortion=function(){var e=Math.abs,t=Math.log,i=Math.LN2;Gibberish.extend(this,{name:"distortion",properties:{input:0,amount:50},callback:function(n,r){var o;return r=r>2?r:2,"number"==typeof n?(o=n*r,n=o/(1+e(o))/(t(r)/i)):(o=n[0]*r,n[0]=o/(1+e(o))/(t(r)/i),o=n[1]*r,n[1]=o/(1+e(o))/(t(r)/i)),n}}).init().processProperties(arguments)},Gibberish.Distortion.prototype=Gibberish._effect,Gibberish.Gain=function(){Gibberish.extend(this,{name:"gain",properties:{input:0,amount:1},callback:function(e,t){return"number"==typeof e?e*=t:(e[0]*=t,e[1]*=t),e}}).init().processProperties(arguments)},Gibberish.Gain.prototype=Gibberish._effect,Gibberish.Delay=function(){var e=[],t=0;e.push(new Float32Array(2*Gibberish.context.sampleRate)),e.push(new Float32Array(2*Gibberish.context.sampleRate)),Gibberish.extend(this,{name:"delay",properties:{input:0,time:22050,feedback:.5,wet:1,dry:1,rate:1},callback:function(i,n,r,o,a,s){var l="number"==typeof i?1:2,u=t++%88200;n/=s;var c=(u+(0|n))%88200;return 1===l?(e[0][c]=i+e[0][u]*r,i=i*a+e[0][u]*o):(e[0][c]=i[0]+e[0][u]*r,i[0]=i[0]*a+e[0][u]*o,e[1][c]=i[1]+e[1][u]*r,i[1]=i[1]*a+e[1][u]*o),i}});var i=Math.round(this.properties.time);Object.defineProperty(this,"time",{configurable:!0,get:function(){return i},set:function(e){i=Math.round(e),Gibberish.dirty(this)}}),this.init(),this.processProperties(arguments)},Gibberish.Delay.prototype=Gibberish._effect,Gibberish.Decimator=function(){var e=0,t=[],i=Math.pow,n=Math.floor;Gibberish.extend(this,{name:"decimator",properties:{input:0,bitDepth:16,sampleRate:1},callback:function(r,o,a){e+=a;var s="number"==typeof r?1:2;if(1===s){if(e>=1){var l=i(o,2);t[0]=n(r*l)/l,e-=1}r=t[0]}else{if(e>=1){var l=i(o,2);t[0]=n(r[0]*l)/l,t[1]=n(r[1]*l)/l,e-=1}r=t}return r}}).init().processProperties(arguments)},Gibberish.Decimator.prototype=Gibberish._effect,Gibberish.RingModulation=function(){var e=(new Gibberish.Sine).callback,t=[0,0];Gibberish.extend(this,{name:"ringmod",properties:{input:0,frequency:440,amp:.5,mix:.5},callback:function(i,n,r,o){var a="number"==typeof i?1:2,s=1===a?i:i[0],l=e(n,r);if(s=s*(1-o)+s*l*o,2===a){var u=i[1];return u=u*(1-o)+u*l*o,t[0]=s,t[1]=u,t}return s}}).init().processProperties(arguments)},Gibberish.RingModulation.prototype=Gibberish._effect,Gibberish.DCBlock=function(){var e=0,t=0;Gibberish.extend(this,{name:"dcblock",type:"effect",properties:{input:0},reset:function(){e=0,t=0},callback:function(i){var n=i-e+.9997*t;return e=i,t=n,n}}).init().processProperties(arguments)},Gibberish.DCBlock.prototype=Gibberish._effect,Gibberish.Tremolo=function(){var e=(new Gibberish.Sine).callback;Gibberish.extend(this,{name:"tremolo",type:"effect",properties:{input:0,frequency:2.5,amp:.5},callback:function(t,i,n){var r="number"==typeof t?1:2,o=e(i,n);return 1===r?t*=o:(t[0]*=o,t[1]*=o),t}}).init().processProperties(arguments)},Gibberish.Tremolo.prototype=Gibberish._effect,Gibberish.OnePole=function(){var e=0;Gibberish.extend(this,{name:"onepole",type:"effect",properties:{input:0,a0:.15,b1:.85},callback:function(t,i,n){var r=t*i+e*n;return e=r,r},smooth:function(t,i){this.input=i[t],e=this.input,i[t]=this,this.obj=i,this.property=t,this.oldSetter=i.__lookupSetter__(t),this.oldGetter=i.__lookupGetter__(t);var n=this;Object.defineProperty(i,t,{get:function(){return n.input},set:function(e){n.input=e}})},remove:function(){Object.defineProperty(this.obj,this.property,{get:this.oldGetter,set:this.oldSetter}),this.obj[this.property]=this.input}}).init().processProperties(arguments)},Gibberish.OnePole.prototype=Gibberish._effect,Gibberish.Filter24=function(){var e=[0,0,0,0],t=[0,0,0,0],i=[0,0],n=isNaN(arguments[0])?.1:arguments[0],r=isNaN(arguments[1])?3:arguments[1];_isLowPass="undefined"!=typeof arguments[2]?arguments[2]:!0,Gibberish.extend(this,{name:"filter24",properties:{input:0,cutoff:n,resonance:r,isLowPass:_isLowPass},callback:function(n,r,o,a){var s="number"==typeof n?1:2,l=1===s?n:n[0],u=e[3]*o;if(u=u>1?1:u,r=0>r?0:r,r=r>1?1:r,l-=u,e[0]=e[0]+(-e[0]+l)*r,e[1]=e[1]+(-e[1]+e[0])*r,e[2]=e[2]+(-e[2]+e[1])*r,e[3]=e[3]+(-e[3]+e[2])*r,l=a?e[3]:l-e[3],2===s){var c=n[1];return u=t[3]*o,u=u>1?1:u,c-=u,t[0]=t[0]+(-t[0]+c)*r,t[1]=t[1]+(-t[1]+t[0])*r,t[2]=t[2]+(-t[2]+t[1])*r,t[3]=t[3]+(-t[3]+t[2])*r,c=a?t[3]:c-t[3],i[0]=l,i[1]=c,i}return l}}).init().processProperties(arguments)},Gibberish.Filter24.prototype=Gibberish._effect,Gibberish.SVF=function(){var e=[0,0],t=[0,0],i=Math.PI,n=[0,0];Gibberish.extend(this,{name:"SVF",properties:{input:0,cutoff:440,Q:2,mode:0,sr:Gibberish.context.sampleRate},callback:function(r,o,a,s,l){var u="number"==typeof r?1:2,c=1===u?r:r[0],h=2*i*o/l;a=1/a;var f=t[0]+h*e[0],p=c-f-a*e[0],d=h*p+e[0],m=p+f;if(e[0]=d,t[0]=f,c=0===s?f:1===s?p:2===s?d:m,2===u){var g=r[1],f=t[1]+h*e[1],p=g-f-a*e[1],d=h*p+e[1],m=p+f;e[1]=d,t[1]=f,g=0===s?f:1===s?p:2===s?d:m,n[0]=c,n[1]=g}else n=c;return n}}).init().processProperties(arguments)},Gibberish.SVF.prototype=Gibberish._effect,Gibberish.Biquad=function(){var e=0,t=0,i=0,n=0,r=0,o=0,a=0,s=0,l=[0,0],u=.001639,c=.003278,h=.001639,f=-1.955777,p=.960601,d="LP",m=2e3,g=.5,v=Gibberish.context.sampleRate;Gibberish.extend(this,{name:"biquad",properties:{input:null},calculateCoefficients:function(){switch(d){case"LP":var e=2*Math.PI*m/v,t=Math.sin(e),i=Math.cos(e),n=t/(2*g);u=(1-i)/2,c=1-i,h=u,a0=1+n,f=-2*i,p=1-n;break;case"HP":var e=2*Math.PI*m/v,t=Math.sin(e),i=Math.cos(e),n=t/(2*g);u=(1+i)/2,c=-(1+i),h=u,a0=1+n,f=-2*i,p=1-n;break;case"BP":var e=2*Math.PI*m/v,t=Math.sin(e),i=Math.cos(e),r=Math.log(2)/2*g*e/t,n=t*(Math.exp(r)-Math.exp(-r))/2;u=n,c=0,h=-n,a0=1+n,f=-2*i,p=1-n;break;default:return}u/=a0,c/=a0,h/=a0,f/=a0,p/=a0},callback:function(d){var m=isNaN(d)?2:1,g=0,v=0,y=1===m?d:d[0];return g=u*y+c*e+h*t-f*i-p*n,t=e,e=y,n=i,i=g,2===m&&(inR=d[1],v=u*inR+c*r+h*o-f*a-p*s,o=r,r=inR,s=a,a=v,l[0]=g,l[1]=v),1===m?g:l}}).init(),Object.defineProperties(this,{mode:{get:function(){return d},set:function(e){d=e,this.calculateCoefficients()}},cutoff:{get:function(){return m},set:function(e){m=e,this.calculateCoefficients()}},Q:{get:function(){return g},set:function(e){g=e,this.calculateCoefficients()}}}),this.processProperties(arguments),this.calculateCoefficients()},Gibberish.Biquad.prototype=Gibberish._effect,Gibberish.Flanger=function(){var e=[new Float32Array(88200),new Float32Array(88200)],t=88200,i=(new Gibberish.Sine).callback,n=Gibberish.interpolate,r=-100,o=0;Gibberish.extend(this,{name:"flanger",properties:{input:0,rate:.25,feedback:0,amount:125,offset:125},callback:function(a,s,l,u){var c="number"==typeof a?1:2,h=r+i(s,.95*u);h>t?h-=t:0>h&&(h+=t);var f=n(e[0],h);return e[0][o]=1===c?a+f*l:a[0]+f*l,2===c?(a[0]+=f,f=n(e[1],h),e[1][o]=a[1]+f*l,a[1]+=f):a+=f,++o>=t&&(o=0),++r>=t&&(r=0),a}}).init().processProperties(arguments),r=-1*this.offset},Gibberish.Flanger.prototype=Gibberish._effect,Gibberish.Vibrato=function(){var e=[new Float32Array(88200),new Float32Array(88200)],t=88200,i=(new Gibberish.Sine).callback,n=Gibberish.interpolate,r=-100,o=0;Gibberish.extend(this,{name:"vibrato",properties:{input:0,rate:5,amount:.5,offset:125},callback:function(a,s,l,u){var c="number"==typeof a?1:2,h=r+i(s,l*u-1);h>t?h-=t:0>h&&(h+=t);var f=n(e[0],h);return e[0][o]=1===c?a:a[0],2===c?(a[0]=f,f=n(e[1],h),e[1][o]=a[1],a[1]=f):a=f,++o>=t&&(o=0),++r>=t&&(r=0),a}}).init().processProperties(arguments),r=-1*this.offset},Gibberish.Vibrato.prototype=Gibberish._effect,Gibberish.BufferShuffler=function(){var e=[new Float32Array(88200),new Float32Array(88200)],t=88200,i=0,n=0,r=0,o=0,a=0,s=Math.random,l=1,u=!1,c=!1,h=!1,f=Gibberish.interpolate,p=!1,d=1,m=!1,g=Gibberish.rndf,v=[0,0];Gibberish.extend(this,{name:"buffer_shuffler",properties:{input:0,chance:.25,rate:11025,length:22050,reverseChange:.5,pitchChance:.5,pitchMin:.25,pitchMax:2,wet:1,dry:0},callback:function(y,b,x,w,_,S,M,C,A,T){var E="number"==typeof y?1:2;a?++o%(w-400)===0&&(u=!1,c=!0,l=1,o=0):(e[0][n]=1===E?y:y[0],e[1][n]=1===E?y:y[1],n++,n%=t,m=0===n?1:m,r++,r%x==0&&s()<b&&(h=s()<_,a=!0,h||(i=n-w,0>i&&(i=t+i)),p=s()<S,p&&(d=g(M,C)),l=1,u=!0,c=!1)),i+=h?-1*d:d,0>i?i+=t:i>=t&&(i-=t);var k,P,R,L,D=f(e[0],i);return u?(l-=.0025,R=D*(1-l),k=1===E?R+y*l:R+y[0]*l,2===E&&(L=f(e[1],i),R=L*(1-l),P=1===E?k:R+y[1]*l),.0025>=l&&(u=!1)):c?(l-=.0025,R=D*l,k=1===E?R+y*l:R+y[0]*(1-l),2===E&&(L=f(e[1],i),R=L*l,P=R+y[1]*(1-l)),.0025>=l&&(c=!1,a=!1,h=!1,d=1,p=0)):1===E?k=a&&m?D*A+y*T:y:(L=f(e[1],i),k=a&&m?D*A+y[0]*T:y[0],P=a&&m?L*A+y[1]*T:y[1]),v=[k,P],1===E?k:v}}).init().processProperties(arguments)},Gibberish.BufferShuffler.prototype=Gibberish._effect,Gibberish.AllPass=function(e){var t=-1,i=new Float32Array(e||500),n=i.length;Gibberish.extend(this,{name:"allpass",properties:{input:0},callback:function(e){t=++t%n;var r=i[t],o=-1*e+r;return i[t]=e+.5*r,o}})},Gibberish.Comb=function(e){var t=new Float32Array(e||1200),i=t.length,n=0,r=0;Gibberish.extend(this,{name:"comb",properties:{input:0,feedback:.84,damping:.2},callback:function(e,o,a){var s=++n%i,l=t[s];return r=l*(1-a)+r*a,t[s]=e+r*o,l}})},Gibberish.Reverb=function(){var e={combCount:8,combTuning:[1116,1188,1277,1356,1422,1491,1557,1617],allPassCount:4,allPassTuning:[556,441,341,225],allPassFeedback:.5,fixedGain:.015,scaleDamping:.4,scaleRoom:.28,offsetRoom:.7,stereoSpread:23},t=.84,i=[],n=[],r=[0,0];Gibberish.extend(this,{name:"reverb",roomSize:.5,properties:{input:0,wet:.5,dry:.55,roomSize:.84,damping:.5},callback:function(e,t,o,a,s){for(var l="object"==typeof e?2:1,u=1===l?e:e[0]+e[1],c=.015*u,h=c,f=0;8>f;f++){var p=i[f](c,.98*a,.4*s);h+=p}for(var f=0;4>f;f++)h=n[f](h);return r[0]=r[1]=u*o+h*t,r}}).init().processProperties(arguments),this.setFeedback=function(e){t=e};for(var o=0;8>o;o++)i.push(new Gibberish.Comb(e.combTuning[o]).callback);for(var o=0;4>o;o++)n.push(new Gibberish.AllPass(e.allPassTuning[o],e.allPassFeedback).callback)},Gibberish.Reverb.prototype=Gibberish._effect,Gibberish.StereoReverb=function(){var e={combCount:8,combTuning:[1116,1188,1277,1356,1422,1491,1557,1617],allPassCount:4,allPassTuning:[556,441,341,225],allPassFeedback:.5,fixedGain:.015,scaleDamping:.4,scaleRoom:.28,offsetRoom:.7,stereoSpread:23},t=.84,i=[],n=[],r=[],o=[],a=[0,0];Gibberish.extend(this,{name:"reverb",roomSize:.5,properties:{input:0,wet:.5,dry:.55,roomSize:.84,damping:.5},callback:function(e,t,s,l,u){for(var c="object"==typeof e?2:1,h=e[0],f=1===c?h:e[1],p=outL=.015*h,d=outR=.015*f,m=0;8>m;m++)outL+=i[m](p,.98*l,.4*u),outR+=n[m](d,.98*l,.4*u);for(var m=0;4>m;m++)outL=r[m](outL),outR=o[m](outR);return a[0]=h*s+outL*t,a[1]=f*s+outR*t,a}}).init().processProperties(arguments),this.setFeedback=function(e){t=e};for(var s=0;8>s;s++)i.push(new Gibberish.Comb(e.combTuning[s]).callback),n.push(new Gibberish.Comb(e.combTuning[s]).callback);for(var s=0;4>s;s++)r.push(new Gibberish.AllPass(e.allPassTuning[s],e.allPassFeedback).callback),o.push(new Gibberish.AllPass(e.allPassTuning[s],e.allPassFeedback).callback)},Gibberish.StereoReverb.prototype=Gibberish._effect,Gibberish.Granulator=function(e){var t=[];buffer=null,interpolate=Gibberish.interpolate,panner=Gibberish.makePanner(),bufferLength=0,debug=0,write=0,self=this,out=[0,0],_out=[0,0],rndf=Gibberish.rndf,numberOfGrains=e.numberOfGrains||20,console.log("NUMBER OF GRAINS",numberOfGrains),Gibberish.extend(this,{name:"granulator",bufferLength:88200,reverse:!0,spread:.5,properties:{speed:1,speedMin:-0,speedMax:0,grainSize:1e3,position:.5,positionMin:0,positionMax:0,amp:.2,fade:.1,pan:0,shouldWrite:!1},setBuffer:function(e){buffer=e,bufferLength=e.length},callback:function(e,i,n,r,o,a,s,l,u,c){for(var h=0;numberOfGrains>h;h++){var f=t[h];if(f._speed>0){f.pos>f.end&&(f.pos=(s+rndf(o,a))*buffer.length,f.start=f.pos,f.end=f.start+r,f._speed=e+rndf(i,n),f._speed=f._speed<.1?.1:f._speed,f._speed=f._speed<.1&&f._speed>0?.1:f._speed,f._speed=f._speed>-.1&&f._speed<0?-.1:f._speed,f.fadeAmount=f._speed*u*r,f.pan=rndf(-1*self.spread,self.spread));for(var p=f.pos;p>buffer.length;)p-=buffer.length;for(;0>p;)p+=buffer.length;var d=interpolate(buffer,p);d*=f.pos<f.fadeAmount+f.start?(f.pos-f.start)/f.fadeAmount:1,d*=f.pos>f.end-f.fadeAmount?(f.end-f.pos)/f.fadeAmount:1}else{f.pos<f.end&&(f.pos=(s+rndf(o,a))*buffer.length,f.start=f.pos,f.end=f.start-r,f._speed=e+rndf(i,n),f._speed=f._speed<.1&&f._speed>0?.1:f._speed,f._speed=f._speed>-.1&&f._speed<0?-.1:f._speed,f.fadeAmount=f._speed*u*r);for(var p=f.pos;p>buffer.length;)p-=buffer.length;for(;0>p;)p+=buffer.length;var d=interpolate(buffer,p);d*=f.pos>f.start-f.fadeAmount?(f.start-f.pos)/f.fadeAmount:1,d*=f.pos<f.end+f.fadeAmount?(f.end-f.pos)/f.fadeAmount:1}_out=panner(d*l,f.pan,_out),out[0]+=_out[0],out[1]+=_out[1],f.pos+=f._speed}return panner(out,c,out)}}).init().processProperties(arguments);for(var i=0;numberOfGrains>i;i++)t[i]={pos:self.position+Gibberish.rndf(self.positionMin,self.positionMax),_speed:self.speed+Gibberish.rndf(self.speedMin,self.speedMax)},t[i].start=t[i].pos,t[i].end=t[i].pos+self.grainSize,t[i].fadeAmount=t[i]._speed*self.fade*self.grainSize,t[i].pan=Gibberish.rndf(-1*self.spread,self.spread),console.log("GRAIN",i,"POS",t[i].pos,"SPEED",t[i]._speed);this.grains=t,"undefined"!=typeof e.buffer&&(buffer=e.buffer,bufferLength=buffer.length)},Gibberish.Granulator.prototype=Gibberish._effect,Gibberish.synth=function(){this.type="oscillator",this.oscillatorInit=function(){this.fx=new Array2,this.fx.parent=this}},Gibberish.synth.prototype=new Gibberish.ugen,Gibberish._synth=new Gibberish.synth,Gibberish.Synth=function(e){this.name="synth",this.properties={frequency:0,pulsewidth:.5,attack:22050,decay:22050,sustain:22050,release:22050,attackLevel:1,sustainLevel:.5,releaseTrigger:0,glide:.15,amp:.25,channels:2,pan:0,velocity:1,sr:Gibberish.context.sampleRate},this.note=function(n,r){if("undefined"!=typeof n){if(Array.isArray(arguments[0])){var o=arguments[0][0];r=arguments[0][1],n=o}if(0!==r){if("object"!=typeof this.frequency){if(t&&n===c&&e.requireReleaseTrigger)return this.releaseTrigger=1,void(c=null);this.frequency=c=n,this.releaseTrigger=0,"object"==typeof n&&Gibberish.dirty(this)}else this.frequency[0]=c=n,this.releaseTrigger=0,Gibberish.dirty(this);"undefined"!=typeof r&&(this.velocity=r),i.run()}else this.releaseTrigger=1}},e=e||{};var t="undefined"==typeof e.useADSR?!1:e.useADSR,i=t?new Gibberish.ADSR:new Gibberish.AD,n=i.getState,r=i.callback,o=new Gibberish.PWM,a=o.callback,s=(new Gibberish.OnePole).callback,l=Gibberish.makePanner(),u=this,c=0,h=[0,0];i.requireReleaseTrigger=e.requireReleaseTrigger||!1,this.callback=function(e,i,o,c,f,p,d,m,g,v,y,b,x,w,_){v=v>=1?.99999:v,e=s(e,1-v,v);var S,M;return t?(S=r(o,c,f,p,d,m,g),g&&(u.releaseTrigger=0),n()<4?(M=a(e,1,i,_)*S*w*y,1===b?M:l(M,x,h)):(M=h[0]=h[1]=0,1===b?M:h)):n()<2?(S=r(o,c),M=a(e,1,i,_)*S*w*y,1===b?M:l(M,x,h)):(M=h[0]=h[1]=0,1===b?M:h)},this.getEnv=function(){return i},this.getOsc=function(){return o},this.setOsc=function(e){o=e,a=o.callback};var f="PWM";Object.defineProperty(this,"waveform",{get:function(){return f},set:function(e){this.setOsc(new Gibberish[e])}}),this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.Synth.prototype=Gibberish._synth,Gibberish.PolySynth=function(){this.__proto__=new Gibberish.Bus2,Gibberish.extend(this,{name:"polysynth",maxVoices:5,voiceCount:0,frequencies:[],_frequency:0,polyProperties:{frequency:0,glide:0,attack:22050,decay:22050,sustain:22050,release:22050,attackLevel:1,sustainLevel:.5,pulsewidth:.5,velocity:1,waveform:"PWM"},note:function(e,t){if("undefined"!=typeof e){var i=this.frequencies.indexOf(e),n=i>-1?i:this.voiceCount++,r=this.children[n];r.note(e,t),-1===i?(this.frequencies[n]=e,this._frequency=e,this.voiceCount>=this.maxVoices&&(this.voiceCount=0)):delete this.frequencies[n],this.lastChild=n}},initVoices:function(){for(var e=0;e<this.maxVoices;e++){var t={waveform:this.waveform,attack:this.attack,decay:this.decay,sustain:this.sustain,release:this.release,attackLevel:this.attackLevel,sustainLevel:this.sustainLevel,pulsewidth:this.pulsewidth,channels:2,amp:1,useADSR:this.useADSR||!1,requireReleaseTrigger:this.requireReleaseTrigger||!1},i=new Gibberish.Synth(t).connect(this);this.children.push(i)}}}),this.amp=1/this.maxVoices,this.children=[],"object"==typeof arguments[0]&&(this.maxVoices=arguments[0].maxVoices?arguments[0].maxVoices:this.maxVoices,this.useADSR="undefined"!=typeof arguments[0].useADSR?arguments[0].useADSR:!1,this.requireReleaseTrigger="undefined"!=typeof arguments[0].requireReleaseTrigger?arguments[0].requireReleaseTrigger:!1),Gibberish.polyInit(this),this.initVoices(),this.processProperties(arguments),Gibberish._synth.oscillatorInit.call(this)},Gibberish.Synth2=function(e){this.name="synth2",this.properties={frequency:0,pulsewidth:.5,attack:22050,decay:22050,sustain:22050,release:22050,attackLevel:1,sustainLevel:.5,releaseTrigger:0,cutoff:.25,resonance:3.5,useLowPassFilter:!0,glide:.15,amp:.25,channels:1,pan:0,velocity:1,sr:Gibberish.context.sampleRate},this.note=function(n,r){if("undefined"!=typeof n)if(0!==r){if("object"!=typeof this.frequency){if(t&&n===h&&e.requireReleaseTrigger)return this.releaseTrigger=1,void(h=null);this.frequency=h=n,this.releaseTrigger=0,"object"==typeof n&&Gibberish.dirty(this)}else this.frequency[0]=h=n,this.releaseTrigger=0,Gibberish.dirty(this);"undefined"!=typeof r&&(this.velocity=r),i.run()}else this.releaseTrigger=1},e=e||{};var t="undefined"==typeof e.useADSR?!1:e.useADSR,i=t?new Gibberish.ADSR:new Gibberish.AD,n=i.getState,r=i.callback,o=new Gibberish.PWM,a=o.callback,s=new Gibberish.Filter24,l=s.callback,u=(new Gibberish.OnePole).callback,c=Gibberish.makePanner(),h=0,f=this,p=[0,0];i.requireReleaseTrigger=e.requireReleaseTrigger||!1,this.callback=function(e,i,o,s,h,d,m,g,v,y,b,x,w,_,S,M,C,A){w=w>=1?.99999:w,e=u(e,1-w,w);var T,E;return t?(T=r(o,s,h,d,m,g,v),v&&(f.releaseTrigger=0),n()<4?(E=l(a(e,.15,i,A),y*T,b,x)*T*C*_,1===S?E:c(E,M,p)):(E=p[0]=p[1]=0,1===S?E:p)):n()<2?(T=r(o,s),E=l(a(e,.15,i,A),y*T,b,x)*T*C*_,1===S?E:c(E,M,p)):(E=p[0]=p[1]=0,1===S?E:p)},this.getUseADSR=function(){return t},this.getEnv=function(){return i},this.getOsc=function(){return o},this.setOsc=function(e){o=e,a=o.callback};var d="PWM";Object.defineProperty(this,"waveform",{get:function(){return d},set:function(e){this.setOsc(new Gibberish[e])}}),this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.Synth2.prototype=Gibberish._synth,Gibberish.PolySynth2=function(){this.__proto__=new Gibberish.Bus2,Gibberish.extend(this,{name:"polysynth2",maxVoices:5,voiceCount:0,frequencies:[],_frequency:0,polyProperties:{frequency:0,glide:0,attack:22050,decay:22050,sustain:22050,release:22050,attackLevel:1,sustainLevel:.5,pulsewidth:.5,resonance:3.5,cutoff:.25,velocity:1,useLowPassFilter:!0,waveform:"PWM"},note:function(e,t){if("undefined"!=typeof e){var i=this.frequencies.indexOf(e),n=i>-1?i:this.voiceCount++,r=this.children[n];r.note(e,t),-1===i?(this.frequencies[n]=e,this._frequency=e,this.voiceCount>=this.maxVoices&&(this.voiceCount=0)):delete this.frequencies[n],this.lastChild=n}},initVoices:function(){this.dirty=!0;for(var e=0;e<this.maxVoices;e++){var t={attack:this.attack,decay:this.decay,sustain:this.sustain,release:this.release,attackLevel:this.attackLevel,sustainLevel:this.sustainLevel,pulsewidth:this.pulsewidth,channels:2,amp:1,useADSR:this.useADSR||!1,requireReleaseTrigger:this.requireReleaseTrigger||!1},i=new Gibberish.Synth2(t).connect(this);this.children.push(i)}}}),this.amp=1/this.maxVoices,this.children=[],"object"==typeof arguments[0]&&(this.maxVoices=arguments[0].maxVoices?arguments[0].maxVoices:this.maxVoices,this.useADSR="undefined"!=typeof arguments[0].useADSR?arguments[0].useADSR:!1,this.requireReleaseTrigger="undefined"!=typeof arguments[0].requireReleaseTrigger?arguments[0].requireReleaseTrigger:!1),Gibberish.polyInit(this),this.initVoices(),this.processProperties(arguments),Gibberish._synth.oscillatorInit.call(this)},Gibberish.FMSynth=function(e){this.name="fmSynth",this.properties={frequency:0,cmRatio:2,index:5,attack:22050,decay:22050,sustain:22050,release:22050,attackLevel:1,sustainLevel:.5,releaseTrigger:0,glide:.15,amp:.25,channels:2,velocity:1,pan:0},this.note=function(n,r){if("undefined"!=typeof n)if(0!==r){if("object"!=typeof this.frequency){if(t&&n===h&&e.requireReleaseTrigger)return this.releaseTrigger=1,void(h=null);this.frequency=h=n,this.releaseTrigger=0,"object"==typeof n&&Gibberish.dirty(this)}else this.frequency[0]=h=n,this.releaseTrigger=0,Gibberish.dirty(this);"undefined"!=typeof r&&(this.velocity=r),i.run()}else this.releaseTrigger=1},e=e||{};var t="undefined"==typeof e.useADSR?!1:e.useADSR,i=t?new Gibberish.ADSR:new Gibberish.AD,n=i.getState,r=i.callback,o=(new Gibberish.Sine).callback,a=(new Gibberish.Sine).callback,s=(new Gibberish.OnePole).callback,l=Gibberish.makePanner(),u=[0,0],c=this,h=0;i.requireReleaseTrigger=e.requireReleaseTrigger||!1,this.callback=function(e,i,h,f,p,d,m,g,v,y,b,x,w,_,S){var M,C,A;return b>=1&&(b=.9999),e=s(e,1-b,b),t?(M=r(f,p,d,m,g,v,y)*_,y&&(c.releaseTrigger=0),n()<4?(A=a(e*i,e*h)*M,C=o(e+A,1)*M*x,1===w?C:l(C,S,u)):(C=u[0]=u[1]=0,1===w?C:u)):n()<2?(M=r(f,p)*_,A=a(e*i,e*h)*M,C=o(e+A,1)*M*x,1===w?C:l(C,S,u)):(C=u[0]=u[1]=0,1===w?C:u)},this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.FMSynth.prototype=Gibberish._synth,Gibberish.PolyFM=function(){this.__proto__=new Gibberish.Bus2,Gibberish.extend(this,{name:"polyfm",maxVoices:5,voiceCount:0,children:[],frequencies:[],_frequency:0,velocity:1,polyProperties:{glide:0,attack:22050,decay:22050,sustain:22050,release:22050,attackLevel:1,sustainLevel:.5,index:5,cmRatio:2},note:function(e,t){if("undefined"!=typeof e){var i=this.frequencies.indexOf(e),n=i>-1?i:this.voiceCount++,r=this.children[n];"undefined"==typeof t&&(t=this.velocity),r.note(e,t),-1===i?(this.frequencies[n]=e,this._frequency=e,this.voiceCount>=this.maxVoices&&(this.voiceCount=0)):delete this.frequencies[n]}},initVoices:function(){for(var e=0;e<this.maxVoices;e++){var t={attack:this.attack,decay:this.decay,sustain:this.sustain,release:this.release,attackLevel:this.attackLevel,sustainLevel:this.sustainLevel,cmRatio:this.cmRatio,index:this.index,channels:2,useADSR:this.useADSR||!1,requireReleaseTrigger:this.requireReleaseTrigger||!1,amp:1},i=new Gibberish.FMSynth(t);i.connect(this),this.children.push(i)}}}),this.amp=1/this.maxVoices,this.children=[],"object"==typeof arguments[0]&&(this.maxVoices=arguments[0].maxVoices?arguments[0].maxVoices:this.maxVoices,this.useADSR="undefined"!=typeof arguments[0].useADSR?arguments[0].useADSR:!1,this.requireReleaseTrigger="undefined"!=typeof arguments[0].requireReleaseTrigger?arguments[0].requireReleaseTrigger:!1),Gibberish.polyInit(this),this.initVoices(),this.processProperties(arguments),Gibberish._synth.oscillatorInit.call(this)},Gibberish.Sampler=function(){var e=1,t=Gibberish.interpolate,i=Gibberish.makePanner(),n=[0,0],r=null,o=1,a=this;if(Gibberish.extend(this,{name:"sampler",file:null,isLoaded:!1,playOnLoad:0,buffers:{},properties:{pitch:1,amp:1,isRecording:!1,isPlaying:!0,input:0,length:0,start:0,end:1,loops:0,pan:0},_onload:function(t){r=t.channels[0],o=t.length,a.length=o,a.length=e=o,a.isPlaying=!0,Gibberish.audioFiles[a.file]=r,a.buffers[a.file]=r,a.onload&&a.onload(),0!==a.playOnLoad&&a.note(a.playOnLoad),a.isLoaded=!0},switchBuffer:function(e){if("string"==typeof e)"undefined"!=typeof this.buffers[e]&&(r=this.buffers[e],o=this.length=r.length);else if("number"==typeof e){var t=Object.keys(this.buffers);if(0===t.length)return;r=this.buffers[t[e]],o=this.length=r.length,this.setPhase(0)}},floatTo16BitPCM:function(e,t,i){for(var n=0;n<i.length-1;n++,t+=2){var r=Math.max(-1,Math.min(1,i[n]));e.setInt16(t,0>r?32768*r:32767*r,!0)}},encodeWAV:function(){function e(e,t,i){for(var n=0;n<i.length;n++)e.setUint8(t+n,i.charCodeAt(n))}var t=this.getBuffer(),i=new ArrayBuffer(44+2*t.length),n=new DataView(i),r=Gibberish.context.sampleRate;return e(n,0,"RIFF"),n.setUint32(4,32+2*t.length,!0),e(n,8,"WAVE"),e(n,12,"fmt "),n.setUint32(16,16,!0),n.setUint16(20,1,!0),n.setUint16(22,1,!0),n.setUint32(24,r,!0),n.setUint32(28,4*r,!0),n.setUint16(32,2,!0),n.setUint16(34,16,!0),e(n,36,"data"),n.setUint32(40,2*t.length,!0),this.floatTo16BitPCM(n,44,t),n},download:function(){var e=this.encodeWAV(),t=new Blob([e]),i=window.webkitURL.createObjectURL(t),n=window.document.createElement("a");n.href=i,n.download="output.wav";var r=document.createEvent("Event");r.initEvent("click",!0,!0),n.dispatchEvent(r)},range:function(e,t){if(Array.isArray(e)&&(t=e[1],e=e[0]),e>t){var i=e;e=t,t=i}this.start=e,this.end=t},note:function(t,i){if("undefined"!=typeof t){switch(typeof t){case"number":this.pitch=t;break;case"function":this.pitch=t();break;case"object":this.pitch=Array.isArray(t)?t[0]:t}if("number"==typeof i&&(this.amp=i),null!==this.function){this.isPlaying=!0;var n;switch(typeof this.pitch){case"number":n=this.pitch;break;case"function":n=this.pitch.getValue?this.pitch.getValue():this.pitch();break;case"object":n=Array.isArray(this.pitch)?this.pitch[0]:this.pitch.getValue?this.pitch.getValue():this.pitch.input.getValue(),"function"==typeof n&&(n=n())}e=0,Gibberish.dirty(this)}}},getBuffer:function(){return r},setBuffer:function(e){r=e},getPhase:function(){return e},setPhase:function(t){e=t},getNumberOfBuffers:function(){return Object.keys(a.buffers).length-1},callback:function(o,a,s,l,u,c,h,f,p,d){var m=0,g=h*c,v=f*c;return e+=o,null!==r&&l?(o>0?v>g+e?m=t(r,g+e):p&&(e=0):v+e>g?m=t(r,v+e):p&&(e=0),i(m*a,d,n)):(n[0]=n[1]=m,n)}}).init().oscillatorInit().processProperties(arguments),"undefined"!=typeof arguments[0]&&("string"==typeof arguments[0]?(this.file=arguments[0],this.pitch=0):"object"==typeof arguments[0]&&arguments[0].file&&(this.file=arguments[0].file)),"undefined"!=typeof Gibberish.audioFiles[this.file])r=Gibberish.audioFiles[this.file],this.end=1,this.buffers[this.file]=r,this.length=e=this.bufferLength=r.length,Gibberish.dirty(this),this.onload&&this.onload();else if(null!==this.file){var s,l=new XMLHttpRequest;l.open("GET",this.file,!0),l.responseType="arraybuffer",l.onload=function(){s(this.response)},l.send(),l.onerror=function(e){console.error("Sampler file loading error",e)},s=function(t){Gibberish.context.decodeAudioData(t,function(t){r=t.getChannelData(0),a.length=e=o=r.length,a.isPlaying=!0,a.buffers[a.file]=r,Gibberish.audioFiles[a.file]=r,a.onload&&a.onload(),0!==a.playOnLoad&&a.note(a.playOnLoad),a.isLoaded=!0},function(e){console.log("Error decoding file",e)})}}else"undefined"!=typeof this.buffer&&(this.isLoaded=!0,r=this.buffer,this.bufferLength=r.length||88200,e=this.bufferLength,arguments[0]&&arguments[0].loops&&(this.loops=1),Gibberish.dirty(this),this.onload&&this.onload())},Gibberish.Sampler.prototype=Gibberish._oscillator,Gibberish.Sampler.prototype.record=function(e,t){this.isRecording=!0;var i=this;return this.recorder=new Gibberish.Record(e,t,function(){i.setBuffer(this.getBuffer()),bufferLength=i.getBuffer().length,i.setPhase(i.end),i.isRecording=!1}).record(),this},Gibberish.MonoSynth=function(){Gibberish.extend(this,{name:"monosynth",properties:{attack:1e4,decay:1e4,cutoff:.2,resonance:2.5,amp1:1,amp2:1,amp3:1,filterMult:.3,isLowPass:!0,pulsewidth:.5,amp:.6,detune2:.01,detune3:-.01,octave2:1,octave3:-1,glide:0,pan:0,velocity:1,frequency:0,channels:2},waveform:"Saw3",note:function(e,n){"undefined"!=typeof e&&("undefined"!=typeof n&&0!==n&&(this.velocity=n),0!==n&&("object"!=typeof this.frequency?this.frequency=e:(this.frequency[0]=e,Gibberish.dirty(this)),i()>0&&t.run()))}});var e=waveform1=waveform2=waveform3=this.waveform;Object.defineProperty(this,"waveform",{get:function(){return e},set:function(t){e!==t&&(e=t,o=(new Gibberish[t]).callback,a=(new Gibberish[t]).callback,s=(new Gibberish[t]).callback)}}),Object.defineProperties(this,{waveform1:{get:function(){return waveform1},set:function(e){waveform1=e,o=(new Gibberish[e]).callback}},waveform2:{get:function(){return waveform2},set:function(e){waveform2=e,a=(new Gibberish[e]).callback}},waveform3:{get:function(){return waveform3},set:function(e){waveform3=e,s=(new Gibberish[e]).callback}}});var t=new Gibberish.AD(this.attack,this.decay),i=t.getState,n=t.callback,r=(new Gibberish.Filter24).callback,o=new Gibberish[this.waveform](this.frequency,this.amp1).callback,a=new Gibberish[this.waveform](this.frequency2,this.amp2).callback,s=new Gibberish[this.waveform](this.frequency3,this.amp3).callback,l=(new Gibberish.OnePole).callback,u=Gibberish.makePanner(),c=[0,0];this.envelope=t,this.callback=function(e,t,h,f,p,d,m,g,v,y,b,x,w,_,S,M,C,A,T,E){if(i()<2){M>=1&&(M=.9999),T=l(T,1-M,M);var k=T;if(_>0)for(var P=0;_>P;P++)k*=2;else if(0>_)for(var P=0;P>_;P--)k/=2;var R=T;if(S>0)for(var P=0;S>P;P++)R*=2;else if(0>S)for(var P=0;P>S;P--)R/=2;k+=x>0?(2*T-T)*x:(T-T/2)*x,R+=w>0?(2*T-T)*w:(T-T/2)*w;var L=o(T,p,y)+a(k,d,y)+s(R,m,y),D=n(e,t)*A,N=r(L,h+g*D,f,v,1)*D;return N*=b,c[0]=c[1]=N,1===E?c:u(N,C,c)}return c[0]=c[1]=0,c},this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.MonoSynth.prototype=Gibberish._synth,Gibberish.Binops={"export":function(e){Gibberish.export("Binops",e||window)},operator:function(){var e=new Gibberish.ugen,t=arguments[0],i=Array.prototype.slice.call(arguments,1);e.name="op",e.properties={};for(var n=0;n<i.length;n++)e.properties[n]=i[n];return e.init.apply(e,i),e.codegen=function(){var e,i="( ";if("undefined"!=typeof Gibberish.memo[this.symbol])return Gibberish.memo[this.symbol];e=Object.keys(this.properties);for(var n=!1,r=0;r<e.length;r++)if(n)n=!1;else{var o="object"==typeof this[r];i+=o?this[r].codegen():this[r],"*"!==t&&"/"!==t||1!==this[r+1]?r<e.length-1&&(i+=" "+t+" "):n=!0}return i+=" )",this.codeblock=i,i},e.valueOf=function(){return e.codegen()},e},Add:function(){var e=Array.prototype.slice.call(arguments,0);return e.unshift("+"),Gibberish.Binops.operator.apply(null,e)},Sub:function(){var e=Array.prototype.slice.call(arguments,0);return e.unshift("-"),Gibberish.Binops.operator.apply(null,e)
},Mul:function(){var e=Array.prototype.slice.call(arguments,0);return e.unshift("*"),Gibberish.Binops.operator.apply(null,e)},Div:function(){var e=Array.prototype.slice.call(arguments,0);return e.unshift("/"),Gibberish.Binops.operator.apply(null,e)},Mod:function(){var e=Array.prototype.slice.call(arguments,0);return e.unshift("%"),Gibberish.Binops.operator.apply(null,e)},Abs:function(){var e=Array.prototype.slice.call(arguments,0),t={name:"abs",properties:{},callback:Math.abs.bind(t)};return t.__proto__=new Gibberish.ugen,t.properties[0]=e[0],t.init(),t},Sqrt:function(){var e=(Array.prototype.slice.call(arguments,0),{name:"sqrt",properties:{},callback:Math.sqrt.bind(e)});return e.__proto__=new Gibberish.ugen,e.properties[i]=arguments[0],e.init(),e},Pow:function(){var e=Array.prototype.slice.call(arguments,0),t={name:"pow",properties:{},callback:Math.pow.bind(t)};t.__proto__=new Gibberish.ugen;for(var i=0;i<e.length;i++)t.properties[i]=e[i];return t.init(),console.log(t.callback),t},Clamp:function(){var e=Array.prototype.slice.call(arguments,0),t={name:"clamp",properties:{input:0,min:0,max:1},callback:function(e,t,i){return t>e?e=t:e>i&&(e=i),e}};return t.__proto__=new Gibberish.ugen,t.init(),t.processProperties(e),t},Merge:function(){var e=Array.prototype.slice.call(arguments,0),t={name:"merge",properties:{},callback:function(e){return e[0]+e[1]}};t.__proto__=new Gibberish.ugen;for(var i=0;i<e.length;i++)t.properties[i]=e[i];return t.init(),t},Map:function(e,t,i,n,r,o,a){var s=Math.pow,l=0,u=0,c={name:"map",properties:{input:e,outputMin:t,outputMax:i,inputMin:n,inputMax:r,curve:o||l,wrap:a||!1},callback:function(e,t,i,n,r,o,a){var l,c=i-t,h=r-n,f=(e-n)/h;return f>1?f=a?f%1:1:0>f&&(f=a?1+f%1:0),l=0===o?t+f*c:t+s(f,1.5)*c,u=l,l},getValue:function(){return u},invert:function(){var e=c.outputMin;c.outputMin=c.outputMax,c.outputMax=e}};return c.__proto__=new Gibberish.ugen,c.init(),c}},Gibberish.Time={bpm:120,"export":function(e){Gibberish.export("Time",e||window)},ms:function(e){return e*Gibberish.context.sampleRate/1e3},seconds:function(e){return e*Gibberish.context.sampleRate},beats:function(e){return function(){var t=Gibberish.context.sampleRate/(Gibberish.Time.bpm/60);return t*e}}},Gibberish.Sequencer2=function(){var e=this,t=0;Gibberish.extend(this,{target:null,key:null,values:null,valuesIndex:0,durations:null,durationsIndex:0,nextTime:0,playOnce:!1,repeatCount:0,repeatTarget:null,isConnected:!0,keysAndValues:null,counts:{},properties:{rate:1,isRunning:!1,nextTime:0},offset:0,name:"seq",callback:function(i,n,r){if(n){if(t>=r){if(null!==e.values){if(e.target){var o=e.values[e.valuesIndex++];"function"==typeof o&&(o=o()),"function"==typeof e.target[e.key]?e.target[e.key](o):e.target[e.key]=o}else"function"==typeof e.values[e.valuesIndex]&&e.values[e.valuesIndex++]();e.valuesIndex>=e.values.length&&(e.valuesIndex=0)}else if(null!==e.keysAndValues)for(var a in e.keysAndValues){var s=e.counts[a]++,o=e.keysAndValues[a][s];"function"==typeof o&&(o=o()),"function"==typeof e.target[a]?e.target[a](o):e.target[a]=o,e.counts[a]>=e.keysAndValues[a].length&&(e.counts[a]=0),e.chose&&e.chose(a,s)}else"function"==typeof e.target[e.key]&&e.target[e.key]();if(t-=r,Array.isArray(e.durations)){var l=e.durations[e.durationsIndex++];e.nextTime="function"==typeof l?l():l,e.chose&&e.chose("durations",e.durationsIndex-1),e.durationsIndex>=e.durations.length&&(e.durationsIndex=0)}else{var l=e.durations;e.nextTime="function"==typeof l?l():l}return e.repeatTarget&&(e.repeatCount++,e.repeatCount===e.repeatTarget&&(e.isRunning=!1,e.repeatCount=0)),0}t+=i}return 0},start:function(e){return e||(t=0),this.isRunning=!0,this},stop:function(){return this.isRunning=!1,this},repeat:function(e){return this.repeatTarget=e,this},shuffle:function(){for(i in this.keysAndValues)this.shuffleArray(this.keysAndValues[i])},shuffleArray:function(e){for(var t,i,n=e.length;n;t=parseInt(Math.random()*n),i=e[--n],e[n]=e[t],e[t]=i);}}),this.init(arguments),this.processProperties(arguments);for(var i in this.keysAndValues)this.counts[i]=0;this.oscillatorInit(),t+=this.offset,this.connect()},Gibberish.Sequencer2.prototype=Gibberish._oscillator,Gibberish.Sequencer=function(){Gibberish.extend(this,{target:null,key:null,values:null,valuesIndex:0,durations:null,durationsIndex:0,nextTime:0,phase:0,isRunning:!1,playOnce:!1,repeatCount:0,repeatTarget:null,isConnected:!0,keysAndValues:null,counts:{},offset:0,name:"seq",tick:function(){if(this.isRunning){if(this.phase>=this.nextTime){if(null!==this.values){if(this.target){var e=this.values[this.valuesIndex++];if("function"==typeof e)try{e=e()}catch(t){console.error("ERROR: Can't execute function triggered by Sequencer:\n"+e.toString()),this.values.splice(this.valuesIndex-1,1),this.valuesIndex--}"function"==typeof this.target[this.key]?this.target[this.key](e):this.target[this.key]=e}else if("function"==typeof this.values[this.valuesIndex])try{this.values[this.valuesIndex++]()}catch(t){console.error("ERROR: Can't execute function triggered by Sequencer:\n"+this.values[this.valuesIndex-1].toString()),this.values.splice(this.valuesIndex-1,1),this.valuesIndex--}this.valuesIndex>=this.values.length&&(this.valuesIndex=0)}else if(null!==this.keysAndValues)for(var i in this.keysAndValues){var n="function"==typeof this.keysAndValues[i].pick?this.keysAndValues[i].pick():this.counts[i]++,e=this.keysAndValues[i][n];if("function"==typeof e)try{e=e()}catch(t){console.error("ERROR: Can't execute function triggered by Sequencer:\n"+e.toString()),this.keysAndValues[i].splice(n,1),"function"!=typeof this.keysAndValues[i].pick&&this.counts[i]--}"function"==typeof this.target[i]?this.target[i](e):this.target[i]=e,this.counts[i]>=this.keysAndValues[i].length&&(this.counts[i]=0)}else"function"==typeof this.target[this.key]&&this.target[this.key]();if(this.phase-=this.nextTime,Array.isArray(this.durations)){var r="function"==typeof this.durations.pick?this.durations[this.durations.pick()]:this.durations[this.durationsIndex++];this.nextTime="function"==typeof r?r():r,this.durationsIndex>=this.durations.length&&(this.durationsIndex=0)}else{var r=this.durations;this.nextTime="function"==typeof r?r():r}return void(this.repeatTarget&&(this.repeatCount++,this.repeatCount===this.repeatTarget&&(this.isRunning=!1,this.repeatCount=0)))}this.phase++}},start:function(e){return e||(this.phase=this.offset),this.isRunning=!0,this},stop:function(){return this.isRunning=!1,this},repeat:function(e){return this.repeatTarget=e,this},shuffle:function(){for(e in this.keysAndValues)this.shuffleArray(this.keysAndValues[e])},shuffleArray:function(e){for(var t,i,n=e.length;n;t=parseInt(Math.random()*n),i=e[--n],e[n]=e[t],e[t]=i);},disconnect:function(){var e=Gibberish.sequencers.indexOf(this);Gibberish.sequencers.splice(e,1),this.isConnected=!1},connect:function(){return-1===Gibberish.sequencers.indexOf(this)&&Gibberish.sequencers.push(this),this.isConnected=!0,this}});for(var e in arguments[0])this[e]=arguments[0][e];for(var e in this.keysAndValues)this.counts[e]=0;this.connect(),this.phase+=this.offset},Gibberish.Sequencer.prototype=Gibberish._oscillator,Gibberish.PolySeq=function(){var e=this,t=0,i=function(e,t){return t>e?-1:e>t?1:0};Gibberish.extend(this,{seqs:[],autofire:[],timeline:{},playOnce:!1,repeatCount:0,repeatTarget:null,isConnected:!1,properties:{rate:1,isRunning:!1,nextTime:0},offset:0,name:"polyseq",getPhase:function(){return t},setPhase:function(e){t=e},adjustPhase:function(e){t+=e},timeModifier:null,add:function(i,n){i.valuesIndex=i.durationsIndex=0,null===i.durations?(i.autofire=!0,e.autofire.push(i)):("undefined"==typeof n?e.seqs.push(i):e.seqs.splice(n,0,i),"undefined"!=typeof e.timeline[t]?i.priority?e.timeline[t].unshift(i):e.timeline[t].push(i):e.timeline[t]=[i],e.nextTime=t),!e.scale||"frequency"!==i.key&&"note"!==i.key||e.applyScale&&e.applyScale(),i.shouldStop=!1},callback:function(n,r,o){var a;if(r){if(t>=o){var s=e.timeline[o],l=t-o;if("undefined"==typeof s)return;for(var u=0;u<s.length;u++){var c=s[u];if(!c.shouldStop){var h=c.values.pick?c.values.pick():c.valuesIndex++%c.values.length,f="function"==typeof c.values?c.values():c.values[h];if("function"==typeof f&&(f=f()),c.target&&("function"==typeof c.target[c.key]?c.target[c.key](f):c.target[c.key]=f),e.chose&&e.chose(c.key,h),Array.isArray(c.durations)){var h=c.durations.pick?c.durations.pick():c.durationsIndex++,p="function"==typeof c.durations?c.durations():c.durations[h];a="function"==typeof p?p():p,"function"!=typeof c.durations&&c.durationsIndex>=c.durations.length&&(c.durationsIndex=0),e.chose&&e.chose("durations",h)}else{var p="function"==typeof c.durations?c.durations():c.durations;a="function"==typeof p?p():p}var d;d=null!==e.timeModifier?e.timeModifier(a)+t:a+t,d-=l,a-=l,"undefined"==typeof e.timeline[d]?e.timeline[d]=[c]:c.priority?e.timeline[d].unshift(c):e.timeline[d].push(c)}}for(var u=0,m=e.autofire.length;m>u;u++){var c=e.autofire[u];if(!c.shouldStop){var h=c.values.pick?c.values.pick():c.valuesIndex++%c.values.length,f=c.values[h];"function"==typeof f&&(f=f()),c.target&&("function"==typeof c.target[c.key]?c.target[c.key](f):c.target[c.key]=f),e.chose&&e.chose(c.key,h)}}delete e.timeline[o];var g=Object.keys(e.timeline),v=g.length;if(v>1){for(var y=0;v>y;y++)g[y]=parseFloat(g[y]);g=g.sort(i),e.nextTime=g[0]}else e.nextTime=parseFloat(g[0])}t+=n}return 0},start:function(e,i){if(e&&this.offset){t=0,this.nextTime=this.offset;var n=""+this.offset;this.timeline={},this.timeline[n]=[];for(var r=0;r<this.seqs.length;r++){var o=this.seqs[r];o.valuesIndex=o.durationsIndex=o.shouldStop=0,this.timeline[n].push(o)}}else{t=0,this.nextTime=0,this.timeline={0:[]};for(var r=0;r<this.seqs.length;r++){var o=this.seqs[r];o.valuesIndex=o.durationsIndex=o.shouldStop=0,this.timeline[0].push(o)}}return this.isConnected||(this.connect(Gibberish.Master,i),this.isConnected=!0),this.isRunning=!0,this},stop:function(){return this.isRunning=!1,this.isConnected&&(this.disconnect(),this.isConnected=!1),this},repeat:function(e){return this.repeatTarget=e,this},shuffle:function(e){if("undefined"!=typeof e)for(var t=0;t<this.seqs.length;t++)this.seqs[t].key===e&&this.shuffleArray(this.seqs[t].values);else for(var t=0;t<this.seqs.length;t++)this.shuffleArray(this.seqs[t].values)},shuffleArray:function(e){for(var t,i,n=e.length;n;t=parseInt(Math.random()*n),i=e[--n],e[n]=e[t],e[t]=i);}}),this.init(arguments),this.processProperties(arguments),this.oscillatorInit()},Gibberish.PolySeq.prototype=Gibberish._oscillator;var _hasInput=!1;return"object"==typeof navigator&&(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia),Gibberish.Input=function(){var e=[];_hasInput||createInput(),this.type=this.name="input",this.fx=new Array2,this.fx.parent=this,this.properties={input:"input",amp:.5,channels:1},this.callback=function(t,i,n){return 1===n?e=t*i:(e[0]=t[0]*i,e[1]=t[1]*i),e},this.init(arguments),this.processProperties(arguments)},Gibberish.Input.prototype=new Gibberish.ugen,Gibberish.Kick=function(){var e=!1,t=(new Gibberish.SVF).callback,i=(new Gibberish.SVF).callback,n=.2,r=.8;Gibberish.extend(this,{name:"kick",properties:{pitch:50,__decay:20,__tone:1e3,amp:2,sr:Gibberish.context.sampleRate},callback:function(n,r,o,a,s){var l=e?60:0;return l=t(l,n,r,2,s),l=i(l,o,.5,0,s),l*=a,e=!1,l},note:function(t,i,n,r){"number"==typeof t&&(this.pitch=t),"number"==typeof i&&(this.decay=i),"number"==typeof n&&(this.tone=n),"number"==typeof r&&(this.amp=r),e=!0}}).init().oscillatorInit(),Object.defineProperties(this,{decay:{get:function(){return n},set:function(e){n=e>1?1:e,this.__decay=100*n}},tone:{get:function(){return r},set:function(e){r=e>1?1:e,this.__tone=220+1400*e}}}),this.processProperties(arguments)},Gibberish.Kick.prototype=Gibberish._oscillator,Gibberish.Conga=function(){var e=!1,t=(new Gibberish.SVF).callback;Gibberish.extend(this,{name:"conga",properties:{pitch:190,amp:2,sr:Gibberish.context.sampleRate},callback:function(i,n,r){var o=e?60:0;return o=t(o,i,50,2,r),o*=n,e=!1,o},note:function(t,i){"number"==typeof t&&(this.pitch=t),"number"==typeof i&&(this.amp=i),e=!0}}).init().oscillatorInit(),this.processProperties(arguments)},Gibberish.Conga.prototype=Gibberish._oscillator,Gibberish.Clave=function(){var e=!1,t=new Gibberish.SVF,i=t.callback;Gibberish.extend(this,{name:"clave",properties:{pitch:2500,amp:1,sr:Gibberish.context.sampleRate},callback:function(t,n,r){var o=e?2:0;return o=i(o,t,5,2,r),o*=n,e=!1,o},note:function(t,i){"number"==typeof t&&(this.pitch=t),"number"==typeof i&&(this.amp=i),e=!0}}).init().oscillatorInit(),this.bpf=t,this.processProperties(arguments)},Gibberish.Clave.prototype=Gibberish._oscillator,Gibberish.Tom=function(){var e=!1,t=(new Gibberish.SVF).callback,i=(new Gibberish.SVF).callback,n=new Gibberish.ExponentialDecay,r=n.callback,o=Math.random;Gibberish.extend(this,{name:"tom",properties:{pitch:80,amp:.5,sr:Gibberish.context.sampleRate},callback:function(n,a,s){var l,u=e?60:0;return u=t(u,n,30,2,s),l=16*o()-8,l=l>0?l:0,l*=r(.05,11025),l=i(l,120,.5,0,s),u+=l,u*=a,e=!1,u},note:function(t,i){"number"==typeof t&&(this.pitch=t),"number"==typeof i&&(this.amp=i),n.trigger(),e=!0}}).init().oscillatorInit(),n.trigger(1),this.processProperties(arguments)},Gibberish.Tom.prototype=Gibberish._oscillator,Gibberish.Clap=function(){var e=new Gibberish.Biquad,t=e.callback,i=new Gibberish.Biquad,n=i.callback,r=new Gibberish.Biquad,o=r.callback,a=new Gibberish.ExponentialDecay,s=a.callback,l=new Gibberish.ExponentialDecay,u=l.callback,c=new Gibberish.Line,h=(c.callback,new Gibberish.Saw),f=h.callback,p=Math.random,d=1e3,m=2.5,g=.025,v=.9,y=1323,b=660,x=100;e.mode=i.mode="BP",r.mode="BP",r.cutoff=2400,e.cutoff=i.cutoff=1e3,e.Q=2,i.Q=1,Gibberish.extend(this,{name:"clap",properties:{amp:.5,sr:Gibberish.context.sampleRate},callback:function(e){var i,r,a=0;return i=4*p()-2,i=i>0?i:0,r=4*p()-2,r=r>0?r:0,a=n(t(i)),a*=u(v,b),r=o(f(x,r)*s(g,y)),a+=r,a*=e},note:function(e){"number"==typeof e&&(this.amp=e),l.trigger(),a.trigger(),c.setPhase(0),h.setPhase(0)}}).init().oscillatorInit(),this.getBPF=function(){return e},this.getBPF2=function(){return i},this.getBPF3=function(){return r},this.getLine=function(){return c},this.setEnvK=function(e,t,i,n){g=e,t&&(v=t),i&&(y=i),n&&(b=n)},this.setFreq=function(e){x=e},this.setRez=function(e){m=e},this.setCutoff=function(e){d=e},this.processProperties(arguments)},Gibberish.Clap.prototype=Gibberish._oscillator,Gibberish.Cowbell=function(){var e=new Gibberish.Square,t=new Gibberish.Square,i=e.callback,n=t.callback,r=new Gibberish.SVF({mode:2}),o=r.callback,a=new Gibberish.ExponentialDecay(.0025,10500),s=a.callback;Gibberish.extend(this,{name:"cowbell",properties:{amp:1,pitch:560,bpfFreq:1e3,bpfRez:3,decay:22050,decayCoeff:1e-4,sr:Gibberish.context.sampleRate},callback:function(e,t,r,a,l,u,c){var h;return h=i(t,1,1,0),h+=n(845,1,1,0),h=o(h,r,a,2,c),h*=s(u,l),h*=e},note:function(e){a.trigger(),e&&(this.decay=e)}}).init().oscillatorInit().processProperties(arguments),this.bpf=r,this.eg=a,a.trigger(1)},Gibberish.Cowbell.prototype=Gibberish._oscillator,Gibberish.Snare=function(){var e=(new Gibberish.SVF).callback,t=(new Gibberish.SVF).callback,i=(new Gibberish.SVF).callback,n=new Gibberish.ExponentialDecay(.0025,11025),r=n.callback,o=Math.random,a=0;Gibberish.extend(this,{name:"snare",properties:{cutoff:1e3,decay:11025,tune:0,snappy:.5,amp:1,sr:Gibberish.context.sampleRate},callback:function(n,s,l,u,c,h){var f,p,d=0,m=0;return d=r(.0025,s),d>.005&&(m=(2*o()-1)*d,m=i(m,n+1e3*l,.5,1,h),m*=u,m=m>0?m:0,a=d,f=e(a,180*(l+1),15,2,h),p=t(a,330*(l+1),15,2,h),m+=f,m+=.8*p,m*=c),m},note:function(e,t,i,r){"number"==typeof e&&(this.tune=e),"number"==typeof r&&(this.cutoff=r),"number"==typeof i&&(this.snappy=i),"number"==typeof t&&(this.amp=t),n.trigger()}}).init().oscillatorInit().processProperties(arguments),n.trigger(1)},Gibberish.Snare.prototype=Gibberish._oscillator,Gibberish.Hat=function(){{var e=new Gibberish.Square,t=new Gibberish.Square,i=new Gibberish.Square,n=new Gibberish.Square,r=new Gibberish.Square,o=new Gibberish.Square,a=e.callback,s=t.callback,l=i.callback,u=n.callback,c=r.callback,h=o.callback,f=new Gibberish.SVF({mode:2}),p=f.callback,d=new Gibberish.Filter24,m=d.callback,g=new Gibberish.ExponentialDecay(.0025,10500),v=g.callback,y=new Gibberish.ExponentialDecay(.1,7500);y.callback}Gibberish.extend(this,{name:"hat",properties:{amp:1,pitch:325,bpfFreq:7e3,bpfRez:2,hpfFreq:.975,hpfRez:0,decay:3500,decay2:3e3,sr:Gibberish.context.sampleRate},callback:function(e,t,i,n,r,o,f,d,g){var y;return y=a(t,1,.5,0),y+=s(1.4471*t,.75,1,0),y+=l(1.617*t,1,1,0),y+=u(1.9265*t,1,1,0),y+=c(2.5028*t,1,1,0),y+=h(2.6637*t,.75,1,0),y=p(y,i,n,2,g),y*=v(.001,f),y=m(y,r,o,0,1),y*=e},note:function(e,t){g.trigger(),y.trigger(),e&&(this.decay=e),t&&(this.decay2=t)}}).init().oscillatorInit().processProperties(arguments),this.bpf=f,this.hpf=d,g.trigger(1),y.trigger(1)},Gibberish.Hat.prototype=Gibberish._oscillator,function(){var e={Soundfont:{instruments:{}}},t=e.Soundfont;"object"==typeof window?window.GenMIDI=e:global.GenMIDI=e;var i=function(e,t){function i(i){console.log("COMPLETE",e,i);var n=document.createElement("script");n.innerHTML=i.srcElement?i.srcElement.responseText:i.target.responseText,n.onload=t,document.querySelector("head").appendChild(n)}var n=new XMLHttpRequest;n.addEventListener("load",i,!1),n.addEventListener("error",function(e){console.log("SF load error",e)},!1),n.open("GET",e,!0),n.send()},n={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",decodeArrayBuffer:function(e){var t=e.length/4*3,i=new ArrayBuffer(t);return this.decode(e,i),i},decode:function(e,t){var i=this._keyStr.indexOf(e.charAt(e.length-1)),n=this._keyStr.indexOf(e.charAt(e.length-2)),r=e.length/4*3;64==i&&r--,64==n&&r--;var o,a,s,l,u,c,h,f,p=0,d=0;for(o=new Uint8Array(t?t:r),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,""),p=0;r>p;p+=3)u=this._keyStr.indexOf(e.charAt(d++)),c=this._keyStr.indexOf(e.charAt(d++)),h=this._keyStr.indexOf(e.charAt(d++)),f=this._keyStr.indexOf(e.charAt(d++)),a=u<<2|c>>4,s=(15&c)<<4|h>>2,l=(3&h)<<6|f,o[p]=a,64!=h&&(o[p+1]=s),64!=f&&(o[p+2]=l);return o}},r=function(e){console.log("DECODING BUFFERS...",e);var i=0,r=t[e.instrumentFileName];"undefined"==typeof t.instruments[e.instrumentFileName]&&(t.instruments[e.instrumentFileName]={}),e.buffers=t.instruments[e.instrumentFileName];for(var o in r)i++,!function(){var a=o,s=r[a].split(",")[1],l=n.decodeArrayBuffer(s);Gibberish.context.decodeAudioData(l,function(n){t.instruments[e.instrumentFileName][a]=n.getChannelData(0),i--,0>=i&&(console.log("Soundfont "+e.instrumentFileName+" is loaded."),e.isLoaded=!0,e.onload&&e.onload())},function(e){console.log("ERROR",e.err,arguments,a)})}()};Gibberish.SoundFont=function(e,n){Gibberish.extend(this,{instrumentFileName:e,name:"soundfont",properties:{amp:1,pan:0},playing:[],buffers:{},onload:null,out:[0,0],isLoaded:!1,resourcePath:n||"./resources/soundfonts/",callback:function(e,t){for(var i=0,n=this.playing.length-1;n>=0;n--){var r=this.playing[n];i+=this.interpolate(r.buffer,r.phase)*r.velocity,r.phase+=r.increment,r.phase>r.length&&this.playing.splice(this.playing.indexOf(r),1)}return this.panner(i*e,t,this.out)}.bind(this),note:function(e,t,i){this.isLoaded&&this.playing.push({buffer:this.buffers[e],phase:0,increment:isNaN(i)?1:1+i,length:this.buffers[e].length,velocity:isNaN(t)?1:t})},interpolate:Gibberish.interpolate.bind(this),panner:Gibberish.makePanner()}).init().oscillatorInit(),"object"==typeof arguments[0]&&arguments[0].instrumentFileName&&(this.instrumentFileName=arguments[0].instrumentFileName);var o=this;return t.instruments[this.instrumentFileName]||"object"==typeof this.resourcePath?"object"==typeof n?(t[this.instrumentFileName]=n,r(this)):(this.buffers=t.instruments[this.instrumentFileName],this.isLoaded=!0,setTimeout(function(){this.onload&&this.onload()}.bind(this),0)):(console.log("DOWNLOADING SOUNDFONT"),i(this.resourcePath+this.instrumentFileName+"-mp3.js",function(){r(o)})),this},Gibberish.SoundFont.storage=t,Gibberish.SoundFont.prototype=Gibberish._oscillator}(),Gibberish.Vocoder=function(){var e=[],t=[],i=Math.abs,n=(Math.sqrt,[0,0]),r=[],o=[],a=128,s=[],l=[],u=[],c=0,h=arguments[3]||330,f=arguments[4]||3200,p=arguments[2]||16,d=arguments[5]||.15;this.name="vocoder",this.properties={carrier:arguments[0]||null,modulator:arguments[1]||null,amp:1,pan:0};for(var m=1200*Math.log(f/h)/Math.LN2,g=m/p,v=Math.pow(2,g/1200),y=h,b=0;p>b;b++)r[b]=new Gibberish.Biquad({mode:"BP",Q:d,cutoff:y}),e[b]=r[b].callback,o[b]=new Gibberish.Biquad({mode:"BP",Q:d,cutoff:y}),t[b]=o[b].callback,s[b]=[0],l[b]=0,u[b]=0,y*=v;this.callback=function(r,o,h){for(var f,d=(c+1)%a,m="number"!=typeof o?o[0]+o[1]:o,g="number"!=typeof r?r[0]+r[1]:r,v=0,y=0;p>y;y++)f=i(e[y](m)),l[y]+=f,l[y]-=s[y][c],s[y][c]=f,s[y][d]=s[y][d]?s[y][d]:0,u[y]=l[y]/a,v+=t[y](g)*u[y];return c=d,n[0]=n[1]=v*h*16,n},this.getEncoders=function(){return r},this.getDecoders=function(){return o},this.init(),this.oscillatorInit()},Gibberish.Vocoder.prototype=Gibberish._synth,Gibberish})}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(_dereq_,module,exports){!function(){var freesound=module.exports={BASE_URI:"http://www.freesound.org/api",apiKey:"",debug:!1,_URI_SOUND:"/sounds/<sound_id>/",_URI_SOUND_ANALYSIS:"/sounds/<sound_id>/analysis/",_URI_SOUND_ANALYSIS_FILTER:"/sounds/<sound_id>/analysis/<filter>",_URI_SIMILAR_SOUNDS:"/sounds/<sound_id>/similar/",_URI_SEARCH:"/sounds/search/",_URI_CONTENT_SEARCH:"/sounds/content_search/",_URI_GEOTAG:"/sounds/geotag",_URI_USER:"/people/<user_name>/",_URI_USER_SOUNDS:"/people/<user_name>/sounds/",_URI_USER_PACKS:"/people/<user_name>/packs/",_URI_USER_BOOKMARKS:"/people/<username>/bookmark_categories",_URI_BOOKMARK_CATEGORY_SOUNDS:"/people/<username>/bookmark_categories/<category_id>/sounds",_URI_PACK:"/packs/<pack_id>/",_URI_PACK_SOUNDS:"/packs/<pack_id>/sounds/",_make_uri:function(e,t){for(var i in t)e=e.replace(/<[\w_]+>/,t[i]);return this.BASE_URI+e},_make_request:function(uri,success,error,params,wrapper){var fs=this;-1==uri.indexOf("?")&&(uri+="?"),uri=uri+"&api_key="+this.apiKey;for(var p in params)uri=uri+"&"+p+"="+params[p];var xhr;try{xhr=new XMLHttpRequest}catch(e){xhr=new ActiveXObject("Microsoft.XMLHTTP")}xhr.onreadystatechange=function(){if(4==xhr.readyState&&200==xhr.status){var data=eval("("+xhr.responseText+")");success(wrapper?wrapper(data):data)}else 4==xhr.readyState&&200!=xhr.status&&error()},freesound.debug&&console.log(uri),xhr.open("GET",uri),xhr.send(null)},_make_sound_object:function(e){return e.get_analysis=function(t,i,n,r){var o=i?freesound._URI_SOUND_ANALYSIS_FILTER:freesound._URI_SOUND_ANALYSIS;freesound._make_request(freesound._make_uri(o,[e.id,i?i:""]),n,r)},e.get_similar_sounds=function(t,i){freesound._make_request(freesound._make_uri(freesound._URI_SIMILAR_SOUNDS,[e.id]),t,i,{},this._make_sound_collection_object)},e},_make_sound_collection_object:function(e){var t=function(e,t,i){freesound._make_request(e,t,i,{},this._make_sound_collection_object)};return e.next_page=function(e,i){t(this.next,e,i)},e.previous_page=function(e,i){t(this.previous,e,i)},e},_make_user_object:function(e){return e.get_sounds=function(t,i){freesound._make_request(freesound._make_uri(freesound._URI_USER_SOUNDS,[e.username]),t,i,{},this._make_sound_collection_object)},e.get_packs=function(t,i){freesound._make_request(freesound._make_uri(freesound._URI_USER_PACKS,[e.username]),t,i,{},this._make_pack_collection_object)},e.get_bookmark_categories=function(t,i){freesound._make_request(freesound._make_uri(freesound._URI_USER_BOOKMARKS,[e.username]),t,i)},e.get_bookmark_category_sounds=function(e,t,i){freesound._make_request(e,t,i)},e},_make_pack_object:function(e){return e.get_sounds=function(t,i){freesound._make_request(freesound._make_uri(freesound._URI_PACK_SOUNDS,[e.id]),t,i,{},this._make_sound_collection_object)},e},_make_pack_collection_object:function(e){var t=function(e,t,i){freesound._make_request(e,t,i,{},this._make_pack_collection_object)};return e.next_page=function(e,i){t(this.next,e,i)},e.previous_page=function(e,i){t(this.previous,e,i)},e},get_from_ref:function(e,t,i){this._make_request(e,t,i,{})},get_sound:function(e,t,i){this._make_request(this._make_uri(this._URI_SOUND,[e]),t,i,{},this._make_sound_object)},get_user:function(e,t,i){this._make_request(this._make_uri(this._URI_USER,[e]),t,i,{},this._make_user_object)},get_pack:function(e,t,i){this._make_request(this._make_uri(this._URI_PACK,[e]),t,i,{},this._make_pack_object)},quick_search:function(e,t,i){this.search(e,0,null,null,t,i)},search:function(e,t,i,n,r,o,a,s,l){var u={q:e?e:" "};t&&(u.p=t),i&&(u.f=i),n&&(u.s=n),r&&(u.num_results=r),a&&(u.sounds_per_page=a),o&&(u.fields=o),this._make_request(this._make_uri(this._URI_SEARCH),s,l,u,this._make_sound_collection_object)},content_based_search:function(e,t,i,n,r,o,a,s){var l={};r&&(l.p=r),t&&(l.f=t),e&&(l.t=e),i&&(l.max_results=i),o&&(l.sounds_per_page=o),n&&(l.fields=n),this._make_request(this._make_uri(this._URI_CONTENT_SEARCH),a,s,l,this._make_sound_collection_object)},geotag:function(e,t,i,n,r,o,a,s,l){var u={};e&&(u.min_lat=e),t&&(u.max_lat=t),i&&(u.min_lon=i),n&&(u.max_lon=n),r&&(u.p=r),a&&(u.sounds_per_page=a),o&&(u.fields=o),this._make_request(this._make_uri(this._URI_GEOTAG),s,l,u,this._make_sound_collection_object)}}}()},{}],3:[function(_dereq_,module,exports){!function(){var freesound=function(){var authHeader="",clientId="",clientSecret="",host="freesound.org",uris={base:"https://"+host+"/apiv2",textSearch:"/search/text/",contentSearch:"/search/content/",combinedSearch:"/sounds/search/combined/",sound:"/sounds/<sound_id>/",soundAnalysis:"/sounds/<sound_id>/analysis/",similarSounds:"/sounds/<sound_id>/similar/",comments:"/sounds/<sound_id>/comments/",download:"/sounds/<sound_id>/download/",upload:"/sounds/upload/",describe:"/sounds/<sound_id>/describe/",pending:"/sounds/pending_uploads/",bookmark:"/sounds/<sound_id>/bookmark/",rate:"/sounds/<sound_id>/rate/",comment:"/sounds/<sound_id>/comment/",authorize:"/oauth2/authorize/",logout:"/api-auth/logout/",logoutAuthorize:"/oauth2/logout_and_authorize/",me:"/me/",user:"/users/<username>/",userSounds:"/users/<username>/sounds/",userPacks:"/users/<username>/packs/",userBookmarkCategories:"/users/<username>/bookmark_categories/",userBookmarkCategorySounds:"/users/<username>/bookmark_categories/<category_id>/sounds/",pack:"/packs/<pack_id>/",packSounds:"/packs/<pack_id>/sounds/",packDownload:"/packs/<pack_id>/download/"},makeUri=function(e,t){for(var i in t)e=e.replace(/<[\w_]+>/,t[i]);return uris.base+e},makeRequest=function(uri,success,error,params,wrapper,method,data,content_type){void 0===method&&(method="GET"),error||(error=function(e){console.log(e)}),params=params||{},params.format="json";var fs=this,parse_response=function(response){var data=eval("("+response+")");success(wrapper?wrapper(data):data)},paramStr="";for(var p in params)paramStr=paramStr+"&"+p+"="+params[p];if(paramStr&&(uri=uri+"?"+paramStr),"undefined"!=typeof module){var http=_dereq_("http"),options={host:host,path:uri.substring(uri.indexOf("/",8),uri.length),port:"80",method:method,headers:{Authorization:authHeader},withCredentials:!1},req=http.request(options,function(e){e.on("data",function(t){[200,201,202].indexOf(e.statusCode)>=0?success(wrapper?wrapper(t):t):error(t)})});req.on("error",error).end()}else{var xhr;try{xhr=new XMLHttpRequest}catch(e){xhr=new ActiveXObject("Microsoft.XMLHTTP")}xhr.onreadystatechange=function(){if(4===xhr.readyState&&[200,201,202].indexOf(xhr.status)>=0){var data=eval("("+xhr.responseText+")");success&&success(wrapper?wrapper(data):data)}else 4===xhr.readyState&&200!==xhr.status&&error&&error(xhr.statusText)},xhr.open(method,uri),xhr.setRequestHeader("Authorization",authHeader),void 0!==content_type&&xhr.setRequestHeader("Content-Type",content_type),xhr.send(data)}},checkOauth=function(){if(-1==authHeader.indexOf("Bearer"))throw"Oauth authentication required"},makeFD=function(e,t){t||(t=new FormData);for(var i in e)t.append(i,e[i]);return t},search=function(e,t,i,n,r){e.analysis_file?makeRequest(makeUri(t),i,n,null,r,"POST",makeFD(e)):makeRequest(makeUri(t),i,n,e,r)},Collection=function(e){var t=function(e,t,i){makeRequest(e,t,i,{},Collection)};return e.nextPage=function(i,n){t(e.next,i,n)},e.previousPage=function(i,n){t(e.previous,i,n)},e.getItem=function(t){return e.results[t]},e},SoundCollection=function(e){var t=Collection(e);return t.getSound=function(e){return new SoundObject(t.results[e])},t},PackCollection=function(e){var t=Collection(e);return t.getPack=function(e){return new PackObject(t.results[e])},t},SoundObject=function(e){return e.getAnalysis=function(t,i,n,r){makeRequest(makeUri(uris.soundAnalysis,[e.id,t?t:""]),i,n)},e.getSimilar=function(t,i,n){makeRequest(makeUri(uris.similarSounds,[e.id]),t,i,n,SoundCollection)},e.getComments=function(t,i){makeRequest(makeUri(uris.comments,[e.id]),t,i,{},Collection)},e.download=function(t){checkOauth();var i=makeUri(uris.download,[e.id]);t.location=i},e.comment=function(t,i,n){checkOauth();var r=new FormData;r.append("comment",comment);var o=makeUri(uris.comment,[e.id]);makeRequest(o,i,n,{},null,"POST",r)},e.rate=function(t,i,n){checkOauth();var r=new FormData;r.append("rating",t);var o=makeUri(uris.rate,[e.id]);makeRequest(o,i,n,{},null,"POST",r)},e.bookmark=function(t,i,n,r){checkOauth();var o=new FormData;o.append("name",t),i&&o.append("category",i);var a=makeUri(uris.bookmark,[e.id]);makeRequest(a,n,r,{},null,"POST",o)},e.edit=function(t,i,n){checkOauth();var r=makeFD(t),o=makeUri(uris.edit,[e.id]);makeRequest(o,i,n,{},null,"POST",r)},e},UserObject=function(e){return e.sounds=function(t,i,n){var r=makeUri(uris.userSounds,[e.username]);makeRequest(r,t,i,n,SoundCollection)},e.packs=function(t,i){var n=makeUri(uris.userPacks,[e.username]);makeRequest(n,t,i,{},PackCollection)},e.bookmarkCategories=function(t,i){var n=makeUri(uris.userBookmarkCategories,[e.username]);makeRequest(n,t,i)},e.bookmarkCategorySounds=function(t,i,n){var r=makeUri(uris.userBookmarkCategorySounds,[e.username]);makeRequest(r,t,i,n)},e},PackObject=function(e){return e.sounds=function(t,i){var n=makeUri(uris.packSounds,[e.id]);makeRequest(n,t,i,{},SoundCollection)},e.download=function(t){checkOauth();var i=makeUri(uris.packDownload,[e.id]);t.location=i},e};return{setToken:function(e,t){authHeader=("oauth"===t?"Bearer ":"Token ")+e},setClientSecrets:function(e,t){clientId=e,clientSecret=t},postAccessCode:function(e,t,i){var n=uris.base+"/oauth2/access_token/",r=new FormData;r.append("client_id",clientId),r.append("client_secret",clientSecret),r.append("code",e),r.append("grant_type","authorization_code"),t||(t=function(e){setToken(e.access_token,"oauth")}),makeRequest(n,t,i,{},null,"POST",r)},textSearch:function(e,t,i,n){t=t||{},t.query=e?e:" ",search(t,uris.textSearch,i,n,SoundCollection)},contentSearch:function(e,t,i){if(!e.target&&!e.analysis_file)throw"Missing target or analysis_file";search(e,uris.contentSearch,t,i,SoundCollection)},combinedSearch:function(e,t,i){if(!(e.target||e.analysis_file||e.query))throw"Missing query, target or analysis_file";search(e,uris.contentSearch,t,i)},getSound:function(e,t,i){makeRequest(makeUri(uris.sound,[e]),t,i,{},SoundObject)},upload:function(e,t,i,n,r){checkOauth();var o=new FormData;o.append("audiofile",e,t),i&&(o=makeFD(i,o)),makeRequest(makeUri(uris.upload),n,r,{},null,"POST",o)},describe:function(e,t,i,n,r,o){checkOauth();var a=makeFD(t);makeRequest(makeUri(uris.upload),r,o,{},null,"POST",a)},getPendingSounds:function(e,t){checkOauth(),makeRequest(makeUri(uris.pending),e,t,{})},me:function(e,t){checkOauth(),makeRequest(makeUri(uris.me),e,t)},getLoginURL:function(){if(void 0===clientId)throw"client_id was not set";var e=makeUri(uris.authorize);return e+="?client_id="+clientId+"&response_type=code"},getLogoutURL:function(){var e=makeUri(uris.logoutAuthorize);
return e+="?client_id="+clientId+"&response_type=code"},getUser:function(e,t,i){makeRequest(makeUri(uris.user,[e]),t,i,{},UserObject)},getPack:function(e,t,i){makeRequest(makeUri(uris.pack,[e]),t,i,{},PackObject)}}};"undefined"!=typeof module?module.exports=freesound():"function"==typeof define&&"object"==typeof define.amd?define("freesound",[],freesound):this.freesound=freesound()}()},{http:74}],4:[function(e,t){!function(){function e(e,t){return e=a[e],t=a[t],e.distance>t.distance?t.distance+12-e.distance:t.distance-e.distance}function i(e,t,i){for(;i>0;i--)e+=t;return e}function n(e,t){if("string"!=typeof e)return null;this.name=e,this.duration=t||4,this.accidental={value:0,sign:""};var i=e.match(/^([abcdefgh])(x|#|bb|b?)(-?\d*)/i);if(i&&e===i[0]&&0!==i[3].length)this.name=i[1].toLowerCase(),this.octave=parseFloat(i[3]),0!==i[2].length&&(this.accidental.sign=i[2].toLowerCase(),this.accidental.value=y[i[2]]);else{e=e.replace(/\u2032/g,"'").replace(/\u0375/g,",");var n=e.match(/^(,*)([abcdefgh])(x|#|bb|b?)([,\']*)$/i);if(!n||5!==n.length||e!==n[0])throw Error("Invalid note format");if(""===n[1]&&""===n[4])this.octave=n[2]===n[2].toLowerCase()?3:2;else if(""!==n[1]&&""===n[4]){if(n[2]===n[2].toLowerCase())throw Error("Invalid note format. Format must respect the Helmholtz notation.");this.octave=2-n[1].length}else{if(""!==n[1]||""===n[4])throw Error("Invalid note format");if(n[4].match(/^'+$/)){if(n[2]===n[2].toUpperCase())throw Error("Invalid note format. Format must respect the Helmholtz notation");this.octave=3+n[4].length}else{if(!n[4].match(/^,+$/))throw Error("Invalid characters after note name.");if(n[2]===n[2].toLowerCase())throw Error("Invalid note format. Format must respect the Helmholtz notation");this.octave=2-n[4].length}}this.name=n[2].toLowerCase(),0!==n[3].length&&(this.accidental.sign=n[3].toLowerCase(),this.accidental.value=y[n[3]])}}function r(e,t){if(!(e instanceof n))return null;t=t||"",this.name=e.name.toUpperCase()+e.accidental.sign+t,this.root=e,this.notes=[e],this.quality="major",this.type="major";var i,r,a,s,l,u=[],c=!1,f="quality",p=!1,d=!1,g=null;for(s=0,l=t.length;l>s;s++){for(i=t[s];" "===i||"("===i||")"===i;)i=t[++s];if(!i)break;if(r=i.charCodeAt(0),a=l>=s+3?t.substr(s,3):"","quality"===f)"M"===i||("maj"===a||916===r?(this.type="major",u.push("M7"),c=!0,(t[s+3]&&"7"===t[s+3]||916===r&&"7"===t[s+1])&&s++):"m"===i||"-"===i||"min"===a?this.quality=this.type="minor":111===r||176===r||"dim"===a?(this.quality="minor",this.type="diminished"):"+"===i||"aug"===a?(this.quality="major",this.type="augmented"):216===r||248===r?(this.quality="minor",this.type="diminished",u.push("m7"),c=!0):"sus"===a?(this.quality="sus",this.type=t[s+3]&&"2"===t[s+3]?"sus2":"sus4"):"5"===i?(this.quality="power",this.type="power"):s-=1),a in h&&(s+=2),f="";else if("#"===i)p=!0;else if("b"===i)d=!0;else if("5"===i)p?(g="A5","major"===this.quality&&(this.type="augmented")):d&&(g="d5","minor"===this.quality&&(this.type="diminished")),d=p=!1;else if("6"===i)u.push("M6"),d=p=!1;else if("7"===i)u.push("diminished"===this.type?"d7":"m7"),c=!0,d=p=!1;else if("9"===i)c||u.push("m7"),u.push(d?"m9":p?"A9":"M9"),d=p=!1;else{if("1"!==i)throw Error("Unexpected character: '"+i+"' in chord name");i=t[++s],"1"===i?u.push(d?"d11":p?"A11":"P11"):"3"===i&&u.push(d?"m13":p?"A13":"M13"),d=p=!1}}for(var v=0,y=m[this.type].length;y>v;v++)this.notes.push("5"===m[this.type][v][1]&&g?o.interval(this.root,g):o.interval(this.root,m[this.type][v]));for(v=0,y=u.length;y>v;v++)this.notes.push(o.interval(this.root,u[v]))}var o={},a={c:{name:"c",distance:0,index:0},d:{name:"d",distance:2,index:1},e:{name:"e",distance:4,index:2},f:{name:"f",distance:5,index:3},g:{name:"g",distance:7,index:4},a:{name:"a",distance:9,index:5},b:{name:"b",distance:11,index:6},h:{name:"h",distance:11,index:6}},s=["c","d","e","f","g","a","b"],l={.25:"longa",.5:"breve",1:"whole",2:"half",4:"quarter",8:"eighth",16:"sixteenth",32:"thirty-second",64:"sixty-fourth",128:"hundred-twenty-eighth"},u=[{name:"unison",quality:"perfect",size:0},{name:"second",quality:"minor",size:1},{name:"third",quality:"minor",size:3},{name:"fourth",quality:"perfect",size:5},{name:"fifth",quality:"perfect",size:7},{name:"sixth",quality:"minor",size:8},{name:"seventh",quality:"minor",size:10},{name:"octave",quality:"perfect",size:12},{name:"ninth",quality:"minor",size:13},{name:"tenth",quality:"minor",size:15},{name:"eleventh",quality:"perfect",size:17},{name:"twelfth",quality:"perfect",size:19},{name:"thirteenth",quality:"minor",size:20},{name:"fourteenth",quality:"minor",size:22},{name:"fifteenth",quality:"perfect",size:24}],c={unison:0,second:1,third:2,fourth:3,fifth:4,sixth:5,seventh:6,octave:7,ninth:8,tenth:9,eleventh:10,twelfth:11,thirteenth:12,fourteenth:13,fifteenth:14},h={P:"perfect",M:"major",m:"minor",A:"augmented",d:"diminished",perf:"perfect",maj:"major",min:"minor",aug:"augmented",dim:"diminished"},f={perfect:"P",major:"M",minor:"m",augmented:"A",diminished:"d"},p={P:"P",M:"m",m:"M",A:"d",d:"A"},d={perfect:["diminished","perfect","augmented"],minor:["diminished","minor","major","augmented"]},m={major:["M3","P5"],minor:["m3","P5"],augmented:["M3","A5"],diminished:["m3","d5"],sus2:["M2","P5"],sus4:["P4","P5"],power:["P5"]},g={major:"M",minor:"m",augmented:"aug",diminished:"dim",power:"5"},v={"-2":"bb","-1":"b",0:"",1:"#",2:"x"},y={bb:-2,b:-1,"#":1,x:2};n.prototype={key:function(e){return e?7*(this.octave-1)+3+Math.ceil(a[this.name].distance/2):12*(this.octave-1)+4+a[this.name].distance+this.accidental.value},fq:function(e){return e=e||440,e*Math.pow(2,(this.key()-49)/12)},scale:function(e,t){return o.scale.list(this,e,t)},interval:function(e,t){return o.interval(this,e,t)},chord:function(e){return e=e||"major",e in g&&(e=g[e]),new r(this,e)},helmholtz:function(){var e,t=3>this.octave?this.name.toUpperCase():this.name.toLowerCase();return 2>=this.octave?(e=i("",",",2-this.octave),e+t+this.accidental.sign):(e=i("","'",this.octave-3),t+this.accidental.sign+e)},scientific:function(){return this.name.toUpperCase()+this.accidental.sign+("number"==typeof this.octave?this.octave:"")},enharmonics:function(){var e=[],t=this.key(),i=this.interval("m2","up"),n=this.interval("m2","down"),r=i.key()-i.accidental.value,o=n.key()-n.accidental.value,a=t-r;return 3>a&&a>-3&&(i.accidental={value:a,sign:v[a]},e.push(i)),a=t-o,3>a&&a>-3&&(n.accidental={value:a,sign:v[a]},e.push(n)),e},valueName:function(){return l[this.duration]},toString:function(e){return e="boolean"==typeof e?e:"number"==typeof this.octave?!1:!0,this.name.toLowerCase()+this.accidental.sign+(e?"":this.octave)}},r.prototype.dominant=function(e){return e=e||"",new r(this.root.interval("P5"),e)},r.prototype.subdominant=function(e){return e=e||"",new r(this.root.interval("P4"),e)},r.prototype.parallel=function(e){if(e=e||"","triad"!==this.chordType()||"diminished"===this.quality||"augmented"===this.quality)throw Error("Only major/minor triads have parallel chords");return"major"===this.quality?new r(this.root.interval("m3","down"),"m"):new r(this.root.interval("m3","up"))},r.prototype.chordType=function(){var e,t,i;if(2===this.notes.length)return"dyad";if(3===this.notes.length){t={unison:!1,third:!1,fifth:!1};for(var n=0,r=this.notes.length;r>n;n++)e=this.root.interval(this.notes[n]),i=u[parseFloat(o.interval.invert(e.simple)[1])-1],e.name in t?t[e.name]=!0:i.name in t&&(t[i.name]=!0);return t.unison&&t.third&&t.fifth?"triad":"trichord"}if(4===this.notes.length){t={unison:!1,third:!1,fifth:!1,seventh:!1};for(var n=0,r=this.notes.length;r>n;n++)e=this.root.interval(this.notes[n]),i=u[parseFloat(o.interval.invert(e.simple)[1])-1],e.name in t?t[e.name]=!0:i.name in t&&(t[i.name]=!0);if(t.unison&&t.third&&t.fifth&&t.seventh)return"tetrad"}return"unknown"},r.prototype.toString=function(){return this.name},o.note=function(e,t){return new n(e,t)},o.note.fromKey=function(e){var t=440*Math.pow(2,(e-49)/12);return o.frequency.note(t).note},o.chord=function(e){var t;if(t=e.match(/^([abcdefgh])(x|#|bb|b?)/i),t&&t[0])return new r(new n(t[0].toLowerCase()),e.substr(t[0].length));throw Error("Invalid Chord. Couldn't find note name")},o.frequency={note:function(e,t){t=t||440;var i,r,o,l,u,c,h;return i=Math.round(49+12*((Math.log(e)-Math.log(t))/Math.log(2))),h=t*Math.pow(2,(i-49)/12),c=1200*(Math.log(e/h)/Math.log(2)),r=Math.floor((i-4)/12),o=i-12*r-4,l=a[s[Math.round(o/2)]],u=l.name,o>l.distance?u+="#":l.distance>o&&(u+="b"),{note:new n(u+(r+1)),cents:c}}},o.interval=function(e,t,i){if("string"==typeof t){"down"===i&&(t=o.interval.invert(t));var r=h[t[0]],a=parseFloat(t.substr(1));if(!r||isNaN(a)||1>a)throw Error("Invalid string-interval format");return o.interval.from(e,{quality:r,interval:u[a-1].name},i)}if(t instanceof n&&e instanceof n)return o.interval.between(e,t);throw Error("Invalid parameters")},o.interval.from=function(t,i,r){i.direction=r||i.direction||"up";var o,l,h,f,p,m;if(p=c[i.interval],m=u[p],p>7&&(p-=7),p=a[t.name].index+p,p>s.length-1&&(p-=s.length),o=s[p],-1===d[m.quality].indexOf(i.quality)||-1===d[m.quality].indexOf(m.quality))throw Error("Invalid interval quality");return l=d[m.quality].indexOf(i.quality)-d[m.quality].indexOf(m.quality),h=m.size+l-e(t.name,o),t.octave&&(f=Math.floor((t.key()-t.accidental.value+e(t.name,o)-4)/12)+1+Math.floor(c[i.interval]/7)),h+=t.accidental.value,h>=11&&(h-=12),h>-3&&3>h&&(o+=v[h]),"down"===r&&f--,new n(o+(f||""))},o.interval.between=function(e,t){var i,n,r,o,s,l,c=e.key(),h=t.key();if(i=h-c,i>24||-25>i)throw Error("Too big interval. Highest interval is a augmented fifteenth (25 semitones)");return 0>i&&(o=e,e=t,t=o),r=a[t.name].index-a[e.name].index+7*(t.octave-e.octave),n=u[r],l=d[n.quality][Math.abs(i)-n.size+1],s=f[l]+(""+Number(r+1)),{name:n.name,quality:l,direction:i>0?"up":"down",simple:s}},o.interval.invert=function(e){if(2!==e.length&&3!==e.length)return!1;var t=p[e[0]],i=parseFloat(2===e.length?e[1]:e.substr(1));return i>8&&(i-=7),8!==i&&1!==i&&(i=9-i),t+(""+i)},o.scale={list:function(e,t,i){var r,a,s=[],l=[];if(!(e instanceof n))return!1;if("string"==typeof t&&(t=o.scale.scales[t],!t))return!1;for(s.push(e),i&&l.push(e.name+(e.accidental.sign||"")),r=0,a=t.length;a>r;r++)s.push(o.interval(e,t[r])),i&&l.push(s[r+1].name+(s[r+1].accidental.sign||""));return i?l:s},scales:{major:["M2","M3","P4","P5","M6","M7"],ionian:["M2","M3","P4","P5","M6","M7"],dorian:["M2","m3","P4","P5","M6","m7"],phrygian:["m2","m3","P4","P5","m6","m7"],lydian:["M2","M3","A4","P5","M6","M7"],mixolydian:["M2","M3","P4","P5","M6","m7"],minor:["M2","m3","P4","P5","m6","m7"],aeolian:["M2","m3","P4","P5","m6","m7"],locrian:["m2","m3","P4","d5","m6","m7"],majorpentatonic:["M2","M3","P5","M6"],minorpentatonic:["m3","P4","P5","m7"],chromatic:["m2","M2","m3","M3","P4","A4","P5","m6","M6","m7","M7"],harmonicchromatic:["m2","M2","m3","M3","P4","A4","P5","m6","M6","m7","M7"]}},t.exports=o}()},{}],5:[function(e,t){t.exports=function(t){"use strict";{var i,n=t.dollar;e("gibberish-dsp")}return i={"export":function(e){n.extend(e,i.Busses),n.extend(e,i.Oscillators),n.extend(e,i.Synths),n.extend(e,i.Percussion),n.extend(e,i.Envelopes),n.extend(e,i.FX),n.extend(e,i.Seqs),n.extend(e,i.Samplers),n.extend(e,i.PostProcessing),n.extend(e,i.Vocoder),e.Theory=i.Theory,n.extend(e,i.Analysis),e.Score=i.Score,e.Clock=i.Clock,e.Seq=i.Seqs.Seq,e.Arp=i.Arp,e.ScaleSeq=i.Seqs.ScaleSeq,e.SoundFont=i.SoundFont,e.Speak=i.Speak,e.Additive=i.Additive,e.Ugen=i.Ugen,e.Rndi=i.Core.Rndi,e.Rndf=i.Core.Rndf,e.rndi=i.Core.rndi,e.rndf=i.Core.rndf,e.Input=i.Input,e.Freesound=i.Freesound2,e.Freesound2=i.Freesound2,e.Freesoundjs2=i.Freesoundjs2,e.Scale=i.Theory.Scale,e.Ensemble=i.Ensemble,e.module=t.import,i.Core.Time.export(e),i.Clock.export(e),i.Core.Binops.export(e),e.Master=i.Master},init:function(){var e=null;i.onstart&&(e=i.onstart),i.context||(i.context={sampleRate:44100}),i.Core.onstart=function(){i.Clock.start(!0),null!==e&&e()},i.Score=i.Score(t),i.Additive=i.Additive(t),t.Clock=i.Clock,t.Theory=i.Theory,t.Theory.scale=t.scale=t.Audio.Theory.Scale("c4","Minor"),i.Core._init(),n.extend(t.Binops,i.Binops),i.Master=i.Busses.Bus().connect(i.Core.out),i.Master.type="Bus",i.Master.name="Master",n.extend(!0,i.Master,i.ugenTemplate),i.Master.fx.ugen=i.Master,i.ugenTemplate.connect=i.Core._oscillator.connect=i.Core._synth.connect=i.Core._effect.connect=i.Core._bus.connect=i.connect,i.Core.defineUgenProperty=i.defineUgenProperty,n.extend(t.Presets,i.Synths.Presets),n.extend(t.Presets,i.Percussion.Presets),n.extend(t.Presets,i.FX.Presets)},Time:{ms:function(e){return{mode:"absolute",value:t.Audio.Core.context.sampleRate/1e3*e,valueOf:function(){return this.value}}},seconds:function(e){return{mode:"absolute",value:t.Audio.Core.context.sampleRate*e,valueOf:function(){return this.value}}},minutes:function(e){return{mode:"absolute",value:60*t.Audio.Core.context.sampleRate*e,valueOf:function(){return this.value}}}},defineUgenProperty:function(e,t,n){var r=i.Clock.timeProperties.indexOf(e)>-1,o=n.properties[e]={value:r?i.Clock.time(t):t,binops:[],parent:n,name:e},a=e.charAt(0).toUpperCase()+e.slice(1);Object.defineProperty(n,e,{configurable:!0,get:function(){return o.value},set:function(e){return n[a]&&n[a].mapping&&n[a].mapping.remove&&n[a].mapping.remove(!0),o.value=r?i.Clock.time(e):e,i.Core.dirty(n),o.value}}),n[e]=o.value},polyInit:function(e){e.mod=e.polyMod,e.removeMod=e.removePolyMod;for(var t in e.polyProperties)!function(t){var n=e.polyProperties[t],r=i.Clock.timeProperties.indexOf(t)>-1;Object.defineProperty(e,t,{get:function(){return n},set:function(n){for(var o=0;o<e.children.length;o++)e.children[o][t]=r?i.Clock.time(n):n}})}(t)},connect:function(e,t){return"undefined"==typeof e&&(e=i.Master),-1===this.destinations.indexOf(e)&&(e.addConnection(this,1,t),0!==t&&this.destinations.push(e)),this},clear:function(){for(var e=Array.prototype.slice.call(arguments,0),n=i.Theory.scale.seq.isConnected,r=0;r<i.Master.inputs.length;r++)-1===e.indexOf(i.Master.inputs[r].value)&&i.Master.inputs[r].value.disconnect();i.Master.inputs.length=arguments.length,i.Clock.shouldResetOnClear!==!1&&i.Clock.reset(),i.Master.fx.remove(),i.Master.amp=1,i.Core.clear(),i.Clock.seq.connect(),n&&(t.Theory.scale=t.scale=t.Audio.Theory.Scale("c4","Minor")),i.Core.out.addConnection(i.Master,1),i.Master.destinations.push(i.Core.out),console.log("Audio stopped.")},ugenTemplate:{sequencers:[],mappings:[],fx:n.extend([],{add:function(){var e=0===this.length?this.ugen:this[this.length-1];e.disconnect();for(var t=0;t<arguments.length;t++){var n=arguments[t];n.input=e,e=n,this.push(n)}return this.ugen!==i.Master?e.connect():e.connect(i.Core.out),this.ugen},remove:function(){if(arguments.length>0)for(var e=0;e<arguments.length;e++){var t=arguments[e];if("string"!=typeof t)if("object"!=typeof t){if("number"==typeof t){var n=this[t];if(n.disconnect(),this.splice(t,1),"undefined"!=typeof this[t]){var r=t-1;this[t].input=-1!==r?this[r]:this.ugen,"undefined"!=typeof this[t+1]?this[t+1].input=0===t?this.ugen:this[t]:this.ugen.connect(this.ugen!==i.Master?i.Master:i.Core.out)}else this.length>0?this[t-1].connect(i.Master):this.ugen.connect(this.ugen!==i.Master?i.Master:i.Core.out)}}else for(var o=0;o<this.length;o++)this[o]===t&&this.remove(o);else for(var o=0;o<this.length;o++)this[o].name===t&&this.remove(o)}else this.length>0?(this[this.length-1].disconnect(),this.ugen.connect(this.ugen!==i.Master?i.Master:i.Core.out),this.ugen.codegen(),this.length=0):console.log(this.ugen.name+" does not have any fx to remove. ")}}),replaceWith:function(e){if(e.connect){for(var t=0;t<this.destinations.length;t++)e.connect(this.destinations[t]);for(var t=0;t<this.sequencers.length;t++)this.sequencers[t].target=e,e.sequencers.push(this.sequencers[t]);for(var t=0;t<this.mappingObjects.length;t++){var i=this.mappingObjects[t];if(i.targets.length>0)for(var n=0;n<i.targets.length;n++){var r=i.targets[n];e.mappingProperties[i.name]?r[0].mapping.replace(e,i.name,i.Name):r[0].mapping.remove()}}}this.kill()},kill:function(){var e=0!==this.fx.length?this.fx[this.fx.length-1]:this;this.seq.isRunning&&this.seq.disconnect(),e.disconnect();for(var t=0;t<this.fx.length;t++){var i=this.fx[t];i.seq.isRunning&&i.seq.disconnect()}this.disconnect();for(var t=0;t<this.mappings.length;t++)this.mappings[t].remove();this.clearMarks&&this.clearMarks(),console.log(this.name+" has been terminated.")},play:function(e,t){return this.note?this.note.seq(e,t):this.frequency&&this.frequency.seq(e,t),this},fadeIn:function(e,t){isNaN(t)&&(t=1);var n=i.Clock.time(e),r=(new i.Core.ExponentialDecay({decayCoefficient:.05,length:n}),new i.Core.Line(0,t,n));return this.amp=r,future(function(){this.amp=t}.bind(this),n),this},fadeOut:function(e){var n=i.Clock.time(e),r=t.Audio.Envelopes.Curve(0,1,n,.05,.95,!1);return this.amp=i.Core.Binops.Mul(this.amp.oldGetter(),r),future(function(){this.amp=0}.bind(this),n),this},fadeOut2:function(e){var n=i.Clock.time(e),r=t.Audio.Envelopes.Curve(0,1,n,.05,.95,!1);return this.amp=i.Core.Binops.Mul(this.amp.oldGetter(),r),future(function(){this.amp=0,this.kill()}.bind(this),n),this}}},i.Core=e("gibberish-dsp"),i.Core._init=i.Core.init.bind(i.Core),delete i.Core.init,i.Clock=e("./audio/clock")(t),i.Freesoundjs=e("../external/freesound"),i.Freesound=e("./audio/gibber_freesound")(i.Freesoundjs),i.Freesoundjs2=e("../external/freesound2"),i.Freesound2=e("./audio/gibber_freesound2")(i.Freesoundjs2),i.Seqs=e("./audio/seq")(t),i.Theory=e("./audio/theory")(t),i.FX=e("./audio/fx")(t),i.Oscillators=e("./audio/oscillators")(t),i.Synths=e("./audio/synths")(t),i.Busses=e("./audio/bus")(t),i.Analysis=e("./audio/analysis")(t),i.Envelopes=e("./audio/envelopes")(t),i.Percussion=e("./audio/drums")(t),i.Input=e("./audio/audio_input")(t),i.Samplers=e("./audio/sampler")(t),i.Vocoder=e("./audio/vocoder")(t),i.PostProcessing=e("./audio/postprocessing")(t),i.Arp=e("./audio/arp")(t),i.SoundFont=e("./audio/soundfont")(t),i.Score=e("./audio/score"),i.Ensemble=e("./audio/ensemble")(t),i.Ugen=e("./audio/ugen")(t),i.Additive=e("./audio/additive"),i}},{"../external/freesound":2,"../external/freesound2":3,"./audio/additive":6,"./audio/analysis":7,"./audio/arp":8,"./audio/audio_input":9,"./audio/bus":10,"./audio/clock":11,"./audio/drums":12,"./audio/ensemble":13,"./audio/envelopes":14,"./audio/fx":15,"./audio/gibber_freesound":16,"./audio/gibber_freesound2":17,"./audio/oscillators":18,"./audio/postprocessing":19,"./audio/sampler":20,"./audio/score":21,"./audio/seq":22,"./audio/soundfont":23,"./audio/synths":24,"./audio/theory":25,"./audio/ugen":26,"./audio/vocoder":27,"gibberish-dsp":1}],6:[function(e,t){t.exports=function(e){var t=e.Audio.Ugen({name:"additive",inputs:{frequency:{min:50,max:3e3,"default":440},amp:{min:0,max:1,"default":.5}},callback:function(e,t){{var i,n=this.sines;this.harmonics}this.out=0;for(var r=0,o=n.length;o>r;r++)i=n[r],this.out+=i(e*i.harmonic,i.amp);return this.out*t},init:function(){this.sines=[];for(var t=0,i=0;t<this.harmonics.length/2;t++,i+=2){this.sines[t]=e.Audio.Oscillators.Sine(440,1)._.callback,this.sines[t].harmonic=this.harmonics[i],this.sines[t].amp=this.harmonics[i+1]}this.out=0,console.log(this.sines)}});return t}},{}],7:[function(e,t){t.exports=function(t){"use strict";var i,n={value:{min:0,max:255,output:s,wrap:!1,timescale:"graphics"}},r=e("gibberish-dsp"),o=t.dollar,a=t.outputCurves,s=(a.LINEAR,a.LOGARITHMIC),l={FFT:function(e,a){if("undefined"==typeof i){i=r.context.createAnalyser(),r.node.connect(i),i.fftSize=e||32,i.updateRate=a||40,i.values=new Uint8Array(i.frequencyBinCount),i.children=[];for(var s=0;s<i.frequencyBinCount;s++)!function(){var e=s,r={},a=0;Object.defineProperties(r,{value:{configurable:!0,get:function(){return a},set:function(e){a=e}}}),t.createProxyProperties(r,o.extend({},n),!1),i[e]=r,i.children.push(r),r.type="mapping",r.index=e,r.min=0,r.max=255,r.valueOf=function(){return this.value.value}}();setInterval(function(){i.getByteFrequencyData(i.values);for(var e=0;e<i.values.length;e++)i[e].value=i.values[e]},i.updateRate)}else e&&(i.fftSize=e),a&&(i.updateRate=a);return i},Follow:function(e,i){var n=new r.Follow(e,i),o={value:{min:0,max:1,output:s,timescale:"audio"}};return t.createProxyProperties(n,o),n}};return l}},{"gibberish-dsp":1}],8:[function(e,t){t.exports=function(t){var i,n=e("../../external/teoria.min"),r=t.dollar,o=(t.outputCurves,e("./seq")(t).Seq);return i=function(e,i,a,s,l){var u=o();r.extend(u,{name:"Arp",notes:[],pattern:a||"up",notation:e||"C4m7",mult:s||1,init:!1,speed:isNaN(i)?.25:i,scale:l||null,chord:function(e){var i=[];if(this.notation=e,"undefined"==typeof this.scale||null===this.scale&&"string"==typeof e)for(var r=0;r<this.mult;r++){var o,a,s=[],l=this.notation.slice(0,1);isNaN(this.notation.charAt(1))?(l+=this.notation.charAt(1),o=parseInt(this.notation.slice(2,3)),a=this.notation.slice(3)):(o=parseInt(this.notation.slice(1,2)),a=this.notation.slice(2)),o+=r;for(var e=n.note(l+o).chord(a),u=0;u<e.notes.length;u++){var c=e.notes[u].fq();s[u]=c}i=i.concat(s)}else for(var r=0;r<this.mult;r++){for(var s=[],u=0;u<this.notation.length;u++)s[u]=this.notation[u]+7*r;i=i.concat(s)}this.notes=t.construct(t.Pattern,this.patterns[this.pattern](i)),this.seqs[0]&&(this.seqs[0].values=[this.notes])},set:function(e,t,i,n,r){this.speed=t||this.speed,this.pattern=i||this.pattern,this.mult=n||this.mult,this.chord(e,r)},shuffle:function(){this.notes.shuffle()},reset:function(){this.notes.reset()},patterns:{up:function(e){return e},down:function(e){return e.reverse()},updown:function(e){var t=e.slice(0);return t.reverse(),e.concat(t)},updown2:function(e){var t=e.slice(0);return t.pop(),t.reverse(),t.pop(),e.concat(t)}}}),u.seq=u,t.createProxyMethods(u,["shuffle","reset","chord"]),u.chord(u.notation);var c=null;Object.defineProperty(u,"target",{get:function(){return c},set:function(e){c=e;var n={key:"note",target:c,values:u.notes,durations:t.Clock.time(i)};u.add(n),u.start()}});var h=i;return Object.defineProperty(u,"speed",{get:function(){return h},set:function(e){h=e;for(var i=0;i<u.seqs.length;i++)u.seqs[0].durations=t.Clock.time(h)}}),u}}},{"../../external/teoria.min":4,"./seq":22}],9:[function(e,t){t.exports=function(t){"use strict";var i={},n=e("gibberish-dsp"),r=t.outputCurves,o=r.LINEAR,a=r.LOGARITHMIC,s={amp:{min:0,max:1,hardMax:2,output:a,timescale:"audio",dimensions:1},out:{min:0,max:1,output:o,timescale:"audio",dimensions:1}},l="Input";return i=function(){var e=(new n.Input).connect(t.Master),i=Array.prototype.slice.call(arguments,0);return e.type="Gen",$.extend(!0,e,t.Audio.ugenTemplate),e.fx.ugen=e,Object.defineProperty(e,"_",{get:function(){return e.kill(),e},set:function(){}}),t.createProxyProperties(e,s),t.processArguments2(e,i,l),e.toString=function(){return"> "+l},e}}},{"gibberish-dsp":1}],10:[function(e,t){t.exports=function(t){"use strict";for(var i=t.dollar,n=e("gibberish-dsp"),r=t.outputCurves,o=r.LINEAR,a=(r.LOGARITHMIC,[["Bus2","Bus"]]),s={amp:{min:0,max:1,output:o,timescale:"audio"},pan:{min:-.75,max:.75,output:o,timescale:"audio"},out:{min:0,max:1,output:o,timescale:"audio",dimensions:1}},l=!1,u={mappingProperties:s,Presets:{}},c=0;c<a.length;c++)!function(){var e=Array.isArray(a[c])?a[c][0]:a[c],r=Array.isArray(a[c])?a[c][1]:a[c];u[r]=function(){var o=t.processArguments(arguments,r);return Array.isArray(o)?(o.unshift(0),o=t.construct(n[e],o)):o=new n[e](o),l?o.connect(Master):l=!0,o.type="Gen",Object.defineProperty(o,"_",{get:function(){return o.kill(),o},set:function(){}}),i.extend(!0,o,t.Audio.ugenTemplate),o.fx.ugen=o,t.createProxyProperties(o,s),o.presetInit&&o.presetInit(),o}}();return u.Group=function(){var e=t.processArguments(arguments,"Bus2");e=new n.Bus2,l?e.connect(Master):l=!0,e.type="FX",i.extend(!0,e,t.Audio.ugenTemplate),e.fx.ugen=e,t.createProxyProperties(e,s),i.extend(e,{add:function(){for(var t=0;t<arguments.length;t++)arguments[t].disconnect(),arguments[t].connect(e)},remove:function(){for(var t=0;t<arguments.length;t++)arguments[t].disconnect(e)},free:function(){for(var t=0;t<arguments.length;t++)arguments[t].disconnect(e),arguments[t].connect()}});for(var r=0;r<arguments.length;r++)e.add(arguments[r]);return e},u}},{"gibberish-dsp":1}],11:[function(_dereq_,module,exports){!function(){var times=[],$=null,curves=null,LINEAR=null,LOGARITHMIC=null,Gibberish=_dereq_("gibberish-dsp"),Gibber,Clock={seq:null,bpm:null,maxMeasures:44,baseBPM:120,metronome:null,currentBeat:0,beatsPerMeasure:4,codeToExecute:[],signature:{lower:4,upper:4},sequencers:[],shouldResetOnClear:!0,timeProperties:["attack","decay","sustain","release","offset","time"],phase:0,"export":function(e){e.beats=Clock.beats,e.Beats=Clock.Beats,e.measures=Clock.measures,e.Measures=Clock.Measures},processBeat:function(){if(Clock.currentBeat=Clock.currentBeat>=Clock.signature.upper?1:Clock.currentBeat+1,1===Clock.currentBeat&&Clock.codeToExecute.length>0){for(var i=0;i<Clock.codeToExecute.length;i++)try{"function"==typeof Clock.codeToExecute[i].function?Clock.codeToExecute[i].function():Gibber.Environment?Gibber.Environment.modes[Clock.codeToExecute[i].cm.doc.mode.name].run(Clock.codeToExecute[i].cm.column,Clock.codeToExecute[i].code,Clock.codeToExecute[i].pos,Clock.codeToExecute[i].cm,!1):eval(Clock.codeToExecute[i].code)}catch(e){console.error("FAILED TO EXECUTE CODE:",Clock.codeToExecute[i].code,e)}Clock.codeToExecute.length=0}null!==Clock.metronome&&Clock.metronome.draw(Clock.currentBeat,Clock.signature.upper),Clock.phase+=Clock.beats(1)},getTimeSinceStart:function(){return Clock.phase+Clock.seq.phase},reset:function(){this.phase=0,this.currentBeat=0,this.rate=1,this.start(!1)},tap:function(){var e=Gibber.Clock.getTimeSinceStart();for(times[2]&&e-times[2]>88200&&(times.length=0),times.unshift(e);times.length>3;)times.pop();if(3===times.length){var t=(times[0]+times[1]-2*times[2])/3,i=44100/t,n=60*i;Gibber.Clock.bpm=n}},start:function(e){var t=0;if(e){$.extend(this,{properties:{rate:1},name:"master_clock",callback:function(e){return t++,e}}),this.__proto__=new Gibberish.ugen,this.__proto__.init.call(this);var i=this.baseBPM;Object.defineProperty(Clock,"bpm",{get:function(){return i},set:function(e){i=e,Clock.rate=i/Clock.baseBPM}}),Object.defineProperty(this,"timeSignature",{configurable:!0,get:function(){return Clock.signature.upper+"/"+Clock.signature.lower},set:function(e){var t=e.split("/");2!==t.length||t[0]===Clock.signature.upper&&t[1]===Clock.signature.lower||(Clock.signature.upper=parseInt(t[0]),Clock.signature.lower=parseInt(t[1]),Clock.currentBeat=1!=Clock.currentBeat?0:1)}}),Gibber.createProxyProperties(this,{rate:{min:.1,max:2,output:LINEAR,timescale:"audio"},bpm:{min:20,max:200,output:LINEAR,timescale:"audio"}}),this.setPhase=function(e){t=e},this.getPhase=function(){return t},Clock.seq=new Gibberish.PolySeq({seqs:[{target:Clock,values:[Clock.processBeat.bind(Clock)],durations:[.25]}],rate:Clock}),Gibber.Audio.Seqs.Seq.children.push(Clock.seq),Clock.seq.connect().start(),Clock.seq.timeModifier=Clock.time.bind(Clock)}else Clock.seq.setPhase(0),Clock.seq.connect().start()},addMetronome:function(e){this.metronome=e,this.metronome.init()},time:function(e){var t;return t=e<Clock.maxMeasures?Clock.beats(e*Clock.signature.lower):e},Time:function(e){var t;return t=Clock.Beats(e<this.maxMeasures?e*Clock.signature.lower:e)},beats:function(e){var t="undefined"!=typeof Gibberish.context?Gibberish.context.sampleRate:44100,i=Clock.bpm/60,n=t/i;return n*e},Beats:function(e){return Clock.beats.bind(null,e)},measures:function(e){return Clock.beats(e*Clock.signature.upper)},Measures:function(e){return Clock.Beats(e*Clock.signature.upper)}};module.exports=function(e){"use strict";return Gibber=e,$=Gibber.dollar,curves=Gibber.outputCurves,LINEAR=curves.LINEAR,LOGARITHMIC=curves.LOGARITHMIC,Clock}}()},{"gibberish-dsp":1}],12:[function(_dereq_,module,exports){module.exports=function(Gibber){"use strict";for(var Percussion={Presets:{}},Gibberish=_dereq_("gibberish-dsp"),$=Gibber.dollar,Clock=Gibber.Clock,curves=Gibber.outputCurves,LINEAR=curves.LINEAR,LOGARITHMIC=curves.LOGARITHMIC,types=["Kick","Snare","Hat","Conga","Cowbell","Clave","Tom","Clap"],_mappingProperties={Drums:{pitch:{min:.25,max:4,output:LINEAR,timescale:"audio"},amp:{min:0,max:1,output:LOGARITHMIC,timescale:"audio"},pan:{min:0,max:1,output:LINEAR,timescale:"audio"},out:{min:0,max:1,output:LINEAR,timescale:"audio",dimensions:1}},XOX:{amp:{min:0,max:1,output:LOGARITHMIC,timescale:"audio"},pan:{min:0,max:1,output:LINEAR,timescale:"audio"},out:{min:0,max:1,output:LINEAR,timescale:"audio",dimensions:1}},Kick:{amp:{min:0,max:1,output:LOGARITHMIC,timescale:"audio"},out:{min:0,max:1,output:LINEAR,timescale:"audio",dimensions:1}},Snare:{amp:{min:0,max:1,output:LOGARITHMIC,timescale:"audio"},snappy:{min:.25,max:1.5,output:LOGARITHMIC,timescale:"audio"},tune:{min:0,max:2,output:LOGARITHMIC,timescale:"audio"},out:{min:0,max:1,output:LINEAR,timescale:"audio",dimensions:1}},Hat:{amp:{min:0,max:1,output:LOGARITHMIC,timescale:"audio"},out:{min:0,max:1,output:LINEAR,timescale:"audio",dimensions:1}},Conga:{amp:{min:0,max:1,output:LOGARITHMIC,timescale:"audio"},out:{min:0,max:1,output:LINEAR,timescale:"audio",dimensions:1}},Cowbell:{out:{min:0,max:1,output:LINEAR,timescale:"audio",dimensions:1},amp:{min:0,max:1,output:LOGARITHMIC,timescale:"audio"}},Clave:{out:{min:0,max:1,output:LINEAR,timescale:"audio",dimensions:1},amp:{min:0,max:1,output:LOGARITHMIC,timescale:"audio"}},Tom:{out:{min:0,max:1,output:LINEAR,timescale:"audio",dimensions:1},amp:{min:0,max:1,output:LOGARITHMIC,timescale:"audio"}},Clap:{out:{min:0,max:1,output:LINEAR,timescale:"audio",dimensions:1},amp:{min:0,max:1,output:LOGARITHMIC,timescale:"audio"}}},i=0;i<types.length;i++)!function(){var e=Array.isArray(types[i])?types[i][0]:types[i],t=Array.isArray(types[i])?types[i][1]:types[i];Percussion[t]=function(){var i,n=Array.prototype.slice.call(arguments);return"object"==typeof n[0]&&"undefined"==typeof n[0].maxVoices?n[0].maxVoices=1:"undefined"==typeof n[0]&&(n[0]={maxVoices:1}),i=Gibber.processArguments(n,t),i=Array.isArray(i)?Gibber.construct(Gibberish[e],i).connect(Gibber.Master):new Gibberish[e](i).connect(Gibber.Master),i.type="Gen",$.extend(!0,i,Gibber.Audio.ugenTemplate),i.fx.ugen=i,i._note=i.note.bind(i),i.note=function(){var e=Array.prototype.splice.call(arguments,0);"string"==typeof e[0]&&(e[0]=Gibber.Theory.Teoria.note(e[0]).fq()),this._note.apply(this,e)},Gibber.createProxyProperties(i,_mappingProperties[t]),Gibber.createProxyMethods(i,["note","send"]),i.toString=function(){return"> "+t},Object.defineProperty(i,"_",{get:function(){return i.kill(),i},set:function(){}}),i}}();return Percussion.Drums=function(_sequence,_timeValue,_amp,_freq){var args=Array.prototype.slice.call(arguments),obj={},props=Gibber.processArguments(args,"Drums");$.extend(!0,obj,props),obj=Array.isArray(obj)?Gibber.construct(Gibberish.Bus2,obj).connect(Gibber.Master):new Gibberish.Bus2(obj).connect(Gibber.Master),obj.name="Drums",obj.type="Gen",obj.children=[],$.extend(!0,obj,Gibber.Audio.ugenTemplate),obj.fx.ugen=obj,Object.defineProperty(obj,"_",{get:function(){return obj.kill(),obj},set:function(){}}),obj.kit=Percussion.Drums.kits["default"],"object"==typeof arguments[0]&&arguments[0].kit&&(obj.kit=Percussion.Drums.kits[arguments[0].kit],arguments[0].kit=obj.kit);for(var key in obj.kit){var drum=obj.kit[key],ugen=drum.file?{ugen:new Gibberish.Sampler({file:drum.file,pitch:1,amp:drum.amp}),pitch:drum.pitch,amp:drum.amp}:drum;ugen&&(isNaN(ugen.pitch)&&(ugen.pitch=1),isNaN(ugen.pan)&&(ugen.pan=0),isNaN(ugen.amp)&&(ugen.amp=1),"undefined"==typeof ugen.symbol&&(ugen.symbol=key),obj[key]=ugen,obj[key].ugen.pan=drum.pan,drum.file||drum.ugen.disconnect(),obj[key].ugen.connect(obj),obj[key].fx=obj[key].ugen.fx,obj.children.push(obj[key].ugen))}if(obj.mod=obj.polyMod,obj.removeMod=obj.removePolyMod,obj.connect(),Gibber.createProxyProperties(obj,_mappingProperties.Drums),obj.note=function(e){var t=obj.pitch.value;if($.isArray(e))for(var i=0;i<e.length;i++){var n=e[i];if("string"==typeof n){for(var r in obj.kit)if(n===obj.kit[r].symbol){obj[r].ugen&&obj[r].ugen.note(t,obj[r].amp);
break}}else{var o=obj[Object.keys(obj.kit)[n]];o.ugen.note(t.value,o.ugen.amp)}}else if("string"==typeof e){for(var r in obj.kit)if(e===obj.kit[r].symbol){obj[r].file?(obj[r].ugen.note(t,obj[r].amp),obj[r].ugen.pitch=t):(obj[r].ugen.note(obj[r].pitch,obj[r].amp),obj[r].ugen.pitch=t);break}}else{var a=Object.keys(obj.kit),s=Math.abs(e),r=a[s%a.length],o=obj[r];o.ugen.note(t,o.ugen.amp)}},Gibber.createProxyMethods(obj,["note"]),obj.pitch=1,"object"===$.type(props[0])&&(props[0]=props[0].note),"undefined"!=typeof props)switch($.type(props[0])){case"string":for(var notes=props[0],_seqs=[],_durations=[],__durations=[],seqs=notes.split("|"),timeline={},i=0;i<seqs.length;i++){var seq=seqs[i],duration,hasTime=!1,idx=seq.indexOf(",");if(idx>-1){var _value=seq.substr(0,idx),duration=seq.substr(idx+1);duration=eval(duration),hasTime=!0,seq=_value.trim().split("")}else seq=seq.trim().split(""),duration=1/seq.length;if(seq.indexOf(".rnd(")>-1&&(seq=seq.split(".rnd")[0],seq=seq.split("").rnd()),"undefined"!=typeof props[1]){duration=props[1],Array.isArray(duration)||(duration=[duration]);var durationsPattern=Gibber.construct(Gibber.Pattern,duration);if(duration.randomFlag){durationsPattern.filters.push(function(){return[durationsPattern.values[rndi(0,durationsPattern.values.length-1)],1]});for(var i=0;i<duration.randomArgs.length;i+=2)durationsPattern.repeat(duration.randomArgs[i],duration.randomArgs[i+1])}duration=durationsPattern}obj.note.seq(seq,[duration],i)}break;case"object":"string"==typeof props[0].note&&(props[0].note=props[0].note.split("")),props[0].target=obj,props[0].durations=Gibber.Clock.Time(props[0].durations?props[0].durations:1/props[0].note.length),props[0].offset=props[0].offset?Gibber.Clock.time(props[0].offset):0;break;case"function":case"array":var length=props[0].length||props[0].values.length,durations="undefined"!=typeof arguments[1]?arguments[1]:Gibber.Clock.Time(1/length);"function"!=typeof durations&&(durations=Gibber.Clock.Time(durations)),obj.seq.add({key:"note",values:[props[0]],durations:durations,target:obj}),obj.pattern=obj.seq.seqs[obj.seq.seqs.length-1].values[0]}return"undefined"==typeof props&&(props={}),props.pitch&&(obj.pitch=props.pitch),"undefined"!=typeof props.snare&&($.extend(obj.snare.ugen,props.snare),$.extend(obj.snare,props.snare)),"undefined"!=typeof props.kick&&($.extend(obj.kick.ugen,props.kick),$.extend(obj.kick,props.kick)),"undefined"!=typeof props.hat&&($.extend(obj.hat.ugen,props.hat),$.extend(obj.hat,props.hat)),"undefined"!=typeof props.openHat&&($.extend(obj.openHat.ugen,props.openHat),$.extend(obj.openHat,props.openHat)),obj.amp=isNaN(_amp)?1:_amp,obj.seq&&obj.seq.tick&&Gibberish.future(obj.seq.tick,1),obj.start=function(){obj.seq.start(!0)},obj.stop=function(){obj.seq.stop()},obj.shuffle=function(){obj.note.values.shuffle()},obj.reset=function(){obj.seq.reset()},Gibber.createProxyMethods(obj,["play","stop","shuffle","reset","start","send"]),Object.defineProperties(obj,{offset:{get:function(){return obj.seq.offset},set:function(e){obj.seq.offset=Gibber.Clock.time(e)}}}),obj},Percussion.EDrums=function(_sequence,_timeValue,_amp,_freq){var args=Array.prototype.slice.call(arguments),obj={},props=Gibber.processArguments(args,"Drums");$.extend(!0,obj,props),obj=Array.isArray(obj)?Gibber.construct(Gibberish.Bus2,obj).connect(Gibber.Master):new Gibberish.Bus2(obj).connect(Gibber.Master),obj.name="XOX",obj.type="Gen",obj.children=[],$.extend(!0,obj,Gibber.Audio.ugenTemplate),obj.fx.ugen=obj,Object.defineProperty(obj,"_",{get:function(){return obj.kill(),obj},set:function(){}}),obj.pitch=1,obj.kick=Gibber.Audio.Percussion.Kick().disconnect(),obj.snare=Gibber.Audio.Percussion.Snare().disconnect(),obj.hat=Gibber.Audio.Percussion.Hat().disconnect(),obj.kick.connect(obj),obj.snare.connect(obj),obj.hat.connect(obj),obj.children.push(obj.kick,obj.snare,obj.hat),obj.mod=obj.polyMod,obj.removeMod=obj.removePolyMod,obj.set=function(e){obj.seq.note=e.split("")},Gibber.createProxyProperties(obj,_mappingProperties.XOX),obj.start=function(){obj.seq.start(!0)},obj.stop=function(){obj.seq.stop()},obj.shuffle=function(){obj.seq.shuffle()},obj.reset=function(){obj.seq.reset()};var kcd=1,scd=1,hcd=1,kf=null,sf=null,hf=null;if(obj.note=function(e){switch(e){case"x":1===kcd&&(kcd=0),obj.kick.note(),null!==kf&&(kf(),kf=null),kf=Gibber.Utilities.future(function(){kcd=1,kf=null},11e4*obj.kick.decay);break;case"o":1===scd&&(scd=0),obj.snare.note(),null!==sf&&(sf(),sf=null),sf=Gibber.Utilities.future(function(){scd=1,sf=null},obj.snare.decay);break;case"*":1===hcd&&(hcd=0),obj.hat.note(5e3),null!==hf&&(hf(),hf=null),hf=Gibber.Utilities.future(function(){hcd=1,hf=null},5500);break;case"-":1===hcd&&(hcd=0),obj.hat.note(3e4),null!==hf&&(hf(),hf=null),hf=Gibber.Utilities.future(function(){hcd=1,hf=null},30500)}},Gibber.createProxyMethods(obj,["play","stop","shuffle","reset","start","send","note"]),"undefined"!=typeof props)switch($.type(props[0])){case"string":for(var notes=props[0],_seqs=[],_durations=[],__durations=[],seqs=notes.split("|"),timeline={},i=0;i<seqs.length;i++){var seq=seqs[i],duration,hasTime=!1,idx=seq.indexOf(",");if(idx>-1){var _value=seq.substr(0,idx),duration=seq.substr(idx+1);duration=eval(duration),hasTime=!0,seq=_value.trim().split("")}else seq=seq.trim().split(""),duration=1/seq.length;if(seq.indexOf(".rnd(")>-1&&(seq=seq.split(".rnd")[0],seq=seq.split("").rnd()),"undefined"!=typeof props[1]){duration=props[1],Array.isArray(duration)||(duration=[duration]);var durationsPattern=Gibber.construct(Gibber.Pattern,duration);if(duration.randomFlag){durationsPattern.filters.push(function(){return[durationsPattern.values[rndi(0,durationsPattern.values.length-1)],1]});for(var i=0;i<duration.randomArgs.length;i+=2)durationsPattern.repeat(duration.randomArgs[i],duration.randomArgs[i+1])}duration=durationsPattern}obj.note.seq(Gibber.construct(Gibber.Pattern,seq),Gibber.construct(Gibber.Pattern,[duration]),i)}break;case"object":"string"==typeof props[0].note&&(props[0].note=props[0].note.split("")),props[0].target=obj,props[0].durations=Gibber.Clock.Time(props[0].durations?props[0].durations:1/props[0].note.length),props[0].offset=props[0].offset?Gibber.Clock.time(props[0].offset):0,obj.seq=Seq(props[0])}return"undefined"==typeof props&&(props={}),props.pitch&&(obj.pitch=props.pitch),"undefined"!=typeof props.snare&&($.extend(obj.snare.ugen,props.snare),$.extend(obj.snare,props.snare)),"undefined"!=typeof props.kick&&($.extend(obj.kick.ugen,props.kick),$.extend(obj.kick,props.kick)),"undefined"!=typeof props.hat&&($.extend(obj.hat.ugen,props.hat),$.extend(obj.hat,props.hat)),"undefined"!=typeof props.openHat&&($.extend(obj.openHat.ugen,props.openHat),$.extend(obj.openHat,props.openHat)),obj.amp=isNaN(_amp)?1:_amp,obj.seq.tick&&Gibberish.future(obj.seq.tick,1),obj.seq.start(!0),obj.toString=function(){return"EDrums : "+obj.seq.seqs[0].values.join("")},obj},Percussion.XOX=Percussion.EDrums,Percussion.Drums.kits={original:{kick:{file:"resources/audiofiles/kick.wav",symbol:"x",amp:1,pitch:1,pan:0},snare:{file:"resources/audiofiles/snare.wav",symbol:"o",amp:1,pitch:1,pan:.15},hat:{file:"resources/audiofiles/hat.wav",symbol:"*",amp:1,pitch:1,pan:-.1},openHat:{file:"resources/audiofiles/openHat.wav",symbol:"-",amp:1,pitch:1,pan:-.2}},electronic:{kick:{file:"resources/audiofiles/electronic/kick.wav",symbol:"x",amp:1.5,pitch:1,pan:0},snare:{file:"resources/audiofiles/electronic/snare.wav",symbol:"o",amp:1.5,pitch:1,pan:.15},hat:{file:"resources/audiofiles/electronic/hat.wav",symbol:"*",amp:1.5,pitch:1,pan:-.1},openHat:{file:"resources/audiofiles/electronic/openhat.wav",symbol:"-",amp:1.5,pitch:1,pan:-.2}},beatbox:{in_tss:{file:"resources/audiofiles/beatbox/^tss.wav",symbol:"T",amp:1,pitch:1,pan:.1},f:{file:"resources/audiofiles/beatbox/f.wav",symbol:"f",amp:1,pitch:1,pan:-.1},h:{file:"resources/audiofiles/beatbox/h.wav",symbol:"h",amp:1,pitch:1,pan:.1},s:{file:"resources/audiofiles/beatbox/s.wav",symbol:"s",amp:1,pitch:1,pan:-.1},d:{file:"resources/audiofiles/beatbox/d.wav",symbol:"d",amp:1,pitch:1,pan:.8},t:{file:"resources/audiofiles/beatbox/t.wav",symbol:"t",amp:1,pitch:1,pan:.4},k:{file:"resources/audiofiles/beatbox/k.wav",symbol:"k",amp:1,pitch:1,pan:-.1},in_k:{file:"resources/audiofiles/beatbox/^k.wav",symbol:"K",amp:1,pitch:1,pan:-.4},eight:{file:"resources/audiofiles/beatbox/8.wav",symbol:"8",amp:1,pitch:1,pan:-.8},psh:{file:"resources/audiofiles/beatbox/psh.wav",symbol:"p",amp:1,pitch:1,pan:.1},in_p:{file:"resources/audiofiles/beatbox/^p.wav",symbol:"P",amp:1,pitch:1,pan:-.1},pf:{file:"resources/audiofiles/beatbox/pf.wav",symbol:"F",amp:1,pitch:1,pan:.2},phs:{file:"resources/audiofiles/beatbox/phs.wav",symbol:"H",amp:1,pitch:1,pan:-.2},b:{file:"resources/audiofiles/beatbox/b.wav",symbol:"b",amp:1,pitch:1,pan:.3},dot:{file:"resources/audiofiles/beatbox/dot.wav",symbol:".",amp:1,pitch:1,pan:0},duf:{file:"resources/audiofiles/beatbox/duf.wav",symbol:"D",amp:1,pitch:1,pan:-.3},o:{file:"resources/audiofiles/beatbox/o.wav",symbol:"o",amp:1,pitch:1,pan:.6},a:{file:"resources/audiofiles/beatbox/a.wav",symbol:"a",amp:1,pitch:1,pan:.8},u:{file:"resources/audiofiles/beatbox/u.wav",symbol:"u",amp:1,pitch:1,pan:-.8},m:{file:"resources/audiofiles/beatbox/m.wav",symbol:"m",amp:1,pitch:1,pan:-.6},n:{file:"resources/audiofiles/beatbox/n.wav",symbol:"n",amp:1,pitch:1,pan:0}}},Percussion.Drums.kits.default=Percussion.Drums.kits.electronic,Percussion.Drums.makeKit=function(e,t){Percussion.Drums.kits[e]=t},Percussion.Presets.Kick={"short":{decay:.1,amp:.75}},Percussion.Presets.Snare={crack:{snappy:1,offset:.25}},Percussion}},{"gibberish-dsp":1}],13:[function(_dereq_,module,exports){module.exports=function(Gibber){"use strict";var Gibberish=_dereq_("gibberish-dsp"),$=Gibber.dollar,Clock=Gibber.Clock,curves=Gibber.outputCurves,LINEAR=curves.LINEAR,LOGARITHMIC=curves.LOGARITHMIC,mappingProperties={amp:{min:0,max:1,output:LINEAR,timescale:"audio"},pan:{min:-.75,max:.75,output:LINEAR,timescale:"audio"},out:{min:0,max:1,output:LINEAR,timescale:"audio",dimensions:1}},Ensemble=function(props){var obj=new Gibberish.Bus2(obj).connect(Gibber.Master);obj.name="Ensemble",obj.type="Gen",obj.children=[],$.extend(!0,obj,Gibber.Audio.ugenTemplate),obj.fx.ugen=obj,Object.defineProperty(obj,"_",{get:function(){return obj.kill(),obj},set:function(){}}),Gibber.createProxyProperties(obj,mappingProperties);for(var key in props){var ugenDesc=props[key],ugen=ugenDesc.file?{ugen:new Gibberish.Sampler({file:ugenDesc.file,pitch:1,amp:ugenDesc.amp}),pitch:ugenDesc.pitch,amp:ugenDesc.amp}:ugenDesc;ugen&&(isNaN(ugen.pitch)&&(ugen.pitch=1),isNaN(ugen.pan)&&(ugen.pan=0),isNaN(ugen.amp)&&(ugen.amp=1),"undefined"==typeof ugen.symbol&&(ugen.symbol=key),obj[key]=ugen,obj[key].ugen.pan=ugen.pan,ugenDesc.file||ugen.ugen.disconnect(),obj[key].ugen.connect(obj),obj[key].fx=obj[key].ugen.fx,obj.children.push(obj[key].ugen))}obj.note=function(e){var t=obj.pitch;if("string"==typeof e)for(var i in props){var n=props[i];if(e===n.symbol){n.file?n.ugen.note(t,obj[i].amp):n.ugen.note(n.pitch*t,n.amp);break}}else{var r=Object.keys(obj.kit),o=Math.abs(e),i=r[o%r.length],n=obj[i];n.ugen.note(t,n.ugen.amp)}};var seqNumber;return obj.play=function(pattern){for(var notes=pattern,_seqs=[],_durations=[],__durations=[],seqs=notes.split("|"),timeline={},i=0;i<obj.seq.seqs.length;i++)obj.seq.seqs[i].shouldStop=!0;obj.seq.seqs.length=0;for(var i=0;i<seqs.length;i++){var seq=seqs[i],duration,hasTime=!1,idx=seq.indexOf(",");if(idx>-1){var _value=seq.substr(0,idx),duration=seq.substr(idx+1);duration=eval(duration),hasTime=!0,seq=_value.trim().split("")}else seq=seq.trim().split(""),duration=1/seq.length;if(seq.indexOf(".rnd(")>-1&&(seq=seq.split(".rnd")[0],seq=seq.split("").rnd()),"undefined"!=typeof arguments[1]){duration=arguments[1],Array.isArray(duration)||(duration=[duration]);var durationsPattern=Gibber.construct(Gibber.Pattern,duration);if(duration.randomFlag){durationsPattern.filters.push(function(){return[durationsPattern.values[rndi(0,durationsPattern.values.length-1)],1]});for(var i=0;i<duration.randomArgs.length;i+=2)durationsPattern.repeat(duration.randomArgs[i],duration.randomArgs[i+1])}duration=durationsPattern}obj.seq.add({key:"note",values:Gibber.construct(Gibber.Pattern,seq),durations:Gibber.construct(Gibber.Pattern,[duration]),target:obj}),seqNumber=obj.seq.seqs.length-1,Object.defineProperties(obj.note,{values:{configurable:!0,get:function(){return obj.seq.seqs[seqNumber].values},set:function(e){var t=Gibber.construct(Gibber.Pattern,e);Array.isArray(t)||(t=[t]),obj.seq.seqs[seqNumber].values=t}},durations:{configurable:!0,get:function(){return obj.seq.seqs[seqNumber].durations},set:function(e){Array.isArray(e)||(e=[e]),obj.seq.seqs[seqNumber].durations=e}}})}},obj.pitch=1,obj.seq.start(),obj.connect(),obj};return Ensemble}},{"gibberish-dsp":1}],14:[function(e,t){t.exports=function(t){"use strict";for(var i={},n=e("gibberish-dsp"),r=t.dollar,o=(t.Clock,t.outputCurves),a=o.LINEAR,s=(o.LOGARITHMIC,["Curve","Line","Ease","Lines","AD","ADSR"]),l={Line:{start:{min:0,max:1,output:a,timescale:"audio"},end:{min:0,max:1,output:a,timescale:"audio"},time:{min:0,max:8,output:a,timescale:"audio"}},Lines:{time:{min:0,max:8,output:a,timescale:"audio"}},Ease:{},Curve:{start:{min:0,max:1,output:a,timescale:"audio"},end:{min:0,max:1,output:a,timescale:"audio"},time:{min:0,max:8,output:a,timescale:"audio"},a:{min:0,max:1,output:a,timescale:"audio"},b:{min:0,max:1,output:a,timescale:"audio"}},AD:{attack:{min:0,max:8,output:a,timescale:"audio"},decay:{min:0,max:8,output:a,timescale:"audio"}},ADSR:{attack:{min:0,max:8,output:a,timescale:"audio"},decay:{min:0,max:8,output:a,timescale:"audio"},sustain:{min:0,max:8,output:a,timescale:"audio"},release:{min:0,max:8,output:a,timescale:"audio"}}},u=0;u<s.length;u++)!function(){var e=Array.isArray(s[u])?s[u][0]:s[u],o=Array.isArray(s[u])?s[u][1]:s[u];i[o]=function(){var i,a=Array.prototype.slice.call(arguments,0);return i="object"!=typeof a[0]?new n[e](a[0],a[1],t.Clock.time(a[2]),a[3],a[4],a[5],a[6]):"Lines"===o?new n.Lines(a[0],a[1],a[2]):"Ease"===o?new n.Ease(a[0],a[1],a[2],a[3],a[4]):"Curve"===o?new n.Curve(a[0],a[1],a[2],a[3],a[4],a[5],a[6]):t.construct(n[e],a[0]),i.name=o,r.extend(!0,i,t.Audio.ugenTemplate),t.createProxyProperties(i,l[o]),"Lines"!==o&&t.processArguments2(i,a,i.name),("."===o||"ADSR"===o)&&t.createProxyMethods(i,["run"]),console.log(o+" is created."),i}}();return i}},{"gibberish-dsp":1}],15:[function(e,t){t.exports=function(t){"use strict";var i={Presets:{}},n=e("gibberish-dsp"),r=t.dollar,o=t.outputCurves,a=o.LINEAR,s=o.LOGARITHMIC;n.Gain=function(){n.extend(this,{name:"gain",type:"effect",properties:{input:0,amount:1},callback:function(e,t){return"object"==typeof e?(e[0]*=t,e[1]*=t):e*=t,e}}).init().processProperties(arguments)},n.Gain.prototype=n._effect;for(var l=["Reverb",["StereoReverb","StereoVerb"],"Delay","Flanger","Vibrato","Distortion","Biquad","Gain","Filter24",["RingModulation","RingMod"],["BufferShuffler","Schizo"],["Decimator","Crush"],"Tremolo"],u={Reverb:{roomSize:{min:.5,max:.995,output:a,timescale:"audio"},damping:{min:0,max:1,output:a,timescale:"audio"},out:{min:0,max:1,output:a,timescale:"audio",dimensions:1}},StereoReverb:{roomSize:{min:.5,max:.995,output:a,timescale:"audio"},damping:{min:0,max:1,output:a,timescale:"audio"},out:{min:0,max:1,output:a,timescale:"audio",dimensions:1}},Delay:{feedback:{min:0,max:1,output:a,timescale:"audio"},time:{min:50,max:88200,output:a,timescale:"audio"},out:{min:0,max:1,output:a,timescale:"audio",dimensions:1}},RingMod:{frequency:{min:20,max:3e3,output:a,timescale:"audio"},amp:{min:0,max:1,output:a,timescale:"audio"},mix:{min:0,max:1,output:a,timescale:"audio"},out:{min:0,max:1,output:a,timescale:"audio",dimensions:1}},Flanger:{rate:{min:.01,max:20,output:s,timescale:"audio"},feedback:{min:0,max:.99,output:a,timescale:"audio"},amount:{min:25,max:300,output:a,timescale:"audio"},out:{min:0,max:1,output:a,timescale:"audio",dimensions:1}},Gain:{amount:{min:0,max:1,output:a,timescale:"audio"}},Vibrato:{rate:{min:.2,max:8,output:s,timescale:"audio"},amount:{min:25,max:300,output:a,timescale:"audio"},feedback:{min:.45,max:.55,output:a,timescale:"audio"},out:{min:0,max:1,output:a,timescale:"audio",dimensions:1}},Filter24:{cutoff:{min:0,max:.7,output:a,timescale:"audio"},resonance:{min:0,max:5.5,output:a,timescale:"audio"},out:{min:0,max:1,output:a,timescale:"audio",dimensions:1}},LPF:{cutoff:{min:.05,max:.7,output:a,timescale:"audio"},resonance:{min:0,max:5.5,output:a,timescale:"audio"},out:{min:0,max:1,output:a,timescale:"audio",dimensions:1}},HPF:{cutoff:{min:0,max:.7,output:a,timescale:"audio"},resonance:{min:0,max:5.5,output:a,timescale:"audio"},out:{min:0,max:1,output:a,timescale:"audio",dimensions:1}},Crush:{bitDepth:{min:1,max:16,output:a,timescale:"audio"},sampleRate:{min:0,max:1,output:a,timescale:"audio"},amp:{min:0,max:1,output:s,timescale:"audio"},out:{min:0,max:1,output:a,timescale:"audio",dimensions:1}},Schizo:{amp:{min:0,max:1,output:s,timescale:"audio"},out:{min:0,max:1,output:a,timescale:"audio",dimensions:1}},Tremolo:{amp:{min:0,max:1,output:s,timescale:"audio"},frequency:{min:.05,max:20,output:s,timescale:"audio"},out:{min:0,max:1,output:a,timescale:"audio",dimensions:1}}},c=0;c<l.length;c++)!function(){var e=Array.isArray(l[c])?l[c][0]:l[c],o=Array.isArray(l[c])?l[c][1]:l[c];i[o]=function(){var i,a=Array.prototype.slice.call(arguments,0);return i=new n[e],i.type="FX",i.name=o,r.extend(!0,i,t.Audio.ugenTemplate),t.createProxyProperties(i,u[o]),t.createProxyMethods(i,["send"]),t.processArguments2(i,a,i.name),"Delay"===o&&(i.rate=t.Clock),a.input=0,i.toString=function(){return"> "+o},i.presetInit&&i.presetInit(),i}}();return i.Chorus=function(e,t,i){var n=e||1,r=i||ms(1),o=t||0,a=Flanger(n,o,r,30*ms(1));return a.name="Chorus",a.type="FX",a},i.LPF=function(e,t){var i=isNaN(e)?.2:e,n=isNaN(t)?3.5:t,r=Filter24(i,n,!0);return r.name="LPF",r.type="FX",r},i.HPF=function(e,t){var i=isNaN(e)?.25:e,n=isNaN(t)?3.5:t,r=Filter24(i,n,!0);return r.isLowPass=!1,r.name="HPF",r.type="FX",r},i.Presets.Schizo={sane:{chance:.1,reverseChance:0,pitchChance:.5,mix:.5},borderline:{chance:.1,pitchChance:.25,reverseChance:.5,mix:1},paranoid:{chance:.2,reverseChance:.5,pitchChance:.5,mix:1}},i.Presets.Reverb={space:{roomSize:.99,damping:.23,wet:.75,dry:.25},small:{roomSize:.6,damping:.75,wet:.15,dry:.85},medium:{roomSize:.8,damping:.5,wet:.35,dry:.65},large:{roomSize:.85,damping:.3,wet:.55,dry:.45}},i.Presets.StereoVerb={space:{roomSize:.99,damping:.23,wet:.75,dry:.25},small:{roomSize:.6,damping:.75,wet:.15,dry:.85},medium:{roomSize:.8,damping:.5,wet:.35,dry:.65},large:{roomSize:.85,damping:.3,wet:.55,dry:.45}},i.Presets.Crush={clean:{sampleRate:1,bitDepth:16},dirty:{sampleRate:.25,bitDepth:4},filthy:{sampleRate:.1,bitDepth:2.5}},i}},{"gibberish-dsp":1}],16:[function(e,t){t.exports=function(e){e.apiKey="4287s0onpqpp492n8snr27sp3o228nns".replace(/[a-zA-Z]/g,function(e){return String.fromCharCode(("Z">=e?90:122)>=(e=e.charCodeAt(0)+13)?e:e-26)});var t=function(){var i,n,r=Sampler(),o=arguments[0]||96541,a=null;r.done=function(e){a=e};var s=function(e){Gibber.log(i+" loaded."),Gibber.Audio.Core.context.decodeAudioData(e.response,function(e){t.loaded[i]=e.getChannelData(0),r.buffer=t.loaded[i],r.bufferLength=r.buffer.length,r.isLoaded=!0,r.setBuffer(r.buffer),r.setPhase(r.bufferLength),r.filename=i,r.isPlaying=!0,r.file=i,r.onload&&r.onload(),0!==r.playOnLoad&&r.note(self.playOnLoad),r.send(Master,1),a&&a()},function(e){console.log("Error with decoding audio data"+e.err)})};if("string"==typeof o){var l=o;Gibber.log("searching freesound for "+l),e.search(l,0,"duration:[0.0 TO 10.0]","rating_desc",null,null,null,function(n){if(i=n.sounds[0].original_filename,"undefined"==typeof t.loaded[i]){var o=new XMLHttpRequest;Gibber.log("now downloading "+i+", "+n.sounds[0].duration+" seconds in length"),o.open("GET",n.sounds[0].serve+"?&api_key="+e.apiKey,!0),o.responseType="arraybuffer",o.onload=function(){s(o)},o.send()}else r.buffer=t.loaded[i],r.filename=i,r.bufferLength=r.buffer.length,r.isLoaded=!0,r.end=r.bufferLength,r.setBuffer(r.buffer),r.setPhase(r.bufferLength),r.send(Master,1),a&&a()},function(){displayError("Error while searching...")})}else if("object"==typeof o){var l=o.query,u=o.filter||"",c=o.sort||"rating_desc",h=o.page||0;pick=o.pick||0,Gibber.log("searching freesound for "+l),u+=" duration:[0.0 TO 10.0]",e.search(l,h,u,c,null,null,null,function(l){if(l.num_results>0){var u=0;"number"==typeof o.pick?u=o.pick:"function"==typeof o.pick?u=o.pick():"random"===o.pick&&(u=rndi(0,l.sounds.length)),i=l.sounds[u].original_filename,"undefined"==typeof t.loaded[i]?(n=new XMLHttpRequest,Gibber.log("now downloading "+i+", "+l.sounds[u].duration+" seconds in length"),n.open("GET",l.sounds[u].serve+"?&api_key="+e.apiKey,!0),n.responseType="arraybuffer",n.onload=function(){s(n)},n.send()):(Gibber.log("using exising loaded sample "+i),r.buffer=t.loaded[i],r.bufferLength=r.buffer.length,r.isLoaded=!0,r.end=r.bufferLength,r.setBuffer(r.buffer),r.setPhase(r.bufferLength),r.send(Master,1),a&&a())}else Gibber.log("No Freesound files matched your query.")},function(){console.log("Error while searching...")})}else"number"==typeof o&&(Gibber.log("downloading sound #"+o+" from freesound.org"),e.get_sound(o,function(t){n=new XMLHttpRequest,i=t.original_filename,n.open("GET",t.serve+"?api_key="+e.apiKey,!0),n.responseType="arraybuffer",n.onload=function(){s(n)},n.send()}));return r};return t.loaded={},t}},{}],17:[function(e,t){t.exports=function(e){e.setToken("6a00f80ba02b2755a044cc4ef004febfc4ccd476");var t=function(){var i,n=Sampler(),r=arguments[0]||96541,o=null;n.done=function(e){o=e};var a=function(e){Gibber.log("Freesound file "+i+" loaded."),Gibber.Audio.Core.context.decodeAudioData(e.response,function(e){t.loaded[i]=e.getChannelData(0),n.buffer=t.loaded[i],n.bufferLength=n.buffer.length,n.isLoaded=!0,n.setBuffer(n.buffer),n.setPhase(n.bufferLength),n.filename=i,n.length=n.bufferLength,n.isPlaying=!0,Gibber.Audio.Core.audioFiles[n.filename]=e,n.buffers[n.filename]=e,n.file=i,n.send(Master,1),o&&o()},function(e){console.log("Error with decoding audio data"+e.err)})};if("string"==typeof r){var s=r;Gibber.log("searching freesound for "+s),e.textSearch(s,{page:1},function(r){r=JSON.parse(r),i=r.results[0].name;var s=r.results[0].id;"undefined"==typeof t.loaded[i]?e.getSound(s,function(e){var t=new XMLHttpRequest,i=JSON.parse(e),n=i.previews["preview-hq-mp3"];t.open("GET",n,!0),t.responseType="arraybuffer",t.onload=function(){a(t)},t.send()},null):(n.buffer=t.loaded[i],n.filename=i,n.bufferLength=n.buffer.length,n.isLoaded=!0,n.end=n.bufferLength,n.setBuffer(n.buffer),n.setPhase(n.bufferLength),n.send(Master,1),o&&o())},function(){displayError("Error while searching...")})}else if("object"==typeof r){{var s=r.query,l=r.filter||"";r.sort||"rating_desc",r.page||0}pick=r.pick||0,Gibber.log("Searching freesound for "+s),l+=" duration:[0.0 TO 10.0]",e.textSearch(s,null,function(s){var l=JSON.parse(s);if(l.count>0){var u=0;"number"==typeof r.pick?u=r.pick:"function"==typeof r.pick?u=r.pick():"random"===r.pick&&(u=rndi(0,l.results.length-1));var c=l.results[u];i=c.name;var h=c.id;"undefined"==typeof t.loaded[i]?"undefined"==typeof t.loaded[i]?e.getSound(h,function(e){var t=new XMLHttpRequest,i=JSON.parse(e),n=i.previews["preview-hq-mp3"];t.open("GET",n,!0),t.responseType="arraybuffer",t.onload=function(){a(t)},t.send()},null):(n.buffer=t.loaded[i],n.filename=i,n.bufferLength=n.buffer.length,n.isLoaded=!0,n.end=n.bufferLength,n.setBuffer(n.buffer),n.setPhase(n.bufferLength),n.send(Master,1),o&&o()):(Gibber.log("using exising loaded sample "+i),n.buffer=t.loaded[i],n.bufferLength=n.buffer.length,n.isLoaded=!0,n.end=n.bufferLength,n.setBuffer(n.buffer),n.setPhase(n.bufferLength),n.send(Master,1),o&&o())}else Gibber.log("No Freesound files matched your query.")},function(){console.log("Error while searching...")})}else if("number"==typeof r){Gibber.log("Searching for and downloading sound #"+r+" from Freesound...");var u=i=r;"undefined"==typeof t.loaded[i]?e.getSound(u,function(e){var t=new XMLHttpRequest,i=JSON.parse(e),n=i.previews["preview-hq-mp3"];t.open("GET",n,!0),t.responseType="arraybuffer",t.onload=function(){a(t)},t.send()},null):(n.buffer=t.loaded[i],n.filename=i,n.bufferLength=n.buffer.length,n.isLoaded=!0,n.end=n.bufferLength,n.setBuffer(n.buffer),n.setPhase(n.bufferLength),n.send(Master,1),o&&o())}return n};return t.getSoundByID=function(t){Gibber.log("downloading sound #"+t+" from freesound.org"),e.getSound(t,function(e){var t=JSON.parse(e),i=t.previews["preview-hq-mp3"];filename=t.name,request=new XMLHttpRequest,request.open("GET",i,!0),request.responseType="arraybuffer",request.onload=function(){onload(request)},request.send()},function(e){console.log("ERROR with id",e)})},t.loaded={},t}},{}],18:[function(e,t){t.exports=function(t){"use strict";for(var i=t.dollar,n={Presets:{}},r=e("gibberish-dsp"),o=t.outputCurves,a=o.LINEAR,s=o.LOGARITHMIC,l=["Sine","Triangle","Saw","Square","Noise","PWM"],u={frequency:{min:50,max:3200,hardMin:.01,hardMax:22050,output:s,timescale:"audio",dimensions:1},amp:{min:0,max:1,hardMax:2,output:s,timescale:"audio",dimensions:1},pulsewidth:{min:.01,max:.99,output:a,timescale:"audio",dimensions:1},out:{min:0,max:1,output:a,timescale:"audio",dimensions:1},pan:{min:-1,max:1,output:s,timescale:"audio"},note:{min:50,max:3200,hardMin:.01,hardMax:22050,output:s,timescale:"audio",doNotProxy:!0}},c=0;c<l.length;c++)!function(){var e=Array.isArray(l[c])?l[c][0]:l[c],o=Array.isArray(l[c])?l[c][1]:l[c];n[o]=function(){var n=(new r[e]).connect(t.Master),a=Array.prototype.slice.call(arguments,0);n.type="Gen",i.extend(!0,n,t.Audio.ugenTemplate),n.fx.ugen=n,Object.defineProperty(n,"_",{get:function(){return n.kill(),n},set:function(){}}),"undefined"==typeof n.note&&(n.note=function(e){var t=this.frequency();"number"==typeof t||"function"==typeof t?this.frequency="function"==typeof e?e():e:t[0]=e}),n.name=o,t.createProxyProperties(n,u);var s=["note","send"];return"Sampler"===o&&s.push("pickBuffer"),t.createProxyMethods(n,s),t.processArguments2(n,a,o),n.toString=function(){return"> "+o},n}}();return n.Wavetable=function(e){var n=(new r.Table).connect(t.Master);return e&&n.setTable(e),n.type="Gen",i.extend(!0,n,t.Audio.ugenTemplate),n.fx.ugen=n,Object.defineProperty(n,"_",{get:function(){return n.kill(),n},set:function(){}}),"undefined"==typeof n.note&&(n.note=function(e){var t=this.frequency();"number"==typeof t||"function"==typeof t?this.frequency="function"==typeof e?e():e:t[0]=e}),t.createProxyProperties(n,{frequency:{min:50,max:3200,output:s,timescale:"audio",dimensions:1},amp:{min:0,max:1,output:s,timescale:"audio",dimensions:1},out:{min:0,max:1,output:a,timescale:"audio",dimensions:1}}),t.createProxyMethods(n,["note"]),n.toString=function(){return"> Wavetable"},n},n.Grains=function(){var e,n,o="object"==typeof arguments[0]?arguments[0]:arguments[1],a=o.bufferLength||88200;if(o.input?e=Sampler().record(o.input,a):o.buffer&&(a=o.buffer.length),"string"==typeof arguments[0]){var s=t.Presets.Grains[arguments[0]];"undefined"!=typeof o&&i.extend(s,o),n=new r.Granulator(s)}else n=new r.Granulator(o);return n.loop=function(e,i,o,a){var s=this.position;e=isNaN(e)?.25:e,i=isNaN(i)?.75:i,o=t.Clock.time(isNaN(o)?1:o),a="undefined"==typeof a?!0:a,this.position=new r.Line(e,i,o,a);var l=this;return a===!1&&future(function(){l.position=s},t.Clock.time(o)),n},e?future(function(){n.setBuffer(e.getBuffer()),n.connect(),n.loop(0,1,a),e.disconnect()},a+1):(n.connect(),n.loop(0,1,a)),n.type="Gen",i.extend(!0,n,t.Audio.ugenTemplate),n.fx.ugen=n,Object.defineProperty(n,"_",{get:function(){return n.disconnect(),n},set:function(){}}),n.toString=function(){return"Grains"},n},n.Presets.Grains={tight:{numberOfGrains:10,grainSize:1100,positionMin:-.05,positionMax:.05,speedMin:-.1,speedMax:.1,shouldReverse:!1},cloudy:{numberOfGrains:20,positionMin:-.25,positionMax:.25,speedMin:-.1,speedMax:4,grainSize:4400,shouldReverse:!0},flurry:{speed:2,speedMin:-2,speedMax:2,position:0,positionMin:0,positionMax:0,numberOfGrains:20,grainSize:1100}},n}},{"gibberish-dsp":1}],19:[function(e,t){t.exports=function(e){"use strict";var t,i=function(e,i,n){var r=new XMLHttpRequest;r.open("GET",i,!0),r.responseType="arraybuffer",r.onload=function(){t.context.decodeAudioData(r.response,function(e){n(e)})},r.send()},n=null,r=null,o=null,a=null,s=null,l=e.AudioPostProcessing={initialized:!1,getPostgraph:function(){return a},init:function(){this.initialized||(t=e.Audio.Core,a=[t.node,t.context.destination],this.initialized=!0,$.subscribe("/gibber/clear",l.clear.bind(this)))},clear:function(){this.disconnectGraph(),a=[t.node,t.context.destination],this.connectGraph()},disconnectGraph:function(){for(var e=0;e<a.length-1;e++)a[e].disconnect(a[e+1])},connectGraph:function(){for(var e=0;e<a.length-1;e++)a[e].connect(a[e+1])},insert:function(e,t){if("undefined"!=typeof t){if(!(t>0&&t<a.length-1))return void console.error("Invalid position for inserting into postprocessing graph: ",t);l.disconnectGraph(),a.splice(t,0,e)}else l.disconnectGraph(),a.splice(1,0,e);l.connectGraph()},Compressor:function(e){if(null===n){l.init(),n=t.context.createDynamicsCompressor();var i=n.threshold,r=n.ratio,o=n.attack,a=n.release;Object.defineProperties(n,{threshold:{get:function(){return i.value},set:function(e){i.value=e}},ratio:{get:function(){return r.value},set:function(e){r.value=e}},attack:{get:function(){return o.value},set:function(e){o.value=e}},release:{get:function(){return a.value},set:function(e){a.value=e}}}),l.insert(n,e)}return n},MasterVerb:function(e){return null===s?("undefined"==typeof e&&(e="smallPlate"),s=t.context.createConvolver(),s.impulseName=e,i(t.context,"resources/impulses/"+e+".wav",function(e){s.buffer=e}),t.reverbOut.connect(s),s.gainNode=t.context.createGain(),s.gainNode.connect(t.context.destination),s.connect(s.gainNode),Object.defineProperty(s,"gain",{get:function(){return s.gainNode.gain.value},set:function(e){s.gainNode.gain.value=e}}),s.gain=.2):e!==s.impulseName&&i(t.context,"resources/impulses/"+e+".wav",function(t){s.impulseName=e,s.buffer=t}),s},LowShelf:function(e){if(null===o){o=t.context.createBiquadFilter(),o.type=3,o.frequency.value=220,o.Q.value=0,o.gain.value=6;var i=o.gain,n=o.frequency,r=o.Q;Object.defineProperties(o,{frequency:{get:function(){return n.value},set:function(e){n.value=e}},gain:{get:function(){return i.value},set:function(e){i.value=e}},Q:{get:function(){return r.value},set:function(e){r.value=e}}}),l.insert(o,e)}return o},HiShelf:function(e){if(null===r){r=t.context.createBiquadFilter(),r.type=4,r.frequency.value=880,r.Q.value=0,r.gain.value=6;var i=r.gain,n=r.frequency,o=r.Q;Object.defineProperties(r,{frequency:{get:function(){return n.value},set:function(e){n.value=e}},gain:{get:function(){return i.value},set:function(e){i.value=e}},Q:{get:function(){return o.value},set:function(e){o.value=e}}}),l.insert(r,e)}return r}};return l}},{}],20:[function(e,t){t.exports=function(t){"use strict";var i={Presets:{}},n=e("gibberish-dsp"),r=t.dollar,o=e("./clock")(t),a=t.outputCurves,s=a.LINEAR,l=a.LOGARITHMIC,u={amp:{min:0,max:1,hardMax:2,output:l,timescale:"audio",dimensions:1},start:{min:0,max:1,output:s,timescale:"audio",dimensions:1},end:{min:0,max:1,output:s,timescale:"audio",dimensions:1},pitch:{min:1,max:4,hardMin:.01,hardMax:20,output:l,timescale:"audio"},out:{min:0,max:1,output:s,timescale:"audio",dimensions:1},pan:{min:-1,max:1,output:l,timescale:"audio"},note:{min:.1,max:4,output:l,timescale:"audio",doNotProxy:!0}};return i.Sampler=function(){var e,i,o=Array.prototype.slice.call(arguments,0),a=o[0]&&o[0].file?o[0].file:void 0,s="Sampler";o[0]&&o[0].buffer&&(i=o[0].buffer),e=i?new n.Sampler({buffer:i}).connect(t.Master):new n.Sampler(a).connect(t.Master),e.type="Gen",r.extend(!0,e,t.Audio.ugenTemplate),e.fx.ugen=e,Object.defineProperty(e,"_",{get:function(){return e.kill(),e
},set:function(){}}),"undefined"==typeof e.note&&(e.note=function(e){var t=this.frequency();"number"==typeof t||"function"==typeof t?this.frequency="object"==typeof e?e.value:e:t[0]=e});var l=e.__lookupSetter__("start").bind(e),c=0;Object.defineProperty(e,"start",{configurable:!0,get:function(){return c},set:function(e){return c="number"==typeof e?e:e,l(c),c}});var h=e.__lookupSetter__("end").bind(e),f=1;Object.defineProperty(e,"end",{configurable:!0,get:function(){return f},set:function(e){return f="number"==typeof e?e:e,h(f),f}}),t.createProxyProperties(e,u);var p=["note","pickBuffer","switchBuffer","range"];return t.createProxyMethods(e,p),t.processArguments2(e,o,s),e.toString=function(){return s},e},n.Sampler.prototype.readFile=function(e){var t=this;if(e.isFile)return void e.file(function(e){t.readFile(e)});var i=new FileReader;i.readAsArrayBuffer(e),i.onload=function(){n.context.decodeAudioData(i.result,function(i){var r=i.getChannelData(0);t.setBuffer(r),t.length=r.length,t.buffers[e.name]=r,t.isPlaying=!0,n.audioFiles[e.name]=r,t.onload&&t.onload(),0!==t.playOnLoad&&t.note(t.playOnLoad),t.isLoaded=!0})}},n.Sampler.prototype.ondrop=function(e){for(var t=0;t<e.length;t++)!function(i){{var n,r=e[t];new FileReader}if(n=r.webkitGetAsEntry?r.webkitGetAsEntry():r,n.isDirectory){var o=n.createReader();o.readEntries(function(e){for(var t=e.length;t--;)i.readFile(e[t])})}else i.readFile(n)}(this)},n.Sampler.prototype.pickBuffer=function(){this.switchBuffer(rndi(0,this.getNumberOfBuffers()))},n.Sampler.prototype.record=function(e,i){this.isRecording=!0,console.log("starting recording");var r=this;return this.recorder=new n.Record(e,t.Clock.time(i),function(){console.log("recording finished"),r.setBuffer(this.getBuffer()),r.length=r.getBuffer().length,r.setPhase(r.length),r.isRecording=!1}).record(),this},n.Sampler.prototype.done=function(e){return this.onload=e,this},n.Sampler.prototype.load=function(e){function i(e,i){t.Audio.Core.context.decodeAudioData(e,function(e){var t=e.getChannelData(0);o.length=t.length,o.setPhase(o.length),o.setBuffer(t),o.isPlaying=!0,o.buffers[i]=t,o.file=i,n.audioFiles[i]=t,o.onload&&o.onload(),0!==o.playOnLoad&&o.note(o.playOnLoad),o.isLoaded=!0},function(e){console.log("Error decoding file",e)})}var i,r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){i(this.response,e)},r.send(),r.onerror=function(e){console.error("Sampler file loading error",e)};var o=this;return this},n.Sampler.prototype.loadDir=function(e){function t(e,t){for(var i=r(e),o=r(i).find("a"),a=0;a<o.length;a++){var s=o[a],l=s.href.split("/"),u=l[l.length-1];""!==u&&".DS_Store"!==u&&"node-ecstatic"!==u&&n.load(t+"/"+u)}}var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="html",i.onload=function(){t(this.response,e)},i.send(),console.log("now loading directory",e),i.onerror=function(e){console.error("Error loading directory",e)};var n=this;return this},i.Looper=function(e,i,n){var a=Bus();r.extend(a,{children:[],input:e,length:o.time(i),numberOfLoops:n,pitch:1,currentLoop:0,loop:function(){a.children[a.currentLoop].record(a.input,a.length);var e={target:a.children[a.currentLoop],durations:a.length,key:"note",values:[1]};return a.seq.add(e),a.seq.start(),future(a.nextLoop,i),a},nextLoop:function(){a.children[++a.currentLoop].record(a.input,a.length),a.currentLoop<a.numberOfLoops-1&&future(a.nextLoop,i);var e={target:a.children[a.currentLoop],durations:a.length,key:"note",values:[1]};a.seq.add(e)}});var s=1;Object.defineProperty(a,"pitch",{configurable:!0,get:function(){return s},set:function(e){s=e;for(var t=0;t<a.children.length;t++)a.children[t].pitch=s}});for(var l=0;n>l;l++)a.children.push(Sampler({pitch:a.pitch})._),a.children[l].send(a,1);return t.createProxyProperties(a,{pitch:u.pitch}),a.stop=function(){a.seq.stop()},a.play=function(){a.seq.start()},a},i}},{"./clock":11,"gibberish-dsp":1}],21:[function(e,t){t.exports=function(t){"use strict";var i=e("gibberish-dsp"),n=t.dollar,r={start:function(){return this.codeblock||this.connect(),this.isPaused=!1,this},stop:function(){return this.isPaused=!0,this},loop:function(e){return this.loopPause=e||0,this.shouldLoop=!this.shouldLoop,this},pause:function(){return this.isPaused=!0,this},next:function(){return this.codeblock||this.connect(),this.isPaused=!1,this}},o=new i.ugen;n.extend(o,r);var a=function(e,i){if(!(this instanceof a)){var r=Array.prototype.slice.call(arguments,0);return t.construct(a,r)}"undefined"==typeof i&&(i={}),this.timeline=[],this.schedule=[],this.shouldLoop=!1,this.loopPause=0;for(var o=0;o<e.length;o+=2)this.schedule.push(e[o]),this.timeline.push(e[o+1]);var s=0,l=0,u=this.timeline,c=this.schedule,h=this,f=function(){h.nextTime=s=0,l=-1,h.timeline.pop()};n.extend(this,{properties:{rate:1,isPaused:!0,nextTime:0},name:"score",getIndex:function(){return l},callback:function(e,t,i){if(!t){if(s>=i&&l<u.length){var n=u[l],r=!0;if(l++,l<=u.length-1){var o=c[l];"number"==typeof o&&o!==a.wait?h.nextTime=s+o:o===a.wait?h.isPaused=!0:o.owner instanceof a&&(h.isPaused=!0,o.owner.oncomplete.listeners.push(h))}else h.shouldLoop?(u[u.length-1]!==f&&u.push(f),h.nextTime=s+h.loopPause):h.isPaused=!0,h.oncomplete();r&&n&&(n instanceof a?n.codeblock?n.rewind().next():(n.start(),console.log("STARTING SCORE")):n())}s+=e}return 0},rewind:function(){return s=l=0,this.nextTime=this.schedule[0],this},oncomplete:function(){for(var e=this.oncomplete.listeners,t=e.length-1;t>=0;t--){var i=e[t];i instanceof a&&i.next()}}}),this.oncomplete.listeners=[],this.oncomplete.owner=this,this.init(),this.nextTime=this.schedule[0];var p=this.rate,d=this.__lookupSetter__("rate");Object.defineProperty(this,"rate",{get:function(){return p},set:function(e){p=Mul(t.Clock,e),d.call(this,p)}}),this.rate=this.rate,t.createProxyProperties(this,{rate:{min:.1,max:2,output:0,timescale:"audio"}})};return a.prototype=o,a.wait=-987654321,a.combine=function(){for(var e=[0,arguments[0]],t=1;t<arguments.length;t++){var i=2*t,n=i+1,r=i-1;e[i]=e[r].oncomplete,e[n]=arguments[t]}return a(e)},a}},{"gibberish-dsp":1}],22:[function(e,t){t.exports=function(t){var i=e("gibberish-dsp"),n=t.dollar,r=["durations","target","scale","offset","doNotStart","priority"],o=function(){var e,a={},s=[];if("object"!=typeof arguments[0]||Array.isArray(arguments[0]))("function"==typeof arguments[0]||Array.isArray(arguments[0]))&&(a.seqs=[{key:"functions",values:Array.isArray(arguments[0])?arguments[0]:[arguments[0]],durations:t.Clock.time(arguments[1])}],("function"==typeof arguments[1]||Array.isArray(arguments[1]))&&(a.seqs[0].durations=arguments[1]),s.push("functions"));else{var l=arguments[0],u=(typeof l.durations,typeof l.target,l.priority);if(a.target=l.target,"object"==typeof l.scale&&(a.scale=l.scale),"number"==typeof l.offset&&(a.offset=t.Clock.time(l.offset)),a.durations=l.durations,a.keysAndValues={},a.seqs=[],a.autofire=[],a.durations){Array.isArray(a.durations)||(a.durations=[a.durations]);var c=t.construct(t.Pattern,a.durations);if(a.durations.randomFlag){c.filters.push(function(){var e=t.Utilities.rndi(0,c.values.length-1);return[c.values[e],1,e]});for(var h=0;h<a.durations.randomArgs.length;h+=2)c.repeat(a.durations.randomArgs[h],a.durations.randomArgs[h+1])}}for(var f in l)!function(){var i=f;if(-1===r.indexOf(i)){var n,o=Array.isArray(l[i]),h={key:i,target:a.target,durations:c};if(o?n=t.construct(t.Pattern,l[i]):"undefined"!=typeof l[i]&&(n=t.construct(t.Pattern,[l[i]])),l[i].randomFlag){n.filters.push(function(){var e=t.Utilities.rndi(0,n.values.length-1);return[n.values[e],1,e]});for(var p=0;p<l[i].randomArgs.length;p+=2)n.repeat(l[i].randomArgs[p],l[i].randomArgs[p+1])}"note"===i&&n.filters.push(function(){var e=arguments[0][0];return"number"==typeof e&&e<t.minNoteFrequency&&(e=a.scale?a.scale.notes[e]:t.scale.notes[e]),[e,arguments[0][1],arguments[0][2]]}),h.values=n,h.stop=function(){h.shouldStop=!0},h.start=function(){h.shouldStop=!1,e.timeline[0]=[h],e.nextTime=0,e.isRunning||e.start(!1,u)},h.repeat=function(e){var t=0,i=function(i,n){return i[2]%(n.getLength()-1)===0&&0!==i[2]&&(t++,t===e&&n.seq.stop()),i};n.filters.push(i)},n.seq=h,a.seqs.push(h),s.push(i)}}();if("scale"in a){var p=(s.indexOf("note"),s.indexOf("chord"));if(p>-1){var d=n.extend([],a.seqs[p]),m=0;a.seqs[p]=[function(){var e,t=[];return e="function"==typeof d.pick?d[d.pick()]:"function"==typeof d[m]?d[m]():d[m++],t=a.scale.chord(e),m>=d.length&&(m=0),t}]}}}e=new i.PolySeq(a),e.timeModifier=t.Clock.time.bind(t.Clock),e.name="Seq",e.save={},e.oldShuffle=e.shuffle,delete e.shuffle,e.rate=t.Clock;var g=e.__lookupSetter__("rate"),v=e.rate;Object.defineProperty(e,"rate",{get:function(){return v},set:function(i){v=Mul(t.Clock,i),g.call(e,v)}});var y=e.nextTime,b=e.__lookupSetter__("nextTime");Object.defineProperty(e,"nextTime",{get:function(){return y},set:function(e){y=t.Clock.time(e),b(y)}});var x=e.offset;Object.defineProperty(e,"offset",{get:function(){return x},set:function(t){x=t,e.nextTime+=x}}),e.nextTime+=e.offset;for(var h=0;h<s.length;h++)!function(e){var t=s[h],i=h;Object.defineProperty(e,t,{get:function(){return e.seqs[i].values},set:function(t){e.seqs[i].values=t}})}(e);var w=c;return Object.defineProperty(e,"durations",{get:function(){return w},set:function(t){w=t;for(var i=0;i<e.seqs.length;i++){var n=e.seqs[i];n.durations=w}}}),arguments[0]&&!arguments[0].doNotStart&&e.start(!0),e.toString=function(){return"> Seq"},e.gibber=!0,n.extend(e,{constructor:o,replaceWith:function(){this.kill()},kill:function(){this.target&&this.target.sequencers&&this.target.sequencers.splice(this.target.sequencers.indexOf(this),1),console.log("SEQ KILL",this),this.stop().disconnect(),o.children.splice(o.children.indexOf(this),1)},applyScale:function(){},once:function(){return this.repeat(1),this},reset:function(){for(var e=0;e<this.seqs.length;e++)this.seqs[e].values[0].reset()},shuffle:function(){for(var e=0;e<this.seqs.length;e++)this.seqs[e].values[0].shuffle()}}),o.children.push(e),e};o.children=[];var a=function(){var e,i=arguments[0];return i.root=i.root||"c4",i.mode=i.mode||"aeolian",e=t.Theory.Scale(i.root,i.mode),delete i.root,delete i.mode,i.scale=e,o(i)},s={Seq:o,ScaleSeq:a};return s}},{"gibberish-dsp":1}],23:[function(e,t){t.exports=function(t,i){var n,r=e("gibberish-dsp"),o=t.outputCurves,a=e("./theory")(t).Teoria,s=o.LINEAR,l=o.LOGARITHMIC,u={amp:{min:0,max:1,hardMax:2,output:l,timescale:"audio",dimensions:1},loudness:{min:0,max:1,hardMax:2,output:l,timescale:"audio",dimensions:1},pan:{min:-1,max:1,output:s,timescale:"audio",dimensions:1}},c=function(e,t){return e*Math.pow(2,t/1200)};n={piano:"acoustic_grand_piano",guitar:"electric_guitar_clean",bass:"acoustic_bass",organ:"rock_organ",brass:"synth_brass_1",strings:"synth_strings_1",choir:"choir_aahs"};var h=function(e){var i,o=h.path;return t.Environment&&t.Environment.Storage.values.soundfonts&&t.Environment.Storage.values.soundfonts[e]&&(o=t.Environment.Storage.values.soundfonts[e]),n[e]&&(e=n[e]),i=new r.SoundFont(arguments[0],o).connect(t.Master),$.extend(!0,i,t.Audio.ugenTemplate),i.fx.ugen=i,i.chord=t.Theory.chord,Object.defineProperty(i,"_",{get:function(){return i.kill(),i},set:function(){}}),i.onload=function(){if(t.Environment&&t.Environment.Storage.values.saveSoundFonts){if(t.Environment.Storage.values.soundfonts){if(t.Environment.Storage.values.soundfonts[e])return}else t.Environment.Storage.values.soundfonts={};t.Environment.Storage.values.soundfonts[e]=t.Audio.Core.SoundFont.storage[e];try{t.Environment.Storage.save()}catch(i){console.log("STORAGE ERROR",i),"QuotaExceededError"===i.name&&console.log("Your localStorage for Gibber has been exceeded; we can't save the soundfile. It is still usable.")}}},i._note=i.note.bind(i),i.note=function(e,n){if("number"==typeof e){if(e<t.minNoteFrequency){var r=this.scale||t.scale,o=r.notes[e];if(this.octave&&0!==this.octave)for(var s=this.octave>0?1:0,l=Math.abs(this.octave),u=0;l>u;u++)o*=s?2:.5;e=o}var h,f=a.frequency.note(e),p=0;if(1===f.note.accidental.value&&"b"!==f.note.accidental.sign)for(var d=f.note.enharmonics(),u=0;u<d.length;u++){var m=d[u];if("b"===m.accidental.sign){f.note=m;break}}p=f.cents,h=f.note.name.toUpperCase(),0!==f.note.accidental.value&&(h+=f.note.accidental.sign),h+=f.note.octave,e=h}else if("string"!=typeof e)return;"undefined"==typeof n&&(n=this.loudness.value),i._note(e,n,c(1,p))},t.createProxyProperties(i,u),t.defineProperty(i,"loudness",!0,!0,{min:0,max:1,output:l,timescale:"audio",perNote:!0},!0,!0),t.createProxyMethods(i,["note","chord","send"]),i};return h.path=i||"../../../resources/soundfonts/",h}},{"./theory":25,"gibberish-dsp":1}],24:[function(e,t){t.exports=function(t){"use strict";for(var i={Presets:{}},n=e("gibberish-dsp"),r=t.dollar,o=e("./clock")(t),a=t.outputCurves,s=a.LINEAR,l=a.LOGARITHMIC,u=[["PolySynth","Synth"],["PolyFM","FM"],["PolySynth2","Synth2"],["MonoSynth","Mono"],["PolyKarplusStrong","Pluck"]],c={Synth:{note:{min:50,max:3200,output:l,timescale:"audio",doNotProxy:!0},frequency:{min:50,max:3200,output:l,timescale:"audio"},amp:{min:0,max:1,output:l,timescale:"audio"},pulsewidth:{min:.01,max:.99,output:s,timescale:"audio",perNote:!0},attack:{min:o.maxMeasures+1,max:176400,output:s,timescale:"audio",perNote:!0},decay:{min:o.maxMeasures+1,max:176400,output:s,timescale:"audio",perNote:!0},sustain:{min:o.maxMeasures+1,max:176400,output:s,timescale:"audio",perNote:!0},release:{min:o.maxMeasures+1,max:176400,output:s,timescale:"audio",perNote:!0},pan:{min:-1,max:1,output:l,timescale:"audio",perNote:!0},sustainLevel:{min:.01,max:1,output:l,timescale:"audio",perNote:!0},out:{min:0,max:1,output:s,timescale:"audio",dimensions:1}},Synth2:{note:{min:50,max:3200,output:l,timescale:"audio",doNotProxy:!0},frequency:{min:50,max:3200,output:s,timescale:"audio"},amp:{min:0,max:1,output:l,timescale:"audio"},pulsewidth:{min:.01,max:.99,output:s,timescale:"audio",perNote:!0},attack:{min:o.maxMeasures+1,max:176400,output:s,timescale:"audio",perNote:!0},decay:{min:o.maxMeasures+1,max:176400,output:s,timescale:"audio",perNote:!0},sustain:{min:o.maxMeasures+1,max:176400,output:s,timescale:"audio",perNote:!0},release:{min:o.maxMeasures+1,max:176400,output:s,timescale:"audio",perNote:!0},sustainLevel:{min:.01,max:1,output:l,timescale:"audio",perNote:!0},cutoff:{min:0,max:.7,output:s,timescale:"audio",perNote:!0},resonance:{min:0,max:5.5,output:s,timescale:"audio",perNote:!0},pan:{min:-1,max:1,output:l,timescale:"audio",perNote:!0},out:{min:0,max:1,output:s,timescale:"audio",dimensions:1}},Mono:{note:{min:50,max:3200,output:l,timescale:"audio",doNotProxy:!0},frequency:{min:50,max:3200,output:s,timescale:"audio"},amp:{min:0,max:1,output:l,timescale:"audio"},pulsewidth:{min:.01,max:.99,output:s,timescale:"audio"},attack:{min:o.maxMeasures+1,max:176400,output:l,timescale:"audio"},decay:{min:o.maxMeasures+1,max:176400,output:l,timescale:"audio"},cutoff:{min:0,max:.7,output:s,timescale:"audio"},detune2:{min:0,max:.15,output:s,timescale:"audio"},detune3:{min:0,max:.15,output:s,timescale:"audio"},glide:{min:.99,max:.999995,output:s,timescale:"audio"},resonance:{min:0,max:5.5,output:s,timescale:"audio"},pan:{min:-1,max:1,output:l,timescale:"audio"},out:{min:0,max:1,output:s,timescale:"audio",dimensions:1}},FM:{note:{min:50,max:3200,output:l,timescale:"audio",doNotProxy:!0},frequency:{min:50,max:3200,output:s,timescale:"audio"},amp:{min:0,max:1,output:l,timescale:"audio"},attack:{min:o.maxMeasures+1,max:176400,output:s,timescale:"audio",perNote:!0},decay:{min:o.maxMeasures+1,max:176400,output:s,timescale:"audio",perNote:!0},sustain:{min:o.maxMeasures+1,max:176400,output:s,timescale:"audio",perNote:!0},release:{min:o.maxMeasures+1,max:176400,output:s,timescale:"audio",perNote:!0},sustainLevel:{min:.01,max:1,output:l,timescale:"audio",perNote:!0},cmRatio:{min:.1,max:50,output:s,timescale:"audio",perNote:!0},index:{min:.1,max:50,output:s,timescale:"audio",perNote:!0},pan:{min:-1,max:1,output:l,timescale:"audio",perNote:!0},out:{min:0,max:1,output:s,timescale:"audio",dimensions:1}},Pluck:{note:{min:50,max:3200,output:l,timescale:"audio",doNotProxy:!0},frequency:{min:50,max:3200,output:s,timescale:"audio"},amp:{min:0,max:1,output:l,timescale:"audio"},blend:{min:0,max:1,output:s,timescale:"audio",perNote:!0},damping:{min:0,max:1,output:s,timescale:"audio",perNote:!0},pan:{min:-1,max:1,output:l,timescale:"audio",perNote:!0},out:{min:0,max:1,output:s,timescale:"audio",dimensions:1}}},h=0;h<u.length;h++)!function(){var e=Array.isArray(u[h])?u[h][0]:u[h],o=Array.isArray(u[h])?u[h][1]:u[h];i[o]=function(){{var i,a=Array.prototype.slice.call(arguments,0),s={};"string"==typeof a[0]?1:0}t.processArguments2(s,a,o);for(var u in s)t.Audio.Clock.timeProperties.indexOf(u)>-1&&(s[u]=t.Clock.time(s[u]));if(i=new n[e](s).connect(t.Master),i.type="Gen",r.extend(!0,i,t.Audio.ugenTemplate),i.fx.ugen=i,"Vocoder"===o)return i;"Mono"===o&&(i.note=function(e,t){"undefined"!=typeof e&&("undefined"!=typeof t&&0!==t&&(this.amp=t),0!==t&&("object"!=typeof this.frequency?this.frequency=e:"property"!==this.frequency.type?(this.frequency[0]=e,n.dirty(this)):this.frequency=e,this.lastFrequency=this.frequency,i.envelope.getState()>0&&i.envelope.run()))}),i._note=i.note.bind(i),i.note=function(){var e,n=Array.prototype.slice.call(arguments,0);if("undefined"!=typeof n[0])return Array.isArray(n[0])?(e=n[0][0],e=t.Theory.processFrequency(i,e),n[0][0]=e):n[0]=t.Theory.processFrequency(i,n[0]),"undefined"==typeof n[1]&&(n[1]=this.loudness.value),this._note.apply(this,n),this.processChildProperties(),this};var h=Object.keys(c[o]),f=0;if(i.processChildProperties=function(){for(var e=0;e<h.length;e++){var t,i=h[e],n=i+"V";if(this[n]&&"undefined"!=typeof this[n].value){if(Array.isArray(this[n].value)){var r=f%this[n].value.length;t=this[n].value[r]}else t="function"==typeof this[n].value?this[n].value():this[n].value;this.children[this.lastChild][i]=t}}f++},i.chord=t.Theory.chord.bind(i),Object.defineProperty(i,"_",{get:function(){return i.kill(),i},set:function(){}}),t.createProxyProperties(i,c[o]),t.defineProperty(i,"loudness",!0,!0,{min:0,max:1,output:l,timescale:"audio"},!0,!0),i.trig=function(){this.note(this.lastFrequency)},t.createProxyMethods(i,["note","chord","send","trig"]),i.name=o,i.toString=function(){return o},"Mono"!==o){var p=i._frequency;Object.defineProperty(i,"frequency",{configurable:!0,get:function(){return this._frequency},set:function(e){if(p=e,this.children)for(var t=0;t<this.children.length;t++)"number"==typeof this.children[t].frequency?this.children[t].frequency=p:this.children[t].frequency[0]=p}})}var d=i.scale;return i.scale&&(i.seq.scale=d),Object.defineProperty(i,"scale",{get:function(){return d},set:function(e){d=e,i.seq.scale=d}}),i.presetInit&&i.presetInit(),i}}();return i.Presets.Synth={"short":{attack:44,decay:1/16},bleep:{waveform:"Sine",attack:44,decay:1/16},bleepEcho:{waveform:"Sine",attack:44,decay:1/16,presetInit:function(){this.fx.add(Delay(1/6,.85))}},cascade:{waveform:"Sine",maxVoices:10,attack:o.maxMeasures,decay:o.beats(1/32),presetInit:function(){this.fx.add(t.Audio.FX.Delay(1/9,.2),t.Audio.FX.Flanger()),this.pan=Sine(.25,1)._}},rhodes:{waveform:"Sine",maxVoices:4,attack:44,decay:1,presetInit:function(){this.fx.add(t.Audio.FX.Tremolo(2,.2))}},calvin:{waveform:"PWM",maxVoices:4,amp:.075,attack:o.maxMeasures,decay:.25,presetInit:function(){this.fx.add(t.Audio.FX.Delay(1/6,.5),t.Audio.FX.Vibrato())}},warble:{waveform:"Sine",attack:o.maxMeasures,presetInit:function(){this.fx.add(t.Audio.FX.Vibrato(2),t.Audio.FX.Delay(1/6,.75))}}},i.Presets.Synth2={pad2:{waveform:"Saw",maxVoices:4,attack:1.5,decay:.5,cutoff:.3,filterMult:.35,resonance:4.5,amp:.2,presetInit:function(){this.fx.add(t.Audio.FX.Delay(1/9,.75))}},pad4:{waveform:"Saw",maxVoices:4,attack:2,decay:2,cutoff:.3,filterMult:.35,resonance:4.5,amp:.2,presetInit:function(){this.fx.add(t.Audio.FX.Delay(1/9,.75))}}},i.Presets.Mono={"short":{attack:44,decay:1/16},lead:{presetInit:function(){this.fx.add(t.Audio.FX.Delay(.25,.35),t.Audio.FX.Reverb())},attack:1/8,decay:.5,octave3:0,cutoff:.2,filterMult:.5,resonance:5,isLowPass:!1},winsome:{presetInit:function(){this.lfo=t.Audio.Oscillators.Sine(2,.075)._,this.cutoff=this.lfo,this.detune2=this.lfo},attack:o.maxMeasures,decay:1,cutoff:.2},bass:{attack:o.maxMeasures,decay:1/8-o.maxMeasures,octave:-2,octave2:-1,cutoff:.5,filterMult:.2,resonance:1},bass2:{attack:o.maxMeasures,decay:1/6,octave:-2,octave2:0,octave3:0,cutoff:.5,filterMult:.2,resonance:1,amp:.65},edgy:{presetInit:function(){this.decay=1/8,this.attack=ms(1)},octave:-2,octave2:-1,cutoff:.5,filterMult:.2,resonance:1,waveform:"PWM",pulsewidth:.2,detune2:0,amp:.2},easy:{attack:o.maxMeasures,decay:2,octave2:0,octave3:0,cutoff:.3,glide:.9995},easyfx:{attack:o.maxMeasures,decay:2,presetInit:function(){this.fx.add(t.Audio.FX.Delay(o.time(1/6),.3))},amp:.3,octave2:0,octave3:0,cutoff:.3,glide:.9995},dark:{resonance:0,attack:44,cutoff:.075,amp:.35,filterMult:0},dark2:{filterMult:.1,attack:o.maxMeasures,octave2:0,octave3:0,decay:.25,amp:.45},noise:{resonance:20,decay:.5,cutoff:.3,glide:.99995,detune3:0,detune2:0,filterMult:0,presetInit:function(){this.fx.add(t.Audio.FX.Gain(.1),t.Audio.FX.Delay(1/6,.35))}}},i.Presets.FM={stabs:{maxVoices:4,cmRatio:1/1.0007,index:5,attack:o.maxMeasures,decay:1/8,amp:.1,presetInit:function(){this.bus=t.Audio.Busses.Bus().fx.add(t.Audio.FX.Delay(1/8,.75),t.Audio.FX.LPF({resonance:4})),this.bus.fx[1].cutoff=t.Audio.Core.Binops.Add(.25,t.Audio.Oscillators.Sine(.1,.2)._),this.send(this.bus,.65)}},bass:{cmRatio:1,index:3,presetInit:function(){this.attack=ms(1)},decay:1/16,octave:-2},glockenspiel:{cmRatio:3.5307,index:1,attack:44,decay:44100},radio:{cmRatio:1,index:40,attack:13230,decay:22050},noise:{cmRatio:.04,index:1e3,attack:44.1,decay:4410},frog:{cmRatio:.1,index:2,attack:13230,decay:220.5},gong:{cmRatio:1.4,index:.95,attack:44.1,decay:220500},drum:{cmRatio:1.40007,index:2,attack:44,decay:44100},drum2:{cmRatio:1+Math.sqrt(2),index:.2,attack:44,decay:882},brass:{maxVoices:4,cmRatio:1/1.0007,index:5,attack:4100,decay:1},clarinet:{cmRatio:1.5,index:1.5,attack:2205,decay:8820}},i}},{"./clock":11,"gibberish-dsp":1}],25:[function(e,t){t.exports=function(t){"use strict";var i=e("../../external/teoria.min"),n=t.dollar,r=function(e){return!isNaN(e)&&function(e){return(0|e)===e}(parseFloat(e))},o={Teoria:i,Scale:function(e,r){var a={root:"string"==typeof e?i.note(e):e,notes:[],degree:1,chord:function(e,t){var i=[];t=t||0,console.log("CHORD",e,this);for(var n=0;n<e.length;n++)i.push(this.notes[e[n]+t]);return i},create:function(){var e="number"!=typeof l?i.note(l).fq():l,n=s;if(this.notes.length=0,t.Theory.Scales[n]){var r=t.Theory.Scales[n](e);r.create(e),this.notes=r.notes}else console.log("No scale for the mode "+s+" exists.")},set:function(e,t){Array.isArray(arguments[0])?(this.root=arguments[0][0],this.mode=arguments[0][1]):(this.root=e,this.mode=t)}},s=r||"aeolian";Object.defineProperty(a,"mode",{configurable:!0,get:function(){return s},set:function(e){s=e,a.create()}});var l=e||440;return Object.defineProperty(a,"root",{get:function(){return l},set:function(e){"number"==typeof e?l=e:"string"==typeof e?l=o.Teoria.note(e).fq():"object"==typeof e&&(l=e.accidental?e.fq():o.Teoria.note(e.value).fq()),a.create()}}),a.gibber=!0,t.createProxyProperty(a,"root",!0,!1,null,!1,1),t.createProxyProperty(a,"mode",!0,!1,null,!1,1),n.subscribe("/gibber/clear",function(){a.seq.isConnected=!1,a.seq.isRunning=!1,a.seq.destinations.length=0}),a.create(l),a},CustomScale:function(e,t){var n={notes:[],degree:1,ratios:t||[1,1.1,1.25,1.3333,1.5,1.666,1.75],create:function(e){this.notes=[];for(var t="number"==typeof e?e:i.note(e).fq(),n=0;8>n;n++){for(var r=0;r<this.ratios.length;r++){var o=r,a=t*(1+Math.floor(o/this.ratios.length));this.notes.push(a*this.ratios[o%this.ratios.length])}t*=2}t="number"==typeof e?e:i.note(e).fq();for(var n=-1;n>=-8;n--){t/=2;for(var r=0;r<this.ratios.length;r++){var s=n*this.ratios.length+r,o=r,a=t*(1+Math.floor(o/this.ratios.length));this.notes[s]=a*this.ratios[o%this.ratios.length]}}},chord:function(e,t){var i=[];t=t||0;for(var n=0;n<e.length;n++)i.push(this.notes[e[n]+t]);return i}};return n.create(e),n},Scales:{Major:function(e){return o.CustomScale(e,[1,9/8,5/4,4/3,1.5,5/3,15/8])},Ionian:function(e){return o.CustomScale(e,[1,9/8,5/4,4/3,1.5,5/3,15/8])},Dorian:function(e){return o.CustomScale(e,[1,9/8,1.2,4/3,1.5,5/3,1.8])},Phrygian:function(e){return o.CustomScale(e,[1,16/15,1.2,4/3,1.5,1.6,1.8])},Lydian:function(e){return o.CustomScale(e,[1,9/8,5/4,45/32,1.5,5/3,15/8])},Mixolydian:function(e){return o.CustomScale(e,[1,9/8,5/4,4/3,1.5,1.6,1.8])},Minor:function(e){return o.CustomScale(e,[1,9/8,1.2,4/3,1.5,1.6,1.8])},Aeolian:function(e){return o.CustomScale(e,[1,9/8,1.2,4/3,1.5,1.6,1.8])},Locrian:function(e){return o.CustomScale(e,[1,16/15,1.2,4/3,62/45,1.6,15/8])},MajorPentatonic:function(e){return o.CustomScale(e,[1,9/8,5/4,1.5,5/3])},MinorPentatonic:function(e){return o.CustomScale(e,[1,1.2,4/3,1.5,15/8])},Chromatic:function(e){return o.CustomScale(e,[1,16/15,9/8,1.2,5/4,4/3,45/32,1.5,1.6,5/3,7/4,15/8])},HalfWhole:function(e){return o.CustomScale(e,[1,1.059463,1.189207,1.259921,1.414214,1.498307,1.681793,1.781797])},WholeHalf:function(e){return o.CustomScale(e,[1,1.122462,1.189207,1.33484,1.414214,1.587401,1.681793,1.887749])},Pythagorean:function(e){return o.CustomScale(e,[1,256/243,9/8,32/27,81/64,4/3,729/512,1.5,128/81,27/16,16/9,243/128])},PythagoreanMajor:function(e){return o.CustomScale(e,[1,9/8,81/64,4/3,1.5,27/16,243/128])},PythagoreanMinor:function(e){return o.CustomScale(e,[1,9/8,32/27,4/3,1.5,128/81,16/9])},Limit5:function(e){return o.CustomScale(e,[1,16/15,9/8,1.2,5/4,4/3,45/32,1.5,1.6,5/3,1.8,15/8])},Limit5Major:function(e){return o.CustomScale(e,[1,9/8,5/4,4/3,1.5,5/3,15/8])},Limit5Minor:function(e){return o.CustomScale(e,[1,9/8,1.2,4/3,1.5,1.6,1.8])},Mess3:function(e){return o.CustomScale(e,[1,1.122462,1.189207,1.259921,1.414214,1.498307,1.587401,1.781797,1.887749])},Mess4:function(e){return o.CustomScale(e,[1,1.059463,1.122462,1.33484,1.414214,1.498307,1.587401,1.887749])},Mess5:function(e){return o.CustomScale(e,[1,1.059463,1.33484,1.414214,1.498307,1.887749])},Mess6:function(e){return o.CustomScale(e,[1,1.122462,1.259921,1.33484,1.414214,1.587401,1.781797,1.887749])},Mess7:function(e){return o.CustomScale(e,[1,1.059463,1.122462,1.189207,1.33484,1.414214,1.498307,1.587401,1.681793,1.887749])},Adams:function(e){return o.CustomScale(e,[1,1.122462,1.259921,1.414214,1.498307,1.681793,1.781797])},Equal5Tone:function(e){return o.CustomScale(e,[1,1.15,1.32,1.35,1.52,1.74])},Equal7Tone:function(e){return o.CustomScale(e,[1,1.1,1.22,1.35,1.49,1.64,1.81])},Just:function(e){return o.CustomScale(e,[1,1.0417,1.125,1.2,1.25,1.3333,1.4063,1.5,1.6,1.6667,1.8,1.875])},Shruti:function(e){return o.CustomScale(e,[1,256/243,16/15,10/9,9/8,32/27,1.2,5/4,81/64,4/3,1.35,45/32,729/512,1.5,128/81,1.6,5/3,27/16,16/9,1.8,15/8,243/128,2])}},processFrequency:function(e,i){var n=i;if("string"==typeof i)n=t.Theory.Teoria.note(i).fq();else if(i<t.minNoteFrequency){var n,o=e.scale||t.scale,a=i,s=r(a);if(s)n=o.notes[i];else{var l=o.notes[Math.floor(a)],u=o.notes[Math.ceil(a)],c=a%1,h=u-l;n=l+c*h}if(e.octave&&0!==e.octave)for(var f=e.octave>0?1:0,p=Math.abs(e.octave),d=0;p>d;d++)n*=f?2:.5}return n},chord:function(e){if(this.notation=e,"string"==typeof this.notation){var t,n,r=this.notation.slice(0,1);isNaN(this.notation.charAt(1))?(r+=this.notation.charAt(1),t=parseInt(this.notation.slice(2,3)),n=this.notation.slice(3)):(t=parseInt(this.notation.slice(1,2)),n=this.notation.slice(2));for(var a=i.note(r+t).chord(n),s=0;s<a.notes.length;s++){var l=a.notes[s];this.note("number"==typeof c?c:l.fq())}}else for(var u=0;u<this.notation.length;u++){var c,h=this.scale?this.scale.notes[this.notation[u]]:this.notation[u];switch(typeof h){case"number":c=h;break;case"object":c=h.fq?h.fq():h;break;case"string":c=o.Teoria.note(h).fq()}this.note(c)}return"undefined"!=typeof arguments[1]&&(this.amp=arguments[1]),this}};return o}},{"../../external/teoria.min":4}],26:[function(e,t){t.exports=function(e){var t=function(t){var i=function(i){var n={};if($.extend(n,{properties:$.extend({},t.inputs),callback:t.callback.bind(n),_init:t.init.bind(n),name:t.name}),n.__proto__=e.Audio.Core._synth,"object"==typeof i)for(var r in i)n[r]=i[r];var o=["name","inputs","callback","init"],a=[];for(var r in t)-1===o.indexOf(r)&&(n[r]=t[r].bind(n),a.push(r));n.init.call(n),n.oscillatorInit.call(n),e.createProxyProperties(n,n.properties),e.createProxyMethods(n,a);for(var r in t.inputs)n[r]="object"==typeof i&&i[r]?i[r]:t.inputs[r].default;return n._init(),n.connect(e.Master),arguments.length>0&&e.processArguments2(n,Array.prototype.slice.call(arguments,0),n.name),$.extend(!0,n,e.Audio.ugenTemplate),n.fx.ugen=n,n};return i};return t}},{}],27:[function(e,t){t.exports=function(t){"use strict";var i={Presets:{}},n=e("gibberish-dsp"),r=t.dollar,o=(e("./clock")(t),t.outputCurves),a=o.LINEAR,s=o.LOGARITHMIC,l={amp:{min:0,max:1,output:s,timescale:"audio"},pan:{min:-1,max:1,output:s,timescale:"audio"},out:{min:0,max:1,output:a,timescale:"audio",dimensions:1}};return i.Vocoder=function(e,i,o,a,s,l){var u=new n.Vocoder(e,i,o,a,s,l).connect(t.Master);return u.type="Gen",r.extend(!0,u,t.Audio.ugenTemplate),u.fx.ugen=u,u},i.Robot=function(e){function i(){n.modulator=Speak(o),n.modulator._,n.say=n.modulator.say.bind(n),t.defineSequencedProperty(n,"say"),u&&(n.say.values=a,n.say.durations=s),n.connect()}var n,o=e||{};n=t.Audio.Vocoder.Vocoder(null,null,o.numBands||16),n.disconnect(),isNaN(o.maxVoices)&&(o.maxVoices=1),isNaN(o.resonance)&&(o.resonance=4),isNaN(o.attack)&&(o.attack=ms(1)),isNaN(o.decay)&&(o.decay=measures(8)),isNaN(o.pulsewidth)&&(o.pulsewidth=.05),n.carrier=t.Audio.Synths.Synth2(o),n.note=n.carrier.note.bind(n),n._note=n.carrier._note.bind(n),n.chord=n.carrier.chord.bind(n),n.carrier._;var a,s,u=!1;return n.say=function(e,t){u===!1&&(a=e,s=t,u=!0)},t.Modules["gibber/publications/SpeakLib"]?i():t.import("gibber/publications/SpeakLib").done(function(){var e=setInterval(function(){"undefined"!=typeof Speak&&(i(),clearInterval(e))},250)}),t.defineSequencedProperty(n,"say"),t.defineSequencedProperty(n,"chord"),t.defineSequencedProperty(n,"note"),r.extend(!0,n,t.Audio.ugenTemplate),t.createProxyProperties(n,l),n},i}},{"./clock":11,"gibberish-dsp":1}],28:[function(e,t){t.exports=function(t){var i={"export":function(e){e._MIDI_=this.MIDI,e.OSC=this.OSC},MIDI:e("./midi.js")(t),OSC:e("./osc.js")(t)};return i}},{"./midi.js":29,"./osc.js":30}],29:[function(e,t){t.exports=function(e){var t={_midi:null,inputs:[],outputs:[],seq:null,clock:function(i,n){var r=0,o=0,a=(e.Audio.Core.context,window.performance.now(),{output:t.outputs[i],channel:n||0,properties:{rate:e.Clock},name:"midi_clock",callback:function(e){var t=s/e/24;if(o++,r++>=t){r-=t,a.output.send([248])}return 0}}),s=22050;return a.__proto__=new e.Audio.Core.ugen,a.__proto__.init.call(a),a.connect(),t.Clock=a,a},readClock:function(e){this.clockMaster=e},init:function(){var n=this;return navigator.requestMIDIAccess().then(function(r){console.log("MIDI access granted.",r),n._midi=r;for(var o=n._midi.inputs.entries(),a=0,s=null,l={min:0,max:127,output:e.outputCurves.LINEAR,timescale:"interface"};null===s||o.done===!1;)!function(){t.inputs[a++]=s=o.next().value[1],Object.defineProperty(n,i,{get:function(){return s},set:function(){}}),s.onmidimessage=t.parse,s.defaultChannel=0,Object.defineProperties(s,{cc:{get:function(){return s.channel[s.defaultChannel].cc},set:function(){}},target:{get:function(){return s.channel[s.defaultChannel].target},set:function(e){s.channel[s.defaultChannel].target=e}}}),s.channel=[];for(var r=0;16>r;r++){s.channel[r]={target:null,cc:[]};for(var u=0;127>u;u++)s.channel[r].cc[u]={value:0,type:"mapping"},e.createProxyProperties(s.channel[r].cc[u],{value:l},!0,!0)}}();for(var u=null,c=n._midi.outputs.entries(),a=0;null===u||c.done===!1;)t.outputs[a++]=u=c.next().value[1],!function(){var t=u;
u.channel=[];for(var i=0;16>i;i++)!function(){var n=i;u.channel[i]={cc:[],note:function(e){var i=e[0],r="undefined"==typeof e[1]?127:e[1];"function"==typeof i&&(i=i()),"function"==typeof r&&(r=r()),t.send([144+n,i,r])}},e.defineSequencedProperty(u.channel[i],"note",!1);for(var r=0;127>r;r++)u.channel[i].cc[r]={value:0,type:"mapping"},e.createProxyProperties(u.channel[i].cc[r],{value:l},!0,!0)}()}()}.bind(this),function(){console.log("failed to initialize midi")}.bind(this)),this},channels:[],types:{8:"noteoff",9:"noteon",11:"cc",12:"programchange"},ntof:function(e){return 261.626*Math.pow(2,(e-49)/12)},log:!1,onmessage:null,showInputs:function(){for(var e=0;e<t._midi.inputs.length;e++){var i=t[e];console.log("Input port "+e+" |  manufacturer:"+i.manufacturer+", name: "+i.name)}},clockMaster:null,clockHistory:[],clockIndex:0,clockAvg:0,lastReceivedTime:0,clockBufferSize:12,clockReceived:function(i,n){if(this.clockMaster===i&&this.clockIsRunning){if(0===this.lastReceivedTime)return void(this.lastReceivedTime=n.receivedTime);var r=n.receivedTime-this.lastReceivedTime;this.clockAvg+=r,this.lastReceivedTime=n.receivedTime,this.clockAvg-=this.clockHistory[this.clockIndex]||0,this.clockHistory[this.clockIndex]=r,this.clockIndex=(this.clockIndex+1)%this.clockBufferSize;var o=this.clockAvg/this.clockHistory.length,a=24*o,s=1/(2*a/1e3);e.Clock.rate=t.clockRate=s}},clockRate:1,clockIsRunning:!1,onstartmessage:function(i){this.clockMaster===i&&(console.log("MIDI CLOCK START"),e.Clock.currentBeat=1,e.Clock.phase=0,e.Clock.rate=t.clockRate,this.clockHistory.length=0,this.lastReceivedTime=0,this.clockIndex=0,this.clockAvg=0,this.clockIsRunning=!0)},oncontinuemessage:function(e){console.log("CONTINUE"),this.clockMaster===e&&console.log("MC CONTINUE")},onstopmessage:function(t){console.log("MC END"),this.clockMaster===t&&(console.log("MIDI CLOCK END"),e.Clock.rate=0,this.clockIsRunning=!1)},onsppmessage:function(e,i){this.clockMaster===e&&0===i.data[1]&&0===i.data[2]&&t.onstartmessage(e)},processIncomingClock:function(e,i){var n=!0;switch(e.data[0]){case 242:t.onsppmessage(i,e),n=!1,console.log(e.data[0],e.data[1],e.data[2]);break;case 248:t.clockReceived(i,e);break;case 250:t.onstartmessage(i);break;case 251:t.oncontinuemessage(i);break;case 252:t.onstopmessage(i);break;default:n=!1}return n},parse:function(e){var i=t.inputs.indexOf(e.target),n=t.processIncomingClock(e,i);if(!n){var r=t.types[Math.floor(e.data[0]/16)],o=e.data[0]%16,a=e.data[1],s="undefined"!=typeof e.data[2]?e.data[2]:0;switch(t.log&&log(r,o,a,s,i),r){case"noteon":t.inputs[i].channel[o].target&&t.inputs[i].channel[o].target.note(t.ntof(a),s/127);break;case"noteoff":t.inputs[i].channel[o].target&&t.inputs[i].channel[o].target.note(t.ntof(a),0);break;case"cc":t.inputs[i].channel[o].cc[a].value(s)}t.onmessage&&t.onmessage(i,r,o,a,s),t.inputs[i].onmessage&&t[i.onmessage(r,o,a,s)]}}};return t}},{}],30:[function(e,t){t.exports=function(e){var t=e.OSC={callbacks:{},init:function(e){{var i=e||8080;t.socket=new WebSocket("ws://127.0.0.1:"+i)}t.socket.onopen=function(){console.log("OSC socket opened on port "+i+".")},t.socket.onmessage=t.onmessage},onmessage:function(e){var i;try{i=JSON.parse(e.data)}catch(n){return void console.error("ERROR on parsing OSC msg",n)}t.callbacks[i.address]?t.callbacks[i.address](i.parameters):t.callbacks["*"]&&(i.parameters.address=i.address,t.callbacks["*"](i.parameters))},send:function(e,i,n,r,o){var a={address:e,type:i.split(""),parameters:n,port:r,ipAddress:o,type:"OSC"};t.socket.send(JSON.stringify(a))}};return t}},{}],31:[function(e,t){(function(e){!function(){"use strict";function i(e,t,n){for(var r in t)n&&(c(t[r])||l(t[r]))?(c(t[r])&&!c(e[r])&&(e[r]={}),l(t[r])&&!l(e[r])&&(e[r]=[]),i(e[r],t[r],n)):void 0!==t[r]&&(e[r]=t[r])}var n="function"==typeof Zepto,r="function"==typeof jQuery,o="object"==typeof e.$||"function"==typeof e.$,a=null,s=n||r||o,l=Array.isArray,u=function(e){return"object"==typeof e},c=function(e){return u(e)&&Object.getPrototypeOf(e)==Object.prototype};a=s?r?jQuery:n?Zepto:o?e.$:{}:{},s||(a.extend=function(e){var t,n=Array.prototype.slice.call(arguments,1);return"boolean"==typeof e&&(t=e,e=n.shift()),n.forEach(function(n){i(e,n,t)}),e},a.isArray=Array.isArray,a.isPlainObject=c,a.type=function(e){return typeof e});var h={};a.subscribe=function(e,t){"undefined"==typeof h[e]&&(h[e]=[]),h[e].push(t)},a.unsubscribe=function(e,t){if("undefined"!=typeof h[e]){var i=h[e];i.splice(i.indexOf(t),1)}},a.publish=function(e,t){if("undefined"!=typeof h[e])for(var i=h[e],n=0;n<i.length;n++)i[n](t)},t.exports=a}()}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],32:[function(e,t){t.exports=function(){"use strict";var e=function(){for(var t=[],i=0,n=this.length;n>i;i++){var r=Object.prototype.toString.call(this[i]).split(" ").pop().split("]").shift().toLowerCase();r&&(t=t.concat(/^(array|collection|arguments|object)$/.test(r)?e.call(this[i]):this[i]))}return t},t=function(e,t){for(var i=[],n=0;t>n;n++)i.push([1]);for(var r=n;e>r;r++)i.push(0);return i},i=function(e){for(var t=0,i=0,n=0;n<e.length;n++)Array.isArray(e[n])&&(e[n].length>t?(t=e[n].length,i=1):e[n].length===t&&i++);return i},n=function(n,o,a){function s(t,n){var r=0===l++?n:i(u),o=u.length-r,a=r>=o?o:r;if(a>1||1===l)for(var c=0;a>c;c++){var h=u.pop(),f=Array.isArray(h);u[c].push(h),f&&e.call(u[c])}return t%n!==0?s(n,t%n):e.call(u)}var l=0,u=t(o,n);return r(s(o,n),a)},r=function(e,t){var i=[];console.log(e,t),"undefined"==typeof t&&(t=1/e.length);for(var n=0,r=0;n<e.length;)n++,r+=t,(1==e[n]||n===e.length)&&(i.push(r),r=0);return i},o={"1,4":"1000","2,3":"101","2,5":"10100","3,4":"1011","3,5":"10101","3,7":"1010100","3,8":"10010010","4,7":"1010101","4,9":"101010100","4,11":"10010010010","5,6":"101111","5,7":"1011011","5,8":"10110110","5,9":"101010101","5,11":"10101010100","5,12":"100101001010","5,16":"1001001001001000","7,8":"10111111","11,24":"100101010101001010101010"};return n.test=function(t){var i=0,r=0;if("string"!=typeof t){for(var a in o){var s=o[a],l=e.call(n.apply(null,a.split(","))).join("");console.log(l,s),l===s?(console.log("TEST PASSED",a),r++):(console.log("TEST FAILED",a),i++)}console.log("*****************************TEST RESULTS - Passed: "+r+", Failed: "+i)}else{var s=o[t],l=e.call(n.apply(null,t.split(","))).join("");console.log(l,s),l==s?console.log("TEST PASSED FOR",t):console.log("TEST FAILED FOR",t)}},n}},{}],33:[function(_dereq_,module,exports){!function(){var $=_dereq_("./dollar"),Gibber={dollar:$,Presets:{},scale:null,minNoteFrequency:50,started:!1,outputCurves:{LINEAR:0,LOGARITHMIC:1},Pattern:_dereq_("./pattern"),"export":function(e){Gibber.Utilities.export(e),e.Pattern=Gibber.Pattern,e.Score=Gibber.Score,e.Euclid=Gibber.Euclid,Gibber.Audio&&Gibber.Audio.export(e),Gibber.Graphics&&Gibber.Graphics.export(e),Gibber.Interface&&Gibber.Interface.export(e),Gibber.Communication&&Gibber.Communication.export(e)},init:function(e){"undefined"==typeof window?(window=GLOBAL,document=GLOBAL.document=!1):"undefined"!=typeof GLOBAL&&(GLOBAL.document||(document=GLOBAL.document=!1));var t={globalize:!0,canvas:null,target:window,graphicsMode:"3d"};if("object"==typeof e&&$.extend(t,e),Gibber.Pattern=Gibber.Pattern(Gibber),Gibber.Audio)if(Gibber.Audio.init(),t.globalize);else{var i=Gibber.export.bind(Gibber);$.extend(Gibber,Gibber.Audio),Gibber.export=i}Gibber.Graphics,Gibber.Interface,t.globalize&&Gibber.export(t.target),t.target.$=$,Gibber.Utilities.init()},Modules:{},"import":function(e,t){var i=null;if(console.log("Loading module "+e+"..."),-1===e.indexOf("http:"))$.post(Gibber.Environment.SERVER_URL+"/gibber/"+e,{},function(n){n=JSON.parse(n);var r=new Function("return "+n.text);return Gibber.Modules[e]=r(),t&&Gibber.Modules[e]&&$.extend(t,Gibber.Modules[e]),Gibber.Modules[e]?("function"==typeof Gibber.Modules[e].init&&Gibber.Modules[e].init(),"object"==typeof Gibber.Modules[e]&&(Gibber.Modules[e].moduleText=n.text),console.log("Module "+e+" is now loaded.")):console.log("Publication "+e+" is loaded. It may not be a valid module."),null!==i&&i(Gibber.Modules[e]),!1});else{var n=document.createElement("script");n.src=e,n.onload=function(){console.log("Module "+e+" is now loaded."),null!==i&&i()},document.head.appendChild(n)}return{done:function(e){i=e}}},loadText:function(e){var t=null;return console.log("Loading text "+e+"...."),$.post(Gibber.Environment.SERVER_URL+"/gibber/"+e,{},function(e){var i=JSON.parse(e);t&&t(i.text)}),{done:function(e){t=e}}},scriptCallbacks:[],run:function(script,pos,cm){var _start=pos.start?pos.start.line:pos.line,tree;try{tree=Gibber.Esprima.parse(script,{loc:!0,range:!0})}catch(e){return void console.error("Parse error on line "+(_start+e.lineNumber)+" : "+e.message.split(":")[1])}for(var __i__=0;__i__<tree.body.length;__i__++){var obj=tree.body[__i__],start={line:_start+obj.loc.start.line-1,ch:obj.loc.start.column},end={line:_start+obj.loc.end.line-1,ch:obj.loc.end.column},src=cm.getRange(start,end),result=null;try{result=eval(src),log("function"!=typeof result?result:"Function")}catch(e){console.error("Error evaluating expression beginning on line "+(start.line+1)+"\n"+e.message)}if(this.scriptCallbacks.length>0)for(var ___i___=0;___i___<this.scriptCallbacks.length;___i___++)this.scriptCallbacks[___i___](obj,cm,pos,start,end,src,_start)}},processArguments:function(e,t){var i;return e.length?"string"==typeof e[0]&&"Drums"!==t&&"XOX"!==t?(i=Gibber.getPreset(e[0],t),"object"==typeof e[1]&&$.extend(i,e[1]),i):Array.prototype.slice.call(e,0):i},processArguments2:function(e,t,i){if(t.length){var n=t[0];if("string"==typeof n&&"Drums"!==i&&"XOX"!==i&&"Shader"!==i)preset=Gibber.getPreset(t[0],i),"object"==typeof t[1]&&$.extend(preset,t[1]),$.extend(e,preset);else if($.isPlainObject(n)&&"undefined"==typeof n.type)$.extend(e,n);else{var r=Object.keys(e.properties);if("FX"===e.type)for(var o=0;o<t.length;o++)e[r[o+1]]=t[o];else for(var o=0;o<t.length;o++)e[r[o]]=t[o]}}},getPreset:function(e,t){var i={};return Gibber.Presets[t]&&Gibber.Presets[t][e]?i=Gibber.Presets[t][e]:Gibber.log(t+" does not have a preset named "+e+"."),i},clear:function(){var e=Array.prototype.slice.call(arguments,0);Gibber.Audio&&Gibber.Audio.clear.apply(Gibber.Audio,e),Gibber.Graphics&&Gibber.Graphics.clear(Gibber.Graphics,e),Gibber.proxy(window),$.publish("/gibber/clear",{}),console.log("Gibber has been cleared.")},singleton:function(e,t){if(t||(t=window),$.isArray(e))for(var i=0;i<e.length;i++)Gibber.singleton(e[i],t);else{"undefined"!=typeof t[e]&&(delete t[e],delete t["___"+e]);var n=e;Object.defineProperty(t,n,{configurable:!0,get:function(){return t["___"+n]},set:function(e){if(e)t["___"+n]&&"function"==typeof t["___"+n].replaceWith&&(t["___"+n].replaceWith(e),console.log(t["___"+n].name+" was replaced with "+e.name)),t["___"+n]=e;else if(t["___"+n]){var i=t["___"+n];i&&"function"==typeof i.kill&&i.kill()}}})}},proxy:function(e){for(var t="abcdefghijklmnopqrstuvwxyz",i=0;i<t.length;i++){var n=t.charAt(i);Gibber.singleton(n,e)}},construct:function(e,t){function i(){return e.apply(this,t)}return i.prototype=e.prototype,new i},createMappingObject:function(e,t){var i="function"==typeof e.min?e.min():e.min,n="function"==typeof e.max?e.max():e.max,r="function"==typeof t.min?t.min():t.min,o="function"==typeof t.max?t.max():t.max;if("undefined"==typeof t.object&&t.Value&&(t=t.Value),"undefined"!=typeof e.object[e.Name].mapping)return void e.object[e.Name].mapping.replace(t.object,t.propertyName,t.Name);"undefined"!=typeof t.targets&&-1===t.targets.indexOf(e)&&t.targets.push([e,e.Name]);var a="Out"!==t.Name?t.timescale:"audioOut";return mapping=Gibber.mappings[e.timescale][a](e,t),Object.defineProperties(e.object[e.Name],{min:{configurable:!0,get:function(){return i},set:function(t){i=t,e.object[e.Name].mapping.outputMin=i}},max:{configurable:!0,get:function(){return n},set:function(t){n=t,e.object[e.Name].mapping.outputMax=n}}}),e.object[e.Name].mappingObjects=[],Gibber.createProxyProperty(e.object[e.Name],"min",1,0,{min:i,max:n,output:e.output,timescale:e.timescale,dimensions:1}),Gibber.createProxyProperty(e.object[e.Name],"max",1,0,{min:i,max:n,output:e.output,timescale:e.timescale,dimensions:1}),Object.defineProperties(t.object[t.Name],{min:{configurable:!0,get:function(){return r},set:function(t){r=t,e.object[e.Name].mapping.inputMin=r}},max:{configurable:!0,get:function(){return o},set:function(t){o=t,e.object[e.Name].mapping.inputMax=o}}}),e.object[e.Name].invert=function(){e.object[e.Name].mapping.invert()},"undefined"==typeof e.object.mappings&&(e.object.mappings=[]),e.object.mappings.push(mapping),"undefined"==typeof t.object.mappings&&(t.object.mappings=[]),t.object.mappings.push(mapping),Gibber.defineSequencedProperty(e.object[e.Name],"invert"),mapping},defineSequencedProperty:function(e,t,i){var n=e[t],r={},o={};!e.seq&&Gibber.Audio&&(e.seq=Gibber.Audio.Seqs.Seq({doNotStart:!0,scale:e.scale,priority:i,target:e})),n.score=function(e,t,i){return function(){n.seq(e,t,i)}},e[t+"_"]=function(){var t=Array.prototype.slice.call(arguments,0),i=function(){n.apply(e,t)};return i},n.seq=function(a,s,l){var u,c=!1;"string"!=typeof a||"Drums"!==e.name&&"XOX"!==e.name&&"Ensemble"!==e.name?"undefined"==typeof s&&(c=!0):(a=a.split(""),"undefined"==typeof s&&(s=1/a.length)),"function"==typeof e.seq&&(e.seq=e.object.seq),o=e.seq.seqs;var h=$.isArray(a)?a:[a],f=$.isArray(s)?s:"undefined"!=typeof s?[s]:null,p=Gibber.construct(Gibber.Pattern,h),d=Gibber.construct(Gibber.Pattern,f),m={key:t,values:[p],durations:null!==f?[d]:null,target:e,priority:i};p.patternName=t+"_values",d.patternName=t+"_durations","undefined"==typeof l&&(l=0),"undefined"==typeof r[t]&&(r[t]=[]),u=r[t][l];var g=-1;if("undefined"!=typeof u&&"undefined"!=typeof o[u]&&(g=u),h.randomFlag){p.filters.push(function(){var e=Gibber.Utilities.rndi(0,p.values.length-1);return[p.values[e],1,e]});for(var v=0;v<h.randomArgs.length;v+=2)p.repeat(h.randomArgs[v],h.randomArgs[v+1])}if(null!==f){if(f.randomFlag){d.filters.push(function(){var e=Gibber.Utilities.rndi(0,d.values.length-1);return[d.values[e],1,e]});for(var v=0;v<f.randomArgs.length;v+=2)d.repeat(f.randomArgs[v],f.randomArgs[v+1])}d.seq=e.seq}if(p.seq=e.seq,g>-1){var y=c?e.seq.autofire.splice(g,1)[0]:o.splice(g,1)[0];for(var b in e.seq.timeline){var x=e.seq.timeline[b],w=x.indexOf(y);w>-1&&x.splice(w,1)}e.seq.add(m,g)}else e.seq.add(m),u=e.seq.seqs.length-1;return c||(r[t][l]=u),n[l]={},Object.defineProperties(n[l],{values:{configurable:!0,get:function(){return p},set:function(t){var i=Gibber.construct(Gibber.Pattern,t);Array.isArray(i)||(i=[i]),null!==f?e.seq.seqs[u].values=i:e.seq.autofire[u].values=i}},durations:{configurable:!0,get:function(){return d},set:function(t){Array.isArray(t)||(t=[t]);var i=Gibber.construct(Gibber.Pattern,t);Array.isArray(i)||(i=[i]),e.seq.seqs[u].durations=i}}}),n[l].seq=function(e,t){n.seq(e,t,l)},e.seq.isRunning||(e.seq.offset=Gibber.Clock.time(e.offset),e.seq.start(!0,i)),n.seq.stop=function(){for(var e=r[t],i=0;i<e.length;i++){var n=e[i],a=o[n];a.shouldStop=!0}},n[l].stop=function(){o[u].shouldStop=!0},n.seq.start=function(){for(var n=r[t],a=0;a<n.length;a++){var s=n[a],l=o[s];l.shouldStop=!1,e.seq.timeline[0]||(e.seq.timeline[0]=[]),e.seq.timeline[0].push(l),e.seq.nextTime=0}e.seq.isRunning||e.seq.start(!1,i)},n[l].start=function(){var t=o[u];t.shouldStop=!1,e.seq.timeline[0]=[t],e.seq.nextTime=0,e.seq.isRunning||e.seq.start(!1,i),o[u].shouldStop=!1},n.seq.repeat=function(e){var t=0,i=function(i,n){return i[2]%(n.getLength()-1)===0&&0!==i[2]&&(t++,t===e&&n.seq.stop()),i};n.values.filters.push(i)},n[l].score=function(t,i){return n.seq.bind(e,t,i,l)},Object.defineProperties(n,{values:{configurable:!0,get:function(){return n[l].values},set:function(e){return n[l].values=e}},durations:{configurable:!0,get:function(){return n[l].durations},set:function(e){return n[l].durations=e}}}),e}},defineRampedProperty:function(e,t){var i,n=e[t],r=t.slice(1);n.ramp=function(t,n,o){return arguments.length<2?void console.err("ramp requires at least two arguments: target and time."):("undefined"==typeof o&&(o=n,n=t,t=e[r]()),i&&i(),"object"!=typeof t?e[r]=Line(t,n,o):t.retrigger(n,Gibber.Clock.time(o)),i=future(function(){e[r]=n},o),e)}},createProxyMethods:function(e,t,i){for(var n=0;n<t.length;n++)Gibber.defineSequencedProperty(e,t[n],i)},defineProperty:function(e,t,i,n,r,o,a){var s="object"==typeof e[t]?e[t].valueOf():e[t],l=t.charAt(0).toUpperCase()+t.slice(1),u=function(i){var n=u;return"undefined"!=typeof i&&(u.oldSetter?u.oldSetter.call(e,i):e[t]=i,n=e),n};r=o?r||e.mappingProperties[t]:null,$.extend(u,r),$.extend(u,{propertyName:t,Name:l,value:s,type:"property",object:e,targets:[],valueOf:function(){return u.value},toString:function(){var e="";return e="object"==typeof u.value?u.value.toString():u.value},oldSetter:e.__lookupSetter__(t),oldGetter:e.__lookupGetter__(t),oldMappingObjectGetter:e.__lookupGetter__(l),oldMappingObjectSetter:e.__lookupSetter__(l)}),Object.defineProperty(e,t,{configurable:!0,get:function(){return u},set:function(t){if("function"!=typeof t&&("object"!=typeof t||"mapping"!==t.type)||"property"!==t.type&&"mapping"!==t.type){o&&e[u.Name]&&"undefined"!=typeof e[u.Name].mapping&&e[u.Name].mapping.remove&&e[u.Name].mapping.remove(!0);var i=t;if(u.oldSetter){var n=u.oldSetter.call(e,t);"undefined"!=typeof n&&(i=n)}u.value=i}else Gibber.createMappingObject(u,t);return e}}),i&&Gibber.defineSequencedProperty(e,t,a),n&&Gibber.defineRampedProperty(e,t),o&&Object.defineProperty(e,u.Name,{configurable:!0,get:function(){return"function"==typeof u.oldMappingObjectGetter&&u.oldMappingObjectGetter(),u},set:function(t){e[u.Name]=t,"function"==typeof mapping.oldMappingObjectSetter&&mapping.oldMappingObjectSetter(t)}})},createProxyProperty:function(e,t,i,n,r,o,a){o=o===!1?!1:!0,Gibber.defineProperty(e,t,i,n,r,o,a),r&&r.perNote&&Gibber.defineProperty(e,t+"V",i,n,r,o,a)},createProxyProperties:function(e,t,i,n){var r="undefined"==typeof i?!0:i,o="undefined"==typeof n?!0:n;e.gibber=!0,e.mappingProperties=t,e.mappingObjects=[];for(var a in t)t[a].doNotProxy||Gibber.createProxyProperty(e,a,r,o,t[a])}};Gibber.Utilities=_dereq_("./utilities")(Gibber),Gibber.mappings=_dereq_("./mappings")(Gibber),Gibber.Euclid=_dereq_("./euclidean")(Gibber),module.exports=Gibber}()},{"./dollar":31,"./euclidean":32,"./mappings":34,"./pattern":35,"./utilities":36}],34:[function(e,t){t.exports=function(e){var t={audio:{graphics:function(t,i){"undefined"==typeof i.object.track&&(i.object.track={});var n,r="undefined"!=typeof i.object.track[i.propertyName]?i.object.track[i.propertyName]:new e.Audio.Core.Proxy2(i.object,i.propertyName),o=new e.Audio.Core.OnePole({a0:.005,b1:.995});return i.object.track=r,n=t.object[t.Name].mapping=e.Audio.Core.Binops.Map(r,t.min,t.max,i.min,i.max,t.output,i.wrap),o.input=n,t.object[t.propertyName]=o,n.proxy=r,n.op=o,n.remove=function(e){e||(t.object[t.propertyName]=t.object[t.Name].mapping.getValue()),delete t.object[t.Name].mapping},n},"interface":function(t,i){var n,r="undefined"!=typeof i.track?i.track:new e.Audio.Core.Proxy2(i.object,i.propertyName),o=new e.Audio.Core.OnePole({a0:.005,b1:.995}),a=t.max-t.min,s=(t.object[t.propertyName]-t.min)/a,l=i.min+(i.max-i.min)*s;if(i.object.setValue&&i.object.setValue(l),i.track=r,n=t.object[t.Name].mapping=e.Audio.Core.Binops.Map(r,t.min,t.max,i.min,i.max,t.output,i.wrap),o.input=n,t.object[t.propertyName]=o,n.proxy=r,n.op=o,n.remove=function(e){e||(t.object[t.propertyName]=n.getValue()),delete n},"undefined"!=typeof i.object.label){for(var u="",c=0;c<i.targets.length;c++){var h=i.targets[c];u+=h[0].object.name+"."+h[1],c!==i.targets.length-1&&(u+=" & ")}i.object.label=u}return n.replace=function(e,i,n){r.setInput(e),-1===e[n].targets.indexOf(t)&&e[n].targets.push([t,t.Name])},n},audio:function(t,i){var n,r;return"undefined"!=typeof i.object.track?(n=i.object.track,n.count++):(n=new e.Audio.Core.Proxy2(i.object,i.propertyName),n.count=1),i.object.track=n,t.object[t.propertyName]=e.Audio.Core.Binops.Map(n,t.min,t.max,i.min,i.max),r=t.object[t.Name].mapping=t.object[t.propertyName],r.remove=function(e){e||(t.object[t.propertyName]=r.getValue()),r.op&&r.op.remove(),delete t.object[t.Name].mapping},r.replace=function(i,n,o){var a=new e.Audio.Core.Proxy2(i,n);r.input=a,i[o].targets&&-1===i[o].targets.indexOf(t)&&i[o].targets.push([t,t.Name])},r},audioOut:function(t,i){var n;n=e.Audio.Core.Binops.Map(null,t.min,t.max,0,1,0),t.object[t.propertyName]=t.object[t.Name].mapping=n,"undefined"!=typeof i.object.track?(n.follow=i.object.track,n.follow.count++):(n.follow=new e.Audio.Analysis.Follow({input:i.object,useAbsoluteValue:!0}),n.follow.count=1),i.object.track=n.input=n.follow,n.remove=function(e){e||(t.object[t.propertyName]=t.object[t.Name].mapping.getValue()),n.bus&&n.bus.disconnect(),n.follow&&(n.follow.count--,0===n.follow.count&&(delete i.object.track,n.follow.remove())),delete t.object[t.Name].mapping},n.replace=function(e,i,r){n.follow.input=e,-1===e[r].targets.indexOf(t)&&e[r].targets.push([t,t.Name])};var r=n.follow.bufferSize;return Object.defineProperty(t.object[t.Name],"env",{configurable:!0,get:function(){return r},set:function(t){r=e.Clock.time(t),n.follow.bufferSize=r}}),n}},graphics:{graphics:function(t,i){var n,r=e.Audio.Core.Binops.Map(i.object[i.propertyName],t.min,t.max,i.min,i.max,t.output,i.wrap),o=r.getValue.bind(r);return r.getValue=function(){return r.callback(i.object[i.propertyName],t.min,t.max,i.min,i.max,t.output,i.wrap),o()},n=t.object[t.Name].mapping=r,t.object.mod?t.object.mod(t.propertyName,n,"="):t.modObject.mod(t.modName,n,"="),n.remove=function(){t.object.mod?t.object.removeMod(t.propertyName):t.modObject.removeMod(t.modName),t.object[t.propertyName]=t.object[t.Name].mapping.getValue(),delete t.object[t.Name].mapping},n.replace=function(e){n.input=e},n},"interface":function(t,i){var n,r=e.Audio.Core.Binops.Map(i.object[i.propertyName],t.min,t.max,i.min,i.max,t.output,i.wrap);"undefined"==typeof i.object.functions&&(i.object.functions={},i.object.onvaluechange=function(){for(var e in i.object.functions)i.object.functions[e]()}),n=t.object[t.Name].mapping=r,t.mapping.from=i;var o=t.propertyName+" <- "+i.object.propertyName+"."+i.Name;if(i.object.functions[o]=function(){var e=n.callback(i.object[i.propertyName],t.min,t.max,i.min,i.max,t.output,i.wrap);t.object[t.Name].oldSetter.call(t.object[t.Name],e)},n.replace=function(){},n.remove=function(){console.log("mapping removed"),delete i.object.functions[o]},i.object.setValue&&i.object.setValue(t.object[t.propertyName]),"undefined"!=typeof i.object.label){for(var a="",s=0;s<i.targets.length;s++){var l=i.targets[s];a+=l[0].object.propertyName+"."+l[1],s!==i.targets.length-1&&(a+=" & ")}i.object.label=a}return n},audio:function(t,i){var n;n=t.object[t.Name].mapping=e.Audio.Core.Binops.Map(null,t.min,t.max,i.min,i.max,t.output,i.wrap),n.follow="undefined"!=typeof i.object.track?i.object.track:new e.Audio.Core.Follow({input:i.object[i.propertyName],useAbsoluteValue:!1}),i.object.track=t.object[t.Name].mapping.follow,n.input=n.follow,n.bus=new e.Audio.Core.Bus2({amp:0}).connect(),n.connect(n.bus),n.replace=function(e,i,r){n.follow.input=e,-1===e[r].targets.indexOf(t)&&e[r].targets.push([t,t.Name])};var r=n.follow.bufferSize;return Object.defineProperty(t.object[t.Name],"env",{get:function(){return r},set:function(t){r=e.Clock.time(t),n.follow.bufferSize=r}}),t.object.mod?t.object.mod(t.propertyName,n,"="):t.modObject.mod(t.modName,n,"="),n.remove=function(){this.bus.disconnect(),this.follow&&(this.follow.count--,0===this.follow.count&&(delete i.object.track,this.follow.remove())),t.object.mod?t.object.removeMod(t.propertyName):t.modObject.removeMod(t.modName),delete t.object[t.Name].mapping},n},audioOut:function(i,n){if("undefined"!=typeof i.object[i.Name].mapping)return r.replace(n.object,n.propertyName,n.Name),r;var r=i.object[i.Name].mapping=e.Audio.Core.Binops.Map(null,i.min,i.max,0,1,0);"undefined"!=typeof n.object.track?(r.follow=n.object.track,r.follow.count++):(r.follow=new e.Audio.Core.Follow({input:n.object}),r.follow.count=1),n.object.track=r.follow;var o=r.follow.bufferSize;return Object.defineProperty(i.object[i.Name],"env",{configurable:!0,get:function(){return o},set:function(t){o=e.Clock.time(t),r.follow.bufferSize=o}}),r.input=r.follow,r.bus=new e.Audio.Core.Bus2({amp:0}).connect(),r.connect(r.bus),r.replace=function(t,o,a){if(t[a].timescale===n.timescale){var s=r.follow.input[n.Name].targets.indexOf(i);s>=-1&&r.follow.input[n.Name].targets.splice(s,1),r.follow.input=t,-1===t[a].targets.indexOf(i)&&t[a].targets.push([i,i.Name])}else r.bus.disconnect(),r.follow.remove(),e.createMappingObject(i,t)},i.object.mod?i.object.mod(i.propertyName,r,"="):i.modObject?i.modObject.mod(i.modName,r,"="):!function(){var e=r;i.object.update=function(){i.object[i.propertyName](e.getValue())}}(),r.remove=function(){this.bus.disconnect(),this.follow&&(this.follow.count--,0===this.follow.count&&(delete n.object.track,this.follow.remove())),i.object.mod?i.object.removeMod(i.propertyName):i.modObject&&i.modObject.removeMod(i.modName),i.object.mappings.splice(i.object.mappings.indexOf(r),1),n.object.mappings.splice(n.object.mappings.indexOf(r),1);var e=i.object[i.Name].targets,o=e.indexOf(t);-1!==o&&e.splice(o,1),delete i.object[i.Name].mapping},r}},notation:{graphics:function(t,i){var n,r=e.Audio.Core.Binops.Map(i.object[i.propertyName],t.min,t.max,i.min,i.max,t.output,i.wrap),o=r.getValue.bind(r);return r.getValue=function(){return r.callback(i.object[i.propertyName],t.min,t.max,i.min,i.max,t.output,i.wrap),o()},n=t.object[t.Name].mapping=r,t.object.mod?t.object.mod(t.propertyName,n,"="):t.modObject.mod(t.modName,n,"="),n.remove=function(){t.object.mod?t.object.removeMod(t.propertyName):t.modObject.removeMod(t.modName),t.object[t.propertyName]=t.object[t.Name].mapping.getValue(),delete t.object[t.Name].mapping},n.replace=function(e){n.input=e},n},"interface":function(t,i){var n,r=e.Audio.Core.Binops.Map(i.object[i.propertyName],t.min,t.max,i.min,i.max,t.output,i.wrap);"undefined"==typeof i.object.functions&&(i.object.functions={},i.object.onvaluechange=function(){for(var e in i.object.functions)i.object.functions[e]()}),n=t.object[t.Name].mapping=r,t.mapping.from=i;var o=t.propertyName+" <- "+i.object.propertyName+"."+i.Name;if(i.object.functions[o]=function(){var e=n.callback(i.object[i.propertyName],t.min,t.max,i.min,i.max,t.output,i.wrap);t.object[t.Name].oldSetter.call(t.object[t.Name],e)},n.replace=function(){},n.remove=function(){console.log("mapping removed"),delete i.object.functions[o]},i.object.setValue&&i.object.setValue(t.object[t.propertyName]),"undefined"!=typeof i.object.label){for(var a="",s=0;s<i.targets.length;s++){var l=i.targets[s];a+=l[0].object.propertyName+"."+l[1],s!==i.targets.length-1&&(a+=" & ")}i.object.label=a}return n},audio:function(t,i){var n;n=t.object[t.Name].mapping=e.Audio.Core.Binops.Map(null,t.min,t.max,i.min,i.max,t.output,i.wrap),"undefined"!=typeof i.object.track&&i.object.track.input===i.object.properties[i.propertyName]?(n.follow=i.object.track,n.follow.count++):(n.follow=new e.Audio.Core.Follow({input:i.object.properties[i.propertyName],useAbsoluteValue:!1}),n.follow.count=1),i.object.track=t.object[t.Name].mapping.follow,n.input=n.follow,n.bus=new e.Audio.Core.Bus2({amp:0}).connect(),n.connect(n.bus),n.replace=function(e,i,r){n.follow.input=e,-1===e[r].targets.indexOf(t)&&e[r].targets.push([t,t.Name])};var r=n.follow.bufferSize;return Object.defineProperty(t.object[t.Name],"env",{get:function(){return r},set:function(t){r=e.Clock.time(t),n.follow.bufferSize=r}}),n.update=function(){t.object[t.propertyName](n.getValue())},n.text=t.object,e.Environment.Notation.add(n),n.remove=function(){this.bus.disconnect(),this.follow&&(this.follow.count--,0===this.follow.count&&(delete i.object.track,this.follow.remove())),e.Environment.Notation.remove(n),delete t.object[t.Name].mapping},n},audioOut:function(t,i){if("undefined"!=typeof t.object[t.Name].mapping)return n.replace(i.object,i.propertyName,i.Name),n;var n=t.object[t.Name].mapping=e.Audio.Core.Binops.Map(null,t.min,t.max,0,1,0);"undefined"!=typeof i.object.track&&i.object.track.input===i.object.properties[i.propertyName]?(n.follow=i.object.track,n.follow.count++):(n.follow=new e.Audio.Core.Follow({input:i.object,useAbsoluteValue:!0}),n.follow.count=1),i.object.track=n.follow;var r=n.follow.bufferSize;return Object.defineProperty(t.object[t.Name],"env",{configurable:!0,get:function(){return r},set:function(t){r=e.Clock.time(t),n.follow.bufferSize=r}}),n.input=n.follow,n.bus=new e.Audio.Core.Bus2({amp:0}).connect(),n.connect(n.bus),n.replace=function(r,o,a){if(r[a].timescale===i.timescale){var s=n.follow.input[i.Name].targets.indexOf(t);s>=-1&&n.follow.input[i.Name].targets.splice(s,1),n.follow.input=r,-1===r[a].targets.indexOf(t)&&r[a].targets.push([t,t.Name])}else n.bus.disconnect(),n.follow.remove(),e.createMappingObject(t,r)},n.update=function(){t.object[t.propertyName](n.getValue())},n.text=t.object,e.Environment.Notation.add(n),n.remove=function(){this.bus.disconnect(),this.follow&&(this.follow.count--,0===this.follow.count&&(delete i.object.track,this.follow.remove())),e.Environment.Notation.remove(n),delete t.object[t.Name].mapping},n}}};return t},t.exports.outputCurves={LINEAR:0,LOGARITHMIC:1}},{}],35:[function(e,t){t.exports=function(t){"use strict";var i=e("./dollar"),n={concat:function(e){this.values=this.values.concat(e.values)},toString:function(){return this.values.toString()},valueOf:function(){return this.values},getLength:function(){var e;return e=this.start<=this.end?this.end-this.start+1:this.values.length+this.end-this.start+1},runFilters:function(e,t){for(var i=[e,1,t],n=0;n<this.filters.length;n++)i=this.filters[n](i,this);return i},checkForUpdateFunction:function(e,t){var i=Array.prototype.slice.call(t,0);this.listeners[e]?this.listeners[e].apply(this,i):r.listeners[e]&&r.listeners[e].apply(this,i)},_onchange:function(){}},r=function(){if(!(this instanceof r)){var e=Array.prototype.slice.call(arguments,0);return t.construct(r,e)}var n=function(){var e,t,i,r=n.getLength();return e=1===r?0:Math.floor(n.phase>-1?n.start+n.phase%r:n.end+n.phase%r),t=n.values[Math.floor(e%n.values.length)],i=n.runFilters(t,e),n.phase+=n.stepSize*i[1],t=i[0],"function"==typeof t&&(t=t()),n.update&&(n.update.value=t),t};i.extend(n,{start:0,end:0,phase:0,values:Array.prototype.slice.call(arguments,0),original:null,storage:[],stepSize:1,integersOnly:!1,filters:[],onchange:null,range:function(){var e,t;return Array.isArray(arguments[0])?(e=arguments[0][0],t=arguments[0][1]):(e=arguments[0],t=arguments[1]),t>e?(n.start=e,n.end=t):(n.start=t,n.end=e),this.checkForUpdateFunction("range",[n]),n},set:function(){var e=Array.isArray(arguments[0])?arguments[0]:arguments;n.values.length=0;for(var t=0;t<e.length;t++)n.values.push(e[t]);return n.end=n.values.length-1,n._onchange(),n},reverse:function(){var e,t=n.values,i=null,r=null,o=t.length;for(i=0,r=o-1;r>i;i+=1,r-=1)e=t[i],t[i]=t[r],t[r]=e;return n._onchange(),n},repeat:function(){for(var e={},t=0;t<arguments.length;t+=2)e[arguments[t]]={phase:0,target:arguments[t+1]};var i=!1,r=null,o=null,a=function(t){var n=t[0],a=(t[1],t);return i===!1&&e[n]&&(i=!0,r=n,o=t[2]),i===!0&&(e[r].phase!==e[r].target?(a[0]=r,a[1]=0,a[2]=o,e[r].phase++):(e[r].phase=0,a[1]=1,n!==r?i=!1:e[r].phase++)),a};return n.filters.push(a),n},reset:function(){return n.values=n.original.slice(0),n._onchange(),n},store:function(){return n.storage[n.storage.length]=n.values.slice(0),n},transpose:function(e){for(var t=0;t<n.values.length;t++){var r=n.values[t];if(i.isArray(r))for(var o=0;o<r.length;o++)"number"==typeof r[o]&&(r[o]=n.integersOnly?Math.round(r[o]+e):r[o]+e);else"number"==typeof r&&(n.values[t]=n.integersOnly?Math.round(n.values[t]+e):n.values[t]+e)}return n._onchange(),n},shuffle:function(){return t.Utilities.shuffle(n.values),n._onchange(),n},scale:function(e){for(var t=0;t<n.values.length;t++){var r=n.values[t];
if(i.isArray(r))for(var o=0;o<r.length;o++)"number"==typeof r[o]&&(r[o]=n.integersOnly?Math.round(r[o]*e):r[o]*e);else"number"==typeof r&&(n.values[t]=n.integersOnly?Math.round(n.values[t]*e):n.values[t]*e)}return n._onchange(),n},flip:function(){var e=[],t=null;t=n.values.filter(function(t){var i=-1===e.indexOf(t);return i&&e.push(t),i}),t=t.sort(function(e,t){return e-t});for(var i=0;i<n.values.length;i++){var r=t.indexOf(n.values[i]);n.values[i]=t[t.length-r-1]}return n._onchange(),n},invert:function(){for(var e=n.values[0],t=1;t<n.values.length;t++)if("number"==typeof n.values[t]){var i=e+(e-n.values[t]);n.values[t]=i}return n._onchange(),n},"switch":function(e){return n.storage[e]&&(n.values=n.storage[e].slice(0)),n._onchange(),n},rotate:function(e){if(e>0)for(;e>0;){var t=n.values.pop();n.values.unshift(t),e--}else if(0>e)for(;0>e;){var i=n.values.shift();n.values.push(i),e++}return n._onchange(),n}}),n.retrograde=n.reverse.bind(n),n.end=n.values.length-1,n.original=n.values.slice(0),n.storage[0]=n.original.slice(0),n.integersOnly=n.values.every(function(e){return e===+e&&e===(0|e)});var o=["rotate","switch","invert","reset","flip","transpose","reverse","shuffle","scale","store","range","set"];return t.createProxyMethods(n,o,!0),n.listeners={},t.createProxyProperties(n,{stepSize:0,start:0,end:0}),n.__proto__=this.__proto__,n};return r.listeners={},r.prototype=n,r}},{"./dollar":31}],36:[function(e,t){t.exports=function(e){"use strict";var t=[],i=!1,n=(e.dollar,e.Audio?e.Audio.Core:null,e.Clock,Math.random,{seq:function(){var e=arguments[0],t=typeof e,i=null;return"object"===t&&Array.isArray(e)&&(t="array"),i},random:function(){return this.randomFlag=!0,this.randomArgs=Array.prototype.slice.call(arguments,0),this},random2:function(){for(var e={},t=null,i=this,r=0;r<arguments.length;r+=2)e[""+arguments[r]]={repeat:arguments[r+1],count:0};return this.pick=function(){var r,o,a=0;return i[t]&&(o=i[t]),null!==t&&e[o].count++<=e[o].repeat?(r=t,e[o].count>=e[o].repeat&&(e[o].count=0,t=null)):(r=n.rndi(0,i.length-1),a=i[r],"undefined"!=typeof e[""+a]?(e[""+a].count=1,t=r):t=null),i[r]},this.pick},choose:function(e){var t=null;if(isNaN(e)&&(e=1),1!==e){for(var i=[],r=0;e>r;r++)i[r]=this[n.rndi(0,this.length-1)];t=i}else t=this[n.rndi(0,this.length-1)];return t},future:function(t,i){var n=0,r=e.Audio.Seqs.Seq(function(){1===n&&(t(),r.stop(),r.disconnect()),n++},e.Audio.Clock.time(i));return function(){r.stop(),r.disconnect()}},shuffle:function(e){for(var t,i,n=e.length;n;t=parseInt(Math.random()*n),i=e[--n],e[n]=e[t],e[t]=i);},solo:function(e){var r=Array.prototype.slice.call(arguments,0);if(e){i&&n.solo();for(var o=0;o<r.length;o++){var a=r[o];a.fx.length>0&&(r[o]=a.fx[a.fx.length-1])}for(var s=0;s<Master.inputs.length;s++){var l=r.indexOf(Master.inputs[s].value),u=Master.inputs[s].value,c=u.name;-1===l&&"polyseq"!==c&&"Seq"!==c&&(Master.inputs[s]._amp=Master.inputs[s].amp,Master.inputs[s].amp=0,t.push(Master.inputs[s]))}i=!0}else{for(var s=0;s<t.length;s++)t[s].amp=t[s]._amp;t.length=0,i=!1}},fill:function(e,t){isNaN(e)&&(e=16),"function"!=typeof t&&(t=Rndf()),t=t.bind(this);for(var i=0;e>i;i++)this[i]=t();return this},merge:function(){for(var e=[],t=0;t<this.length;t++){var i=this[t];if(Array.isArray(i))for(var n=0;n<i.length;n++)e.push(i[n]);else e.push(i)}return e},weight:function(){var e=Array.prototype.slice.call(arguments,0);return this.pick=function(){for(var t=this[0],i=0,r=n.rndf(),o=0;o<e.length;o++)if(i+=e[o],i>r){t=o;break}return t},this},gibberArray:function(){},rndf:function(e,t,i,r){if(r="undefined"==typeof r?!0:r,"undefined"==typeof i&&"object"!=typeof e){1==arguments.length?(t=arguments[0],e=0):2==arguments.length?(e=arguments[0],t=arguments[1]):(e=0,t=1);var o=t-e,a=Math.random(),s=o*a;return e+s}var l=[],u=[];"undefined"==typeof i&&(i=t||e.length);for(var c=0;i>c;c++){var h;if("object"==typeof arguments[0])h=arguments[0][rndi(0,arguments[0].length-1)];else if(r)h=n.rndf(e,t);else{for(h=n.rndf(e,t);u.indexOf(h)>-1;)h=n.rndf(e,t);u.push(h)}l.push(h)}return l},Rndf:function(){{var e,t,i,r;Math.random}return 0===arguments.length?(e=0,t=1):1===arguments.length?(t=arguments[0],e=0):2===arguments.length?(e=arguments[0],t=arguments[1]):3===arguments.length?(e=arguments[0],t=arguments[1],i=arguments[2]):(e=arguments[0],t=arguments[1],i=arguments[2],r=arguments[3]),function(){var o,a,s;return a="function"==typeof e?e():e,s="function"==typeof t?t():t,o="undefined"==typeof i?n.rndf(a,s):n.rndf(a,s,i,r)}},rndi:function(e,t,i,r){var o;if(0===arguments.length?(e=0,t=1):1===arguments.length?(t=arguments[0],e=0):2===arguments.length?(e=arguments[0],t=arguments[1]):(e=arguments[0],t=arguments[1],i=arguments[2],r=arguments[3]),o=t-e,i>o&&(r=!0),"undefined"==typeof i)return o=t-e,Math.round(e+Math.random()*o);for(var a=[],s=[],l=0;i>l;l++){var u;if(r)u=n.rndi(e,t);else{for(u=n.rndi(e,t);s.indexOf(u)>-1;)u=n.rndi(e,t);s.push(u)}a.push(u)}return a},Rndi:function(){{var e,t,i,r,o;Math.random,Math.round}return 0===arguments.length?(e=0,t=1):1===arguments.length?(t=arguments[0],e=0):2===arguments.length?(e=arguments[0],t=arguments[1]):3===arguments.length?(e=arguments[0],t=arguments[1],i=arguments[2]):(e=arguments[0],t=arguments[1],i=arguments[2],r=arguments[3]),o=t-e,"number"==typeof i&&i>o&&(r=!0),function(){var o,a,s;return a="function"==typeof e?e():e,s="function"==typeof t?t():t,o="undefined"==typeof i?n.rndi(a,s):n.rndi(a,s,i,r)}},"export":function(e){e.rndi=n.rndi,e.rndf=n.rndf,e.Rndi=n.Rndi,e.Rndf=n.Rndf,e.future=n.future,e.solo=n.solo},init:function(){Array.prototype.random=Array.prototype.rnd=n.random}});return n}},{}],37:[function(e,t){var i=e("color-convert"),n=e("color-string");t.exports=function(e){return new r(e)};var r=function(e){if(this.values={rgb:[0,0,0],hsl:[0,0,0],hsv:[0,0,0],hwb:[0,0,0],cmyk:[0,0,0,0],alpha:1},"string"==typeof e){var t=n.getRgba(e);if(t)this.setValues("rgb",t);else if(t=n.getHsla(e))this.setValues("hsl",t);else{if(!(t=n.getHwb(e)))throw new Error("Unable to parse color from string "+e);this.setValues("hwb",t)}}else if("object"==typeof e){var t=e;if(void 0!==t.r||void 0!==t.red)this.setValues("rgb",t);else if(void 0!==t.l||void 0!==t.lightness)this.setValues("hsl",t);else if(void 0!==t.v||void 0!==t.value)this.setValues("hsv",t);else if(void 0!==t.w||void 0!==t.whiteness)this.setValues("hwb",t);else{if(void 0===t.c&&void 0===t.cyan)throw new Error("Unable to parse color from object "+JSON.stringify(e));this.setValues("cmyk",t)}}};r.prototype={rgb:function(){return this.setSpace("rgb",arguments)},hsl:function(){return this.setSpace("hsl",arguments)},hsv:function(){return this.setSpace("hsv",arguments)},hwb:function(){return this.setSpace("hwb",arguments)},cmyk:function(){return this.setSpace("cmyk",arguments)},rgbArray:function(){return this.values.rgb},hslArray:function(){return this.values.hsl},hsvArray:function(){return this.values.hsv},hwbArray:function(){return 1!==this.values.alpha?this.values.hwb.concat([this.values.alpha]):this.values.hwb},cmykArray:function(){return this.values.cmyk},rgbaArray:function(){var e=this.values.rgb;return e.concat([this.values.alpha])},hslaArray:function(){var e=this.values.hsl;return e.concat([this.values.alpha])},alpha:function(e){return void 0===e?this.values.alpha:(this.setValues("alpha",e),this)},red:function(e){return this.setChannel("rgb",0,e)},green:function(e){return this.setChannel("rgb",1,e)},blue:function(e){return this.setChannel("rgb",2,e)},hue:function(e){return this.setChannel("hsl",0,e)},saturation:function(e){return this.setChannel("hsl",1,e)},lightness:function(e){return this.setChannel("hsl",2,e)},saturationv:function(e){return this.setChannel("hsv",1,e)},whiteness:function(e){return this.setChannel("hwb",1,e)},blackness:function(e){return this.setChannel("hwb",2,e)},value:function(e){return this.setChannel("hsv",2,e)},cyan:function(e){return this.setChannel("cmyk",0,e)},magenta:function(e){return this.setChannel("cmyk",1,e)},yellow:function(e){return this.setChannel("cmyk",2,e)},black:function(e){return this.setChannel("cmyk",3,e)},hexString:function(){return n.hexString(this.values.rgb)},rgbString:function(){return n.rgbString(this.values.rgb,this.values.alpha)},rgbaString:function(){return n.rgbaString(this.values.rgb,this.values.alpha)},percentString:function(){return n.percentString(this.values.rgb,this.values.alpha)},hslString:function(){return n.hslString(this.values.hsl,this.values.alpha)},hslaString:function(){return n.hslaString(this.values.hsl,this.values.alpha)},hwbString:function(){return n.hwbString(this.values.hwb,this.values.alpha)},keyword:function(){return n.keyword(this.values.rgb,this.values.alpha)},luminosity:function(){for(var e=this.values.rgb,t=[],i=0;i<e.length;i++){var n=e[i]/255;t[i]=.03928>=n?n/12.92:Math.pow((n+.055)/1.055,2.4)}return.2126*t[0]+.7152*t[1]+.0722*t[2]},contrast:function(e){var t=this.luminosity(),i=e.luminosity();return t>i?(t+.05)/(i+.05):(i+.05)/(t+.05)},level:function(e){var t=this.contrast(e);return t>=7.1?"AAA":t>=4.5?"AA":""},dark:function(){var e=this.values.rgb,t=(299*e[0]+587*e[1]+114*e[2])/1e3;return 128>t},light:function(){return!this.dark()},negate:function(){for(var e=[],t=0;3>t;t++)e[t]=255-this.values.rgb[t];return this.setValues("rgb",e),this},lighten:function(e){return this.values.hsl[2]+=this.values.hsl[2]*e,this.setValues("hsl",this.values.hsl),this},darken:function(e){return this.values.hsl[2]-=this.values.hsl[2]*e,this.setValues("hsl",this.values.hsl),this},saturate:function(e){return this.values.hsl[1]+=this.values.hsl[1]*e,this.setValues("hsl",this.values.hsl),this},desaturate:function(e){return this.values.hsl[1]-=this.values.hsl[1]*e,this.setValues("hsl",this.values.hsl),this},whiten:function(e){return this.values.hwb[1]+=this.values.hwb[1]*e,this.setValues("hwb",this.values.hwb),this},blacken:function(e){return this.values.hwb[2]+=this.values.hwb[2]*e,this.setValues("hwb",this.values.hwb),this},greyscale:function(){var e=this.values.rgb,t=.3*e[0]+.59*e[1]+.11*e[2];return this.setValues("rgb",[t,t,t]),this},clearer:function(e){return this.setValues("alpha",this.values.alpha-this.values.alpha*e),this},opaquer:function(e){return this.setValues("alpha",this.values.alpha+this.values.alpha*e),this},rotate:function(e){var t=this.values.hsl[0];return t=(t+e)%360,t=0>t?360+t:t,this.values.hsl[0]=t,this.setValues("hsl",this.values.hsl),this},mix:function(e,t){t=1-(null==t?.5:t);for(var i=2*t-1,n=this.alpha()-e.alpha(),r=((i*n==-1?i:(i+n)/(1+i*n))+1)/2,o=1-r,a=this.rgbArray(),s=e.rgbArray(),l=0;l<a.length;l++)a[l]=a[l]*r+s[l]*o;this.setValues("rgb",a);var u=this.alpha()*t+e.alpha()*(1-t);return this.setValues("alpha",u),this},toJSON:function(){return this.rgb()},clone:function(){return new r(this.rgb())}},r.prototype.getValues=function(e){for(var t={},i=0;i<e.length;i++)t[e[i]]=this.values[e][i];return 1!=this.values.alpha&&(t.a=this.values.alpha),t},r.prototype.setValues=function(e,t){var n={rgb:["red","green","blue"],hsl:["hue","saturation","lightness"],hsv:["hue","saturation","value"],hwb:["hue","whiteness","blackness"],cmyk:["cyan","magenta","yellow","black"]},r={rgb:[255,255,255],hsl:[360,100,100],hsv:[360,100,100],hwb:[360,100,100],cmyk:[100,100,100,100]},o=1;if("alpha"==e)o=t;else if(t.length)this.values[e]=t.slice(0,e.length),o=t[e.length];else if(void 0!==t[e[0]]){for(var a=0;a<e.length;a++)this.values[e][a]=t[e[a]];o=t.a}else if(void 0!==t[n[e][0]]){for(var s=n[e],a=0;a<e.length;a++)this.values[e][a]=t[s[a]];o=t.alpha}if(this.values.alpha=Math.max(0,Math.min(1,void 0!==o?o:this.values.alpha)),"alpha"!=e){for(var a=0;a<e.length;a++){var l=Math.max(0,Math.min(r[e][a],this.values[e][a]));this.values[e][a]=Math.round(l)}for(var u in n){u!=e&&(this.values[u]=i[e][u](this.values[e]));for(var a=0;a<u.length;a++){var l=Math.max(0,Math.min(r[u][a],this.values[u][a]));this.values[u][a]=Math.round(l)}}return!0}},r.prototype.setSpace=function(e,t){var i=t[0];return void 0===i?this.getValues(e):("number"==typeof i&&(i=Array.prototype.slice.call(t)),this.setValues(e,i),this)},r.prototype.setChannel=function(e,t,i){return void 0===i?this.values[e][t]:(this.values[e][t]=i,this.setValues(e,this.values[e]),this)}},{"color-convert":39,"color-string":40}],38:[function(e,t){function i(e){var t,i,n,r=e[0]/255,o=e[1]/255,a=e[2]/255,s=Math.min(r,o,a),l=Math.max(r,o,a),u=l-s;return l==s?t=0:r==l?t=(o-a)/u:o==l?t=2+(a-r)/u:a==l&&(t=4+(r-o)/u),t=Math.min(60*t,360),0>t&&(t+=360),n=(s+l)/2,i=l==s?0:.5>=n?u/(l+s):u/(2-l-s),[t,100*i,100*n]}function n(e){var t,i,n,r=e[0],o=e[1],a=e[2],s=Math.min(r,o,a),l=Math.max(r,o,a),u=l-s;return i=0==l?0:u/l*1e3/10,l==s?t=0:r==l?t=(o-a)/u:o==l?t=2+(a-r)/u:a==l&&(t=4+(r-o)/u),t=Math.min(60*t,360),0>t&&(t+=360),n=l/255*1e3/10,[t,i,n]}function o(e){var t=e[0],n=e[1],r=e[2],o=i(e)[0];return w=1/255*Math.min(t,Math.min(n,r)),r=1-1/255*Math.max(t,Math.max(n,r)),[o,100*w,100*r]}function a(e){var t,i,n,r,o=e[0]/255,a=e[1]/255,s=e[2]/255;return r=Math.min(1-o,1-a,1-s),t=(1-o-r)/(1-r),i=(1-a-r)/(1-r),n=(1-s-r)/(1-r),[100*t,100*i,100*n,100*r]}function s(e){return Q[JSON.stringify(e)]}function l(e){var t=e[0]/255,i=e[1]/255,n=e[2]/255;t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92,i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92;var r=.4124*t+.3576*i+.1805*n,o=.2126*t+.7152*i+.0722*n,a=.0193*t+.1192*i+.9505*n;return[100*r,100*o,100*a]}function u(e){var t,i,n,r=l(e),o=r[0],a=r[1],s=r[2];return o/=95.047,a/=100,s/=108.883,o=o>.008856?Math.pow(o,1/3):7.787*o+16/116,a=a>.008856?Math.pow(a,1/3):7.787*a+16/116,s=s>.008856?Math.pow(s,1/3):7.787*s+16/116,t=116*a-16,i=500*(o-a),n=200*(a-s),[t,i,n]}function c(e){return j(u(e))}function h(e){var t,i,n,r,o,a=e[0]/360,s=e[1]/100,l=e[2]/100;if(0==s)return o=255*l,[o,o,o];i=.5>l?l*(1+s):l+s-l*s,t=2*l-i,r=[0,0,0];for(var u=0;3>u;u++)n=a+1/3*-(u-1),0>n&&n++,n>1&&n--,o=1>6*n?t+6*(i-t)*n:1>2*n?i:2>3*n?t+(i-t)*(2/3-n)*6:t,r[u]=255*o;return r}function f(e){var t,i,n=e[0],r=e[1]/100,o=e[2]/100;return o*=2,r*=1>=o?o:2-o,i=(o+r)/2,t=2*r/(o+r),[n,100*t,100*i]}function p(e){return o(h(e))}function d(e){return a(h(e))}function m(e){return s(h(e))}function v(e){var t=e[0]/60,i=e[1]/100,n=e[2]/100,r=Math.floor(t)%6,o=t-Math.floor(t),a=255*n*(1-i),s=255*n*(1-i*o),l=255*n*(1-i*(1-o)),n=255*n;switch(r){case 0:return[n,l,a];case 1:return[s,n,a];case 2:return[a,n,l];case 3:return[a,s,n];case 4:return[l,a,n];case 5:return[n,a,s]}}function y(e){var t,i,n=e[0],r=e[1]/100,o=e[2]/100;return i=(2-r)*o,t=r*o,t/=1>=i?i:2-i,i/=2,[n,100*t,100*i]}function x(e){return o(v(e))}function _(e){return a(v(e))}function S(e){return s(v(e))}function M(e){var t,i,n,o,a=e[0]/360,s=e[1]/100,l=e[2]/100,u=s+l;switch(u>1&&(s/=u,l/=u),t=Math.floor(6*a),i=1-l,n=6*a-t,0!=(1&t)&&(n=1-n),o=s+n*(i-s),t){default:case 6:case 0:r=i,g=o,b=s;break;case 1:r=o,g=i,b=s;break;case 2:r=s,g=i,b=o;break;case 3:r=s,g=o,b=i;break;case 4:r=o,g=s,b=i;break;case 5:r=i,g=s,b=o}return[255*r,255*g,255*b]}function C(e){return i(M(e))}function A(e){return n(M(e))}function T(e){return a(M(e))}function E(e){return s(M(e))}function k(e){var t,i,n,r=e[0]/100,o=e[1]/100,a=e[2]/100,s=e[3]/100;return t=1-Math.min(1,r*(1-s)+s),i=1-Math.min(1,o*(1-s)+s),n=1-Math.min(1,a*(1-s)+s),[255*t,255*i,255*n]}function P(e){return i(k(e))}function R(e){return n(k(e))}function L(e){return o(k(e))}function D(e){return s(k(e))}function N(e){var t,i,n,r=e[0]/100,o=e[1]/100,a=e[2]/100;return t=3.2406*r+-1.5372*o+a*-.4986,i=r*-.9689+1.8758*o+.0415*a,n=.0557*r+o*-.204+1.057*a,t=t>.0031308?1.055*Math.pow(t,1/2.4)-.055:t=12.92*t,i=i>.0031308?1.055*Math.pow(i,1/2.4)-.055:i=12.92*i,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:n=12.92*n,t=Math.min(Math.max(0,t),1),i=Math.min(Math.max(0,i),1),n=Math.min(Math.max(0,n),1),[255*t,255*i,255*n]}function F(e){var t,i,n,r=e[0],o=e[1],a=e[2];return r/=95.047,o/=100,a/=108.883,r=r>.008856?Math.pow(r,1/3):7.787*r+16/116,o=o>.008856?Math.pow(o,1/3):7.787*o+16/116,a=a>.008856?Math.pow(a,1/3):7.787*a+16/116,t=116*o-16,i=500*(r-o),n=200*(o-a),[t,i,n]}function G(e){return j(F(e))}function O(e){var t,i,n,r,o=e[0],a=e[1],s=e[2];return 8>=o?(i=100*o/903.3,r=7.787*(i/100)+16/116):(i=100*Math.pow((o+16)/116,3),r=Math.pow(i/100,1/3)),t=.008856>=t/95.047?t=95.047*(a/500+r-16/116)/7.787:95.047*Math.pow(a/500+r,3),n=.008859>=n/108.883?n=108.883*(r-s/200-16/116)/7.787:108.883*Math.pow(r-s/200,3),[t,i,n]}function j(e){var t,i,n,r=e[0],o=e[1],a=e[2];return t=Math.atan2(a,o),i=360*t/2/Math.PI,0>i&&(i+=360),n=Math.sqrt(o*o+a*a),[r,n,i]}function I(e){return N(O(e))}function V(e){var t,i,n,r=e[0],o=e[1],a=e[2];return n=a/360*2*Math.PI,t=o*Math.cos(n),i=o*Math.sin(n),[r,t,i]}function U(e){return O(V(e))}function B(e){return I(V(e))}function z(e){return $[e]}function q(e){return i(z(e))}function H(e){return n(z(e))}function W(e){return o(z(e))}function X(e){return a(z(e))}function Y(e){return u(z(e))}function K(e){return l(z(e))}t.exports={rgb2hsl:i,rgb2hsv:n,rgb2hwb:o,rgb2cmyk:a,rgb2keyword:s,rgb2xyz:l,rgb2lab:u,rgb2lch:c,hsl2rgb:h,hsl2hsv:f,hsl2hwb:p,hsl2cmyk:d,hsl2keyword:m,hsv2rgb:v,hsv2hsl:y,hsv2hwb:x,hsv2cmyk:_,hsv2keyword:S,hwb2rgb:M,hwb2hsl:C,hwb2hsv:A,hwb2cmyk:T,hwb2keyword:E,cmyk2rgb:k,cmyk2hsl:P,cmyk2hsv:R,cmyk2hwb:L,cmyk2keyword:D,keyword2rgb:z,keyword2hsl:q,keyword2hsv:H,keyword2hwb:W,keyword2cmyk:X,keyword2lab:Y,keyword2xyz:K,xyz2rgb:N,xyz2lab:F,xyz2lch:G,lab2xyz:O,lab2rgb:I,lab2lch:j,lch2lab:V,lch2xyz:U,lch2rgb:B};var $={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},Q={};for(var Z in $)Q[JSON.stringify($[Z])]=Z},{}],39:[function(e,t){var i=e("./conversions"),n=function(){return new l};for(var r in i){n[r+"Raw"]=function(e){return function(t){return"number"==typeof t&&(t=Array.prototype.slice.call(arguments)),i[e](t)}}(r);var o=/(\w+)2(\w+)/.exec(r),a=o[1],s=o[2];n[a]=n[a]||{},n[a][s]=n[r]=function(e){return function(t){"number"==typeof t&&(t=Array.prototype.slice.call(arguments));var n=i[e](t);if("string"==typeof n||void 0===n)return n;for(var r=0;r<n.length;r++)n[r]=Math.round(n[r]);return n}}(r)}var l=function(){this.convs={}};l.prototype.routeSpace=function(e,t){var i=t[0];return void 0===i?this.getValues(e):("number"==typeof i&&(i=Array.prototype.slice.call(t)),this.setValues(e,i))},l.prototype.setValues=function(e,t){return this.space=e,this.convs={},this.convs[e]=t,this},l.prototype.getValues=function(e){var t=this.convs[e];if(!t){var i=this.space,r=this.convs[i];t=n[i][e](r),this.convs[e]=t}return t},["rgb","hsl","hsv","cmyk","keyword"].forEach(function(e){l.prototype[e]=function(){return this.routeSpace(e,arguments)}}),t.exports=n},{"./conversions":38}],40:[function(e,t){function i(e){if(e){var t=/^#([a-fA-F0-9]{3})$/,i=/^#([a-fA-F0-9]{6})$/,n=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*([\d\.]+)\s*)?\)$/,r=/^rgba?\(\s*([\d\.]+)\%\s*,\s*([\d\.]+)\%\s*,\s*([\d\.]+)\%\s*(?:,\s*([\d\.]+)\s*)?\)$/,o=/(\D+)/,a=[0,0,0],s=1,l=e.match(t);if(l){l=l[1];for(var u=0;u<a.length;u++)a[u]=parseInt(l[u]+l[u],16)}else if(l=e.match(i)){l=l[1];for(var u=0;u<a.length;u++)a[u]=parseInt(l.slice(2*u,2*u+2),16)}else if(l=e.match(n)){for(var u=0;u<a.length;u++)a[u]=parseInt(l[u+1]);s=parseFloat(l[4])}else if(l=e.match(r)){for(var u=0;u<a.length;u++)a[u]=Math.round(2.55*parseFloat(l[u+1]));s=parseFloat(l[4])}else if(l=e.match(o)){if("transparent"==l[1])return[0,0,0,0];if(a=b.keyword2rgb(l[1]),!a)return}for(var u=0;u<a.length;u++)a[u]=v(a[u],0,255);return s=s||0==s?v(s,0,1):1,a.push(s),a}}function n(e){if(e){var t=/^hsla?\(\s*(\d+)\s*,\s*([\d\.]+)%\s*,\s*([\d\.]+)%\s*(?:,\s*([\d\.]+)\s*)?\)/,i=e.match(t);if(i){var n=v(parseInt(i[1]),0,360),r=v(parseFloat(i[2]),0,100),o=v(parseFloat(i[3]),0,100),a=v(parseFloat(i[4])||1,0,1);return[n,r,o,a]}}}function r(e){if(e){var t=/^hwb\(\s*(\d+)\s*,\s*([\d\.]+)%\s*,\s*([\d\.]+)%\s*(?:,\s*([\d\.]+)\s*)?\)/,i=e.match(t);if(i){var n=v(parseInt(i[1]),0,360),r=v(parseFloat(i[2]),0,100),o=v(parseFloat(i[3]),0,100),a=v(parseFloat(i[4])||1,0,1);return[n,r,o,a]}}}function o(e){var t=i(e);return t&&t.slice(0,3)}function a(e){var t=n(e);return t&&t.slice(0,3)}function s(e){var t=i(e);return t?t[3]:(t=n(e))?t[3]:(t=r(e))?t[3]:void 0}function l(e){return"#"+y(e[0])+y(e[1])+y(e[2])}function u(e,t){return 1>t||e[3]&&e[3]<1?c(e,t):"rgb("+e[0]+", "+e[1]+", "+e[2]+")"}function c(e,t){return void 0===t&&(t=void 0!==e[3]?e[3]:1),"rgba("+e[0]+", "+e[1]+", "+e[2]+", "+t+")"}function h(e,t){if(1>t||e[3]&&e[3]<1)return f(e,t);var i=Math.round(e[0]/255*100),n=Math.round(e[1]/255*100),r=Math.round(e[2]/255*100);return"rgb("+i+"%, "+n+"%, "+r+"%)"}function f(e,t){var i=Math.round(e[0]/255*100),n=Math.round(e[1]/255*100),r=Math.round(e[2]/255*100);return"rgba("+i+"%, "+n+"%, "+r+"%, "+(t||e[3]||1)+")"}function p(e,t){return 1>t||e[3]&&e[3]<1?d(e,t):"hsl("+e[0]+", "+e[1]+"%, "+e[2]+"%)"}function d(e,t){return void 0===t&&(t=void 0!==e[3]?e[3]:1),"hsla("+e[0]+", "+e[1]+"%, "+e[2]+"%, "+t+")"}function m(e,t){return void 0===t&&(t=void 0!==e[3]?e[3]:1),"hwb("+e[0]+", "+e[1]+"%, "+e[2]+"%"+(void 0!==t&&1!==t?", "+t:"")+")"}function g(e){return b.rgb2keyword(e.slice(0,3))}function v(e,t,i){return Math.min(Math.max(t,e),i)}function y(e){var t=e.toString(16).toUpperCase();return t.length<2?"0"+t:t}var b=e("color-convert");t.exports={getRgba:i,getHsla:n,getRgb:o,getHsl:a,getHwb:r,getAlpha:s,hexString:l,rgbString:u,rgbaString:c,percentString:h,percentaString:f,hslString:p,hslaString:d,hwbString:m,keyword:g}},{"color-convert":39}],41:[function(){THREE.CopyShader={uniforms:{tDiffuse:{type:"t",value:null},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")}},{}],42:[function(){THREE.DotScreenPass=function(e,t,i,n){void 0===THREE.DotScreenShader&&console.error("THREE.DotScreenPass relies on THREE.DotScreenShader");var r=THREE.DotScreenShader;this.uniforms=THREE.UniformsUtils.clone(r.uniforms),void 0!==e&&this.uniforms.center.value.copy(e),void 0!==t&&(this.uniforms.angle.value=t),void 0!==i&&(this.uniforms.scale.value=i),void 0!==n&&(this.uniforms.mix.value=n),this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader}),this.enabled=!0,this.renderToScreen=!1,this.needsSwap=!0},THREE.DotScreenPass.prototype={render:function(e,t,i){this.uniforms.tDiffuse.value=i,this.uniforms.tSize.value.set(i.width,i.height),THREE.EffectComposer.quad.material=this.material,this.renderToScreen?e.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera):e.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera,t,!1)}}},{}],43:[function(){THREE.EffectComposer=function(e,t){if(this.renderer=e,void 0===t){var i=window.innerWidth||1,n=window.innerHeight||1,r={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1};t=new THREE.WebGLRenderTarget(i,n,r)}this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.passes=[],void 0===THREE.CopyShader&&console.error("THREE.EffectComposer relies on THREE.CopyShader"),this.copyPass=new THREE.ShaderPass(THREE.CopyShader)},THREE.EffectComposer.prototype={swapBuffers:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e},addPass:function(e){this.passes.push(e)},insertPass:function(e,t){this.passes.splice(t,0,e)},render:function(e){this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2;var t,i,n=!1,r=this.passes.length;for(i=0;r>i;i++)if(t=this.passes[i],t.enabled){if(t.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),t.needsSwap){if(n){var o=this.renderer.context;o.stencilFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),o.stencilFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}t instanceof THREE.MaskPass?n=!0:t instanceof THREE.ClearMaskPass&&(n=!1)}},reset:function(e){void 0===e&&(e=this.renderTarget1.clone(),e.width=window.innerWidth,e.height=window.innerHeight),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(e,t){var i=this.renderTarget1.clone();i.width=e,i.height=t,this.reset(i)}},THREE.EffectComposer.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),THREE.EffectComposer.quad=new THREE.Mesh(new THREE.PlaneGeometry(2,2),null),THREE.EffectComposer.scene=new THREE.Scene,THREE.EffectComposer.scene.add(THREE.EffectComposer.quad)},{}],44:[function(){THREE.FilmPass=function(e,t,i,n){void 0===THREE.FilmShader&&console.error("THREE.FilmPass relies on THREE.FilmShader");var r=THREE.FilmShader;this.uniforms=THREE.UniformsUtils.clone(r.uniforms),this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader}),void 0!==n&&(this.uniforms.grayscale.value=n),void 0!==e&&(this.uniforms.nIntensity.value=e),void 0!==t&&(this.uniforms.sIntensity.value=t),void 0!==i&&(this.uniforms.sCount.value=i),this.enabled=!0,this.renderToScreen=!1,this.needsSwap=!0},THREE.FilmPass.prototype={render:function(e,t,i,n){this.uniforms.tDiffuse.value=i,this.uniforms.time.value+=n,THREE.EffectComposer.quad.material=this.material,this.renderToScreen?e.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera):e.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera,t,!1)}}},{}],45:[function(){THREE.MaskPass=function(e,t){this.scene=e,this.camera=t,this.enabled=!0,this.clear=!0,this.needsSwap=!1,this.inverse=!1},THREE.MaskPass.prototype={render:function(e,t,i){var n=e.context;n.colorMask(!1,!1,!1,!1),n.depthMask(!1);var r,o;this.inverse?(r=0,o=1):(r=1,o=0),n.enable(n.STENCIL_TEST),n.stencilOp(n.REPLACE,n.REPLACE,n.REPLACE),n.stencilFunc(n.ALWAYS,r,4294967295),n.clearStencil(o),e.render(this.scene,this.camera,i,this.clear),e.render(this.scene,this.camera,t,this.clear),n.colorMask(!0,!0,!0,!0),n.depthMask(!0),n.stencilFunc(n.EQUAL,1,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP)}},THREE.ClearMaskPass=function(){this.enabled=!0},THREE.ClearMaskPass.prototype={render:function(e){var t=e.context;t.disable(t.STENCIL_TEST)}}},{}],46:[function(){THREE.RenderPass=function(e,t,i,n,r){this.scene=e,this.camera=t,this.overrideMaterial=i,this.clearColor=n,this.clearAlpha=void 0!==r?r:1,this.oldClearColor=new THREE.Color,this.oldClearAlpha=1,this.enabled=!0,this.clear=!0,this.needsSwap=!1},THREE.RenderPass.prototype={render:function(e,t,i){this.scene.overrideMaterial=this.overrideMaterial,this.clearColor&&(this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),e.render(this.scene,this.camera,i,this.clear),this.clearColor&&e.setClearColor(this.oldClearColor,this.oldClearAlpha),this.scene.overrideMaterial=null}}},{}],47:[function(){THREE.ShaderPass=function(e,t){this.textureID=void 0!==t?t:"tDiffuse",this.uniforms=THREE.UniformsUtils.clone(e.uniforms),this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}),this.renderToScreen=!1,this.enabled=!0,this.needsSwap=!0,this.clear=!1},THREE.ShaderPass.prototype={render:function(e,t,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i),THREE.EffectComposer.quad.material=this.material,this.renderToScreen?e.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera):e.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera,t,this.clear)}}},{}],48:[function(){THREE.BleachBypassShader={uniforms:{tDiffuse:{type:"t",value:null},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 base = texture2D( tDiffuse, vUv );","vec3 lumCoeff = vec3( 0.25, 0.65, 0.1 );","float lum = dot( lumCoeff, base.rgb );","vec3 blend = vec3( lum );","float L = min( 1.0, max( 0.0, 10.0 * ( lum - 0.45 ) ) );","vec3 result1 = 2.0 * base.rgb * blend;","vec3 result2 = 1.0 - 2.0 * ( 1.0 - blend ) * ( 1.0 - base.rgb );","vec3 newColor = mix( result1, result2, L );","float A2 = opacity * base.a;","vec3 mixRGB = A2 * newColor.rgb;","mixRGB += ( ( 1.0 - A2 ) * base.rgb );","gl_FragColor = vec4( mixRGB, base.a );","}"].join("\n")}},{}],49:[function(){THREE.ColorifyShader={uniforms:{tDiffuse:{type:"t",value:null},color:{type:"c",value:new THREE.Color(16777215)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","gl_FragColor = vec4( v * color, texel.w );","}"].join("\n")}
},{}],50:[function(){THREE.DotScreenShader={uniforms:{tDiffuse:{type:"t",value:null},tSize:{type:"v2",value:new THREE.Vector2(256,256)},center:{type:"v2",value:new THREE.Vector2(.5,.5)},angle:{type:"f",value:1.57},scale:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec2 center;","uniform float angle;","uniform float scale;","uniform vec2 tSize;","uniform sampler2D tDiffuse;","varying vec2 vUv;","float pattern() {","float s = sin( angle ), c = cos( angle );","vec2 tex = vUv * tSize - center;","vec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;","return ( sin( point.x ) * sin( point.y ) ) * 4.0;","}","void main() {","vec4 color = texture2D( tDiffuse, vUv );","float average = ( color.r + color.g + color.b ) / 3.0;","gl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );","}"].join("\n")}},{}],51:[function(){THREE.EdgeShader={uniforms:{tDiffuse:{type:"t",value:null},aspect:{type:"v2",value:new THREE.Vector2(512,512)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","uniform vec2 aspect;","vec2 texel = vec2(1.0 / aspect.x, 1.0 / aspect.y);","mat3 G[9];","const mat3 g0 = mat3( 0.3535533845424652, 0, -0.3535533845424652, 0.5, 0, -0.5, 0.3535533845424652, 0, -0.3535533845424652 );","const mat3 g1 = mat3( 0.3535533845424652, 0.5, 0.3535533845424652, 0, 0, 0, -0.3535533845424652, -0.5, -0.3535533845424652 );","const mat3 g2 = mat3( 0, 0.3535533845424652, -0.5, -0.3535533845424652, 0, 0.3535533845424652, 0.5, -0.3535533845424652, 0 );","const mat3 g3 = mat3( 0.5, -0.3535533845424652, 0, -0.3535533845424652, 0, 0.3535533845424652, 0, 0.3535533845424652, -0.5 );","const mat3 g4 = mat3( 0, -0.5, 0, 0.5, 0, 0.5, 0, -0.5, 0 );","const mat3 g5 = mat3( -0.5, 0, 0.5, 0, 0, 0, 0.5, 0, -0.5 );","const mat3 g6 = mat3( 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.6666666865348816, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204 );","const mat3 g7 = mat3( -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, 0.6666666865348816, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408 );","const mat3 g8 = mat3( 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408 );","void main(void)","{","G[0] = g0,","G[1] = g1,","G[2] = g2,","G[3] = g3,","G[4] = g4,","G[5] = g5,","G[6] = g6,","G[7] = g7,","G[8] = g8;","mat3 I;","float cnv[9];","vec3 sample;","for (float i=0.0; i<3.0; i++) {","for (float j=0.0; j<3.0; j++) {","sample = texture2D(tDiffuse, vUv + texel * vec2(i-1.0,j-1.0) ).rgb;","I[int(i)][int(j)] = length(sample);","}","}","for (int i=0; i<9; i++) {","float dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);","cnv[i] = dp3 * dp3;","}","float M = (cnv[0] + cnv[1]) + (cnv[2] + cnv[3]);","float S = (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]) + (cnv[8] + M);","gl_FragColor = vec4(vec3(sqrt(M/S)), 1.0);","}"].join("\n")}},{}],52:[function(){THREE.FilmShader={uniforms:{tDiffuse:{type:"t",value:null},time:{type:"f",value:0},nIntensity:{type:"f",value:.5},sIntensity:{type:"f",value:.05},sCount:{type:"f",value:4096},grayscale:{type:"i",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float time;","uniform bool grayscale;","uniform float nIntensity;","uniform float sIntensity;","uniform float sCount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 cTextureScreen = texture2D( tDiffuse, vUv );","float x = vUv.x * vUv.y * time *  1000.0;","x = mod( x, 13.0 ) * mod( x, 123.0 );","float dx = mod( x, 0.01 );","vec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx * 100.0, 0.0, 1.0 );","vec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );","cResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;","cResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );","if( grayscale ) {","cResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );","}","gl_FragColor =  vec4( cResult, cTextureScreen.a );","}"].join("\n")}},{}],53:[function(){THREE.FocusShader={uniforms:{tDiffuse:{type:"t",value:null},screenWidth:{type:"f",value:1024},screenHeight:{type:"f",value:1024},sampleDistance:{type:"f",value:.94},waveFactor:{type:"f",value:.00125}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float screenWidth;","uniform float screenHeight;","uniform float sampleDistance;","uniform float waveFactor;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 color, org, tmp, add;","float sample_dist, f;","vec2 vin;","vec2 uv = vUv;","add = color = org = texture2D( tDiffuse, uv );","vin = ( uv - vec2( 0.5 ) ) * vec2( 1.4 );","sample_dist = dot( vin, vin ) * 2.0;","f = ( waveFactor * 100.0 + sample_dist ) * sampleDistance * 4.0;","vec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2( f );","add += tmp = texture2D( tDiffuse, uv + vec2( 0.111964, 0.993712 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( 0.846724, 0.532032 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( 0.943883, -0.330279 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( 0.330279, -0.943883 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( -0.532032, -0.846724 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( -0.993712, -0.111964 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( -0.707107, 0.707107 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","color = color * vec4( 2.0 ) - ( add / vec4( 8.0 ) );","color = color + ( add / vec4( 8.0 ) - color ) * ( vec4( 1.0 ) - vec4( sample_dist * 0.5 ) );","gl_FragColor = vec4( color.rgb * color.rgb * vec3( 0.95 ) + color.rgb, 1.0 );","}"].join("\n")}},{}],54:[function(){THREE.KaleidoShader={uniforms:{tDiffuse:{type:"t",value:null},sides:{type:"f",value:6},angle:{type:"f",value:0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float sides;","uniform float angle;","varying vec2 vUv;","void main() {","vec2 p = vUv - 0.5;","float r = length(p);","float a = atan(p.y, p.x) + angle;","float tau = 2. * 3.1416 ;","a = mod(a, tau/sides);","a = abs(a - tau/sides/2.) ;","p = r * vec2(cos(a), sin(a));","vec4 color = texture2D(tDiffuse, p + 0.5);","gl_FragColor = color;","}"].join("\n")}},{}],55:[function(){THREE.ShaderGodRays={godrays_generate:{uniforms:{tInput:{type:"t",value:null},fStepSize:{type:"f",value:1},vSunPositionScreenSpace:{type:"v2",value:new THREE.Vector2(.5,.5)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define TAPS_PER_PASS 6.0","varying vec2 vUv;","uniform sampler2D tInput;","uniform vec2 vSunPositionScreenSpace;","uniform float fStepSize;","void main() {","vec2 delta = vSunPositionScreenSpace - vUv;","float dist = length( delta );","vec2 stepv = fStepSize * delta / dist;","float iters = dist/fStepSize;","vec2 uv = vUv.xy;","float col = 0.0;","if ( 0.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 1.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 2.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 3.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 4.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 5.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","gl_FragColor = vec4( col/TAPS_PER_PASS );","gl_FragColor.a = 1.0;","}"].join("\n")},godrays_combine:{uniforms:{tColors:{type:"t",value:null},tGodRays:{type:"t",value:null},fGodRayIntensity:{type:"f",value:.69},vSunPositionScreenSpace:{type:"v2",value:new THREE.Vector2(.5,.5)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform sampler2D tColors;","uniform sampler2D tGodRays;","uniform vec2 vSunPositionScreenSpace;","uniform float fGodRayIntensity;","void main() {","gl_FragColor = texture2D( tColors, vUv ) + fGodRayIntensity * vec4( 1.0 - texture2D( tGodRays, vUv ).r );","gl_FragColor.a = 1.0;","}"].join("\n")},godrays_fake_sun:{uniforms:{vSunPositionScreenSpace:{type:"v2",value:new THREE.Vector2(.5,.5)},fAspect:{type:"f",value:1},sunColor:{type:"c",value:new THREE.Color(16772608)},bgColor:{type:"c",value:new THREE.Color(0)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform vec2 vSunPositionScreenSpace;","uniform float fAspect;","uniform vec3 sunColor;","uniform vec3 bgColor;","void main() {","vec2 diff = vUv - vSunPositionScreenSpace;","diff.x *= fAspect;","float prop = clamp( length( diff ) / 0.5, 0.0, 1.0 );","prop = 0.35 * pow( 1.0 - prop, 3.0 );","gl_FragColor.xyz = mix( sunColor, bgColor, 1.0 - prop );","gl_FragColor.w = 1.0;","}"].join("\n")}}},{}],56:[function(e,t){!function(){"use strict";var e=window.THREE=e||{REVISION:"58"};self.console=self.console||{info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}},self.Int32Array=self.Int32Array||Array,self.Float32Array=self.Float32Array||Array,String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},e.extend=function(e,t){if(Object.keys)for(var i=Object.keys(t),n=0,r=i.length;r>n;n++){var o=i[n];Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(t,o))}else for(o in i={}.hasOwnProperty,t)i.call(t,o)&&(e[o]=t[o]);return e},function(){for(var e=0,t=["ms","moz","webkit","o"],i=0;i<t.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[t[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[i]+"CancelAnimationFrame"]||window[t[i]+"CancelRequestAnimationFrame"];void 0===window.requestAnimationFrame&&(window.requestAnimationFrame=function(t){var i=Date.now(),n=Math.max(0,16-(i-e)),r=window.setTimeout(function(){t(i+n)},n);return e=i+n,r}),window.cancelAnimationFrame=window.cancelAnimationFrame||function(e){window.clearTimeout(e)}}(),e.CullFaceNone=0,e.CullFaceBack=1,e.CullFaceFront=2,e.CullFaceFrontBack=3,e.FrontFaceDirectionCW=0,e.FrontFaceDirectionCCW=1,e.BasicShadowMap=0,e.PCFShadowMap=1,e.PCFSoftShadowMap=2,e.FrontSide=0,e.BackSide=1,e.DoubleSide=2,e.NoShading=0,e.FlatShading=1,e.SmoothShading=2,e.NoColors=0,e.FaceColors=1,e.VertexColors=2,e.NoBlending=0,e.NormalBlending=1,e.AdditiveBlending=2,e.SubtractiveBlending=3,e.MultiplyBlending=4,e.CustomBlending=5,e.AddEquation=100,e.SubtractEquation=101,e.ReverseSubtractEquation=102,e.ZeroFactor=200,e.OneFactor=201,e.SrcColorFactor=202,e.OneMinusSrcColorFactor=203,e.SrcAlphaFactor=204,e.OneMinusSrcAlphaFactor=205,e.DstAlphaFactor=206,e.OneMinusDstAlphaFactor=207,e.DstColorFactor=208,e.OneMinusDstColorFactor=209,e.SrcAlphaSaturateFactor=210,e.MultiplyOperation=0,e.MixOperation=1,e.AddOperation=2,e.UVMapping=function(){},e.CubeReflectionMapping=function(){},e.CubeRefractionMapping=function(){},e.SphericalReflectionMapping=function(){},e.SphericalRefractionMapping=function(){},e.RepeatWrapping=1e3,e.ClampToEdgeWrapping=1001,e.MirroredRepeatWrapping=1002,e.NearestFilter=1003,e.NearestMipMapNearestFilter=1004,e.NearestMipMapLinearFilter=1005,e.LinearFilter=1006,e.LinearMipMapNearestFilter=1007,e.LinearMipMapLinearFilter=1008,e.UnsignedByteType=1009,e.ByteType=1010,e.ShortType=1011,e.UnsignedShortType=1012,e.IntType=1013,e.UnsignedIntType=1014,e.FloatType=1015,e.UnsignedShort4444Type=1016,e.UnsignedShort5551Type=1017,e.UnsignedShort565Type=1018,e.AlphaFormat=1019,e.RGBFormat=1020,e.RGBAFormat=1021,e.LuminanceFormat=1022,e.LuminanceAlphaFormat=1023,e.RGB_S3TC_DXT1_Format=2001,e.RGBA_S3TC_DXT1_Format=2002,e.RGBA_S3TC_DXT3_Format=2003,e.RGBA_S3TC_DXT5_Format=2004,e.Color=function(e){return void 0!==e&&this.set(e),this},e.Color.prototype={constructor:e.Color,r:1,g:1,b:1,set:function(t){return t instanceof e.Color?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,i){return this.r=e,this.g=t,this.b=i,this},setHSL:function(e,t,i){if(0===t)this.r=this.g=this.b=i;else{var n=function(e,t,i){return 0>i&&(i+=1),i>1&&(i-=1),1/6>i?e+6*(t-e)*i:.5>i?t:2/3>i?e+6*(t-e)*(2/3-i):e},t=.5>=i?i*(1+t):i+t-i*t,i=2*i-t;this.r=n(i,t,e+1/3),this.g=n(i,t,e),this.b=n(i,t,e-1/3)}return this},setStyle:function(t){return/^rgb\((\d+),(\d+),(\d+)\)$/i.test(t)?(t=/^rgb\((\d+),(\d+),(\d+)\)$/i.exec(t),this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,this):/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i.test(t)?(t=/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i.exec(t),this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,this):/^\#([0-9a-f]{6})$/i.test(t)?(t=/^\#([0-9a-f]{6})$/i.exec(t),this.setHex(parseInt(t[1],16)),this):/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(t)?(t=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(t),this.setHex(parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3],16)),this):/^(\w+)$/i.test(t)?(this.setHex(e.ColorKeywords[t]),this):void 0},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e){return this.r=e.r*e.r,this.g=e.g*e.g,this.b=e.b*e.b,this},copyLinearToGamma:function(e){return this.r=Math.sqrt(e.r),this.g=Math.sqrt(e.g),this.b=Math.sqrt(e.b),this},convertGammaToLinear:function(){var e=this.r,t=this.g,i=this.b;return this.r=e*e,this.g=t*t,this.b=i*i,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(){var e={h:0,s:0,l:0};return function(){var t,i=this.r,n=this.g,r=this.b,o=Math.max(i,n,r),a=Math.min(i,n,r),s=(a+o)/2;if(a===o)a=t=0;else{var l=o-a,a=.5>=s?l/(o+a):l/(2-o-a);switch(o){case i:t=(n-r)/l+(r>n?6:0);break;case n:t=(r-i)/l+2;break;case r:t=(i-n)/l+4}t/=6}return e.h=t,e.s=a,e.l=s,e}}(),getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,i){var n=this.getHSL();return n.h+=e,n.s+=t,n.l+=i,this.setHSL(n.h,n.s,n.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},clone:function(){return(new e.Color).setRGB(this.r,this.g,this.b)}},e.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},e.Quaternion=function(e,t,i,n){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==n?n:1},e.Quaternion.prototype={constructor:e.Quaternion,set:function(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},setFromEuler:function(e,t){var i=Math.cos(e.x/2),n=Math.cos(e.y/2),r=Math.cos(e.z/2),o=Math.sin(e.x/2),a=Math.sin(e.y/2),s=Math.sin(e.z/2);return void 0===t||"XYZ"===t?(this.x=o*n*r+i*a*s,this.y=i*a*r-o*n*s,this.z=i*n*s+o*a*r,this.w=i*n*r-o*a*s):"YXZ"===t?(this.x=o*n*r+i*a*s,this.y=i*a*r-o*n*s,this.z=i*n*s-o*a*r,this.w=i*n*r+o*a*s):"ZXY"===t?(this.x=o*n*r-i*a*s,this.y=i*a*r+o*n*s,this.z=i*n*s+o*a*r,this.w=i*n*r-o*a*s):"ZYX"===t?(this.x=o*n*r-i*a*s,this.y=i*a*r+o*n*s,this.z=i*n*s-o*a*r,this.w=i*n*r+o*a*s):"YZX"===t?(this.x=o*n*r+i*a*s,this.y=i*a*r+o*n*s,this.z=i*n*s-o*a*r,this.w=i*n*r-o*a*s):"XZY"===t&&(this.x=o*n*r-i*a*s,this.y=i*a*r-o*n*s,this.z=i*n*s+o*a*r,this.w=i*n*r+o*a*s),this},setFromAxisAngle:function(e,t){var i=t/2,n=Math.sin(i);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(i),this},setFromRotationMatrix:function(e){var t=e.elements,i=t[0],e=t[4],n=t[8],r=t[1],o=t[5],a=t[9],s=t[2],l=t[6],t=t[10],u=i+o+t;return u>0?(i=.5/Math.sqrt(u+1),this.w=.25/i,this.x=(l-a)*i,this.y=(n-s)*i,this.z=(r-e)*i):i>o&&i>t?(i=2*Math.sqrt(1+i-o-t),this.w=(l-a)/i,this.x=.25*i,this.y=(e+r)/i,this.z=(n+s)/i):o>t?(i=2*Math.sqrt(1+o-i-t),this.w=(n-s)/i,this.x=(e+r)/i,this.y=.25*i,this.z=(a+l)/i):(i=2*Math.sqrt(1+t-i-o),this.w=(r-e)/i,this.x=(n+s)/i,this.y=(a+l)/i,this.z=.25*i),this},inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var e=this.length();return 0===e?(this.z=this.y=this.x=0,this.w=1):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this},multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Quaternion's .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var i=e.x,n=e.y,r=e.z,o=e.w,a=t.x,s=t.y,l=t.z,u=t.w;return this.x=i*u+o*a+n*l-r*s,this.y=n*u+o*s+r*a-i*l,this.z=r*u+o*l+i*s-n*a,this.w=o*u-i*a-n*s-r*l,this},multiplyVector3:function(e){return console.warn("DEPRECATED: Quaternion's .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},slerp:function(e,t){var i=this.x,n=this.y,r=this.z,o=this.w,a=o*e.w+i*e.x+n*e.y+r*e.z;if(0>a?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,a=-a):this.copy(e),a>=1)return this.w=o,this.x=i,this.y=n,this.z=r,this;var s=Math.acos(a),l=Math.sqrt(1-a*a);return.001>Math.abs(l)?(this.w=.5*(o+this.w),this.x=.5*(i+this.x),this.y=.5*(n+this.y),this.z=.5*(r+this.z),this):(a=Math.sin((1-t)*s)/l,s=Math.sin(t*s)/l,this.w=o*a+this.w*s,this.x=i*a+this.x*s,this.y=n*a+this.y*s,this.z=r*a+this.z*s,this)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this.w=e[3],this},toArray:function(){return[this.x,this.y,this.z,this.w]},clone:function(){return new e.Quaternion(this.x,this.y,this.z,this.w)}},e.Quaternion.slerp=function(e,t,i,n){return i.copy(e).slerp(t,n)},e.Vector2=function(e,t){this.x=e||0,this.y=t||0},e.Vector2.prototype={constructor:e.Vector2,set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector2's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScalar:function(e){return this.x+=e,this.y+=e,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector2's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divideScalar:function(e){return 0!==e?(this.x/=e,this.y/=e):this.set(0,0),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,e=this.y-e.y;return t*t+e*e},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e){return this.x=e[0],this.y=e[1],this},toArray:function(){return[this.x,this.y]},clone:function(){return new e.Vector2(this.x,this.y)}},e.Vector3=function(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0},e.Vector3.prototype={constructor:e.Vector3,set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyMatrix3:function(e){var t=this.x,i=this.y,n=this.z,e=e.elements;return this.x=e[0]*t+e[3]*i+e[6]*n,this.y=e[1]*t+e[4]*i+e[7]*n,this.z=e[2]*t+e[5]*i+e[8]*n,this},applyMatrix4:function(e){var t=this.x,i=this.y,n=this.z,e=e.elements;return this.x=e[0]*t+e[4]*i+e[8]*n+e[12],this.y=e[1]*t+e[5]*i+e[9]*n+e[13],this.z=e[2]*t+e[6]*i+e[10]*n+e[14],this},applyProjection:function(e){var t=this.x,i=this.y,n=this.z,e=e.elements,r=1/(e[3]*t+e[7]*i+e[11]*n+e[15]);return this.x=(e[0]*t+e[4]*i+e[8]*n+e[12])*r,this.y=(e[1]*t+e[5]*i+e[9]*n+e[13])*r,this.z=(e[2]*t+e[6]*i+e[10]*n+e[14])*r,this},applyQuaternion:function(e){var t=this.x,i=this.y,n=this.z,r=e.x,o=e.y,a=e.z,e=e.w,s=e*t+o*n-a*i,l=e*i+a*t-r*n,u=e*n+r*i-o*t,t=-r*t-o*i-a*n;return this.x=s*e+t*-r+l*-a-u*-o,this.y=l*e+t*-o+u*-r-s*-a,this.z=u*e+t*-a+s*-o-l*-r,this},transformDirection:function(e){var t=this.x,i=this.y,n=this.z,e=e.elements;return this.x=e[0]*t+e[4]*i+e[8]*n,this.y=e[1]*t+e[5]*i+e[9]*n,this.z=e[2]*t+e[6]*i+e[10]*n,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return 0!==e?(this.x/=e,this.y/=e,this.z/=e):this.z=this.y=this.x=0,this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},cross:function(e,t){if(void 0!==t)return console.warn("DEPRECATED: Vector3's .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var i=this.x,n=this.y,r=this.z;return this.x=n*e.z-r*e.y,this.y=r*e.x-i*e.z,this.z=i*e.y-n*e.x,this},crossVectors:function(e,t){return this.x=e.y*t.z-e.z*t.y,this.y=e.z*t.x-e.x*t.z,this.z=e.x*t.y-e.y*t.x,this},angleTo:function(t){return t=this.dot(t)/(this.length()*t.length()),Math.acos(e.Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y,e=this.z-e.z;return t*t+i*i+e*e},setEulerFromRotationMatrix:function(e,t){function i(e){return Math.min(Math.max(e,-1),1)}var n=e.elements,r=n[0],o=n[4],a=n[8],s=n[1],l=n[5],u=n[9],c=n[2],h=n[6],n=n[10];return void 0===t||"XYZ"===t?(this.y=Math.asin(i(a)),.99999>Math.abs(a)?(this.x=Math.atan2(-u,n),this.z=Math.atan2(-o,r)):(this.x=Math.atan2(h,l),this.z=0)):"YXZ"===t?(this.x=Math.asin(-i(u)),.99999>Math.abs(u)?(this.y=Math.atan2(a,n),this.z=Math.atan2(s,l)):(this.y=Math.atan2(-c,r),this.z=0)):"ZXY"===t?(this.x=Math.asin(i(h)),.99999>Math.abs(h)?(this.y=Math.atan2(-c,n),this.z=Math.atan2(-o,l)):(this.y=0,this.z=Math.atan2(s,r))):"ZYX"===t?(this.y=Math.asin(-i(c)),.99999>Math.abs(c)?(this.x=Math.atan2(h,n),this.z=Math.atan2(s,r)):(this.x=0,this.z=Math.atan2(-o,l))):"YZX"===t?(this.z=Math.asin(i(s)),.99999>Math.abs(s)?(this.x=Math.atan2(-u,l),this.y=Math.atan2(-c,r)):(this.x=0,this.y=Math.atan2(a,n))):"XZY"===t&&(this.z=Math.asin(-i(o)),.99999>Math.abs(o)?(this.x=Math.atan2(h,l),this.y=Math.atan2(a,r)):(this.x=Math.atan2(-u,n),this.y=0)),this},setEulerFromQuaternion:function(e,t){function i(e){return Math.min(Math.max(e,-1),1)}var n=e.x*e.x,r=e.y*e.y,o=e.z*e.z,a=e.w*e.w;return void 0===t||"XYZ"===t?(this.x=Math.atan2(2*(e.x*e.w-e.y*e.z),a-n-r+o),this.y=Math.asin(i(2*(e.x*e.z+e.y*e.w))),this.z=Math.atan2(2*(e.z*e.w-e.x*e.y),a+n-r-o)):"YXZ"===t?(this.x=Math.asin(i(2*(e.x*e.w-e.y*e.z))),this.y=Math.atan2(2*(e.x*e.z+e.y*e.w),a-n-r+o),this.z=Math.atan2(2*(e.x*e.y+e.z*e.w),a-n+r-o)):"ZXY"===t?(this.x=Math.asin(i(2*(e.x*e.w+e.y*e.z))),this.y=Math.atan2(2*(e.y*e.w-e.z*e.x),a-n-r+o),this.z=Math.atan2(2*(e.z*e.w-e.x*e.y),a-n+r-o)):"ZYX"===t?(this.x=Math.atan2(2*(e.x*e.w+e.z*e.y),a-n-r+o),this.y=Math.asin(i(2*(e.y*e.w-e.x*e.z))),this.z=Math.atan2(2*(e.x*e.y+e.z*e.w),a+n-r-o)):"YZX"===t?(this.x=Math.atan2(2*(e.x*e.w-e.z*e.y),a-n+r-o),this.y=Math.atan2(2*(e.y*e.w-e.x*e.z),a+n-r-o),this.z=Math.asin(i(2*(e.x*e.y+e.z*e.w)))):"XZY"===t&&(this.x=Math.atan2(2*(e.x*e.w+e.y*e.z),a-n+r-o),this.y=Math.atan2(2*(e.x*e.z+e.y*e.w),a+n-r-o),this.z=Math.asin(i(2*(e.z*e.w-e.x*e.y)))),this},getPositionFromMatrix:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},getScaleFromMatrix:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),i=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),e=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=i,this.z=e,this},getColumnFromMatrix:function(e,t){var i=4*e,n=t.elements;return this.x=n[i],this.y=n[i+1],this.z=n[i+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this},toArray:function(){return[this.x,this.y,this.z]
},clone:function(){return new e.Vector3(this.x,this.y,this.z)}},e.extend(e.Vector3.prototype,{applyEuler:function(){var t=new e.Quaternion;return function(e,i){var n=t.setFromEuler(e,i);return this.applyQuaternion(n),this}}(),applyAxisAngle:function(){var t=new e.Quaternion;return function(e,i){var n=t.setFromAxisAngle(e,i);return this.applyQuaternion(n),this}}(),projectOnVector:function(){var t=new e.Vector3;return function(e){return t.copy(e).normalize(),e=this.dot(t),this.copy(t).multiplyScalar(e)}}(),projectOnPlane:function(){var t=new e.Vector3;return function(e){return t.copy(this).projectOnVector(e),this.sub(t)}}(),reflect:function(){var t=new e.Vector3;return function(e){return t.copy(this).projectOnVector(e).multiplyScalar(2),this.subVectors(t,this)}}()}),e.Vector4=function(e,t,i,n){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==n?n:1},e.Vector4.prototype={constructor:e.Vector4,set:function(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector4's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector4's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,i=this.y,n=this.z,r=this.w,e=e.elements;return this.x=e[0]*t+e[4]*i+e[8]*n+e[12]*r,this.y=e[1]*t+e[5]*i+e[9]*n+e[13]*r,this.z=e[2]*t+e[6]*i+e[10]*n+e[14]*r,this.w=e[3]*t+e[7]*i+e[11]*n+e[15]*r,this},divideScalar:function(e){return 0!==e?(this.x/=e,this.y/=e,this.z/=e,this.w/=e):(this.z=this.y=this.x=0,this.w=1),this},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return 1e-4>t?(this.x=1,this.z=this.y=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,i,n,e=e.elements,r=e[0];n=e[4];var o=e[8],a=e[1],s=e[5],l=e[9];i=e[2],t=e[6];var u=e[10];return.01>Math.abs(n-a)&&.01>Math.abs(o-i)&&.01>Math.abs(l-t)?.1>Math.abs(n+a)&&.1>Math.abs(o+i)&&.1>Math.abs(l+t)&&.1>Math.abs(r+s+u-3)?(this.set(1,0,0,0),this):(e=Math.PI,r=(r+1)/2,s=(s+1)/2,u=(u+1)/2,n=(n+a)/4,o=(o+i)/4,l=(l+t)/4,r>s&&r>u?.01>r?(t=0,n=i=.707106781):(t=Math.sqrt(r),i=n/t,n=o/t):s>u?.01>s?(t=.707106781,i=0,n=.707106781):(i=Math.sqrt(s),t=n/i,n=l/i):.01>u?(i=t=.707106781,n=0):(n=Math.sqrt(u),t=o/n,i=l/n),this.set(t,i,n,e),this):(e=Math.sqrt((t-l)*(t-l)+(o-i)*(o-i)+(a-n)*(a-n)),.001>Math.abs(e)&&(e=1),this.x=(t-l)/e,this.y=(o-i)/e,this.z=(a-n)/e,this.w=Math.acos((r+s+u-1)/2),this)},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this.w>e.w&&(this.w=e.w),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this.w<e.w&&(this.w=e.w),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this.w<e.w?this.w=e.w:this.w>t.w&&(this.w=t.w),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this.w=e[3],this},toArray:function(){return[this.x,this.y,this.z,this.w]},clone:function(){return new e.Vector4(this.x,this.y,this.z,this.w)}},e.Line3=function(t,i){this.start=void 0!==t?t:new e.Vector3,this.end=void 0!==i?i:new e.Vector3},e.Line3.prototype={constructor:e.Line3,set:function(e,t){return this.start.copy(e),this.end.copy(t),this},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},center:function(t){return(t||new e.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){return(t||new e.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,i){var n=i||new e.Vector3;return this.delta(n).multiplyScalar(t).add(this.start)},closestPointToPointParameter:function(){var t=new e.Vector3,i=new e.Vector3;return function(n,r){t.subVectors(n,this.start),i.subVectors(this.end,this.start);var o=i.dot(i),o=i.dot(t)/o;return r&&(o=e.Math.clamp(o,0,1)),o}}(),closestPointToPoint:function(t,i,n){return t=this.closestPointToPointParameter(t,i),n=n||new e.Vector3,this.delta(n).multiplyScalar(t).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)},clone:function(){return(new e.Line3).copy(this)}},e.Box2=function(t,i){this.min=void 0!==t?t:new e.Vector2(1/0,1/0),this.max=void 0!==i?i:new e.Vector2(-1/0,-1/0)},e.Box2.prototype={constructor:e.Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){if(0<e.length){var t=e[0];this.min.copy(t),this.max.copy(t);for(var i=1,n=e.length;n>i;i++)t=e[i],t.x<this.min.x?this.min.x=t.x:t.x>this.max.x&&(this.max.x=t.x),t.y<this.min.y?this.min.y=t.y:t.y>this.max.y&&(this.max.y=t.y)}else this.makeEmpty();return this},setFromCenterAndSize:function(){var t=new e.Vector2;return function(e,i){var n=t.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(t){return(t||new e.Vector2).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(t){return(t||new e.Vector2).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y?!0:!1},getParameter:function(t){return new e.Vector2((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y?!1:!0},clampPoint:function(t,i){return(i||new e.Vector2).copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new e.Vector2;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new e.Box2).copy(this)}},e.Box3=function(t,i){this.min=void 0!==t?t:new e.Vector3(1/0,1/0,1/0),this.max=void 0!==i?i:new e.Vector3(-1/0,-1/0,-1/0)},e.Box3.prototype={constructor:e.Box3,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){if(0<e.length){var t=e[0];this.min.copy(t),this.max.copy(t);for(var i=1,n=e.length;n>i;i++)t=e[i],t.x<this.min.x?this.min.x=t.x:t.x>this.max.x&&(this.max.x=t.x),t.y<this.min.y?this.min.y=t.y:t.y>this.max.y&&(this.max.y=t.y),t.z<this.min.z?this.min.z=t.z:t.z>this.max.z&&(this.max.z=t.z)}else this.makeEmpty();return this},setFromCenterAndSize:function(){var t=new e.Vector3;return function(e,i){var n=t.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(t){return(t||new e.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(t){return(t||new e.Vector3).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z?!0:!1},getParameter:function(t){return new e.Vector3((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z?!1:!0},clampPoint:function(t,i){return(i||new e.Vector3).copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new e.Vector3;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),getBoundingSphere:function(){var t=new e.Vector3;return function(i){return i=i||new e.Sphere,i.center=this.center(),i.radius=.5*this.size(t).length(),i}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var t=[new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3];return function(e){return t[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),t[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),t[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),t[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),t[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),t[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),t[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),t[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.makeEmpty(),this.setFromPoints(t),this}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new e.Box3).copy(this)}},e.Matrix3=function(e,t,i,n,r,o,a,s,l){this.elements=new Float32Array(9),this.set(void 0!==e?e:1,t||0,i||0,n||0,void 0!==r?r:1,o||0,a||0,s||0,void 0!==l?l:1)},e.Matrix3.prototype={constructor:e.Matrix3,set:function(e,t,i,n,r,o,a,s,l){var u=this.elements;return u[0]=e,u[3]=t,u[6]=i,u[1]=n,u[4]=r,u[7]=o,u[2]=a,u[5]=s,u[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(e){return e=e.elements,this.set(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]),this},multiplyVector3:function(e){return console.warn("DEPRECATED: Matrix3's .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){var t=new e.Vector3;return function(e){for(var i=0,n=e.length;n>i;i+=3)t.x=e[i],t.y=e[i+1],t.z=e[i+2],t.applyMatrix3(this),e[i]=t.x,e[i+1]=t.y,e[i+2]=t.z;return e}}(),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],o=e[4],a=e[5],s=e[6],l=e[7],e=e[8];return t*o*e-t*a*l-i*r*e+i*a*s+n*r*l-n*o*s},getInverse:function(e,t){var i=e.elements,n=this.elements;if(n[0]=i[10]*i[5]-i[6]*i[9],n[1]=-i[10]*i[1]+i[2]*i[9],n[2]=i[6]*i[1]-i[2]*i[5],n[3]=-i[10]*i[4]+i[6]*i[8],n[4]=i[10]*i[0]-i[2]*i[8],n[5]=-i[6]*i[0]+i[2]*i[4],n[6]=i[9]*i[4]-i[5]*i[8],n[7]=-i[9]*i[0]+i[1]*i[8],n[8]=i[5]*i[0]-i[1]*i[4],i=i[0]*n[0]+i[1]*n[3]+i[2]*n[6],0===i){if(t)throw Error("Matrix3.getInverse(): can't invert matrix, determinant is 0");return console.warn("Matrix3.getInverse(): can't invert matrix, determinant is 0"),this.identity(),this}return this.multiplyScalar(1/i),this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},clone:function(){var t=this.elements;return new e.Matrix3(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8])}},e.Matrix4=function(e,t,i,n,r,o,a,s,l,u,c,h,f,p,d,m){var g=this.elements=new Float32Array(16);g[0]=void 0!==e?e:1,g[4]=t||0,g[8]=i||0,g[12]=n||0,g[1]=r||0,g[5]=void 0!==o?o:1,g[9]=a||0,g[13]=s||0,g[2]=l||0,g[6]=u||0,g[10]=void 0!==c?c:1,g[14]=h||0,g[3]=f||0,g[7]=p||0,g[11]=d||0,g[15]=void 0!==m?m:1},e.Matrix4.prototype={constructor:e.Matrix4,set:function(e,t,i,n,r,o,a,s,l,u,c,h,f,p,d,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=n,g[1]=r,g[5]=o,g[9]=a,g[13]=s,g[2]=l,g[6]=u,g[10]=c,g[14]=h,g[3]=f,g[7]=p,g[11]=d,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return e=e.elements,this.set(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]),this},extractPosition:function(e){return console.warn("DEPRECATED: Matrix4's .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},copyPosition:function(e){var t=this.elements,e=e.elements;return t[12]=e[12],t[13]=e[13],t[14]=e[14],this},extractRotation:function(){var t=new e.Vector3;return function(e){var i=this.elements,e=e.elements,n=1/t.set(e[0],e[1],e[2]).length(),r=1/t.set(e[4],e[5],e[6]).length(),o=1/t.set(e[8],e[9],e[10]).length();return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[4]=e[4]*r,i[5]=e[5]*r,i[6]=e[6]*r,i[8]=e[8]*o,i[9]=e[9]*o,i[10]=e[10]*o,this}}(),setRotationFromEuler:function(e,t){return console.warn("DEPRECATED: Matrix4's .setRotationFromEuler() has been deprecated in favor of makeRotationFromEuler.  Please update your code."),this.makeRotationFromEuler(e,t)},makeRotationFromEuler:function(e,t){var i=this.elements,n=e.x,r=e.y,o=e.z,a=Math.cos(n),n=Math.sin(n),s=Math.cos(r),r=Math.sin(r),l=Math.cos(o),o=Math.sin(o);if(void 0===t||"XYZ"===t){var u=a*l,c=a*o,h=n*l,f=n*o;i[0]=s*l,i[4]=-s*o,i[8]=r,i[1]=c+h*r,i[5]=u-f*r,i[9]=-n*s,i[2]=f-u*r,i[6]=h+c*r,i[10]=a*s}else"YXZ"===t?(u=s*l,c=s*o,h=r*l,f=r*o,i[0]=u+f*n,i[4]=h*n-c,i[8]=a*r,i[1]=a*o,i[5]=a*l,i[9]=-n,i[2]=c*n-h,i[6]=f+u*n,i[10]=a*s):"ZXY"===t?(u=s*l,c=s*o,h=r*l,f=r*o,i[0]=u-f*n,i[4]=-a*o,i[8]=h+c*n,i[1]=c+h*n,i[5]=a*l,i[9]=f-u*n,i[2]=-a*r,i[6]=n,i[10]=a*s):"ZYX"===t?(u=a*l,c=a*o,h=n*l,f=n*o,i[0]=s*l,i[4]=h*r-c,i[8]=u*r+f,i[1]=s*o,i[5]=f*r+u,i[9]=c*r-h,i[2]=-r,i[6]=n*s,i[10]=a*s):"YZX"===t?(u=a*s,c=a*r,h=n*s,f=n*r,i[0]=s*l,i[4]=f-u*o,i[8]=h*o+c,i[1]=o,i[5]=a*l,i[9]=-n*l,i[2]=-r*l,i[6]=c*o+h,i[10]=u-f*o):"XZY"===t&&(u=a*s,c=a*r,h=n*s,f=n*r,i[0]=s*l,i[4]=-o,i[8]=r*l,i[1]=u*o+f,i[5]=a*l,i[9]=c*o-h,i[2]=h*o-c,i[6]=n*l,i[10]=f*o+u);return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this},setRotationFromQuaternion:function(e){return console.warn("DEPRECATED: Matrix4's .setRotationFromQuaternion() has been deprecated in favor of makeRotationFromQuaternion.  Please update your code."),this.makeRotationFromQuaternion(e)},makeRotationFromQuaternion:function(e){var t=this.elements,i=e.x,n=e.y,r=e.z,o=e.w,a=i+i,s=n+n,l=r+r,e=i*a,u=i*s,i=i*l,c=n*s,n=n*l,r=r*l,a=o*a,s=o*s,o=o*l;return t[0]=1-(c+r),t[4]=u-o,t[8]=i+s,t[1]=u+o,t[5]=1-(e+r),t[9]=n-a,t[2]=i-s,t[6]=n+a,t[10]=1-(e+c),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var t=new e.Vector3,i=new e.Vector3,n=new e.Vector3;return function(e,r,o){var a=this.elements;return n.subVectors(e,r).normalize(),0===n.length()&&(n.z=1),t.crossVectors(o,n).normalize(),0===t.length()&&(n.x+=1e-4,t.crossVectors(o,n).normalize()),i.crossVectors(n,t),a[0]=t.x,a[4]=i.x,a[8]=n.x,a[1]=t.y,a[5]=i.y,a[9]=n.y,a[2]=t.z,a[6]=i.z,a[10]=n.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Matrix4's .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var i=e.elements,n=t.elements,r=this.elements,o=i[0],a=i[4],s=i[8],l=i[12],u=i[1],c=i[5],h=i[9],f=i[13],p=i[2],d=i[6],m=i[10],g=i[14],v=i[3],y=i[7],b=i[11],i=i[15],x=n[0],w=n[4],_=n[8],S=n[12],M=n[1],C=n[5],A=n[9],T=n[13],E=n[2],k=n[6],P=n[10],R=n[14],L=n[3],D=n[7],N=n[11],n=n[15];return r[0]=o*x+a*M+s*E+l*L,r[4]=o*w+a*C+s*k+l*D,r[8]=o*_+a*A+s*P+l*N,r[12]=o*S+a*T+s*R+l*n,r[1]=u*x+c*M+h*E+f*L,r[5]=u*w+c*C+h*k+f*D,r[9]=u*_+c*A+h*P+f*N,r[13]=u*S+c*T+h*R+f*n,r[2]=p*x+d*M+m*E+g*L,r[6]=p*w+d*C+m*k+g*D,r[10]=p*_+d*A+m*P+g*N,r[14]=p*S+d*T+m*R+g*n,r[3]=v*x+y*M+b*E+i*L,r[7]=v*w+y*C+b*k+i*D,r[11]=v*_+y*A+b*P+i*N,r[15]=v*S+y*T+b*R+i*n,this},multiplyToArray:function(e,t,i){var n=this.elements;return this.multiplyMatrices(e,t),i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},multiplyVector3:function(e){return console.warn("DEPRECATED: Matrix4's .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)},multiplyVector4:function(e){return console.warn("DEPRECATED: Matrix4's .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){var t=new e.Vector3;return function(e){for(var i=0,n=e.length;n>i;i+=3)t.x=e[i],t.y=e[i+1],t.z=e[i+2],t.applyProjection(this),e[i]=t.x,e[i+1]=t.y,e[i+2]=t.z;return e}}(),rotateAxis:function(e){console.warn("DEPRECATED: Matrix4's .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("DEPRECATED: Matrix4's .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},determinant:function(){var e=this.elements,t=e[0],i=e[4],n=e[8],r=e[12],o=e[1],a=e[5],s=e[9],l=e[13],u=e[2],c=e[6],h=e[10],f=e[14];return e[3]*(+r*s*c-n*l*c-r*a*h+i*l*h+n*a*f-i*s*f)+e[7]*(+t*s*f-t*l*h+r*o*h-n*o*f+n*l*u-r*s*u)+e[11]*(+t*l*c-t*a*f-r*o*c+i*o*f+r*a*u-i*l*u)+e[15]*(-n*a*u-t*s*c+t*a*h+n*o*c-i*o*h+i*s*u)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},flattenToArrayOffset:function(e,t){var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e},getPosition:function(){var t=new e.Vector3;return function(){console.warn("DEPRECATED: Matrix4's .getPosition() has been removed. Use Vector3.getPositionFromMatrix( matrix ) instead.");var e=this.elements;return t.set(e[12],e[13],e[14])}}(),setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var i=this.elements,n=e.elements,r=n[0],o=n[4],a=n[8],s=n[12],l=n[1],u=n[5],c=n[9],h=n[13],f=n[2],p=n[6],d=n[10],m=n[14],g=n[3],v=n[7],y=n[11],b=n[15];if(i[0]=c*m*v-h*d*v+h*p*y-u*m*y-c*p*b+u*d*b,i[4]=s*d*v-a*m*v-s*p*y+o*m*y+a*p*b-o*d*b,i[8]=a*h*v-s*c*v+s*u*y-o*h*y-a*u*b+o*c*b,i[12]=s*c*p-a*h*p-s*u*d+o*h*d+a*u*m-o*c*m,i[1]=h*d*g-c*m*g-h*f*y+l*m*y+c*f*b-l*d*b,i[5]=a*m*g-s*d*g+s*f*y-r*m*y-a*f*b+r*d*b,i[9]=s*c*g-a*h*g-s*l*y+r*h*y+a*l*b-r*c*b,i[13]=a*h*f-s*c*f+s*l*d-r*h*d-a*l*m+r*c*m,i[2]=u*m*g-h*p*g+h*f*v-l*m*v-u*f*b+l*p*b,i[6]=s*p*g-o*m*g-s*f*v+r*m*v+o*f*b-r*p*b,i[10]=o*h*g-s*u*g+s*l*v-r*h*v-o*l*b+r*u*b,i[14]=s*u*f-o*h*f-s*l*p+r*h*p+o*l*m-r*u*m,i[3]=c*p*g-u*d*g-c*f*v+l*d*v+u*f*y-l*p*y,i[7]=o*d*g-a*p*g+a*f*v-r*d*v-o*f*y+r*p*y,i[11]=a*u*g-o*c*g-a*l*v+r*c*v+o*l*y-r*u*y,i[15]=o*c*f-a*u*f+a*l*p-r*c*p-o*l*d+r*u*d,i=n[0]*i[0]+n[1]*i[4]+n[2]*i[8]+n[3]*i[12],0==i){if(t)throw Error("Matrix4.getInverse(): can't invert matrix, determinant is 0");return console.warn("Matrix4.getInverse(): can't invert matrix, determinant is 0"),this.identity(),this}return this.multiplyScalar(1/i),this},translate:function(){console.warn("DEPRECATED: Matrix4's .translate() has been removed.")},rotateX:function(){console.warn("DEPRECATED: Matrix4's .rotateX() has been removed.")},rotateY:function(){console.warn("DEPRECATED: Matrix4's .rotateY() has been removed.")},rotateZ:function(){console.warn("DEPRECATED: Matrix4's .rotateZ() has been removed.")},rotateByAxis:function(){console.warn("DEPRECATED: Matrix4's .rotateByAxis() has been removed.")},scale:function(e){var t=this.elements,i=e.x,n=e.y,e=e.z;return t[0]*=i,t[4]*=n,t[8]*=e,t[1]*=i,t[5]*=n,t[9]*=e,t[2]*=i,t[6]*=n,t[10]*=e,t[3]*=i,t[7]*=n,t[11]*=e,this},getMaxScaleOnAxis:function(){var e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],Math.max(e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10])))},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t),n=Math.sin(t),r=1-i,o=e.x,a=e.y,s=e.z,l=r*o,u=r*a;return this.set(l*o+i,l*a-n*s,l*s+n*a,0,l*a+n*s,u*a+i,u*s-n*o,0,l*s-n*a,u*s+n*o,r*s*s+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},compose:function(e,t,i){return console.warn("DEPRECATED: Matrix4's .compose() has been deprecated in favor of makeFromPositionQuaternionScale. Please update your code."),this.makeFromPositionQuaternionScale(e,t,i)},makeFromPositionQuaternionScale:function(e,t,i){return this.makeRotationFromQuaternion(t),this.scale(i),this.setPosition(e),this},makeFromPositionEulerScale:function(e,t,i,n){return this.makeRotationFromEuler(t,i),this.scale(n),this.setPosition(e),this},makeFrustum:function(e,t,i,n,r,o){var a=this.elements;return a[0]=2*r/(t-e),a[4]=0,a[8]=(t+e)/(t-e),a[12]=0,a[1]=0,a[5]=2*r/(n-i),a[9]=(n+i)/(n-i),a[13]=0,a[2]=0,a[6]=0,a[10]=-(o+r)/(o-r),a[14]=-2*o*r/(o-r),a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makePerspective:function(t,i,n,r){var t=n*Math.tan(e.Math.degToRad(.5*t)),o=-t;return this.makeFrustum(o*i,t*i,o,t,n,r)},makeOrthographic:function(e,t,i,n,r,o){var a=this.elements,s=t-e,l=i-n,u=o-r;return a[0]=2/s,a[4]=0,a[8]=0,a[12]=-((t+e)/s),a[1]=0,a[5]=2/l,a[9]=0,a[13]=-((i+n)/l),a[2]=0,a[6]=0,a[10]=-2/u,a[14]=-((o+r)/u),a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},clone:function(){var t=this.elements;return new e.Matrix4(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15])}},e.extend(e.Matrix4.prototype,{decompose:function(){var t=new e.Vector3,i=new e.Vector3,n=new e.Vector3,r=new e.Matrix4;return function(o,a,s){var l=this.elements;return t.set(l[0],l[1],l[2]),i.set(l[4],l[5],l[6]),n.set(l[8],l[9],l[10]),o=o instanceof e.Vector3?o:new e.Vector3,a=a instanceof e.Quaternion?a:new e.Quaternion,s=s instanceof e.Vector3?s:new e.Vector3,s.x=t.length(),s.y=i.length(),s.z=n.length(),o.x=l[12],o.y=l[13],o.z=l[14],r.copy(this),r.elements[0]/=s.x,r.elements[1]/=s.x,r.elements[2]/=s.x,r.elements[4]/=s.y,r.elements[5]/=s.y,r.elements[6]/=s.y,r.elements[8]/=s.z,r.elements[9]/=s.z,r.elements[10]/=s.z,a.setFromRotationMatrix(r),[o,a,s]}}()}),e.Ray=function(t,i){this.origin=void 0!==t?t:new e.Vector3,this.direction=void 0!==i?i:new e.Vector3},e.Ray.prototype={constructor:e.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(t,i){return(i||new e.Vector3).copy(this.direction).multiplyScalar(t).add(this.origin)},recast:function(){var t=new e.Vector3;return function(e){return this.origin.copy(this.at(e,t)),this}}(),closestPointToPoint:function(t,i){var n=i||new e.Vector3;n.subVectors(t,this.origin);var r=n.dot(this.direction);return n.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(){var t=new e.Vector3;return function(e){var i=t.subVectors(e,this.origin).dot(this.direction);return t.copy(this.direction).multiplyScalar(i).add(this.origin),t.distanceTo(e)}}(),isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},isIntersectionPlane:function(e){return 0!=e.normal.dot(this.direction)||0==e.distanceToPoint(this.origin)?!0:!1},distanceToPlane:function(e){var t=e.normal.dot(this.direction);return 0!=t?-(this.origin.dot(e.normal)+e.constant)/t:0==e.distanceToPoint(this.origin)?0:void 0},intersectPlane:function(e,t){var i=this.distanceToPlane(e);return void 0===i?void 0:this.at(i,t)},applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new e.Ray).copy(this)}},e.Sphere=function(t,i){this.center=void 0!==t?t:new e.Vector3,this.radius=void 0!==i?i:0},e.Sphere.prototype={constructor:e.Sphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromCenterAndPoints:function(e,t){for(var i=0,n=0,r=t.length;r>n;n++)var o=e.distanceToSquared(t[n]),i=Math.max(i,o);return this.center=e,this.radius=Math.sqrt(i),this},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return 0>=this.radius},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(t,i){var n=this.center.distanceToSquared(t),r=i||new e.Vector3;return r.copy(t),n>this.radius*this.radius&&(r.sub(this.center).normalize(),r.multiplyScalar(this.radius).add(this.center)),r},getBoundingBox:function(t){return t=t||new e.Box3,t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius*=e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new e.Sphere).copy(this)}},e.Frustum=function(t,i,n,r,o,a){this.planes=[void 0!==t?t:new e.Plane,void 0!==i?i:new e.Plane,void 0!==n?n:new e.Plane,void 0!==r?r:new e.Plane,void 0!==o?o:new e.Plane,void 0!==a?a:new e.Plane]},e.Frustum.prototype={constructor:e.Frustum,set:function(e,t,i,n,r,o){var a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(n),a[4].copy(r),a[5].copy(o),this},copy:function(e){for(var t=this.planes,i=0;6>i;i++)t[i].copy(e.planes[i]);return this},setFromMatrix:function(e){var t=this.planes,i=e.elements,e=i[0],n=i[1],r=i[2],o=i[3],a=i[4],s=i[5],l=i[6],u=i[7],c=i[8],h=i[9],f=i[10],p=i[11],d=i[12],m=i[13],g=i[14],i=i[15];return t[0].setComponents(o-e,u-a,p-c,i-d).normalize(),t[1].setComponents(o+e,u+a,p+c,i+d).normalize(),t[2].setComponents(o+n,u+s,p+h,i+m).normalize(),t[3].setComponents(o-n,u-s,p-h,i-m).normalize(),t[4].setComponents(o-r,u-l,p-f,i-g).normalize(),t[5].setComponents(o+r,u+l,p+f,i+g).normalize(),this},intersectsObject:function(){var t=new e.Vector3;return function(e){var i=e.matrixWorld,n=this.planes,e=-e.geometry.boundingSphere.radius*i.getMaxScaleOnAxis();for(t.getPositionFromMatrix(i),i=0;6>i;i++)if(n[i].distanceToPoint(t)<e)return!1;return!0}}(),intersectsSphere:function(e){for(var t=this.planes,i=e.center,e=-e.radius,n=0;6>n;n++)if(t[n].distanceToPoint(i)<e)return!1;return!0},containsPoint:function(e){for(var t=this.planes,i=0;6>i;i++)if(0>t[i].distanceToPoint(e))return!1;return!0},clone:function(){return(new e.Frustum).copy(this)}},e.Plane=function(t,i){this.normal=void 0!==t?t:new e.Vector3(1,0,0),this.constant=void 0!==i?i:0},e.Plane.prototype={constructor:e.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,i,n){return this.normal.set(e,t,i),this.constant=n,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var t=new e.Vector3,i=new e.Vector3;return function(e,n,r){return n=t.subVectors(r,n).cross(i.subVectors(e,n)).normalize(),this.setFromNormalAndCoplanarPoint(n,e),this}}(),copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(t,i){var n=this.distanceToPoint(t);return(i||new e.Vector3).copy(this.normal).multiplyScalar(n)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start),e=this.distanceToPoint(e.end);return 0>t&&e>0||0>e&&t>0},intersectLine:function(){var t=new e.Vector3;return function(i,n){var r=n||new e.Vector3,o=i.delta(t),a=this.normal.dot(o);return 0!=a?(a=-(i.start.dot(this.normal)+this.constant)/a,0>a||a>1?void 0:r.copy(o).multiplyScalar(a).add(i.start)):0==this.distanceToPoint(i.start)?r.copy(i.start):void 0
}}(),coplanarPoint:function(t){return(t||new e.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var t=new e.Vector3,i=new e.Vector3;return function(n,r){var r=r||(new e.Matrix3).getNormalMatrix(n),o=t.copy(this.normal).applyMatrix3(r),a=this.coplanarPoint(i);return a.applyMatrix4(n),this.setFromNormalAndCoplanarPoint(o,a),this}}(),translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new e.Plane).copy(this)}},e.Math={clamp:function(e,t,i){return t>e?t:e>i?i:e},clampBottom:function(e,t){return t>e?t:e},mapLinear:function(e,t,i,n,r){return n+(e-t)*(r-n)/(i-t)},smoothstep:function(e,t,i){return t>=e?0:e>=i?1:(e=(e-t)/(i-t),e*e*(3-2*e))},smootherstep:function(e,t,i){return t>=e?0:e>=i?1:(e=(e-t)/(i-t),e*e*e*(e*(6*e-15)+10))},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},sign:function(e){return 0>e?-1:e>0?1:0},degToRad:function(){var e=Math.PI/180;return function(t){return t*e}}(),radToDeg:function(){var e=180/Math.PI;return function(t){return t*e}}()},e.Spline=function(t){function i(e,t,i,n,r,o,a){return e=.5*(i-e),n=.5*(n-t),(2*(t-i)+e+n)*a+(-3*(t-i)-2*e-n)*o+e*r+t}this.points=t;var n,r,o,a,s,l,u,c,h,f=[],p={x:0,y:0,z:0};this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return n=(this.points.length-1)*e,r=Math.floor(n),o=n-r,f[0]=0===r?r:r-1,f[1]=r,f[2]=r>this.points.length-2?this.points.length-1:r+1,f[3]=r>this.points.length-3?this.points.length-1:r+2,l=this.points[f[0]],u=this.points[f[1]],c=this.points[f[2]],h=this.points[f[3]],a=o*o,s=o*a,p.x=i(l.x,u.x,c.x,h.x,o,a,s),p.y=i(l.y,u.y,c.y,h.y,o,a,s),p.z=i(l.z,u.z,c.z,h.z,o,a,s),p},this.getControlPointsArray=function(){var e,t,i=this.points.length,n=[];for(e=0;i>e;e++)t=this.points[e],n[e]=[t.x,t.y,t.z];return n},this.getLength=function(t){var i,n,r,o=i=i=0,a=new e.Vector3,s=new e.Vector3,l=[],u=0;for(l[0]=0,t||(t=100),n=this.points.length*t,a.copy(this.points[0]),t=1;n>t;t++)i=t/n,r=this.getPoint(i),s.copy(r),u+=s.distanceTo(a),a.copy(r),i*=this.points.length-1,i=Math.floor(i),i!=o&&(l[i]=u,o=i);return l[l.length]=u,{chunks:l,total:u}},this.reparametrizeByArcLength=function(t){var i,n,r,o,a,s,l=[],u=new e.Vector3,c=this.getLength();for(l.push(u.copy(this.points[0]).clone()),i=1;i<this.points.length;i++){for(n=c.chunks[i]-c.chunks[i-1],s=Math.ceil(t*n/c.total),o=(i-1)/(this.points.length-1),a=i/(this.points.length-1),n=1;s-1>n;n++)r=o+n*(1/s)*(a-o),r=this.getPoint(r),l.push(u.copy(r).clone());l.push(u.copy(this.points[i]).clone())}this.points=l}},e.Triangle=function(t,i,n){this.a=void 0!==t?t:new e.Vector3,this.b=void 0!==i?i:new e.Vector3,this.c=void 0!==n?n:new e.Vector3},e.Triangle.normal=function(){var t=new e.Vector3;return function(i,n,r,o){return o=o||new e.Vector3,o.subVectors(r,n),t.subVectors(i,n),o.cross(t),i=o.lengthSq(),i>0?o.multiplyScalar(1/Math.sqrt(i)):o.set(0,0,0)}}(),e.Triangle.barycoordFromPoint=function(){var t=new e.Vector3,i=new e.Vector3,n=new e.Vector3;return function(r,o,a,s,l){t.subVectors(s,o),i.subVectors(a,o),n.subVectors(r,o);var r=t.dot(t),o=t.dot(i),a=t.dot(n),u=i.dot(i),s=i.dot(n),c=r*u-o*o,l=l||new e.Vector3;return 0==c?l.set(-2,-1,-1):(c=1/c,u=(u*a-o*s)*c,r=(r*s-o*a)*c,l.set(1-u-r,r,u))}}(),e.Triangle.containsPoint=function(){var t=new e.Vector3;return function(i,n,r,o){return i=e.Triangle.barycoordFromPoint(i,n,r,o,t),0<=i.x&&0<=i.y&&1>=i.x+i.y}}(),e.Triangle.prototype={constructor:e.Triangle,set:function(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this},setFromPointsAndIndices:function(e,t,i,n){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[n]),this},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var t=new e.Vector3,i=new e.Vector3;return function(){return t.subVectors(this.c,this.b),i.subVectors(this.a,this.b),.5*t.cross(i).length()}}(),midpoint:function(t){return(t||new e.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(t){return e.Triangle.normal(this.a,this.b,this.c,t)},plane:function(t){return(t||new e.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(t,i){return e.Triangle.barycoordFromPoint(t,this.a,this.b,this.c,i)},containsPoint:function(t){return e.Triangle.containsPoint(t,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return(new e.Triangle).copy(this)}},e.Vertex=function(e){return console.warn("THREE.Vertex has been DEPRECATED. Use THREE.Vector3 instead."),e},e.UV=function(t,i){return console.warn("THREE.UV has been DEPRECATED. Use THREE.Vector2 instead."),new e.Vector2(t,i)},e.Clock=function(e){this.autoStart=void 0!==e?e:!0,this.elapsedTime=this.oldTime=this.startTime=0,this.running=!1},e.Clock.prototype={constructor:e.Clock,start:function(){this.oldTime=this.startTime=void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now(),this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running&&this.start(),this.running){var t=void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now(),e=.001*(t-this.oldTime);this.oldTime=t,this.elapsedTime+=e}return e}},e.EventDispatcher=function(){},e.EventDispatcher.prototype={constructor:e.EventDispatcher,addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)?!0:!1},removeEventListener:function(e,t){if(void 0!==this._listeners){var i=this._listeners,n=i[e].indexOf(t);-1!==n&&i[e].splice(n,1)}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var i=0,n=t.length;n>i;i++)t[i].call(this,e)}}}},function(e){e.Raycaster=function(t,i,n,r){this.ray=new e.Ray(t,i),0<this.ray.direction.lengthSq()&&this.ray.direction.normalize(),this.near=n||0,this.far=r||1/0};var t=new e.Sphere,i=new e.Ray,n=new e.Plane,r=new e.Vector3,o=new e.Vector3,a=new e.Matrix4,s=function(e,t){return e.distance-t.distance},l=function(s,u,c){if(s instanceof e.Particle){o.getPositionFromMatrix(s.matrixWorld);var h=u.ray.distanceToPoint(o);if(h>s.scale.x)return c;c.push({distance:h,point:s.position,face:null,object:s})}else if(s instanceof e.LOD)o.getPositionFromMatrix(s.matrixWorld),h=u.ray.origin.distanceTo(o),l(s.getObjectForDistance(h),u,c);else if(s instanceof e.Mesh){if(o.getPositionFromMatrix(s.matrixWorld),t.set(o,s.geometry.boundingSphere.radius*s.matrixWorld.getMaxScaleOnAxis()),!u.ray.isIntersectionSphere(t))return c;var f,p,d,h=s.geometry,m=h.vertices,g=s.material instanceof e.MeshFaceMaterial,v=!0===g?s.material.materials:null,y=s.material.side,b=u.precision;a.getInverse(s.matrixWorld),i.copy(u.ray).applyMatrix4(a);for(var x=0,w=h.faces.length;w>x;x++){var _=h.faces[x],y=!0===g?v[_.materialIndex]:s.material;if(void 0!==y){n.setFromNormalAndCoplanarPoint(_.normal,m[_.a]);var S=i.distanceToPlane(n);if(!(Math.abs(S)<b||0>S)){if(y=y.side,y!==e.DoubleSide&&(f=i.direction.dot(n.normal),!(y===e.FrontSide?0>f:f>0)))continue;if(!(S<u.near||S>u.far)){if(r=i.at(S,r),_ instanceof e.Face3){if(y=m[_.a],f=m[_.b],p=m[_.c],!e.Triangle.containsPoint(r,y,f,p))continue}else{if(!(_ instanceof e.Face4))throw Error("face type not supported");if(y=m[_.a],f=m[_.b],p=m[_.c],d=m[_.d],!e.Triangle.containsPoint(r,y,f,d)&&!e.Triangle.containsPoint(r,f,p,d))continue}c.push({distance:S,point:u.ray.at(S),face:_,faceIndex:x,object:s})}}}}}},u=function(e,t,i){for(var e=e.getDescendants(),n=0,r=e.length;r>n;n++)l(e[n],t,i)};e.Raycaster.prototype.precision=1e-4,e.Raycaster.prototype.set=function(e,t){this.ray.set(e,t),0<this.ray.direction.length()&&this.ray.direction.normalize()},e.Raycaster.prototype.intersectObject=function(e,t){var i=[];return!0===t&&u(e,this,i),l(e,this,i),i.sort(s),i},e.Raycaster.prototype.intersectObjects=function(e,t){for(var i=[],n=0,r=e.length;r>n;n++)l(e[n],this,i),!0===t&&u(e[n],this,i);return i.sort(s),i}}(e),e.Object3D=function(){this.id=e.Object3DIdCount++,this.name="",this.parent=void 0,this.children=[],this.up=new e.Vector3(0,1,0),this.position=new e.Vector3,this.rotation=new e.Vector3,this.eulerOrder=e.Object3D.defaultEulerOrder,this.scale=new e.Vector3(1,1,1),this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new e.Matrix4,this.matrixWorld=new e.Matrix4,this.matrixWorldNeedsUpdate=this.matrixAutoUpdate=!0,this.quaternion=new e.Quaternion,this.useQuaternion=!1,this.visible=!0,this.receiveShadow=this.castShadow=!1,this.frustumCulled=!0,this.userData={}},e.Object3D.prototype={constructor:e.Object3D,applyMatrix:function(){var t=new e.Matrix4;return function(e){this.matrix.multiplyMatrices(e,this.matrix),this.position.getPositionFromMatrix(this.matrix),this.scale.getScaleFromMatrix(this.matrix),t.extractRotation(this.matrix),!0===this.useQuaternion?this.quaternion.setFromRotationMatrix(t):this.rotation.setEulerFromRotationMatrix(t,this.eulerOrder)}}(),rotateOnAxis:function(){var t=new e.Quaternion,i=new e.Quaternion;return function(e,n){return t.setFromAxisAngle(e,n),!0===this.useQuaternion?this.quaternion.multiply(t):(i.setFromEuler(this.rotation,this.eulerOrder),i.multiply(t),this.rotation.setEulerFromQuaternion(i,this.eulerOrder)),this}}(),translateOnAxis:function(){var t=new e.Vector3;return function(e,i){return t.copy(e),!0===this.useQuaternion?t.applyQuaternion(this.quaternion):t.applyEuler(this.rotation,this.eulerOrder),this.position.add(t.multiplyScalar(i)),this}}(),translate:function(e,t){return console.warn("DEPRECATED: Object3D's .translate() has been removed. Use .translateOnAxis( axis, distance ) instead. Note args have been changed."),this.translateOnAxis(t,e)},translateX:function(){var t=new e.Vector3(1,0,0);return function(e){return this.translateOnAxis(t,e)}}(),translateY:function(){var t=new e.Vector3(0,1,0);return function(e){return this.translateOnAxis(t,e)}}(),translateZ:function(){var t=new e.Vector3(0,0,1);return function(e){return this.translateOnAxis(t,e)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var t=new e.Matrix4;return function(e){return e.applyMatrix4(t.getInverse(this.matrixWorld))}}(),lookAt:function(){var t=new e.Matrix4;return function(e){t.lookAt(e,this.position,this.up),!0===this.useQuaternion?this.quaternion.setFromRotationMatrix(t):this.rotation.setEulerFromRotationMatrix(t,this.eulerOrder)}}(),add:function(t){if(t===this)console.warn("THREE.Object3D.add: An object can't be added as a child of itself.");else if(t instanceof e.Object3D){void 0!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t);for(var i=this;void 0!==i.parent;)i=i.parent;void 0!==i&&i instanceof e.Scene&&i.__addObject(t)}},remove:function(t){var i=this.children.indexOf(t);if(-1!==i){for(t.parent=void 0,this.children.splice(i,1),i=this;void 0!==i.parent;)i=i.parent;void 0!==i&&i instanceof e.Scene&&i.__removeObject(t)}},traverse:function(e){e(this);for(var t=0,i=this.children.length;i>t;t++)this.children[t].traverse(e)},getObjectById:function(e,t){for(var i=0,n=this.children.length;n>i;i++){var r=this.children[i];if(r.id===e||!0===t&&(r=r.getObjectById(e,t),void 0!==r))return r}},getObjectByName:function(e,t){for(var i=0,n=this.children.length;n>i;i++){var r=this.children[i];if(r.name===e||!0===t&&(r=r.getObjectByName(e,t),void 0!==r))return r}},getChildByName:function(e,t){return console.warn("DEPRECATED: Object3D's .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e,t)},getDescendants:function(e){void 0===e&&(e=[]),Array.prototype.push.apply(e,this.children);for(var t=0,i=this.children.length;i>t;t++)this.children[t].getDescendants(e);return e},updateMatrix:function(){!1===this.useQuaternion?this.matrix.makeFromPositionEulerScale(this.position,this.rotation,this.eulerOrder,this.scale):this.matrix.makeFromPositionQuaternionScale(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){!0===this.matrixAutoUpdate&&this.updateMatrix(),(!0===this.matrixWorldNeedsUpdate||!0===e)&&(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,i=this.children.length;i>t;t++)this.children[t].updateMatrixWorld(e)},clone:function(t){void 0===t&&(t=new e.Object3D),t.name=this.name,t.up.copy(this.up),t.position.copy(this.position),t.rotation instanceof e.Vector3&&t.rotation.copy(this.rotation),t.eulerOrder=this.eulerOrder,t.scale.copy(this.scale),t.renderDepth=this.renderDepth,t.rotationAutoUpdate=this.rotationAutoUpdate,t.matrix.copy(this.matrix),t.matrixWorld.copy(this.matrixWorld),t.matrixAutoUpdate=this.matrixAutoUpdate,t.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,t.quaternion.copy(this.quaternion),t.useQuaternion=this.useQuaternion,t.visible=this.visible,t.castShadow=this.castShadow,t.receiveShadow=this.receiveShadow,t.frustumCulled=this.frustumCulled,t.userData=JSON.parse(JSON.stringify(this.userData));for(var i=0;i<this.children.length;i++)t.add(this.children[i].clone());return t}},e.Object3D.defaultEulerOrder="XYZ",e.Object3DIdCount=0,e.Projector=function(){function t(){if(a===y){var t=new e.RenderableObject;return v.push(t),y++,a++,t}return v[a++]}function i(){if(l===x){var t=new e.RenderableVertex;return b.push(t),x++,l++,t}return b[l++]}function n(e,t){return t.z-e.z}function r(e,t){var i=0,n=1,r=e.z+e.w,o=t.z+t.w,a=-e.z+e.w,s=-t.z+t.w;return r>=0&&o>=0&&a>=0&&s>=0?!0:0>r&&0>o||0>a&&0>s?!1:(0>r?i=Math.max(i,r/(r-o)):0>o&&(n=Math.min(n,r/(r-o))),0>a?i=Math.max(i,a/(a-s)):0>s&&(n=Math.min(n,a/(a-s))),i>n?!1:(e.lerp(t,i),t.lerp(e,1-n),!0))}var o,a,s,l,u,c,h,f,p,d,m,g,v=[],y=0,b=[],x=0,w=[],_=0,S=[],M=0,C=[],A=0,T=[],E=0,k={objects:[],sprites:[],lights:[],elements:[]},P=new e.Vector3,R=new e.Vector4,L=new e.Box3(new e.Vector3(-1,-1,-1),new e.Vector3(1,1,1)),D=new e.Box3,N=Array(3),F=Array(4),G=new e.Matrix4,O=new e.Matrix4,j=new e.Matrix4,I=new e.Matrix3,V=new e.Matrix3,U=new e.Vector3,B=new e.Frustum,z=new e.Vector4,q=new e.Vector4;this.projectVector=function(e,t){return t.matrixWorldInverse.getInverse(t.matrixWorld),O.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),e.applyProjection(O)},this.unprojectVector=function(e,t){return t.projectionMatrixInverse.getInverse(t.projectionMatrix),O.multiplyMatrices(t.matrixWorld,t.projectionMatrixInverse),e.applyProjection(O)},this.pickingRay=function(t,i){t.z=-1;var n=new e.Vector3(t.x,t.y,1);return this.unprojectVector(t,i),this.unprojectVector(n,i),n.sub(t).normalize(),new e.Raycaster(t,n)},this.projectScene=function(v,y,x,H){var W,X,Y,K,$,Q,Z,J,et,tt,it,nt,rt,ot=!1;m=p=h=c=0,k.elements.length=0,!0===v.autoUpdate&&v.updateMatrixWorld(),void 0===y.parent&&y.updateMatrixWorld(),G.copy(y.matrixWorldInverse.getInverse(y.matrixWorld)),O.multiplyMatrices(y.projectionMatrix,G),V.getNormalMatrix(G),B.setFromMatrix(O),a=0,k.objects.length=0,k.sprites.length=0,k.lights.length=0;var at=function(i){for(var n=0,r=i.children.length;r>n;n++){var a=i.children[n];!1!==a.visible&&(a instanceof e.Light?k.lights.push(a):a instanceof e.Mesh||a instanceof e.Line?(!1===a.frustumCulled||!0===B.intersectsObject(a))&&(o=t(),o.object=a,null!==a.renderDepth?o.z=a.renderDepth:(P.getPositionFromMatrix(a.matrixWorld),P.applyProjection(O),o.z=P.z),k.objects.push(o)):a instanceof e.Sprite||a instanceof e.Particle?(o=t(),o.object=a,null!==a.renderDepth?o.z=a.renderDepth:(P.getPositionFromMatrix(a.matrixWorld),P.applyProjection(O),o.z=P.z),k.sprites.push(o)):(o=t(),o.object=a,null!==a.renderDepth?o.z=a.renderDepth:(P.getPositionFromMatrix(a.matrixWorld),P.applyProjection(O),o.z=P.z),k.objects.push(o)),at(a))}};for(at(v),!0===x&&k.objects.sort(n),v=0,x=k.objects.length;x>v;v++)if(J=k.objects[v].object,g=J.matrixWorld,l=0,J instanceof e.Mesh){for(et=J.geometry,Y=et.vertices,tt=et.faces,et=et.faceVertexUvs,I.getNormalMatrix(g),nt=J.material instanceof e.MeshFaceMaterial,rt=!0===nt?J.material:null,W=0,X=Y.length;X>W;W++)s=i(),s.positionWorld.copy(Y[W]).applyMatrix4(g),s.positionScreen.copy(s.positionWorld).applyMatrix4(O),s.positionScreen.x/=s.positionScreen.w,s.positionScreen.y/=s.positionScreen.w,s.positionScreen.z/=s.positionScreen.w,s.visible=!(-1>s.positionScreen.x||1<s.positionScreen.x||-1>s.positionScreen.y||1<s.positionScreen.y||-1>s.positionScreen.z||1<s.positionScreen.z);for(Y=0,W=tt.length;W>Y;Y++){X=tt[Y];var st=!0===nt?rt.materials[X.materialIndex]:J.material;if(void 0!==st){if(Q=st.side,X instanceof e.Face3){if(K=b[X.a],$=b[X.b],Z=b[X.c],N[0]=K.positionScreen,N[1]=$.positionScreen,N[2]=Z.positionScreen,!0!==K.visible&&!0!==$.visible&&!0!==Z.visible&&!L.isIntersectionBox(D.setFromPoints(N)))continue;if(ot=0>(Z.positionScreen.x-K.positionScreen.x)*($.positionScreen.y-K.positionScreen.y)-(Z.positionScreen.y-K.positionScreen.y)*($.positionScreen.x-K.positionScreen.x),Q!==e.DoubleSide&&ot!==(Q===e.FrontSide))continue;c===_?(it=new e.RenderableFace3,w.push(it),_++,c++,u=it):u=w[c++],u.v1.copy(K),u.v2.copy($),u.v3.copy(Z)}else if(X instanceof e.Face4){if(K=b[X.a],$=b[X.b],Z=b[X.c],it=b[X.d],F[0]=K.positionScreen,F[1]=$.positionScreen,F[2]=Z.positionScreen,F[3]=it.positionScreen,!0!==K.visible&&!0!==$.visible&&!0!==Z.visible&&!0!==it.visible&&!L.isIntersectionBox(D.setFromPoints(F)))continue;if(ot=0>(it.positionScreen.x-K.positionScreen.x)*($.positionScreen.y-K.positionScreen.y)-(it.positionScreen.y-K.positionScreen.y)*($.positionScreen.x-K.positionScreen.x)||0>($.positionScreen.x-Z.positionScreen.x)*(it.positionScreen.y-Z.positionScreen.y)-($.positionScreen.y-Z.positionScreen.y)*(it.positionScreen.x-Z.positionScreen.x),Q!==e.DoubleSide&&ot!==(Q===e.FrontSide))continue;if(h===M){var lt=new e.RenderableFace4;S.push(lt),M++,h++,u=lt}else u=S[h++];u.v1.copy(K),u.v2.copy($),u.v3.copy(Z),u.v4.copy(it)}for(u.normalModel.copy(X.normal),!1===ot&&(Q===e.BackSide||Q===e.DoubleSide)&&u.normalModel.negate(),u.normalModel.applyMatrix3(I).normalize(),u.normalModelView.copy(u.normalModel).applyMatrix3(V),u.centroidModel.copy(X.centroid).applyMatrix4(g),Z=X.vertexNormals,K=0,$=Z.length;$>K;K++)it=u.vertexNormalsModel[K],it.copy(Z[K]),!1===ot&&(Q===e.BackSide||Q===e.DoubleSide)&&it.negate(),it.applyMatrix3(I).normalize(),u.vertexNormalsModelView[K].copy(it).applyMatrix3(V);for(u.vertexNormalsLength=Z.length,K=0,$=et.length;$>K;K++)if(it=et[K][Y],void 0!==it)for(Q=0,Z=it.length;Z>Q;Q++)u.uvs[K][Q]=it[Q];u.color=X.color,u.material=st,U.copy(u.centroidModel).applyProjection(O),u.z=U.z,k.elements.push(u)}}}else if(J instanceof e.Line)for(j.multiplyMatrices(O,g),Y=J.geometry.vertices,K=i(),K.positionScreen.copy(Y[0]).applyMatrix4(j),tt=J.type===e.LinePieces?2:1,W=1,X=Y.length;X>W;W++)K=i(),K.positionScreen.copy(Y[W]).applyMatrix4(j),(W+1)%tt>0||($=b[l-2],z.copy(K.positionScreen),q.copy($.positionScreen),!0===r(z,q)&&(z.multiplyScalar(1/z.w),q.multiplyScalar(1/q.w),p===A?(et=new e.RenderableLine,C.push(et),A++,p++,f=et):f=C[p++],f.v1.positionScreen.copy(z),f.v2.positionScreen.copy(q),f.z=Math.max(z.z,q.z),f.material=J.material,J.material.vertexColors===e.VertexColors&&(f.vertexColors[0].copy(J.geometry.colors[W]),f.vertexColors[1].copy(J.geometry.colors[W-1])),k.elements.push(f)));for(v=0,x=k.sprites.length;x>v;v++)J=k.sprites[v].object,g=J.matrixWorld,J instanceof e.Particle&&(R.set(g.elements[12],g.elements[13],g.elements[14],1),R.applyMatrix4(O),R.z/=R.w,0<R.z&&1>R.z&&(m===E?(ot=new e.RenderableParticle,T.push(ot),E++,m++,d=ot):d=T[m++],d.object=J,d.x=R.x/R.w,d.y=R.y/R.w,d.z=R.z,d.rotation=J.rotation.z,d.scale.x=J.scale.x*Math.abs(d.x-(R.x+y.projectionMatrix.elements[0])/(R.w+y.projectionMatrix.elements[12])),d.scale.y=J.scale.y*Math.abs(d.y-(R.y+y.projectionMatrix.elements[5])/(R.w+y.projectionMatrix.elements[13])),d.material=J.material,k.elements.push(d)));return!0===H&&k.elements.sort(n),k}},e.Face3=function(t,i,n,r,o,a){this.a=t,this.b=i,this.c=n,this.normal=r instanceof e.Vector3?r:new e.Vector3,this.vertexNormals=r instanceof Array?r:[],this.color=o instanceof e.Color?o:new e.Color,this.vertexColors=o instanceof Array?o:[],this.vertexTangents=[],this.materialIndex=void 0!==a?a:0,this.centroid=new e.Vector3},e.Face3.prototype={constructor:e.Face3,clone:function(){var t=new e.Face3(this.a,this.b,this.c);t.normal.copy(this.normal),t.color.copy(this.color),t.centroid.copy(this.centroid),t.materialIndex=this.materialIndex;var i,n;for(i=0,n=this.vertexNormals.length;n>i;i++)t.vertexNormals[i]=this.vertexNormals[i].clone();for(i=0,n=this.vertexColors.length;n>i;i++)t.vertexColors[i]=this.vertexColors[i].clone();for(i=0,n=this.vertexTangents.length;n>i;i++)t.vertexTangents[i]=this.vertexTangents[i].clone();return t}},e.Face4=function(t,i,n,r,o,a,s){this.a=t,this.b=i,this.c=n,this.d=r,this.normal=o instanceof e.Vector3?o:new e.Vector3,this.vertexNormals=o instanceof Array?o:[],this.color=a instanceof e.Color?a:new e.Color,this.vertexColors=a instanceof Array?a:[],this.vertexTangents=[],this.materialIndex=void 0!==s?s:0,this.centroid=new e.Vector3},e.Face4.prototype={constructor:e.Face4,clone:function(){var t=new e.Face4(this.a,this.b,this.c,this.d);t.normal.copy(this.normal),t.color.copy(this.color),t.centroid.copy(this.centroid),t.materialIndex=this.materialIndex;var i,n;for(i=0,n=this.vertexNormals.length;n>i;i++)t.vertexNormals[i]=this.vertexNormals[i].clone();for(i=0,n=this.vertexColors.length;n>i;i++)t.vertexColors[i]=this.vertexColors[i].clone();for(i=0,n=this.vertexTangents.length;n>i;i++)t.vertexTangents[i]=this.vertexTangents[i].clone();return t}},e.Geometry=function(){this.id=e.GeometryIdCount++,this.name="",this.vertices=[],this.colors=[],this.normals=[],this.faces=[],this.faceUvs=[[]],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingSphere=this.boundingBox=null,this.hasTangents=!1,this.dynamic=!0,this.buffersNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.tangentsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.elementsNeedUpdate=this.verticesNeedUpdate=!1},e.Geometry.prototype={constructor:e.Geometry,addEventListener:e.EventDispatcher.prototype.addEventListener,hasEventListener:e.EventDispatcher.prototype.hasEventListener,removeEventListener:e.EventDispatcher.prototype.removeEventListener,dispatchEvent:e.EventDispatcher.prototype.dispatchEvent,applyMatrix:function(t){for(var i=(new e.Matrix3).getNormalMatrix(t),n=0,r=this.vertices.length;r>n;n++)this.vertices[n].applyMatrix4(t);for(n=0,r=this.faces.length;r>n;n++){var o=this.faces[n];o.normal.applyMatrix3(i).normalize();for(var a=0,s=o.vertexNormals.length;s>a;a++)o.vertexNormals[a].applyMatrix3(i).normalize();o.centroid.applyMatrix4(t)}},computeCentroids:function(){var t,i,n;for(t=0,i=this.faces.length;i>t;t++)n=this.faces[t],n.centroid.set(0,0,0),n instanceof e.Face3?(n.centroid.add(this.vertices[n.a]),n.centroid.add(this.vertices[n.b]),n.centroid.add(this.vertices[n.c]),n.centroid.divideScalar(3)):n instanceof e.Face4&&(n.centroid.add(this.vertices[n.a]),n.centroid.add(this.vertices[n.b]),n.centroid.add(this.vertices[n.c]),n.centroid.add(this.vertices[n.d]),n.centroid.divideScalar(4))},computeFaceNormals:function(){for(var t=new e.Vector3,i=new e.Vector3,n=0,r=this.faces.length;r>n;n++){var o=this.faces[n],a=this.vertices[o.a],s=this.vertices[o.b];t.subVectors(this.vertices[o.c],s),i.subVectors(a,s),t.cross(i),t.normalize(),o.normal.copy(t)}},computeVertexNormals:function(t){var i,n,r,o;if(void 0===this.__tmpVertices){for(o=this.__tmpVertices=Array(this.vertices.length),i=0,n=this.vertices.length;n>i;i++)o[i]=new e.Vector3;for(i=0,n=this.faces.length;n>i;i++)r=this.faces[i],r instanceof e.Face3?r.vertexNormals=[new e.Vector3,new e.Vector3,new e.Vector3]:r instanceof e.Face4&&(r.vertexNormals=[new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3])}else for(o=this.__tmpVertices,i=0,n=this.vertices.length;n>i;i++)o[i].set(0,0,0);if(t){var a,s,l,u=new e.Vector3,c=new e.Vector3,h=new e.Vector3,f=new e.Vector3,p=new e.Vector3;for(i=0,n=this.faces.length;n>i;i++)r=this.faces[i],r instanceof e.Face3?(t=this.vertices[r.a],a=this.vertices[r.b],s=this.vertices[r.c],u.subVectors(s,a),c.subVectors(t,a),u.cross(c),o[r.a].add(u),o[r.b].add(u),o[r.c].add(u)):r instanceof e.Face4&&(t=this.vertices[r.a],a=this.vertices[r.b],s=this.vertices[r.c],l=this.vertices[r.d],h.subVectors(l,a),c.subVectors(t,a),h.cross(c),o[r.a].add(h),o[r.b].add(h),o[r.d].add(h),f.subVectors(l,s),p.subVectors(a,s),f.cross(p),o[r.b].add(f),o[r.c].add(f),o[r.d].add(f))}else for(i=0,n=this.faces.length;n>i;i++)r=this.faces[i],r instanceof e.Face3?(o[r.a].add(r.normal),o[r.b].add(r.normal),o[r.c].add(r.normal)):r instanceof e.Face4&&(o[r.a].add(r.normal),o[r.b].add(r.normal),o[r.c].add(r.normal),o[r.d].add(r.normal));for(i=0,n=this.vertices.length;n>i;i++)o[i].normalize();for(i=0,n=this.faces.length;n>i;i++)r=this.faces[i],r instanceof e.Face3?(r.vertexNormals[0].copy(o[r.a]),r.vertexNormals[1].copy(o[r.b]),r.vertexNormals[2].copy(o[r.c])):r instanceof e.Face4&&(r.vertexNormals[0].copy(o[r.a]),r.vertexNormals[1].copy(o[r.b]),r.vertexNormals[2].copy(o[r.c]),r.vertexNormals[3].copy(o[r.d]))},computeMorphNormals:function(){var t,i,n,r,o;for(n=0,r=this.faces.length;r>n;n++)for(o=this.faces[n],o.__originalFaceNormal?o.__originalFaceNormal.copy(o.normal):o.__originalFaceNormal=o.normal.clone(),o.__originalVertexNormals||(o.__originalVertexNormals=[]),t=0,i=o.vertexNormals.length;i>t;t++)o.__originalVertexNormals[t]?o.__originalVertexNormals[t].copy(o.vertexNormals[t]):o.__originalVertexNormals[t]=o.vertexNormals[t].clone();var a=new e.Geometry;for(a.faces=this.faces,t=0,i=this.morphTargets.length;i>t;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];var s,l,u=this.morphNormals[t].faceNormals,c=this.morphNormals[t].vertexNormals;for(n=0,r=this.faces.length;r>n;n++)o=this.faces[n],s=new e.Vector3,l=o instanceof e.Face3?{a:new e.Vector3,b:new e.Vector3,c:new e.Vector3}:{a:new e.Vector3,b:new e.Vector3,c:new e.Vector3,d:new e.Vector3},u.push(s),c.push(l)}for(u=this.morphNormals[t],a.vertices=this.morphTargets[t].vertices,a.computeFaceNormals(),a.computeVertexNormals(),n=0,r=this.faces.length;r>n;n++)o=this.faces[n],s=u.faceNormals[n],l=u.vertexNormals[n],s.copy(o.normal),o instanceof e.Face3?(l.a.copy(o.vertexNormals[0]),l.b.copy(o.vertexNormals[1]),l.c.copy(o.vertexNormals[2])):(l.a.copy(o.vertexNormals[0]),l.b.copy(o.vertexNormals[1]),l.c.copy(o.vertexNormals[2]),l.d.copy(o.vertexNormals[3]))}for(n=0,r=this.faces.length;r>n;n++)o=this.faces[n],o.normal=o.__originalFaceNormal,o.vertexNormals=o.__originalVertexNormals},computeTangents:function(){function t(e,t,i,n,r,o,a){l=e.vertices[t],u=e.vertices[i],c=e.vertices[n],h=s[r],f=s[o],p=s[a],d=u.x-l.x,m=c.x-l.x,g=u.y-l.y,v=c.y-l.y,y=u.z-l.z,b=c.z-l.z,x=f.x-h.x,w=p.x-h.x,_=f.y-h.y,S=p.y-h.y,M=1/(x*S-w*_),E.set((S*d-_*m)*M,(S*g-_*v)*M,(S*y-_*b)*M),k.set((x*m-w*d)*M,(x*v-w*g)*M,(x*b-w*y)*M),A[t].add(E),A[i].add(E),A[n].add(E),T[t].add(k),T[i].add(k),T[n].add(k)}var i,n,r,o,a,s,l,u,c,h,f,p,d,m,g,v,y,b,x,w,_,S,M,C,A=[],T=[],E=new e.Vector3,k=new e.Vector3,P=new e.Vector3,R=new e.Vector3,L=new e.Vector3;for(i=0,n=this.vertices.length;n>i;i++)A[i]=new e.Vector3,T[i]=new e.Vector3;for(i=0,n=this.faces.length;n>i;i++)a=this.faces[i],s=this.faceVertexUvs[0][i],a instanceof e.Face3?t(this,a.a,a.b,a.c,0,1,2):a instanceof e.Face4&&(t(this,a.a,a.b,a.d,0,1,3),t(this,a.b,a.c,a.d,1,2,3));var D=["a","b","c","d"];for(i=0,n=this.faces.length;n>i;i++)for(a=this.faces[i],r=0;r<a.vertexNormals.length;r++)L.copy(a.vertexNormals[r]),o=a[D[r]],C=A[o],P.copy(C),P.sub(L.multiplyScalar(L.dot(C))).normalize(),R.crossVectors(a.vertexNormals[r],C),o=R.dot(T[o]),o=0>o?-1:1,a.vertexTangents[r]=new e.Vector4(P.x,P.y,P.z,o);this.hasTangents=!0},computeLineDistances:function(){for(var e=0,t=this.vertices,i=0,n=t.length;n>i;i++)i>0&&(e+=t[i].distanceTo(t[i-1])),this.lineDistances[i]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new e.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new e.Sphere),this.boundingSphere.setFromCenterAndPoints(this.boundingSphere.center,this.vertices)},mergeVertices:function(){var t,i,n,r,o,a,s={},l=[],u=[],c=Math.pow(10,4);for(this.__tmpVertices=void 0,i=0,n=this.vertices.length;n>i;i++)t=this.vertices[i],t=[Math.round(t.x*c),Math.round(t.y*c),Math.round(t.z*c)].join("_"),void 0===s[t]?(s[t]=i,l.push(this.vertices[i]),u[i]=l.length-1):u[i]=u[s[t]];for(c=[],i=0,n=this.faces.length;n>i;i++)if(s=this.faces[i],s instanceof e.Face3){for(s.a=u[s.a],s.b=u[s.b],s.c=u[s.c],r=[s.a,s.b,s.c],t=-1,o=0;3>o;o++)if(r[o]==r[(o+1)%3]){c.push(i);break}}else if(s instanceof e.Face4){for(s.a=u[s.a],s.b=u[s.b],s.c=u[s.c],s.d=u[s.d],r=[s.a,s.b,s.c,s.d],t=-1,o=0;4>o;o++)r[o]==r[(o+1)%4]&&(t>=0&&c.push(i),t=o);if(t>=0){r.splice(t,1);var h=new e.Face3(r[0],r[1],r[2],s.normal,s.color,s.materialIndex);for(r=0,o=this.faceVertexUvs.length;o>r;r++)(a=this.faceVertexUvs[r][i])&&a.splice(t,1);s.vertexNormals&&0<s.vertexNormals.length&&(h.vertexNormals=s.vertexNormals,h.vertexNormals.splice(t,1)),s.vertexColors&&0<s.vertexColors.length&&(h.vertexColors=s.vertexColors,h.vertexColors.splice(t,1)),this.faces[i]=h}}for(i=c.length-1;i>=0;i--)for(this.faces.splice(i,1),r=0,o=this.faceVertexUvs.length;o>r;r++)this.faceVertexUvs[r].splice(i,1);return u=this.vertices.length-l.length,this.vertices=l,u},clone:function(){for(var t=new e.Geometry,i=this.vertices,n=0,r=i.length;r>n;n++)t.vertices.push(i[n].clone());for(i=this.faces,n=0,r=i.length;r>n;n++)t.faces.push(i[n].clone());for(i=this.faceVertexUvs[0],n=0,r=i.length;r>n;n++){for(var o=i[n],a=[],s=0,l=o.length;l>s;s++)a.push(new e.Vector2(o[s].x,o[s].y));t.faceVertexUvs[0].push(a)}return t},dispose:function(){this.dispatchEvent({type:"dispose"})}},e.GeometryIdCount=0,e.BufferGeometry=function(){this.id=e.GeometryIdCount++,this.attributes={},this.dynamic=!1,this.offsets=[],this.boundingSphere=this.boundingBox=null,this.hasTangents=!1,this.morphTargets=[]},e.BufferGeometry.prototype={constructor:e.BufferGeometry,addEventListener:e.EventDispatcher.prototype.addEventListener,hasEventListener:e.EventDispatcher.prototype.hasEventListener,removeEventListener:e.EventDispatcher.prototype.removeEventListener,dispatchEvent:e.EventDispatcher.prototype.dispatchEvent,applyMatrix:function(t){var i,n;this.attributes.position&&(i=this.attributes.position.array),this.attributes.normal&&(n=this.attributes.normal.array),void 0!==i&&(t.multiplyVector3Array(i),this.verticesNeedUpdate=!0),void 0!==n&&((new e.Matrix3).getNormalMatrix(t).multiplyVector3Array(n),this.normalizeNormals(),this.normalsNeedUpdate=!0)},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new e.Box3);var t=this.attributes.position.array;if(t){var i,n,r,o=this.boundingBox;3<=t.length&&(o.min.x=o.max.x=t[0],o.min.y=o.max.y=t[1],o.min.z=o.max.z=t[2]);for(var a=3,s=t.length;s>a;a+=3)i=t[a],n=t[a+1],r=t[a+2],i<o.min.x?o.min.x=i:i>o.max.x&&(o.max.x=i),n<o.min.y?o.min.y=n:n>o.max.y&&(o.max.y=n),r<o.min.z?o.min.z=r:r>o.max.z&&(o.max.z=r)}(void 0===t||0===t.length)&&(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0))
},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new e.Sphere);var t=this.attributes.position.array;if(t){for(var i,n,r,o=0,a=0,s=t.length;s>a;a+=3)i=t[a],n=t[a+1],r=t[a+2],i=i*i+n*n+r*r,i>o&&(o=i);this.boundingSphere.radius=Math.sqrt(o)}},computeVertexNormals:function(){if(this.attributes.position){var t,i,n,r;if(t=this.attributes.position.array.length,void 0===this.attributes.normal)this.attributes.normal={itemSize:3,array:new Float32Array(t),numItems:t};else for(t=0,i=this.attributes.normal.array.length;i>t;t++)this.attributes.normal.array[t]=0;var o,a,s,l,u,c,h=this.attributes.position.array,f=this.attributes.normal.array,p=new e.Vector3,d=new e.Vector3,m=new e.Vector3,g=new e.Vector3,v=new e.Vector3;if(this.attributes.index){var y=this.attributes.index.array,b=this.offsets;for(n=0,r=b.length;r>n;++n){i=b[n].start,o=b[n].count;var x=b[n].index;for(t=i,i+=o;i>t;t+=3)o=x+y[t],a=x+y[t+1],s=x+y[t+2],l=h[3*o],u=h[3*o+1],c=h[3*o+2],p.set(l,u,c),l=h[3*a],u=h[3*a+1],c=h[3*a+2],d.set(l,u,c),l=h[3*s],u=h[3*s+1],c=h[3*s+2],m.set(l,u,c),g.subVectors(m,d),v.subVectors(p,d),g.cross(v),f[3*o]+=g.x,f[3*o+1]+=g.y,f[3*o+2]+=g.z,f[3*a]+=g.x,f[3*a+1]+=g.y,f[3*a+2]+=g.z,f[3*s]+=g.x,f[3*s+1]+=g.y,f[3*s+2]+=g.z}}else for(t=0,i=h.length;i>t;t+=9)l=h[t],u=h[t+1],c=h[t+2],p.set(l,u,c),l=h[t+3],u=h[t+4],c=h[t+5],d.set(l,u,c),l=h[t+6],u=h[t+7],c=h[t+8],m.set(l,u,c),g.subVectors(m,d),v.subVectors(p,d),g.cross(v),f[t]=g.x,f[t+1]=g.y,f[t+2]=g.z,f[t+3]=g.x,f[t+4]=g.y,f[t+5]=g.z,f[t+6]=g.x,f[t+7]=g.y,f[t+8]=g.z;this.normalizeNormals(),this.normalsNeedUpdate=!0}},normalizeNormals:function(){for(var e,t,i,n=this.attributes.normal.array,r=0,o=n.length;o>r;r+=3)e=n[r],t=n[r+1],i=n[r+2],e=1/Math.sqrt(e*e+t*t+i*i),n[r]*=e,n[r+1]*=e,n[r+2]*=e},computeTangents:function(){function t(e){V.x=r[3*e],V.y=r[3*e+1],V.z=r[3*e+2],U.copy(V),G=u[e],j.copy(G),j.sub(V.multiplyScalar(V.dot(G))).normalize(),I.crossVectors(U,G),O=I.dot(c[e]),F=0>O?-1:1,l[4*e]=j.x,l[4*e+1]=j.y,l[4*e+2]=j.z,l[4*e+3]=F}if(void 0===this.attributes.index||void 0===this.attributes.position||void 0===this.attributes.normal||void 0===this.attributes.uv)console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");else{var i=this.attributes.index.array,n=this.attributes.position.array,r=this.attributes.normal.array,o=this.attributes.uv.array,a=n.length/3;if(void 0===this.attributes.tangent){var s=4*a;this.attributes.tangent={itemSize:4,array:new Float32Array(s),numItems:s}}for(var l=this.attributes.tangent.array,u=[],c=[],s=0;a>s;s++)u[s]=new e.Vector3,c[s]=new e.Vector3;var h,f,p,d,m,g,v,y,b,x,w,_,S,M,C,A,T,E,k,P,R,L,a=new e.Vector3,s=new e.Vector3,D=this.offsets;for(E=0,k=D.length;k>E;++E){T=D[E].start,P=D[E].count;var N=D[E].index;for(A=T,T+=P;T>A;A+=3)P=N+i[A],R=N+i[A+1],L=N+i[A+2],h=n[3*P],f=n[3*P+1],p=n[3*P+2],d=n[3*R],m=n[3*R+1],g=n[3*R+2],v=n[3*L],y=n[3*L+1],b=n[3*L+2],x=o[2*P],w=o[2*P+1],_=o[2*R],S=o[2*R+1],M=o[2*L],C=o[2*L+1],d-=h,h=v-h,m-=f,f=y-f,g-=p,p=b-p,_-=x,x=M-x,S-=w,w=C-w,C=1/(_*w-x*S),a.set((w*d-S*h)*C,(w*m-S*f)*C,(w*g-S*p)*C),s.set((_*h-x*d)*C,(_*f-x*m)*C,(_*p-x*g)*C),u[P].add(a),u[R].add(a),u[L].add(a),c[P].add(s),c[R].add(s),c[L].add(s)}var F,G,O,j=new e.Vector3,I=new e.Vector3,V=new e.Vector3,U=new e.Vector3;for(E=0,k=D.length;k>E;++E)for(T=D[E].start,P=D[E].count,N=D[E].index,A=T,T+=P;T>A;A+=3)P=N+i[A],R=N+i[A+1],L=N+i[A+2],t(P),t(R),t(L);this.tangentsNeedUpdate=this.hasTangents=!0}},dispose:function(){this.dispatchEvent({type:"dispose"})}},e.Camera=function(){e.Object3D.call(this),this.matrixWorldInverse=new e.Matrix4,this.projectionMatrix=new e.Matrix4,this.projectionMatrixInverse=new e.Matrix4},e.Camera.prototype=Object.create(e.Object3D.prototype),e.Camera.prototype.lookAt=function(){var t=new e.Matrix4;return function(e){t.lookAt(this.position,e,this.up),!0===this.useQuaternion?this.quaternion.setFromRotationMatrix(t):this.rotation.setEulerFromRotationMatrix(t,this.eulerOrder)}}(),e.OrthographicCamera=function(t,i,n,r,o,a){e.Camera.call(this),this.left=t,this.right=i,this.top=n,this.bottom=r,this.near=void 0!==o?o:.1,this.far=void 0!==a?a:2e3,this.updateProjectionMatrix()},e.OrthographicCamera.prototype=Object.create(e.Camera.prototype),e.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)},e.PerspectiveCamera=function(t,i,n,r){e.Camera.call(this),this.fov=void 0!==t?t:50,this.aspect=void 0!==i?i:1,this.near=void 0!==n?n:.1,this.far=void 0!==r?r:2e3,this.updateProjectionMatrix()},e.PerspectiveCamera.prototype=Object.create(e.Camera.prototype),e.PerspectiveCamera.prototype.setLens=function(t,i){void 0===i&&(i=24),this.fov=2*e.Math.radToDeg(Math.atan(i/(2*t))),this.updateProjectionMatrix()},e.PerspectiveCamera.prototype.setViewOffset=function(e,t,i,n,r,o){this.fullWidth=e,this.fullHeight=t,this.x=i,this.y=n,this.width=r,this.height=o,this.updateProjectionMatrix()},e.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var t=this.fullWidth/this.fullHeight,i=Math.tan(e.Math.degToRad(.5*this.fov))*this.near,n=-i,r=t*n,t=Math.abs(t*i-r),n=Math.abs(i-n);this.projectionMatrix.makeFrustum(r+this.x*t/this.fullWidth,r+(this.x+this.width)*t/this.fullWidth,i-(this.y+this.height)*n/this.fullHeight,i-this.y*n/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},e.Light=function(t){e.Object3D.call(this),this.color=new e.Color(t)},e.Light.prototype=Object.create(e.Object3D.prototype),e.Light.prototype.clone=function(t){return void 0===t&&(t=new e.Light),e.Object3D.prototype.clone.call(this,t),t.color.copy(this.color),t},e.AmbientLight=function(t){e.Light.call(this,t)},e.AmbientLight.prototype=Object.create(e.Light.prototype),e.AmbientLight.prototype.clone=function(){var t=new e.AmbientLight;return e.Light.prototype.clone.call(this,t),t},e.AreaLight=function(t,i){e.Light.call(this,t),this.normal=new e.Vector3(0,-1,0),this.right=new e.Vector3(1,0,0),this.intensity=void 0!==i?i:1,this.height=this.width=1,this.constantAttenuation=1.5,this.linearAttenuation=.5,this.quadraticAttenuation=.1},e.AreaLight.prototype=Object.create(e.Light.prototype),e.DirectionalLight=function(t,i){e.Light.call(this,t),this.position.set(0,1,0),this.target=new e.Object3D,this.intensity=void 0!==i?i:1,this.onlyShadow=this.castShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraTop=this.shadowCameraRight=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapHeight=this.shadowMapWidth=512,this.shadowCascade=!1,this.shadowCascadeOffset=new e.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null},e.DirectionalLight.prototype=Object.create(e.Light.prototype),e.DirectionalLight.prototype.clone=function(){var t=new e.DirectionalLight;return e.Light.prototype.clone.call(this,t),t.target=this.target.clone(),t.intensity=this.intensity,t.castShadow=this.castShadow,t.onlyShadow=this.onlyShadow,t},e.HemisphereLight=function(t,i,n){e.Light.call(this,t),this.position.set(0,100,0),this.groundColor=new e.Color(i),this.intensity=void 0!==n?n:1},e.HemisphereLight.prototype=Object.create(e.Light.prototype),e.HemisphereLight.prototype.clone=function(){var t=new e.PointLight;return e.Light.prototype.clone.call(this,t),t.groundColor.copy(this.groundColor),t.intensity=this.intensity,t},e.PointLight=function(t,i,n){e.Light.call(this,t),this.intensity=void 0!==i?i:1,this.distance=void 0!==n?n:0},e.PointLight.prototype=Object.create(e.Light.prototype),e.PointLight.prototype.clone=function(){var t=new e.PointLight;return e.Light.prototype.clone.call(this,t),t.intensity=this.intensity,t.distance=this.distance,t},e.SpotLight=function(t,i,n,r,o){e.Light.call(this,t),this.position.set(0,1,0),this.target=new e.Object3D,this.intensity=void 0!==i?i:1,this.distance=void 0!==n?n:0,this.angle=void 0!==r?r:Math.PI/3,this.exponent=void 0!==o?o:10,this.onlyShadow=this.castShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapHeight=this.shadowMapWidth=512,this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null},e.SpotLight.prototype=Object.create(e.Light.prototype),e.SpotLight.prototype.clone=function(){var t=new e.SpotLight;return e.Light.prototype.clone.call(this,t),t.target=this.target.clone(),t.intensity=this.intensity,t.distance=this.distance,t.angle=this.angle,t.exponent=this.exponent,t.castShadow=this.castShadow,t.onlyShadow=this.onlyShadow,t},e.Loader=function(t){this.statusDomElement=(this.showStatus=t)?e.Loader.prototype.addStatusElement():null,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},e.Loader.prototype={constructor:e.Loader,crossOrigin:"anonymous",addStatusElement:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.right="0px",e.style.top="0px",e.style.fontSize="0.8em",e.style.textAlign="left",e.style.background="rgba(0,0,0,0.25)",e.style.color="#fff",e.style.width="120px",e.style.padding="0.5em 0.5em 0.5em 0.5em",e.style.zIndex=1e3,e.innerHTML="Loading ...",e},updateProgress:function(e){var t="Loaded ",t=e.total?t+((100*e.loaded/e.total).toFixed(0)+"%"):t+((e.loaded/1e3).toFixed(2)+" KB");this.statusDomElement.innerHTML=t},extractUrlBase:function(e){return e=e.split("/"),e.pop(),(1>e.length?".":e.join("/"))+"/"},initMaterials:function(t,i){for(var n=[],r=0;r<t.length;++r)n[r]=e.Loader.prototype.createMaterial(t[r],i);return n},needsTangents:function(t){for(var i=0,n=t.length;n>i;i++)if(t[i]instanceof e.ShaderMaterial)return!0;return!1},createMaterial:function(t,i){function n(e){return e=Math.log(e)/Math.LN2,Math.floor(e)==e}function r(e){return e=Math.log(e)/Math.LN2,Math.pow(2,Math.round(e))}function o(t,o,a,l,u,c,h){var f=/\.dds$/i.test(a),p=i+"/"+a;if(f){var d=e.ImageUtils.loadCompressedTexture(p);t[o]=d}else d=document.createElement("canvas"),t[o]=new e.Texture(d);if(t[o].sourceFile=a,l&&(t[o].repeat.set(l[0],l[1]),1!==l[0]&&(t[o].wrapS=e.RepeatWrapping),1!==l[1]&&(t[o].wrapT=e.RepeatWrapping)),u&&t[o].offset.set(u[0],u[1]),c&&(a={repeat:e.RepeatWrapping,mirror:e.MirroredRepeatWrapping},void 0!==a[c[0]]&&(t[o].wrapS=a[c[0]]),void 0!==a[c[1]]&&(t[o].wrapT=a[c[1]])),h&&(t[o].anisotropy=h),!f){var m=t[o],t=new Image;t.onload=function(){if(n(this.width)&&n(this.height))m.image=this;else{var e=r(this.width),t=r(this.height);m.image.width=e,m.image.height=t,m.image.getContext("2d").drawImage(this,0,0,e,t)}m.needsUpdate=!0},t.crossOrigin=s.crossOrigin,t.src=p}}function a(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]}var s=this,l="MeshLambertMaterial",u={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(t.shading){var c=t.shading.toLowerCase();"phong"===c?l="MeshPhongMaterial":"basic"===c&&(l="MeshBasicMaterial")}return void 0!==t.blending&&void 0!==e[t.blending]&&(u.blending=e[t.blending]),(void 0!==t.transparent||1>t.opacity)&&(u.transparent=t.transparent),void 0!==t.depthTest&&(u.depthTest=t.depthTest),void 0!==t.depthWrite&&(u.depthWrite=t.depthWrite),void 0!==t.visible&&(u.visible=t.visible),void 0!==t.flipSided&&(u.side=e.BackSide),void 0!==t.doubleSided&&(u.side=e.DoubleSide),void 0!==t.wireframe&&(u.wireframe=t.wireframe),void 0!==t.vertexColors&&("face"===t.vertexColors?u.vertexColors=e.FaceColors:t.vertexColors&&(u.vertexColors=e.VertexColors)),t.colorDiffuse?u.color=a(t.colorDiffuse):t.DbgColor&&(u.color=t.DbgColor),t.colorSpecular&&(u.specular=a(t.colorSpecular)),t.colorAmbient&&(u.ambient=a(t.colorAmbient)),t.transparency&&(u.opacity=t.transparency),t.specularCoef&&(u.shininess=t.specularCoef),t.mapDiffuse&&i&&o(u,"map",t.mapDiffuse,t.mapDiffuseRepeat,t.mapDiffuseOffset,t.mapDiffuseWrap,t.mapDiffuseAnisotropy),t.mapLight&&i&&o(u,"lightMap",t.mapLight,t.mapLightRepeat,t.mapLightOffset,t.mapLightWrap,t.mapLightAnisotropy),t.mapBump&&i&&o(u,"bumpMap",t.mapBump,t.mapBumpRepeat,t.mapBumpOffset,t.mapBumpWrap,t.mapBumpAnisotropy),t.mapNormal&&i&&o(u,"normalMap",t.mapNormal,t.mapNormalRepeat,t.mapNormalOffset,t.mapNormalWrap,t.mapNormalAnisotropy),t.mapSpecular&&i&&o(u,"specularMap",t.mapSpecular,t.mapSpecularRepeat,t.mapSpecularOffset,t.mapSpecularWrap,t.mapSpecularAnisotropy),t.mapBumpScale&&(u.bumpScale=t.mapBumpScale),t.mapNormal?(l=e.ShaderLib.normalmap,c=e.UniformsUtils.clone(l.uniforms),c.tNormal.value=u.normalMap,t.mapNormalFactor&&c.uNormalScale.value.set(t.mapNormalFactor,t.mapNormalFactor),u.map&&(c.tDiffuse.value=u.map,c.enableDiffuse.value=!0),u.specularMap&&(c.tSpecular.value=u.specularMap,c.enableSpecular.value=!0),u.lightMap&&(c.tAO.value=u.lightMap,c.enableAO.value=!0),c.uDiffuseColor.value.setHex(u.color),c.uSpecularColor.value.setHex(u.specular),c.uAmbientColor.value.setHex(u.ambient),c.uShininess.value=u.shininess,void 0!==u.opacity&&(c.uOpacity.value=u.opacity),l=new e.ShaderMaterial({fragmentShader:l.fragmentShader,vertexShader:l.vertexShader,uniforms:c,lights:!0,fog:!0}),u.transparent&&(l.transparent=!0)):l=new e[l](u),void 0!==t.DbgName&&(l.name=t.DbgName),l}},e.ImageLoader=function(){this.crossOrigin=null},e.ImageLoader.prototype={constructor:e.ImageLoader,addEventListener:e.EventDispatcher.prototype.addEventListener,hasEventListener:e.EventDispatcher.prototype.hasEventListener,removeEventListener:e.EventDispatcher.prototype.removeEventListener,dispatchEvent:e.EventDispatcher.prototype.dispatchEvent,load:function(e,t){var i=this;void 0===t&&(t=new Image),t.addEventListener("load",function(){i.dispatchEvent({type:"load",content:t})},!1),t.addEventListener("error",function(){i.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})},!1),i.crossOrigin&&(t.crossOrigin=i.crossOrigin),t.src=e}},e.JSONLoader=function(t){e.Loader.call(this,t),this.withCredentials=!1},e.JSONLoader.prototype=Object.create(e.Loader.prototype),e.JSONLoader.prototype.load=function(e,t,i){i=i&&"string"==typeof i?i:this.extractUrlBase(e),this.onLoadStart(),this.loadAjaxJSON(this,e,t,i)},e.JSONLoader.prototype.loadAjaxJSON=function(e,t,i,n,r){var o=new XMLHttpRequest,a=0;o.onreadystatechange=function(){if(o.readyState===o.DONE)if(200===o.status||0===o.status){if(o.responseText){var s=JSON.parse(o.responseText),s=e.parse(s,n);i(s.geometry,s.materials)}else console.warn("THREE.JSONLoader: ["+t+"] seems to be unreachable or file there is empty");e.onLoadComplete()}else console.error("THREE.JSONLoader: Couldn't load ["+t+"] ["+o.status+"]");else o.readyState===o.LOADING?r&&(0===a&&(a=o.getResponseHeader("Content-Length")),r({total:a,loaded:o.responseText.length})):o.readyState===o.HEADERS_RECEIVED&&void 0!==r&&(a=o.getResponseHeader("Content-Length"))},o.open("GET",t,!0),o.withCredentials=this.withCredentials,o.send(null)},e.JSONLoader.prototype.parse=function(t,i){var n,r,o,a,s,l,u,c,h,f,p,d,m,g,v,y=new e.Geometry,b=void 0!==t.scale?1/t.scale:1,x=t.faces;f=t.vertices;var w=t.normals,_=t.colors,S=0;for(n=0;n<t.uvs.length;n++)t.uvs[n].length&&S++;for(n=0;S>n;n++)y.faceUvs[n]=[],y.faceVertexUvs[n]=[];for(a=0,s=f.length;s>a;)l=new e.Vector3,l.x=f[a++]*b,l.y=f[a++]*b,l.z=f[a++]*b,y.vertices.push(l);for(a=0,s=x.length;s>a;){if(f=x[a++],l=1&f,o=2&f,n=4&f,r=8&f,c=16&f,u=32&f,p=64&f,f&=128,l?(d=new e.Face4,d.a=x[a++],d.b=x[a++],d.c=x[a++],d.d=x[a++],l=4):(d=new e.Face3,d.a=x[a++],d.b=x[a++],d.c=x[a++],l=3),o&&(o=x[a++],d.materialIndex=o),o=y.faces.length,n)for(n=0;S>n;n++)m=t.uvs[n],h=x[a++],v=m[2*h],h=m[2*h+1],y.faceUvs[n][o]=new e.Vector2(v,h);if(r)for(n=0;S>n;n++){for(m=t.uvs[n],g=[],r=0;l>r;r++)h=x[a++],v=m[2*h],h=m[2*h+1],g[r]=new e.Vector2(v,h);y.faceVertexUvs[n][o]=g}if(c&&(c=3*x[a++],r=new e.Vector3,r.x=w[c++],r.y=w[c++],r.z=w[c],d.normal=r),u)for(n=0;l>n;n++)c=3*x[a++],r=new e.Vector3,r.x=w[c++],r.y=w[c++],r.z=w[c],d.vertexNormals.push(r);if(p&&(u=x[a++],u=new e.Color(_[u]),d.color=u),f)for(n=0;l>n;n++)u=x[a++],u=new e.Color(_[u]),d.vertexColors.push(u);y.faces.push(d)}if(t.skinWeights)for(a=0,s=t.skinWeights.length;s>a;a+=2)x=t.skinWeights[a],w=t.skinWeights[a+1],y.skinWeights.push(new e.Vector4(x,w,0,0));if(t.skinIndices)for(a=0,s=t.skinIndices.length;s>a;a+=2)x=t.skinIndices[a],w=t.skinIndices[a+1],y.skinIndices.push(new e.Vector4(x,w,0,0));if(y.bones=t.bones,y.animation=t.animation,void 0!==t.morphTargets)for(a=0,s=t.morphTargets.length;s>a;a++)for(y.morphTargets[a]={},y.morphTargets[a].name=t.morphTargets[a].name,y.morphTargets[a].vertices=[],_=y.morphTargets[a].vertices,S=t.morphTargets[a].vertices,x=0,w=S.length;w>x;x+=3)f=new e.Vector3,f.x=S[x]*b,f.y=S[x+1]*b,f.z=S[x+2]*b,_.push(f);if(void 0!==t.morphColors)for(a=0,s=t.morphColors.length;s>a;a++)for(y.morphColors[a]={},y.morphColors[a].name=t.morphColors[a].name,y.morphColors[a].colors=[],w=y.morphColors[a].colors,_=t.morphColors[a].colors,b=0,x=_.length;x>b;b+=3)S=new e.Color(16755200),S.setRGB(_[b],_[b+1],_[b+2]),w.push(S);return y.computeCentroids(),y.computeFaceNormals(),void 0===t.materials?{geometry:y}:(b=this.initMaterials(t.materials,i),this.needsTangents(b)&&y.computeTangents(),{geometry:y,materials:b})},e.LoadingMonitor=function(){var e=this,t=0,i=0,n=function(){t++,e.dispatchEvent({type:"progress",loaded:t,total:i}),t===i&&e.dispatchEvent({type:"load"})};this.add=function(e){i++,e.addEventListener("load",n,!1)}},e.LoadingMonitor.prototype={constructor:e.LoadingMonitor,addEventListener:e.EventDispatcher.prototype.addEventListener,hasEventListener:e.EventDispatcher.prototype.hasEventListener,removeEventListener:e.EventDispatcher.prototype.removeEventListener,dispatchEvent:e.EventDispatcher.prototype.dispatchEvent},e.GeometryLoader=function(){},e.GeometryLoader.prototype={constructor:e.GeometryLoader,addEventListener:e.EventDispatcher.prototype.addEventListener,hasEventListener:e.EventDispatcher.prototype.hasEventListener,removeEventListener:e.EventDispatcher.prototype.removeEventListener,dispatchEvent:e.EventDispatcher.prototype.dispatchEvent,load:function(e){var t=this,i=new XMLHttpRequest;i.addEventListener("load",function(e){e=t.parse(JSON.parse(e.target.responseText)),t.dispatchEvent({type:"load",content:e})},!1),i.addEventListener("progress",function(e){t.dispatchEvent({type:"progress",loaded:e.loaded,total:e.total})},!1),i.addEventListener("error",function(){t.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})},!1),i.open("GET",e,!0),i.send(null)},parse:function(){}},e.MaterialLoader=function(){},e.MaterialLoader.prototype={constructor:e.MaterialLoader,addEventListener:e.EventDispatcher.prototype.addEventListener,hasEventListener:e.EventDispatcher.prototype.hasEventListener,removeEventListener:e.EventDispatcher.prototype.removeEventListener,dispatchEvent:e.EventDispatcher.prototype.dispatchEvent,load:function(e){var t=this,i=new XMLHttpRequest;i.addEventListener("load",function(e){e=t.parse(JSON.parse(e.target.responseText)),t.dispatchEvent({type:"load",content:e})},!1),i.addEventListener("progress",function(e){t.dispatchEvent({type:"progress",loaded:e.loaded,total:e.total})},!1),i.addEventListener("error",function(){t.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})},!1),i.open("GET",e,!0),i.send(null)},parse:function(t){var i;switch(t.type){case"MeshBasicMaterial":i=new e.MeshBasicMaterial({color:t.color,opacity:t.opacity,transparent:t.transparent,wireframe:t.wireframe});break;case"MeshLambertMaterial":i=new e.MeshLambertMaterial({color:t.color,ambient:t.ambient,emissive:t.emissive,opacity:t.opacity,transparent:t.transparent,wireframe:t.wireframe});break;case"MeshPhongMaterial":i=new e.MeshPhongMaterial({color:t.color,ambient:t.ambient,emissive:t.emissive,specular:t.specular,shininess:t.shininess,opacity:t.opacity,transparent:t.transparent,wireframe:t.wireframe});break;case"MeshNormalMaterial":i=new e.MeshNormalMaterial({opacity:t.opacity,transparent:t.transparent,wireframe:t.wireframe});break;case"MeshDepthMaterial":i=new e.MeshDepthMaterial({opacity:t.opacity,transparent:t.transparent,wireframe:t.wireframe})}return i}},e.SceneLoader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){},this.callbackSync=function(){},this.callbackProgress=function(){},this.geometryHandlerMap={},this.hierarchyHandlerMap={},this.addGeometryHandler("ascii",e.JSONLoader)},e.SceneLoader.prototype.constructor=e.SceneLoader,e.SceneLoader.prototype.load=function(e,t){var i=this,n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status||0===n.status){var r=JSON.parse(n.responseText);i.parse(r,t,e)}else console.error("THREE.SceneLoader: Couldn't load ["+e+"] ["+n.status+"]")},n.open("GET",e,!0),n.send(null)},e.SceneLoader.prototype.addGeometryHandler=function(e,t){this.geometryHandlerMap[e]={loaderClass:t}},e.SceneLoader.prototype.addHierarchyHandler=function(e,t){this.hierarchyHandlerMap[e]={loaderClass:t}},e.SceneLoader.prototype.parse=function(t,i,n){function r(e,t){return"relativeToHTML"==t?e:A+"/"+e}function o(){a(S.scene,E.objects)}function a(t,i){var n,o,s,u,c,d,m;for(m in i)if(void 0===S.objects[m]){var b=i[m],x=null;if(b.type&&b.type in C.hierarchyHandlerMap){if(void 0===b.loading){o={type:1,url:1,material:1,position:1,rotation:1,scale:1,visible:1,children:1,userData:1,skin:1,morph:1,mirroredLoop:1,duration:1},s={};for(var w in b)w in o||(s[w]=b[w]);f=S.materials[b.material],b.loading=!0,o=C.hierarchyHandlerMap[b.type].loaderObject,o.options?o.load(r(b.url,E.urlBaseType),l(m,t,f,b)):o.load(r(b.url,E.urlBaseType),l(m,t,f,b),s)}}else if(void 0!==b.geometry){if(h=S.geometries[b.geometry]){if(x=!1,f=S.materials[b.material],x=f instanceof e.ShaderMaterial,s=b.position,u=b.rotation,c=b.scale,n=b.matrix,d=b.quaternion,b.material||(f=new e.MeshFaceMaterial(S.face_materials[b.geometry])),f instanceof e.MeshFaceMaterial&&0===f.materials.length&&(f=new e.MeshFaceMaterial(S.face_materials[b.geometry])),f instanceof e.MeshFaceMaterial)for(o=0;o<f.materials.length;o++)x=x||f.materials[o]instanceof e.ShaderMaterial;x&&h.computeTangents(),b.skin?x=new e.SkinnedMesh(h,f):b.morph?(x=new e.MorphAnimMesh(h,f),void 0!==b.duration&&(x.duration=b.duration),void 0!==b.time&&(x.time=b.time),void 0!==b.mirroredLoop&&(x.mirroredLoop=b.mirroredLoop),f.morphNormals&&h.computeMorphNormals()):x=new e.Mesh(h,f),x.name=m,n?(x.matrixAutoUpdate=!1,x.matrix.set(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15])):(x.position.set(s[0],s[1],s[2]),d?(x.quaternion.set(d[0],d[1],d[2],d[3]),x.useQuaternion=!0):x.rotation.set(u[0],u[1],u[2]),x.scale.set(c[0],c[1],c[2])),x.visible=b.visible,x.castShadow=b.castShadow,x.receiveShadow=b.receiveShadow,t.add(x),S.objects[m]=x}}else"DirectionalLight"===b.type||"PointLight"===b.type||"AmbientLight"===b.type?(v=void 0!==b.color?b.color:16777215,y=void 0!==b.intensity?b.intensity:1,"DirectionalLight"===b.type?(s=b.direction,g=new e.DirectionalLight(v,y),g.position.set(s[0],s[1],s[2]),b.target&&(T.push({object:g,targetName:b.target}),g.target=null)):"PointLight"===b.type?(s=b.position,o=b.distance,g=new e.PointLight(v,y,o),g.position.set(s[0],s[1],s[2])):"AmbientLight"===b.type&&(g=new e.AmbientLight(v)),t.add(g),g.name=m,S.lights[m]=g,S.objects[m]=g):"PerspectiveCamera"===b.type||"OrthographicCamera"===b.type?(s=b.position,u=b.rotation,d=b.quaternion,"PerspectiveCamera"===b.type?p=new e.PerspectiveCamera(b.fov,b.aspect,b.near,b.far):"OrthographicCamera"===b.type&&(p=new e.OrthographicCamera(b.left,b.right,b.top,b.bottom,b.near,b.far)),p.name=m,p.position.set(s[0],s[1],s[2]),void 0!==d?(p.quaternion.set(d[0],d[1],d[2],d[3]),p.useQuaternion=!0):void 0!==u&&p.rotation.set(u[0],u[1],u[2]),t.add(p),S.cameras[m]=p,S.objects[m]=p):(s=b.position,u=b.rotation,c=b.scale,d=b.quaternion,x=new e.Object3D,x.name=m,x.position.set(s[0],s[1],s[2]),d?(x.quaternion.set(d[0],d[1],d[2],d[3]),x.useQuaternion=!0):x.rotation.set(u[0],u[1],u[2]),x.scale.set(c[0],c[1],c[2]),x.visible=void 0!==b.visible?b.visible:!1,t.add(x),S.objects[m]=x,S.empties[m]=x);if(x){if(void 0!==b.userData)for(var _ in b.userData)x.userData[_]=b.userData[_];if(void 0!==b.groups)for(o=0;o<b.groups.length;o++)s=b.groups[o],void 0===S.groups[s]&&(S.groups[s]=[]),S.groups[s].push(m);void 0!==b.children&&a(x,b.children)}}}function s(e){return function(t,i){t.name=e,S.geometries[e]=t,S.face_materials[e]=i,o(),b-=1,C.onLoadComplete(),c()}}function l(e,t,i,n){return function(r){var r=r.content?r.content:r.dae?r.scene:r,a=n.position,s=n.rotation,l=n.quaternion,u=n.scale;r.position.set(a[0],a[1],a[2]),l?(r.quaternion.set(l[0],l[1],l[2],l[3]),r.useQuaternion=!0):r.rotation.set(s[0],s[1],s[2]),r.scale.set(u[0],u[1],u[2]),i&&r.traverse(function(e){e.material=i});var h=void 0!==n.visible?n.visible:!0;r.traverse(function(e){e.visible=h}),t.add(r),r.name=e,S.objects[e]=r,o(),b-=1,C.onLoadComplete(),c()}}function u(e){return function(t,i){t.name=e,S.geometries[e]=t,S.face_materials[e]=i}}function c(){if(C.callbackProgress({totalModels:w,totalTextures:_,loadedModels:w-b,loadedTextures:_-x},S),C.onLoadProgress(),0===b&&0===x){for(var t=0;t<T.length;t++){var n=T[t],r=S.objects[n.targetName];r?n.object.target=r:(n.object.target=new e.Object3D,S.scene.add(n.object.target)),n.object.target.userData.targetInverse=n.object}i(S)}}var h,f,p,d,m,g,v,y,b,x,w,_,S,M,C=this,A=e.Loader.prototype.extractUrlBase(n),T=[],E=t;for(M in this.geometryHandlerMap)t=this.geometryHandlerMap[M].loaderClass,this.geometryHandlerMap[M].loaderObject=new t;for(M in this.hierarchyHandlerMap)t=this.hierarchyHandlerMap[M].loaderClass,this.hierarchyHandlerMap[M].loaderObject=new t;x=b=0,S={scene:new e.Scene,geometries:{},face_materials:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{},groups:{}},E.transform&&(M=E.transform.position,t=E.transform.rotation,n=E.transform.scale,M&&S.scene.position.set(M[0],M[1],M[2]),t&&S.scene.rotation.set(t[0],t[1],t[2]),n&&S.scene.scale.set(n[0],n[1],n[2]),M||t||n)&&(S.scene.updateMatrix(),S.scene.updateMatrixWorld()),M=function(e){return function(){x-=e,c(),C.onLoadComplete()}};for(var k in E.fogs)t=E.fogs[k],"linear"===t.type?d=new e.Fog(0,t.near,t.far):"exp2"===t.type&&(d=new e.FogExp2(0,t.density)),t=t.color,d.color.setRGB(t[0],t[1],t[2]),S.fogs[k]=d;for(var P in E.geometries)d=E.geometries[P],d.type in this.geometryHandlerMap&&(b+=1,C.onLoadStart());for(var R in E.objects)d=E.objects[R],d.type&&d.type in this.hierarchyHandlerMap&&(b+=1,C.onLoadStart());w=b;for(P in E.geometries)if(d=E.geometries[P],"cube"===d.type)h=new e.CubeGeometry(d.width,d.height,d.depth,d.widthSegments,d.heightSegments,d.depthSegments),h.name=P,S.geometries[P]=h;else if("plane"===d.type)h=new e.PlaneGeometry(d.width,d.height,d.widthSegments,d.heightSegments),h.name=P,S.geometries[P]=h;else if("sphere"===d.type)h=new e.SphereGeometry(d.radius,d.widthSegments,d.heightSegments),h.name=P,S.geometries[P]=h;else if("cylinder"===d.type)h=new e.CylinderGeometry(d.topRad,d.botRad,d.height,d.radSegs,d.heightSegs),h.name=P,S.geometries[P]=h;else if("torus"===d.type)h=new e.TorusGeometry(d.radius,d.tube,d.segmentsR,d.segmentsT),h.name=P,S.geometries[P]=h;else if("icosahedron"===d.type)h=new e.IcosahedronGeometry(d.radius,d.subdivisions),h.name=P,S.geometries[P]=h;else if(d.type in this.geometryHandlerMap){R={};for(m in d)"type"!==m&&"url"!==m&&(R[m]=d[m]);this.geometryHandlerMap[d.type].loaderObject.load(r(d.url,E.urlBaseType),s(P),R)}else"embedded"===d.type&&(R=E.embeds[d.id],R.metadata=E.metadata,R&&(R=this.geometryHandlerMap.ascii.loaderObject.parse(R,""),u(P)(R.geometry,R.materials)));for(var L in E.textures)if(P=E.textures[L],P.url instanceof Array)for(x+=P.url.length,m=0;m<P.url.length;m++)C.onLoadStart();else x+=1,C.onLoadStart();_=x;for(L in E.textures){if(P=E.textures[L],void 0!==P.mapping&&void 0!==e[P.mapping]&&(P.mapping=new e[P.mapping]),P.url instanceof Array){for(R=P.url.length,d=[],m=0;R>m;m++)d[m]=r(P.url[m],E.urlBaseType);m=(m=/\.dds$/i.test(d[0]))?e.ImageUtils.loadCompressedTextureCube(d,P.mapping,M(R)):e.ImageUtils.loadTextureCube(d,P.mapping,M(R))}else m=/\.dds$/i.test(P.url),R=r(P.url,E.urlBaseType),d=M(1),m=m?e.ImageUtils.loadCompressedTexture(R,P.mapping,d):e.ImageUtils.loadTexture(R,P.mapping,d),void 0!==e[P.minFilter]&&(m.minFilter=e[P.minFilter]),void 0!==e[P.magFilter]&&(m.magFilter=e[P.magFilter]),P.anisotropy&&(m.anisotropy=P.anisotropy),P.repeat&&(m.repeat.set(P.repeat[0],P.repeat[1]),1!==P.repeat[0]&&(m.wrapS=e.RepeatWrapping),1!==P.repeat[1]&&(m.wrapT=e.RepeatWrapping)),P.offset&&m.offset.set(P.offset[0],P.offset[1]),P.wrap&&(R={repeat:e.RepeatWrapping,mirror:e.MirroredRepeatWrapping},void 0!==R[P.wrap[0]]&&(m.wrapS=R[P.wrap[0]]),void 0!==R[P.wrap[1]]&&(m.wrapT=R[P.wrap[1]]));S.textures[L]=m}var D,N;for(D in E.materials){L=E.materials[D];for(N in L.parameters)"envMap"===N||"map"===N||"lightMap"===N||"bumpMap"===N?L.parameters[N]=S.textures[L.parameters[N]]:"shading"===N?L.parameters[N]="flat"===L.parameters[N]?e.FlatShading:e.SmoothShading:"side"===N?L.parameters[N]="double"==L.parameters[N]?e.DoubleSide:"back"==L.parameters[N]?e.BackSide:e.FrontSide:"blending"===N?L.parameters[N]=L.parameters[N]in e?e[L.parameters[N]]:e.NormalBlending:"combine"===N?L.parameters[N]=L.parameters[N]in e?e[L.parameters[N]]:e.MultiplyOperation:"vertexColors"===N?"face"==L.parameters[N]?L.parameters[N]=e.FaceColors:L.parameters[N]&&(L.parameters[N]=e.VertexColors):"wrapRGB"===N&&(M=L.parameters[N],L.parameters[N]=new e.Vector3(M[0],M[1],M[2]));void 0!==L.parameters.opacity&&1>L.parameters.opacity&&(L.parameters.transparent=!0),L.parameters.normalMap?(M=e.ShaderLib.normalmap,P=e.UniformsUtils.clone(M.uniforms),m=L.parameters.color,R=L.parameters.specular,d=L.parameters.ambient,k=L.parameters.shininess,P.tNormal.value=S.textures[L.parameters.normalMap],L.parameters.normalScale&&P.uNormalScale.value.set(L.parameters.normalScale[0],L.parameters.normalScale[1]),L.parameters.map&&(P.tDiffuse.value=L.parameters.map,P.enableDiffuse.value=!0),L.parameters.envMap&&(P.tCube.value=L.parameters.envMap,P.enableReflection.value=!0,P.uReflectivity.value=L.parameters.reflectivity),L.parameters.lightMap&&(P.tAO.value=L.parameters.lightMap,P.enableAO.value=!0),L.parameters.specularMap&&(P.tSpecular.value=S.textures[L.parameters.specularMap],P.enableSpecular.value=!0),L.parameters.displacementMap&&(P.tDisplacement.value=S.textures[L.parameters.displacementMap],P.enableDisplacement.value=!0,P.uDisplacementBias.value=L.parameters.displacementBias,P.uDisplacementScale.value=L.parameters.displacementScale),P.uDiffuseColor.value.setHex(m),P.uSpecularColor.value.setHex(R),P.uAmbientColor.value.setHex(d),P.uShininess.value=k,L.parameters.opacity&&(P.uOpacity.value=L.parameters.opacity),f=new e.ShaderMaterial({fragmentShader:M.fragmentShader,vertexShader:M.vertexShader,uniforms:P,lights:!0,fog:!0})):f=new e[L.type](L.parameters),f.name=D,S.materials[D]=f}for(D in E.materials)if(L=E.materials[D],L.parameters.materials){for(N=[],m=0;m<L.parameters.materials.length;m++)N.push(S.materials[L.parameters.materials[m]]);S.materials[D].materials=N}o(),S.cameras&&E.defaults.camera&&(S.currentCamera=S.cameras[E.defaults.camera]),S.fogs&&E.defaults.fog&&(S.scene.fog=S.fogs[E.defaults.fog]),C.callbackSync(S),c()},e.TextureLoader=function(){this.crossOrigin=null},e.TextureLoader.prototype={constructor:e.TextureLoader,addEventListener:e.EventDispatcher.prototype.addEventListener,hasEventListener:e.EventDispatcher.prototype.hasEventListener,removeEventListener:e.EventDispatcher.prototype.removeEventListener,dispatchEvent:e.EventDispatcher.prototype.dispatchEvent,load:function(t){var i=this,n=new Image;
n.addEventListener("load",function(){var t=new e.Texture(n);t.needsUpdate=!0,i.dispatchEvent({type:"load",content:t})},!1),n.addEventListener("error",function(){i.dispatchEvent({type:"error",message:"Couldn't load URL ["+t+"]"})},!1),i.crossOrigin&&(n.crossOrigin=i.crossOrigin),n.src=t}},e.Material=function(){this.id=e.MaterialIdCount++,this.name="",this.side=e.FrontSide,this.opacity=1,this.transparent=!1,this.blending=e.NormalBlending,this.blendSrc=e.SrcAlphaFactor,this.blendDst=e.OneMinusSrcAlphaFactor,this.blendEquation=e.AddEquation,this.depthWrite=this.depthTest=!0,this.polygonOffset=!1,this.alphaTest=this.polygonOffsetUnits=this.polygonOffsetFactor=0,this.overdraw=!1,this.needsUpdate=this.visible=!0},e.Material.prototype={constructor:e.Material,addEventListener:e.EventDispatcher.prototype.addEventListener,hasEventListener:e.EventDispatcher.prototype.hasEventListener,removeEventListener:e.EventDispatcher.prototype.removeEventListener,dispatchEvent:e.EventDispatcher.prototype.dispatchEvent,setValues:function(t){if(void 0!==t)for(var i in t){var n=t[i];if(void 0===n)console.warn("THREE.Material: '"+i+"' parameter is undefined.");else if(i in this){var r=this[i];r instanceof e.Color?r.set(n):r instanceof e.Vector3&&n instanceof e.Vector3?r.copy(n):this[i]=n}}},clone:function(t){return void 0===t&&(t=new e.Material),t.name=this.name,t.side=this.side,t.opacity=this.opacity,t.transparent=this.transparent,t.blending=this.blending,t.blendSrc=this.blendSrc,t.blendDst=this.blendDst,t.blendEquation=this.blendEquation,t.depthTest=this.depthTest,t.depthWrite=this.depthWrite,t.polygonOffset=this.polygonOffset,t.polygonOffsetFactor=this.polygonOffsetFactor,t.polygonOffsetUnits=this.polygonOffsetUnits,t.alphaTest=this.alphaTest,t.overdraw=this.overdraw,t.visible=this.visible,t},dispose:function(){this.dispatchEvent({type:"dispose"})}},e.MaterialIdCount=0,e.LineBasicMaterial=function(t){e.Material.call(this),this.color=new e.Color(16777215),this.linewidth=1,this.linejoin=this.linecap="round",this.vertexColors=!1,this.fog=!0,this.setValues(t)},e.LineBasicMaterial.prototype=Object.create(e.Material.prototype),e.LineBasicMaterial.prototype.clone=function(){var t=new e.LineBasicMaterial;return e.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.linewidth=this.linewidth,t.linecap=this.linecap,t.linejoin=this.linejoin,t.vertexColors=this.vertexColors,t.fog=this.fog,t},e.LineDashedMaterial=function(t){e.Material.call(this),this.color=new e.Color(16777215),this.scale=this.linewidth=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(t)},e.LineDashedMaterial.prototype=Object.create(e.Material.prototype),e.LineDashedMaterial.prototype.clone=function(){var t=new e.LineDashedMaterial;return e.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.linewidth=this.linewidth,t.scale=this.scale,t.dashSize=this.dashSize,t.gapSize=this.gapSize,t.vertexColors=this.vertexColors,t.fog=this.fog,t},e.MeshBasicMaterial=function(t){e.Material.call(this),this.color=new e.Color(16777215),this.envMap=this.specularMap=this.lightMap=this.map=null,this.combine=e.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=e.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=e.NoColors,this.morphTargets=this.skinning=!1,this.setValues(t)},e.MeshBasicMaterial.prototype=Object.create(e.Material.prototype),e.MeshBasicMaterial.prototype.clone=function(){var t=new e.MeshBasicMaterial;return e.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.map=this.map,t.lightMap=this.lightMap,t.specularMap=this.specularMap,t.envMap=this.envMap,t.combine=this.combine,t.reflectivity=this.reflectivity,t.refractionRatio=this.refractionRatio,t.fog=this.fog,t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t.wireframeLinecap=this.wireframeLinecap,t.wireframeLinejoin=this.wireframeLinejoin,t.vertexColors=this.vertexColors,t.skinning=this.skinning,t.morphTargets=this.morphTargets,t},e.MeshLambertMaterial=function(t){e.Material.call(this),this.color=new e.Color(16777215),this.ambient=new e.Color(16777215),this.emissive=new e.Color(0),this.wrapAround=!1,this.wrapRGB=new e.Vector3(1,1,1),this.envMap=this.specularMap=this.lightMap=this.map=null,this.combine=e.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=e.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=e.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(t)},e.MeshLambertMaterial.prototype=Object.create(e.Material.prototype),e.MeshLambertMaterial.prototype.clone=function(){var t=new e.MeshLambertMaterial;return e.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.ambient.copy(this.ambient),t.emissive.copy(this.emissive),t.wrapAround=this.wrapAround,t.wrapRGB.copy(this.wrapRGB),t.map=this.map,t.lightMap=this.lightMap,t.specularMap=this.specularMap,t.envMap=this.envMap,t.combine=this.combine,t.reflectivity=this.reflectivity,t.refractionRatio=this.refractionRatio,t.fog=this.fog,t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t.wireframeLinecap=this.wireframeLinecap,t.wireframeLinejoin=this.wireframeLinejoin,t.vertexColors=this.vertexColors,t.skinning=this.skinning,t.morphTargets=this.morphTargets,t.morphNormals=this.morphNormals,t},e.MeshPhongMaterial=function(t){e.Material.call(this),this.color=new e.Color(16777215),this.ambient=new e.Color(16777215),this.emissive=new e.Color(0),this.specular=new e.Color(1118481),this.shininess=30,this.metal=!1,this.perPixel=!0,this.wrapAround=!1,this.wrapRGB=new e.Vector3(1,1,1),this.bumpMap=this.lightMap=this.map=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new e.Vector2(1,1),this.envMap=this.specularMap=null,this.combine=e.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=e.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=e.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(t)},e.MeshPhongMaterial.prototype=Object.create(e.Material.prototype),e.MeshPhongMaterial.prototype.clone=function(){var t=new e.MeshPhongMaterial;return e.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.ambient.copy(this.ambient),t.emissive.copy(this.emissive),t.specular.copy(this.specular),t.shininess=this.shininess,t.metal=this.metal,t.perPixel=this.perPixel,t.wrapAround=this.wrapAround,t.wrapRGB.copy(this.wrapRGB),t.map=this.map,t.lightMap=this.lightMap,t.bumpMap=this.bumpMap,t.bumpScale=this.bumpScale,t.normalMap=this.normalMap,t.normalScale.copy(this.normalScale),t.specularMap=this.specularMap,t.envMap=this.envMap,t.combine=this.combine,t.reflectivity=this.reflectivity,t.refractionRatio=this.refractionRatio,t.fog=this.fog,t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t.wireframeLinecap=this.wireframeLinecap,t.wireframeLinejoin=this.wireframeLinejoin,t.vertexColors=this.vertexColors,t.skinning=this.skinning,t.morphTargets=this.morphTargets,t.morphNormals=this.morphNormals,t},e.MeshDepthMaterial=function(t){e.Material.call(this),this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)},e.MeshDepthMaterial.prototype=Object.create(e.Material.prototype),e.MeshDepthMaterial.prototype.clone=function(){var t=new e.MeshDepthMaterial;return e.Material.prototype.clone.call(this,t),t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t},e.MeshNormalMaterial=function(t){e.Material.call(this,t),this.shading=e.FlatShading,this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(t)},e.MeshNormalMaterial.prototype=Object.create(e.Material.prototype),e.MeshNormalMaterial.prototype.clone=function(){var t=new e.MeshNormalMaterial;return e.Material.prototype.clone.call(this,t),t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t},e.MeshFaceMaterial=function(e){this.materials=e instanceof Array?e:[]},e.MeshFaceMaterial.prototype.clone=function(){return new e.MeshFaceMaterial(this.materials.slice(0))},e.ParticleBasicMaterial=function(t){e.Material.call(this),this.color=new e.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=!1,this.fog=!0,this.setValues(t)},e.ParticleBasicMaterial.prototype=Object.create(e.Material.prototype),e.ParticleBasicMaterial.prototype.clone=function(){var t=new e.ParticleBasicMaterial;return e.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.map=this.map,t.size=this.size,t.sizeAttenuation=this.sizeAttenuation,t.vertexColors=this.vertexColors,t.fog=this.fog,t},e.ParticleCanvasMaterial=function(t){e.Material.call(this),this.color=new e.Color(16777215),this.program=function(){},this.setValues(t)},e.ParticleCanvasMaterial.prototype=Object.create(e.Material.prototype),e.ParticleCanvasMaterial.prototype.clone=function(){var t=new e.ParticleCanvasMaterial;return e.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.program=this.program,t},e.ShaderMaterial=function(t){e.Material.call(this),this.vertexShader=this.fragmentShader="void main() {}",this.uniforms={},this.defines={},this.attributes=null,this.shading=e.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.lights=this.fog=!1,this.vertexColors=e.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(t)},e.ShaderMaterial.prototype=Object.create(e.Material.prototype),e.ShaderMaterial.prototype.clone=function(){var t=new e.ShaderMaterial;return e.Material.prototype.clone.call(this,t),t.fragmentShader=this.fragmentShader,t.vertexShader=this.vertexShader,t.uniforms=e.UniformsUtils.clone(this.uniforms),t.attributes=this.attributes,t.defines=this.defines,t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t.fog=this.fog,t.lights=this.lights,t.vertexColors=this.vertexColors,t.skinning=this.skinning,t.morphTargets=this.morphTargets,t.morphNormals=this.morphNormals,t},e.SpriteMaterial=function(t){e.Material.call(this),this.color=new e.Color(16777215),this.map=new e.Texture,this.useScreenCoordinates=!0,this.depthTest=!this.useScreenCoordinates,this.sizeAttenuation=!this.useScreenCoordinates,this.scaleByViewport=!this.sizeAttenuation,this.alignment=e.SpriteAlignment.center.clone(),this.fog=!1,this.uvOffset=new e.Vector2(0,0),this.uvScale=new e.Vector2(1,1),this.setValues(t),t=t||{},void 0===t.depthTest&&(this.depthTest=!this.useScreenCoordinates),void 0===t.sizeAttenuation&&(this.sizeAttenuation=!this.useScreenCoordinates),void 0===t.scaleByViewport&&(this.scaleByViewport=!this.sizeAttenuation)},e.SpriteMaterial.prototype=Object.create(e.Material.prototype),e.SpriteMaterial.prototype.clone=function(){var t=new e.SpriteMaterial;return e.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.map=this.map,t.useScreenCoordinates=this.useScreenCoordinates,t.sizeAttenuation=this.sizeAttenuation,t.scaleByViewport=this.scaleByViewport,t.alignment.copy(this.alignment),t.uvOffset.copy(this.uvOffset),t.uvScale.copy(this.uvScale),t.fog=this.fog,t},e.SpriteAlignment={},e.SpriteAlignment.topLeft=new e.Vector2(1,-1),e.SpriteAlignment.topCenter=new e.Vector2(0,-1),e.SpriteAlignment.topRight=new e.Vector2(-1,-1),e.SpriteAlignment.centerLeft=new e.Vector2(1,0),e.SpriteAlignment.center=new e.Vector2(0,0),e.SpriteAlignment.centerRight=new e.Vector2(-1,0),e.SpriteAlignment.bottomLeft=new e.Vector2(1,1),e.SpriteAlignment.bottomCenter=new e.Vector2(0,1),e.SpriteAlignment.bottomRight=new e.Vector2(-1,1),e.Texture=function(t,i,n,r,o,a,s,l,u){this.id=e.TextureIdCount++,this.name="",this.image=t,this.mipmaps=[],this.mapping=void 0!==i?i:new e.UVMapping,this.wrapS=void 0!==n?n:e.ClampToEdgeWrapping,this.wrapT=void 0!==r?r:e.ClampToEdgeWrapping,this.magFilter=void 0!==o?o:e.LinearFilter,this.minFilter=void 0!==a?a:e.LinearMipMapLinearFilter,this.anisotropy=void 0!==u?u:1,this.format=void 0!==s?s:e.RGBAFormat,this.type=void 0!==l?l:e.UnsignedByteType,this.offset=new e.Vector2(0,0),this.repeat=new e.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.needsUpdate=!1,this.onUpdate=null},e.Texture.prototype={constructor:e.Texture,addEventListener:e.EventDispatcher.prototype.addEventListener,hasEventListener:e.EventDispatcher.prototype.hasEventListener,removeEventListener:e.EventDispatcher.prototype.removeEventListener,dispatchEvent:e.EventDispatcher.prototype.dispatchEvent,clone:function(t){return void 0===t&&(t=new e.Texture),t.image=this.image,t.mipmaps=this.mipmaps.slice(0),t.mapping=this.mapping,t.wrapS=this.wrapS,t.wrapT=this.wrapT,t.magFilter=this.magFilter,t.minFilter=this.minFilter,t.anisotropy=this.anisotropy,t.format=this.format,t.type=this.type,t.offset.copy(this.offset),t.repeat.copy(this.repeat),t.generateMipmaps=this.generateMipmaps,t.premultiplyAlpha=this.premultiplyAlpha,t.flipY=this.flipY,t.unpackAlignment=this.unpackAlignment,t},dispose:function(){this.dispatchEvent({type:"dispose"})}},e.TextureIdCount=0,e.CompressedTexture=function(t,i,n,r,o,a,s,l,u,c,h){e.Texture.call(this,null,a,s,l,u,c,r,o,h),this.image={width:i,height:n},this.mipmaps=t,this.generateMipmaps=!1},e.CompressedTexture.prototype=Object.create(e.Texture.prototype),e.CompressedTexture.prototype.clone=function(){var t=new e.CompressedTexture;return e.Texture.prototype.clone.call(this,t),t},e.DataTexture=function(t,i,n,r,o,a,s,l,u,c,h){e.Texture.call(this,null,a,s,l,u,c,r,o,h),this.image={data:t,width:i,height:n}},e.DataTexture.prototype=Object.create(e.Texture.prototype),e.DataTexture.prototype.clone=function(){var t=new e.DataTexture;return e.Texture.prototype.clone.call(this,t),t},e.Particle=function(t){e.Object3D.call(this),this.material=t},e.Particle.prototype=Object.create(e.Object3D.prototype),e.Particle.prototype.clone=function(t){return void 0===t&&(t=new e.Particle(this.material)),e.Object3D.prototype.clone.call(this,t),t},e.ParticleSystem=function(t,i){e.Object3D.call(this),this.geometry=t,this.material=void 0!==i?i:new e.ParticleBasicMaterial({color:16777215*Math.random()}),this.sortParticles=!1,this.geometry&&null===this.geometry.boundingSphere&&this.geometry.computeBoundingSphere(),this.frustumCulled=!1},e.ParticleSystem.prototype=Object.create(e.Object3D.prototype),e.ParticleSystem.prototype.clone=function(t){return void 0===t&&(t=new e.ParticleSystem(this.geometry,this.material)),t.sortParticles=this.sortParticles,e.Object3D.prototype.clone.call(this,t),t},e.Line=function(t,i,n){e.Object3D.call(this),this.geometry=t,this.material=void 0!==i?i:new e.LineBasicMaterial({color:16777215*Math.random()}),this.type=void 0!==n?n:e.LineStrip,this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere())},e.LineStrip=0,e.LinePieces=1,e.Line.prototype=Object.create(e.Object3D.prototype),e.Line.prototype.clone=function(t){return void 0===t&&(t=new e.Line(this.geometry,this.material,this.type)),e.Object3D.prototype.clone.call(this,t),t},e.Mesh=function(t,i){e.Object3D.call(this),this.material=this.geometry=null,this.setGeometry(t),this.setMaterial(i)},e.Mesh.prototype=Object.create(e.Object3D.prototype),e.Mesh.prototype.setGeometry=function(e){void 0!==e&&(this.geometry=e,null===this.geometry.boundingSphere&&this.geometry.computeBoundingSphere(),this.updateMorphTargets())},e.Mesh.prototype.setMaterial=function(t){this.material=void 0!==t?t:new e.MeshBasicMaterial({color:16777215*Math.random(),wireframe:!0})},e.Mesh.prototype.updateMorphTargets=function(){if(0<this.geometry.morphTargets.length){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;t>e;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},e.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},e.Mesh.prototype.clone=function(t){return void 0===t&&(t=new e.Mesh(this.geometry,this.material)),e.Object3D.prototype.clone.call(this,t),t},e.Bone=function(t){e.Object3D.call(this),this.skin=t,this.skinMatrix=new e.Matrix4},e.Bone.prototype=Object.create(e.Object3D.prototype),e.Bone.prototype.update=function(e,t){this.matrixAutoUpdate&&(t|=this.updateMatrix()),(t||this.matrixWorldNeedsUpdate)&&(e?this.skinMatrix.multiplyMatrices(e,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);var i,n=this.children.length;for(i=0;n>i;i++)this.children[i].update(this.skinMatrix,t)},e.SkinnedMesh=function(t,i,n){e.Mesh.call(this,t,i),this.useVertexTexture=void 0!==n?n:!0,this.identityMatrix=new e.Matrix4,this.bones=[],this.boneMatrices=[];var r,o,a;if(this.geometry&&void 0!==this.geometry.bones){for(t=0;t<this.geometry.bones.length;t++)n=this.geometry.bones[t],r=n.pos,o=n.rotq,a=n.scl,i=this.addBone(),i.name=n.name,i.position.set(r[0],r[1],r[2]),i.quaternion.set(o[0],o[1],o[2],o[3]),i.useQuaternion=!0,void 0!==a?i.scale.set(a[0],a[1],a[2]):i.scale.set(1,1,1);for(t=0;t<this.bones.length;t++)n=this.geometry.bones[t],i=this.bones[t],-1===n.parent?this.add(i):this.bones[n.parent].add(i);t=this.bones.length,this.useVertexTexture?(this.boneTextureHeight=this.boneTextureWidth=t=t>256?64:t>64?32:t>16?16:8,this.boneMatrices=new Float32Array(4*this.boneTextureWidth*this.boneTextureHeight),this.boneTexture=new e.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,e.RGBAFormat,e.FloatType),this.boneTexture.minFilter=e.NearestFilter,this.boneTexture.magFilter=e.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1):this.boneMatrices=new Float32Array(16*t),this.pose()}},e.SkinnedMesh.prototype=Object.create(e.Mesh.prototype),e.SkinnedMesh.prototype.addBone=function(t){return void 0===t&&(t=new e.Bone(this)),this.bones.push(t),t},e.SkinnedMesh.prototype.updateMatrixWorld=function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent?this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1);for(var t=0,i=this.children.length;i>t;t++){var n=this.children[t];n instanceof e.Bone?n.update(this.identityMatrix,!1):n.updateMatrixWorld(!0)}if(void 0==this.boneInverses)for(this.boneInverses=[],t=0,i=this.bones.length;i>t;t++)n=new e.Matrix4,n.getInverse(this.bones[t].skinMatrix),this.boneInverses.push(n);for(t=0,i=this.bones.length;i>t;t++)e.SkinnedMesh.offsetMatrix.multiplyMatrices(this.bones[t].skinMatrix,this.boneInverses[t]),e.SkinnedMesh.offsetMatrix.flattenToArrayOffset(this.boneMatrices,16*t);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)},e.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(!0);for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e],i=1/t.lengthManhattan();1/0!==i?t.multiplyScalar(i):t.set(1)}},e.SkinnedMesh.prototype.clone=function(t){return void 0===t&&(t=new e.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)),e.Mesh.prototype.clone.call(this,t),t},e.SkinnedMesh.offsetMatrix=new e.Matrix4,e.MorphAnimMesh=function(t,i){e.Mesh.call(this,t,i),this.duration=1e3,this.mirroredLoop=!1,this.currentKeyframe=this.lastKeyframe=this.time=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},e.MorphAnimMesh.prototype=Object.create(e.Mesh.prototype),e.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e,this.endKeyframe=t,this.length=this.endKeyframe-this.startKeyframe+1},e.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},e.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},e.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;e.animations||(e.animations={});for(var t,i=e.animations,n=/([a-z]+)(\d+)/,r=0,o=e.morphTargets.length;o>r;r++){var a=e.morphTargets[r].name.match(n);if(a&&1<a.length){a=a[1],i[a]||(i[a]={start:1/0,end:-1/0});var s=i[a];r<s.start&&(s.start=r),r>s.end&&(s.end=r),t||(t=a)}}e.firstAnimation=t},e.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,i){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[e]={start:t,end:i}},e.MorphAnimMesh.prototype.playAnimation=function(e,t){var i=this.geometry.animations[e];i?(this.setFrameRange(i.start,i.end),this.duration=1e3*((i.end-i.start)/t),this.time=0):console.warn("animation["+e+"] undefined")},e.MorphAnimMesh.prototype.updateAnimation=function(t){var i=this.duration/this.length;this.time+=this.direction*t,this.mirroredLoop?(this.time>this.duration||0>this.time)&&(this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),0>this.time&&(this.time=0,this.directionBackwards=!1)):(this.time%=this.duration,0>this.time&&(this.time+=this.duration)),t=this.startKeyframe+e.Math.clamp(Math.floor(this.time/i),0,this.length-1),t!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[t]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=t),i=this.time%i/i,this.directionBackwards&&(i=1-i),this.morphTargetInfluences[this.currentKeyframe]=i,this.morphTargetInfluences[this.lastKeyframe]=1-i},e.MorphAnimMesh.prototype.clone=function(t){return void 0===t&&(t=new e.MorphAnimMesh(this.geometry,this.material)),t.duration=this.duration,t.mirroredLoop=this.mirroredLoop,t.time=this.time,t.lastKeyframe=this.lastKeyframe,t.currentKeyframe=this.currentKeyframe,t.direction=this.direction,t.directionBackwards=this.directionBackwards,e.Mesh.prototype.clone.call(this,t),t},e.Ribbon=function(t,i){e.Object3D.call(this),this.geometry=t,this.material=i},e.Ribbon.prototype=Object.create(e.Object3D.prototype),e.Ribbon.prototype.clone=function(t){return void 0===t&&(t=new e.Ribbon(this.geometry,this.material)),e.Object3D.prototype.clone.call(this,t),t},e.LOD=function(){e.Object3D.call(this),this.objects=[]},e.LOD.prototype=Object.create(e.Object3D.prototype),e.LOD.prototype.addLevel=function(e,t){void 0===t&&(t=0);for(var t=Math.abs(t),i=0;i<this.objects.length&&!(t<this.objects[i].distance);i++);this.objects.splice(i,0,{distance:t,object:e}),this.add(e)},e.LOD.prototype.getObjectForDistance=function(e){for(var t=1,i=this.objects.length;i>t&&!(e<this.objects[t].distance);t++);return this.objects[t-1].object},e.LOD.prototype.update=function(){var t=new e.Vector3,i=new e.Vector3;return function(e){if(1<this.objects.length){t.getPositionFromMatrix(e.matrixWorld),i.getPositionFromMatrix(this.matrixWorld),e=t.distanceTo(i),this.objects[0].object.visible=!0;for(var n=1,r=this.objects.length;r>n&&e>=this.objects[n].distance;n++)this.objects[n-1].object.visible=!1,this.objects[n].object.visible=!0;for(;r>n;n++)this.objects[n].object.visible=!1}}}(),e.LOD.prototype.clone=function(){},e.Sprite=function(t){e.Object3D.call(this),this.material=void 0!==t?t:new e.SpriteMaterial,this.rotation3d=this.rotation,this.rotation=0},e.Sprite.prototype=Object.create(e.Object3D.prototype),e.Sprite.prototype.updateMatrix=function(){this.rotation3d.set(0,0,this.rotation),this.quaternion.setFromEuler(this.rotation3d,this.eulerOrder),this.matrix.makeFromPositionQuaternionScale(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},e.Sprite.prototype.clone=function(t){return void 0===t&&(t=new e.Sprite(this.material)),e.Object3D.prototype.clone.call(this,t),t},e.Scene=function(){e.Object3D.call(this),this.overrideMaterial=this.fog=null,this.autoUpdate=!0,this.matrixAutoUpdate=!1,this.__objects=[],this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},e.Scene.prototype=Object.create(e.Object3D.prototype),e.Scene.prototype.__addObject=function(t){if(t instanceof e.Light)-1===this.__lights.indexOf(t)&&this.__lights.push(t),t.target&&void 0===t.target.parent&&this.add(t.target);else if(!(t instanceof e.Camera||t instanceof e.Bone)&&-1===this.__objects.indexOf(t)){this.__objects.push(t),this.__objectsAdded.push(t);var i=this.__objectsRemoved.indexOf(t);-1!==i&&this.__objectsRemoved.splice(i,1)}for(i=0;i<t.children.length;i++)this.__addObject(t.children[i])},e.Scene.prototype.__removeObject=function(t){if(t instanceof e.Light){var i=this.__lights.indexOf(t);-1!==i&&this.__lights.splice(i,1)}else t instanceof e.Camera||(i=this.__objects.indexOf(t),-1!==i&&(this.__objects.splice(i,1),this.__objectsRemoved.push(t),i=this.__objectsAdded.indexOf(t),-1!==i&&this.__objectsAdded.splice(i,1)));for(i=0;i<t.children.length;i++)this.__removeObject(t.children[i])},e.Fog=function(t,i,n){this.name="",this.color=new e.Color(t),this.near=void 0!==i?i:1,this.far=void 0!==n?n:1e3},e.Fog.prototype.clone=function(){return new e.Fog(this.color.getHex(),this.near,this.far)},e.FogExp2=function(t,i){this.name="",this.color=new e.Color(t),this.density=void 0!==i?i:25e-5},e.FogExp2.prototype.clone=function(){return new e.FogExp2(this.color.getHex(),this.density)},e.CanvasRenderer=function(t){function i(e){it!==e&&(it=J.globalAlpha=e)}function n(t){nt!==t&&(t===e.NormalBlending?J.globalCompositeOperation="source-over":t===e.AdditiveBlending?J.globalCompositeOperation="lighter":t===e.SubtractiveBlending&&(J.globalCompositeOperation="darker"),nt=t)}function r(e){at!==e&&(at=J.lineWidth=e)}function o(e){st!==e&&(st=J.lineCap=e)}function a(e){lt!==e&&(lt=J.lineJoin=e)}function s(e){rt!==e&&(rt=J.strokeStyle=e)}function l(e){ot!==e&&(ot=J.fillStyle=e)}function u(e,t){(ut!==e||ct!==t)&&(J.setLineDash([e,t]),ut=e,ct=t)}console.log("THREE.CanvasRenderer",e.REVISION);var c,h,f,p,d,m,g,v,y,b,x,w,_,S,M,C,A,T,E,k,P,R,L,D,N,F,G,O,j,I,V,U,B,z,q,H,W,X,Y,K=e.Math.smoothstep,t=t||{},$=this,Q=new e.Projector,Z=void 0!==t.canvas?t.canvas:document.createElement("canvas"),J=Z.getContext("2d"),et=new e.Color(0),tt=0,it=1,nt=0,rt=null,ot=null,at=null,st=null,lt=null,ut=null,ct=0,ht=new e.RenderableVertex,ft=new e.RenderableVertex,pt=new e.Color,dt=new e.Color,mt=new e.Color,gt=new e.Color,vt=new e.Color,yt=new e.Color,bt=new e.Color,xt=new e.Color,wt={},_t={},St=new e.Box2,Mt=new e.Box2,Ct=new e.Box2,At=new e.Color,Tt=new e.Color,Et=new e.Color,kt=new e.Vector3,Pt=16;z=document.createElement("canvas"),z.width=z.height=2,q=z.getContext("2d"),q.fillStyle="rgba(0,0,0,1)",q.fillRect(0,0,2,2),H=q.getImageData(0,0,2,2),W=H.data,X=document.createElement("canvas"),X.width=X.height=Pt,Y=X.getContext("2d"),Y.translate(-Pt/2,-Pt/2),Y.scale(Pt,Pt),Pt--,void 0===J.setLineDash&&(J.setLineDash=void 0!==J.mozDash?function(e){J.mozDash=null!==e[0]?e:null}:function(){}),this.domElement=Z,this.devicePixelRatio=void 0!==t.devicePixelRatio?t.devicePixelRatio:void 0!==window.devicePixelRatio?window.devicePixelRatio:1,this.sortElements=this.sortObjects=this.autoClear=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.setSize=function(t,i,n){p=t*this.devicePixelRatio,d=i*this.devicePixelRatio,m=Math.floor(p/2),g=Math.floor(d/2),Z.width=p,Z.height=d,1!==this.devicePixelRatio&&!1!==n&&(Z.style.width=t+"px",Z.style.height=i+"px"),St.set(new e.Vector2(-m,-g),new e.Vector2(m,g)),Mt.set(new e.Vector2(-m,-g),new e.Vector2(m,g)),it=1,nt=0,lt=st=at=ot=rt=null},this.setClearColor=function(t,i){et.set(t),tt=void 0!==i?i:1,Mt.set(new e.Vector2(-m,-g),new e.Vector2(m,g))},this.setClearColorHex=function(e,t){console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getMaxAnisotropy=function(){return 0},this.clear=function(){J.setTransform(1,0,0,-1,m,g),!1===Mt.empty()&&(Mt.intersect(St),Mt.expandByScalar(2),1>tt&&J.clearRect(0|Mt.min.x,0|Mt.min.y,Mt.max.x-Mt.min.x|0,Mt.max.y-Mt.min.y|0),tt>0&&(n(e.NormalBlending),i(1),l("rgba("+Math.floor(255*et.r)+","+Math.floor(255*et.g)+","+Math.floor(255*et.b)+","+tt+")"),J.fillRect(0|Mt.min.x,0|Mt.min.y,Mt.max.x-Mt.min.x|0,Mt.max.y-Mt.min.y|0)),Mt.makeEmpty())},this.render=function(t,p){function d(t,i,n){for(var r=0,o=f.length;o>r;r++){var a=f[r];if(xt.copy(a.color),a instanceof e.DirectionalLight){var s=kt.getPositionFromMatrix(a.matrixWorld).normalize(),l=i.dot(s);0>=l||(l*=a.intensity,n.add(xt.multiplyScalar(l)))}else a instanceof e.PointLight&&(s=kt.getPositionFromMatrix(a.matrixWorld),l=i.dot(kt.subVectors(s,t).normalize()),0>=l||(l*=0==a.distance?1:1-Math.min(t.distanceTo(s)/a.distance,1),0!=l&&(l*=a.intensity,n.add(xt.multiplyScalar(l)))))}}function Z(t,r,o,a,s,l,u,c){$.info.render.vertices+=3,$.info.render.faces++,i(c.opacity),n(c.blending),w=t.positionScreen.x,_=t.positionScreen.y,S=r.positionScreen.x,M=r.positionScreen.y,C=o.positionScreen.x,A=o.positionScreen.y,et(w,_,S,M,C,A),(c instanceof e.MeshLambertMaterial||c instanceof e.MeshPhongMaterial)&&null===c.map?(yt.copy(c.color),bt.copy(c.emissive),c.vertexColors===e.FaceColors&&yt.multiply(u.color),!1===c.wireframe&&c.shading==e.SmoothShading&&3==u.vertexNormalsLength?(dt.copy(At),mt.copy(At),gt.copy(At),d(u.v1.positionWorld,u.vertexNormalsModel[0],dt),d(u.v2.positionWorld,u.vertexNormalsModel[1],mt),d(u.v3.positionWorld,u.vertexNormalsModel[2],gt),dt.multiply(yt).add(bt),mt.multiply(yt).add(bt),gt.multiply(yt).add(bt),vt.addColors(mt,gt).multiplyScalar(.5),F=at(dt,mt,gt,vt),ot(w,_,S,M,C,A,0,0,1,0,0,1,F)):(pt.copy(At),d(u.centroidModel,u.normalModel,pt),pt.multiply(yt).add(bt),!0===c.wireframe?it(pt,c.wireframeLinewidth,c.wireframeLinecap,c.wireframeLinejoin):nt(pt))):c instanceof e.MeshBasicMaterial||c instanceof e.MeshLambertMaterial||c instanceof e.MeshPhongMaterial?null!==c.map?c.map.mapping instanceof e.UVMapping&&(G=u.uvs[0],rt(w,_,S,M,C,A,G[a].x,G[a].y,G[s].x,G[s].y,G[l].x,G[l].y,c.map)):null!==c.envMap?c.envMap.mapping instanceof e.SphericalReflectionMapping&&(kt.copy(u.vertexNormalsModelView[a]),O=.5*kt.x+.5,j=.5*kt.y+.5,kt.copy(u.vertexNormalsModelView[s]),I=.5*kt.x+.5,V=.5*kt.y+.5,kt.copy(u.vertexNormalsModelView[l]),U=.5*kt.x+.5,B=.5*kt.y+.5,rt(w,_,S,M,C,A,O,j,I,V,U,B,c.envMap)):(pt.copy(c.color),c.vertexColors===e.FaceColors&&pt.multiply(u.color),!0===c.wireframe?it(pt,c.wireframeLinewidth,c.wireframeLinecap,c.wireframeLinejoin):nt(pt)):c instanceof e.MeshDepthMaterial?(D=p.near,N=p.far,dt.r=dt.g=dt.b=1-K(t.positionScreen.z*t.positionScreen.w,D,N),mt.r=mt.g=mt.b=1-K(r.positionScreen.z*r.positionScreen.w,D,N),gt.r=gt.g=gt.b=1-K(o.positionScreen.z*o.positionScreen.w,D,N),vt.addColors(mt,gt).multiplyScalar(.5),F=at(dt,mt,gt,vt),ot(w,_,S,M,C,A,0,0,1,0,0,1,F)):c instanceof e.MeshNormalMaterial&&(c.shading==e.FlatShading?(t=u.normalModelView,pt.setRGB(t.x,t.y,t.z).multiplyScalar(.5).addScalar(.5),!0===c.wireframe?it(pt,c.wireframeLinewidth,c.wireframeLinecap,c.wireframeLinejoin):nt(pt)):c.shading==e.SmoothShading&&(t=u.vertexNormalsModelView[a],dt.setRGB(t.x,t.y,t.z).multiplyScalar(.5).addScalar(.5),t=u.vertexNormalsModelView[s],mt.setRGB(t.x,t.y,t.z).multiplyScalar(.5).addScalar(.5),t=u.vertexNormalsModelView[l],gt.setRGB(t.x,t.y,t.z).multiplyScalar(.5).addScalar(.5),vt.addColors(mt,gt).multiplyScalar(.5),F=at(dt,mt,gt,vt),ot(w,_,S,M,C,A,0,0,1,0,0,1,F)))}function et(e,t,i,n,r,o){J.beginPath(),J.moveTo(e,t),J.lineTo(i,n),J.lineTo(r,o),J.closePath()}function tt(e,t,i,n,r,o,a,s){J.beginPath(),J.moveTo(e,t),J.lineTo(i,n),J.lineTo(r,o),J.lineTo(a,s),J.closePath()}function it(e,t,i,n){r(t),o(i),a(n),s(e.getStyle()),J.stroke(),Ct.expandByScalar(2*t)}function nt(e){l(e.getStyle()),J.fill()}function rt(t,i,n,r,o,a,s,u,c,h,f,p,d){if(!(d instanceof e.DataTexture||void 0===d.image||0==d.image.width)){if(!0===d.needsUpdate){var m=d.wrapS==e.RepeatWrapping,g=d.wrapT==e.RepeatWrapping;
wt[d.id]=J.createPattern(d.image,!0===m&&!0===g?"repeat":!0===m&&!1===g?"repeat-x":!1===m&&!0===g?"repeat-y":"no-repeat"),d.needsUpdate=!1}l(void 0===wt[d.id]?"rgba(0,0,0,1)":wt[d.id]);var m=d.offset.x/d.repeat.x,g=d.offset.y/d.repeat.y,v=d.image.width*d.repeat.x,y=d.image.height*d.repeat.y,s=(s+m)*v,u=(1-u+g)*y,n=n-t,r=r-i,o=o-t,a=a-i,c=(c+m)*v-s,h=(1-h+g)*y-u,f=(f+m)*v-s,p=(1-p+g)*y-u,m=c*p-f*h;0===m?(void 0===_t[d.id]&&(i=document.createElement("canvas"),i.width=d.image.width,i.height=d.image.height,i=i.getContext("2d"),i.drawImage(d.image,0,0),_t[d.id]=i.getImageData(0,0,d.image.width,d.image.height).data),i=_t[d.id],s=4*(Math.floor(s)+Math.floor(u)*d.image.width),pt.setRGB(i[s]/255,i[s+1]/255,i[s+2]/255),nt(pt)):(m=1/m,d=(p*n-h*o)*m,h=(p*r-h*a)*m,n=(c*o-f*n)*m,r=(c*a-f*r)*m,t=t-d*s-n*u,s=i-h*s-r*u,J.save(),J.transform(d,h,n,r,t,s),J.fill(),J.restore())}}function ot(e,t,i,n,r,o,a,s,l,u,c,h,f){var p,d;p=f.width-1,d=f.height-1,a*=p,s*=d,i-=e,n-=t,r-=e,o-=t,l=l*p-a,u=u*d-s,c=c*p-a,h=h*d-s,d=1/(l*h-c*u),p=(h*i-u*r)*d,u=(h*n-u*o)*d,i=(l*r-c*i)*d,n=(l*o-c*n)*d,e=e-p*a-i*s,t=t-u*a-n*s,J.save(),J.transform(p,u,i,n,e,t),J.clip(),J.drawImage(f,0,0),J.restore()}function at(e,t,i,n){return W[0]=255*e.r|0,W[1]=255*e.g|0,W[2]=255*e.b|0,W[4]=255*t.r|0,W[5]=255*t.g|0,W[6]=255*t.b|0,W[8]=255*i.r|0,W[9]=255*i.g|0,W[10]=255*i.b|0,W[12]=255*n.r|0,W[13]=255*n.g|0,W[14]=255*n.b|0,q.putImageData(H,0,0),Y.drawImage(z,0,0),X}function st(e,t){var i=t.x-e.x,n=t.y-e.y,r=i*i+n*n;0!==r&&(r=1/Math.sqrt(r),i*=r,n*=r,t.x+=i,t.y+=n,e.x-=i,e.y-=n)}if(!1==p instanceof e.Camera)console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");else{!0===this.autoClear&&this.clear(),J.setTransform(1,0,0,-1,m,g),$.info.render.vertices=0,$.info.render.faces=0,c=Q.projectScene(t,p,this.sortObjects,this.sortElements),h=c.elements,f=c.lights,At.setRGB(0,0,0),Tt.setRGB(0,0,0),Et.setRGB(0,0,0);for(var lt=0,ut=f.length;ut>lt;lt++){var ct=f[lt],Pt=ct.color;ct instanceof e.AmbientLight?At.add(Pt):ct instanceof e.DirectionalLight?Tt.add(Pt):ct instanceof e.PointLight&&Et.add(Pt)}for(lt=0,ut=h.length;ut>lt;lt++){var Rt=h[lt],ct=Rt.material;if(void 0!==ct&&!1!==ct.visible){if(Ct.makeEmpty(),Rt instanceof e.RenderableParticle){v=Rt,v.x*=m,v.y*=g,Pt=v,i(ct.opacity),n(ct.blending);var Lt=void 0,Dt=void 0,Nt=void 0,Ft=void 0,Gt=void 0,Ot=void 0,jt=void 0;ct instanceof e.ParticleBasicMaterial?null===ct.map?(Nt=Rt.object.scale.x,Ft=Rt.object.scale.y,Nt*=Rt.scale.x*m,Ft*=Rt.scale.y*g,Ct.min.set(Pt.x-Nt,Pt.y-Ft),Ct.max.set(Pt.x+Nt,Pt.y+Ft),!1===St.isIntersectionBox(Ct)?Ct.makeEmpty():(l(ct.color.getStyle()),J.save(),J.translate(Pt.x,Pt.y),J.rotate(-Rt.rotation),J.scale(Nt,Ft),J.fillRect(-1,-1,2,2),J.restore())):(Gt=ct.map.image,Ot=Gt.width>>1,jt=Gt.height>>1,Nt=Rt.scale.x*m,Ft=Rt.scale.y*g,Lt=Nt*Ot,Dt=Ft*jt,Ct.min.set(Pt.x-Lt,Pt.y-Dt),Ct.max.set(Pt.x+Lt,Pt.y+Dt),!1===St.isIntersectionBox(Ct)?Ct.makeEmpty():(J.save(),J.translate(Pt.x,Pt.y),J.rotate(-Rt.rotation),J.scale(Nt,-Ft),J.translate(-Ot,-jt),J.drawImage(Gt,0,0),J.restore())):ct instanceof e.ParticleCanvasMaterial&&(Lt=Rt.scale.x*m,Dt=Rt.scale.y*g,Ct.min.set(Pt.x-Lt,Pt.y-Dt),Ct.max.set(Pt.x+Lt,Pt.y+Dt),!1===St.isIntersectionBox(Ct)?Ct.makeEmpty():(s(ct.color.getStyle()),l(ct.color.getStyle()),J.save(),J.translate(Pt.x,Pt.y),J.rotate(-Rt.rotation),J.scale(Lt,Dt),ct.program(J),J.restore()))}else if(Rt instanceof e.RenderableLine){if(v=Rt.v1,y=Rt.v2,v.positionScreen.x*=m,v.positionScreen.y*=g,y.positionScreen.x*=m,y.positionScreen.y*=g,Ct.setFromPoints([v.positionScreen,y.positionScreen]),!0===St.isIntersectionBox(Ct))if(Pt=v,Lt=y,i(ct.opacity),n(ct.blending),J.beginPath(),J.moveTo(Pt.positionScreen.x,Pt.positionScreen.y),J.lineTo(Lt.positionScreen.x,Lt.positionScreen.y),ct instanceof e.LineBasicMaterial){if(r(ct.linewidth),o(ct.linecap),a(ct.linejoin),ct.vertexColors!==e.VertexColors)s(ct.color.getStyle());else if(Dt=Rt.vertexColors[0].getStyle(),Rt=Rt.vertexColors[1].getStyle(),Dt===Rt)s(Dt);else{try{var It=J.createLinearGradient(Pt.positionScreen.x,Pt.positionScreen.y,Lt.positionScreen.x,Lt.positionScreen.y);It.addColorStop(0,Dt),It.addColorStop(1,Rt)}catch(Vt){It=Dt}s(It)}J.stroke(),Ct.expandByScalar(2*ct.linewidth)}else ct instanceof e.LineDashedMaterial&&(r(ct.linewidth),o(ct.linecap),a(ct.linejoin),s(ct.color.getStyle()),u(ct.dashSize,ct.gapSize),J.stroke(),Ct.expandByScalar(2*ct.linewidth),u(null,null))}else if(Rt instanceof e.RenderableFace3){if(v=Rt.v1,y=Rt.v2,b=Rt.v3,-1>v.positionScreen.z||1<v.positionScreen.z)continue;if(-1>y.positionScreen.z||1<y.positionScreen.z)continue;if(-1>b.positionScreen.z||1<b.positionScreen.z)continue;v.positionScreen.x*=m,v.positionScreen.y*=g,y.positionScreen.x*=m,y.positionScreen.y*=g,b.positionScreen.x*=m,b.positionScreen.y*=g,!0===ct.overdraw&&(st(v.positionScreen,y.positionScreen),st(y.positionScreen,b.positionScreen),st(b.positionScreen,v.positionScreen)),Ct.setFromPoints([v.positionScreen,y.positionScreen,b.positionScreen]),!0===St.isIntersectionBox(Ct)&&Z(v,y,b,0,1,2,Rt,ct)}else if(Rt instanceof e.RenderableFace4){if(v=Rt.v1,y=Rt.v2,b=Rt.v3,x=Rt.v4,-1>v.positionScreen.z||1<v.positionScreen.z)continue;if(-1>y.positionScreen.z||1<y.positionScreen.z)continue;if(-1>b.positionScreen.z||1<b.positionScreen.z)continue;if(-1>x.positionScreen.z||1<x.positionScreen.z)continue;v.positionScreen.x*=m,v.positionScreen.y*=g,y.positionScreen.x*=m,y.positionScreen.y*=g,b.positionScreen.x*=m,b.positionScreen.y*=g,x.positionScreen.x*=m,x.positionScreen.y*=g,ht.positionScreen.copy(y.positionScreen),ft.positionScreen.copy(x.positionScreen),!0===ct.overdraw&&(st(v.positionScreen,y.positionScreen),st(y.positionScreen,x.positionScreen),st(x.positionScreen,v.positionScreen),st(b.positionScreen,ht.positionScreen),st(b.positionScreen,ft.positionScreen)),Ct.setFromPoints([v.positionScreen,y.positionScreen,b.positionScreen,x.positionScreen]),!0===St.isIntersectionBox(Ct)&&(Pt=v,Lt=y,Dt=b,Nt=x,Ft=ht,Gt=ft,$.info.render.vertices+=4,$.info.render.faces++,i(ct.opacity),n(ct.blending),void 0!==ct.map&&null!==ct.map||void 0!==ct.envMap&&null!==ct.envMap?(Z(Pt,Lt,Nt,0,1,3,Rt,ct),Z(Ft,Dt,Gt,1,2,3,Rt,ct)):(w=Pt.positionScreen.x,_=Pt.positionScreen.y,S=Lt.positionScreen.x,M=Lt.positionScreen.y,C=Dt.positionScreen.x,A=Dt.positionScreen.y,T=Nt.positionScreen.x,E=Nt.positionScreen.y,k=Ft.positionScreen.x,P=Ft.positionScreen.y,R=Gt.positionScreen.x,L=Gt.positionScreen.y,ct instanceof e.MeshLambertMaterial||ct instanceof e.MeshPhongMaterial?(yt.copy(ct.color),bt.copy(ct.emissive),ct.vertexColors===e.FaceColors&&yt.multiply(Rt.color),!1===ct.wireframe&&ct.shading==e.SmoothShading&&4==Rt.vertexNormalsLength?(dt.copy(At),mt.copy(At),gt.copy(At),vt.copy(At),d(Rt.v1.positionWorld,Rt.vertexNormalsModel[0],dt),d(Rt.v2.positionWorld,Rt.vertexNormalsModel[1],mt),d(Rt.v4.positionWorld,Rt.vertexNormalsModel[3],gt),d(Rt.v3.positionWorld,Rt.vertexNormalsModel[2],vt),dt.multiply(yt).add(bt),mt.multiply(yt).add(bt),gt.multiply(yt).add(bt),vt.multiply(yt).add(bt),F=at(dt,mt,gt,vt),et(w,_,S,M,T,E),ot(w,_,S,M,T,E,0,0,1,0,0,1,F),et(k,P,C,A,R,L),ot(k,P,C,A,R,L,1,0,1,1,0,1,F)):(pt.copy(At),d(Rt.centroidModel,Rt.normalModel,pt),pt.multiply(yt).add(bt),tt(w,_,S,M,C,A,T,E),!0===ct.wireframe?it(pt,ct.wireframeLinewidth,ct.wireframeLinecap,ct.wireframeLinejoin):nt(pt))):ct instanceof e.MeshBasicMaterial?(pt.copy(ct.color),ct.vertexColors===e.FaceColors&&pt.multiply(Rt.color),tt(w,_,S,M,C,A,T,E),!0===ct.wireframe?it(pt,ct.wireframeLinewidth,ct.wireframeLinecap,ct.wireframeLinejoin):nt(pt)):ct instanceof e.MeshNormalMaterial?(Pt=void 0,ct.shading==e.FlatShading?(Pt=Rt.normalModelView,pt.setRGB(Pt.x,Pt.y,Pt.z).multiplyScalar(.5).addScalar(.5),tt(w,_,S,M,C,A,T,E),!0===ct.wireframe?it(pt,ct.wireframeLinewidth,ct.wireframeLinecap,ct.wireframeLinejoin):nt(pt)):ct.shading==e.SmoothShading&&(Pt=Rt.vertexNormalsModelView[0],dt.setRGB(Pt.x,Pt.y,Pt.z).multiplyScalar(.5).addScalar(.5),Pt=Rt.vertexNormalsModelView[1],mt.setRGB(Pt.x,Pt.y,Pt.z).multiplyScalar(.5).addScalar(.5),Pt=Rt.vertexNormalsModelView[3],gt.setRGB(Pt.x,Pt.y,Pt.z).multiplyScalar(.5).addScalar(.5),Pt=Rt.vertexNormalsModelView[2],vt.setRGB(Pt.x,Pt.y,Pt.z).multiplyScalar(.5).addScalar(.5),F=at(dt,mt,gt,vt),et(w,_,S,M,T,E),ot(w,_,S,M,T,E,0,0,1,0,0,1,F),et(k,P,C,A,R,L),ot(k,P,C,A,R,L,1,0,1,1,0,1,F))):ct instanceof e.MeshDepthMaterial&&(D=p.near,N=p.far,dt.r=dt.g=dt.b=1-K(Pt.positionScreen.z*Pt.positionScreen.w,D,N),mt.r=mt.g=mt.b=1-K(Lt.positionScreen.z*Lt.positionScreen.w,D,N),gt.r=gt.g=gt.b=1-K(Nt.positionScreen.z*Nt.positionScreen.w,D,N),vt.r=vt.g=vt.b=1-K(Dt.positionScreen.z*Dt.positionScreen.w,D,N),F=at(dt,mt,gt,vt),et(w,_,S,M,T,E),ot(w,_,S,M,T,E,0,0,1,0,0,1,F),et(k,P,C,A,R,L),ot(k,P,C,A,R,L,1,0,1,1,0,1,F))))}Mt.union(Ct)}}J.setTransform(1,0,0,1,0,0)}}},e.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform float flipEnvMap;\nuniform int combine;\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nuniform bool useRefract;\nuniform float refractionRatio;\n#else\nvarying vec3 vReflect;\n#endif\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\nvec3 reflectVec;\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\nif ( useRefract ) {\nreflectVec = refract( cameraToVertex, normal, refractionRatio );\n} else { \nreflectVec = reflect( cameraToVertex, normal );\n}\n#else\nreflectVec = vReflect;\n#endif\n#ifdef DOUBLE_SIDED\nfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\nvec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n#else\nvec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n#endif\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\nif ( combine == 1 ) {\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );\n} else if ( combine == 2 ) {\ngl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;\n} else {\ngl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );\n}\n#endif",envmap_pars_vertex:"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n#ifdef USE_SKINNING\nvec4 worldPosition = modelMatrix * skinned;\n#endif\n#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\nvec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\n#endif\n#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\nvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n#endif\n#endif",envmap_vertex:"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\nvec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;\nworldNormal = normalize( worldNormal );\nvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\nif ( useRefract ) {\nvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n} else {\nvReflect = reflect( cameraToVertex, worldNormal );\n}\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );\n#endif",map_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\nvarying vec2 vUv;\nuniform vec4 offsetRepeat;\n#endif",map_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\nvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\nvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",map_fragment:"#ifdef USE_MAP\nvec4 texelColor = texture2D( map, vUv );\n#ifdef GAMMA_INPUT\ntexelColor.xyz *= texelColor.xyz;\n#endif\ngl_FragColor = gl_FragColor * texelColor;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\nuniform sampler2D bumpMap;\nuniform float bumpScale;\nvec2 dHdxy_fwd() {\nvec2 dSTdx = dFdx( vUv );\nvec2 dSTdy = dFdy( vUv );\nfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\nfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\nfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\nreturn vec2( dBx, dBy );\n}\nvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\nvec3 vSigmaX = dFdx( surf_pos );\nvec3 vSigmaY = dFdy( surf_pos );\nvec3 vN = surf_norm;\nvec3 R1 = cross( vSigmaY, vN );\nvec3 R2 = cross( vN, vSigmaX );\nfloat fDet = dot( vSigmaX, R1 );\nvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\nreturn normalize( abs( fDet ) * surf_norm - vGrad );\n}\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\nuniform sampler2D normalMap;\nuniform vec2 normalScale;\nvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\nvec3 q0 = dFdx( eye_pos.xyz );\nvec3 q1 = dFdy( eye_pos.xyz );\nvec2 st0 = dFdx( vUv.st );\nvec2 st1 = dFdy( vUv.st );\nvec3 S = normalize(  q0 * st1.t - q1 * st0.t );\nvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\nvec3 N = normalize( surf_norm );\nvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\nmapN.xy = normalScale * mapN.xy;\nmat3 tsn = mat3( S, T, N );\nreturn normalize( tsn * mapN );\n}\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\nuniform sampler2D specularMap;\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\nvec4 texelSpecular = texture2D( specularMap, vUv );\nspecularStrength = texelSpecular.r;\n#else\nspecularStrength = 1.0;\n#endif",lights_lambert_pars_vertex:"uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\nuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif",lights_lambert_vertex:"vLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\nvLightBack = vec3( 0.0 );\n#endif\ntransformedNormal = normalize( transformedNormal );\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( transformedNormal, dirVector );\nvec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\ndirectionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\ndirectionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n#ifdef DOUBLE_SIDED\nvLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n#endif\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat dotProduct = dot( transformedNormal, lVector );\nvec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\npointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\npointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;\n#ifdef DOUBLE_SIDED\nvLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\nif ( spotEffect > spotLightAngleCos[ i ] ) {\nspotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat dotProduct = dot( transformedNormal, lVector );\nvec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\nspotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\nspotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;\n#ifdef DOUBLE_SIDED\nvLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;\n#endif\n}\n}\n#endif\n#if MAX_HEMI_LIGHTS > 0\nfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\nvec3 lVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( transformedNormal, lVector );\nfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\nfloat hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\nvLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n#ifdef DOUBLE_SIDED\nvLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n#endif\n}\n#endif\nvLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;\n#ifdef DOUBLE_SIDED\nvLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;\n#endif",lights_phong_pars_vertex:"#ifndef PHONG_PER_PIXEL\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\nvarying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )\nvarying vec3 vWorldPosition;\n#endif",lights_phong_vertex:"#ifndef PHONG_PER_PIXEL\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nvSpotLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )\nvWorldPosition = worldPosition.xyz;\n#endif",lights_phong_pars_fragment:"uniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\nuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#else\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#else\nvarying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )\nvarying vec3 vWorldPosition;\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_phong_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#ifdef DOUBLE_SIDED\nnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n#endif\n#ifdef USE_NORMALMAP\nnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\nnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse  = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vPointLight[ i ].xyz );\nfloat lDistance = vPointLight[ i ].w;\n#endif\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n#else\nfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n#endif\npointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\nvec3 pointHalfVector = normalize( lVector + viewPosition );\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n#else\npointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvec3 spotDiffuse  = vec3( 0.0 );\nvec3 spotSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vSpotLight[ i ].xyz );\nfloat lDistance = vSpotLight[ i ].w;\n#endif\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\nif ( spotEffect > spotLightAngleCos[ i ] ) {\nspotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n#else\nfloat spotDiffuseWeight = max( dotProduct, 0.0 );\n#endif\nspotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;\nvec3 spotHalfVector = normalize( lVector + viewPosition );\nfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\nfloat spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );\nspotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n#else\nspotSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;\n#endif\n}\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse  = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( normal, dirVector );\n#ifdef WRAP_AROUND\nfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n#else\nfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n#endif\ndirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\nvec3 dirHalfVector = normalize( dirVector + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n#else\ndirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;\n#endif\n}\n#endif\n#if MAX_HEMI_LIGHTS > 0\nvec3 hemiDiffuse  = vec3( 0.0 );\nvec3 hemiSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\nvec3 lVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( normal, lVector );\nfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\nvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\nhemiDiffuse += diffuse * hemiColor;\nvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\nfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\nfloat hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );\nvec3 lVectorGround = -lVector;\nvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\nfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\nfloat hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat dotProductGround = dot( normal, lVectorGround );\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );\nvec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );\nhemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n#else\nhemiSpecular += specular * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;\n#endif\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_HEMI_LIGHTS > 0\ntotalDiffuse += hemiDiffuse;\ntotalSpecular += hemiSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\n#if MAX_SPOT_LIGHTS > 0\ntotalDiffuse += spotDiffuse;\ntotalSpecular += spotSpecular;\n#endif\n#ifdef METAL\ngl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n#ifdef GAMMA_INPUT\nvColor = color * color;\n#else\nvColor = color;\n#endif\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n#ifdef BONE_TEXTURE\nuniform sampler2D boneTexture;\nmat4 getBoneMatrix( const in float i ) {\nfloat j = i * 4.0;\nfloat x = mod( j, N_BONE_PIXEL_X );\nfloat y = floor( j / N_BONE_PIXEL_X );\nconst float dx = 1.0 / N_BONE_PIXEL_X;\nconst float dy = 1.0 / N_BONE_PIXEL_Y;\ny = dy * ( y + 0.5 );\nvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\nvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\nvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\nvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\nmat4 bone = mat4( v1, v2, v3, v4 );\nreturn bone;\n}\n#else\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\nmat4 getBoneMatrix( const in float i ) {\nmat4 bone = boneGlobalMatrices[ int(i) ];\nreturn bone;\n}\n#endif\n#endif",skinbase_vertex:"#ifdef USE_SKINNING\nmat4 boneMatX = getBoneMatrix( skinIndex.x );\nmat4 boneMatY = getBoneMatrix( skinIndex.y );\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n#ifdef USE_MORPHTARGETS\nvec4 skinVertex = vec4( morphed, 1.0 );\n#else\nvec4 skinVertex = vec4( position, 1.0 );\n#endif\nvec4 skinned  = boneMatX * skinVertex * skinWeight.x;\nskinned 	  += boneMatY * skinVertex * skinWeight.y;\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n#ifndef USE_MORPHNORMALS\nuniform float morphTargetInfluences[ 8 ];\n#else\nuniform float morphTargetInfluences[ 4 ];\n#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n#ifndef USE_MORPHNORMALS\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n#endif\nmorphed += position;\n#endif",default_vertex:"vec4 mvPosition;\n#ifdef USE_SKINNING\nmvPosition = modelViewMatrix * skinned;\n#endif\n#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )\nmvPosition = modelViewMatrix * vec4( morphed, 1.0 );\n#endif\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )\nmvPosition = modelViewMatrix * vec4( position, 1.0 );\n#endif\ngl_Position = projectionMatrix * mvPosition;",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\nvec3 morphedNormal = vec3( 0.0 );\nmorphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\nmorphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\nmorphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\nmorphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\nmorphedNormal += normal;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\nmat4 skinMatrix = skinWeight.x * boneMatX;\nskinMatrix 	+= skinWeight.y * boneMatY;\n#ifdef USE_MORPHNORMALS\nvec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\n#else\nvec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\n#endif\n#endif",defaultnormal_vertex:"vec3 objectNormal;\n#ifdef USE_SKINNING\nobjectNormal = skinnedNormal.xyz;\n#endif\n#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )\nobjectNormal = morphedNormal;\n#endif\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )\nobjectNormal = normal;\n#endif\n#ifdef FLIP_SIDED\nobjectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\nuniform sampler2D shadowMap[ MAX_SHADOWS ];\nuniform vec2 shadowMapSize[ MAX_SHADOWS ];\nuniform float shadowDarkness[ MAX_SHADOWS ];\nuniform float shadowBias[ MAX_SHADOWS ];\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\nfloat depth = dot( rgba_depth, bit_shift );\nreturn depth;\n}\n#endif",shadowmap_fragment:"#ifdef USE_SHADOWMAP\n#ifdef SHADOWMAP_DEBUG\nvec3 frustumColors[3];\nfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\nfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\nfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n#endif\n#ifdef SHADOWMAP_CASCADE\nint inFrustumCount = 0;\n#endif\nfloat fDepth;\nvec3 shadowColor = vec3( 1.0 );\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\nbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\nbool inFrustum = all( inFrustumVec );\n#ifdef SHADOWMAP_CASCADE\ninFrustumCount += int( inFrustum );\nbvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n#else\nbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n#endif\nbool frustumTest = all( frustumTestVec );\nif ( frustumTest ) {\nshadowCoord.z += shadowBias[ i ];\n#if defined( SHADOWMAP_TYPE_PCF )\nfloat shadow = 0.0;\nconst float shadowDelta = 1.0 / 9.0;\nfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\nfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\nfloat dx0 = -1.25 * xPixelOffset;\nfloat dy0 = -1.25 * yPixelOffset;\nfloat dx1 = 1.25 * xPixelOffset;\nfloat dy1 = 1.25 * yPixelOffset;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\nfloat shadow = 0.0;\nfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\nfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\nfloat dx0 = -1.0 * xPixelOffset;\nfloat dy0 = -1.0 * yPixelOffset;\nfloat dx1 = 1.0 * xPixelOffset;\nfloat dy1 = 1.0 * yPixelOffset;\nmat3 shadowKernel;\nmat3 depthKernel;\ndepthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\ndepthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\ndepthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\ndepthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\ndepthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\ndepthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\ndepthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\ndepthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\ndepthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\nvec3 shadowZ = vec3( shadowCoord.z );\nshadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\nshadowKernel[0] *= vec3(0.25);\nshadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\nshadowKernel[1] *= vec3(0.25);\nshadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\nshadowKernel[2] *= vec3(0.25);\nvec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\nshadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\nshadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\nvec4 shadowValues;\nshadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\nshadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\nshadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\nshadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\nshadow = dot( shadowValues, vec4( 1.0 ) );\nshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n#else\nvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\nfloat fDepth = unpackDepth( rgbaDepth );\nif ( fDepth < shadowCoord.z )\nshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n#endif\n}\n#ifdef SHADOWMAP_DEBUG\n#ifdef SHADOWMAP_CASCADE\nif ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];\n#else\nif ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];\n#endif\n#endif\n}\n#ifdef GAMMA_OUTPUT\nshadowColor *= shadowColor;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n}\n#endif",alphatest_fragment:"#ifdef ALPHATEST\nif ( gl_FragColor.a < ALPHATEST ) discard;\n#endif",linear_to_gamma_fragment:"#ifdef GAMMA_OUTPUT\ngl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n#endif"},e.UniformsUtils={merge:function(e){var t,i,n,r={};
for(t=0;t<e.length;t++)for(i in n=this.clone(e[t]))r[i]=n[i];return r},clone:function(t){var i,n,r,o={};for(i in t)for(n in o[i]={},t[i])r=t[i][n],o[i][n]=r instanceof e.Color||r instanceof e.Vector2||r instanceof e.Vector3||r instanceof e.Vector4||r instanceof e.Matrix4||r instanceof e.Texture?r.clone():r instanceof Array?r.slice():r;return o}},e.UniformsLib={common:{diffuse:{type:"c",value:new e.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new e.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new e.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new e.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new e.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new e.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},e.ShaderLib={basic:{uniforms:e.UniformsUtils.merge([e.UniformsLib.common,e.UniformsLib.fog,e.UniformsLib.shadowmap]),vertexShader:[e.ShaderChunk.map_pars_vertex,e.ShaderChunk.lightmap_pars_vertex,e.ShaderChunk.envmap_pars_vertex,e.ShaderChunk.color_pars_vertex,e.ShaderChunk.morphtarget_pars_vertex,e.ShaderChunk.skinning_pars_vertex,e.ShaderChunk.shadowmap_pars_vertex,"void main() {",e.ShaderChunk.map_vertex,e.ShaderChunk.lightmap_vertex,e.ShaderChunk.color_vertex,e.ShaderChunk.skinbase_vertex,"#ifdef USE_ENVMAP",e.ShaderChunk.morphnormal_vertex,e.ShaderChunk.skinnormal_vertex,e.ShaderChunk.defaultnormal_vertex,"#endif",e.ShaderChunk.morphtarget_vertex,e.ShaderChunk.skinning_vertex,e.ShaderChunk.default_vertex,e.ShaderChunk.worldpos_vertex,e.ShaderChunk.envmap_vertex,e.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",e.ShaderChunk.color_pars_fragment,e.ShaderChunk.map_pars_fragment,e.ShaderChunk.lightmap_pars_fragment,e.ShaderChunk.envmap_pars_fragment,e.ShaderChunk.fog_pars_fragment,e.ShaderChunk.shadowmap_pars_fragment,e.ShaderChunk.specularmap_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",e.ShaderChunk.map_fragment,e.ShaderChunk.alphatest_fragment,e.ShaderChunk.specularmap_fragment,e.ShaderChunk.lightmap_fragment,e.ShaderChunk.color_fragment,e.ShaderChunk.envmap_fragment,e.ShaderChunk.shadowmap_fragment,e.ShaderChunk.linear_to_gamma_fragment,e.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:e.UniformsUtils.merge([e.UniformsLib.common,e.UniformsLib.fog,e.UniformsLib.lights,e.UniformsLib.shadowmap,{ambient:{type:"c",value:new e.Color(16777215)},emissive:{type:"c",value:new e.Color(0)},wrapRGB:{type:"v3",value:new e.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\nvarying vec3 vLightBack;\n#endif",e.ShaderChunk.map_pars_vertex,e.ShaderChunk.lightmap_pars_vertex,e.ShaderChunk.envmap_pars_vertex,e.ShaderChunk.lights_lambert_pars_vertex,e.ShaderChunk.color_pars_vertex,e.ShaderChunk.morphtarget_pars_vertex,e.ShaderChunk.skinning_pars_vertex,e.ShaderChunk.shadowmap_pars_vertex,"void main() {",e.ShaderChunk.map_vertex,e.ShaderChunk.lightmap_vertex,e.ShaderChunk.color_vertex,e.ShaderChunk.morphnormal_vertex,e.ShaderChunk.skinbase_vertex,e.ShaderChunk.skinnormal_vertex,e.ShaderChunk.defaultnormal_vertex,e.ShaderChunk.morphtarget_vertex,e.ShaderChunk.skinning_vertex,e.ShaderChunk.default_vertex,e.ShaderChunk.worldpos_vertex,e.ShaderChunk.envmap_vertex,e.ShaderChunk.lights_lambert_vertex,e.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\nvarying vec3 vLightBack;\n#endif",e.ShaderChunk.color_pars_fragment,e.ShaderChunk.map_pars_fragment,e.ShaderChunk.lightmap_pars_fragment,e.ShaderChunk.envmap_pars_fragment,e.ShaderChunk.fog_pars_fragment,e.ShaderChunk.shadowmap_pars_fragment,e.ShaderChunk.specularmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",e.ShaderChunk.map_fragment,e.ShaderChunk.alphatest_fragment,e.ShaderChunk.specularmap_fragment,"#ifdef DOUBLE_SIDED\nif ( gl_FrontFacing )\ngl_FragColor.xyz *= vLightFront;\nelse\ngl_FragColor.xyz *= vLightBack;\n#else\ngl_FragColor.xyz *= vLightFront;\n#endif",e.ShaderChunk.lightmap_fragment,e.ShaderChunk.color_fragment,e.ShaderChunk.envmap_fragment,e.ShaderChunk.shadowmap_fragment,e.ShaderChunk.linear_to_gamma_fragment,e.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:e.UniformsUtils.merge([e.UniformsLib.common,e.UniformsLib.bump,e.UniformsLib.normalmap,e.UniformsLib.fog,e.UniformsLib.lights,e.UniformsLib.shadowmap,{ambient:{type:"c",value:new e.Color(16777215)},emissive:{type:"c",value:new e.Color(0)},specular:{type:"c",value:new e.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new e.Vector3(1,1,1)}}]),vertexShader:["#define PHONG\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",e.ShaderChunk.map_pars_vertex,e.ShaderChunk.lightmap_pars_vertex,e.ShaderChunk.envmap_pars_vertex,e.ShaderChunk.lights_phong_pars_vertex,e.ShaderChunk.color_pars_vertex,e.ShaderChunk.morphtarget_pars_vertex,e.ShaderChunk.skinning_pars_vertex,e.ShaderChunk.shadowmap_pars_vertex,"void main() {",e.ShaderChunk.map_vertex,e.ShaderChunk.lightmap_vertex,e.ShaderChunk.color_vertex,e.ShaderChunk.morphnormal_vertex,e.ShaderChunk.skinbase_vertex,e.ShaderChunk.skinnormal_vertex,e.ShaderChunk.defaultnormal_vertex,"vNormal = normalize( transformedNormal );",e.ShaderChunk.morphtarget_vertex,e.ShaderChunk.skinning_vertex,e.ShaderChunk.default_vertex,"vViewPosition = -mvPosition.xyz;",e.ShaderChunk.worldpos_vertex,e.ShaderChunk.envmap_vertex,e.ShaderChunk.lights_phong_vertex,e.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;",e.ShaderChunk.color_pars_fragment,e.ShaderChunk.map_pars_fragment,e.ShaderChunk.lightmap_pars_fragment,e.ShaderChunk.envmap_pars_fragment,e.ShaderChunk.fog_pars_fragment,e.ShaderChunk.lights_phong_pars_fragment,e.ShaderChunk.shadowmap_pars_fragment,e.ShaderChunk.bumpmap_pars_fragment,e.ShaderChunk.normalmap_pars_fragment,e.ShaderChunk.specularmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",e.ShaderChunk.map_fragment,e.ShaderChunk.alphatest_fragment,e.ShaderChunk.specularmap_fragment,e.ShaderChunk.lights_phong_fragment,e.ShaderChunk.lightmap_fragment,e.ShaderChunk.color_fragment,e.ShaderChunk.envmap_fragment,e.ShaderChunk.shadowmap_fragment,e.ShaderChunk.linear_to_gamma_fragment,e.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:e.UniformsUtils.merge([e.UniformsLib.particle,e.UniformsLib.shadowmap]),vertexShader:["uniform float size;\nuniform float scale;",e.ShaderChunk.color_pars_vertex,e.ShaderChunk.shadowmap_pars_vertex,"void main() {",e.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;",e.ShaderChunk.worldpos_vertex,e.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",e.ShaderChunk.color_pars_fragment,e.ShaderChunk.map_particle_pars_fragment,e.ShaderChunk.fog_pars_fragment,e.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",e.ShaderChunk.map_particle_fragment,e.ShaderChunk.alphatest_fragment,e.ShaderChunk.color_fragment,e.ShaderChunk.shadowmap_fragment,e.ShaderChunk.fog_fragment,"}"].join("\n")},dashed:{uniforms:e.UniformsUtils.merge([e.UniformsLib.common,e.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;",e.ShaderChunk.color_pars_vertex,"void main() {",e.ShaderChunk.color_vertex,"vLineDistance = scale * lineDistance;\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;",e.ShaderChunk.color_pars_fragment,e.ShaderChunk.fog_pars_fragment,"void main() {\nif ( mod( vLineDistance, totalSize ) > dashSize ) {\ndiscard;\n}\ngl_FragColor = vec4( diffuse, opacity );",e.ShaderChunk.color_fragment,e.ShaderChunk.fog_fragment,"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}"},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",e.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvNormal = normalize( normalMatrix * normal );",e.ShaderChunk.morphtarget_vertex,e.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}"},normalmap:{uniforms:e.UniformsUtils.merge([e.UniformsLib.fog,e.UniformsLib.lights,e.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new e.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new e.Color(16777215)},uSpecularColor:{type:"c",value:new e.Color(1118481)},uAmbientColor:{type:"c",value:new e.Color(16777215)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},useRefract:{type:"i",value:0},uRefractionRatio:{type:"f",value:.98},uReflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new e.Vector2(0,0)},uRepeat:{type:"v2",value:new e.Vector2(1,1)},wrapRGB:{type:"v3",value:new e.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;\nuniform vec3 uDiffuseColor;\nuniform vec3 uSpecularColor;\nuniform float uShininess;\nuniform float uOpacity;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform bool enableReflection;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform samplerCube tCube;\nuniform vec2 uNormalScale;\nuniform bool useRefract;\nuniform float uRefractionRatio;\nuniform float uReflectivity;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\nuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif\nvarying vec3 vWorldPosition;\nvarying vec3 vViewPosition;",e.ShaderChunk.shadowmap_pars_fragment,e.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3( 1.0 ), uOpacity );\nvec3 specularTex = vec3( 1.0 );\nvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\nnormalTex.xy *= uNormalScale;\nnormalTex = normalize( normalTex );\nif( enableDiffuse ) {\n#ifdef GAMMA_INPUT\nvec4 texelColor = texture2D( tDiffuse, vUv );\ntexelColor.xyz *= texelColor.xyz;\ngl_FragColor = gl_FragColor * texelColor;\n#else\ngl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );\n#endif\n}\nif( enableAO ) {\n#ifdef GAMMA_INPUT\nvec4 aoColor = texture2D( tAO, vUv );\naoColor.xyz *= aoColor.xyz;\ngl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;\n#endif\n}\nif( enableSpecular )\nspecularTex = texture2D( tSpecular, vUv ).xyz;\nmat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );\nvec3 finalNormal = tsb * normalTex;\n#ifdef FLIP_SIDED\nfinalNormal = -finalNormal;\n#endif\nvec3 normal = normalize( finalNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 pointVector = lPosition.xyz + vViewPosition.xyz;\nfloat pointDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\npointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );\npointVector = normalize( pointVector );\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );\nfloat pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );\nvec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n#else\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\n#endif\npointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;\nvec3 pointHalfVector = normalize( pointVector + viewPosition );\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;\n#else\npointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvec3 spotDiffuse = vec3( 0.0 );\nvec3 spotSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 spotVector = lPosition.xyz + vViewPosition.xyz;\nfloat spotDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nspotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );\nspotVector = normalize( spotVector );\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\nif ( spotEffect > spotLightAngleCos[ i ] ) {\nspotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\n#ifdef WRAP_AROUND\nfloat spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );\nfloat spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );\nvec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n#else\nfloat spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );\n#endif\nspotDiffuse += spotDistance * spotLightColor[ i ] * uDiffuseColor * spotDiffuseWeight * spotEffect;\nvec3 spotHalfVector = normalize( spotVector + viewPosition );\nfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\nfloat spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );\nspotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;\n#else\nspotSpecular += spotDistance * spotLightColor[ i ] * uSpecularColor * spotSpecularWeight * spotDiffuseWeight * spotEffect;\n#endif\n}\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\n#ifdef WRAP_AROUND\nfloat directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );\nfloat directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );\nvec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );\n#else\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\n#endif\ndirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;\nvec3 dirHalfVector = normalize( dirVector + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n#else\ndirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;\n#endif\n}\n#endif\n#if MAX_HEMI_LIGHTS > 0\nvec3 hemiDiffuse  = vec3( 0.0 );\nvec3 hemiSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\nvec3 lVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( normal, lVector );\nfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\nvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\nhemiDiffuse += uDiffuseColor * hemiColor;\nvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\nfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\nfloat hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, uShininess ), 0.0 );\nvec3 lVectorGround = -lVector;\nvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\nfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\nfloat hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat dotProductGround = dot( normal, lVectorGround );\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlickSky = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );\nvec3 schlickGround = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );\nhemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n#else\nhemiSpecular += uSpecularColor * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;\n#endif\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_HEMI_LIGHTS > 0\ntotalDiffuse += hemiDiffuse;\ntotalSpecular += hemiSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\n#if MAX_SPOT_LIGHTS > 0\ntotalDiffuse += spotDiffuse;\ntotalSpecular += spotSpecular;\n#endif\n#ifdef METAL\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor + totalSpecular );\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor ) + totalSpecular;\n#endif\nif ( enableReflection ) {\nvec3 vReflect;\nvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\nif ( useRefract ) {\nvReflect = refract( cameraToVertex, normal, uRefractionRatio );\n} else {\nvReflect = reflect( cameraToVertex, normal );\n}\nvec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * uReflectivity );\n}",e.ShaderChunk.shadowmap_fragment,e.ShaderChunk.linear_to_gamma_fragment,e.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;\nuniform vec2 uOffset;\nuniform vec2 uRepeat;\nuniform bool enableDisplacement;\n#ifdef VERTEX_TEXTURES\nuniform sampler2D tDisplacement;\nuniform float uDisplacementScale;\nuniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vWorldPosition;\nvarying vec3 vViewPosition;",e.ShaderChunk.skinning_pars_vertex,e.ShaderChunk.shadowmap_pars_vertex,"void main() {",e.ShaderChunk.skinbase_vertex,e.ShaderChunk.skinnormal_vertex,"#ifdef USE_SKINNING\nvNormal = normalize( normalMatrix * skinnedNormal.xyz );\nvec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );\nvTangent = normalize( normalMatrix * skinnedTangent.xyz );\n#else\nvNormal = normalize( normalMatrix * normal );\nvTangent = normalize( normalMatrix * tangent.xyz );\n#endif\nvBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );\nvUv = uv * uRepeat + uOffset;\nvec3 displacedPosition;\n#ifdef VERTEX_TEXTURES\nif ( enableDisplacement ) {\nvec3 dv = texture2D( tDisplacement, uv ).xyz;\nfloat df = uDisplacementScale * dv.x + uDisplacementBias;\ndisplacedPosition = position + normalize( normal ) * df;\n} else {\n#ifdef USE_SKINNING\nvec4 skinVertex = vec4( position, 1.0 );\nvec4 skinned  = boneMatX * skinVertex * skinWeight.x;\nskinned 	  += boneMatY * skinVertex * skinWeight.y;\ndisplacedPosition  = skinned.xyz;\n#else\ndisplacedPosition = position;\n#endif\n}\n#else\n#ifdef USE_SKINNING\nvec4 skinVertex = vec4( position, 1.0 );\nvec4 skinned  = boneMatX * skinVertex * skinWeight.x;\nskinned 	  += boneMatY * skinVertex * skinWeight.y;\ndisplacedPosition  = skinned.xyz;\n#else\ndisplacedPosition = position;\n#endif\n#endif\nvec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );\nvec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\nvWorldPosition = worldPosition.xyz;\nvViewPosition = -mvPosition.xyz;\n#ifdef USE_SHADOWMAP\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n}\n#endif\n}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:"varying vec3 vWorldPosition;\nvoid main() {\nvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\nvWorldPosition = worldPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform samplerCube tCube;\nuniform float tFlip;\nvarying vec3 vWorldPosition;\nvoid main() {\ngl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n}"},depthRGBA:{uniforms:{},vertexShader:[e.ShaderChunk.morphtarget_pars_vertex,e.ShaderChunk.skinning_pars_vertex,"void main() {",e.ShaderChunk.skinbase_vertex,e.ShaderChunk.morphtarget_vertex,e.ShaderChunk.skinning_vertex,e.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:"vec4 pack_depth( const in float depth ) {\nconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\nconst vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\nvec4 res = fract( depth * bit_shift );\nres -= res.xxyz * bit_mask;\nreturn res;\n}\nvoid main() {\ngl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\n}"}},e.WebGLRenderer=function(t){function i(e){if(e.__webglCustomAttributesList)for(var t in e.__webglCustomAttributesList)z.deleteBuffer(e.__webglCustomAttributesList[t].buffer)}function n(e,t){var i=e.vertices.length,n=t.material;if(n.attributes){void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]);for(var r in n.attributes){var o=n.attributes[r];if(!o.__webglInitialized||o.createUniqueBuffers){o.__webglInitialized=!0;var a=1;"v2"===o.type?a=2:"v3"===o.type?a=3:"v4"===o.type?a=4:"c"===o.type&&(a=3),o.size=a,o.array=new Float32Array(i*a),o.buffer=z.createBuffer(),o.buffer.belongsToAttribute=r,o.needsUpdate=!0}e.__webglCustomAttributesList.push(o)}}}function r(e,t){var i=t.geometry,n=e.faces3,r=e.faces4,l=3*n.length+4*r.length,u=1*n.length+2*r.length,r=3*n.length+4*r.length,n=o(t,e),c=s(n),h=a(n),f=n.vertexColors?n.vertexColors:!1;if(e.__vertexArray=new Float32Array(3*l),h&&(e.__normalArray=new Float32Array(3*l)),i.hasTangents&&(e.__tangentArray=new Float32Array(4*l)),f&&(e.__colorArray=new Float32Array(3*l)),c&&((0<i.faceUvs.length||0<i.faceVertexUvs.length)&&(e.__uvArray=new Float32Array(2*l)),(1<i.faceUvs.length||1<i.faceVertexUvs.length)&&(e.__uv2Array=new Float32Array(2*l))),t.geometry.skinWeights.length&&t.geometry.skinIndices.length&&(e.__skinIndexArray=new Float32Array(4*l),e.__skinWeightArray=new Float32Array(4*l)),e.__faceArray=new Uint16Array(3*u),e.__lineArray=new Uint16Array(2*r),e.numMorphTargets)for(e.__morphTargetsArrays=[],i=0,c=e.numMorphTargets;c>i;i++)e.__morphTargetsArrays.push(new Float32Array(3*l));if(e.numMorphNormals)for(e.__morphNormalsArrays=[],i=0,c=e.numMorphNormals;c>i;i++)e.__morphNormalsArrays.push(new Float32Array(3*l));if(e.__webglFaceCount=3*u,e.__webglLineCount=2*r,n.attributes){void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]);for(var p in n.attributes){var d,u=n.attributes[p],i={};for(d in u)i[d]=u[d];(!i.__webglInitialized||i.createUniqueBuffers)&&(i.__webglInitialized=!0,r=1,"v2"===i.type?r=2:"v3"===i.type?r=3:"v4"===i.type?r=4:"c"===i.type&&(r=3),i.size=r,i.array=new Float32Array(l*r),i.buffer=z.createBuffer(),i.buffer.belongsToAttribute=p,u.needsUpdate=!0,i.__original=u),e.__webglCustomAttributesList.push(i)}}e.__inittedArrays=!0}function o(t,i){return t.material instanceof e.MeshFaceMaterial?t.material.materials[i.materialIndex]:t.material}function a(t){return t instanceof e.MeshBasicMaterial&&!t.envMap||t instanceof e.MeshDepthMaterial?!1:t&&void 0!==t.shading&&t.shading===e.SmoothShading?e.SmoothShading:e.FlatShading}function s(t){return t.map||t.lightMap||t.bumpMap||t.normalMap||t.specularMap||t instanceof e.ShaderMaterial?!0:!1}function l(e){_t[e]||(z.enableVertexAttribArray(e),_t[e]=!0)}function u(){for(var e in _t)_t[e]&&(z.disableVertexAttribArray(e),_t[e]=!1)}function c(e,t){return e.z!==t.z?t.z-e.z:e.id-t.id}function h(e,t){return t[0]-e[0]}function f(e,t,i){if(e.length)for(var n=0,r=e.length;r>n;n++)tt=Q=null,J=et=ot=rt=ht=ct=at=-1,Et=!0,e[n].render(t,i,xt,wt),tt=Q=null,J=et=ot=rt=ht=ct=at=-1,Et=!0}function p(t,i,n,r,o,a,s,l){var u,c,h,f;i?(c=t.length-1,f=i=-1):(c=0,i=t.length,f=1);for(var p=c;p!==i;p+=f)if(u=t[p],u.render){if(c=u.object,h=u.buffer,l)u=l;else{if(u=u[n],!u)continue;s&&Y.setBlending(u.blending,u.blendEquation,u.blendSrc,u.blendDst),Y.setDepthTest(u.depthTest),Y.setDepthWrite(u.depthWrite),T(u.polygonOffset,u.polygonOffsetFactor,u.polygonOffsetUnits)}Y.setMaterialFaces(u),h instanceof e.BufferGeometry?Y.renderBufferDirect(r,o,a,u,h,c):Y.renderBuffer(r,o,a,u,h,c)}}function d(e,t,i,n,r,o,a){for(var s,l,u=0,c=e.length;c>u;u++)if(s=e[u],l=s.object,l.visible){if(a)s=a;else{if(s=s[t],!s)continue;o&&Y.setBlending(s.blending,s.blendEquation,s.blendSrc,s.blendDst),Y.setDepthTest(s.depthTest),Y.setDepthWrite(s.depthWrite),T(s.polygonOffset,s.polygonOffsetFactor,s.polygonOffsetUnits)}Y.renderImmediateObject(i,n,r,s,l)}}function m(t,i){var o,a,s,l;if(void 0===t.__webglInit&&(t.__webglInit=!0,t._modelViewMatrix=new e.Matrix4,t._normalMatrix=new e.Matrix3,void 0!==t.geometry&&void 0===t.geometry.__webglInit&&(t.geometry.__webglInit=!0,t.geometry.addEventListener("dispose",zt)),a=t.geometry,void 0!==a))if(a instanceof e.BufferGeometry){var u,c;for(u in a.attributes)c="index"===u?z.ELEMENT_ARRAY_BUFFER:z.ARRAY_BUFFER,l=a.attributes[u],l.buffer=z.createBuffer(),z.bindBuffer(c,l.buffer),z.bufferData(c,l.array,z.STATIC_DRAW)}else if(t instanceof e.Mesh){if(s=t.material,void 0===a.geometryGroups){u=a;var h,f,p,d,m;c={};var v=u.morphTargets.length,y=u.morphNormals.length,b=s instanceof e.MeshFaceMaterial;for(u.geometryGroups={},s=0,h=u.faces.length;h>s;s++)f=u.faces[s],p=b?f.materialIndex:0,void 0===c[p]&&(c[p]={hash:p,counter:0}),m=c[p].hash+"_"+c[p].counter,void 0===u.geometryGroups[m]&&(u.geometryGroups[m]={faces3:[],faces4:[],materialIndex:p,vertices:0,numMorphTargets:v,numMorphNormals:y}),d=f instanceof e.Face3?3:4,65535<u.geometryGroups[m].vertices+d&&(c[p].counter+=1,m=c[p].hash+"_"+c[p].counter,void 0===u.geometryGroups[m]&&(u.geometryGroups[m]={faces3:[],faces4:[],materialIndex:p,vertices:0,numMorphTargets:v,numMorphNormals:y})),f instanceof e.Face3?u.geometryGroups[m].faces3.push(s):u.geometryGroups[m].faces4.push(s),u.geometryGroups[m].vertices+=d;u.geometryGroupsList=[];for(l in u.geometryGroups)u.geometryGroups[l].id=it++,u.geometryGroupsList.push(u.geometryGroups[l])}for(o in a.geometryGroups)if(l=a.geometryGroups[o],!l.__webglVertexBuffer){if(u=l,u.__webglVertexBuffer=z.createBuffer(),u.__webglNormalBuffer=z.createBuffer(),u.__webglTangentBuffer=z.createBuffer(),u.__webglColorBuffer=z.createBuffer(),u.__webglUVBuffer=z.createBuffer(),u.__webglUV2Buffer=z.createBuffer(),u.__webglSkinIndicesBuffer=z.createBuffer(),u.__webglSkinWeightsBuffer=z.createBuffer(),u.__webglFaceBuffer=z.createBuffer(),u.__webglLineBuffer=z.createBuffer(),v=c=void 0,u.numMorphTargets)for(u.__webglMorphTargetsBuffers=[],c=0,v=u.numMorphTargets;v>c;c++)u.__webglMorphTargetsBuffers.push(z.createBuffer());if(u.numMorphNormals)for(u.__webglMorphNormalsBuffers=[],c=0,v=u.numMorphNormals;v>c;c++)u.__webglMorphNormalsBuffers.push(z.createBuffer());Y.info.memory.geometries++,r(l,t),a.verticesNeedUpdate=!0,a.morphTargetsNeedUpdate=!0,a.elementsNeedUpdate=!0,a.uvsNeedUpdate=!0,a.normalsNeedUpdate=!0,a.tangentsNeedUpdate=!0,a.colorsNeedUpdate=!0
}}else t instanceof e.Ribbon?a.__webglVertexBuffer||(l=a,l.__webglVertexBuffer=z.createBuffer(),l.__webglColorBuffer=z.createBuffer(),l.__webglNormalBuffer=z.createBuffer(),Y.info.memory.geometries++,l=a,u=l.vertices.length,l.__vertexArray=new Float32Array(3*u),l.__colorArray=new Float32Array(3*u),l.__normalArray=new Float32Array(3*u),l.__webglVertexCount=u,n(l,t),a.verticesNeedUpdate=!0,a.colorsNeedUpdate=!0,a.normalsNeedUpdate=!0):t instanceof e.Line?a.__webglVertexBuffer||(l=a,l.__webglVertexBuffer=z.createBuffer(),l.__webglColorBuffer=z.createBuffer(),l.__webglLineDistanceBuffer=z.createBuffer(),Y.info.memory.geometries++,l=a,u=l.vertices.length,l.__vertexArray=new Float32Array(3*u),l.__colorArray=new Float32Array(3*u),l.__lineDistanceArray=new Float32Array(1*u),l.__webglLineCount=u,n(l,t),a.verticesNeedUpdate=!0,a.colorsNeedUpdate=!0,a.lineDistancesNeedUpdate=!0):t instanceof e.ParticleSystem&&!a.__webglVertexBuffer&&(l=a,l.__webglVertexBuffer=z.createBuffer(),l.__webglColorBuffer=z.createBuffer(),Y.info.memory.geometries++,l=a,u=l.vertices.length,l.__vertexArray=new Float32Array(3*u),l.__colorArray=new Float32Array(3*u),l.__sortArray=[],l.__webglParticleCount=u,n(l,t),a.verticesNeedUpdate=!0,a.colorsNeedUpdate=!0);if(void 0===t.__webglActive){if(t instanceof e.Mesh){if(a=t.geometry,a instanceof e.BufferGeometry)g(i.__webglObjects,a,t);else if(a instanceof e.Geometry)for(o in a.geometryGroups)l=a.geometryGroups[o],g(i.__webglObjects,l,t)}else t instanceof e.Ribbon||t instanceof e.Line||t instanceof e.ParticleSystem?(a=t.geometry,g(i.__webglObjects,a,t)):t instanceof e.ImmediateRenderObject||t.immediateRenderCallback?i.__webglObjectsImmediate.push({object:t,opaque:null,transparent:null}):t instanceof e.Sprite?i.__webglSprites.push(t):t instanceof e.LensFlare&&i.__webglFlares.push(t);t.__webglActive=!0}}function g(e,t,i){e.push({buffer:t,object:i,opaque:null,transparent:null})}function v(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function y(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}function b(t,i){t instanceof e.Mesh||t instanceof e.ParticleSystem||t instanceof e.Ribbon||t instanceof e.Line?x(i.__webglObjects,t):t instanceof e.Sprite?w(i.__webglSprites,t):t instanceof e.LensFlare?w(i.__webglFlares,t):(t instanceof e.ImmediateRenderObject||t.immediateRenderCallback)&&x(i.__webglObjectsImmediate,t),delete t.__webglActive}function x(e,t){for(var i=e.length-1;i>=0;i--)e[i].object===t&&e.splice(i,1)}function w(e,t){for(var i=e.length-1;i>=0;i--)e[i]===t&&e.splice(i,1)}function _(t,i,n,r,o){nt=0,r.needsUpdate&&(r.program&&Xt(r),Y.initMaterial(r,i,n,o),r.needsUpdate=!1),r.morphTargets&&!o.__webglMorphTargetInfluences&&(o.__webglMorphTargetInfluences=new Float32Array(Y.maxMorphTargets));var a=!1,s=r.program,l=s.uniforms,u=r.uniforms;if(s!==Q&&(z.useProgram(s),Q=s,a=!0),r.id!==J&&(J=r.id,a=!0),(a||t!==tt)&&(z.uniformMatrix4fv(l.projectionMatrix,!1,t.projectionMatrix.elements),t!==tt&&(tt=t)),r.skinning)if(Gt&&o.useVertexTexture){if(null!==l.boneTexture){var c=S();z.uniform1i(l.boneTexture,c),Y.setTexture(o.boneTexture,c)}}else null!==l.boneGlobalMatrices&&z.uniformMatrix4fv(l.boneGlobalMatrices,!1,o.boneMatrices);if(a){if(n&&r.fog&&(u.fogColor.value=n.color,n instanceof e.Fog?(u.fogNear.value=n.near,u.fogFar.value=n.far):n instanceof e.FogExp2&&(u.fogDensity.value=n.density)),r instanceof e.MeshPhongMaterial||r instanceof e.MeshLambertMaterial||r.lights){if(Et){for(var h,f,p,d,m=c=0,g=0,v=kt,y=v.directional.colors,b=v.directional.positions,x=v.point.colors,w=v.point.positions,_=v.point.distances,A=v.spot.colors,T=v.spot.positions,E=v.spot.distances,k=v.spot.directions,R=v.spot.anglesCos,L=v.spot.exponents,F=v.hemi.skyColors,G=v.hemi.groundColors,O=v.hemi.positions,j=0,I=0,V=0,U=0,B=0,q=0,H=0,W=0,X=h=0,n=d=X=0,a=i.length;a>n;n++)h=i[n],h.onlyShadow||(f=h.color,p=h.intensity,d=h.distance,h instanceof e.AmbientLight?h.visible&&(Y.gammaInput?(c+=f.r*f.r,m+=f.g*f.g,g+=f.b*f.b):(c+=f.r,m+=f.g,g+=f.b)):h instanceof e.DirectionalLight?(B+=1,h.visible&&(Tt.getPositionFromMatrix(h.matrixWorld),At.getPositionFromMatrix(h.target.matrixWorld),Tt.sub(At),Tt.normalize(),0===Tt.x&&0===Tt.y&&0===Tt.z||(h=3*j,b[h]=Tt.x,b[h+1]=Tt.y,b[h+2]=Tt.z,Y.gammaInput?M(y,h,f,p*p):C(y,h,f,p),j+=1))):h instanceof e.PointLight?(q+=1,h.visible&&(X=3*I,Y.gammaInput?M(x,X,f,p*p):C(x,X,f,p),At.getPositionFromMatrix(h.matrixWorld),w[X]=At.x,w[X+1]=At.y,w[X+2]=At.z,_[I]=d,I+=1)):h instanceof e.SpotLight?(H+=1,h.visible&&(X=3*V,Y.gammaInput?M(A,X,f,p*p):C(A,X,f,p),At.getPositionFromMatrix(h.matrixWorld),T[X]=At.x,T[X+1]=At.y,T[X+2]=At.z,E[V]=d,Tt.copy(At),At.getPositionFromMatrix(h.target.matrixWorld),Tt.sub(At),Tt.normalize(),k[X]=Tt.x,k[X+1]=Tt.y,k[X+2]=Tt.z,R[V]=Math.cos(h.angle),L[V]=h.exponent,V+=1)):h instanceof e.HemisphereLight&&(W+=1,h.visible&&(Tt.getPositionFromMatrix(h.matrixWorld),Tt.normalize(),0===Tt.x&&0===Tt.y&&0===Tt.z||(d=3*U,O[d]=Tt.x,O[d+1]=Tt.y,O[d+2]=Tt.z,f=h.color,h=h.groundColor,Y.gammaInput?(p*=p,M(F,d,f,p),M(G,d,h,p)):(C(F,d,f,p),C(G,d,h,p)),U+=1))));for(n=3*j,a=Math.max(y.length,3*B);a>n;n++)y[n]=0;for(n=3*I,a=Math.max(x.length,3*q);a>n;n++)x[n]=0;for(n=3*V,a=Math.max(A.length,3*H);a>n;n++)A[n]=0;for(n=3*U,a=Math.max(F.length,3*W);a>n;n++)F[n]=0;for(n=3*U,a=Math.max(G.length,3*W);a>n;n++)G[n]=0;v.directional.length=j,v.point.length=I,v.spot.length=V,v.hemi.length=U,v.ambient[0]=c,v.ambient[1]=m,v.ambient[2]=g,Et=!1}n=kt,u.ambientLightColor.value=n.ambient,u.directionalLightColor.value=n.directional.colors,u.directionalLightDirection.value=n.directional.positions,u.pointLightColor.value=n.point.colors,u.pointLightPosition.value=n.point.positions,u.pointLightDistance.value=n.point.distances,u.spotLightColor.value=n.spot.colors,u.spotLightPosition.value=n.spot.positions,u.spotLightDistance.value=n.spot.distances,u.spotLightDirection.value=n.spot.directions,u.spotLightAngleCos.value=n.spot.anglesCos,u.spotLightExponent.value=n.spot.exponents,u.hemisphereLightSkyColor.value=n.hemi.skyColors,u.hemisphereLightGroundColor.value=n.hemi.groundColors,u.hemisphereLightDirection.value=n.hemi.positions}if(r instanceof e.MeshBasicMaterial||r instanceof e.MeshLambertMaterial||r instanceof e.MeshPhongMaterial){u.opacity.value=r.opacity,Y.gammaInput?u.diffuse.value.copyGammaToLinear(r.color):u.diffuse.value=r.color,u.map.value=r.map,u.lightMap.value=r.lightMap,u.specularMap.value=r.specularMap,r.bumpMap&&(u.bumpMap.value=r.bumpMap,u.bumpScale.value=r.bumpScale),r.normalMap&&(u.normalMap.value=r.normalMap,u.normalScale.value.copy(r.normalScale));var K;r.map?K=r.map:r.specularMap?K=r.specularMap:r.normalMap?K=r.normalMap:r.bumpMap&&(K=r.bumpMap),void 0!==K&&(n=K.offset,K=K.repeat,u.offsetRepeat.value.set(n.x,n.y,K.x,K.y)),u.envMap.value=r.envMap,u.flipEnvMap.value=r.envMap instanceof e.WebGLRenderTargetCube?1:-1,u.reflectivity.value=r.reflectivity,u.refractionRatio.value=r.refractionRatio,u.combine.value=r.combine,u.useRefract.value=r.envMap&&r.envMap.mapping instanceof e.CubeRefractionMapping}if(r instanceof e.LineBasicMaterial?(u.diffuse.value=r.color,u.opacity.value=r.opacity):r instanceof e.LineDashedMaterial?(u.diffuse.value=r.color,u.opacity.value=r.opacity,u.dashSize.value=r.dashSize,u.totalSize.value=r.dashSize+r.gapSize,u.scale.value=r.scale):r instanceof e.ParticleBasicMaterial?(u.psColor.value=r.color,u.opacity.value=r.opacity,u.size.value=r.size,u.scale.value=N.height/2,u.map.value=r.map):r instanceof e.MeshPhongMaterial?(u.shininess.value=r.shininess,Y.gammaInput?(u.ambient.value.copyGammaToLinear(r.ambient),u.emissive.value.copyGammaToLinear(r.emissive),u.specular.value.copyGammaToLinear(r.specular)):(u.ambient.value=r.ambient,u.emissive.value=r.emissive,u.specular.value=r.specular),r.wrapAround&&u.wrapRGB.value.copy(r.wrapRGB)):r instanceof e.MeshLambertMaterial?(Y.gammaInput?(u.ambient.value.copyGammaToLinear(r.ambient),u.emissive.value.copyGammaToLinear(r.emissive)):(u.ambient.value=r.ambient,u.emissive.value=r.emissive),r.wrapAround&&u.wrapRGB.value.copy(r.wrapRGB)):r instanceof e.MeshDepthMaterial?(u.mNear.value=t.near,u.mFar.value=t.far,u.opacity.value=r.opacity):r instanceof e.MeshNormalMaterial&&(u.opacity.value=r.opacity),o.receiveShadow&&!r._shadowPass&&u.shadowMatrix)for(n=K=0,a=i.length;a>n;n++)c=i[n],c.castShadow&&(c instanceof e.SpotLight||c instanceof e.DirectionalLight&&!c.shadowCascade)&&(u.shadowMap.value[K]=c.shadowMap,u.shadowMapSize.value[K]=c.shadowMapSize,u.shadowMatrix.value[K]=c.shadowMatrix,u.shadowDarkness.value[K]=c.shadowDarkness,u.shadowBias.value[K]=c.shadowBias,K++);for(i=r.uniformsList,u=0,K=i.length;K>u;u++)if(a=s.uniforms[i[u][1]])if(n=i[u][0],m=n.type,c=n.value,"i"===m)z.uniform1i(a,c);else if("f"===m)z.uniform1f(a,c);else if("v2"===m)z.uniform2f(a,c.x,c.y);else if("v3"===m)z.uniform3f(a,c.x,c.y,c.z);else if("v4"===m)z.uniform4f(a,c.x,c.y,c.z,c.w);else if("c"===m)z.uniform3f(a,c.r,c.g,c.b);else if("iv1"===m)z.uniform1iv(a,c);else if("iv"===m)z.uniform3iv(a,c);else if("fv1"===m)z.uniform1fv(a,c);else if("fv"===m)z.uniform3fv(a,c);else if("v2v"===m){for(void 0===n._array&&(n._array=new Float32Array(2*c.length)),m=0,g=c.length;g>m;m++)v=2*m,n._array[v]=c[m].x,n._array[v+1]=c[m].y;z.uniform2fv(a,n._array)}else if("v3v"===m){for(void 0===n._array&&(n._array=new Float32Array(3*c.length)),m=0,g=c.length;g>m;m++)v=3*m,n._array[v]=c[m].x,n._array[v+1]=c[m].y,n._array[v+2]=c[m].z;z.uniform3fv(a,n._array)}else if("v4v"===m){for(void 0===n._array&&(n._array=new Float32Array(4*c.length)),m=0,g=c.length;g>m;m++)v=4*m,n._array[v]=c[m].x,n._array[v+1]=c[m].y,n._array[v+2]=c[m].z,n._array[v+3]=c[m].w;z.uniform4fv(a,n._array)}else if("m4"===m)void 0===n._array&&(n._array=new Float32Array(16)),c.flattenToArray(n._array),z.uniformMatrix4fv(a,!1,n._array);else if("m4v"===m){for(void 0===n._array&&(n._array=new Float32Array(16*c.length)),m=0,g=c.length;g>m;m++)c[m].flattenToArrayOffset(n._array,16*m);z.uniformMatrix4fv(a,!1,n._array)}else if("t"===m){if(v=c,c=S(),z.uniform1i(a,c),v)if(v.image instanceof Array&&6===v.image.length){if(n=v,a=c,6===n.image.length)if(n.needsUpdate){for(n.image.__webglTextureCube||(n.image.__webglTextureCube=z.createTexture(),Y.info.memory.textures++),z.activeTexture(z.TEXTURE0+a),z.bindTexture(z.TEXTURE_CUBE_MAP,n.image.__webglTextureCube),z.pixelStorei(z.UNPACK_FLIP_Y_WEBGL,n.flipY),a=n instanceof e.CompressedTexture,c=[],m=0;6>m;m++)Y.autoScaleCubemaps&&!a?(g=c,v=m,y=n.image[m],x=Dt,y.width<=x&&y.height<=x||(w=Math.max(y.width,y.height),b=Math.floor(y.width*x/w),x=Math.floor(y.height*x/w),w=document.createElement("canvas"),w.width=b,w.height=x,w.getContext("2d").drawImage(y,0,0,y.width,y.height,0,0,b,x),y=w),g[v]=y):c[m]=n.image[m];for(m=c[0],g=0===(m.width&m.width-1)&&0===(m.height&m.height-1),v=D(n.format),y=D(n.type),P(z.TEXTURE_CUBE_MAP,n,g),m=0;6>m;m++)if(a)for(x=c[m].mipmaps,w=0,_=x.length;_>w;w++)b=x[w],z.compressedTexImage2D(z.TEXTURE_CUBE_MAP_POSITIVE_X+m,w,v,b.width,b.height,0,b.data);else z.texImage2D(z.TEXTURE_CUBE_MAP_POSITIVE_X+m,0,v,v,y,c[m]);n.generateMipmaps&&g&&z.generateMipmap(z.TEXTURE_CUBE_MAP),n.needsUpdate=!1,n.onUpdate&&n.onUpdate()}else z.activeTexture(z.TEXTURE0+a),z.bindTexture(z.TEXTURE_CUBE_MAP,n.image.__webglTextureCube)}else v instanceof e.WebGLRenderTargetCube?(n=v,z.activeTexture(z.TEXTURE0+c),z.bindTexture(z.TEXTURE_CUBE_MAP,n.__webglTexture)):Y.setTexture(v,c)}else if("tv"===m){for(void 0===n._array&&(n._array=[]),m=0,g=n.value.length;g>m;m++)n._array[m]=S();for(z.uniform1iv(a,n._array),m=0,g=n.value.length;g>m;m++)v=n.value[m],c=n._array[m],v&&Y.setTexture(v,c)}(r instanceof e.ShaderMaterial||r instanceof e.MeshPhongMaterial||r.envMap)&&null!==l.cameraPosition&&(At.getPositionFromMatrix(t.matrixWorld),z.uniform3f(l.cameraPosition,At.x,At.y,At.z)),(r instanceof e.MeshPhongMaterial||r instanceof e.MeshLambertMaterial||r instanceof e.ShaderMaterial||r.skinning)&&null!==l.viewMatrix&&z.uniformMatrix4fv(l.viewMatrix,!1,t.matrixWorldInverse.elements)}return z.uniformMatrix4fv(l.modelViewMatrix,!1,o._modelViewMatrix.elements),l.normalMatrix&&z.uniformMatrix3fv(l.normalMatrix,!1,o._normalMatrix.elements),null!==l.modelMatrix&&z.uniformMatrix4fv(l.modelMatrix,!1,o.matrixWorld.elements),s}function S(){var e=nt;return e>=Rt&&console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+Rt),nt+=1,e}function M(e,t,i,n){e[t]=i.r*i.r*n,e[t+1]=i.g*i.g*n,e[t+2]=i.b*i.b*n}function C(e,t,i,n){e[t]=i.r*n,e[t+1]=i.g*n,e[t+2]=i.b*n}function A(e){e!==mt&&(z.lineWidth(e),mt=e)}function T(e,t,i){ft!==e&&(e?z.enable(z.POLYGON_OFFSET_FILL):z.disable(z.POLYGON_OFFSET_FILL),ft=e),!e||pt===t&&dt===i||(z.polygonOffset(t,i),pt=t,dt=i)}function E(e){for(var e=e.split("\n"),t=0,i=e.length;i>t;t++)e[t]=t+1+": "+e[t];return e.join("\n")}function k(e,t){var i;return"fragment"===e?i=z.createShader(z.FRAGMENT_SHADER):"vertex"===e&&(i=z.createShader(z.VERTEX_SHADER)),z.shaderSource(i,t),z.compileShader(i),z.getShaderParameter(i,z.COMPILE_STATUS)?i:(console.error(z.getShaderInfoLog(i)),console.error(E(t)),null)}function P(t,i,n){n?(z.texParameteri(t,z.TEXTURE_WRAP_S,D(i.wrapS)),z.texParameteri(t,z.TEXTURE_WRAP_T,D(i.wrapT)),z.texParameteri(t,z.TEXTURE_MAG_FILTER,D(i.magFilter)),z.texParameteri(t,z.TEXTURE_MIN_FILTER,D(i.minFilter))):(z.texParameteri(t,z.TEXTURE_WRAP_S,z.CLAMP_TO_EDGE),z.texParameteri(t,z.TEXTURE_WRAP_T,z.CLAMP_TO_EDGE),z.texParameteri(t,z.TEXTURE_MAG_FILTER,L(i.magFilter)),z.texParameteri(t,z.TEXTURE_MIN_FILTER,L(i.minFilter))),W&&i.type!==e.FloatType&&(1<i.anisotropy||i.__oldAnisotropy)&&(z.texParameterf(t,W.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(i.anisotropy,Nt)),i.__oldAnisotropy=i.anisotropy)}function R(e,t){z.bindRenderbuffer(z.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(z.renderbufferStorage(z.RENDERBUFFER,z.DEPTH_COMPONENT16,t.width,t.height),z.framebufferRenderbuffer(z.FRAMEBUFFER,z.DEPTH_ATTACHMENT,z.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(z.renderbufferStorage(z.RENDERBUFFER,z.DEPTH_STENCIL,t.width,t.height),z.framebufferRenderbuffer(z.FRAMEBUFFER,z.DEPTH_STENCIL_ATTACHMENT,z.RENDERBUFFER,e)):z.renderbufferStorage(z.RENDERBUFFER,z.RGBA4,t.width,t.height)}function L(t){return t===e.NearestFilter||t===e.NearestMipMapNearestFilter||t===e.NearestMipMapLinearFilter?z.NEAREST:z.LINEAR}function D(t){if(t===e.RepeatWrapping)return z.REPEAT;if(t===e.ClampToEdgeWrapping)return z.CLAMP_TO_EDGE;if(t===e.MirroredRepeatWrapping)return z.MIRRORED_REPEAT;if(t===e.NearestFilter)return z.NEAREST;if(t===e.NearestMipMapNearestFilter)return z.NEAREST_MIPMAP_NEAREST;if(t===e.NearestMipMapLinearFilter)return z.NEAREST_MIPMAP_LINEAR;if(t===e.LinearFilter)return z.LINEAR;if(t===e.LinearMipMapNearestFilter)return z.LINEAR_MIPMAP_NEAREST;if(t===e.LinearMipMapLinearFilter)return z.LINEAR_MIPMAP_LINEAR;if(t===e.UnsignedByteType)return z.UNSIGNED_BYTE;if(t===e.UnsignedShort4444Type)return z.UNSIGNED_SHORT_4_4_4_4;if(t===e.UnsignedShort5551Type)return z.UNSIGNED_SHORT_5_5_5_1;if(t===e.UnsignedShort565Type)return z.UNSIGNED_SHORT_5_6_5;if(t===e.ByteType)return z.BYTE;if(t===e.ShortType)return z.SHORT;if(t===e.UnsignedShortType)return z.UNSIGNED_SHORT;if(t===e.IntType)return z.INT;if(t===e.UnsignedIntType)return z.UNSIGNED_INT;if(t===e.FloatType)return z.FLOAT;if(t===e.AlphaFormat)return z.ALPHA;if(t===e.RGBFormat)return z.RGB;if(t===e.RGBAFormat)return z.RGBA;if(t===e.LuminanceFormat)return z.LUMINANCE;if(t===e.LuminanceAlphaFormat)return z.LUMINANCE_ALPHA;if(t===e.AddEquation)return z.FUNC_ADD;if(t===e.SubtractEquation)return z.FUNC_SUBTRACT;if(t===e.ReverseSubtractEquation)return z.FUNC_REVERSE_SUBTRACT;if(t===e.ZeroFactor)return z.ZERO;if(t===e.OneFactor)return z.ONE;if(t===e.SrcColorFactor)return z.SRC_COLOR;if(t===e.OneMinusSrcColorFactor)return z.ONE_MINUS_SRC_COLOR;if(t===e.SrcAlphaFactor)return z.SRC_ALPHA;if(t===e.OneMinusSrcAlphaFactor)return z.ONE_MINUS_SRC_ALPHA;if(t===e.DstAlphaFactor)return z.DST_ALPHA;if(t===e.OneMinusDstAlphaFactor)return z.ONE_MINUS_DST_ALPHA;if(t===e.DstColorFactor)return z.DST_COLOR;if(t===e.OneMinusDstColorFactor)return z.ONE_MINUS_DST_COLOR;if(t===e.SrcAlphaSaturateFactor)return z.SRC_ALPHA_SATURATE;if(void 0!==X){if(t===e.RGB_S3TC_DXT1_Format)return X.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===e.RGBA_S3TC_DXT1_Format)return X.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===e.RGBA_S3TC_DXT3_Format)return X.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===e.RGBA_S3TC_DXT5_Format)return X.COMPRESSED_RGBA_S3TC_DXT5_EXT}return 0}console.log("THREE.WebGLRenderer",e.REVISION);var t=t||{},N=void 0!==t.canvas?t.canvas:document.createElement("canvas"),F=void 0!==t.precision?t.precision:"highp",G=void 0!==t.alpha?t.alpha:!0,O=void 0!==t.premultipliedAlpha?t.premultipliedAlpha:!0,j=void 0!==t.antialias?t.antialias:!1,I=void 0!==t.stencil?t.stencil:!0,V=void 0!==t.preserveDrawingBuffer?t.preserveDrawingBuffer:!1,U=new e.Color(0),B=0;void 0!==t.clearColor&&(console.warn("DEPRECATED: clearColor in WebGLRenderer constructor parameters is being removed. Use .setClearColor() instead."),U.setHex(t.clearColor)),void 0!==t.clearAlpha&&(console.warn("DEPRECATED: clearAlpha in WebGLRenderer constructor parameters is being removed. Use .setClearColor() instead."),B=t.clearAlpha),this.domElement=N,this.context=null,this.devicePixelRatio=void 0!==t.devicePixelRatio?t.devicePixelRatio:void 0!==window.devicePixelRatio?window.devicePixelRatio:1,this.autoUpdateObjects=this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0,this.shadowMapEnabled=this.physicallyBasedShading=this.gammaOutput=this.gammaInput=!1,this.shadowMapAutoUpdate=!0,this.shadowMapType=e.PCFShadowMap,this.shadowMapCullFace=e.CullFaceFront,this.shadowMapCascade=this.shadowMapDebug=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.renderPluginsPre=[],this.renderPluginsPost=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var z,q,H,W,X,Y=this,K=[],$=0,Q=null,Z=null,J=-1,et=null,tt=null,it=0,nt=0,rt=-1,ot=-1,at=-1,st=-1,lt=-1,ut=-1,ct=-1,ht=-1,ft=null,pt=null,dt=null,mt=null,gt=0,vt=0,yt=0,bt=0,xt=0,wt=0,_t={},St=new e.Frustum,Mt=new e.Matrix4,Ct=new e.Matrix4,At=new e.Vector3,Tt=new e.Vector3,Et=!0,kt={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}};try{if(!(z=N.getContext("experimental-webgl",{alpha:G,premultipliedAlpha:O,antialias:j,stencil:I,preserveDrawingBuffer:V})))throw"Error creating WebGL context."}catch(Pt){console.error(Pt)}q=z.getExtension("OES_texture_float"),H=z.getExtension("OES_standard_derivatives"),W=z.getExtension("EXT_texture_filter_anisotropic")||z.getExtension("MOZ_EXT_texture_filter_anisotropic")||z.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),X=z.getExtension("WEBGL_compressed_texture_s3tc")||z.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||z.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),q||console.log("THREE.WebGLRenderer: Float textures not supported."),H||console.log("THREE.WebGLRenderer: Standard derivatives not supported."),W||console.log("THREE.WebGLRenderer: Anisotropic texture filtering not supported."),X||console.log("THREE.WebGLRenderer: S3TC compressed textures not supported."),void 0===z.getShaderPrecisionFormat&&(z.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),z.clearColor(0,0,0,1),z.clearDepth(1),z.clearStencil(0),z.enable(z.DEPTH_TEST),z.depthFunc(z.LEQUAL),z.frontFace(z.CCW),z.cullFace(z.BACK),z.enable(z.CULL_FACE),z.enable(z.BLEND),z.blendEquation(z.FUNC_ADD),z.blendFunc(z.SRC_ALPHA,z.ONE_MINUS_SRC_ALPHA),z.clearColor(U.r,U.g,U.b,B),this.context=z;var Rt=z.getParameter(z.MAX_TEXTURE_IMAGE_UNITS),Lt=z.getParameter(z.MAX_VERTEX_TEXTURE_IMAGE_UNITS);z.getParameter(z.MAX_TEXTURE_SIZE);var Dt=z.getParameter(z.MAX_CUBE_MAP_TEXTURE_SIZE),Nt=W?z.getParameter(W.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,Ft=Lt>0,Gt=Ft&&q;X&&z.getParameter(z.COMPRESSED_TEXTURE_FORMATS);var Ot=z.getShaderPrecisionFormat(z.VERTEX_SHADER,z.HIGH_FLOAT),jt=z.getShaderPrecisionFormat(z.VERTEX_SHADER,z.MEDIUM_FLOAT);z.getShaderPrecisionFormat(z.VERTEX_SHADER,z.LOW_FLOAT);var It=z.getShaderPrecisionFormat(z.FRAGMENT_SHADER,z.HIGH_FLOAT),Vt=z.getShaderPrecisionFormat(z.FRAGMENT_SHADER,z.MEDIUM_FLOAT);z.getShaderPrecisionFormat(z.FRAGMENT_SHADER,z.LOW_FLOAT),z.getShaderPrecisionFormat(z.VERTEX_SHADER,z.HIGH_INT),z.getShaderPrecisionFormat(z.VERTEX_SHADER,z.MEDIUM_INT),z.getShaderPrecisionFormat(z.VERTEX_SHADER,z.LOW_INT),z.getShaderPrecisionFormat(z.FRAGMENT_SHADER,z.HIGH_INT),z.getShaderPrecisionFormat(z.FRAGMENT_SHADER,z.MEDIUM_INT),z.getShaderPrecisionFormat(z.FRAGMENT_SHADER,z.LOW_INT);var Ut=0<Ot.precision&&0<It.precision,Bt=0<jt.precision&&0<Vt.precision;"highp"===F&&!Ut&&(Bt?(F="mediump",console.warn("WebGLRenderer: highp not supported, using mediump")):(F="lowp",console.warn("WebGLRenderer: highp and mediump not supported, using lowp"))),"mediump"===F&&!Bt&&(F="lowp",console.warn("WebGLRenderer: mediump not supported, using lowp")),this.getContext=function(){return z},this.supportsVertexTextures=function(){return Ft},this.supportsFloatTextures=function(){return q},this.supportsStandardDerivatives=function(){return H},this.supportsCompressedTextureS3TC=function(){return X},this.getMaxAnisotropy=function(){return Nt},this.getPrecision=function(){return F},this.setSize=function(e,t,i){N.width=e*this.devicePixelRatio,N.height=t*this.devicePixelRatio,1!==this.devicePixelRatio&&!1!==i&&(N.style.width=e+"px",N.style.height=t+"px"),this.setViewport(0,0,N.width,N.height)},this.setViewport=function(e,t,i,n){gt=void 0!==e?e:0,vt=void 0!==t?t:0,yt=void 0!==i?i:N.width,bt=void 0!==n?n:N.height,z.viewport(gt,vt,yt,bt)},this.setScissor=function(e,t,i,n){z.scissor(e,t,i,n)},this.enableScissorTest=function(e){e?z.enable(z.SCISSOR_TEST):z.disable(z.SCISSOR_TEST)},this.setClearColor=function(e,t){U.set(e),B=void 0!==t?t:1,z.clearColor(U.r,U.g,U.b,B)},this.setClearColorHex=function(e,t){console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getClearColor=function(){return U},this.getClearAlpha=function(){return B},this.clear=function(e,t,i){var n=0;(void 0===e||e)&&(n|=z.COLOR_BUFFER_BIT),(void 0===t||t)&&(n|=z.DEPTH_BUFFER_BIT),(void 0===i||i)&&(n|=z.STENCIL_BUFFER_BIT),z.clear(n)},this.clearTarget=function(e,t,i,n){this.setRenderTarget(e),this.clear(t,i,n)},this.addPostPlugin=function(e){e.init(this),this.renderPluginsPost.push(e)},this.addPrePlugin=function(e){e.init(this),this.renderPluginsPre.push(e)},this.updateShadowMap=function(e,t){Q=null,J=et=ht=ct=at=-1,Et=!0,ot=rt=-1,this.shadowMapPlugin.update(e,t)};var zt=function(e){if(e=e.target,e.removeEventListener("dispose",zt),e.__webglInit=void 0,void 0!==e.__webglVertexBuffer&&z.deleteBuffer(e.__webglVertexBuffer),void 0!==e.__webglNormalBuffer&&z.deleteBuffer(e.__webglNormalBuffer),void 0!==e.__webglTangentBuffer&&z.deleteBuffer(e.__webglTangentBuffer),void 0!==e.__webglColorBuffer&&z.deleteBuffer(e.__webglColorBuffer),void 0!==e.__webglUVBuffer&&z.deleteBuffer(e.__webglUVBuffer),void 0!==e.__webglUV2Buffer&&z.deleteBuffer(e.__webglUV2Buffer),void 0!==e.__webglSkinIndicesBuffer&&z.deleteBuffer(e.__webglSkinIndicesBuffer),void 0!==e.__webglSkinWeightsBuffer&&z.deleteBuffer(e.__webglSkinWeightsBuffer),void 0!==e.__webglFaceBuffer&&z.deleteBuffer(e.__webglFaceBuffer),void 0!==e.__webglLineBuffer&&z.deleteBuffer(e.__webglLineBuffer),void 0!==e.__webglLineDistanceBuffer&&z.deleteBuffer(e.__webglLineDistanceBuffer),void 0!==e.geometryGroups)for(var t in e.geometryGroups){var n=e.geometryGroups[t];if(void 0!==n.numMorphTargets)for(var r=0,o=n.numMorphTargets;o>r;r++)z.deleteBuffer(n.__webglMorphTargetsBuffers[r]);if(void 0!==n.numMorphNormals)for(r=0,o=n.numMorphNormals;o>r;r++)z.deleteBuffer(n.__webglMorphNormalsBuffers[r]);i(n)}i(e),Y.info.memory.geometries--},qt=function(e){e=e.target,e.removeEventListener("dispose",qt),e.image&&e.image.__webglTextureCube?z.deleteTexture(e.image.__webglTextureCube):e.__webglInit&&(e.__webglInit=!1,z.deleteTexture(e.__webglTexture)),Y.info.memory.textures--},Ht=function(t){if(t=t.target,t.removeEventListener("dispose",Ht),t&&t.__webglTexture)if(z.deleteTexture(t.__webglTexture),t instanceof e.WebGLRenderTargetCube)for(var i=0;6>i;i++)z.deleteFramebuffer(t.__webglFramebuffer[i]),z.deleteRenderbuffer(t.__webglRenderbuffer[i]);else z.deleteFramebuffer(t.__webglFramebuffer),z.deleteRenderbuffer(t.__webglRenderbuffer);Y.info.memory.textures--},Wt=function(e){e=e.target,e.removeEventListener("dispose",Wt),Xt(e)},Xt=function(e){var t=e.program;if(void 0!==t){e.program=void 0;var i,n,r=!1,e=0;for(i=K.length;i>e;e++)if(n=K[e],n.program===t){n.usedTimes--,0===n.usedTimes&&(r=!0);break}if(!0===r){for(r=[],e=0,i=K.length;i>e;e++)n=K[e],n.program!==t&&r.push(n);K=r,z.deleteProgram(t),Y.info.memory.programs--}}};this.renderBufferImmediate=function(t,i,n){if(t.hasPositions&&!t.__webglVertexBuffer&&(t.__webglVertexBuffer=z.createBuffer()),t.hasNormals&&!t.__webglNormalBuffer&&(t.__webglNormalBuffer=z.createBuffer()),t.hasUvs&&!t.__webglUvBuffer&&(t.__webglUvBuffer=z.createBuffer()),t.hasColors&&!t.__webglColorBuffer&&(t.__webglColorBuffer=z.createBuffer()),t.hasPositions&&(z.bindBuffer(z.ARRAY_BUFFER,t.__webglVertexBuffer),z.bufferData(z.ARRAY_BUFFER,t.positionArray,z.DYNAMIC_DRAW),z.enableVertexAttribArray(i.attributes.position),z.vertexAttribPointer(i.attributes.position,3,z.FLOAT,!1,0,0)),t.hasNormals){if(z.bindBuffer(z.ARRAY_BUFFER,t.__webglNormalBuffer),n.shading===e.FlatShading){var r,o,a,s,l,u,c,h,f,p,d,m=3*t.count;for(d=0;m>d;d+=9)p=t.normalArray,r=p[d],o=p[d+1],a=p[d+2],s=p[d+3],u=p[d+4],h=p[d+5],l=p[d+6],c=p[d+7],f=p[d+8],r=(r+s+l)/3,o=(o+u+c)/3,a=(a+h+f)/3,p[d]=r,p[d+1]=o,p[d+2]=a,p[d+3]=r,p[d+4]=o,p[d+5]=a,p[d+6]=r,p[d+7]=o,p[d+8]=a}z.bufferData(z.ARRAY_BUFFER,t.normalArray,z.DYNAMIC_DRAW),z.enableVertexAttribArray(i.attributes.normal),z.vertexAttribPointer(i.attributes.normal,3,z.FLOAT,!1,0,0)}t.hasUvs&&n.map&&(z.bindBuffer(z.ARRAY_BUFFER,t.__webglUvBuffer),z.bufferData(z.ARRAY_BUFFER,t.uvArray,z.DYNAMIC_DRAW),z.enableVertexAttribArray(i.attributes.uv),z.vertexAttribPointer(i.attributes.uv,2,z.FLOAT,!1,0,0)),t.hasColors&&n.vertexColors!==e.NoColors&&(z.bindBuffer(z.ARRAY_BUFFER,t.__webglColorBuffer),z.bufferData(z.ARRAY_BUFFER,t.colorArray,z.DYNAMIC_DRAW),z.enableVertexAttribArray(i.attributes.color),z.vertexAttribPointer(i.attributes.color,3,z.FLOAT,!1,0,0)),z.drawArrays(z.TRIANGLES,0,t.count),t.count=0},this.renderBufferDirect=function(t,i,n,r,o,a){if(!1!==r.visible){var s,c,h;if(s=_(t,i,n,r,a),t=s.attributes,i=o.attributes,n=!1,s=16777215*o.id+2*s.id+(r.wireframe?1:0),s!==et&&(et=s,n=!0),n&&u(),a instanceof e.Mesh)if(r=i.index){o=o.offsets,1<o.length&&(n=!0);for(var f=0,p=o.length;p>f;f++){var d=o[f].index;if(n){for(c in i)"index"!==c&&(s=t[c],a=i[c],h=a.itemSize,s>=0&&(z.bindBuffer(z.ARRAY_BUFFER,a.buffer),l(s),z.vertexAttribPointer(s,h,z.FLOAT,!1,0,4*d*h)));z.bindBuffer(z.ELEMENT_ARRAY_BUFFER,r.buffer)}z.drawElements(z.TRIANGLES,o[f].count,z.UNSIGNED_SHORT,2*o[f].start),Y.info.render.calls++,Y.info.render.vertices+=o[f].count,Y.info.render.faces+=o[f].count/3}}else{if(n)for(c in i)"index"!==c&&(s=t[c],a=i[c],h=a.itemSize,s>=0&&(z.bindBuffer(z.ARRAY_BUFFER,a.buffer),l(s),z.vertexAttribPointer(s,h,z.FLOAT,!1,0,0)));c=o.attributes.position,z.drawArrays(z.TRIANGLES,0,c.numItems/3),Y.info.render.calls++,Y.info.render.vertices+=c.numItems/3,Y.info.render.faces+=c.numItems/3/3}else if(a instanceof e.ParticleSystem){if(n){for(c in i)s=t[c],a=i[c],h=a.itemSize,s>=0&&(z.bindBuffer(z.ARRAY_BUFFER,a.buffer),l(s),z.vertexAttribPointer(s,h,z.FLOAT,!1,0,0));c=i.position,z.drawArrays(z.POINTS,0,c.numItems/3),Y.info.render.calls++,Y.info.render.points+=c.numItems/3}}else if(a instanceof e.Line&&n){for(c in i)s=t[c],a=i[c],h=a.itemSize,s>=0&&(z.bindBuffer(z.ARRAY_BUFFER,a.buffer),l(s),z.vertexAttribPointer(s,h,z.FLOAT,!1,0,0));A(r.linewidth),c=i.position,z.drawArrays(z.LINE_STRIP,0,c.numItems/3),Y.info.render.calls++,Y.info.render.points+=c.numItems}}},this.renderBuffer=function(t,i,n,r,o,a){if(!1!==r.visible){var s,c,n=_(t,i,n,r,a),t=n.attributes,i=!1,n=16777215*o.id+2*n.id+(r.wireframe?1:0);if(n!==et&&(et=n,i=!0),i&&u(),!r.morphTargets&&0<=t.position)i&&(z.bindBuffer(z.ARRAY_BUFFER,o.__webglVertexBuffer),l(t.position),z.vertexAttribPointer(t.position,3,z.FLOAT,!1,0,0));else if(a.morphTargetBase){if(n=r.program.attributes,-1!==a.morphTargetBase&&0<=n.position?(z.bindBuffer(z.ARRAY_BUFFER,o.__webglMorphTargetsBuffers[a.morphTargetBase]),l(n.position),z.vertexAttribPointer(n.position,3,z.FLOAT,!1,0,0)):0<=n.position&&(z.bindBuffer(z.ARRAY_BUFFER,o.__webglVertexBuffer),l(n.position),z.vertexAttribPointer(n.position,3,z.FLOAT,!1,0,0)),a.morphTargetForcedOrder.length){var f=0;for(c=a.morphTargetForcedOrder,s=a.morphTargetInfluences;f<r.numSupportedMorphTargets&&f<c.length;)0<=n["morphTarget"+f]&&(z.bindBuffer(z.ARRAY_BUFFER,o.__webglMorphTargetsBuffers[c[f]]),l(n["morphTarget"+f]),z.vertexAttribPointer(n["morphTarget"+f],3,z.FLOAT,!1,0,0)),0<=n["morphNormal"+f]&&r.morphNormals&&(z.bindBuffer(z.ARRAY_BUFFER,o.__webglMorphNormalsBuffers[c[f]]),l(n["morphNormal"+f]),z.vertexAttribPointer(n["morphNormal"+f],3,z.FLOAT,!1,0,0)),a.__webglMorphTargetInfluences[f]=s[c[f]],f++}else{c=[],s=a.morphTargetInfluences;var p,d=s.length;for(p=0;d>p;p++)f=s[p],f>0&&c.push([f,p]);for(c.length>r.numSupportedMorphTargets?(c.sort(h),c.length=r.numSupportedMorphTargets):c.length>r.numSupportedMorphNormals?c.sort(h):0===c.length&&c.push([0,0]),f=0;f<r.numSupportedMorphTargets;)c[f]?(p=c[f][1],0<=n["morphTarget"+f]&&(z.bindBuffer(z.ARRAY_BUFFER,o.__webglMorphTargetsBuffers[p]),l(n["morphTarget"+f]),z.vertexAttribPointer(n["morphTarget"+f],3,z.FLOAT,!1,0,0)),0<=n["morphNormal"+f]&&r.morphNormals&&(z.bindBuffer(z.ARRAY_BUFFER,o.__webglMorphNormalsBuffers[p]),l(n["morphNormal"+f]),z.vertexAttribPointer(n["morphNormal"+f],3,z.FLOAT,!1,0,0)),a.__webglMorphTargetInfluences[f]=s[p]):a.__webglMorphTargetInfluences[f]=0,f++}null!==r.program.uniforms.morphTargetInfluences&&z.uniform1fv(r.program.uniforms.morphTargetInfluences,a.__webglMorphTargetInfluences)}if(i){if(o.__webglCustomAttributesList)for(s=0,c=o.__webglCustomAttributesList.length;c>s;s++)n=o.__webglCustomAttributesList[s],0<=t[n.buffer.belongsToAttribute]&&(z.bindBuffer(z.ARRAY_BUFFER,n.buffer),l(t[n.buffer.belongsToAttribute]),z.vertexAttribPointer(t[n.buffer.belongsToAttribute],n.size,z.FLOAT,!1,0,0));0<=t.color&&(z.bindBuffer(z.ARRAY_BUFFER,o.__webglColorBuffer),l(t.color),z.vertexAttribPointer(t.color,3,z.FLOAT,!1,0,0)),0<=t.normal&&(z.bindBuffer(z.ARRAY_BUFFER,o.__webglNormalBuffer),l(t.normal),z.vertexAttribPointer(t.normal,3,z.FLOAT,!1,0,0)),0<=t.tangent&&(z.bindBuffer(z.ARRAY_BUFFER,o.__webglTangentBuffer),l(t.tangent),z.vertexAttribPointer(t.tangent,4,z.FLOAT,!1,0,0)),0<=t.uv&&(z.bindBuffer(z.ARRAY_BUFFER,o.__webglUVBuffer),l(t.uv),z.vertexAttribPointer(t.uv,2,z.FLOAT,!1,0,0)),0<=t.uv2&&(z.bindBuffer(z.ARRAY_BUFFER,o.__webglUV2Buffer),l(t.uv2),z.vertexAttribPointer(t.uv2,2,z.FLOAT,!1,0,0)),r.skinning&&0<=t.skinIndex&&0<=t.skinWeight&&(z.bindBuffer(z.ARRAY_BUFFER,o.__webglSkinIndicesBuffer),l(t.skinIndex),z.vertexAttribPointer(t.skinIndex,4,z.FLOAT,!1,0,0),z.bindBuffer(z.ARRAY_BUFFER,o.__webglSkinWeightsBuffer),l(t.skinWeight),z.vertexAttribPointer(t.skinWeight,4,z.FLOAT,!1,0,0)),0<=t.lineDistance&&(z.bindBuffer(z.ARRAY_BUFFER,o.__webglLineDistanceBuffer),l(t.lineDistance),z.vertexAttribPointer(t.lineDistance,1,z.FLOAT,!1,0,0))}a instanceof e.Mesh?(r.wireframe?(A(r.wireframeLinewidth),i&&z.bindBuffer(z.ELEMENT_ARRAY_BUFFER,o.__webglLineBuffer),z.drawElements(z.LINES,o.__webglLineCount,z.UNSIGNED_SHORT,0)):(i&&z.bindBuffer(z.ELEMENT_ARRAY_BUFFER,o.__webglFaceBuffer),z.drawElements(z.TRIANGLES,o.__webglFaceCount,z.UNSIGNED_SHORT,0)),Y.info.render.calls++,Y.info.render.vertices+=o.__webglFaceCount,Y.info.render.faces+=o.__webglFaceCount/3):a instanceof e.Line?(a=a.type===e.LineStrip?z.LINE_STRIP:z.LINES,A(r.linewidth),z.drawArrays(a,0,o.__webglLineCount),Y.info.render.calls++):a instanceof e.ParticleSystem?(z.drawArrays(z.POINTS,0,o.__webglParticleCount),Y.info.render.calls++,Y.info.render.points+=o.__webglParticleCount):a instanceof e.Ribbon&&(z.drawArrays(z.TRIANGLE_STRIP,0,o.__webglVertexCount),Y.info.render.calls++)
}},this.render=function(t,i,n,r){if(!1==i instanceof e.Camera)console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else{var o,a,s,l,u=t.__lights,h=t.fog;for(J=-1,Et=!0,!0===t.autoUpdate&&t.updateMatrixWorld(),void 0===i.parent&&i.updateMatrixWorld(),i.matrixWorldInverse.getInverse(i.matrixWorld),Mt.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),St.setFromMatrix(Mt),this.autoUpdateObjects&&this.initWebGLObjects(t),f(this.renderPluginsPre,t,i),Y.info.render.calls=0,Y.info.render.vertices=0,Y.info.render.faces=0,Y.info.render.points=0,this.setRenderTarget(n),(this.autoClear||r)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),l=t.__webglObjects,r=0,o=l.length;o>r;r++)if(a=l[r],s=a.object,a.id=r,a.render=!1,s.visible&&(!(s instanceof e.Mesh||s instanceof e.ParticleSystem)||!s.frustumCulled||St.intersectsObject(s))){var m=s;m._modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,m.matrixWorld),m._normalMatrix.getNormalMatrix(m._modelViewMatrix);var m=a,g=m.buffer,v=void 0,y=v=void 0,y=m.object.material;y instanceof e.MeshFaceMaterial?(v=g.materialIndex,v=y.materials[v],v.transparent?(m.transparent=v,m.opaque=null):(m.opaque=v,m.transparent=null)):(v=y)&&(v.transparent?(m.transparent=v,m.opaque=null):(m.opaque=v,m.transparent=null)),a.render=!0,!0===this.sortObjects&&(null!==s.renderDepth?a.z=s.renderDepth:(At.getPositionFromMatrix(s.matrixWorld),At.applyProjection(Mt),a.z=At.z))}for(this.sortObjects&&l.sort(c),l=t.__webglObjectsImmediate,r=0,o=l.length;o>r;r++)a=l[r],s=a.object,s.visible&&(s._modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,s.matrixWorld),s._normalMatrix.getNormalMatrix(s._modelViewMatrix),s=a.object.material,s.transparent?(a.transparent=s,a.opaque=null):(a.opaque=s,a.transparent=null));t.overrideMaterial?(r=t.overrideMaterial,this.setBlending(r.blending,r.blendEquation,r.blendSrc,r.blendDst),this.setDepthTest(r.depthTest),this.setDepthWrite(r.depthWrite),T(r.polygonOffset,r.polygonOffsetFactor,r.polygonOffsetUnits),p(t.__webglObjects,!1,"",i,u,h,!0,r),d(t.__webglObjectsImmediate,"",i,u,h,!1,r)):(r=null,this.setBlending(e.NoBlending),p(t.__webglObjects,!0,"opaque",i,u,h,!1,r),d(t.__webglObjectsImmediate,"opaque",i,u,h,!1,r),p(t.__webglObjects,!1,"transparent",i,u,h,!0,r),d(t.__webglObjectsImmediate,"transparent",i,u,h,!0,r)),f(this.renderPluginsPost,t,i),n&&n.generateMipmaps&&n.minFilter!==e.NearestFilter&&n.minFilter!==e.LinearFilter&&(n instanceof e.WebGLRenderTargetCube?(z.bindTexture(z.TEXTURE_CUBE_MAP,n.__webglTexture),z.generateMipmap(z.TEXTURE_CUBE_MAP),z.bindTexture(z.TEXTURE_CUBE_MAP,null)):(z.bindTexture(z.TEXTURE_2D,n.__webglTexture),z.generateMipmap(z.TEXTURE_2D),z.bindTexture(z.TEXTURE_2D,null))),this.setDepthTest(!0),this.setDepthWrite(!0)}},this.renderImmediateObject=function(e,t,i,n,r){var o=_(e,t,i,n,r);et=-1,Y.setMaterialFaces(n),r.immediateRenderCallback?r.immediateRenderCallback(o,z,St):r.render(function(e){Y.renderBufferImmediate(e,o,n)})},this.initWebGLObjects=function(t){for(t.__webglObjects||(t.__webglObjects=[],t.__webglObjectsImmediate=[],t.__webglSprites=[],t.__webglFlares=[]);t.__objectsAdded.length;)m(t.__objectsAdded[0],t),t.__objectsAdded.splice(0,1);for(;t.__objectsRemoved.length;)b(t.__objectsRemoved[0],t),t.__objectsRemoved.splice(0,1);for(var i=0,n=t.__webglObjects.length;n>i;i++){var l=t.__webglObjects[i].object;void 0===l.__webglInit&&(void 0!==l.__webglActive&&b(l,t),m(l,t));var u=l,c=u.geometry,f=void 0,p=void 0,d=void 0;if(c instanceof e.BufferGeometry){var g=z.DYNAMIC_DRAW,x=!c.dynamic,w=c.attributes,_=void 0,S=void 0;for(_ in w)S=w[_],S.needsUpdate&&("index"===_?(z.bindBuffer(z.ELEMENT_ARRAY_BUFFER,S.buffer),z.bufferData(z.ELEMENT_ARRAY_BUFFER,S.array,g)):(z.bindBuffer(z.ARRAY_BUFFER,S.buffer),z.bufferData(z.ARRAY_BUFFER,S.array,g)),S.needsUpdate=!1),x&&!S.dynamic&&delete S.array}else if(u instanceof e.Mesh){for(var M=0,C=c.geometryGroupsList.length;C>M;M++)if(f=c.geometryGroupsList[M],d=o(u,f),c.buffersNeedUpdate&&r(f,u),p=d.attributes&&v(d),c.verticesNeedUpdate||c.morphTargetsNeedUpdate||c.elementsNeedUpdate||c.uvsNeedUpdate||c.normalsNeedUpdate||c.colorsNeedUpdate||c.tangentsNeedUpdate||p){var A=f,T=u,E=z.DYNAMIC_DRAW,k=!c.dynamic,P=d;if(A.__inittedArrays){var R=a(P),L=P.vertexColors?P.vertexColors:!1,D=s(P),N=R===e.SmoothShading,F=void 0,G=void 0,O=void 0,j=void 0,I=void 0,V=void 0,U=void 0,B=void 0,q=void 0,H=void 0,W=void 0,X=void 0,Y=void 0,K=void 0,$=void 0,Q=void 0,Z=void 0,J=void 0,et=void 0,tt=void 0,it=void 0,nt=void 0,rt=void 0,ot=void 0,at=void 0,st=void 0,lt=void 0,ut=void 0,ct=void 0,ht=void 0,ft=void 0,pt=void 0,dt=void 0,mt=void 0,gt=void 0,vt=void 0,yt=void 0,bt=void 0,xt=void 0,wt=void 0,_t=void 0,St=void 0,Tt=void 0,Et=void 0,kt=void 0,Pt=void 0,Rt=0,Lt=0,Dt=0,Nt=0,Ft=0,Gt=0,Ot=0,jt=0,It=0,Vt=0,Ut=0,Bt=0,zt=void 0,qt=A.__vertexArray,Ht=A.__uvArray,Wt=A.__uv2Array,Xt=A.__normalArray,Yt=A.__tangentArray,Kt=A.__colorArray,$t=A.__skinIndexArray,Qt=A.__skinWeightArray,Zt=A.__morphTargetsArrays,Jt=A.__morphNormalsArrays,ei=A.__webglCustomAttributesList,ti=void 0,ii=A.__faceArray,ni=A.__lineArray,ri=T.geometry,oi=ri.elementsNeedUpdate,ai=ri.uvsNeedUpdate,si=ri.normalsNeedUpdate,li=ri.tangentsNeedUpdate,ui=ri.colorsNeedUpdate,ci=ri.morphTargetsNeedUpdate,hi=ri.vertices,fi=A.faces3,pi=A.faces4,di=ri.faces,mi=ri.faceVertexUvs[0],gi=ri.faceVertexUvs[1],vi=ri.skinIndices,yi=ri.skinWeights,bi=ri.morphTargets,xi=ri.morphNormals;if(ri.verticesNeedUpdate){for(F=0,G=fi.length;G>F;F++)j=di[fi[F]],X=hi[j.a],Y=hi[j.b],K=hi[j.c],qt[Lt]=X.x,qt[Lt+1]=X.y,qt[Lt+2]=X.z,qt[Lt+3]=Y.x,qt[Lt+4]=Y.y,qt[Lt+5]=Y.z,qt[Lt+6]=K.x,qt[Lt+7]=K.y,qt[Lt+8]=K.z,Lt+=9;for(F=0,G=pi.length;G>F;F++)j=di[pi[F]],X=hi[j.a],Y=hi[j.b],K=hi[j.c],$=hi[j.d],qt[Lt]=X.x,qt[Lt+1]=X.y,qt[Lt+2]=X.z,qt[Lt+3]=Y.x,qt[Lt+4]=Y.y,qt[Lt+5]=Y.z,qt[Lt+6]=K.x,qt[Lt+7]=K.y,qt[Lt+8]=K.z,qt[Lt+9]=$.x,qt[Lt+10]=$.y,qt[Lt+11]=$.z,Lt+=12;z.bindBuffer(z.ARRAY_BUFFER,A.__webglVertexBuffer),z.bufferData(z.ARRAY_BUFFER,qt,E)}if(ci)for(_t=0,St=bi.length;St>_t;_t++){for(F=Ut=0,G=fi.length;G>F;F++)kt=fi[F],j=di[kt],X=bi[_t].vertices[j.a],Y=bi[_t].vertices[j.b],K=bi[_t].vertices[j.c],Tt=Zt[_t],Tt[Ut]=X.x,Tt[Ut+1]=X.y,Tt[Ut+2]=X.z,Tt[Ut+3]=Y.x,Tt[Ut+4]=Y.y,Tt[Ut+5]=Y.z,Tt[Ut+6]=K.x,Tt[Ut+7]=K.y,Tt[Ut+8]=K.z,P.morphNormals&&(N?(Pt=xi[_t].vertexNormals[kt],tt=Pt.a,it=Pt.b,nt=Pt.c):nt=it=tt=xi[_t].faceNormals[kt],Et=Jt[_t],Et[Ut]=tt.x,Et[Ut+1]=tt.y,Et[Ut+2]=tt.z,Et[Ut+3]=it.x,Et[Ut+4]=it.y,Et[Ut+5]=it.z,Et[Ut+6]=nt.x,Et[Ut+7]=nt.y,Et[Ut+8]=nt.z),Ut+=9;for(F=0,G=pi.length;G>F;F++)kt=pi[F],j=di[kt],X=bi[_t].vertices[j.a],Y=bi[_t].vertices[j.b],K=bi[_t].vertices[j.c],$=bi[_t].vertices[j.d],Tt=Zt[_t],Tt[Ut]=X.x,Tt[Ut+1]=X.y,Tt[Ut+2]=X.z,Tt[Ut+3]=Y.x,Tt[Ut+4]=Y.y,Tt[Ut+5]=Y.z,Tt[Ut+6]=K.x,Tt[Ut+7]=K.y,Tt[Ut+8]=K.z,Tt[Ut+9]=$.x,Tt[Ut+10]=$.y,Tt[Ut+11]=$.z,P.morphNormals&&(N?(Pt=xi[_t].vertexNormals[kt],tt=Pt.a,it=Pt.b,nt=Pt.c,rt=Pt.d):rt=nt=it=tt=xi[_t].faceNormals[kt],Et=Jt[_t],Et[Ut]=tt.x,Et[Ut+1]=tt.y,Et[Ut+2]=tt.z,Et[Ut+3]=it.x,Et[Ut+4]=it.y,Et[Ut+5]=it.z,Et[Ut+6]=nt.x,Et[Ut+7]=nt.y,Et[Ut+8]=nt.z,Et[Ut+9]=rt.x,Et[Ut+10]=rt.y,Et[Ut+11]=rt.z),Ut+=12;z.bindBuffer(z.ARRAY_BUFFER,A.__webglMorphTargetsBuffers[_t]),z.bufferData(z.ARRAY_BUFFER,Zt[_t],E),P.morphNormals&&(z.bindBuffer(z.ARRAY_BUFFER,A.__webglMorphNormalsBuffers[_t]),z.bufferData(z.ARRAY_BUFFER,Jt[_t],E))}if(yi.length){for(F=0,G=fi.length;G>F;F++)j=di[fi[F]],ut=yi[j.a],ct=yi[j.b],ht=yi[j.c],Qt[Vt]=ut.x,Qt[Vt+1]=ut.y,Qt[Vt+2]=ut.z,Qt[Vt+3]=ut.w,Qt[Vt+4]=ct.x,Qt[Vt+5]=ct.y,Qt[Vt+6]=ct.z,Qt[Vt+7]=ct.w,Qt[Vt+8]=ht.x,Qt[Vt+9]=ht.y,Qt[Vt+10]=ht.z,Qt[Vt+11]=ht.w,pt=vi[j.a],dt=vi[j.b],mt=vi[j.c],$t[Vt]=pt.x,$t[Vt+1]=pt.y,$t[Vt+2]=pt.z,$t[Vt+3]=pt.w,$t[Vt+4]=dt.x,$t[Vt+5]=dt.y,$t[Vt+6]=dt.z,$t[Vt+7]=dt.w,$t[Vt+8]=mt.x,$t[Vt+9]=mt.y,$t[Vt+10]=mt.z,$t[Vt+11]=mt.w,Vt+=12;for(F=0,G=pi.length;G>F;F++)j=di[pi[F]],ut=yi[j.a],ct=yi[j.b],ht=yi[j.c],ft=yi[j.d],Qt[Vt]=ut.x,Qt[Vt+1]=ut.y,Qt[Vt+2]=ut.z,Qt[Vt+3]=ut.w,Qt[Vt+4]=ct.x,Qt[Vt+5]=ct.y,Qt[Vt+6]=ct.z,Qt[Vt+7]=ct.w,Qt[Vt+8]=ht.x,Qt[Vt+9]=ht.y,Qt[Vt+10]=ht.z,Qt[Vt+11]=ht.w,Qt[Vt+12]=ft.x,Qt[Vt+13]=ft.y,Qt[Vt+14]=ft.z,Qt[Vt+15]=ft.w,pt=vi[j.a],dt=vi[j.b],mt=vi[j.c],gt=vi[j.d],$t[Vt]=pt.x,$t[Vt+1]=pt.y,$t[Vt+2]=pt.z,$t[Vt+3]=pt.w,$t[Vt+4]=dt.x,$t[Vt+5]=dt.y,$t[Vt+6]=dt.z,$t[Vt+7]=dt.w,$t[Vt+8]=mt.x,$t[Vt+9]=mt.y,$t[Vt+10]=mt.z,$t[Vt+11]=mt.w,$t[Vt+12]=gt.x,$t[Vt+13]=gt.y,$t[Vt+14]=gt.z,$t[Vt+15]=gt.w,Vt+=16;Vt>0&&(z.bindBuffer(z.ARRAY_BUFFER,A.__webglSkinIndicesBuffer),z.bufferData(z.ARRAY_BUFFER,$t,E),z.bindBuffer(z.ARRAY_BUFFER,A.__webglSkinWeightsBuffer),z.bufferData(z.ARRAY_BUFFER,Qt,E))}if(ui&&L){for(F=0,G=fi.length;G>F;F++)j=di[fi[F]],U=j.vertexColors,B=j.color,3===U.length&&L===e.VertexColors?(ot=U[0],at=U[1],st=U[2]):st=at=ot=B,Kt[It]=ot.r,Kt[It+1]=ot.g,Kt[It+2]=ot.b,Kt[It+3]=at.r,Kt[It+4]=at.g,Kt[It+5]=at.b,Kt[It+6]=st.r,Kt[It+7]=st.g,Kt[It+8]=st.b,It+=9;for(F=0,G=pi.length;G>F;F++)j=di[pi[F]],U=j.vertexColors,B=j.color,4===U.length&&L===e.VertexColors?(ot=U[0],at=U[1],st=U[2],lt=U[3]):lt=st=at=ot=B,Kt[It]=ot.r,Kt[It+1]=ot.g,Kt[It+2]=ot.b,Kt[It+3]=at.r,Kt[It+4]=at.g,Kt[It+5]=at.b,Kt[It+6]=st.r,Kt[It+7]=st.g,Kt[It+8]=st.b,Kt[It+9]=lt.r,Kt[It+10]=lt.g,Kt[It+11]=lt.b,It+=12;It>0&&(z.bindBuffer(z.ARRAY_BUFFER,A.__webglColorBuffer),z.bufferData(z.ARRAY_BUFFER,Kt,E))}if(li&&ri.hasTangents){for(F=0,G=fi.length;G>F;F++)j=di[fi[F]],q=j.vertexTangents,Q=q[0],Z=q[1],J=q[2],Yt[Ot]=Q.x,Yt[Ot+1]=Q.y,Yt[Ot+2]=Q.z,Yt[Ot+3]=Q.w,Yt[Ot+4]=Z.x,Yt[Ot+5]=Z.y,Yt[Ot+6]=Z.z,Yt[Ot+7]=Z.w,Yt[Ot+8]=J.x,Yt[Ot+9]=J.y,Yt[Ot+10]=J.z,Yt[Ot+11]=J.w,Ot+=12;for(F=0,G=pi.length;G>F;F++)j=di[pi[F]],q=j.vertexTangents,Q=q[0],Z=q[1],J=q[2],et=q[3],Yt[Ot]=Q.x,Yt[Ot+1]=Q.y,Yt[Ot+2]=Q.z,Yt[Ot+3]=Q.w,Yt[Ot+4]=Z.x,Yt[Ot+5]=Z.y,Yt[Ot+6]=Z.z,Yt[Ot+7]=Z.w,Yt[Ot+8]=J.x,Yt[Ot+9]=J.y,Yt[Ot+10]=J.z,Yt[Ot+11]=J.w,Yt[Ot+12]=et.x,Yt[Ot+13]=et.y,Yt[Ot+14]=et.z,Yt[Ot+15]=et.w,Ot+=16;z.bindBuffer(z.ARRAY_BUFFER,A.__webglTangentBuffer),z.bufferData(z.ARRAY_BUFFER,Yt,E)}if(si&&R){for(F=0,G=fi.length;G>F;F++)if(j=di[fi[F]],I=j.vertexNormals,V=j.normal,3===I.length&&N)for(vt=0;3>vt;vt++)bt=I[vt],Xt[Gt]=bt.x,Xt[Gt+1]=bt.y,Xt[Gt+2]=bt.z,Gt+=3;else for(vt=0;3>vt;vt++)Xt[Gt]=V.x,Xt[Gt+1]=V.y,Xt[Gt+2]=V.z,Gt+=3;for(F=0,G=pi.length;G>F;F++)if(j=di[pi[F]],I=j.vertexNormals,V=j.normal,4===I.length&&N)for(vt=0;4>vt;vt++)bt=I[vt],Xt[Gt]=bt.x,Xt[Gt+1]=bt.y,Xt[Gt+2]=bt.z,Gt+=3;else for(vt=0;4>vt;vt++)Xt[Gt]=V.x,Xt[Gt+1]=V.y,Xt[Gt+2]=V.z,Gt+=3;z.bindBuffer(z.ARRAY_BUFFER,A.__webglNormalBuffer),z.bufferData(z.ARRAY_BUFFER,Xt,E)}if(ai&&mi&&D){for(F=0,G=fi.length;G>F;F++)if(O=fi[F],H=mi[O],void 0!==H)for(vt=0;3>vt;vt++)xt=H[vt],Ht[Dt]=xt.x,Ht[Dt+1]=xt.y,Dt+=2;for(F=0,G=pi.length;G>F;F++)if(O=pi[F],H=mi[O],void 0!==H)for(vt=0;4>vt;vt++)xt=H[vt],Ht[Dt]=xt.x,Ht[Dt+1]=xt.y,Dt+=2;Dt>0&&(z.bindBuffer(z.ARRAY_BUFFER,A.__webglUVBuffer),z.bufferData(z.ARRAY_BUFFER,Ht,E))}if(ai&&gi&&D){for(F=0,G=fi.length;G>F;F++)if(O=fi[F],W=gi[O],void 0!==W)for(vt=0;3>vt;vt++)wt=W[vt],Wt[Nt]=wt.x,Wt[Nt+1]=wt.y,Nt+=2;for(F=0,G=pi.length;G>F;F++)if(O=pi[F],W=gi[O],void 0!==W)for(vt=0;4>vt;vt++)wt=W[vt],Wt[Nt]=wt.x,Wt[Nt+1]=wt.y,Nt+=2;Nt>0&&(z.bindBuffer(z.ARRAY_BUFFER,A.__webglUV2Buffer),z.bufferData(z.ARRAY_BUFFER,Wt,E))}if(oi){for(F=0,G=fi.length;G>F;F++)ii[Ft]=Rt,ii[Ft+1]=Rt+1,ii[Ft+2]=Rt+2,Ft+=3,ni[jt]=Rt,ni[jt+1]=Rt+1,ni[jt+2]=Rt,ni[jt+3]=Rt+2,ni[jt+4]=Rt+1,ni[jt+5]=Rt+2,jt+=6,Rt+=3;for(F=0,G=pi.length;G>F;F++)ii[Ft]=Rt,ii[Ft+1]=Rt+1,ii[Ft+2]=Rt+3,ii[Ft+3]=Rt+1,ii[Ft+4]=Rt+2,ii[Ft+5]=Rt+3,Ft+=6,ni[jt]=Rt,ni[jt+1]=Rt+1,ni[jt+2]=Rt,ni[jt+3]=Rt+3,ni[jt+4]=Rt+1,ni[jt+5]=Rt+2,ni[jt+6]=Rt+2,ni[jt+7]=Rt+3,jt+=8,Rt+=4;z.bindBuffer(z.ELEMENT_ARRAY_BUFFER,A.__webglFaceBuffer),z.bufferData(z.ELEMENT_ARRAY_BUFFER,ii,E),z.bindBuffer(z.ELEMENT_ARRAY_BUFFER,A.__webglLineBuffer),z.bufferData(z.ELEMENT_ARRAY_BUFFER,ni,E)}if(ei)for(vt=0,yt=ei.length;yt>vt;vt++)if(ti=ei[vt],ti.__original.needsUpdate){if(Bt=0,1===ti.size){if(void 0===ti.boundTo||"vertices"===ti.boundTo){for(F=0,G=fi.length;G>F;F++)j=di[fi[F]],ti.array[Bt]=ti.value[j.a],ti.array[Bt+1]=ti.value[j.b],ti.array[Bt+2]=ti.value[j.c],Bt+=3;for(F=0,G=pi.length;G>F;F++)j=di[pi[F]],ti.array[Bt]=ti.value[j.a],ti.array[Bt+1]=ti.value[j.b],ti.array[Bt+2]=ti.value[j.c],ti.array[Bt+3]=ti.value[j.d],Bt+=4}else if("faces"===ti.boundTo){for(F=0,G=fi.length;G>F;F++)zt=ti.value[fi[F]],ti.array[Bt]=zt,ti.array[Bt+1]=zt,ti.array[Bt+2]=zt,Bt+=3;for(F=0,G=pi.length;G>F;F++)zt=ti.value[pi[F]],ti.array[Bt]=zt,ti.array[Bt+1]=zt,ti.array[Bt+2]=zt,ti.array[Bt+3]=zt,Bt+=4}}else if(2===ti.size){if(void 0===ti.boundTo||"vertices"===ti.boundTo){for(F=0,G=fi.length;G>F;F++)j=di[fi[F]],X=ti.value[j.a],Y=ti.value[j.b],K=ti.value[j.c],ti.array[Bt]=X.x,ti.array[Bt+1]=X.y,ti.array[Bt+2]=Y.x,ti.array[Bt+3]=Y.y,ti.array[Bt+4]=K.x,ti.array[Bt+5]=K.y,Bt+=6;for(F=0,G=pi.length;G>F;F++)j=di[pi[F]],X=ti.value[j.a],Y=ti.value[j.b],K=ti.value[j.c],$=ti.value[j.d],ti.array[Bt]=X.x,ti.array[Bt+1]=X.y,ti.array[Bt+2]=Y.x,ti.array[Bt+3]=Y.y,ti.array[Bt+4]=K.x,ti.array[Bt+5]=K.y,ti.array[Bt+6]=$.x,ti.array[Bt+7]=$.y,Bt+=8}else if("faces"===ti.boundTo){for(F=0,G=fi.length;G>F;F++)K=Y=X=zt=ti.value[fi[F]],ti.array[Bt]=X.x,ti.array[Bt+1]=X.y,ti.array[Bt+2]=Y.x,ti.array[Bt+3]=Y.y,ti.array[Bt+4]=K.x,ti.array[Bt+5]=K.y,Bt+=6;for(F=0,G=pi.length;G>F;F++)$=K=Y=X=zt=ti.value[pi[F]],ti.array[Bt]=X.x,ti.array[Bt+1]=X.y,ti.array[Bt+2]=Y.x,ti.array[Bt+3]=Y.y,ti.array[Bt+4]=K.x,ti.array[Bt+5]=K.y,ti.array[Bt+6]=$.x,ti.array[Bt+7]=$.y,Bt+=8}}else if(3===ti.size){var wi;if(wi="c"===ti.type?["r","g","b"]:["x","y","z"],void 0===ti.boundTo||"vertices"===ti.boundTo){for(F=0,G=fi.length;G>F;F++)j=di[fi[F]],X=ti.value[j.a],Y=ti.value[j.b],K=ti.value[j.c],ti.array[Bt]=X[wi[0]],ti.array[Bt+1]=X[wi[1]],ti.array[Bt+2]=X[wi[2]],ti.array[Bt+3]=Y[wi[0]],ti.array[Bt+4]=Y[wi[1]],ti.array[Bt+5]=Y[wi[2]],ti.array[Bt+6]=K[wi[0]],ti.array[Bt+7]=K[wi[1]],ti.array[Bt+8]=K[wi[2]],Bt+=9;for(F=0,G=pi.length;G>F;F++)j=di[pi[F]],X=ti.value[j.a],Y=ti.value[j.b],K=ti.value[j.c],$=ti.value[j.d],ti.array[Bt]=X[wi[0]],ti.array[Bt+1]=X[wi[1]],ti.array[Bt+2]=X[wi[2]],ti.array[Bt+3]=Y[wi[0]],ti.array[Bt+4]=Y[wi[1]],ti.array[Bt+5]=Y[wi[2]],ti.array[Bt+6]=K[wi[0]],ti.array[Bt+7]=K[wi[1]],ti.array[Bt+8]=K[wi[2]],ti.array[Bt+9]=$[wi[0]],ti.array[Bt+10]=$[wi[1]],ti.array[Bt+11]=$[wi[2]],Bt+=12}else if("faces"===ti.boundTo){for(F=0,G=fi.length;G>F;F++)K=Y=X=zt=ti.value[fi[F]],ti.array[Bt]=X[wi[0]],ti.array[Bt+1]=X[wi[1]],ti.array[Bt+2]=X[wi[2]],ti.array[Bt+3]=Y[wi[0]],ti.array[Bt+4]=Y[wi[1]],ti.array[Bt+5]=Y[wi[2]],ti.array[Bt+6]=K[wi[0]],ti.array[Bt+7]=K[wi[1]],ti.array[Bt+8]=K[wi[2]],Bt+=9;for(F=0,G=pi.length;G>F;F++)$=K=Y=X=zt=ti.value[pi[F]],ti.array[Bt]=X[wi[0]],ti.array[Bt+1]=X[wi[1]],ti.array[Bt+2]=X[wi[2]],ti.array[Bt+3]=Y[wi[0]],ti.array[Bt+4]=Y[wi[1]],ti.array[Bt+5]=Y[wi[2]],ti.array[Bt+6]=K[wi[0]],ti.array[Bt+7]=K[wi[1]],ti.array[Bt+8]=K[wi[2]],ti.array[Bt+9]=$[wi[0]],ti.array[Bt+10]=$[wi[1]],ti.array[Bt+11]=$[wi[2]],Bt+=12}else if("faceVertices"===ti.boundTo){for(F=0,G=fi.length;G>F;F++)zt=ti.value[fi[F]],X=zt[0],Y=zt[1],K=zt[2],ti.array[Bt]=X[wi[0]],ti.array[Bt+1]=X[wi[1]],ti.array[Bt+2]=X[wi[2]],ti.array[Bt+3]=Y[wi[0]],ti.array[Bt+4]=Y[wi[1]],ti.array[Bt+5]=Y[wi[2]],ti.array[Bt+6]=K[wi[0]],ti.array[Bt+7]=K[wi[1]],ti.array[Bt+8]=K[wi[2]],Bt+=9;for(F=0,G=pi.length;G>F;F++)zt=ti.value[pi[F]],X=zt[0],Y=zt[1],K=zt[2],$=zt[3],ti.array[Bt]=X[wi[0]],ti.array[Bt+1]=X[wi[1]],ti.array[Bt+2]=X[wi[2]],ti.array[Bt+3]=Y[wi[0]],ti.array[Bt+4]=Y[wi[1]],ti.array[Bt+5]=Y[wi[2]],ti.array[Bt+6]=K[wi[0]],ti.array[Bt+7]=K[wi[1]],ti.array[Bt+8]=K[wi[2]],ti.array[Bt+9]=$[wi[0]],ti.array[Bt+10]=$[wi[1]],ti.array[Bt+11]=$[wi[2]],Bt+=12}}else if(4===ti.size)if(void 0===ti.boundTo||"vertices"===ti.boundTo){for(F=0,G=fi.length;G>F;F++)j=di[fi[F]],X=ti.value[j.a],Y=ti.value[j.b],K=ti.value[j.c],ti.array[Bt]=X.x,ti.array[Bt+1]=X.y,ti.array[Bt+2]=X.z,ti.array[Bt+3]=X.w,ti.array[Bt+4]=Y.x,ti.array[Bt+5]=Y.y,ti.array[Bt+6]=Y.z,ti.array[Bt+7]=Y.w,ti.array[Bt+8]=K.x,ti.array[Bt+9]=K.y,ti.array[Bt+10]=K.z,ti.array[Bt+11]=K.w,Bt+=12;for(F=0,G=pi.length;G>F;F++)j=di[pi[F]],X=ti.value[j.a],Y=ti.value[j.b],K=ti.value[j.c],$=ti.value[j.d],ti.array[Bt]=X.x,ti.array[Bt+1]=X.y,ti.array[Bt+2]=X.z,ti.array[Bt+3]=X.w,ti.array[Bt+4]=Y.x,ti.array[Bt+5]=Y.y,ti.array[Bt+6]=Y.z,ti.array[Bt+7]=Y.w,ti.array[Bt+8]=K.x,ti.array[Bt+9]=K.y,ti.array[Bt+10]=K.z,ti.array[Bt+11]=K.w,ti.array[Bt+12]=$.x,ti.array[Bt+13]=$.y,ti.array[Bt+14]=$.z,ti.array[Bt+15]=$.w,Bt+=16}else if("faces"===ti.boundTo){for(F=0,G=fi.length;G>F;F++)K=Y=X=zt=ti.value[fi[F]],ti.array[Bt]=X.x,ti.array[Bt+1]=X.y,ti.array[Bt+2]=X.z,ti.array[Bt+3]=X.w,ti.array[Bt+4]=Y.x,ti.array[Bt+5]=Y.y,ti.array[Bt+6]=Y.z,ti.array[Bt+7]=Y.w,ti.array[Bt+8]=K.x,ti.array[Bt+9]=K.y,ti.array[Bt+10]=K.z,ti.array[Bt+11]=K.w,Bt+=12;for(F=0,G=pi.length;G>F;F++)$=K=Y=X=zt=ti.value[pi[F]],ti.array[Bt]=X.x,ti.array[Bt+1]=X.y,ti.array[Bt+2]=X.z,ti.array[Bt+3]=X.w,ti.array[Bt+4]=Y.x,ti.array[Bt+5]=Y.y,ti.array[Bt+6]=Y.z,ti.array[Bt+7]=Y.w,ti.array[Bt+8]=K.x,ti.array[Bt+9]=K.y,ti.array[Bt+10]=K.z,ti.array[Bt+11]=K.w,ti.array[Bt+12]=$.x,ti.array[Bt+13]=$.y,ti.array[Bt+14]=$.z,ti.array[Bt+15]=$.w,Bt+=16}else if("faceVertices"===ti.boundTo){for(F=0,G=fi.length;G>F;F++)zt=ti.value[fi[F]],X=zt[0],Y=zt[1],K=zt[2],ti.array[Bt]=X.x,ti.array[Bt+1]=X.y,ti.array[Bt+2]=X.z,ti.array[Bt+3]=X.w,ti.array[Bt+4]=Y.x,ti.array[Bt+5]=Y.y,ti.array[Bt+6]=Y.z,ti.array[Bt+7]=Y.w,ti.array[Bt+8]=K.x,ti.array[Bt+9]=K.y,ti.array[Bt+10]=K.z,ti.array[Bt+11]=K.w,Bt+=12;for(F=0,G=pi.length;G>F;F++)zt=ti.value[pi[F]],X=zt[0],Y=zt[1],K=zt[2],$=zt[3],ti.array[Bt]=X.x,ti.array[Bt+1]=X.y,ti.array[Bt+2]=X.z,ti.array[Bt+3]=X.w,ti.array[Bt+4]=Y.x,ti.array[Bt+5]=Y.y,ti.array[Bt+6]=Y.z,ti.array[Bt+7]=Y.w,ti.array[Bt+8]=K.x,ti.array[Bt+9]=K.y,ti.array[Bt+10]=K.z,ti.array[Bt+11]=K.w,ti.array[Bt+12]=$.x,ti.array[Bt+13]=$.y,ti.array[Bt+14]=$.z,ti.array[Bt+15]=$.w,Bt+=16}z.bindBuffer(z.ARRAY_BUFFER,ti.buffer),z.bufferData(z.ARRAY_BUFFER,ti.array,E)}k&&(delete A.__inittedArrays,delete A.__colorArray,delete A.__normalArray,delete A.__tangentArray,delete A.__uvArray,delete A.__uv2Array,delete A.__faceArray,delete A.__vertexArray,delete A.__lineArray,delete A.__skinIndexArray,delete A.__skinWeightArray)}}c.verticesNeedUpdate=!1,c.morphTargetsNeedUpdate=!1,c.elementsNeedUpdate=!1,c.uvsNeedUpdate=!1,c.normalsNeedUpdate=!1,c.colorsNeedUpdate=!1,c.tangentsNeedUpdate=!1,c.buffersNeedUpdate=!1,d.attributes&&y(d)}else if(u instanceof e.Ribbon){if(d=o(u,c),p=d.attributes&&v(d),c.verticesNeedUpdate||c.colorsNeedUpdate||c.normalsNeedUpdate||p){var _i=c,Si=z.DYNAMIC_DRAW,Mi=void 0,Ci=void 0,Ai=void 0,Ti=void 0,Ei=void 0,ki=void 0,Pi=void 0,Ri=void 0,Li=void 0,Di=void 0,Ni=void 0,Fi=void 0,Gi=void 0,Oi=_i.vertices,ji=_i.colors,Ii=_i.normals,Vi=Oi.length,Ui=ji.length,Bi=Ii.length,zi=_i.__vertexArray,qi=_i.__colorArray,Hi=_i.__normalArray,Wi=_i.colorsNeedUpdate,Xi=_i.normalsNeedUpdate,Yi=_i.__webglCustomAttributesList;if(_i.verticesNeedUpdate){for(Mi=0;Vi>Mi;Mi++)Ti=Oi[Mi],Ei=3*Mi,zi[Ei]=Ti.x,zi[Ei+1]=Ti.y,zi[Ei+2]=Ti.z;z.bindBuffer(z.ARRAY_BUFFER,_i.__webglVertexBuffer),z.bufferData(z.ARRAY_BUFFER,zi,Si)}if(Wi){for(Ci=0;Ui>Ci;Ci++)ki=ji[Ci],Ei=3*Ci,qi[Ei]=ki.r,qi[Ei+1]=ki.g,qi[Ei+2]=ki.b;z.bindBuffer(z.ARRAY_BUFFER,_i.__webglColorBuffer),z.bufferData(z.ARRAY_BUFFER,qi,Si)}if(Xi){for(Ai=0;Bi>Ai;Ai++)Pi=Ii[Ai],Ei=3*Ai,Hi[Ei]=Pi.x,Hi[Ei+1]=Pi.y,Hi[Ei+2]=Pi.z;z.bindBuffer(z.ARRAY_BUFFER,_i.__webglNormalBuffer),z.bufferData(z.ARRAY_BUFFER,Hi,Si)}if(Yi)for(Ri=0,Li=Yi.length;Li>Ri;Ri++)if(Fi=Yi[Ri],Fi.needsUpdate&&(void 0===Fi.boundTo||"vertices"===Fi.boundTo)){if(Ei=0,Ni=Fi.value.length,1===Fi.size)for(Di=0;Ni>Di;Di++)Fi.array[Di]=Fi.value[Di];else if(2===Fi.size)for(Di=0;Ni>Di;Di++)Gi=Fi.value[Di],Fi.array[Ei]=Gi.x,Fi.array[Ei+1]=Gi.y,Ei+=2;else if(3===Fi.size)if("c"===Fi.type)for(Di=0;Ni>Di;Di++)Gi=Fi.value[Di],Fi.array[Ei]=Gi.r,Fi.array[Ei+1]=Gi.g,Fi.array[Ei+2]=Gi.b,Ei+=3;else for(Di=0;Ni>Di;Di++)Gi=Fi.value[Di],Fi.array[Ei]=Gi.x,Fi.array[Ei+1]=Gi.y,Fi.array[Ei+2]=Gi.z,Ei+=3;else if(4===Fi.size)for(Di=0;Ni>Di;Di++)Gi=Fi.value[Di],Fi.array[Ei]=Gi.x,Fi.array[Ei+1]=Gi.y,Fi.array[Ei+2]=Gi.z,Fi.array[Ei+3]=Gi.w,Ei+=4;z.bindBuffer(z.ARRAY_BUFFER,Fi.buffer),z.bufferData(z.ARRAY_BUFFER,Fi.array,Si)}}c.verticesNeedUpdate=!1,c.colorsNeedUpdate=!1,c.normalsNeedUpdate=!1,d.attributes&&y(d)}else if(u instanceof e.Line){if(d=o(u,c),p=d.attributes&&v(d),c.verticesNeedUpdate||c.colorsNeedUpdate||c.lineDistancesNeedUpdate||p){var Ki=c,$i=z.DYNAMIC_DRAW,Qi=void 0,Zi=void 0,Ji=void 0,en=void 0,tn=void 0,nn=void 0,rn=Ki.vertices,on=Ki.colors,an=Ki.lineDistances,sn=rn.length,ln=on.length,un=an.length,cn=Ki.__vertexArray,hn=Ki.__colorArray,fn=Ki.__lineDistanceArray,pn=Ki.colorsNeedUpdate,dn=Ki.lineDistancesNeedUpdate,mn=Ki.__webglCustomAttributesList,gn=void 0,vn=void 0,yn=void 0,bn=void 0,xn=void 0,wn=void 0;if(Ki.verticesNeedUpdate){for(Qi=0;sn>Qi;Qi++)en=rn[Qi],tn=3*Qi,cn[tn]=en.x,cn[tn+1]=en.y,cn[tn+2]=en.z;z.bindBuffer(z.ARRAY_BUFFER,Ki.__webglVertexBuffer),z.bufferData(z.ARRAY_BUFFER,cn,$i)}if(pn){for(Zi=0;ln>Zi;Zi++)nn=on[Zi],tn=3*Zi,hn[tn]=nn.r,hn[tn+1]=nn.g,hn[tn+2]=nn.b;z.bindBuffer(z.ARRAY_BUFFER,Ki.__webglColorBuffer),z.bufferData(z.ARRAY_BUFFER,hn,$i)}if(dn){for(Ji=0;un>Ji;Ji++)fn[Ji]=an[Ji];z.bindBuffer(z.ARRAY_BUFFER,Ki.__webglLineDistanceBuffer),z.bufferData(z.ARRAY_BUFFER,fn,$i)}if(mn)for(gn=0,vn=mn.length;vn>gn;gn++)if(wn=mn[gn],wn.needsUpdate&&(void 0===wn.boundTo||"vertices"===wn.boundTo)){if(tn=0,bn=wn.value.length,1===wn.size)for(yn=0;bn>yn;yn++)wn.array[yn]=wn.value[yn];else if(2===wn.size)for(yn=0;bn>yn;yn++)xn=wn.value[yn],wn.array[tn]=xn.x,wn.array[tn+1]=xn.y,tn+=2;else if(3===wn.size)if("c"===wn.type)for(yn=0;bn>yn;yn++)xn=wn.value[yn],wn.array[tn]=xn.r,wn.array[tn+1]=xn.g,wn.array[tn+2]=xn.b,tn+=3;else for(yn=0;bn>yn;yn++)xn=wn.value[yn],wn.array[tn]=xn.x,wn.array[tn+1]=xn.y,wn.array[tn+2]=xn.z,tn+=3;else if(4===wn.size)for(yn=0;bn>yn;yn++)xn=wn.value[yn],wn.array[tn]=xn.x,wn.array[tn+1]=xn.y,wn.array[tn+2]=xn.z,wn.array[tn+3]=xn.w,tn+=4;z.bindBuffer(z.ARRAY_BUFFER,wn.buffer),z.bufferData(z.ARRAY_BUFFER,wn.array,$i)}}c.verticesNeedUpdate=!1,c.colorsNeedUpdate=!1,c.lineDistancesNeedUpdate=!1,d.attributes&&y(d)}else if(u instanceof e.ParticleSystem){if(d=o(u,c),p=d.attributes&&v(d),c.verticesNeedUpdate||c.colorsNeedUpdate||u.sortParticles||p){var _n=c,Sn=z.DYNAMIC_DRAW,Mn=u,Cn=void 0,An=void 0,Tn=void 0,En=void 0,kn=void 0,Pn=void 0,Rn=_n.vertices,Ln=Rn.length,Dn=_n.colors,Nn=Dn.length,Fn=_n.__vertexArray,Gn=_n.__colorArray,On=_n.__sortArray,jn=_n.verticesNeedUpdate,In=_n.colorsNeedUpdate,Vn=_n.__webglCustomAttributesList,Un=void 0,Bn=void 0,zn=void 0,qn=void 0,Hn=void 0,Wn=void 0;if(Mn.sortParticles){for(Ct.copy(Mt),Ct.multiply(Mn.matrixWorld),Cn=0;Ln>Cn;Cn++)Tn=Rn[Cn],At.copy(Tn),At.applyProjection(Ct),On[Cn]=[At.z,Cn];for(On.sort(h),Cn=0;Ln>Cn;Cn++)Tn=Rn[On[Cn][1]],En=3*Cn,Fn[En]=Tn.x,Fn[En+1]=Tn.y,Fn[En+2]=Tn.z;for(An=0;Nn>An;An++)En=3*An,Pn=Dn[On[An][1]],Gn[En]=Pn.r,Gn[En+1]=Pn.g,Gn[En+2]=Pn.b;if(Vn)for(Un=0,Bn=Vn.length;Bn>Un;Un++)if(Wn=Vn[Un],void 0===Wn.boundTo||"vertices"===Wn.boundTo)if(En=0,qn=Wn.value.length,1===Wn.size)for(zn=0;qn>zn;zn++)kn=On[zn][1],Wn.array[zn]=Wn.value[kn];else if(2===Wn.size)for(zn=0;qn>zn;zn++)kn=On[zn][1],Hn=Wn.value[kn],Wn.array[En]=Hn.x,Wn.array[En+1]=Hn.y,En+=2;else if(3===Wn.size)if("c"===Wn.type)for(zn=0;qn>zn;zn++)kn=On[zn][1],Hn=Wn.value[kn],Wn.array[En]=Hn.r,Wn.array[En+1]=Hn.g,Wn.array[En+2]=Hn.b,En+=3;else for(zn=0;qn>zn;zn++)kn=On[zn][1],Hn=Wn.value[kn],Wn.array[En]=Hn.x,Wn.array[En+1]=Hn.y,Wn.array[En+2]=Hn.z,En+=3;else if(4===Wn.size)for(zn=0;qn>zn;zn++)kn=On[zn][1],Hn=Wn.value[kn],Wn.array[En]=Hn.x,Wn.array[En+1]=Hn.y,Wn.array[En+2]=Hn.z,Wn.array[En+3]=Hn.w,En+=4}else{if(jn)for(Cn=0;Ln>Cn;Cn++)Tn=Rn[Cn],En=3*Cn,Fn[En]=Tn.x,Fn[En+1]=Tn.y,Fn[En+2]=Tn.z;if(In)for(An=0;Nn>An;An++)Pn=Dn[An],En=3*An,Gn[En]=Pn.r,Gn[En+1]=Pn.g,Gn[En+2]=Pn.b;if(Vn)for(Un=0,Bn=Vn.length;Bn>Un;Un++)if(Wn=Vn[Un],Wn.needsUpdate&&(void 0===Wn.boundTo||"vertices"===Wn.boundTo))if(qn=Wn.value.length,En=0,1===Wn.size)for(zn=0;qn>zn;zn++)Wn.array[zn]=Wn.value[zn];else if(2===Wn.size)for(zn=0;qn>zn;zn++)Hn=Wn.value[zn],Wn.array[En]=Hn.x,Wn.array[En+1]=Hn.y,En+=2;else if(3===Wn.size)if("c"===Wn.type)for(zn=0;qn>zn;zn++)Hn=Wn.value[zn],Wn.array[En]=Hn.r,Wn.array[En+1]=Hn.g,Wn.array[En+2]=Hn.b,En+=3;else for(zn=0;qn>zn;zn++)Hn=Wn.value[zn],Wn.array[En]=Hn.x,Wn.array[En+1]=Hn.y,Wn.array[En+2]=Hn.z,En+=3;else if(4===Wn.size)for(zn=0;qn>zn;zn++)Hn=Wn.value[zn],Wn.array[En]=Hn.x,Wn.array[En+1]=Hn.y,Wn.array[En+2]=Hn.z,Wn.array[En+3]=Hn.w,En+=4}if((jn||Mn.sortParticles)&&(z.bindBuffer(z.ARRAY_BUFFER,_n.__webglVertexBuffer),z.bufferData(z.ARRAY_BUFFER,Fn,Sn)),(In||Mn.sortParticles)&&(z.bindBuffer(z.ARRAY_BUFFER,_n.__webglColorBuffer),z.bufferData(z.ARRAY_BUFFER,Gn,Sn)),Vn)for(Un=0,Bn=Vn.length;Bn>Un;Un++)Wn=Vn[Un],(Wn.needsUpdate||Mn.sortParticles)&&(z.bindBuffer(z.ARRAY_BUFFER,Wn.buffer),z.bufferData(z.ARRAY_BUFFER,Wn.array,Sn))}c.verticesNeedUpdate=!1,c.colorsNeedUpdate=!1,d.attributes&&y(d)}}},this.initMaterial=function(t,i,n,r){var o,a,s,l;t.addEventListener("dispose",Wt);var u,c,h,f,p;if(t instanceof e.MeshDepthMaterial?p="depth":t instanceof e.MeshNormalMaterial?p="normal":t instanceof e.MeshBasicMaterial?p="basic":t instanceof e.MeshLambertMaterial?p="lambert":t instanceof e.MeshPhongMaterial?p="phong":t instanceof e.LineBasicMaterial?p="basic":t instanceof e.LineDashedMaterial?p="dashed":t instanceof e.ParticleBasicMaterial&&(p="particle_basic"),p){var d=e.ShaderLib[p];t.uniforms=e.UniformsUtils.clone(d.uniforms),t.vertexShader=d.vertexShader,t.fragmentShader=d.fragmentShader}var m,g,v;for(o=s=g=v=d=0,a=i.length;a>o;o++)m=i[o],m.onlyShadow||(m instanceof e.DirectionalLight&&s++,m instanceof e.PointLight&&g++,m instanceof e.SpotLight&&v++,m instanceof e.HemisphereLight&&d++);for(o=s,a=g,s=v,l=d,d=m=0,v=i.length;v>d;d++)g=i[d],g.castShadow&&(g instanceof e.SpotLight&&m++,g instanceof e.DirectionalLight&&!g.shadowCascade&&m++);f=m,Gt&&r&&r.useVertexTexture?h=1024:(i=z.getParameter(z.MAX_VERTEX_UNIFORM_VECTORS),i=Math.floor((i-20)/4),void 0!==r&&r instanceof e.SkinnedMesh&&(i=Math.min(r.bones.length,i),i<r.bones.length&&console.warn("WebGLRenderer: too many bones - "+r.bones.length+", this GPU supports just "+i+" (try OpenGL instead of ANGLE)")),h=i);e:{v=t.fragmentShader,g=t.vertexShader,d=t.uniforms,i=t.attributes,m=t.defines;var y,b,x,n={map:!!t.map,envMap:!!t.envMap,lightMap:!!t.lightMap,bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,specularMap:!!t.specularMap,vertexColors:t.vertexColors,fog:n,useFog:t.fog,fogExp:n instanceof e.FogExp2,sizeAttenuation:t.sizeAttenuation,skinning:t.skinning,maxBones:h,useVertexTexture:Gt&&r&&r.useVertexTexture,boneTextureWidth:r&&r.boneTextureWidth,boneTextureHeight:r&&r.boneTextureHeight,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:o,maxPointLights:a,maxSpotLights:s,maxHemiLights:l,maxShadows:f,shadowMapEnabled:this.shadowMapEnabled&&r.receiveShadow,shadowMapType:this.shadowMapType,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:t.alphaTest,metal:t.metal,perPixel:t.perPixel,wrapAround:t.wrapAround,doubleSided:t.side===e.DoubleSide,flipSided:t.side===e.BackSide},r=[];p?r.push(p):(r.push(v),r.push(g));for(b in m)r.push(b),r.push(m[b]);for(y in n)r.push(y),r.push(n[y]);for(p=r.join(),y=0,b=K.length;b>y;y++)if(r=K[y],r.code===p){r.usedTimes++,c=r.program;break e}y="SHADOWMAP_TYPE_BASIC",n.shadowMapType===e.PCFShadowMap?y="SHADOWMAP_TYPE_PCF":n.shadowMapType===e.PCFSoftShadowMap&&(y="SHADOWMAP_TYPE_PCF_SOFT"),b=[];for(x in m)r=m[x],!1!==r&&(r="#define "+x+" "+r,b.push(r));r=b.join("\n"),x=z.createProgram(),b=["precision "+F+" float;",r,Ft?"#define VERTEX_TEXTURES":"",Y.gammaInput?"#define GAMMA_INPUT":"",Y.gammaOutput?"#define GAMMA_OUTPUT":"",Y.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+n.maxDirLights,"#define MAX_POINT_LIGHTS "+n.maxPointLights,"#define MAX_SPOT_LIGHTS "+n.maxSpotLights,"#define MAX_HEMI_LIGHTS "+n.maxHemiLights,"#define MAX_SHADOWS "+n.maxShadows,"#define MAX_BONES "+n.maxBones,n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.lightMap?"#define USE_LIGHTMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.vertexColors?"#define USE_COLOR":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.boneTextureWidth?"#define N_BONE_PIXEL_X "+n.boneTextureWidth.toFixed(1):"",n.boneTextureHeight?"#define N_BONE_PIXEL_Y "+n.boneTextureHeight.toFixed(1):"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals?"#define USE_MORPHNORMALS":"",n.perPixel?"#define PHONG_PER_PIXEL":"",n.wrapAround?"#define WRAP_AROUND":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+y:"",n.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",n.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\n#ifdef USE_MORPHNORMALS\nattribute vec3 morphNormal0;\nattribute vec3 morphNormal1;\nattribute vec3 morphNormal2;\nattribute vec3 morphNormal3;\n#else\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n"),y=["precision "+F+" float;",n.bumpMap||n.normalMap?"#extension GL_OES_standard_derivatives : enable":"",r,"#define MAX_DIR_LIGHTS "+n.maxDirLights,"#define MAX_POINT_LIGHTS "+n.maxPointLights,"#define MAX_SPOT_LIGHTS "+n.maxSpotLights,"#define MAX_HEMI_LIGHTS "+n.maxHemiLights,"#define MAX_SHADOWS "+n.maxShadows,n.alphaTest?"#define ALPHATEST "+n.alphaTest:"",Y.gammaInput?"#define GAMMA_INPUT":"",Y.gammaOutput?"#define GAMMA_OUTPUT":"",Y.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.lightMap?"#define USE_LIGHTMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.vertexColors?"#define USE_COLOR":"",n.metal?"#define METAL":"",n.perPixel?"#define PHONG_PER_PIXEL":"",n.wrapAround?"#define WRAP_AROUND":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+y:"",n.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",n.shadowMapCascade?"#define SHADOWMAP_CASCADE":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n"),b=k("vertex",b+g),y=k("fragment",y+v),z.attachShader(x,b),z.attachShader(x,y),z.linkProgram(x),z.getProgramParameter(x,z.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+z.getProgramParameter(x,z.VALIDATE_STATUS)+", gl error ["+z.getError()+"]"),z.deleteShader(y),z.deleteShader(b),x.uniforms={},x.attributes={};var w;y="viewMatrix modelViewMatrix projectionMatrix normalMatrix modelMatrix cameraPosition morphTargetInfluences".split(" "),y.push(n.useVertexTexture?"boneTexture":"boneGlobalMatrices");for(w in d)y.push(w);for(w=y,y=0,b=w.length;b>y;y++)d=w[y],x.uniforms[d]=z.getUniformLocation(x,d);for(y="position normal uv uv2 tangent color skinIndex skinWeight lineDistance".split(" "),w=0;w<n.maxMorphTargets;w++)y.push("morphTarget"+w);
for(w=0;w<n.maxMorphNormals;w++)y.push("morphNormal"+w);for(c in i)y.push(c);for(c=y,w=0,i=c.length;i>w;w++)y=c[w],x.attributes[y]=z.getAttribLocation(x,y);x.id=$++,K.push({program:x,code:p,usedTimes:1}),Y.info.memory.programs=K.length,c=x}if(t.program=c,w=t.program.attributes,t.morphTargets)for(t.numSupportedMorphTargets=0,i="morphTarget",c=0;c<this.maxMorphTargets;c++)x=i+c,0<=w[x]&&t.numSupportedMorphTargets++;if(t.morphNormals)for(t.numSupportedMorphNormals=0,i="morphNormal",c=0;c<this.maxMorphNormals;c++)x=i+c,0<=w[x]&&t.numSupportedMorphNormals++;t.uniformsList=[];for(u in t.uniforms)t.uniformsList.push([t.uniforms[u],u])},this.setFaceCulling=function(t,i){t===e.CullFaceNone?z.disable(z.CULL_FACE):(z.frontFace(i===e.FrontFaceDirectionCW?z.CW:z.CCW),z.cullFace(t===e.CullFaceBack?z.BACK:t===e.CullFaceFront?z.FRONT:z.FRONT_AND_BACK),z.enable(z.CULL_FACE))},this.setMaterialFaces=function(t){var i=t.side===e.DoubleSide,t=t.side===e.BackSide;rt!==i&&(i?z.disable(z.CULL_FACE):z.enable(z.CULL_FACE),rt=i),ot!==t&&(z.frontFace(t?z.CW:z.CCW),ot=t)},this.setDepthTest=function(e){ct!==e&&(e?z.enable(z.DEPTH_TEST):z.disable(z.DEPTH_TEST),ct=e)},this.setDepthWrite=function(e){ht!==e&&(z.depthMask(e),ht=e)},this.setBlending=function(t,i,n,r){t!==at&&(t===e.NoBlending?z.disable(z.BLEND):t===e.AdditiveBlending?(z.enable(z.BLEND),z.blendEquation(z.FUNC_ADD),z.blendFunc(z.SRC_ALPHA,z.ONE)):t===e.SubtractiveBlending?(z.enable(z.BLEND),z.blendEquation(z.FUNC_ADD),z.blendFunc(z.ZERO,z.ONE_MINUS_SRC_COLOR)):t===e.MultiplyBlending?(z.enable(z.BLEND),z.blendEquation(z.FUNC_ADD),z.blendFunc(z.ZERO,z.SRC_COLOR)):t===e.CustomBlending?z.enable(z.BLEND):(z.enable(z.BLEND),z.blendEquationSeparate(z.FUNC_ADD,z.FUNC_ADD),z.blendFuncSeparate(z.SRC_ALPHA,z.ONE_MINUS_SRC_ALPHA,z.ONE,z.ONE_MINUS_SRC_ALPHA)),at=t),t===e.CustomBlending?(i!==st&&(z.blendEquation(D(i)),st=i),(n!==lt||r!==ut)&&(z.blendFunc(D(n),D(r)),lt=n,ut=r)):ut=lt=st=null},this.setTexture=function(t,i){if(t.needsUpdate){t.__webglInit||(t.__webglInit=!0,t.addEventListener("dispose",qt),t.__webglTexture=z.createTexture(),Y.info.memory.textures++),z.activeTexture(z.TEXTURE0+i),z.bindTexture(z.TEXTURE_2D,t.__webglTexture),z.pixelStorei(z.UNPACK_FLIP_Y_WEBGL,t.flipY),z.pixelStorei(z.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),z.pixelStorei(z.UNPACK_ALIGNMENT,t.unpackAlignment);var n=t.image,r=0===(n.width&n.width-1)&&0===(n.height&n.height-1),o=D(t.format),a=D(t.type);P(z.TEXTURE_2D,t,r);var s=t.mipmaps;if(t instanceof e.DataTexture)if(0<s.length&&r){for(var l=0,u=s.length;u>l;l++)n=s[l],z.texImage2D(z.TEXTURE_2D,l,o,n.width,n.height,0,o,a,n.data);t.generateMipmaps=!1}else z.texImage2D(z.TEXTURE_2D,0,o,n.width,n.height,0,o,a,n.data);else if(t instanceof e.CompressedTexture)for(l=0,u=s.length;u>l;l++)n=s[l],z.compressedTexImage2D(z.TEXTURE_2D,l,o,n.width,n.height,0,n.data);else if(0<s.length&&r){for(l=0,u=s.length;u>l;l++)n=s[l],z.texImage2D(z.TEXTURE_2D,l,o,o,a,n);t.generateMipmaps=!1}else z.texImage2D(z.TEXTURE_2D,0,o,o,a,t.image);t.generateMipmaps&&r&&z.generateMipmap(z.TEXTURE_2D),t.needsUpdate=!1,t.onUpdate&&t.onUpdate()}else z.activeTexture(z.TEXTURE0+i),z.bindTexture(z.TEXTURE_2D,t.__webglTexture)},this.setRenderTarget=function(t){var i=t instanceof e.WebGLRenderTargetCube;if(t&&!t.__webglFramebuffer){void 0===t.depthBuffer&&(t.depthBuffer=!0),void 0===t.stencilBuffer&&(t.stencilBuffer=!0),t.addEventListener("dispose",Ht),t.__webglTexture=z.createTexture(),Y.info.memory.textures++;var n=0===(t.width&t.width-1)&&0===(t.height&t.height-1),r=D(t.format),o=D(t.type);if(i){t.__webglFramebuffer=[],t.__webglRenderbuffer=[],z.bindTexture(z.TEXTURE_CUBE_MAP,t.__webglTexture),P(z.TEXTURE_CUBE_MAP,t,n);for(var a=0;6>a;a++){t.__webglFramebuffer[a]=z.createFramebuffer(),t.__webglRenderbuffer[a]=z.createRenderbuffer(),z.texImage2D(z.TEXTURE_CUBE_MAP_POSITIVE_X+a,0,r,t.width,t.height,0,r,o,null);var s=t,l=z.TEXTURE_CUBE_MAP_POSITIVE_X+a;z.bindFramebuffer(z.FRAMEBUFFER,t.__webglFramebuffer[a]),z.framebufferTexture2D(z.FRAMEBUFFER,z.COLOR_ATTACHMENT0,l,s.__webglTexture,0),R(t.__webglRenderbuffer[a],t)}n&&z.generateMipmap(z.TEXTURE_CUBE_MAP)}else t.__webglFramebuffer=z.createFramebuffer(),t.__webglRenderbuffer=t.shareDepthFrom?t.shareDepthFrom.__webglRenderbuffer:z.createRenderbuffer(),z.bindTexture(z.TEXTURE_2D,t.__webglTexture),P(z.TEXTURE_2D,t,n),z.texImage2D(z.TEXTURE_2D,0,r,t.width,t.height,0,r,o,null),r=z.TEXTURE_2D,z.bindFramebuffer(z.FRAMEBUFFER,t.__webglFramebuffer),z.framebufferTexture2D(z.FRAMEBUFFER,z.COLOR_ATTACHMENT0,r,t.__webglTexture,0),t.shareDepthFrom?t.depthBuffer&&!t.stencilBuffer?z.framebufferRenderbuffer(z.FRAMEBUFFER,z.DEPTH_ATTACHMENT,z.RENDERBUFFER,t.__webglRenderbuffer):t.depthBuffer&&t.stencilBuffer&&z.framebufferRenderbuffer(z.FRAMEBUFFER,z.DEPTH_STENCIL_ATTACHMENT,z.RENDERBUFFER,t.__webglRenderbuffer):R(t.__webglRenderbuffer,t),n&&z.generateMipmap(z.TEXTURE_2D);i?z.bindTexture(z.TEXTURE_CUBE_MAP,null):z.bindTexture(z.TEXTURE_2D,null),z.bindRenderbuffer(z.RENDERBUFFER,null),z.bindFramebuffer(z.FRAMEBUFFER,null)}t?(i=i?t.__webglFramebuffer[t.activeCubeFace]:t.__webglFramebuffer,n=t.width,t=t.height,o=r=0):(i=null,n=yt,t=bt,r=gt,o=vt),i!==Z&&(z.bindFramebuffer(z.FRAMEBUFFER,i),z.viewport(r,o,n,t),Z=i),xt=n,wt=t},this.shadowMapPlugin=new e.ShadowMapPlugin,this.addPrePlugin(this.shadowMapPlugin),this.addPostPlugin(new e.SpritePlugin),this.addPostPlugin(new e.LensFlarePlugin)},e.WebGLRenderTarget=function(t,i,n){this.width=t,this.height=i,n=n||{},this.wrapS=void 0!==n.wrapS?n.wrapS:e.ClampToEdgeWrapping,this.wrapT=void 0!==n.wrapT?n.wrapT:e.ClampToEdgeWrapping,this.magFilter=void 0!==n.magFilter?n.magFilter:e.LinearFilter,this.minFilter=void 0!==n.minFilter?n.minFilter:e.LinearMipMapLinearFilter,this.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,this.offset=new e.Vector2(0,0),this.repeat=new e.Vector2(1,1),this.format=void 0!==n.format?n.format:e.RGBAFormat,this.type=void 0!==n.type?n.type:e.UnsignedByteType,this.depthBuffer=void 0!==n.depthBuffer?n.depthBuffer:!0,this.stencilBuffer=void 0!==n.stencilBuffer?n.stencilBuffer:!0,this.generateMipmaps=!0,this.shareDepthFrom=null},e.WebGLRenderTarget.prototype={constructor:e.WebGLRenderTarget,addEventListener:e.EventDispatcher.prototype.addEventListener,hasEventListener:e.EventDispatcher.prototype.hasEventListener,removeEventListener:e.EventDispatcher.prototype.removeEventListener,dispatchEvent:e.EventDispatcher.prototype.dispatchEvent,clone:function(){var t=new e.WebGLRenderTarget(this.width,this.height);return t.wrapS=this.wrapS,t.wrapT=this.wrapT,t.magFilter=this.magFilter,t.minFilter=this.minFilter,t.anisotropy=this.anisotropy,t.offset.copy(this.offset),t.repeat.copy(this.repeat),t.format=this.format,t.type=this.type,t.depthBuffer=this.depthBuffer,t.stencilBuffer=this.stencilBuffer,t.generateMipmaps=this.generateMipmaps,t.shareDepthFrom=this.shareDepthFrom,t},dispose:function(){this.dispatchEvent({type:"dispose"})}},e.WebGLRenderTargetCube=function(t,i,n){e.WebGLRenderTarget.call(this,t,i,n),this.activeCubeFace=0},e.WebGLRenderTargetCube.prototype=Object.create(e.WebGLRenderTarget.prototype),e.RenderableVertex=function(){this.positionWorld=new e.Vector3,this.positionScreen=new e.Vector4,this.visible=!0},e.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},e.RenderableFace3=function(){this.v1=new e.RenderableVertex,this.v2=new e.RenderableVertex,this.v3=new e.RenderableVertex,this.centroidModel=new e.Vector3,this.normalModel=new e.Vector3,this.normalModelView=new e.Vector3,this.vertexNormalsLength=0,this.vertexNormalsModel=[new e.Vector3,new e.Vector3,new e.Vector3],this.vertexNormalsModelView=[new e.Vector3,new e.Vector3,new e.Vector3],this.material=this.color=null,this.uvs=[[]],this.z=null},e.RenderableFace4=function(){this.v1=new e.RenderableVertex,this.v2=new e.RenderableVertex,this.v3=new e.RenderableVertex,this.v4=new e.RenderableVertex,this.centroidModel=new e.Vector3,this.normalModel=new e.Vector3,this.normalModelView=new e.Vector3,this.vertexNormalsLength=0,this.vertexNormalsModel=[new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3],this.vertexNormalsModelView=[new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3],this.material=this.color=null,this.uvs=[[]],this.z=null},e.RenderableObject=function(){this.z=this.object=null},e.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=this.object=null,this.scale=new e.Vector2,this.material=null},e.RenderableLine=function(){this.z=null,this.v1=new e.RenderableVertex,this.v2=new e.RenderableVertex,this.vertexColors=[new e.Color,new e.Color],this.material=null},e.GeometryUtils={merge:function(t,i,n){var r,o,a=t.vertices.length,s=i instanceof e.Mesh?i.geometry:i,l=t.vertices,u=s.vertices,c=t.faces,h=s.faces,t=t.faceVertexUvs[0],s=s.faceVertexUvs[0];void 0===n&&(n=0),i instanceof e.Mesh&&(i.matrixAutoUpdate&&i.updateMatrix(),r=i.matrix,o=(new e.Matrix3).getNormalMatrix(r));for(var i=0,f=u.length;f>i;i++){var p=u[i].clone();r&&p.applyMatrix4(r),l.push(p)}for(i=0,f=h.length;f>i;i++){var d,m,p=h[i],g=p.vertexNormals,v=p.vertexColors;for(p instanceof e.Face3?d=new e.Face3(p.a+a,p.b+a,p.c+a):p instanceof e.Face4&&(d=new e.Face4(p.a+a,p.b+a,p.c+a,p.d+a)),d.normal.copy(p.normal),o&&d.normal.applyMatrix3(o).normalize(),l=0,u=g.length;u>l;l++)m=g[l].clone(),o&&m.applyMatrix3(o).normalize(),d.vertexNormals.push(m);for(d.color.copy(p.color),l=0,u=v.length;u>l;l++)m=v[l],d.vertexColors.push(m.clone());d.materialIndex=p.materialIndex+n,d.centroid.copy(p.centroid),r&&d.centroid.applyMatrix4(r),c.push(d)}for(i=0,f=s.length;f>i;i++){for(n=s[i],r=[],l=0,u=n.length;u>l;l++)r.push(new e.Vector2(n[l].x,n[l].y));t.push(r)}},removeMaterials:function(e,t){for(var i={},n=0,r=t.length;r>n;n++)i[t[n]]=!0;for(var o,a=[],n=0,r=e.faces.length;r>n;n++)o=e.faces[n],o.materialIndex in i||a.push(o);e.faces=a},randomPointInTriangle:function(t,i,n){var r,o,a,s=new e.Vector3,l=e.GeometryUtils.__v1;return r=e.GeometryUtils.random(),o=e.GeometryUtils.random(),r+o>1&&(r=1-r,o=1-o),a=1-r-o,s.copy(t),s.multiplyScalar(r),l.copy(i),l.multiplyScalar(o),s.add(l),l.copy(n),l.multiplyScalar(a),s.add(l),s},randomPointInFace:function(t,i,n){var r,o,a;if(t instanceof e.Face3)return r=i.vertices[t.a],o=i.vertices[t.b],a=i.vertices[t.c],e.GeometryUtils.randomPointInTriangle(r,o,a);if(t instanceof e.Face4){r=i.vertices[t.a],o=i.vertices[t.b],a=i.vertices[t.c];var s,i=i.vertices[t.d];return n?t._area1&&t._area2?(n=t._area1,s=t._area2):(n=e.GeometryUtils.triangleArea(r,o,i),s=e.GeometryUtils.triangleArea(o,a,i),t._area1=n,t._area2=s):(n=e.GeometryUtils.triangleArea(r,o,i),s=e.GeometryUtils.triangleArea(o,a,i)),e.GeometryUtils.random()*(n+s)<n?e.GeometryUtils.randomPointInTriangle(r,o,i):e.GeometryUtils.randomPointInTriangle(o,a,i)}},randomPointsInGeometry:function(t,i){function n(e){function t(i,n){if(i>n)return i;var r=i+Math.floor((n-i)/2);return d[r]>e?t(i,r-1):d[r]<e?t(r+1,n):r}return t(0,d.length-1)}var r,o,a,s,l,u,c=t.faces,h=t.vertices,f=c.length,p=0,d=[];for(o=0;f>o;o++)r=c[o],r instanceof e.Face3?(a=h[r.a],s=h[r.b],l=h[r.c],r._area=e.GeometryUtils.triangleArea(a,s,l)):r instanceof e.Face4&&(a=h[r.a],s=h[r.b],l=h[r.c],u=h[r.d],r._area1=e.GeometryUtils.triangleArea(a,s,u),r._area2=e.GeometryUtils.triangleArea(s,l,u),r._area=r._area1+r._area2),p+=r._area,d[o]=p;for(r=[],o=0;i>o;o++)h=e.GeometryUtils.random()*p,h=n(h),r[o]=e.GeometryUtils.randomPointInFace(c[h],t,!0);return r},triangleArea:function(t,i,n){var r=e.GeometryUtils.__v1,o=e.GeometryUtils.__v2;return r.subVectors(i,t),o.subVectors(n,t),r.cross(o),.5*r.length()},center:function(t){t.computeBoundingBox();var i=t.boundingBox,n=new e.Vector3;return n.addVectors(i.min,i.max),n.multiplyScalar(-.5),t.applyMatrix((new e.Matrix4).makeTranslation(n.x,n.y,n.z)),t.computeBoundingBox(),n},normalizeUVs:function(e){for(var e=e.faceVertexUvs[0],t=0,i=e.length;i>t;t++)for(var n=e[t],r=0,o=n.length;o>r;r++)1!==n[r].x&&(n[r].x-=Math.floor(n[r].x)),1!==n[r].y&&(n[r].y-=Math.floor(n[r].y))},triangulateQuads:function(t){var i,n,r,o,a=[],s=[],l=[];for(i=0,n=t.faceUvs.length;n>i;i++)s[i]=[];for(i=0,n=t.faceVertexUvs.length;n>i;i++)l[i]=[];for(i=0,n=t.faces.length;n>i;i++)if(r=t.faces[i],r instanceof e.Face4){o=r.a;var u=r.b,c=r.c,h=r.d,f=new e.Face3,p=new e.Face3;for(f.color.copy(r.color),p.color.copy(r.color),f.materialIndex=r.materialIndex,p.materialIndex=r.materialIndex,f.a=o,f.b=u,f.c=h,p.a=u,p.b=c,p.c=h,4===r.vertexColors.length&&(f.vertexColors[0]=r.vertexColors[0].clone(),f.vertexColors[1]=r.vertexColors[1].clone(),f.vertexColors[2]=r.vertexColors[3].clone(),p.vertexColors[0]=r.vertexColors[1].clone(),p.vertexColors[1]=r.vertexColors[2].clone(),p.vertexColors[2]=r.vertexColors[3].clone()),a.push(f,p),r=0,o=t.faceVertexUvs.length;o>r;r++)t.faceVertexUvs[r].length&&(f=t.faceVertexUvs[r][i],u=f[1],c=f[2],h=f[3],f=[f[0].clone(),u.clone(),h.clone()],u=[u.clone(),c.clone(),h.clone()],l[r].push(f,u));for(r=0,o=t.faceUvs.length;o>r;r++)t.faceUvs[r].length&&(u=t.faceUvs[r][i],s[r].push(u,u))}else{for(a.push(r),r=0,o=t.faceUvs.length;o>r;r++)s[r].push(t.faceUvs[r][i]);for(r=0,o=t.faceVertexUvs.length;o>r;r++)l[r].push(t.faceVertexUvs[r][i])}t.faces=a,t.faceUvs=s,t.faceVertexUvs=l,t.computeCentroids(),t.computeFaceNormals(),t.computeVertexNormals(),t.hasTangents&&t.computeTangents()},setMaterialIndex:function(e,t,i,n){for(e=e.faces,n=n||e.length-1,i=i||0;n>=i;i++)e[i].materialIndex=t}},e.GeometryUtils.random=e.Math.random16,e.GeometryUtils.__v1=new e.Vector3,e.GeometryUtils.__v2=new e.Vector3,e.ImageUtils={crossOrigin:"anonymous",loadTexture:function(t,i,n,r){var o=new Image,a=new e.Texture(o,i),i=new e.ImageLoader;return i.addEventListener("load",function(e){a.image=e.content,a.needsUpdate=!0,n&&n(a)}),i.addEventListener("error",function(e){r&&r(e.message)}),i.crossOrigin=this.crossOrigin,i.load(t,o),a.sourceFile=t,a},loadCompressedTexture:function(t,i,n,r){var o=new e.CompressedTexture;o.mapping=i;var a=new XMLHttpRequest;return a.onload=function(){var t=e.ImageUtils.parseDDS(a.response,!0);o.format=t.format,o.mipmaps=t.mipmaps,o.image.width=t.width,o.image.height=t.height,o.generateMipmaps=!1,o.needsUpdate=!0,n&&n(o)},a.onerror=r,a.open("GET",t,!0),a.responseType="arraybuffer",a.send(null),o},loadTextureCube:function(t,i,n,r){var o=[];o.loadCount=0;var a=new e.Texture;a.image=o,void 0!==i&&(a.mapping=i),a.flipY=!1;for(var i=0,s=t.length;s>i;++i){var l=new Image;o[i]=l,l.onload=function(){o.loadCount+=1,6===o.loadCount&&(a.needsUpdate=!0,n&&n(a))},l.onerror=r,l.crossOrigin=this.crossOrigin,l.src=t[i]}return a},loadCompressedTextureCube:function(t,i,n,r){var o=[];o.loadCount=0;var a=new e.CompressedTexture;if(a.image=o,void 0!==i&&(a.mapping=i),a.flipY=!1,a.generateMipmaps=!1,i=function(t,i){return function(){var r=e.ImageUtils.parseDDS(t.response,!0);i.format=r.format,i.mipmaps=r.mipmaps,i.width=r.width,i.height=r.height,o.loadCount+=1,6===o.loadCount&&(a.format=r.format,a.needsUpdate=!0,n&&n(a))}},t instanceof Array)for(var s=0,l=t.length;l>s;++s){var u={};o[s]=u;var c=new XMLHttpRequest;c.onload=i(c,u),c.onerror=r,u=t[s],c.open("GET",u,!0),c.responseType="arraybuffer",c.send(null)}else c=new XMLHttpRequest,c.onload=function(){var t=e.ImageUtils.parseDDS(c.response,!0);if(t.isCubemap){for(var i=t.mipmaps.length/t.mipmapCount,r=0;i>r;r++){o[r]={mipmaps:[]};for(var s=0;s<t.mipmapCount;s++)o[r].mipmaps.push(t.mipmaps[r*t.mipmapCount+s]),o[r].format=t.format,o[r].width=t.width,o[r].height=t.height}a.format=t.format,a.needsUpdate=!0,n&&n(a)}},c.onerror=r,c.open("GET",t,!0),c.responseType="arraybuffer",c.send(null);return a},parseDDS:function(t,i){function n(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}var r={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},o=n("DXT1"),a=n("DXT3"),s=n("DXT5"),l=new Int32Array(t,0,31);if(542327876!==l[0])return console.error("ImageUtils.parseDDS(): Invalid magic number in DDS header"),r;if(4&!l[20])return console.error("ImageUtils.parseDDS(): Unsupported format, must contain a FourCC code"),r;var u=l[21];switch(u){case o:o=8,r.format=e.RGB_S3TC_DXT1_Format;break;case a:o=16,r.format=e.RGBA_S3TC_DXT3_Format;break;case s:o=16,r.format=e.RGBA_S3TC_DXT5_Format;break;default:return console.error("ImageUtils.parseDDS(): Unsupported FourCC code: ",String.fromCharCode(255&u,u>>8&255,u>>16&255,u>>24&255)),r}r.mipmapCount=1,131072&l[2]&&!1!==i&&(r.mipmapCount=Math.max(1,l[7])),r.isCubemap=512&l[28]?!0:!1,r.width=l[4],r.height=l[3];for(var l=l[1]+4,a=r.width,s=r.height,u=r.isCubemap?6:1,c=0;u>c;c++){for(var h=0;h<r.mipmapCount;h++){var f=Math.max(4,a)/4*Math.max(4,s)/4*o,p={data:new Uint8Array(t,l,f),width:a,height:s};r.mipmaps.push(p),l+=f,a=Math.max(.5*a,1),s=Math.max(.5*s,1)}a=r.width,s=r.height}return r},getNormalMap:function(e,t){var i=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]},t=1|t,n=e.width,r=e.height,o=document.createElement("canvas");o.width=n,o.height=r;var a=o.getContext("2d");a.drawImage(e,0,0);for(var s=a.getImageData(0,0,n,r).data,l=a.createImageData(n,r),u=l.data,c=0;n>c;c++)for(var h=0;r>h;h++){var f=0>h-1?0:h-1,p=h+1>r-1?r-1:h+1,d=0>c-1?0:c-1,m=c+1>n-1?n-1:c+1,g=[],v=[0,0,s[4*(h*n+c)]/255*t];for(g.push([-1,0,s[4*(h*n+d)]/255*t]),g.push([-1,-1,s[4*(f*n+d)]/255*t]),g.push([0,-1,s[4*(f*n+c)]/255*t]),g.push([1,-1,s[4*(f*n+m)]/255*t]),g.push([1,0,s[4*(h*n+m)]/255*t]),g.push([1,1,s[4*(p*n+m)]/255*t]),g.push([0,1,s[4*(p*n+c)]/255*t]),g.push([-1,1,s[4*(p*n+d)]/255*t]),f=[],d=g.length,p=0;d>p;p++){var m=g[p],y=g[(p+1)%d],m=[m[0]-v[0],m[1]-v[1],m[2]-v[2]],y=[y[0]-v[0],y[1]-v[1],y[2]-v[2]];f.push(i([m[1]*y[2]-m[2]*y[1],m[2]*y[0]-m[0]*y[2],m[0]*y[1]-m[1]*y[0]]))}for(g=[0,0,0],p=0;p<f.length;p++)g[0]+=f[p][0],g[1]+=f[p][1],g[2]+=f[p][2];g[0]/=f.length,g[1]/=f.length,g[2]/=f.length,v=4*(h*n+c),u[v]=255*((g[0]+1)/2)|0,u[v+1]=255*((g[1]+1)/2)|0,u[v+2]=255*g[2]|0,u[v+3]=255}return a.putImageData(l,0,0),o},generateDataTexture:function(t,i,n){for(var r=t*i,o=new Uint8Array(3*r),a=Math.floor(255*n.r),s=Math.floor(255*n.g),n=Math.floor(255*n.b),l=0;r>l;l++)o[3*l]=a,o[3*l+1]=s,o[3*l+2]=n;return t=new e.DataTexture(o,t,i,e.RGBFormat),t.needsUpdate=!0,t}},e.SceneUtils={createMultiMaterialObject:function(t,i){for(var n=new e.Object3D,r=0,o=i.length;o>r;r++)n.add(new e.Mesh(t,i[r]));return n},detach:function(e,t,i){e.applyMatrix(t.matrixWorld),t.remove(e),i.add(e)},attach:function(t,i,n){var r=new e.Matrix4;r.getInverse(n.matrixWorld),t.applyMatrix(r),i.remove(t),n.add(t)}},e.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(e){var t=e.familyName.toLowerCase();return this.faces[t]=this.faces[t]||{},this.faces[t][e.cssFontWeight]=this.faces[t][e.cssFontWeight]||{},this.faces[t][e.cssFontWeight][e.cssFontStyle]=e,this.faces[t][e.cssFontWeight][e.cssFontStyle]=e},drawText:function(t){for(var i=this.getFace(),n=this.size/i.resolution,r=0,o=String(t).split(""),a=o.length,s=[],t=0;a>t;t++){var l=new e.Path,l=this.extractGlyphPoints(o[t],i,n,r,l),r=r+l.offset;s.push(l.path)}return{paths:s,offset:r/2}},extractGlyphPoints:function(t,i,n,r,o){var a,s,l,u,c,h,f,p,d,m,g,v=[],y=i.glyphs[t]||i.glyphs["?"];if(y){if(y.o)for(i=y._cachedOutline||(y._cachedOutline=y.o.split(" ")),u=i.length,t=0;u>t;)switch(l=i[t++]){case"m":l=i[t++]*n+r,c=i[t++]*n,o.moveTo(l,c);break;case"l":l=i[t++]*n+r,c=i[t++]*n,o.lineTo(l,c);break;case"q":if(l=i[t++]*n+r,c=i[t++]*n,p=i[t++]*n+r,d=i[t++]*n,o.quadraticCurveTo(p,d,l,c),a=v[v.length-1])for(h=a.x,f=a.y,a=1,s=this.divisions;s>=a;a++){var b=a/s;e.Shape.Utils.b2(b,h,p,l),e.Shape.Utils.b2(b,f,d,c)}break;case"b":if(l=i[t++]*n+r,c=i[t++]*n,p=i[t++]*n+r,d=i[t++]*-n,m=i[t++]*n+r,g=i[t++]*-n,o.bezierCurveTo(l,c,p,d,m,g),a=v[v.length-1])for(h=a.x,f=a.y,a=1,s=this.divisions;s>=a;a++)b=a/s,e.Shape.Utils.b3(b,h,p,m,l),e.Shape.Utils.b3(b,f,d,g,c)}return{offset:y.ha*n,path:o}}}},e.FontUtils.generateShapes=function(t,i){var i=i||{},n=void 0!==i.curveSegments?i.curveSegments:4,r=void 0!==i.font?i.font:"helvetiker",o=void 0!==i.weight?i.weight:"normal",a=void 0!==i.style?i.style:"normal";for(e.FontUtils.size=void 0!==i.size?i.size:100,e.FontUtils.divisions=n,e.FontUtils.face=r,e.FontUtils.weight=o,e.FontUtils.style=a,n=e.FontUtils.drawText(t).paths,r=[],o=0,a=n.length;a>o;o++)Array.prototype.push.apply(r,n[o].toShapes());return r},function(e){var t=function(e){for(var t=e.length,i=0,n=t-1,r=0;t>r;n=r++)i+=e[n].x*e[r].y-e[r].x*e[n].y;return.5*i};return e.Triangulate=function(e,i){var n=e.length;if(3>n)return null;var r,o,a,s=[],l=[],u=[];if(0<t(e))for(o=0;n>o;o++)l[o]=o;else for(o=0;n>o;o++)l[o]=n-1-o;var c=2*n;for(o=n-1;n>2;){if(0>=c--){console.log("Warning, unable to triangulate polygon!");break}r=o,r>=n&&(r=0),o=r+1,o>=n&&(o=0),a=o+1,a>=n&&(a=0);var h;e:{var f=h=void 0,p=void 0,d=void 0,m=void 0,g=void 0,v=void 0,y=void 0,b=void 0,f=e[l[r]].x,p=e[l[r]].y,d=e[l[o]].x,m=e[l[o]].y,g=e[l[a]].x,v=e[l[a]].y;if(1e-10>(d-f)*(v-p)-(m-p)*(g-f))h=!1;else{var x=void 0,w=void 0,_=void 0,S=void 0,M=void 0,C=void 0,A=void 0,T=void 0,E=void 0,k=void 0,E=T=A=b=y=void 0,x=g-d,w=v-m,_=f-g,S=p-v,M=d-f,C=m-p;for(h=0;n>h;h++)if(h!==r&&h!==o&&h!==a&&(y=e[l[h]].x,b=e[l[h]].y,A=y-f,T=b-p,E=y-d,k=b-m,y-=g,b-=v,E=x*k-w*E,A=M*T-C*A,T=_*b-S*y,E>=0&&T>=0&&A>=0)){h=!1;break e}h=!0}}if(h){for(s.push([e[l[r]],e[l[o]],e[l[a]]]),u.push([l[r],l[o],l[a]]),r=o,a=o+1;n>a;r++,a++)l[r]=l[a];n--,c=2*n}}return i?u:s},e.Triangulate.area=t,e}(e.FontUtils),self._typeface_js={faces:e.FontUtils.faces,loadFace:e.FontUtils.loadFace},e.typeface_js=self._typeface_js,e.Curve=function(){},e.Curve.prototype.getPoint=function(){return console.log("Warning, getPoint() not implemented!"),null},e.Curve.prototype.getPointAt=function(e){return e=this.getUtoTmapping(e),this.getPoint(e)},e.Curve.prototype.getPoints=function(e){e||(e=5);var t,i=[];for(t=0;e>=t;t++)i.push(this.getPoint(t/e));return i},e.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,i=[];for(t=0;e>=t;t++)i.push(this.getPointAt(t/e));return i},e.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},e.Curve.prototype.getLengths=function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,i,n=[],r=this.getPoint(0),o=0;for(n.push(0),i=1;e>=i;i++)t=this.getPoint(i/e),o+=t.distanceTo(r),n.push(o),r=t;return this.cacheArcLengths=n},e.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},e.Curve.prototype.getUtoTmapping=function(e,t){var i,n=this.getLengths(),r=0,o=n.length;i=t?t:e*n[o-1];for(var a,s=0,l=o-1;l>=s;)if(r=Math.floor(s+(l-s)/2),a=n[r]-i,0>a)s=r+1;else{if(!(a>0)){l=r;break}l=r-1}return r=l,n[r]==i?r/(o-1):(s=n[r],n=(r+(i-s)/(n[r+1]-s))/(o-1))},e.Curve.prototype.getTangent=function(e){var t=e-1e-4,e=e+1e-4;return 0>t&&(t=0),e>1&&(e=1),t=this.getPoint(t),this.getPoint(e).clone().sub(t).normalize()},e.Curve.prototype.getTangentAt=function(e){return e=this.getUtoTmapping(e),this.getTangent(e)},e.LineCurve=function(e,t){this.v1=e,this.v2=t},e.LineCurve.prototype=Object.create(e.Curve.prototype),e.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},e.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},e.LineCurve.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},e.QuadraticBezierCurve=function(e,t,i){this.v0=e,this.v1=t,this.v2=i},e.QuadraticBezierCurve.prototype=Object.create(e.Curve.prototype),e.QuadraticBezierCurve.prototype.getPoint=function(t){var i;return i=e.Shape.Utils.b2(t,this.v0.x,this.v1.x,this.v2.x),t=e.Shape.Utils.b2(t,this.v0.y,this.v1.y,this.v2.y),new e.Vector2(i,t)},e.QuadraticBezierCurve.prototype.getTangent=function(t){var i;return i=e.Curve.Utils.tangentQuadraticBezier(t,this.v0.x,this.v1.x,this.v2.x),t=e.Curve.Utils.tangentQuadraticBezier(t,this.v0.y,this.v1.y,this.v2.y),i=new e.Vector2(i,t),i.normalize(),i},e.CubicBezierCurve=function(e,t,i,n){this.v0=e,this.v1=t,this.v2=i,this.v3=n},e.CubicBezierCurve.prototype=Object.create(e.Curve.prototype),e.CubicBezierCurve.prototype.getPoint=function(t){var i;return i=e.Shape.Utils.b3(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t=e.Shape.Utils.b3(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new e.Vector2(i,t)},e.CubicBezierCurve.prototype.getTangent=function(t){var i;return i=e.Curve.Utils.tangentCubicBezier(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t=e.Curve.Utils.tangentCubicBezier(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y),i=new e.Vector2(i,t),i.normalize(),i},e.SplineCurve=function(e){this.points=void 0==e?[]:e},e.SplineCurve.prototype=Object.create(e.Curve.prototype),e.SplineCurve.prototype.getPoint=function(t){var i,n=new e.Vector2,r=[],o=this.points;return i=(o.length-1)*t,t=Math.floor(i),i-=t,r[0]=0==t?t:t-1,r[1]=t,r[2]=t>o.length-2?o.length-1:t+1,r[3]=t>o.length-3?o.length-1:t+2,n.x=e.Curve.Utils.interpolate(o[r[0]].x,o[r[1]].x,o[r[2]].x,o[r[3]].x,i),n.y=e.Curve.Utils.interpolate(o[r[0]].y,o[r[1]].y,o[r[2]].y,o[r[3]].y,i),n},e.EllipseCurve=function(e,t,i,n,r,o,a){this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=o,this.aClockwise=a},e.EllipseCurve.prototype=Object.create(e.Curve.prototype),e.EllipseCurve.prototype.getPoint=function(t){var i=this.aEndAngle-this.aStartAngle;return this.aClockwise||(t=1-t),i=this.aStartAngle+t*i,t=this.aX+this.xRadius*Math.cos(i),i=this.aY+this.yRadius*Math.sin(i),new e.Vector2(t,i)},e.ArcCurve=function(t,i,n,r,o,a){e.EllipseCurve.call(this,t,i,n,n,r,o,a)},e.ArcCurve.prototype=Object.create(e.EllipseCurve.prototype),e.Curve.Utils={tangentQuadraticBezier:function(e,t,i,n){return 2*(1-e)*(i-t)+2*e*(n-i)},tangentCubicBezier:function(e,t,i,n,r){return-3*t*(1-e)*(1-e)+3*i*(1-e)*(1-e)-6*e*i*(1-e)+6*e*n*(1-e)-3*e*e*n+3*e*e*r},tangentSpline:function(e){return 6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e)},interpolate:function(e,t,i,n,r){var e=.5*(i-e),n=.5*(n-t),o=r*r;return(2*t-2*i+e+n)*r*o+(-3*t+3*i-2*e-n)*o+e*r+t}},e.Curve.create=function(t,i){return t.prototype=Object.create(e.Curve.prototype),t.prototype.getPoint=i,t},e.LineCurve3=e.Curve.create(function(e,t){this.v1=e,this.v2=t},function(t){var i=new e.Vector3;return i.subVectors(this.v2,this.v1),i.multiplyScalar(t),i.add(this.v1),i}),e.QuadraticBezierCurve3=e.Curve.create(function(e,t,i){this.v0=e,this.v1=t,this.v2=i},function(t){var i,n;return i=e.Shape.Utils.b2(t,this.v0.x,this.v1.x,this.v2.x),n=e.Shape.Utils.b2(t,this.v0.y,this.v1.y,this.v2.y),t=e.Shape.Utils.b2(t,this.v0.z,this.v1.z,this.v2.z),new e.Vector3(i,n,t)}),e.CubicBezierCurve3=e.Curve.create(function(e,t,i,n){this.v0=e,this.v1=t,this.v2=i,this.v3=n},function(t){var i,n;return i=e.Shape.Utils.b3(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x),n=e.Shape.Utils.b3(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y),t=e.Shape.Utils.b3(t,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new e.Vector3(i,n,t)}),e.SplineCurve3=e.Curve.create(function(e){this.points=void 0==e?[]:e},function(t){var i,n=new e.Vector3,r=[],o=this.points,t=(o.length-1)*t;i=Math.floor(t),t-=i,r[0]=0==i?i:i-1,r[1]=i,r[2]=i>o.length-2?o.length-1:i+1,r[3]=i>o.length-3?o.length-1:i+2,i=o[r[0]];var a=o[r[1]],s=o[r[2]],r=o[r[3]];return n.x=e.Curve.Utils.interpolate(i.x,a.x,s.x,r.x,t),n.y=e.Curve.Utils.interpolate(i.y,a.y,s.y,r.y,t),n.z=e.Curve.Utils.interpolate(i.z,a.z,s.z,r.z,t),n}),e.ClosedSplineCurve3=e.Curve.create(function(e){this.points=void 0==e?[]:e},function(t){var i,n=new e.Vector3,r=[],o=this.points;return i=(o.length-0)*t,t=Math.floor(i),i-=t,t+=t>0?0:(Math.floor(Math.abs(t)/o.length)+1)*o.length,r[0]=(t-1)%o.length,r[1]=t%o.length,r[2]=(t+1)%o.length,r[3]=(t+2)%o.length,n.x=e.Curve.Utils.interpolate(o[r[0]].x,o[r[1]].x,o[r[2]].x,o[r[3]].x,i),n.y=e.Curve.Utils.interpolate(o[r[0]].y,o[r[1]].y,o[r[2]].y,o[r[3]].y,i),n.z=e.Curve.Utils.interpolate(o[r[0]].z,o[r[1]].z,o[r[2]].z,o[r[3]].z,i),n}),e.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},e.CurvePath.prototype=Object.create(e.Curve.prototype),e.CurvePath.prototype.add=function(e){this.curves.push(e)},e.CurvePath.prototype.checkConnection=function(){},e.CurvePath.prototype.closePath=function(){var t=this.curves[0].getPoint(0),i=this.curves[this.curves.length-1].getPoint(1);t.equals(i)||this.curves.push(new e.LineCurve(i,t))},e.CurvePath.prototype.getPoint=function(e){for(var t=e*this.getLength(),i=this.getCurveLengths(),e=0;e<i.length;){if(i[e]>=t)return t=i[e]-t,e=this.curves[e],t=1-t/e.getLength(),e.getPointAt(t);e++}return null},e.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},e.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e,t=[],i=0,n=this.curves.length;for(e=0;n>e;e++)i+=this.curves[e].getLength(),t.push(i);return this.cacheLengths=t},e.CurvePath.prototype.getBoundingBox=function(){var t,i,n,r,o,a,s=this.getPoints();t=i=Number.NEGATIVE_INFINITY,r=o=Number.POSITIVE_INFINITY;var l,u,c,h,f=s[0]instanceof e.Vector3;for(h=f?new e.Vector3:new e.Vector2,u=0,c=s.length;c>u;u++)l=s[u],l.x>t?t=l.x:l.x<r&&(r=l.x),l.y>i?i=l.y:l.y<o&&(o=l.y),f&&(l.z>n?n=l.z:l.z<a&&(a=l.z)),h.add(l);return s={minX:r,minY:o,maxX:t,maxY:i,centroid:h.divideScalar(c)},f&&(s.maxZ=n,s.minZ=a),s},e.CurvePath.prototype.createPointsGeometry=function(e){return e=this.getPoints(e,!0),this.createGeometry(e)},e.CurvePath.prototype.createSpacedPointsGeometry=function(e){return e=this.getSpacedPoints(e,!0),this.createGeometry(e)},e.CurvePath.prototype.createGeometry=function(t){for(var i=new e.Geometry,n=0;n<t.length;n++)i.vertices.push(new e.Vector3(t[n].x,t[n].y,t[n].z||0));return i},e.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},e.CurvePath.prototype.getTransformedPoints=function(e,t){var i,n,r=this.getPoints(e);for(t||(t=this.bends),i=0,n=t.length;n>i;i++)r=this.getWrapPoints(r,t[i]);return r},e.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var i,n,r=this.getSpacedPoints(e);for(t||(t=this.bends),i=0,n=t.length;n>i;i++)r=this.getWrapPoints(r,t[i]);return r},e.CurvePath.prototype.getWrapPoints=function(e,t){var i,n,r,o,a,s,l=this.getBoundingBox();for(i=0,n=e.length;n>i;i++)r=e[i],o=r.x,a=r.y,s=o/l.maxX,s=t.getUtoTmapping(s,o),o=t.getPoint(s),a=t.getNormalVector(s).multiplyScalar(a),r.x=o.x+a.x,r.y=o.y+a.y;return e},e.Gyroscope=function(){e.Object3D.call(this)},e.Gyroscope.prototype=Object.create(e.Object3D.prototype),e.Gyroscope.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(this.translationWorld,this.rotationWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.rotationObject,this.scaleObject),this.matrixWorld.makeFromPositionQuaternionScale(this.translationWorld,this.rotationObject,this.scaleWorld)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,i=this.children.length;i>t;t++)this.children[t].updateMatrixWorld(e)},e.Gyroscope.prototype.translationWorld=new e.Vector3,e.Gyroscope.prototype.translationObject=new e.Vector3,e.Gyroscope.prototype.rotationWorld=new e.Quaternion,e.Gyroscope.prototype.rotationObject=new e.Quaternion,e.Gyroscope.prototype.scaleWorld=new e.Vector3,e.Gyroscope.prototype.scaleObject=new e.Vector3,e.Path=function(t){e.CurvePath.call(this),this.actions=[],t&&this.fromPoints(t)},e.Path.prototype=Object.create(e.CurvePath.prototype),e.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},e.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);
for(var t=1,i=e.length;i>t;t++)this.lineTo(e[t].x,e[t].y)},e.Path.prototype.moveTo=function(){var t=Array.prototype.slice.call(arguments);this.actions.push({action:e.PathActions.MOVE_TO,args:t})},e.Path.prototype.lineTo=function(t,i){var n=Array.prototype.slice.call(arguments),r=this.actions[this.actions.length-1].args,r=new e.LineCurve(new e.Vector2(r[r.length-2],r[r.length-1]),new e.Vector2(t,i));this.curves.push(r),this.actions.push({action:e.PathActions.LINE_TO,args:n})},e.Path.prototype.quadraticCurveTo=function(t,i,n,r){var o=Array.prototype.slice.call(arguments),a=this.actions[this.actions.length-1].args,a=new e.QuadraticBezierCurve(new e.Vector2(a[a.length-2],a[a.length-1]),new e.Vector2(t,i),new e.Vector2(n,r));this.curves.push(a),this.actions.push({action:e.PathActions.QUADRATIC_CURVE_TO,args:o})},e.Path.prototype.bezierCurveTo=function(t,i,n,r,o,a){var s=Array.prototype.slice.call(arguments),l=this.actions[this.actions.length-1].args,l=new e.CubicBezierCurve(new e.Vector2(l[l.length-2],l[l.length-1]),new e.Vector2(t,i),new e.Vector2(n,r),new e.Vector2(o,a));this.curves.push(l),this.actions.push({action:e.PathActions.BEZIER_CURVE_TO,args:s})},e.Path.prototype.splineThru=function(t){var i=Array.prototype.slice.call(arguments),n=this.actions[this.actions.length-1].args,n=[new e.Vector2(n[n.length-2],n[n.length-1])];Array.prototype.push.apply(n,t),n=new e.SplineCurve(n),this.curves.push(n),this.actions.push({action:e.PathActions.CSPLINE_THRU,args:i})},e.Path.prototype.arc=function(e,t,i,n,r,o){var a=this.actions[this.actions.length-1].args;this.absarc(e+a[a.length-2],t+a[a.length-1],i,n,r,o)},e.Path.prototype.absarc=function(e,t,i,n,r,o){this.absellipse(e,t,i,i,n,r,o)},e.Path.prototype.ellipse=function(e,t,i,n,r,o,a){var s=this.actions[this.actions.length-1].args;this.absellipse(e+s[s.length-2],t+s[s.length-1],i,n,r,o,a)},e.Path.prototype.absellipse=function(t,i,n,r,o,a,s){var l=Array.prototype.slice.call(arguments),u=new e.EllipseCurve(t,i,n,r,o,a,s);this.curves.push(u),u=u.getPoint(s?1:0),l.push(u.x),l.push(u.y),this.actions.push({action:e.PathActions.ELLIPSE,args:l})},e.Path.prototype.getSpacedPoints=function(e){e||(e=40);for(var t=[],i=0;e>i;i++)t.push(this.getPoint(i/e));return t},e.Path.prototype.getPoints=function(t,i){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(t,i);var n,r,o,a,s,l,u,c,h,f,p,d,m,t=t||12,g=[];for(n=0,r=this.actions.length;r>n;n++)switch(o=this.actions[n],a=o.action,o=o.args,a){case e.PathActions.MOVE_TO:g.push(new e.Vector2(o[0],o[1]));break;case e.PathActions.LINE_TO:g.push(new e.Vector2(o[0],o[1]));break;case e.PathActions.QUADRATIC_CURVE_TO:for(s=o[2],l=o[3],h=o[0],f=o[1],0<g.length?(a=g[g.length-1],p=a.x,d=a.y):(a=this.actions[n-1].args,p=a[a.length-2],d=a[a.length-1]),o=1;t>=o;o++)m=o/t,a=e.Shape.Utils.b2(m,p,h,s),m=e.Shape.Utils.b2(m,d,f,l),g.push(new e.Vector2(a,m));break;case e.PathActions.BEZIER_CURVE_TO:for(s=o[4],l=o[5],h=o[0],f=o[1],u=o[2],c=o[3],0<g.length?(a=g[g.length-1],p=a.x,d=a.y):(a=this.actions[n-1].args,p=a[a.length-2],d=a[a.length-1]),o=1;t>=o;o++)m=o/t,a=e.Shape.Utils.b3(m,p,h,u,s),m=e.Shape.Utils.b3(m,d,f,c,l),g.push(new e.Vector2(a,m));break;case e.PathActions.CSPLINE_THRU:for(a=this.actions[n-1].args,m=[new e.Vector2(a[a.length-2],a[a.length-1])],a=t*o[0].length,m=m.concat(o[0]),m=new e.SplineCurve(m),o=1;a>=o;o++)g.push(m.getPointAt(o/a));break;case e.PathActions.ARC:for(s=o[0],l=o[1],f=o[2],u=o[3],a=o[4],h=!!o[5],p=a-u,d=2*t,o=1;d>=o;o++)m=o/d,h||(m=1-m),m=u+m*p,a=s+f*Math.cos(m),m=l+f*Math.sin(m),g.push(new e.Vector2(a,m));break;case e.PathActions.ELLIPSE:for(s=o[0],l=o[1],f=o[2],c=o[3],u=o[4],a=o[5],h=!!o[6],p=a-u,d=2*t,o=1;d>=o;o++)m=o/d,h||(m=1-m),m=u+m*p,a=s+f*Math.cos(m),m=l+c*Math.sin(m),g.push(new e.Vector2(a,m))}return n=g[g.length-1],1e-10>Math.abs(n.x-g[0].x)&&1e-10>Math.abs(n.y-g[0].y)&&g.splice(g.length-1,1),i&&g.push(g[0]),g},e.Path.prototype.toShapes=function(){var t,i,n,r,o=[],a=new e.Path;for(t=0,i=this.actions.length;i>t;t++)n=this.actions[t],r=n.args,n=n.action,n==e.PathActions.MOVE_TO&&0!=a.actions.length&&(o.push(a),a=new e.Path),a[n].apply(a,r);if(0!=a.actions.length&&o.push(a),0==o.length)return[];var s;if(r=[],t=!e.Shape.Utils.isClockWise(o[0].getPoints()),1==o.length)return a=o[0],s=new e.Shape,s.actions=a.actions,s.curves=a.curves,r.push(s),r;if(t)for(s=new e.Shape,t=0,i=o.length;i>t;t++)a=o[t],e.Shape.Utils.isClockWise(a.getPoints())?(s.actions=a.actions,s.curves=a.curves,r.push(s),s=new e.Shape):s.holes.push(a);else{for(t=0,i=o.length;i>t;t++)a=o[t],e.Shape.Utils.isClockWise(a.getPoints())?(s&&r.push(s),s=new e.Shape,s.actions=a.actions,s.curves=a.curves):s.holes.push(a);r.push(s)}return r},e.Shape=function(){e.Path.apply(this,arguments),this.holes=[]},e.Shape.prototype=Object.create(e.Path.prototype),e.Shape.prototype.extrude=function(t){return new e.ExtrudeGeometry(this,t)},e.Shape.prototype.makeGeometry=function(t){return new e.ShapeGeometry(this,t)},e.Shape.prototype.getPointsHoles=function(e){var t,i=this.holes.length,n=[];for(t=0;i>t;t++)n[t]=this.holes[t].getTransformedPoints(e,this.bends);return n},e.Shape.prototype.getSpacedPointsHoles=function(e){var t,i=this.holes.length,n=[];for(t=0;i>t;t++)n[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return n},e.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},e.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},e.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},e.Shape.Utils={removeHoles:function(t,i){var n,r,o,a,s,l,u,c,h,f,p=t.concat(),d=p.concat(),m=[];for(s=0;s<i.length;s++){for(l=i[s],Array.prototype.push.apply(d,l),r=Number.POSITIVE_INFINITY,n=0;n<l.length;n++)for(h=l[n],f=[],c=0;c<p.length;c++)u=p[c],u=h.distanceToSquared(u),f.push(u),r>u&&(r=u,o=n,a=c);n=a-1>=0?a-1:p.length-1,r=o-1>=0?o-1:l.length-1;var g=[l[o],p[a],p[n]];c=e.FontUtils.Triangulate.area(g);var v=[l[o],l[r],p[a]];h=e.FontUtils.Triangulate.area(v),f=a,u=o,a+=1,o+=-1,0>a&&(a+=p.length),a%=p.length,0>o&&(o+=l.length),o%=l.length,n=a-1>=0?a-1:p.length-1,r=o-1>=0?o-1:l.length-1,g=[l[o],p[a],p[n]],g=e.FontUtils.Triangulate.area(g),v=[l[o],l[r],p[a]],v=e.FontUtils.Triangulate.area(v),c+h>g+v&&(a=f,o=u,0>a&&(a+=p.length),a%=p.length,0>o&&(o+=l.length),o%=l.length,n=a-1>=0?a-1:p.length-1,r=o-1>=0?o-1:l.length-1),c=p.slice(0,a),h=p.slice(a),f=l.slice(o),u=l.slice(0,o),r=[l[o],l[r],p[a]],m.push([l[o],p[a],p[n]]),m.push(r),p=c.concat(f).concat(u).concat(h)}return{shape:p,isolatedPts:m,allpoints:d}},triangulateShape:function(t,i){var n,r,o,a,s=e.Shape.Utils.removeHoles(t,i),l=s.allpoints,u=s.isolatedPts,s=e.FontUtils.Triangulate(s.shape,!1),c={};for(n=0,r=l.length;r>n;n++)a=l[n].x+":"+l[n].y,void 0!==c[a]&&console.log("Duplicate point",a),c[a]=n;for(n=0,r=s.length;r>n;n++)for(o=s[n],l=0;3>l;l++)a=o[l].x+":"+o[l].y,a=c[a],void 0!==a&&(o[l]=a);for(n=0,r=u.length;r>n;n++)for(o=u[n],l=0;3>l;l++)a=o[l].x+":"+o[l].y,a=c[a],void 0!==a&&(o[l]=a);return s.concat(u)},isClockWise:function(t){return 0>e.FontUtils.Triangulate.area(t)},b2p0:function(e,t){var i=1-e;return i*i*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,i,n){return this.b2p0(e,t)+this.b2p1(e,i)+this.b2p2(e,n)},b3p0:function(e,t){var i=1-e;return i*i*i*t},b3p1:function(e,t){var i=1-e;return 3*i*i*e*t},b3p2:function(e,t){return 3*(1-e)*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,i,n,r){return this.b3p0(e,t)+this.b3p1(e,i)+this.b3p2(e,n)+this.b3p3(e,r)}},e.AnimationHandler=function(){var t=[],i={},n={update:function(e){for(var i=0;i<t.length;i++)t[i].update(e)},addToUpdate:function(e){-1===t.indexOf(e)&&t.push(e)},removeFromUpdate:function(e){e=t.indexOf(e),-1!==e&&t.splice(e,1)},add:function(t){if(void 0!==i[t.name]&&console.log("THREE.AnimationHandler.add: Warning! "+t.name+" already exists in library. Overwriting."),i[t.name]=t,!0!==t.initialized){for(var n=0;n<t.hierarchy.length;n++){for(var r=0;r<t.hierarchy[n].keys.length;r++)if(0>t.hierarchy[n].keys[r].time&&(t.hierarchy[n].keys[r].time=0),void 0!==t.hierarchy[n].keys[r].rot&&!(t.hierarchy[n].keys[r].rot instanceof e.Quaternion)){var o=t.hierarchy[n].keys[r].rot;t.hierarchy[n].keys[r].rot=new e.Quaternion(o[0],o[1],o[2],o[3])}if(t.hierarchy[n].keys.length&&void 0!==t.hierarchy[n].keys[0].morphTargets){for(o={},r=0;r<t.hierarchy[n].keys.length;r++)for(var a=0;a<t.hierarchy[n].keys[r].morphTargets.length;a++){var s=t.hierarchy[n].keys[r].morphTargets[a];o[s]=-1}for(t.hierarchy[n].usedMorphTargets=o,r=0;r<t.hierarchy[n].keys.length;r++){var l={};for(s in o){for(a=0;a<t.hierarchy[n].keys[r].morphTargets.length;a++)if(t.hierarchy[n].keys[r].morphTargets[a]===s){l[s]=t.hierarchy[n].keys[r].morphTargetsInfluences[a];break}a===t.hierarchy[n].keys[r].morphTargets.length&&(l[s]=0)}t.hierarchy[n].keys[r].morphTargetsInfluences=l}}for(r=1;r<t.hierarchy[n].keys.length;r++)t.hierarchy[n].keys[r].time===t.hierarchy[n].keys[r-1].time&&(t.hierarchy[n].keys.splice(r,1),r--);for(r=0;r<t.hierarchy[n].keys.length;r++)t.hierarchy[n].keys[r].index=r}for(r=parseInt(t.length*t.fps,10),t.JIT={},t.JIT.hierarchy=[],n=0;n<t.hierarchy.length;n++)t.JIT.hierarchy.push(Array(r));t.initialized=!0}},get:function(e){return"string"==typeof e?i[e]?i[e]:(console.log("THREE.AnimationHandler.get: Couldn't find animation "+e),null):void 0},parse:function(t){var i=[];if(t instanceof e.SkinnedMesh)for(var n=0;n<t.bones.length;n++)i.push(t.bones[n]);else r(t,i);return i}},r=function(e,t){t.push(e);for(var i=0;i<e.children.length;i++)r(e.children[i],t)};return n.LINEAR=0,n.CATMULLROM=1,n.CATMULLROM_FORWARD=2,n}(),e.Animation=function(t,i,n){this.root=t,this.data=e.AnimationHandler.get(i),this.hierarchy=e.AnimationHandler.parse(t),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.loop=this.isPaused=!0,this.interpolationType=void 0!==n?n:e.AnimationHandler.LINEAR,this.points=[],this.target=new e.Vector3},e.Animation.prototype.play=function(t,i){if(!1===this.isPlaying){this.isPlaying=!0,this.loop=void 0!==t?t:!0,this.currentTime=void 0!==i?i:0;var n,r,o=this.hierarchy.length;for(n=0;o>n;n++){r=this.hierarchy[n],this.interpolationType!==e.AnimationHandler.CATMULLROM_FORWARD&&(r.useQuaternion=!0),r.matrixAutoUpdate=!0,void 0===r.animationCache&&(r.animationCache={},r.animationCache.prevKey={pos:0,rot:0,scl:0},r.animationCache.nextKey={pos:0,rot:0,scl:0},r.animationCache.originalMatrix=r instanceof e.Bone?r.skinMatrix:r.matrix);var a=r.animationCache.prevKey;r=r.animationCache.nextKey,a.pos=this.data.hierarchy[n].keys[0],a.rot=this.data.hierarchy[n].keys[0],a.scl=this.data.hierarchy[n].keys[0],r.pos=this.getNextKeyWith("pos",n,1),r.rot=this.getNextKeyWith("rot",n,1),r.scl=this.getNextKeyWith("scl",n,1)}this.update(0)}this.isPaused=!1,e.AnimationHandler.addToUpdate(this)},e.Animation.prototype.pause=function(){!0===this.isPaused?e.AnimationHandler.addToUpdate(this):e.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},e.Animation.prototype.stop=function(){this.isPaused=this.isPlaying=!1,e.AnimationHandler.removeFromUpdate(this)},e.Animation.prototype.update=function(t){if(!1!==this.isPlaying){var i,n,r,o,a,s,l,u,c,h=["pos","rot","scl"];c=this.currentTime+=t*this.timeScale,u=this.currentTime%=this.data.length,parseInt(Math.min(u*this.data.fps,this.data.length*this.data.fps),10);for(var f=0,p=this.hierarchy.length;p>f;f++){t=this.hierarchy[f],l=t.animationCache;for(var d=0;3>d;d++){if(i=h[d],a=l.prevKey[i],s=l.nextKey[i],s.time<=c){if(c>u){if(!this.loop)return void this.stop();for(a=this.data.hierarchy[f].keys[0],s=this.getNextKeyWith(i,f,1);s.time<u;)a=s,s=this.getNextKeyWith(i,f,s.index+1)}else do a=s,s=this.getNextKeyWith(i,f,s.index+1);while(s.time<u);l.prevKey[i]=a,l.nextKey[i]=s}t.matrixAutoUpdate=!0,t.matrixWorldNeedsUpdate=!0,n=(u-a.time)/(s.time-a.time),r=a[i],o=s[i],(0>n||n>1)&&(console.log("THREE.Animation.update: Warning! Scale out of bounds:"+n+" on bone "+f),n=0>n?0:1),"pos"===i?(i=t.position,this.interpolationType===e.AnimationHandler.LINEAR?(i.x=r[0]+(o[0]-r[0])*n,i.y=r[1]+(o[1]-r[1])*n,i.z=r[2]+(o[2]-r[2])*n):(this.interpolationType===e.AnimationHandler.CATMULLROM||this.interpolationType===e.AnimationHandler.CATMULLROM_FORWARD)&&(this.points[0]=this.getPrevKeyWith("pos",f,a.index-1).pos,this.points[1]=r,this.points[2]=o,this.points[3]=this.getNextKeyWith("pos",f,s.index+1).pos,n=.33*n+.33,r=this.interpolateCatmullRom(this.points,n),i.x=r[0],i.y=r[1],i.z=r[2],this.interpolationType===e.AnimationHandler.CATMULLROM_FORWARD&&(n=this.interpolateCatmullRom(this.points,1.01*n),this.target.set(n[0],n[1],n[2]),this.target.sub(i),this.target.y=0,this.target.normalize(),n=Math.atan2(this.target.x,this.target.z),t.rotation.set(0,n,0)))):"rot"===i?e.Quaternion.slerp(r,o,t.quaternion,n):"scl"===i&&(i=t.scale,i.x=r[0]+(o[0]-r[0])*n,i.y=r[1]+(o[1]-r[1])*n,i.z=r[2]+(o[2]-r[2])*n)}}}},e.Animation.prototype.interpolateCatmullRom=function(e,t){var i,n,r,o,a,s,l=[],u=[];return i=(e.length-1)*t,n=Math.floor(i),i-=n,l[0]=0===n?n:n-1,l[1]=n,l[2]=n>e.length-2?n:n+1,l[3]=n>e.length-3?n:n+2,n=e[l[0]],o=e[l[1]],a=e[l[2]],s=e[l[3]],l=i*i,r=i*l,u[0]=this.interpolate(n[0],o[0],a[0],s[0],i,l,r),u[1]=this.interpolate(n[1],o[1],a[1],s[1],i,l,r),u[2]=this.interpolate(n[2],o[2],a[2],s[2],i,l,r),u},e.Animation.prototype.interpolate=function(e,t,i,n,r,o,a){return e=.5*(i-e),n=.5*(n-t),(2*(t-i)+e+n)*a+(-3*(t-i)-2*e-n)*o+e*r+t},e.Animation.prototype.getNextKeyWith=function(t,i,n){for(var r=this.data.hierarchy[i].keys,n=this.interpolationType===e.AnimationHandler.CATMULLROM||this.interpolationType===e.AnimationHandler.CATMULLROM_FORWARD?n<r.length-1?n:r.length-1:n%r.length;n<r.length;n++)if(void 0!==r[n][t])return r[n];return this.data.hierarchy[i].keys[0]},e.Animation.prototype.getPrevKeyWith=function(t,i,n){for(var r=this.data.hierarchy[i].keys,n=this.interpolationType===e.AnimationHandler.CATMULLROM||this.interpolationType===e.AnimationHandler.CATMULLROM_FORWARD?n>0?n:0:n>=0?n:n+r.length;n>=0;n--)if(void 0!==r[n][t])return r[n];return this.data.hierarchy[i].keys[r.length-1]},e.KeyFrameAnimation=function(t,i,n){for(this.root=t,this.data=e.AnimationHandler.get(i),this.hierarchy=e.AnimationHandler.parse(t),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.loop=this.isPaused=!0,this.JITCompile=void 0!==n?n:!0,t=0,i=this.hierarchy.length;i>t;t++){var n=this.data.hierarchy[t].sids,r=this.hierarchy[t];if(this.data.hierarchy[t].keys.length&&n){for(var o=0;o<n.length;o++){var a=n[o],s=this.getNextKeyWith(a,t,0);s&&s.apply(a)}r.matrixAutoUpdate=!1,this.data.hierarchy[t].node.updateMatrix(),r.matrixWorldNeedsUpdate=!0}}},e.KeyFrameAnimation.prototype.play=function(t,i){if(!this.isPlaying){this.isPlaying=!0,this.loop=void 0!==t?t:!0,this.currentTime=void 0!==i?i:0,this.startTimeMs=i,this.startTime=1e7,this.endTime=-this.startTime;var n,r,o,a=this.hierarchy.length;for(n=0;a>n;n++)r=this.hierarchy[n],o=this.data.hierarchy[n],r.useQuaternion=!0,void 0===o.animationCache&&(o.animationCache={},o.animationCache.prevKey=null,o.animationCache.nextKey=null,o.animationCache.originalMatrix=r instanceof e.Bone?r.skinMatrix:r.matrix),r=this.data.hierarchy[n].keys,r.length&&(o.animationCache.prevKey=r[0],o.animationCache.nextKey=r[1],this.startTime=Math.min(r[0].time,this.startTime),this.endTime=Math.max(r[r.length-1].time,this.endTime));this.update(0)}this.isPaused=!1,e.AnimationHandler.addToUpdate(this)},e.KeyFrameAnimation.prototype.pause=function(){this.isPaused?e.AnimationHandler.addToUpdate(this):e.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},e.KeyFrameAnimation.prototype.stop=function(){this.isPaused=this.isPlaying=!1,e.AnimationHandler.removeFromUpdate(this);for(var t=0;t<this.data.hierarchy.length;t++){var i=this.hierarchy[t],n=this.data.hierarchy[t];if(void 0!==n.animationCache){var r=n.animationCache.originalMatrix;i instanceof e.Bone?(r.copy(i.skinMatrix),i.skinMatrix=r):(r.copy(i.matrix),i.matrix=r),delete n.animationCache}}},e.KeyFrameAnimation.prototype.update=function(t){if(this.isPlaying){var i,n,r,o,a,s,l,u=this.data.JIT.hierarchy;if(s=this.currentTime+=t*this.timeScale,a=this.currentTime%=this.data.length,a<this.startTimeMs&&(a=this.currentTime=this.startTimeMs+a),o=parseInt(Math.min(a*this.data.fps,this.data.length*this.data.fps),10),(l=s>a)&&!this.loop){for(var t=0,c=this.hierarchy.length;c>t;t++){var h=this.data.hierarchy[t].keys,u=this.data.hierarchy[t].sids;if(r=h.length-1,o=this.hierarchy[t],h.length){for(h=0;h<u.length;h++)a=u[h],(s=this.getPrevKeyWith(a,t,r))&&s.apply(a);this.data.hierarchy[t].node.updateMatrix(),o.matrixWorldNeedsUpdate=!0}}this.stop()}else if(!(a<this.startTime)){for(t=0,c=this.hierarchy.length;c>t;t++){r=this.hierarchy[t],i=this.data.hierarchy[t];var h=i.keys,f=i.animationCache;if(this.JITCompile&&void 0!==u[t][o])r instanceof e.Bone?(r.skinMatrix=u[t][o],r.matrixWorldNeedsUpdate=!1):(r.matrix=u[t][o],r.matrixWorldNeedsUpdate=!0);else if(h.length){if(this.JITCompile&&f&&(r instanceof e.Bone?r.skinMatrix=f.originalMatrix:r.matrix=f.originalMatrix),i=f.prevKey,n=f.nextKey,i&&n){if(n.time<=s){if(l&&this.loop)for(i=h[0],n=h[1];n.time<a;)i=n,n=h[i.index+1];else if(!l)for(var p=h.length-1;n.time<a&&n.index!==p;)i=n,n=h[i.index+1];f.prevKey=i,f.nextKey=n}n.time>=a?i.interpolate(n,a):i.interpolate(n,n.time)}this.data.hierarchy[t].node.updateMatrix(),r.matrixWorldNeedsUpdate=!0}}if(this.JITCompile&&void 0===u[0][o])for(this.hierarchy[0].updateMatrixWorld(!0),t=0;t<this.hierarchy.length;t++)u[t][o]=this.hierarchy[t]instanceof e.Bone?this.hierarchy[t].skinMatrix.clone():this.hierarchy[t].matrix.clone()}}},e.KeyFrameAnimation.prototype.getNextKeyWith=function(e,t,i){for(t=this.data.hierarchy[t].keys,i%=t.length;i<t.length;i++)if(t[i].hasTarget(e))return t[i];return t[0]},e.KeyFrameAnimation.prototype.getPrevKeyWith=function(e,t,i){for(t=this.data.hierarchy[t].keys,i=i>=0?i:i+t.length;i>=0;i--)if(t[i].hasTarget(e))return t[i];return t[t.length-1]},e.CubeCamera=function(t,i,n){e.Object3D.call(this);var r=new e.PerspectiveCamera(90,1,t,i);r.up.set(0,-1,0),r.lookAt(new e.Vector3(1,0,0)),this.add(r);var o=new e.PerspectiveCamera(90,1,t,i);o.up.set(0,-1,0),o.lookAt(new e.Vector3(-1,0,0)),this.add(o);var a=new e.PerspectiveCamera(90,1,t,i);a.up.set(0,0,1),a.lookAt(new e.Vector3(0,1,0)),this.add(a);var s=new e.PerspectiveCamera(90,1,t,i);s.up.set(0,0,-1),s.lookAt(new e.Vector3(0,-1,0)),this.add(s);var l=new e.PerspectiveCamera(90,1,t,i);l.up.set(0,-1,0),l.lookAt(new e.Vector3(0,0,1)),this.add(l);var u=new e.PerspectiveCamera(90,1,t,i);u.up.set(0,-1,0),u.lookAt(new e.Vector3(0,0,-1)),this.add(u),this.renderTarget=new e.WebGLRenderTargetCube(n,n,{format:e.RGBFormat,magFilter:e.LinearFilter,minFilter:e.LinearFilter}),this.updateCubeMap=function(e,t){var i=this.renderTarget,n=i.generateMipmaps;i.generateMipmaps=!1,i.activeCubeFace=0,e.render(t,r,i),i.activeCubeFace=1,e.render(t,o,i),i.activeCubeFace=2,e.render(t,a,i),i.activeCubeFace=3,e.render(t,s,i),i.activeCubeFace=4,e.render(t,l,i),i.generateMipmaps=n,i.activeCubeFace=5,e.render(t,u,i)}},e.CubeCamera.prototype=Object.create(e.Object3D.prototype),e.CombinedCamera=function(t,i,n,r,o,a,s){e.Camera.call(this),this.fov=n,this.left=-t/2,this.right=t/2,this.top=i/2,this.bottom=-i/2,this.cameraO=new e.OrthographicCamera(t/-2,t/2,i/2,i/-2,a,s),this.cameraP=new e.PerspectiveCamera(n,t/i,r,o),this.zoom=1,this.toPerspective()},e.CombinedCamera.prototype=Object.create(e.Camera.prototype),e.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near,this.far=this.cameraP.far,this.cameraP.fov=this.fov/this.zoom,this.cameraP.updateProjectionMatrix(),this.projectionMatrix=this.cameraP.projectionMatrix,this.inPerspectiveMode=!0,this.inOrthographicMode=!1},e.CombinedCamera.prototype.toOrthographic=function(){var e=this.cameraP.aspect,t=(this.cameraP.near+this.cameraP.far)/2,t=Math.tan(this.fov/2)*t,e=2*t*e/2,t=t/this.zoom,e=e/this.zoom;this.cameraO.left=-e,this.cameraO.right=e,this.cameraO.top=t,this.cameraO.bottom=-t,this.cameraO.updateProjectionMatrix(),this.near=this.cameraO.near,this.far=this.cameraO.far,this.projectionMatrix=this.cameraO.projectionMatrix,this.inPerspectiveMode=!1,this.inOrthographicMode=!0},e.CombinedCamera.prototype.setSize=function(e,t){this.cameraP.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2},e.CombinedCamera.prototype.setFov=function(e){this.fov=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},e.CombinedCamera.prototype.updateProjectionMatrix=function(){this.inPerspectiveMode?this.toPerspective():(this.toPerspective(),this.toOrthographic())},e.CombinedCamera.prototype.setLens=function(t,i){void 0===i&&(i=24);var n=2*e.Math.radToDeg(Math.atan(i/(2*t)));return this.setFov(n),n},e.CombinedCamera.prototype.setZoom=function(e){this.zoom=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},e.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},e.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0,this.rotation.y=Math.PI,this.rotation.z=0,this.rotationAutoUpdate=!1},e.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0,this.rotation.y=-Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},e.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0,this.rotation.y=Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},e.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},e.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},e.CircleGeometry=function(t,i,n,r){e.Geometry.call(this);var o,t=t||50,n=void 0!==n?n:0,r=void 0!==r?r:2*Math.PI,i=void 0!==i?Math.max(3,i):8,a=[];o=new e.Vector3;var s=new e.Vector2(.5,.5);for(this.vertices.push(o),a.push(s),o=0;i>=o;o++){var l=new e.Vector3,u=n+o/i*r;l.x=t*Math.cos(u),l.y=t*Math.sin(u),this.vertices.push(l),a.push(new e.Vector2((l.x/t+1)/2,(l.y/t+1)/2))}for(n=new e.Vector3(0,0,1),o=1;i>=o;o++)this.faces.push(new e.Face3(o,o+1,0,[n,n,n])),this.faceVertexUvs[0].push([a[o],a[o+1],s]);this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new e.Sphere(new e.Vector3,t)},e.CircleGeometry.prototype=Object.create(e.Geometry.prototype),e.CubeGeometry=function(t,i,n,r,o,a){function s(t,i,n,r,o,a,s,u){var c,h=l.widthSegments,f=l.heightSegments,p=o/2,d=a/2,m=l.vertices.length;"x"===t&&"y"===i||"y"===t&&"x"===i?c="z":"x"===t&&"z"===i||"z"===t&&"x"===i?(c="y",f=l.depthSegments):("z"===t&&"y"===i||"y"===t&&"z"===i)&&(c="x",h=l.depthSegments);var g=h+1,v=f+1,y=o/h,b=a/f,x=new e.Vector3;for(x[c]=s>0?1:-1,o=0;v>o;o++)for(a=0;g>a;a++){var w=new e.Vector3;w[t]=(a*y-p)*n,w[i]=(o*b-d)*r,w[c]=s,l.vertices.push(w)}for(o=0;f>o;o++)for(a=0;h>a;a++)t=new e.Face4(a+g*o+m,a+g*(o+1)+m,a+1+g*(o+1)+m,a+1+g*o+m),t.normal.copy(x),t.vertexNormals.push(x.clone(),x.clone(),x.clone(),x.clone()),t.materialIndex=u,l.faces.push(t),l.faceVertexUvs[0].push([new e.Vector2(a/h,1-o/f),new e.Vector2(a/h,1-(o+1)/f),new e.Vector2((a+1)/h,1-(o+1)/f),new e.Vector2((a+1)/h,1-o/f)])}e.Geometry.call(this);var l=this;this.width=t,this.height=i,this.depth=n,this.widthSegments=r||1,this.heightSegments=o||1,this.depthSegments=a||1,t=this.width/2,i=this.height/2,n=this.depth/2,s("z","y",-1,-1,this.depth,this.height,t,0),s("z","y",1,-1,this.depth,this.height,-t,1),s("x","z",1,1,this.width,this.depth,i,2),s("x","z",1,-1,this.width,this.depth,-i,3),s("x","y",1,-1,this.width,this.height,n,4),s("x","y",-1,-1,this.width,this.height,-n,5),this.computeCentroids(),this.mergeVertices()},e.CubeGeometry.prototype=Object.create(e.Geometry.prototype),e.CylinderGeometry=function(t,i,n,r,o,a){e.Geometry.call(this),this.radiusTop=t=void 0!==t?t:20,this.radiusBottom=i=void 0!==i?i:20,this.height=n=void 0!==n?n:100,this.radiusSegments=r=r||8,this.heightSegments=o=o||1,this.openEnded=a=void 0!==a?a:!1;var s,l,u=n/2,c=[],h=[];for(l=0;o>=l;l++){var f=[],p=[],d=l/o,m=d*(i-t)+t;for(s=0;r>=s;s++){var g=s/r,v=new e.Vector3;v.x=m*Math.sin(2*g*Math.PI),v.y=-d*n+u,v.z=m*Math.cos(2*g*Math.PI),this.vertices.push(v),f.push(this.vertices.length-1),p.push(new e.Vector2(g,1-d))}c.push(f),h.push(p)}for(n=(i-t)/n,s=0;r>s;s++)for(0!==t?(f=this.vertices[c[0][s]].clone(),p=this.vertices[c[0][s+1]].clone()):(f=this.vertices[c[1][s]].clone(),p=this.vertices[c[1][s+1]].clone()),f.setY(Math.sqrt(f.x*f.x+f.z*f.z)*n).normalize(),p.setY(Math.sqrt(p.x*p.x+p.z*p.z)*n).normalize(),l=0;o>l;l++){var d=c[l][s],m=c[l+1][s],g=c[l+1][s+1],v=c[l][s+1],y=f.clone(),b=f.clone(),x=p.clone(),w=p.clone(),_=h[l][s].clone(),S=h[l+1][s].clone(),M=h[l+1][s+1].clone(),C=h[l][s+1].clone();this.faces.push(new e.Face4(d,m,g,v,[y,b,x,w])),this.faceVertexUvs[0].push([_,S,M,C])}if(!1===a&&t>0)for(this.vertices.push(new e.Vector3(0,u,0)),s=0;r>s;s++)d=c[0][s],m=c[0][s+1],g=this.vertices.length-1,y=new e.Vector3(0,1,0),b=new e.Vector3(0,1,0),x=new e.Vector3(0,1,0),_=h[0][s].clone(),S=h[0][s+1].clone(),M=new e.Vector2(S.u,0),this.faces.push(new e.Face3(d,m,g,[y,b,x])),this.faceVertexUvs[0].push([_,S,M]);if(!1===a&&i>0)for(this.vertices.push(new e.Vector3(0,-u,0)),s=0;r>s;s++)d=c[l][s+1],m=c[l][s],g=this.vertices.length-1,y=new e.Vector3(0,-1,0),b=new e.Vector3(0,-1,0),x=new e.Vector3(0,-1,0),_=h[l][s+1].clone(),S=h[l][s].clone(),M=new e.Vector2(S.u,1),this.faces.push(new e.Face3(d,m,g,[y,b,x])),this.faceVertexUvs[0].push([_,S,M]);this.computeCentroids(),this.computeFaceNormals()},e.CylinderGeometry.prototype=Object.create(e.Geometry.prototype),e.ExtrudeGeometry=function(t,i){"undefined"!=typeof t&&(e.Geometry.call(this),t=t instanceof Array?t:[t],this.shapebb=t[t.length-1].getBoundingBox(),this.addShapeList(t,i),this.computeCentroids(),this.computeFaceNormals())},e.ExtrudeGeometry.prototype=Object.create(e.Geometry.prototype),e.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var i=e.length,n=0;i>n;n++)this.addShape(e[n],t)},e.ExtrudeGeometry.prototype.addShape=function(t,i){function n(e,t,i){return t||console.log("die"),t.clone().multiplyScalar(i).add(e)}function r(t,i,n){var r=e.ExtrudeGeometry.__v1,o=e.ExtrudeGeometry.__v2,a=e.ExtrudeGeometry.__v3,s=e.ExtrudeGeometry.__v4,l=e.ExtrudeGeometry.__v5,u=e.ExtrudeGeometry.__v6;return r.set(t.x-i.x,t.y-i.y),o.set(t.x-n.x,t.y-n.y),r=r.normalize(),o=o.normalize(),a.set(-r.y,r.x),s.set(o.y,-o.x),l.copy(t).add(a),u.copy(t).add(s),l.equals(u)?s.clone():(l.copy(i).add(a),u.copy(n).add(s),a=r.dot(s),s=u.sub(l).dot(s),0===a&&(console.log("Either infinite or no solutions!"),console.log(0===s?"Its finite solutions.":"Too bad, no solutions.")),s/=a,0>s?(i=Math.atan2(i.y-t.y,i.x-t.x),t=Math.atan2(n.y-t.y,n.x-t.x),i>t&&(t+=2*Math.PI),n=(i+t)/2,t=-Math.cos(n),n=-Math.sin(n),new e.Vector2(t,n)):r.multiplyScalar(s).add(l).sub(t).clone())}function o(n,r){var o,a;for(I=n.length;0<=--I;){o=I,a=I-1,0>a&&(a=n.length-1);for(var s=0,l=b+2*g,s=0;l>s;s++){var u=G*s,c=G*(s+1),h=r+o+u,u=r+a+u,f=r+a+c,c=r+o+c,p=n,d=s,m=l,v=o,y=a,h=h+k,u=u+k,f=f+k,c=c+k;E.faces.push(new e.Face4(h,u,f,c,null,null,S)),h=M.generateSideWallUV(E,t,p,i,h,u,f,c,d,m,v,y),E.faceVertexUvs[0].push(h)}}}function a(t,i,n){E.vertices.push(new e.Vector3(t,i,n))}function s(n,r,o,a){n+=k,r+=k,o+=k,E.faces.push(new e.Face3(n,r,o,null,null,_)),n=a?M.generateBottomUV(E,t,i,n,r,o):M.generateTopUV(E,t,i,n,r,o),E.faceVertexUvs[0].push(n)}var l,u,c,h,f,p=void 0!==i.amount?i.amount:100,d=void 0!==i.bevelThickness?i.bevelThickness:6,m=void 0!==i.bevelSize?i.bevelSize:d-2,g=void 0!==i.bevelSegments?i.bevelSegments:3,v=void 0!==i.bevelEnabled?i.bevelEnabled:!0,y=void 0!==i.curveSegments?i.curveSegments:12,b=void 0!==i.steps?i.steps:1,x=i.extrudePath,w=!1,_=i.material,S=i.extrudeMaterial,M=void 0!==i.UVGenerator?i.UVGenerator:e.ExtrudeGeometry.WorldUVGenerator;x&&(l=x.getSpacedPoints(b),w=!0,v=!1,u=void 0!==i.frames?i.frames:new e.TubeGeometry.FrenetFrames(x,b,!1),c=new e.Vector3,h=new e.Vector3,f=new e.Vector3),v||(m=d=g=0);var C,A,T,E=this,k=this.vertices.length,y=t.extractPoints(y),P=y.shape,y=y.holes;if(x=!e.Shape.Utils.isClockWise(P)){for(P=P.reverse(),A=0,T=y.length;T>A;A++)C=y[A],e.Shape.Utils.isClockWise(C)&&(y[A]=C.reverse());x=!1}var R=e.Shape.Utils.triangulateShape(P,y),x=P;for(A=0,T=y.length;T>A;A++)C=y[A],P=P.concat(C);var L,D,N,F,G=P.length,O=R.length,j=[],I=0,V=x.length;for(L=V-1,D=I+1;V>I;I++,L++,D++)L===V&&(L=0),D===V&&(D=0),j[I]=r(x[I],x[L],x[D]);var U,B=[],z=j.concat();for(A=0,T=y.length;T>A;A++){for(C=y[A],U=[],I=0,V=C.length,L=V-1,D=I+1;V>I;I++,L++,D++)L===V&&(L=0),D===V&&(D=0),U[I]=r(C[I],C[L],C[D]);B.push(U),z=z.concat(U)}for(L=0;g>L;L++){for(C=L/g,N=d*(1-C),D=m*Math.sin(C*Math.PI/2),I=0,V=x.length;V>I;I++)F=n(x[I],j[I],D),a(F.x,F.y,-N);for(A=0,T=y.length;T>A;A++)for(C=y[A],U=B[A],I=0,V=C.length;V>I;I++)F=n(C[I],U[I],D),a(F.x,F.y,-N)}for(D=m,I=0;G>I;I++)F=v?n(P[I],z[I],D):P[I],w?(h.copy(u.normals[0]).multiplyScalar(F.x),c.copy(u.binormals[0]).multiplyScalar(F.y),f.copy(l[0]).add(h).add(c),a(f.x,f.y,f.z)):a(F.x,F.y,0);for(C=1;b>=C;C++)for(I=0;G>I;I++)F=v?n(P[I],z[I],D):P[I],w?(h.copy(u.normals[C]).multiplyScalar(F.x),c.copy(u.binormals[C]).multiplyScalar(F.y),f.copy(l[C]).add(h).add(c),a(f.x,f.y,f.z)):a(F.x,F.y,p/b*C);for(L=g-1;L>=0;L--){for(C=L/g,N=d*(1-C),D=m*Math.sin(C*Math.PI/2),I=0,V=x.length;V>I;I++)F=n(x[I],j[I],D),a(F.x,F.y,p+N);for(A=0,T=y.length;T>A;A++)for(C=y[A],U=B[A],I=0,V=C.length;V>I;I++)F=n(C[I],U[I],D),w?a(F.x,F.y+l[b-1].y,l[b-1].x+N):a(F.x,F.y,p+N)}if(v){for(d=0*G,I=0;O>I;I++)p=R[I],s(p[2]+d,p[1]+d,p[0]+d,!0);for(d=G*(b+2*g),I=0;O>I;I++)p=R[I],s(p[0]+d,p[1]+d,p[2]+d,!1)}else{for(I=0;O>I;I++)p=R[I],s(p[2],p[1],p[0],!0);for(I=0;O>I;I++)p=R[I],s(p[0]+G*b,p[1]+G*b,p[2]+G*b,!1)}for(p=0,o(x,p),p+=x.length,A=0,T=y.length;T>A;A++)C=y[A],o(C,p),p+=C.length},e.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(t,i,n,r,o,a){return i=t.vertices[o].x,o=t.vertices[o].y,n=t.vertices[a].x,a=t.vertices[a].y,[new e.Vector2(t.vertices[r].x,t.vertices[r].y),new e.Vector2(i,o),new e.Vector2(n,a)]},generateBottomUV:function(e,t,i,n,r,o){return this.generateTopUV(e,t,i,n,r,o)},generateSideWallUV:function(t,i,n,r,o,a,s,l){var i=t.vertices[o].x,n=t.vertices[o].y,o=t.vertices[o].z,r=t.vertices[a].x,u=t.vertices[a].y,a=t.vertices[a].z,c=t.vertices[s].x,h=t.vertices[s].y,s=t.vertices[s].z,f=t.vertices[l].x,p=t.vertices[l].y,t=t.vertices[l].z;return.01>Math.abs(n-u)?[new e.Vector2(i,1-o),new e.Vector2(r,1-a),new e.Vector2(c,1-s),new e.Vector2(f,1-t)]:[new e.Vector2(n,1-o),new e.Vector2(u,1-a),new e.Vector2(h,1-s),new e.Vector2(p,1-t)]}},e.ExtrudeGeometry.__v1=new e.Vector2,e.ExtrudeGeometry.__v2=new e.Vector2,e.ExtrudeGeometry.__v3=new e.Vector2,e.ExtrudeGeometry.__v4=new e.Vector2,e.ExtrudeGeometry.__v5=new e.Vector2,e.ExtrudeGeometry.__v6=new e.Vector2,e.ShapeGeometry=function(t,i){e.Geometry.call(this),!1==t instanceof Array&&(t=[t]),this.shapebb=t[t.length-1].getBoundingBox(),this.addShapeList(t,i),this.computeCentroids(),this.computeFaceNormals()},e.ShapeGeometry.prototype=Object.create(e.Geometry.prototype),e.ShapeGeometry.prototype.addShapeList=function(e,t){for(var i=0,n=e.length;n>i;i++)this.addShape(e[i],t);return this},e.ShapeGeometry.prototype.addShape=function(t,i){void 0===i&&(i={});var n,r,o,a=i.material,s=void 0===i.UVGenerator?e.ExtrudeGeometry.WorldUVGenerator:i.UVGenerator,l=this.vertices.length;n=t.extractPoints(void 0!==i.curveSegments?i.curveSegments:12);var u=n.shape,c=n.holes;if(!e.Shape.Utils.isClockWise(u))for(u=u.reverse(),n=0,r=c.length;r>n;n++)o=c[n],e.Shape.Utils.isClockWise(o)&&(c[n]=o.reverse());var h=e.Shape.Utils.triangulateShape(u,c);for(n=0,r=c.length;r>n;n++)o=c[n],u=u.concat(o);for(c=u.length,r=h.length,n=0;c>n;n++)o=u[n],this.vertices.push(new e.Vector3(o.x,o.y,0));for(n=0;r>n;n++)c=h[n],u=c[0]+l,o=c[1]+l,c=c[2]+l,this.faces.push(new e.Face3(u,o,c,null,null,a)),this.faceVertexUvs[0].push(s.generateBottomUV(this,t,i,u,o,c))
},e.LatheGeometry=function(t,i,n,r){e.Geometry.call(this);for(var i=i||12,n=n||0,r=r||2*Math.PI,o=1/(t.length-1),a=1/i,s=0,l=i;l>=s;s++)for(var u=n+s*a*r,c=Math.cos(u),h=Math.sin(u),u=0,f=t.length;f>u;u++){var p=t[u],d=new e.Vector3;d.x=c*p.x-h*p.y,d.y=h*p.x+c*p.y,d.z=p.z,this.vertices.push(d)}for(n=t.length,s=0,l=i;l>s;s++)for(u=0,f=t.length-1;f>u;u++)r=i=u+n*s,h=i+n,c=i+1+n,this.faces.push(new e.Face4(r,h,c,i+1)),c=s*a,i=u*o,r=c+a,h=i+o,this.faceVertexUvs[0].push([new e.Vector2(c,i),new e.Vector2(r,i),new e.Vector2(r,h),new e.Vector2(c,h)]);this.mergeVertices(),this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},e.LatheGeometry.prototype=Object.create(e.Geometry.prototype),e.PlaneGeometry=function(t,i,n,r){e.Geometry.call(this),this.width=t,this.height=i,this.widthSegments=n||1,this.heightSegments=r||1;for(var n=t/2,o=i/2,r=this.widthSegments,a=this.heightSegments,s=r+1,l=a+1,u=this.width/r,c=this.height/a,h=new e.Vector3(0,0,1),t=0;l>t;t++)for(i=0;s>i;i++)this.vertices.push(new e.Vector3(i*u-n,-(t*c-o),0));for(t=0;a>t;t++)for(i=0;r>i;i++)n=new e.Face4(i+s*t,i+s*(t+1),i+1+s*(t+1),i+1+s*t),n.normal.copy(h),n.vertexNormals.push(h.clone(),h.clone(),h.clone(),h.clone()),this.faces.push(n),this.faceVertexUvs[0].push([new e.Vector2(i/r,1-t/a),new e.Vector2(i/r,1-(t+1)/a),new e.Vector2((i+1)/r,1-(t+1)/a),new e.Vector2((i+1)/r,1-t/a)]);this.computeCentroids()},e.PlaneGeometry.prototype=Object.create(e.Geometry.prototype),e.RingGeometry=function(t,i,n,r,o,a){e.Geometry.call(this);for(var t=t||0,i=i||50,o=void 0!==o?o:0,a=void 0!==a?a:2*Math.PI,n=void 0!==n?Math.max(3,n):8,r=void 0!==r?Math.max(3,r):8,s=[],l=t,u=(i-t)/r,t=0;r>=t;t++){for(i=0;n>=i;i++){var c=new e.Vector3,h=o+i/n*a;c.x=l*Math.cos(h),c.y=l*Math.sin(h),this.vertices.push(c),s.push(new e.Vector2((c.x/l+1)/2,-(c.y/l+1)/2+1))}l+=u}for(o=new e.Vector3(0,0,1),t=0;r>t;t++)for(a=t*n,i=0;n>=i;i++){var h=i+a,u=h+t,c=h+n+t,f=h+n+1+t;this.faces.push(new e.Face3(u,c,f,[o,o,o])),this.faceVertexUvs[0].push([s[u],s[c],s[f]]),u=h+t,c=h+n+1+t,f=h+1+t,this.faces.push(new e.Face3(u,c,f,[o,o,o])),this.faceVertexUvs[0].push([s[u],s[c],s[f]])}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new e.Sphere(new e.Vector3,l)},e.RingGeometry.prototype=Object.create(e.Geometry.prototype),e.SphereGeometry=function(t,i,n,r,o,a,s){e.Geometry.call(this),this.radius=t=t||50,this.widthSegments=i=Math.max(3,Math.floor(i)||8),this.heightSegments=n=Math.max(2,Math.floor(n)||6),this.phiStart=r=void 0!==r?r:0,this.phiLength=o=void 0!==o?o:2*Math.PI,this.thetaStart=a=void 0!==a?a:0,this.thetaLength=s=void 0!==s?s:Math.PI;var l,u,c=[],h=[];for(u=0;n>=u;u++){var f=[],p=[];for(l=0;i>=l;l++){var d=l/i,m=u/n,g=new e.Vector3;g.x=-t*Math.cos(r+d*o)*Math.sin(a+m*s),g.y=t*Math.cos(a+m*s),g.z=t*Math.sin(r+d*o)*Math.sin(a+m*s),this.vertices.push(g),f.push(this.vertices.length-1),p.push(new e.Vector2(d,1-m))}c.push(f),h.push(p)}for(u=0;u<this.heightSegments;u++)for(l=0;l<this.widthSegments;l++){var i=c[u][l+1],n=c[u][l],r=c[u+1][l],o=c[u+1][l+1],a=this.vertices[i].clone().normalize(),s=this.vertices[n].clone().normalize(),f=this.vertices[r].clone().normalize(),p=this.vertices[o].clone().normalize(),d=h[u][l+1].clone(),m=h[u][l].clone(),g=h[u+1][l].clone(),v=h[u+1][l+1].clone();Math.abs(this.vertices[i].y)===this.radius?(this.faces.push(new e.Face3(i,r,o,[a,f,p])),this.faceVertexUvs[0].push([d,g,v])):Math.abs(this.vertices[r].y)===this.radius?(this.faces.push(new e.Face3(i,n,r,[a,s,f])),this.faceVertexUvs[0].push([d,m,g])):(this.faces.push(new e.Face4(i,n,r,o,[a,s,f,p])),this.faceVertexUvs[0].push([d,m,g,v]))}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new e.Sphere(new e.Vector3,t)},e.SphereGeometry.prototype=Object.create(e.Geometry.prototype),e.TextGeometry=function(t,i){var i=i||{},n=e.FontUtils.generateShapes(t,i);i.amount=void 0!==i.height?i.height:50,void 0===i.bevelThickness&&(i.bevelThickness=10),void 0===i.bevelSize&&(i.bevelSize=8),void 0===i.bevelEnabled&&(i.bevelEnabled=!1),e.ExtrudeGeometry.call(this,n,i)},e.TextGeometry.prototype=Object.create(e.ExtrudeGeometry.prototype),e.TorusGeometry=function(t,i,n,r,o){for(e.Geometry.call(this),this.radius=t||100,this.tube=i||40,this.radialSegments=n||8,this.tubularSegments=r||6,this.arc=o||2*Math.PI,o=new e.Vector3,t=[],i=[],n=0;n<=this.radialSegments;n++)for(r=0;r<=this.tubularSegments;r++){var a=r/this.tubularSegments*this.arc,s=2*n/this.radialSegments*Math.PI;o.x=this.radius*Math.cos(a),o.y=this.radius*Math.sin(a);var l=new e.Vector3;l.x=(this.radius+this.tube*Math.cos(s))*Math.cos(a),l.y=(this.radius+this.tube*Math.cos(s))*Math.sin(a),l.z=this.tube*Math.sin(s),this.vertices.push(l),t.push(new e.Vector2(r/this.tubularSegments,n/this.radialSegments)),i.push(l.clone().sub(o).normalize())}for(n=1;n<=this.radialSegments;n++)for(r=1;r<=this.tubularSegments;r++){var o=(this.tubularSegments+1)*n+r-1,a=(this.tubularSegments+1)*(n-1)+r-1,s=(this.tubularSegments+1)*(n-1)+r,l=(this.tubularSegments+1)*n+r,u=new e.Face4(o,a,s,l,[i[o],i[a],i[s],i[l]]);u.normal.add(i[o]),u.normal.add(i[a]),u.normal.add(i[s]),u.normal.add(i[l]),u.normal.normalize(),this.faces.push(u),this.faceVertexUvs[0].push([t[o].clone(),t[a].clone(),t[s].clone(),t[l].clone()])}this.computeCentroids()},e.TorusGeometry.prototype=Object.create(e.Geometry.prototype),e.TorusKnotGeometry=function(t,i,n,r,o,a,s){function l(t,i,n,r,o,a){var s=Math.cos(t);return Math.cos(i),i=Math.sin(t),t*=n/r,n=Math.cos(t),s*=.5*o*(2+n),i=.5*o*(2+n)*i,o=.5*a*o*Math.sin(t),new e.Vector3(s,i,o)}for(e.Geometry.call(this),this.radius=t||100,this.tube=i||40,this.radialSegments=n||64,this.tubularSegments=r||8,this.p=o||2,this.q=a||3,this.heightScale=s||1,this.grid=Array(this.radialSegments),n=new e.Vector3,r=new e.Vector3,o=new e.Vector3,t=0;t<this.radialSegments;++t)for(this.grid[t]=Array(this.tubularSegments),i=0;i<this.tubularSegments;++i){var u=2*(t/this.radialSegments)*this.p*Math.PI,s=2*(i/this.tubularSegments)*Math.PI,a=l(u,s,this.q,this.p,this.radius,this.heightScale),u=l(u+.01,s,this.q,this.p,this.radius,this.heightScale);n.subVectors(u,a),r.addVectors(u,a),o.crossVectors(n,r),r.crossVectors(o,n),o.normalize(),r.normalize(),u=-this.tube*Math.cos(s),s=this.tube*Math.sin(s),a.x+=u*r.x+s*o.x,a.y+=u*r.y+s*o.y,a.z+=u*r.z+s*o.z,this.grid[t][i]=this.vertices.push(new e.Vector3(a.x,a.y,a.z))-1}for(t=0;t<this.radialSegments;++t)for(i=0;i<this.tubularSegments;++i){var o=(t+1)%this.radialSegments,a=(i+1)%this.tubularSegments,n=this.grid[t][i],r=this.grid[o][i],o=this.grid[o][a],a=this.grid[t][a],s=new e.Vector2(t/this.radialSegments,i/this.tubularSegments),u=new e.Vector2((t+1)/this.radialSegments,i/this.tubularSegments),c=new e.Vector2((t+1)/this.radialSegments,(i+1)/this.tubularSegments),h=new e.Vector2(t/this.radialSegments,(i+1)/this.tubularSegments);this.faces.push(new e.Face4(n,r,o,a)),this.faceVertexUvs[0].push([s,u,c,h])}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},e.TorusKnotGeometry.prototype=Object.create(e.Geometry.prototype),e.TubeGeometry=function(t,i,n,r,o,a){e.Geometry.call(this),this.path=t,this.segments=i||64,this.radius=n||1,this.radiusSegments=r||8,this.closed=o||!1,a&&(this.debug=new e.Object3D),this.grid=[];var s,l,u,c,h,f,p,d,o=this.segments+1,a=new e.Vector3,i=new e.TubeGeometry.FrenetFrames(this.path,this.segments,this.closed);for(f=i.tangents,p=i.normals,d=i.binormals,this.tangents=f,this.normals=p,this.binormals=d,i=0;o>i;i++)for(this.grid[i]=[],r=i/(o-1),h=t.getPointAt(r),r=f[i],s=p[i],l=d[i],this.debug&&(this.debug.add(new e.ArrowHelper(r,h,n,255)),this.debug.add(new e.ArrowHelper(s,h,n,16711680)),this.debug.add(new e.ArrowHelper(l,h,n,65280))),r=0;r<this.radiusSegments;r++)u=2*(r/this.radiusSegments)*Math.PI,c=-this.radius*Math.cos(u),u=this.radius*Math.sin(u),a.copy(h),a.x+=c*s.x+u*l.x,a.y+=c*s.y+u*l.y,a.z+=c*s.z+u*l.z,this.grid[i][r]=this.vertices.push(new e.Vector3(a.x,a.y,a.z))-1;for(i=0;i<this.segments;i++)for(r=0;r<this.radiusSegments;r++)o=this.closed?(i+1)%this.segments:i+1,a=(r+1)%this.radiusSegments,t=this.grid[i][r],n=this.grid[o][r],o=this.grid[o][a],a=this.grid[i][a],f=new e.Vector2(i/this.segments,r/this.radiusSegments),p=new e.Vector2((i+1)/this.segments,r/this.radiusSegments),d=new e.Vector2((i+1)/this.segments,(r+1)/this.radiusSegments),s=new e.Vector2(i/this.segments,(r+1)/this.radiusSegments),this.faces.push(new e.Face4(t,n,o,a)),this.faceVertexUvs[0].push([f,p,d,s]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},e.TubeGeometry.prototype=Object.create(e.Geometry.prototype),e.TubeGeometry.FrenetFrames=function(t,i,n){new e.Vector3;var r=new e.Vector3;new e.Vector3;var o,a,s,l=[],u=[],c=[],h=new e.Vector3,f=new e.Matrix4,i=i+1;for(this.tangents=l,this.normals=u,this.binormals=c,o=0;i>o;o++)a=o/(i-1),l[o]=t.getTangentAt(a),l[o].normalize();for(u[0]=new e.Vector3,c[0]=new e.Vector3,t=Number.MAX_VALUE,o=Math.abs(l[0].x),a=Math.abs(l[0].y),s=Math.abs(l[0].z),t>=o&&(t=o,r.set(1,0,0)),t>=a&&(t=a,r.set(0,1,0)),t>=s&&r.set(0,0,1),h.crossVectors(l[0],r).normalize(),u[0].crossVectors(l[0],h),c[0].crossVectors(l[0],u[0]),o=1;i>o;o++)u[o]=u[o-1].clone(),c[o]=c[o-1].clone(),h.crossVectors(l[o-1],l[o]),1e-4<h.length()&&(h.normalize(),r=Math.acos(l[o-1].dot(l[o])),u[o].applyMatrix4(f.makeRotationAxis(h,r))),c[o].crossVectors(l[o],u[o]);if(n)for(r=Math.acos(u[0].dot(u[i-1])),r/=i-1,0<l[0].dot(h.crossVectors(u[0],u[i-1]))&&(r=-r),o=1;i>o;o++)u[o].applyMatrix4(f.makeRotationAxis(l[o],r*o)),c[o].crossVectors(l[o],u[o])},e.PolyhedronGeometry=function(t,i,n,r){function o(t){var i=t.normalize().clone();i.index=l.vertices.push(i)-1;var n=Math.atan2(t.z,-t.x)/2/Math.PI+.5,t=Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5;return i.uv=new e.Vector2(n,1-t),i}function a(t,i,n){var r=new e.Face3(t.index,i.index,n.index,[t.clone(),i.clone(),n.clone()]);r.centroid.add(t).add(i).add(n).divideScalar(3),r.normal.copy(r.centroid).normalize(),l.faces.push(r),r=Math.atan2(r.centroid.z,-r.centroid.x),l.faceVertexUvs[0].push([s(t.uv,t,r),s(i.uv,i,r),s(n.uv,n,r)])}function s(t,i,n){return 0>n&&1===t.x&&(t=new e.Vector2(t.x-1,t.y)),0===i.x&&0===i.z&&(t=new e.Vector2(n/2/Math.PI+.5,t.y)),t.clone()}e.Geometry.call(this);for(var n=n||1,r=r||0,l=this,u=0,c=t.length;c>u;u++)o(new e.Vector3(t[u][0],t[u][1],t[u][2]));for(var h=this.vertices,t=[],u=0,c=i.length;c>u;u++){var f=h[i[u][0]],p=h[i[u][1]],d=h[i[u][2]];t[u]=new e.Face3(f.index,p.index,d.index,[f.clone(),p.clone(),d.clone()])}for(u=0,c=t.length;c>u;u++){p=t[u],h=r,i=Math.pow(2,h),Math.pow(4,h);for(var h=o(l.vertices[p.a]),f=o(l.vertices[p.b]),m=o(l.vertices[p.c]),p=[],d=0;i>=d;d++){p[d]=[];for(var g=o(h.clone().lerp(m,d/i)),v=o(f.clone().lerp(m,d/i)),y=i-d,b=0;y>=b;b++)p[d][b]=0==b&&d==i?g:o(g.clone().lerp(v,b/y))}for(d=0;i>d;d++)for(b=0;2*(i-d)-1>b;b++)h=Math.floor(b/2),0==b%2?a(p[d][h+1],p[d+1][h],p[d][h]):a(p[d][h+1],p[d+1][h+1],p[d+1][h])}for(u=0,c=this.faceVertexUvs[0].length;c>u;u++)r=this.faceVertexUvs[0][u],t=r[0].x,i=r[1].x,h=r[2].x,f=Math.max(t,Math.max(i,h)),p=Math.min(t,Math.min(i,h)),f>.9&&.1>p&&(.2>t&&(r[0].x+=1),.2>i&&(r[1].x+=1),.2>h&&(r[2].x+=1));for(this.mergeVertices(),u=0,c=this.vertices.length;c>u;u++)this.vertices[u].multiplyScalar(n);this.computeCentroids(),this.boundingSphere=new e.Sphere(new e.Vector3,n)},e.PolyhedronGeometry.prototype=Object.create(e.Geometry.prototype),e.IcosahedronGeometry=function(t,i){this.radius=t,this.detail=i;var n=(1+Math.sqrt(5))/2;e.PolyhedronGeometry.call(this,[[-1,n,0],[1,n,0],[-1,-n,0],[1,-n,0],[0,-1,n],[0,1,n],[0,-1,-n],[0,1,-n],[n,0,-1],[n,0,1],[-n,0,-1],[-n,0,1]],[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]],t,i)},e.IcosahedronGeometry.prototype=Object.create(e.Geometry.prototype),e.OctahedronGeometry=function(t,i){e.PolyhedronGeometry.call(this,[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]],t,i)},e.OctahedronGeometry.prototype=Object.create(e.Geometry.prototype),e.TetrahedronGeometry=function(t,i){e.PolyhedronGeometry.call(this,[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]],[[2,1,0],[0,3,2],[1,3,0],[2,3,1]],t,i)},e.TetrahedronGeometry.prototype=Object.create(e.Geometry.prototype),e.ParametricGeometry=function(t,i,n,r){e.Geometry.call(this);var o,a,s,l,u=this.vertices,c=this.faces,h=this.faceVertexUvs[0],r=void 0===r?!1:r,f=i+1;for(o=0;n>=o;o++)for(l=o/n,a=0;i>=a;a++)s=a/i,s=t(s,l),u.push(s);var p,d,m,g;for(o=0;n>o;o++)for(a=0;i>a;a++)t=o*f+a,u=o*f+a+1,l=(o+1)*f+a,s=(o+1)*f+a+1,p=new e.Vector2(a/i,o/n),d=new e.Vector2((a+1)/i,o/n),m=new e.Vector2(a/i,(o+1)/n),g=new e.Vector2((a+1)/i,(o+1)/n),r?(c.push(new e.Face3(t,u,l)),c.push(new e.Face3(u,s,l)),h.push([p,d,m]),h.push([d,g,m])):(c.push(new e.Face4(t,u,s,l)),h.push([p,d,g,m]));this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},e.ParametricGeometry.prototype=Object.create(e.Geometry.prototype),e.ConvexGeometry=function(t){function i(t){var i=t.length();return new e.Vector2(t.x/i,t.y/i)}e.Geometry.call(this);for(var n=[[0,1,2],[0,2,1]],r=3;r<t.length;r++){var o=r,a=t[o].clone(),s=a.length();a.x+=2e-6*s*(Math.random()-.5),a.y+=2e-6*s*(Math.random()-.5),a.z+=2e-6*s*(Math.random()-.5);for(var s=[],l=0;l<n.length;){var u,c=n[l],h=a,f=t[c[0]];u=f;var p=t[c[1]],d=t[c[2]],m=new e.Vector3,g=new e.Vector3;if(m.subVectors(d,p),g.subVectors(u,p),m.cross(g),m.normalize(),u=m,f=u.dot(f),u.dot(h)>=f){for(h=0;3>h;h++){for(f=[c[h],c[(h+1)%3]],u=!0,p=0;p<s.length;p++)if(s[p][0]===f[1]&&s[p][1]===f[0]){s[p]=s[s.length-1],s.pop(),u=!1;break}u&&s.push(f)}n[l]=n[n.length-1],n.pop()}else l++}for(p=0;p<s.length;p++)n.push([s[p][0],s[p][1],o])}for(o=0,a=Array(t.length),r=0;r<n.length;r++)for(s=n[r],l=0;3>l;l++)void 0===a[s[l]]&&(a[s[l]]=o++,this.vertices.push(t[s[l]])),s[l]=a[s[l]];for(r=0;r<n.length;r++)this.faces.push(new e.Face3(n[r][0],n[r][1],n[r][2]));for(r=0;r<this.faces.length;r++)s=this.faces[r],this.faceVertexUvs[0].push([i(this.vertices[s.a]),i(this.vertices[s.b]),i(this.vertices[s.c])]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},e.ConvexGeometry.prototype=Object.create(e.Geometry.prototype),e.AxisHelper=function(t){var t=t||1,i=new e.Geometry;i.vertices.push(new e.Vector3,new e.Vector3(t,0,0),new e.Vector3,new e.Vector3(0,t,0),new e.Vector3,new e.Vector3(0,0,t)),i.colors.push(new e.Color(16711680),new e.Color(16755200),new e.Color(65280),new e.Color(11206400),new e.Color(255),new e.Color(43775)),t=new e.LineBasicMaterial({vertexColors:e.VertexColors}),e.Line.call(this,i,t,e.LinePieces)},e.AxisHelper.prototype=Object.create(e.Line.prototype),e.ArrowHelper=function(t,i,n,r){e.Object3D.call(this),void 0===r&&(r=16776960),void 0===n&&(n=1),this.position=i,this.useQuaternion=!0,i=new e.Geometry,i.vertices.push(new e.Vector3(0,0,0)),i.vertices.push(new e.Vector3(0,1,0)),this.line=new e.Line(i,new e.LineBasicMaterial({color:r})),this.line.matrixAutoUpdate=!1,this.add(this.line),i=new e.CylinderGeometry(0,.05,.25,5,1),i.applyMatrix((new e.Matrix4).makeTranslation(0,.875,0)),this.cone=new e.Mesh(i,new e.MeshBasicMaterial({color:r})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(n)},e.ArrowHelper.prototype=Object.create(e.Object3D.prototype),e.ArrowHelper.prototype.setDirection=function(){var t,i=new e.Vector3;return function(e){.999<e.y?this.quaternion.set(0,0,0,1):-.999>e.y?this.quaternion.set(1,0,0,0):(i.set(e.z,0,-e.x).normalize(),t=Math.acos(e.y),this.quaternion.setFromAxisAngle(i,t))}}(),e.ArrowHelper.prototype.setLength=function(e){this.scale.set(e,e,e)},e.ArrowHelper.prototype.setColor=function(e){this.line.material.color.setHex(e),this.cone.material.color.setHex(e)},e.BoxHelper=function(t){var t=t||1,i=new e.Geometry,t=[new e.Vector3(t,t,t),new e.Vector3(-t,t,t),new e.Vector3(-t,-t,t),new e.Vector3(t,-t,t),new e.Vector3(t,t,-t),new e.Vector3(-t,t,-t),new e.Vector3(-t,-t,-t),new e.Vector3(t,-t,-t)];i.vertices.push(t[0],t[1],t[1],t[2],t[2],t[3],t[3],t[0],t[4],t[5],t[5],t[6],t[6],t[7],t[7],t[4],t[0],t[4],t[1],t[5],t[2],t[6],t[3],t[7]),this.vertices=t,e.Line.call(this,i,new e.LineBasicMaterial,e.LinePieces)},e.BoxHelper.prototype=Object.create(e.Line.prototype),e.BoxHelper.prototype.update=function(e){var t=e.geometry;null===t.boundingBox&&t.computeBoundingBox();var i=t.boundingBox.min,t=t.boundingBox.max,n=this.vertices;n[0].set(t.x,t.y,t.z),n[1].set(i.x,t.y,t.z),n[2].set(i.x,i.y,t.z),n[3].set(t.x,i.y,t.z),n[4].set(t.x,t.y,i.z),n[5].set(i.x,t.y,i.z),n[6].set(i.x,i.y,i.z),n[7].set(t.x,i.y,i.z),this.geometry.computeBoundingSphere(),this.geometry.verticesNeedUpdate=!0,this.matrixAutoUpdate=!1,this.matrixWorld=e.matrixWorld},e.CameraHelper=function(t){function i(e,t,i){n(e,i),n(t,i)}function n(t,i){r.vertices.push(new e.Vector3),r.colors.push(new e.Color(i)),void 0===a[t]&&(a[t]=[]),a[t].push(r.vertices.length-1)}e.Line.call(this);var r=new e.Geometry,o=new e.LineBasicMaterial({color:16777215,vertexColors:e.FaceColors}),a={};i("n1","n2",16755200),i("n2","n4",16755200),i("n4","n3",16755200),i("n3","n1",16755200),i("f1","f2",16755200),i("f2","f4",16755200),i("f4","f3",16755200),i("f3","f1",16755200),i("n1","f1",16755200),i("n2","f2",16755200),i("n3","f3",16755200),i("n4","f4",16755200),i("p","n1",16711680),i("p","n2",16711680),i("p","n3",16711680),i("p","n4",16711680),i("u1","u2",43775),i("u2","u3",43775),i("u3","u1",43775),i("c","t",16777215),i("p","c",3355443),i("cn1","cn2",3355443),i("cn3","cn4",3355443),i("cf1","cf2",3355443),i("cf3","cf4",3355443),e.Line.call(this,r,o,e.LinePieces),this.camera=t,this.matrixWorld=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()},e.CameraHelper.prototype=Object.create(e.Line.prototype),e.CameraHelper.prototype.update=function(){var t=new e.Vector3,i=new e.Camera,n=new e.Projector;return function(){function e(e,o,a,s){if(t.set(o,a,s),n.unprojectVector(t,i),e=r.pointMap[e],void 0!==e)for(o=0,a=e.length;a>o;o++)r.geometry.vertices[e[o]].copy(t)}var r=this;i.projectionMatrix.copy(this.camera.projectionMatrix),e("c",0,0,-1),e("t",0,0,1),e("n1",-1,-1,-1),e("n2",1,-1,-1),e("n3",-1,1,-1),e("n4",1,1,-1),e("f1",-1,-1,1),e("f2",1,-1,1),e("f3",-1,1,1),e("f4",1,1,1),e("u1",.7,1.1,-1),e("u2",-.7,1.1,-1),e("u3",0,2,-1),e("cf1",-1,0,1),e("cf2",1,0,1),e("cf3",0,-1,1),e("cf4",0,1,1),e("cn1",-1,0,-1),e("cn2",1,0,-1),e("cn3",0,-1,-1),e("cn4",0,1,-1),this.geometry.verticesNeedUpdate=!0}}(),e.DirectionalLightHelper=function(t,i){e.Object3D.call(this),this.matrixAutoUpdate=!1,this.light=t;var n=new e.SphereGeometry(i,4,2),r=new e.MeshBasicMaterial({fog:!1,wireframe:!0});r.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightSphere=new e.Mesh(n,r),this.lightSphere.matrixWorld=this.light.matrixWorld,this.lightSphere.matrixAutoUpdate=!1,this.add(this.lightSphere),n=new e.Geometry,n.vertices.push(this.light.position),n.vertices.push(this.light.target.position),n.computeLineDistances(),r=new e.LineDashedMaterial({dashSize:4,gapSize:4,opacity:.75,transparent:!0,fog:!1}),r.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new e.Line(n,r),this.add(this.targetLine)},e.DirectionalLightHelper.prototype=Object.create(e.Object3D.prototype),e.DirectionalLightHelper.prototype.update=function(){this.lightSphere.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.computeLineDistances(),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},e.GridHelper=function(t,i){for(var n=new e.Geometry,r=new e.LineBasicMaterial({vertexColors:e.VertexColors}),o=new e.Color(4473924),a=new e.Color(8947848),s=-t;t>=s;s+=i){n.vertices.push(new e.Vector3(-t,0,s)),n.vertices.push(new e.Vector3(t,0,s)),n.vertices.push(new e.Vector3(s,0,-t)),n.vertices.push(new e.Vector3(s,0,t));var l=0===s?o:a;n.colors.push(l,l,l,l)}e.Line.call(this,n,r,e.LinePieces)},e.GridHelper.prototype=Object.create(e.Line.prototype),e.HemisphereLightHelper=function(t,i){e.Object3D.call(this),this.light=t;var n=new e.SphereGeometry(i,4,2);n.applyMatrix((new e.Matrix4).makeRotationX(-Math.PI/2));for(var r=0;8>r;r++)n.faces[r].materialIndex=4>r?0:1;r=new e.MeshBasicMaterial({fog:!1,wireframe:!0}),r.color.copy(t.color).multiplyScalar(t.intensity);var o=new e.MeshBasicMaterial({fog:!1,wireframe:!0});o.color.copy(t.groundColor).multiplyScalar(t.intensity),this.lightSphere=new e.Mesh(n,new e.MeshFaceMaterial([r,o])),this.lightSphere.position=t.position,this.lightSphere.lookAt(new e.Vector3),this.add(this.lightSphere)},e.HemisphereLightHelper.prototype=Object.create(e.Object3D.prototype),e.HemisphereLightHelper.prototype.update=function(){this.lightSphere.lookAt(new e.Vector3),this.lightSphere.material.materials[0].color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightSphere.material.materials[1].color.copy(this.light.groundColor).multiplyScalar(this.light.intensity)},e.PointLightHelper=function(t,i){e.Object3D.call(this),this.matrixAutoUpdate=!1,this.light=t;var n=new e.SphereGeometry(i,4,2),r=new e.MeshBasicMaterial({fog:!1,wireframe:!0});r.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightSphere=new e.Mesh(n,r),this.lightSphere.matrixWorld=this.light.matrixWorld,this.lightSphere.matrixAutoUpdate=!1,this.add(this.lightSphere)},e.PointLightHelper.prototype=Object.create(e.Object3D.prototype),e.PointLightHelper.prototype.update=function(){this.lightSphere.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},e.SpotLightHelper=function(t,i){e.Object3D.call(this),this.matrixAutoUpdate=!1,this.light=t;var n=new e.SphereGeometry(i,4,2),r=new e.MeshBasicMaterial({fog:!1,wireframe:!0});r.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightSphere=new e.Mesh(n,r),this.lightSphere.matrixWorld=this.light.matrixWorld,this.lightSphere.matrixAutoUpdate=!1,this.add(this.lightSphere),n=new e.CylinderGeometry(1e-4,1,1,8,1,!0),n.applyMatrix((new e.Matrix4).makeTranslation(0,-.5,0)),n.applyMatrix((new e.Matrix4).makeRotationX(-Math.PI/2)),r=new e.MeshBasicMaterial({fog:!1,wireframe:!0,opacity:.3,transparent:!0}),r.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightCone=new e.Mesh(n,r),this.lightCone.position=this.light.position,n=t.distance?t.distance:1e4,r=n*Math.tan(t.angle),this.lightCone.scale.set(r,r,n),this.lightCone.lookAt(this.light.target.position),this.add(this.lightCone)},e.SpotLightHelper.prototype=Object.create(e.Object3D.prototype),e.SpotLightHelper.prototype.update=function(){var e=this.light.distance?this.light.distance:1e4,t=e*Math.tan(this.light.angle);this.lightCone.scale.set(t,t,e),this.lightCone.lookAt(this.light.target.position),this.lightSphere.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightCone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},e.ImmediateRenderObject=function(){e.Object3D.call(this),this.render=function(){}},e.ImmediateRenderObject.prototype=Object.create(e.Object3D.prototype),e.LensFlare=function(t,i,n,r,o){e.Object3D.call(this),this.lensFlares=[],this.positionScreen=new e.Vector3,this.customUpdateCallback=void 0,void 0!==t&&this.add(t,i,n,r,o)},e.LensFlare.prototype=Object.create(e.Object3D.prototype),e.LensFlare.prototype.add=function(t,i,n,r,o,a){void 0===i&&(i=-1),void 0===n&&(n=0),void 0===a&&(a=1),void 0===o&&(o=new e.Color(16777215)),void 0===r&&(r=e.NormalBlending),n=Math.min(n,Math.max(0,n)),this.lensFlares.push({texture:t,size:i,distance:n,x:0,y:0,z:0,scale:1,rotation:1,opacity:a,color:o,blending:r})},e.LensFlare.prototype.updateLensFlares=function(){var e,t,i=this.lensFlares.length,n=2*-this.positionScreen.x,r=2*-this.positionScreen.y;for(e=0;i>e;e++)t=this.lensFlares[e],t.x=this.positionScreen.x+n*t.distance,t.y=this.positionScreen.y+r*t.distance,t.wantedRotation=.25*t.x*Math.PI,t.rotation+=.25*(t.wantedRotation-t.rotation)},e.MorphBlendMesh=function(t,i){e.Mesh.call(this,t,i),this.animationsMap={},this.animationsList=[];var n=this.geometry.morphTargets.length;this.createAnimation("__default",0,n-1,n/1),this.setAnimationWeight("__default",1)},e.MorphBlendMesh.prototype=Object.create(e.Mesh.prototype),e.MorphBlendMesh.prototype.createAnimation=function(e,t,i,n){t={startFrame:t,endFrame:i,length:i-t+1,fps:n,duration:(i-t)/n,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1},this.animationsMap[e]=t,this.animationsList.push(t)},e.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t,i=/([a-z]+)(\d+)/,n={},r=this.geometry,o=0,a=r.morphTargets.length;a>o;o++){var s=r.morphTargets[o].name.match(i);if(s&&1<s.length){var l=s[1];n[l]||(n[l]={start:1/0,end:-1/0}),s=n[l],o<s.start&&(s.start=o),o>s.end&&(s.end=o),t||(t=l)}}for(l in n)s=n[l],this.createAnimation(l,s.start,s.end,e);this.firstAnimation=t},e.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){(e=this.animationsMap[e])&&(e.direction=1,e.directionBackwards=!1)},e.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){(e=this.animationsMap[e])&&(e.direction=-1,e.directionBackwards=!0)},e.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var i=this.animationsMap[e];i&&(i.fps=t,i.duration=(i.end-i.start)/i.fps)},e.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var i=this.animationsMap[e];i&&(i.duration=t,i.fps=(i.end-i.start)/i.duration)},e.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var i=this.animationsMap[e];i&&(i.weight=t)},e.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var i=this.animationsMap[e];i&&(i.time=t)},e.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0;return(e=this.animationsMap[e])&&(t=e.time),t},e.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1;return(e=this.animationsMap[e])&&(t=e.duration),t},e.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("animation["+e+"] undefined")},e.MorphBlendMesh.prototype.stopAnimation=function(e){(e=this.animationsMap[e])&&(e.active=!1)},e.MorphBlendMesh.prototype.update=function(t){for(var i=0,n=this.animationsList.length;n>i;i++){var r=this.animationsList[i];if(r.active){var o=r.duration/r.length;r.time+=r.direction*t,r.mirroredLoop?(r.time>r.duration||0>r.time)&&(r.direction*=-1,r.time>r.duration&&(r.time=r.duration,r.directionBackwards=!0),0>r.time&&(r.time=0,r.directionBackwards=!1)):(r.time%=r.duration,0>r.time&&(r.time+=r.duration));var a=r.startFrame+e.Math.clamp(Math.floor(r.time/o),0,r.length-1),s=r.weight;a!==r.currentFrame&&(this.morphTargetInfluences[r.lastFrame]=0,this.morphTargetInfluences[r.currentFrame]=1*s,this.morphTargetInfluences[a]=0,r.lastFrame=r.currentFrame,r.currentFrame=a),o=r.time%o/o,r.directionBackwards&&(o=1-o),this.morphTargetInfluences[r.currentFrame]=o*s,this.morphTargetInfluences[r.lastFrame]=(1-o)*s}}},e.LensFlarePlugin=function(){function t(e,t){var n=i.createProgram(),r=i.createShader(i.FRAGMENT_SHADER),o=i.createShader(i.VERTEX_SHADER),a="precision "+t+" float;\n";return i.shaderSource(r,a+e.fragmentShader),i.shaderSource(o,a+e.vertexShader),i.compileShader(r),i.compileShader(o),i.attachShader(n,r),i.attachShader(n,o),i.linkProgram(n),n}var i,n,r,o,a,s,l,u,c,h,f,p,d;this.init=function(m){i=m.context,n=m,r=m.getPrecision(),o=new Float32Array(16),a=new Uint16Array(6),m=0,o[m++]=-1,o[m++]=-1,o[m++]=0,o[m++]=0,o[m++]=1,o[m++]=-1,o[m++]=1,o[m++]=0,o[m++]=1,o[m++]=1,o[m++]=1,o[m++]=1,o[m++]=-1,o[m++]=1,o[m++]=0,o[m++]=1,m=0,a[m++]=0,a[m++]=1,a[m++]=2,a[m++]=0,a[m++]=2,a[m++]=3,s=i.createBuffer(),l=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,s),i.bufferData(i.ARRAY_BUFFER,o,i.STATIC_DRAW),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,l),i.bufferData(i.ELEMENT_ARRAY_BUFFER,a,i.STATIC_DRAW),u=i.createTexture(),c=i.createTexture(),i.bindTexture(i.TEXTURE_2D,u),i.texImage2D(i.TEXTURE_2D,0,i.RGB,16,16,0,i.RGB,i.UNSIGNED_BYTE,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.bindTexture(i.TEXTURE_2D,c),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,16,16,0,i.RGBA,i.UNSIGNED_BYTE,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),0>=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS)?(h=!1,f=t(e.ShaderFlares.lensFlare,r)):(h=!0,f=t(e.ShaderFlares.lensFlareVertexTexture,r)),p={},d={},p.vertex=i.getAttribLocation(f,"position"),p.uv=i.getAttribLocation(f,"uv"),d.renderType=i.getUniformLocation(f,"renderType"),d.map=i.getUniformLocation(f,"map"),d.occlusionMap=i.getUniformLocation(f,"occlusionMap"),d.opacity=i.getUniformLocation(f,"opacity"),d.color=i.getUniformLocation(f,"color"),d.scale=i.getUniformLocation(f,"scale"),d.rotation=i.getUniformLocation(f,"rotation"),d.screenPosition=i.getUniformLocation(f,"screenPosition")},this.render=function(t,r,o,a){var t=t.__webglFlares,m=t.length;if(m){var g=new e.Vector3,v=a/o,y=.5*o,b=.5*a,x=16/a,w=new e.Vector2(x*v,x),_=new e.Vector3(1,1,0),S=new e.Vector2(1,1),M=d,x=p;i.useProgram(f),i.enableVertexAttribArray(p.vertex),i.enableVertexAttribArray(p.uv),i.uniform1i(M.occlusionMap,0),i.uniform1i(M.map,1),i.bindBuffer(i.ARRAY_BUFFER,s),i.vertexAttribPointer(x.vertex,2,i.FLOAT,!1,16,0),i.vertexAttribPointer(x.uv,2,i.FLOAT,!1,16,8),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,l),i.disable(i.CULL_FACE),i.depthMask(!1);var C,A,T,E,k;for(C=0;m>C;C++)if(x=16/a,w.set(x*v,x),E=t[C],g.set(E.matrixWorld.elements[12],E.matrixWorld.elements[13],E.matrixWorld.elements[14]),g.applyMatrix4(r.matrixWorldInverse),g.applyProjection(r.projectionMatrix),_.copy(g),S.x=_.x*y+y,S.y=_.y*b+b,h||0<S.x&&S.x<o&&0<S.y&&S.y<a)for(i.activeTexture(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,u),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGB,S.x-8,S.y-8,16,16,0),i.uniform1i(M.renderType,0),i.uniform2f(M.scale,w.x,w.y),i.uniform3f(M.screenPosition,_.x,_.y,_.z),i.disable(i.BLEND),i.enable(i.DEPTH_TEST),i.drawElements(i.TRIANGLES,6,i.UNSIGNED_SHORT,0),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,c),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,S.x-8,S.y-8,16,16,0),i.uniform1i(M.renderType,1),i.disable(i.DEPTH_TEST),i.activeTexture(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,u),i.drawElements(i.TRIANGLES,6,i.UNSIGNED_SHORT,0),E.positionScreen.copy(_),E.customUpdateCallback?E.customUpdateCallback(E):E.updateLensFlares(),i.uniform1i(M.renderType,2),i.enable(i.BLEND),A=0,T=E.lensFlares.length;T>A;A++)k=E.lensFlares[A],.001<k.opacity&&.001<k.scale&&(_.x=k.x,_.y=k.y,_.z=k.z,x=k.size*k.scale/a,w.x=x*v,w.y=x,i.uniform3f(M.screenPosition,_.x,_.y,_.z),i.uniform2f(M.scale,w.x,w.y),i.uniform1f(M.rotation,k.rotation),i.uniform1f(M.opacity,k.opacity),i.uniform3f(M.color,k.color.r,k.color.g,k.color.b),n.setBlending(k.blending,k.blendEquation,k.blendSrc,k.blendDst),n.setTexture(k.texture,1),i.drawElements(i.TRIANGLES,6,i.UNSIGNED_SHORT,0));i.enable(i.CULL_FACE),i.enable(i.DEPTH_TEST),i.depthMask(!0)}}},e.ShadowMapPlugin=function(){var t,i,n,r,o,a,s=new e.Frustum,l=new e.Matrix4,u=new e.Vector3,c=new e.Vector3,h=new e.Vector3;this.init=function(s){t=s.context,i=s;var s=e.ShaderLib.depthRGBA,l=e.UniformsUtils.clone(s.uniforms);n=new e.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:l}),r=new e.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:l,morphTargets:!0}),o=new e.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:l,skinning:!0}),a=new e.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:l,morphTargets:!0,skinning:!0}),n._shadowPass=!0,r._shadowPass=!0,o._shadowPass=!0,a._shadowPass=!0
},this.render=function(e,t){i.shadowMapEnabled&&i.shadowMapAutoUpdate&&this.update(e,t)},this.update=function(f,p){var d,m,g,v,y,b,x,w,_,S=[];for(v=0,t.clearColor(1,1,1,1),t.disable(t.BLEND),t.enable(t.CULL_FACE),t.frontFace(t.CCW),t.cullFace(i.shadowMapCullFace===e.CullFaceFront?t.FRONT:t.BACK),i.setDepthTest(!0),d=0,m=f.__lights.length;m>d;d++)if(g=f.__lights[d],g.castShadow)if(g instanceof e.DirectionalLight&&g.shadowCascade)for(y=0;y<g.shadowCascadeCount;y++){var M;if(g.shadowCascadeArray[y])M=g.shadowCascadeArray[y];else{_=g,x=y,M=new e.DirectionalLight,M.isVirtual=!0,M.onlyShadow=!0,M.castShadow=!0,M.shadowCameraNear=_.shadowCameraNear,M.shadowCameraFar=_.shadowCameraFar,M.shadowCameraLeft=_.shadowCameraLeft,M.shadowCameraRight=_.shadowCameraRight,M.shadowCameraBottom=_.shadowCameraBottom,M.shadowCameraTop=_.shadowCameraTop,M.shadowCameraVisible=_.shadowCameraVisible,M.shadowDarkness=_.shadowDarkness,M.shadowBias=_.shadowCascadeBias[x],M.shadowMapWidth=_.shadowCascadeWidth[x],M.shadowMapHeight=_.shadowCascadeHeight[x],M.pointsWorld=[],M.pointsFrustum=[],w=M.pointsWorld,b=M.pointsFrustum;for(var C=0;8>C;C++)w[C]=new e.Vector3,b[C]=new e.Vector3;w=_.shadowCascadeNearZ[x],_=_.shadowCascadeFarZ[x],b[0].set(-1,-1,w),b[1].set(1,-1,w),b[2].set(-1,1,w),b[3].set(1,1,w),b[4].set(-1,-1,_),b[5].set(1,-1,_),b[6].set(-1,1,_),b[7].set(1,1,_),M.originalCamera=p,b=new e.Gyroscope,b.position=g.shadowCascadeOffset,b.add(M),b.add(M.target),p.add(b),g.shadowCascadeArray[y]=M,console.log("Created virtualLight",M)}x=g,w=y,_=x.shadowCascadeArray[w],_.position.copy(x.position),_.target.position.copy(x.target.position),_.lookAt(_.target),_.shadowCameraVisible=x.shadowCameraVisible,_.shadowDarkness=x.shadowDarkness,_.shadowBias=x.shadowCascadeBias[w],b=x.shadowCascadeNearZ[w],x=x.shadowCascadeFarZ[w],_=_.pointsFrustum,_[0].z=b,_[1].z=b,_[2].z=b,_[3].z=b,_[4].z=x,_[5].z=x,_[6].z=x,_[7].z=x,S[v]=M,v++}else S[v]=g,v++;for(d=0,m=S.length;m>d;d++){if(g=S[d],g.shadowMap||(y=e.LinearFilter,i.shadowMapType===e.PCFSoftShadowMap&&(y=e.NearestFilter),g.shadowMap=new e.WebGLRenderTarget(g.shadowMapWidth,g.shadowMapHeight,{minFilter:y,magFilter:y,format:e.RGBAFormat}),g.shadowMapSize=new e.Vector2(g.shadowMapWidth,g.shadowMapHeight),g.shadowMatrix=new e.Matrix4),!g.shadowCamera){if(g instanceof e.SpotLight)g.shadowCamera=new e.PerspectiveCamera(g.shadowCameraFov,g.shadowMapWidth/g.shadowMapHeight,g.shadowCameraNear,g.shadowCameraFar);else{if(!(g instanceof e.DirectionalLight)){console.error("Unsupported light type for shadow");continue}g.shadowCamera=new e.OrthographicCamera(g.shadowCameraLeft,g.shadowCameraRight,g.shadowCameraTop,g.shadowCameraBottom,g.shadowCameraNear,g.shadowCameraFar)}f.add(g.shadowCamera),!0===f.autoUpdate&&f.updateMatrixWorld()}if(g.shadowCameraVisible&&!g.cameraHelper&&(g.cameraHelper=new e.CameraHelper(g.shadowCamera),g.shadowCamera.add(g.cameraHelper)),g.isVirtual&&M.originalCamera==p){for(y=p,v=g.shadowCamera,b=g.pointsFrustum,_=g.pointsWorld,u.set(1/0,1/0,1/0),c.set(-1/0,-1/0,-1/0),x=0;8>x;x++)w=_[x],w.copy(b[x]),e.ShadowMapPlugin.__projector.unprojectVector(w,y),w.applyMatrix4(v.matrixWorldInverse),w.x<u.x&&(u.x=w.x),w.x>c.x&&(c.x=w.x),w.y<u.y&&(u.y=w.y),w.y>c.y&&(c.y=w.y),w.z<u.z&&(u.z=w.z),w.z>c.z&&(c.z=w.z);v.left=u.x,v.right=c.x,v.top=c.y,v.bottom=u.y,v.updateProjectionMatrix()}for(v=g.shadowMap,b=g.shadowMatrix,y=g.shadowCamera,y.position.getPositionFromMatrix(g.matrixWorld),h.getPositionFromMatrix(g.target.matrixWorld),y.lookAt(h),y.updateMatrixWorld(),y.matrixWorldInverse.getInverse(y.matrixWorld),g.cameraHelper&&(g.cameraHelper.visible=g.shadowCameraVisible),g.shadowCameraVisible&&g.cameraHelper.update(),b.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),b.multiply(y.projectionMatrix),b.multiply(y.matrixWorldInverse),l.multiplyMatrices(y.projectionMatrix,y.matrixWorldInverse),s.setFromMatrix(l),i.setRenderTarget(v),i.clear(),_=f.__webglObjects,g=0,v=_.length;v>g;g++)x=_[g],b=x.object,x.render=!1,!b.visible||!b.castShadow||(b instanceof e.Mesh||b instanceof e.ParticleSystem)&&b.frustumCulled&&!s.intersectsObject(b)||(b._modelViewMatrix.multiplyMatrices(y.matrixWorldInverse,b.matrixWorld),x.render=!0);for(g=0,v=_.length;v>g;g++)x=_[g],x.render&&(b=x.object,x=x.buffer,C=b.material instanceof e.MeshFaceMaterial?b.material.materials[0]:b.material,w=0<b.geometry.morphTargets.length&&C.morphTargets,C=b instanceof e.SkinnedMesh&&C.skinning,w=b.customDepthMaterial?b.customDepthMaterial:C?w?a:o:w?r:n,x instanceof e.BufferGeometry?i.renderBufferDirect(y,f.__lights,null,w,x,b):i.renderBuffer(y,f.__lights,null,w,x,b));for(_=f.__webglObjectsImmediate,g=0,v=_.length;v>g;g++)x=_[g],b=x.object,b.visible&&b.castShadow&&(b._modelViewMatrix.multiplyMatrices(y.matrixWorldInverse,b.matrixWorld),i.renderImmediateObject(y,f.__lights,null,n,b))}d=i.getClearColor(),m=i.getClearAlpha(),t.clearColor(d.r,d.g,d.b,m),t.enable(t.BLEND),i.shadowMapCullFace===e.CullFaceFront&&t.cullFace(t.BACK)}},e.ShadowMapPlugin.__projector=new e.Projector,e.SpritePlugin=function(){function t(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}var i,n,r,o,a,s,l,u,c,h;this.init=function(t){i=t.context,n=t,r=t.getPrecision(),o=new Float32Array(16),a=new Uint16Array(6),t=0,o[t++]=-1,o[t++]=-1,o[t++]=0,o[t++]=0,o[t++]=1,o[t++]=-1,o[t++]=1,o[t++]=0,o[t++]=1,o[t++]=1,o[t++]=1,o[t++]=1,o[t++]=-1,o[t++]=1,o[t++]=0,o[t++]=1,t=0,a[t++]=0,a[t++]=1,a[t++]=2,a[t++]=0,a[t++]=2,a[t++]=3,s=i.createBuffer(),l=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,s),i.bufferData(i.ARRAY_BUFFER,o,i.STATIC_DRAW),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,l),i.bufferData(i.ELEMENT_ARRAY_BUFFER,a,i.STATIC_DRAW);var t=e.ShaderSprite.sprite,f=i.createProgram(),p=i.createShader(i.FRAGMENT_SHADER),d=i.createShader(i.VERTEX_SHADER),m="precision "+r+" float;\n";i.shaderSource(p,m+t.fragmentShader),i.shaderSource(d,m+t.vertexShader),i.compileShader(p),i.compileShader(d),i.attachShader(f,p),i.attachShader(f,d),i.linkProgram(f),u=f,c={},h={},c.position=i.getAttribLocation(u,"position"),c.uv=i.getAttribLocation(u,"uv"),h.uvOffset=i.getUniformLocation(u,"uvOffset"),h.uvScale=i.getUniformLocation(u,"uvScale"),h.rotation=i.getUniformLocation(u,"rotation"),h.scale=i.getUniformLocation(u,"scale"),h.alignment=i.getUniformLocation(u,"alignment"),h.color=i.getUniformLocation(u,"color"),h.map=i.getUniformLocation(u,"map"),h.opacity=i.getUniformLocation(u,"opacity"),h.useScreenCoordinates=i.getUniformLocation(u,"useScreenCoordinates"),h.sizeAttenuation=i.getUniformLocation(u,"sizeAttenuation"),h.screenPosition=i.getUniformLocation(u,"screenPosition"),h.modelViewMatrix=i.getUniformLocation(u,"modelViewMatrix"),h.projectionMatrix=i.getUniformLocation(u,"projectionMatrix"),h.fogType=i.getUniformLocation(u,"fogType"),h.fogDensity=i.getUniformLocation(u,"fogDensity"),h.fogNear=i.getUniformLocation(u,"fogNear"),h.fogFar=i.getUniformLocation(u,"fogFar"),h.fogColor=i.getUniformLocation(u,"fogColor"),h.alphaTest=i.getUniformLocation(u,"alphaTest")},this.render=function(r,o,a,f){var p=r.__webglSprites,d=p.length;if(d){var m=c,g=h,v=f/a,a=.5*a,y=.5*f;i.useProgram(u),i.enableVertexAttribArray(m.position),i.enableVertexAttribArray(m.uv),i.disable(i.CULL_FACE),i.enable(i.BLEND),i.bindBuffer(i.ARRAY_BUFFER,s),i.vertexAttribPointer(m.position,2,i.FLOAT,!1,16,0),i.vertexAttribPointer(m.uv,2,i.FLOAT,!1,16,8),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,l),i.uniformMatrix4fv(g.projectionMatrix,!1,o.projectionMatrix.elements),i.activeTexture(i.TEXTURE0),i.uniform1i(g.map,0);var b=m=0,x=r.fog;x?(i.uniform3f(g.fogColor,x.color.r,x.color.g,x.color.b),x instanceof e.Fog?(i.uniform1f(g.fogNear,x.near),i.uniform1f(g.fogFar,x.far),i.uniform1i(g.fogType,1),b=m=1):x instanceof e.FogExp2&&(i.uniform1f(g.fogDensity,x.density),i.uniform1i(g.fogType,2),b=m=2)):(i.uniform1i(g.fogType,0),b=m=0);for(var w,_,S=[],x=0;d>x;x++)w=p[x],_=w.material,w.visible&&0!==_.opacity&&(_.useScreenCoordinates?w.z=-w.position.z:(w._modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,w.matrixWorld),w.z=-w._modelViewMatrix.elements[14]));for(p.sort(t),x=0;d>x;x++)w=p[x],_=w.material,w.visible&&0!==_.opacity&&_.map&&_.map.image&&_.map.image.width&&(i.uniform1f(g.alphaTest,_.alphaTest),!0===_.useScreenCoordinates?(i.uniform1i(g.useScreenCoordinates,1),i.uniform3f(g.screenPosition,(w.position.x*n.devicePixelRatio-a)/a,(y-w.position.y*n.devicePixelRatio)/y,Math.max(0,Math.min(1,w.position.z))),S[0]=n.devicePixelRatio,S[1]=n.devicePixelRatio):(i.uniform1i(g.useScreenCoordinates,0),i.uniform1i(g.sizeAttenuation,_.sizeAttenuation?1:0),i.uniformMatrix4fv(g.modelViewMatrix,!1,w._modelViewMatrix.elements),S[0]=1,S[1]=1),o=r.fog&&_.fog?b:0,m!==o&&(i.uniform1i(g.fogType,o),m=o),o=1/(_.scaleByViewport?f:1),S[0]*=o*v*w.scale.x,S[1]*=o*w.scale.y,i.uniform2f(g.uvScale,_.uvScale.x,_.uvScale.y),i.uniform2f(g.uvOffset,_.uvOffset.x,_.uvOffset.y),i.uniform2f(g.alignment,_.alignment.x,_.alignment.y),i.uniform1f(g.opacity,_.opacity),i.uniform3f(g.color,_.color.r,_.color.g,_.color.b),i.uniform1f(g.rotation,w.rotation),i.uniform2fv(g.scale,S),n.setBlending(_.blending,_.blendEquation,_.blendSrc,_.blendDst),n.setDepthTest(_.depthTest),n.setDepthWrite(_.depthWrite),n.setTexture(_.map,0),i.drawElements(i.TRIANGLES,6,i.UNSIGNED_SHORT,0));i.enable(i.CULL_FACE)}}},e.DepthPassPlugin=function(){this.enabled=!1,this.renderTarget=null;var t,i,n,r,o,a,s=new e.Frustum,l=new e.Matrix4;this.init=function(s){t=s.context,i=s;var s=e.ShaderLib.depthRGBA,l=e.UniformsUtils.clone(s.uniforms);n=new e.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:l}),r=new e.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:l,morphTargets:!0}),o=new e.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:l,skinning:!0}),a=new e.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:l,morphTargets:!0,skinning:!0}),n._shadowPass=!0,r._shadowPass=!0,o._shadowPass=!0,a._shadowPass=!0},this.render=function(e,t){this.enabled&&this.update(e,t)},this.update=function(u,c){var h,f,p,d,m,g;for(t.clearColor(1,1,1,1),t.disable(t.BLEND),i.setDepthTest(!0),!0===u.autoUpdate&&u.updateMatrixWorld(),c.matrixWorldInverse.getInverse(c.matrixWorld),l.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse),s.setFromMatrix(l),i.setRenderTarget(this.renderTarget),i.clear(),g=u.__webglObjects,h=0,f=g.length;f>h;h++)p=g[h],m=p.object,p.render=!1,!m.visible||(m instanceof e.Mesh||m instanceof e.ParticleSystem)&&m.frustumCulled&&!s.intersectsObject(m)||(m._modelViewMatrix.multiplyMatrices(c.matrixWorldInverse,m.matrixWorld),p.render=!0);var v;for(h=0,f=g.length;f>h;h++)p=g[h],!p.render||(m=p.object,p=p.buffer,m instanceof e.ParticleSystem&&!m.customDepthMaterial)||((v=m.material instanceof e.MeshFaceMaterial?m.material.materials[0]:m.material)&&i.setMaterialFaces(m.material),d=0<m.geometry.morphTargets.length&&v.morphTargets,v=m instanceof e.SkinnedMesh&&v.skinning,d=m.customDepthMaterial?m.customDepthMaterial:v?d?a:o:d?r:n,p instanceof e.BufferGeometry?i.renderBufferDirect(c,u.__lights,null,d,p,m):i.renderBuffer(c,u.__lights,null,d,p,m));for(g=u.__webglObjectsImmediate,h=0,f=g.length;f>h;h++)p=g[h],m=p.object,m.visible&&(m._modelViewMatrix.multiplyMatrices(c.matrixWorldInverse,m.matrixWorld),i.renderImmediateObject(c,u.__lights,null,n,m));h=i.getClearColor(),f=i.getClearAlpha(),t.clearColor(h.r,h.g,h.b,f),t.enable(t.BLEND)}},e.ShaderFlares={lensFlareVertexTexture:{vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.1, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility = (       visibility.r / 9.0 ) *\n( 1.0 - visibility.g / 9.0 ) *\n(       visibility.b / 9.0 ) *\n( 1.0 - visibility.a / 9.0 );\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"uniform lowp int renderType;\nuniform sampler2D map;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"},lensFlare:{vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"precision mediump float;\nuniform lowp int renderType;\nuniform sampler2D map;\nuniform sampler2D occlusionMap;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * visibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"}},e.ShaderSprite={sprite:{vertexShader:"uniform int useScreenCoordinates;\nuniform int sizeAttenuation;\nuniform vec3 screenPosition;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 alignment;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position + alignment;\nvec2 rotatedPosition;\nrotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;\nrotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;\nvec4 finalPosition;\nif( useScreenCoordinates != 0 ) {\nfinalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );\n} else {\nfinalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition * ( sizeAttenuation == 1 ? 1.0 : finalPosition.z );\n}\ngl_Position = finalPosition;\n}",fragmentShader:"uniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nuniform int fogType;\nuniform vec3 fogColor;\nuniform float fogDensity;\nuniform float fogNear;\nuniform float fogFar;\nuniform float alphaTest;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\nif ( texture.a < alphaTest ) discard;\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\nif ( fogType > 0 ) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = 0.0;\nif ( fogType == 1 ) {\nfogFactor = smoothstep( fogNear, fogFar, depth );\n} else {\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n}\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}\n}"}},t.exports=e}()},{}],57:[function(e,t){t.exports=function(e,t){"use strict";var i,n,r=e.dollar,o=function(){return i};return o.export=function(e){e.Canvas=i.Canvas},i={initialized:!1,canvasObject:null,canvas:null,container:null,_update:function(){this.initialized&&this.canvasObject&&this.canvasObject._update()},hide:function(){this.canvas&&this.canvasObject.hide()},remove:function(){this.canvasObject&&this.canvasObject.remove()},removeCameraAndLights:function(){this.scene.remove(this.camera),this.scene.remove(this.pointLight),this.scene.remove(this.pointLight2),this.scene.add(this.ambientLight),this.camera=null,this.lights.length=0},init:function(e){this.container=t.getContainer(e),this.initialized=!0,null===this.canvasObject&&(this.canvasObject=i._Canvas(e),this.canvas=this.canvasObject.canvas,this.container.append?this.container.append(this.canvas):this.container.appendChild(this.canvas)),t.running||t.start()},setSize:function(e,t){this.canvasObject.setSize(e,t)},setupCameraAndLights:function(){var e=t.modes["3d"].obj;"3d"===t.mode&&e.removeCameraAndLights(),e.camera=new THREE.OrthographicCamera(t.width/-2,t.width/2,t.height/2,t.height/-2,1,1.00000001),e.camera.position.z=1,e.resolution=.5,e.renderer.setSize(t.width,t.height)},Canvas:function(e){return"3d"===t.mode&&t.modes["3d"].obj.remove(),i.intialized||t.init("2d",e),i.canvasObject.show(),i.canvasObject}.bind(i),_Canvas:function(){var i=document.createElement("canvas"),o=i.getContext("2d"),a=o;return r.extend(a,{top:0,bottom:i.height,left:0,right:i.width,center:{x:i.width/2,y:i.height/2},init:function(){t.running||t.start()},setSize:function(e,i){this.width=this.right=e,this.height=this.bottom=i,this.center.x=this.width/2,this.center.y=this.height/2,this.canvas.style.width=e+"px",this.canvas.style.height=i+"px",this.canvas.width=this.width*t.resolution,this.canvas.height=this.height*t.resolution},removeCameraAndLights:function(){},is3D:"3d"===t.mode,texture:{needsUpdate:function(){}},remove:function(){a.hide(),a.draw=function(){},t.modes["2d"].canvas=null},show:function(){i.style.display="block"},hide:function(){i.style.display="none"},shouldClear:!1,_fill:a.fill,_stroke:a.stroke,_rotate:a.rotate,rotate:function(e){this.translate(this.center.x,this.center.y),this._rotate(e),this.translate(-this.center.x,-this.center.y)},fill:function(e){return"undefined"!=typeof e&&(isNaN(e)||(e="rgb("+e+","+e+","+e+")"),this.fillStyle=e),this._fill(),this.texture.needsUpdate=!0,this},fade:function(e,t){var i=this.alpha;this.fillStyle="undefined"==typeof t?"black":t,this.alpha=e,this.fillRect(0,0,this.width,this.height),this.alpha=i},stroke:function(e,t){return"undefined"!=typeof e&&(isNaN(e)||(e="rgb("+e+","+e+","+e+")"),this.strokeStyle=e),"undefined"!=typeof t&&(this.lineWidth=t),this._stroke(),this.texture.needsUpdate=!0,this},_update:function(){this.shouldClear&&this.clear(),this.save();for(var e=0;e<this.graph.length;e++){var t=this.graph[e];t._update(),t.update&&t.update(),t.draw()}this.draw(),this.restore()},draw:function(){},clear:function(){return this.clearRect(0,0,this.right,this.bottom),this.texture.needsUpdate=!0,this},line:function(e,t,i,n){return this.beginPath(),this.moveTo(e,t),this.lineTo(i,n),this.closePath(),this},circle:function(e,t,i){return i>0&&(this.save(),this.translate(e,t),this.beginPath(),this.arc(0,0,i,0,2*Math.PI),this.closePath(),this.restore()),this},square:function(e,t,i){return this.beginPath(),this.moveTo(e,t),this.lineTo(e+i,t),this.lineTo(e+i,t+i),this.lineTo(e,t+i),this.lineTo(e,t),this.closePath(),this},rectangle:function(e,t,i,n){return this.beginPath(),this.moveTo(e,t),this.lineTo(e+i,t),this.lineTo(e+i,t+n),this.lineTo(e,t+n),this.lineTo(e,t),this.closePath(),this},shapes:{Shape:function(){var t={ctx:a,stroke:null,fill:"gray",mods:[],_update:function(){for(var e=0;e<this.mods.length;e++){var t,i,n,r=this.mods[e];switch(t=this[r.name](),i=r.name.toUpperCase(),r.type){case"+":n="number"==typeof r.modulator?t+r.modulator*r.mult:t+r.modulator.getValue()*r.mult;break;case"++":n+="number"==typeof r.modulator?t+Math.abs(r.modulator*r.mult):t+Math.abs(r.modulator.getValue()*r.mult);break;case"-":n="number"==typeof r.modulator?t-r.modulator*r.mult:t-r.modulator.getValue()*r.mult;break;case"=":n="number"==typeof r.modulator?r.modulator:r.modulator.getValue()*r.mult}this[r.name](n)}},remove:function(){a.graph.splice(a.graph.indexOf(this),1)},changeZ:function(e){r=e},mod:function(e,t,i,n){return this.mods.push({name:e,modulator:t,type:i||"+",mult:n||1}),this},removeMod:function(e){if(e)for(var t=this.mods.length-1;t>=0;t--){var i=this.mods[t];i.name===e&&this.mods.splice(t,1)}else this.mods=[]}};a.shouldClear=!0;var i=0,n=0,r=(height=.2,a.graph.length);Object.defineProperties(t,{x:{configurable:!0,get:function(){return i},set:function(e){i=e}},y:{configurable:!0,get:function(){return n},set:function(e){n=e}},z:{get:function(){return r},set:function(e){a.reorderGraph(),a.graph.splice(a.graph.indexOf(this),1),a.graph.splice(e,0,this),r=e}}});var o=({min:0,max:1,timescale:"graphics",output:e.LINEAR},{x:a.zeroToOne,y:a.zeroToOne});return e.createProxyProperties(t,o),a.graph.push(t),t},Rectangle:function(){var t=a.shapes.Shape(),i={width:a.zeroToOne,height:a.zeroToOne};t.draw=function(){a.rectangle(Math.floor(this.x()*a.width),Math.floor(this.y()*a.height),Math.floor(this.width()*a.width),Math.floor(this.height()*a.height)),this.stroke&&a.stroke(this.stroke),this.fill&&a.fill(this.fill)};var n=height=.2;return Object.defineProperties(t,{width:{configurable:!0,get:function(){return n},set:function(e){n=e}},height:{configurable:!0,get:function(){return height},set:function(e){height=e}}}),e.createProxyProperties(t,i),"object"==typeof arguments[0]&&r.extend(t,arguments[0]),t},Polygon:function(){var t=a.shapes.Shape(),i={radius:a.zeroToOne,sides:{min:3,max:20,output:e.LINEAR,timescale:"graphics"}};t.draw=function(){a.polygon(Math.floor(this.x()*a.width),Math.floor(this.y()*a.height),Math.floor(this.radius()*a.width),this.sides()),this.stroke&&a.stroke(this.stroke),this.fill&&a.fill(this.fill)};var n=.2,o=5;return Object.defineProperties(t,{radius:{configurable:!0,get:function(){return n},set:function(e){n=e}},sides:{configurable:!0,get:function(){return o},set:function(e){o=e}}}),e.createProxyProperties(t,i),"object"==typeof arguments[0]&&r.extend(t,arguments[0]),t}},zeroToOne:{min:0,max:1,timescale:"graphics",output:e.LINEAR},reorderGraph:function(){if(z>v)for(var e=v;e<a.graph.length;e++)a.graph[e].changeZ(a.graph[e].z+1)},graph:[],update:function(){return this.texture.needsUpdate=!0,this},polygon:function(e,t,i,n){for(var r=360/n,o=1;n>=o;o++){var a=r*o,s=2*Math.PI*(a/360),l=Math.round(Math.sin(s)*i)+e,u=Math.round(Math.cos(s)*i)+t;1===o?(this.beginPath(),this.moveTo(l,u)):this.lineTo(l,u)}var a=r,s=2*Math.PI*(a/360),l=Math.round(Math.sin(s)*i)+e,u=Math.round(Math.cos(s)*i)+t;return this.lineTo(l,u),this.closePath(),this},randomColor:function(){return"#"+Math.random().toString(16).slice(2,8)},width:i.width,height:i.height,sprite:null,createSprite:function(){return a.texture=new t.THREE.Texture(i),a.sprite=new t.THREE.Mesh(new t.THREE.PlaneGeometry(i.width,i.height,1,1),new t.THREE.MeshBasicMaterial({map:a.texture,affectedByDistance:!1,useScreenCoordinates:!0})),a.sprite.position.x=a.sprite.position.y=a.sprite.position.z=0,a.texture.needsUpdate=!0,a.sprite}}),n=a,Object.defineProperties(a,{fps:{get:function(){return null!==t.fps?t.fps:60},set:function(e){t.fps=e}},alpha:{get:function(){return this.globalAlpha},set:function(e){this.globalAlpha=e}}}),a}},o}},{}],58:[function(e,t){t.exports=function(e,t){"use strict";var i=e.dollar,n=function(e){var n=i.extend({},{canvas:null,ctx:null,initialized:!1,renderer:null,scene:null,camera:null,lights:[],running:!1,shouldReadPixels:!1,init:function(){this.container=t.getContainer(e),this.initialized&&this.setSize(t.width,t.height),this.createRenderer(),this.createScene(),this.createLights(),t.running||t.start(),this.show(),this.initialized=!0,this.running=!0,t.mode="3d"},setSize:function(e,t){this.renderer.setSize(e,t),this.renderer.domElement.style.width=e+"px",this.renderer.domElement.style.height=t+"px",this.createCameras()},pixels:null,_update:function(){if(this.initialized&&this.running)if(this.renderer.clear(),t.PostProcessing&&t.PostProcessing.fx.length){t.PostProcessing.composer.render();var e=this.renderer.getContext();this.shouldReadPixels&&(null===this.pixels&&(this.pixels=new Uint8Array(this.renderer.domElement.width*this.renderer.domElement.height*4)),e.readPixels(0,0,this.renderer.domElement.width,this.renderer.domElement.height,e.RGBA,e.UNSIGNED_BYTE,this.pixels))}else this.renderer.render(this.scene,this.camera)},createRenderer:function(){null===this.renderer&&(this.renderer=new t.THREE.WebGLRenderer,this.initalized||(this.container.append?this.container.append(this.renderer.domElement):this.container.appendChild(this.renderer.domElement)),this.canvas=this.renderer.domElement)},createScene:function(){null===this.scene&&(this.scene=new t.THREE.Scene)},createCameras:function(){if(null===this.camera){var e=45,i=t.width/t.height,n=.1,r=1e4;this.camera=new t.THREE.PerspectiveCamera(e,i,n,r),this.scene.add(this.camera)}this.camera.updateProjectionMatrix(),this.camera.position.z=250,this.camera.lookAt(this.scene.position)},createLights:function(){this.lights.length>1||(this.ambientLight=new t.THREE.AmbientLight(16777215),this.pointLight=new t.THREE.PointLight(16777215),this.pointLight.position.x=100,this.pointLight.position.y=100,this.pointLight.position.z=-130,this.pointLight2=new t.THREE.PointLight(6710886),this.pointLight2.position.x=0,this.pointLight2.position.y=0,this.pointLight2.position.z=260,this.lights=[this.pointLight,this.pointLight2],this.scene.add(this.pointLight),this.scene.add(this.pointLight2))},removeCameraAndLights:function(){this.scene.remove(this.camera),this.scene.remove(this.pointLight),this.scene.remove(this.pointLight2),this.scene.add(this.ambientLight),this.camera=null,this.lights.length=0},remove:function(){this.hide(),this.running=!1,this.removeCameraAndLights();for(var e=0;e<this.scene.children.length;e++)this.scene.remove(this.scene.children[e])},show:function(){n.canvas.style.display="block"},hide:function(){n.canvas.style.display="none"}});return n};return n}},{}],59:[function(e,t){t.exports=function(e,t,i){"use strict";var n=e.dollar,r=function(){var e=rndf(-50,50,3);return{x:e[0],y:e[1],z:e[2]}},o=[["Vec2","Vector2","vec2"],["Vec3","Vector3","vec3"],["Vec4","Vector4","vec4"]].forEach(function(t){var n=t[0],r=t[1]||t[0],o=t[2]||"f";window[n]=function(){var t,a=Array.prototype.slice.call(arguments,0);if(Array.isArray(a[0])){for(var s=[],l=0;l<a[0].length;l++)s[l]=a[0][l];a=s}return t=e.construct(i[r],a),t.name=n,t.shaderType=o,t}});Vec2.random=function(e,t){return"undefined"==typeof e&&(e=0),"undefined"==typeof t&&(t=e+1),Vec2(rndf(e,t),rndf(e,t))},Vec2.div=function(e,t){var i=e.clone();return i.divideScalar(t),i},Vec2.sub=function(e,t){var i=e.clone();return i.sub(t),i},i.Vector2.prototype.limit=function(e){this.length()>e&&(this.normalize(),this.multiplyScalar(e))};var o={Cube:{width:50,height:50,depth:50},Sphere:{radius:50,segments:16,rings:16},Tetrahedron:{radius:50,detail:0},Octahedron:{radius:50,detail:0},Icosahedron:{radius:50,detail:0},Cylinder:{radiusTop:20,radiusBottom:20,height:100,radiusSegments:8,heightSegments:1,openEnded:!1},Parametric:{func:r,slices:8,stacks:8},Torus:{radius:50,tube:10,radialSegments:8,tubularSegments:8,arc:2*Math.PI},TorusKnot:{radius:50,tube:5,radialSegments:64,tubularSegments:8,p:5,q:3,heightScale:1},Plane:{width:150,height:150,segmentsWidth:1,segmentsHeight:1}},a=["rotation","scale","position"],s=function(t,i,n){{var r;e.processArguments(t,i)}if("object"==typeof t[0]){r=[];for(var o in n){var a="undefined"!=typeof t[0][o]?t[0][o]:n[o];r.push(a)}for(var s in t[0])n[s]||(r[s]=t[0][s])}else if(Array.isArray(t))r=t;else{r=[];for(var o in n)r.push(n[o])}return r},l={rotation:{min:0,max:2*Math.PI,output:e.LINEAR,wrap:!0,timescale:"graphics"},scale:{min:0,max:2,output:e.LINEAR,wrap:!1,timescale:"graphics"},position:{min:-100,max:100,output:e.LINEAR,wrap:!1,timescale:"graphics"}},u={"export":function(e){n.extend(e,u)}};for(var c in o)!function(){var r=c,h=o[c],f=function(){null===t.modes["3d"].obj?t.init("3d",null):(t.modes["3d"].obj.init(),t.modes["3d"].obj.show(),t.mode="3d"),t.running=!0;var o=s(arguments,r,h);if(this.name=r,o.color&&n.isArray(o.color)){var u=o.color;o.color=Color().rgb(255*u[0],255*u[1],255*u[2]).hexString()}this.color=new i.Color(o.color)||new i.Color(16777215);var c="undefined"!=typeof arguments[0]&&arguments[0].shader;c?(this.material=new i.ShaderMaterial(arguments[0].shader.material||arguments[0].shader),arguments[0].shader.material&&(arguments[0].shader.target=this)):this.material=o.texture?new i.MeshBasicMaterial({map:o.texture,affectedByDistance:!1,useScreenCoordinates:!0}):new i.MeshPhongMaterial({color:this.color,shading:i.FlatShading,shininess:50}),this.geometry=e.construct(i[r+"Geometry"],o),this.mesh=new i.Mesh(this.geometry,this.material),this.spinX=this.spinY=this.spinZ=0,this.mappingProperties=l,this.mappingObjects=[];for(var f={x:"X",y:"Y",z:"Z"},p=0;p<a.length;p++)!function(t){{var i=a[p],o="scale"===i?Vec3(1,1,1):Vec3(),s=function(){t.mesh[i].set(o.x,o.y,o.z)};o.x,o.y,o.z}o.name=r+"."+i,o.seq=t.seq,Object.defineProperty(t,i,{configurable:!0,get:function(){return o},set:function(e){switch(n.type(e)){case"object":"number"==typeof e.x&&(o.x=e.x),"number"==typeof e.y&&(o.y=e.y),"number"==typeof e.z&&(o.z=e.z);break;case"array":"number"==typeof e[0]&&(o.x=e[0]),"number"==typeof e[1]&&(o.y=e[1]),"number"==typeof e[2]&&(o.z=e[2]);break;case"number":o.x=o.y=o.z=e}return s(),o}}),e.defineProperty(t,i,!0,!0,l[i],!0,!1,!0),Object.defineProperties(t[i],{x:{get:function(){return o.x},set:function(e){o.x=e,s()},configurable:!0},y:{get:function(){return o.y},set:function(e){o.y=e,s()},configurable:!0},z:{get:function(){return o.z},set:function(e){o.z=e,s()},configurable:!0}});for(var u in f)!function(){var n=u;e.defineProperty(t[i],u,!0,!0,l[i],!0),t[i][n].modObject=t,t[i][n].modName=i+"."+n,t[i][n].set=function(e){o[n]=e,s()}}()}(this);this.update=function(){},this._update=function(){for(var e=0;e<this.mods.length;e++){var t,i,n,r=this.mods[e];if(r.name.indexOf(".")>-1){var o=r.name.split(".");switch(t=this[o[0]][o[1]](),i=o[1].toUpperCase(),r.type){case"+":n="number"==typeof r.modulator?t+r.modulator*r.mult:t+r.modulator.getValue()*r.mult;break;case"++":n+="number"==typeof r.modulator?t+Math.abs(r.modulator*r.mult):t+Math.abs(r.modulator.getValue()*r.mult);break;case"-":n="number"==typeof r.modulator?t-r.modulator*r.mult:t-r.modulator.getValue()*r.mult;break;case"=":n="number"==typeof r.modulator?r.modulator:r.modulator.getValue()*r.mult}this[o[0]][o[1]].set(n)}else{var a="number"==typeof r.modulator?r.modulator:r.modulator.getValue();switch(r.type){case"+":this[r.name].x+=a*r.mult,this[r.name].y+=a*r.mult,this[r.name].z+=a*r.mult;break;case"++":this[r.name].x+=Math.abs(a*r.mult),this[r.name].y+=Math.abs(a*r.mult),this[r.name].z+=Math.abs(a*r.mult);break;case"-":this[r.name].x-=a*r.mult,this[r.name].y-=a*r.mult,this[r.name].z-=a*r.mult;break;case"=":this[r.name].x=a*r.mult,this[r.name].y=a*r.mult,this[r.name].z=a*r.mult}}}},this.mods=[],this.remove=this.kill=function(e){return t.modes["3d"].obj.scene.remove(this.mesh),e||t.graph.splice(t.graph.indexOf(this),1),this},this.replaceWith=function(){this._},this.mod=function(e,t,i,n){return this.mods.push({name:e,modulator:t,type:i||"+",mult:n||1}),this},this.removeMod=function(e){if(e)for(var t=this.mods.length-1;t>=0;t--){var i=this.mods[t];i.name===e&&this.mods.splice(t,1)}else this.mods=[]},this.ramp=function(e,t,i,n){3===arguments.length&&(n=i,i=t,t=this[e])
},this.spin=function(e,t,i){return 1===arguments.length?0!==e?this.mod("rotation",e):(this.removeMod("rotation",0),this.removeMod("rotation.x",0),this.removeMod("rotation.y",0),this.removeMod("rotation.z",0)):0===arguments.length?this.removeMod("rotation"):(0!==e?this.mod("rotation.x",e):this.removeMod("rotation.x"),0!==t?this.mod("rotation.y",t):this.removeMod("rotation.y"),0!==i?this.mod("rotation.z",i):this.removeMod("rotation.z")),this},arguments[0]&&(arguments[0].scale&&(this.scale=arguments[0].scale),arguments[0].rotation&&(this.scale=arguments[0].rotation),arguments[0].position&&(this.scale=arguments[0].position)),t.modes["3d"].obj.scene.add(this.mesh),t.graph.push(this),this.mappings=[],Object.defineProperty(this,"_",{get:function(){this.seq.isRunning&&this.seq.disconnect();for(var e=0;e<this.mappings.length;e++)this.mappings[e].remove();this.clearMarks&&this.clearMarks(),this.remove(),console.log(r+" is removed.")},set:function(){}}),Object.defineProperty(this,"color",{get:function(){return this.material.color},set:function(e){n.isArray(e)&&(e=Color().rgb(255*e[0],255*e[1],255*e[2]).hexString()),this.material.color.set(e)}}),this.toString=function(){return this.name},console.log(r+" is created.")};u[r]=function(){return e.construct(f,arguments)}}();return u.Knot=u.TorusKnot,u}},{}],60:[function(e,t){t.exports=function(e){"use strict";var t={Stripes:function(){var e=["varying vec2 p;","uniform float xCount;","uniform float yCount;","uniform float blend;","uniform sampler2D tDiffuse;","uniform vec3 colorX;","uniform vec3 colorY;","","void main() {","  vec3 color;","  float x = p.x * xCount;","  float y = p.y * yCount;","	 int stripeX = int(mod( x, 2.));","	 int stripeY = int(mod( y, 2.));","","  if( stripeX == 1 || stripeY == 1) {","    color = colorX;","  }else{","    color = vec3(0., 0., 0.);","  }","","  vec3 prev = texture2D( tDiffuse, p ).rgb;","  gl_FragColor = vec4( mix(color, prev, blend), 1. );","}"].join("\n"),t=Shader(e);return t.uniform("xCount",4,1,100,"float"),t.uniform("yCount",4,1,100,"float"),t.uniform("blend",0,1,0,"float"),t.uniforms.colorX={type:"c",value:{r:1,g:1,b:1}},t.uniforms.colorY={type:"c",value:{r:1,g:1,b:1}},Object.defineProperties(t,{colorX:{get:function(){return t.uniforms.colorX.value},set:function(e){t.uniforms.colorX.value=Color(e)}},colorY:{get:function(){return t.uniforms.colorY.value},set:function(e){t.uniforms.colorY.value=Color(e)}}}),t},Circles:function(){var e=["uniform float time;","uniform float thickness;","uniform float speed;","uniform float radius;","uniform float x;","uniform float y;","uniform sampler2D tDiffuse;","uniform vec3 color;","varying vec2 p;","","void main() {","  vec2 uv = 2. * p - 1.;","  float _speed = 20. * speed;","  float edgeDistance = radius * thickness;","  float dist = distance( p, vec2(x,y) );","  float growth = mod(time, 1.) / -_speed;","","  float moddist = mod( dist + growth, radius );","  float _out = smoothstep( moddist, moddist+edgeDistance, radius / 2. );","  _out += smoothstep( moddist, moddist-edgeDistance, radius / 2.);","","  gl_FragColor = vec4( vec3(1.- _out), 1. );","}"].join("\n"),t=Shader(e);t.uniform("blend",1,0,1,"float"),t.uniform("thickness",.1,0,1,"float"),t.uniform("x",.5,0,1,"float"),t.uniform("y",.5,0,1,"float"),t.uniform("speed",1,-1,1,"float"),t.uniform("radius",.05,0,1,"float"),t.uniforms.color={type:"c",value:{r:1,g:0,b:0}};var i=t.__lookupSetter__("speed"),n=t.__lookupGetter__("speed");return Object.defineProperties(t,{speed:{get:function(){return n()},set:function(e){e=e>0?1-e:-1-e,i(e)}}}),t},Pixellate:function(){var e=["uniform sampler2D tDiffuse;","uniform float amount;","uniform float blend;","varying vec2 vUv;","void main() {","	vec2 sd = vec2( amount );","	vec2 samplePos = vUv - mod( vUv, sd );","	vec4 p = texture2D( tDiffuse, samplePos );","	vec4 pp = texture2D( tDiffuse, vUv );","	vec3 _blend = (p.rgb * vec3( blend ) ) + ( pp.rgb * vec3(1.0 - blend ) );","	gl_FragColor = vec4( _blend, 1. );","}"].join("\n"),t=["varying vec2 vUv;","void main() {","	vUv = uv;","	gl_Position = vec4( position[0],position[1],position[2], 1.0 );","}"].join("\n"),i=Shader(e,t);return i.uniform("amount",.01,0,1,"float"),i.uniform("blend",1,0,1,"float"),i},"export":function(e){e.Pixellate=t.Pixellate,e.Stripes=t.Stripes,e.Circles=t.Circles}};return t}},{}],61:[function(e,t){t.exports=function(t){"use strict";var i=t.dollar,n={Color:e("color"),canvas:null,canvas2D:null,canvas3D:null,ctx:null,width:0,height:0,running:!1,resolution:1,fps:null,graph:[],initialized:!1,mode:null,defaultContainer:"#contentCell",THREE:e("../external/three/three.min"),"export":function(e){n.Geometry.export(e),n.modes["2d"].constructor.export(e),n.PostProcessing.export(e),n.GibberShaders.export(e),e.Video=n.Video,e.ShaderMaterial=n.Shaders.Material},getContainer:function(e){var t;return t="undefined"==typeof e||null===e?document.querySelector(null!==document.querySelector(n.defaultContainer)?n.defaultContainer:"body"):e.bodyElement},init:function(e,r){if("3d"===e&&!window.WebGLRenderingContext){var o="Your browser does not support WebGL. 2D drawing will work, but 3D geometries and shaders are not supported.";t.Environment.Message.post(o)}var a=this.mode;this.mode=e||"3d",null===this.modes[this.mode].canvas&&(this.modes[this.mode].obj=this.modes[this.mode].constructor(r)),null!==a&&"undefined"!=typeof a&&a!==this.mode&&this.modes[a].obj.hide(),this.modes[this.mode].obj.init&&this.modes[this.mode].obj.init(r),this.canvas=null!==this.modes[this.mode].canvas?this.modes[this.mode].canvas:this.modes[this.mode].canvas=this.modes[this.mode].obj.canvas,this.canvas.parent="undefined"==typeof r||null===r?document.querySelector(n.defaultContainer):r.bodyElement||r,this.positionCanvas(this.canvas),this.assignWidthAndHeight(!0),this.modes[this.mode].obj.setSize(this.width*this.resolution,this.height*this.resolution);var s=this.resolution,l=this;Object.defineProperty(this,"resolution",{get:function(){return s},set:function(e){s=e,l.assignWidthAndHeight()}});var u=!1;Object.defineProperty(this,"running",{get:function(){return u},set:function(e){e!==u&&(u===!0?(l.render(),u=e):(u=e,l.render()))}}),this.start(),"none"===i(this.canvas).css("display")?(console.log("toggling!"),i(this.canvas).css("display","block")):console.log("not hidden",i(this.canvas).css("display"));var c=function(e){n.width=e.w,n.height=e.h,n.modes["2d"].obj&&n.modes["2d"].obj.setSize(e.w,e.h),n.modes["3d"].obj&&n.modes["3d"].obj.setSize(e.w,e.h)};i.subscribe("/layout/contentResize",c),i.subscribe("/layout/resizeWindow",function(e){e.h-=i("thead").height(),e.h-=i("tfoot").height(),c(e)}),this.initialized=!0},positionCanvas:function(e){var t=document.querySelector("body"),i=e.parent===t;e.style.left=0,e.style.top=0,e.style.position=i?"fixed":"relative",e.style.float=i?"none":"left",e.style.overflow="hidden",e.style.display="block",i&&(t.style.margin=0)},start:function(){this.running=!0,window.requestAnimationFrame(this.render)},useCanvasAsTexture:function(e){var t=e.createSprite();n.initialized&&"2d"!==n.mode||n.init("3d"),n.modes["3d"].obj.scene.add(t),n.modes["2d"].obj.setupCameraAndLights(),n.graph.push(e)},clear:function(){if(this.running){for(var e=0;e<this.graph.length;e++)this.graph[e].remove(!0);this.graph.length=0;for(var t in this.modes){var i=this.modes[t];i.obj&&i.obj.remove()}if(this.PostProcessing){for(var n=this.PostProcessing.fx-1;n>=0;n--)this.PostProcessing.fx[n].remove();this.PostProcessing.fx.length=0,this.PostProcessing.isRunning=!1}if("3d"===this.mode)for(var e=0;e<this.modes["3d"].obj.scene.children.length;e++){var r=this.modes["3d"].obj.scene.children[e];this.modes["3d"].obj.scene.remove(r)}this.running=!1}},render:function(){if(this.running){for(var e=0;e<this.graph.length;e++)this.graph[e]._update(),this.graph[e].update();this.modes[this.mode].obj._update(),null===this.fps||this.fps>=55?window.requestAnimationFrame(this.render):setTimeout(function(){n.render()},1e3/this.fps)}},test:function(){var e=new n.THREE.CubeGeometry(50,50,50),t=new n.THREE.Color(0).setRGB(.5,0,0),i=new n.THREE.MeshPhongMaterial({color:t,shading:n.THREE.FlatShading,shininess:50}),r=new n.THREE.Mesh(e,i);return this.scene.add(r),this.graph.push(r),r},showStats:function(){this.stats=new Stats,this.stats.domElement.style.position="absolute",this.stats.domElement.style.top="0px",this.stats.domElement.style.right="0px",i("body").append(this.stats.domElement)},assignWidthAndHeight:function(e){var r=n.modes[this.mode].canvas,o=r.parentElement;n.width=o===document.querySelector("body")?o.offsetWidth:o.offsetWidth||o.width(),n.height=o===document.querySelector("body")?o.offsetHeight:i(i("#contentCell").children()[0]).height()||o.offsetHeight,null!==document.querySelector("#header")&&o===window&&null===t.Environment.Layout.fullScreenColumn,n.canvas.style.zIndex=-1,e||"2d"===n.mode||(n.modes["3d"].obj.renderer.setSize(n.width*n.resolution,n.height*n.resolution),n.modes["3d"].obj.renderer.domElement.style.width=n.width+"px",n.modes["3d"].obj.renderer.domElement.style.height=n.height+"px")}};return n.render=n.render.bind(n),n.modes={"2d":{constructor:e("./2d")(t,n),canvas:null,obj:null},"3d":{constructor:e("./3d")(t,n),canvas:null,obj:null}},n.Geometry=e("./geometry")(t,n,n.THREE),e("../external/three/postprocessing/EffectComposer"),e("../external/three/postprocessing/RenderPass"),e("../external/three/postprocessing/MaskPass"),e("../external/three/postprocessing/ShaderPass"),e("../external/three/postprocessing/CopyShader"),e("../external/three/postprocessing/shaders/DotScreenShader"),e("../external/three/postprocessing/DotScreenPass"),e("../external/three/postprocessing/FilmPass"),e("../external/three/postprocessing/shaders/FilmShader"),e("../external/three/postprocessing/shaders/KaleidoShader"),e("../external/three/postprocessing/shaders/EdgeShader"),e("../external/three/postprocessing/shaders/FocusShader"),e("../external/three/postprocessing/shaders/ShaderGodRays"),e("../external/three/postprocessing/shaders/BleachBypassShader"),e("../external/three/postprocessing/shaders/ColorifyShader"),n.PostProcessing=e("./postprocessing")(t,n),n.PostProcessing.init(),n.Shaders=e("./shader")(t,n),n.GibberShaders=e("./gibber_shaders")(t,n),n.Video=e("./video")(t,n),n}},{"../external/three/postprocessing/CopyShader":41,"../external/three/postprocessing/DotScreenPass":42,"../external/three/postprocessing/EffectComposer":43,"../external/three/postprocessing/FilmPass":44,"../external/three/postprocessing/MaskPass":45,"../external/three/postprocessing/RenderPass":46,"../external/three/postprocessing/ShaderPass":47,"../external/three/postprocessing/shaders/BleachBypassShader":48,"../external/three/postprocessing/shaders/ColorifyShader":49,"../external/three/postprocessing/shaders/DotScreenShader":50,"../external/three/postprocessing/shaders/EdgeShader":51,"../external/three/postprocessing/shaders/FilmShader":52,"../external/three/postprocessing/shaders/FocusShader":53,"../external/three/postprocessing/shaders/KaleidoShader":54,"../external/three/postprocessing/shaders/ShaderGodRays":55,"../external/three/three.min":56,"./2d":57,"./3d":58,"./geometry":59,"./gibber_shaders":60,"./postprocessing":62,"./shader":63,"./video":64,color:37}],62:[function(e,t){t.exports=function(e){"use strict";var t={Dots:{angle:{min:0,max:2*Math.PI,output:e.LINEAR,wrap:!0,timescale:"graphics"},scale:{min:0,max:1,output:e.LINEAR,timescale:"graphics"}},Film:{nIntensity:{min:0,max:1,output:e.LINEAR,timescale:"graphics"},sIntensity:{min:0,max:1,output:e.LINEAR,timescale:"graphics"},sCount:{min:0,max:2048,output:e.LINEAR,timescale:"graphics"}},Kaleidoscope:{angle:{min:0,max:2*Math.PI,output:e.LINEAR,wrap:!0,timescale:"graphics"},sides:{min:2,max:36,output:e.LINEAR,timescale:"graphics"}},Focus:{screenWidth:{min:0,max:1024,output:e.LINEAR,timescale:"graphics"},screenHeight:{min:0,max:1024,output:e.LINEAR,timescale:"graphics"},sampleDistance:{min:0,max:2,output:e.LINEAR,timescale:"graphics"},waveFactor:{min:0,max:.05,output:e.LINEAR,timescale:"graphics"}},Bleach:{opacity:{min:0,max:1,output:e.LINEAR,timescale:"graphics"}},Shader:{amp:{min:0,max:1,output:e.LINEAR,timescale:"graphics"},time:{min:0,max:1,output:e.LINEAR,timescale:"graphics"}}},i={Dots:{properties:{angle:.5,scale:.035,center:new THREE.Vector2(.5,.5)},type:"uniforms",init:function(e){var t=e.center?new THREE.Vector2(e.center[0],e.center[1]):new THREE.Vector2(.5,.5);return new THREE.DotScreenPass(t,e.angle,e.scale,e.mix)}},Film:{properties:{nIntensity:1,sIntensity:.5,sCount:1024,grayscale:!1,mix:1},type:"uniforms",init:function(e){return e=e||{},e.nIntensity=e.nIntensity||1,e.sIntensity=e.sIntensity||.5,e.sCount=e.sCount||1024,e.grayscale=e.grayscale||!1,e.mix=e.mix||1,new THREE.FilmPass(e.nIntensity,e.sIntensity,e.sCount,e.grayscale,e.mix)}},Kaleidoscope:{properties:{sides:6,angle:0},init:function(e){return e=e||{},e.sides=e.sides||6,e.angle=e.angle||0,new THREE.ShaderPass(THREE.KaleidoShader)}},Edge:{properties:{aspect:new THREE.Vector2(512,512)},init:function(e){return e=e||{},e.aspect=e.aspect||i.Edge.properties.aspect,new THREE.ShaderPass(THREE.EdgeShader)}},Focus:{properties:{screenWidth:1024,screenHeight:1024,sampleDistance:2,waveFactor:.1},init:function(){return new THREE.ShaderPass(THREE.FocusShader)}},Godrays:{properties:{},init:function(){return new THREE.ShaderPass(THREE.ShaderGodRays)}},Bleach:{properties:{opacity:1},init:function(){return new THREE.ShaderPass(THREE.BleachBypassShader)}},Colorify:{properties:{color:new THREE.Color(16711680)},init:function(e){e=e||{},console.log(e.color),e.color="string"==typeof e.color?new THREE.Color(Color(e.color).hexString()):i.Colorify.properties.color;var t=new THREE.ShaderPass(THREE.ColorifyShader);return t.uniforms.color.value=e.color,t}},Shader:{properties:{amp:.1,time:0},fragment:null,vertex:null,init:function(t,i){var r=null,o=null,a=null,s=null;return t&&"object"==typeof t?(o=t,t=n.defs+o.value):t=n.defs+t,i&&"object"==typeof i?(r=i,i=r.value):i&&(i=e.Graphics.PostProcessing.defs+i),s=e.Graphics.Shaders.make(t,i),null!==s&&(a=new THREE.ShaderPass(s)),null!==a&&(a.fragmentText=s.fragmentText,a.vertexText=s.vertexText,r&&(a.columnV=r,r.shader=a),o&&(a.columnF=o,o.shader=a)),a}}},n={"export":function(e){for(var t in i)e[t]=n[t]},composer:null,fx:[],isRunning:!1,defs:["#define PI 3.14159265358979323846264","float rand(vec2 co){","  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);","}"].join("\n"),start:function(){this.composer=new THREE.EffectComposer(e.Graphics.modes["3d"].obj.renderer),this.renderScene=new THREE.RenderPass(e.Graphics.modes["3d"].obj.scene,e.Graphics.modes["3d"].obj.camera),this.renderScene.clear=!0,this.renderScene.renderToScreen=!0,this.composer.addPass(this.renderScene),this.isRunning=!0},init:function(){for(var r in i)!function(){var a=r,s=i[r],l=t[r],u=function(){null===e.Graphics.canvas||"none"===$(e.Graphics.canvas).css("display")?e.Graphics.init("3d"):"2d"===e.Graphics.mode&&e.Graphics.useCanvasAsTexture(e.Graphics.modes["2d"].obj.canvasObject),e.Graphics.running=!0;var i;if("Shader"!==a){var r=Array.prototype.slice.call(arguments,0);i=s.init.call(s,r)}else i=s.init(arguments[0],arguments[1]);if(e.createProxyProperties(i,{}),i.uniform=function(n,r,a,s,l,u){a=null==a?0:a,s=null==s?1:s,r=null==r?a+(s-a)/2:r,u=null==u?!0:u,"undefined"==typeof i.mappingProperties[n]&&(t[n]=i.mappingProperties[n]={min:a,max:s,value:r,output:e.LINEAR,timescale:"graphics"});var c=o(r,l,n),h=(c[0],c[1]),f=c[2];if("undefined"==typeof i.uniforms[n]&&i.columnF&&u){var p=f;p+=i.columnF.editor.getValue(),i.columnF.editor.setValue(p)}return i.uniforms[n]={type:h,value:r},Object.defineProperty(i,n,{configurable:!0,get:function(){return i.uniforms[n].value},set:function(e){return i.uniforms[n].value=e}}),i.uniforms[n].value=r,i[n]=r,e.createProxyProperty(i,n,!0),i},i.uniformNoCodeGen=function(){var e=Array.prototype.slice.call(arguments,0);return console.log("NO OCDEGEN",e[1]||null),i.uniform(e[0],e[1]||null,e[2]||null,e[3]||null,e[4]||null,!1)},null===i)return void console.log("SHADER ERROR... aborting");n.isRunning||n.start(),i.renderToScreen=!0,i.name=a,i.sequencers=[],n.fx.length>0&&(n.fx[n.fx.length-1].renderToScreen=!1),n.composer.addPass(i),n.fx.push(i),n.defineProperties(i);for(var u in l){var c=l[u];i.uniform(u,i[u],c.min,c.max,i.uniforms[u].type)}return $.extend(i,n.shader),e.Graphics.graph.push(i),i.update=function(){},i._update=function(){for(var e=0;e<i.mods.length;e++){var t=i.mods[e],n=i[t.name],r=t.name;switch(r=r.charAt(0).toUpperCase()+r.substr(1),Array.isArray(n)&&(n=n[0]),t.type){case"+":i[r].value="number"==typeof t.modulator?n+t.modulator:n+t.modulator.getValue()*t.mult;break;case"++":i[r].value="number"==typeof t.modulator?n+t.modulator:n+Math.abs(t.modulator.getValue()*t.mult);break;case"-":i[r].value="number"==typeof t.modulator?n-t.modulator:n-t.modulator.getValue()*t.mult;break;case"=":i[r].value="number"==typeof t.modulator?t.modulator:t.modulator.getValue()*t.mult}i[r].oldSetter.call(this,i[r].value)}"undefined"!=typeof i.time&&(i.time+=1/60),i.update()},i.mods=[],i.mod=function(e,t,i,n){this.mods.push({name:e,modulator:t,type:i||"+",mult:n||1})},i.removeMod=function(e){if(e)for(var t=0;t<this.mods.length;t++){var i=this.mods[t];if(i.name===e){this.mods.splice(t,1);break}}},i.replaceWith=function(e){for(var t=0;t<this.sequencers.length;t++)this.sequencers[t].target=e,e.sequencers.push(this.sequencers[t]);for(var t=0;t<this.mappingObjects.length;t++){var i=this.mappingObjects[t];if(i.targets.length>0)for(var n=0;n<i.targets.length;n++){var r=i.targets[n];e.mappingProperties[i.name]?r[0].mapping.replace(e,i.name,i.Name):r[0].mapping.remove()}}this.remove()},i.properties=s.properties,e.processArguments2(i,Array.prototype.slice.call(arguments,0),i.name),i.mappings=[],Object.defineProperty(i,"_",{get:function(){i.seq.isRunning&&i.seq.disconnect();for(var e=0;e<i.mappings.length;e++)i.mappings[e].remove();i.clearMarks&&i.clearMarks(),i.remove()},set:function(){}}),i};n[a]=u}()},defineProperties:function(e){for(var t in i[e.name].properties)!function(){var n=t,r=i[e.name].properties[n];Object.defineProperty(e,n,{configurable:!0,get:function(){return r},set:function(t){r=t,e.uniforms[n].value=r}})}(e)},shader:{remove:function(){n.composer.passes.splice(n.composer.passes.indexOf(this),1),n.fx.splice(n.fx.indexOf(this),1),n.fx.length>0&&(n.fx[n.fx.length-1].renderToScreen=!0);for(var e in this.mappingProperties){var t=e.charAt(0).toUpperCase()+e.slice(1);"object"==typeof this[t].mapping&&this[t].mapping.remove()}}}},r={vec2:"v2",vec3:"v3",vec4:"v4","int":"i","float":"f"},o=function(e,t,i){var n=null,o=null,a="",s=!1;if(t){if(t in r)n=t;else for(var l in r)if(r[l]===t){n=l;break}}else if(console.log("INSIDE ARRAY CHECK",e),Array.isArray(e)){var u=e[0],c=u.shaderType||typeof u;if("number"===c){var h=u%1===0;h&&(h=e.every(function(e){return e%1===0})),n=h?"int":"float"}else n=c;s=!0}else"object"==typeof e?n=e.shaderType||"float":(n=typeof e,"number"===n&&(n=e%1===0?"int":"float"));console.log("shaderInfo",s,h,n),a="uniform "+n+" "+i,a+=s?"["+e.length+"];\n":";\n",o=r[n],s&&(o+=n.indexOf("vec")>-1?"v":"v1");var f=[n,o,a];return f};return n}},{}],63:[function(e,t){t.exports=function(e,t){var i=(e.Graphics,{make:function(e,t){var n={uniforms:{tDiffuse:{type:"t",value:null},amp:{type:"f",value:0},time:{type:"f",value:0}},fragmentShader:e||i.defaultFragment,vertexShader:t||i.defaultVertex};return n},defaultFragment:["uniform float amp;","uniform sampler2D tDiffuse;","uniform float time;","varying vec2 p;","","void main() {","  gl_FragColor = texture2D( tDiffuse, p ).rgba;","}"].join("\n"),defaultVertex:["varying vec2 p;","void main() {","p = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),Material:function(n,r){var o={},a="object"==typeof n?n.value:n,s="object"==typeof r?r.value:r,l={uniforms:{tDiffuse:{type:"t",value:null},amp:{type:"f",value:0},time:{type:"f",value:0}},fragmentShader:a||i.defaultFragment,vertexShader:s||i.defaultVertex};l.fragmentShader=t.PostProcessing.defs+l.fragmentShader,e.Graphics.running?"2d"===e.Graphics.mode&&e.Graphics.use("3d"):e.Graphics.init("3d");var u=new THREE.ShaderMaterial(l);"object"==typeof n&&(n.shader=o),"object"==typeof r&&(r.shader=o),o.fragmentText=u.fragmentShader,o.vertexText=u.vertexShader,Object.defineProperty(o,"material",{get:function(){return u},set:function(e){u=e,this.target&&(this.target.mesh.material=u)}});var c=null;Object.defineProperty(o,"target",{get:function(){return c},set:function(e){c=e,c.mesh&&(c.mesh.material=this.material,c.mesh.material.needsUpdate=!0)}}),t.graph.push(o),o.update=function(){};o._update=function(){for(var e=0;e<o.mods.length;e++){var t=o.mods[e],i=o[t.name],n=t.name;switch(n=n.charAt(0).toUpperCase()+n.substr(1),Array.isArray(i)&&(i=i[0]),t.type){case"+":o[n].value="number"==typeof t.modulator?i+t.modulator:i+t.modulator.getValue()*t.mult;break;case"++":o[n].value="number"==typeof t.modulator?i+t.modulator:i+Math.abs(t.modulator.getValue()*t.mult);break;case"-":o[n].value="number"==typeof t.modulator?i-t.modulator:i-t.modulator.getValue()*t.mult;break;case"=":o[n].value="number"==typeof t.modulator?t.modulator:t.modulator.getValue()*t.mult}o[n].oldSetter.call(this,o[n].value)}o.update()},o.mods=[],o.mod=function(e,t,i,n){this.mods.push({name:e,modulator:t,type:i||"+",mult:n||1})},o.removeMod=function(e){if(e)for(var t=0;t<this.mods.length;t++){var i=this.mods[t];if(i.name===e){this.mods.splice(t,1);break}}},o.remove=function(){},o.uniforms=l.uniforms;var h=o.mappingProperties={amp:{min:0,max:1,value:1,output:e.LINEAR,timescale:"graphics"},time:{min:0,max:1,value:0,output:e.LINEAR,timescale:"graphics"}};o.mappingObjects=[],o.uniform=function(t,i,n,r){return n=isNaN(n)?0:n,r=isNaN(r)?1:r,i=isNaN(i)?n+(r-n)/2:i,"undefined"==typeof o.mappingProperties[t]&&(h[t]=o.mappingProperties[t]={min:n,max:r,output:e.LINEAR,timescale:"graphics"}),"undefined"==typeof o.uniforms[t]&&(o.uniforms[t]={type:"f",value:i}),Object.defineProperty(o,t,{configurable:!0,get:function(){return i},set:function(e){i=e,o.material.uniforms[t].value=e}}),e.createProxyProperty(o,t),o.material.uniforms[t].value=i,o[t.charAt(0).toUpperCase()+t.slice(1)].timescale="graphics",o};for(var f in h){var p=h[f];o.uniform(f,p.value,p.min,p.max)}return o}});return i}},{}],64:[function(e,t){t.exports=function(e,t){"use strict";navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,URL=URL||webkitURL;var i,n,r=null,o=function(){return null!==r?r:("undefined"==typeof i?(n=document.createElement("video"),n.width=320,n.height=240,n.autoplay=!0):console.log("NO VIDEO MADE"),null===r&&(navigator.getUserMedia({video:!0,audio:!1},function(e){n.stream=e.getTracks()[0],n.src=URL.createObjectURL(e)},function(e){console.log("Failed to get a stream due to",e)}),r=new t.THREE.Texture(n),r.video=n,r.remove=function(){t.graph.splice(t.graph.indexOf(r),1),r=null,n.stream.stop()},r.stop=function(){t.graph.splice(t.graph.indexOf(r),1),n.stream.stop(),r=null},r.update=function(){},r._update=function(){n.readyState===n.HAVE_ENOUGH_DATA&&(r.needsUpdate=!0)},t.graph.push(r)),r)};return o}},{}],65:[function(e,t){!function(){function i(e){return 0>e?-1:1}var n=e("jquery"),r={extend:function(e,t){for(var i in t){{i.split(".")}e[i]=t[i]instanceof Array&&t[i].length<100?t[i].slice(0):t[i]}return e},isAndroid:function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("android")>-1}(),keyCodeToChar:{8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause/Break",20:"Caps Lock",27:"Esc",32:"Space",33:"Page Up",34:"Page Down",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",91:"Windows",93:"Right Click",96:"Numpad 0",97:"Numpad 1",98:"Numpad 2",99:"Numpad 3",100:"Numpad 4",101:"Numpad 5",102:"Numpad 6",103:"Numpad 7",104:"Numpad 8",105:"Numpad 9",106:"Numpad *",107:"Numpad +",109:"Numpad -",110:"Numpad .",111:"Numpad /",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"Num Lock",145:"Scroll Lock",182:"My Computer",183:"My Calculator",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},panels:[],mouseDown:!1,useTouch:"ontouchstart"in document.documentElement,widgets:[]};r.Presets={dictionary:"undefined"==typeof localStorage.interfacejs?{}:JSON.parse(localStorage.interfacejs),save:function(e){for(var t=[],i=0;i<r.panels.length;i++){var n=r.panels[i];t[i]=[];for(var o=0;o<n.children.length;o++){var a=n.children[o];if("object"==typeof a.children){for(var s=[],l=0;l<a.children.length;l++)s[l]=a.children[l].value;t[i][o]=s}else t[i][o]=a.value}this.dictionary[e]=t,localStorage.interfacejs=JSON.stringify(this.dictionary)}},load:function(e){for(var t=this.dictionary[e],i=0;i<r.panels.length;i++)for(var n=r.panels[i],o=0;o<n.children.length;o++){var a=n.children[o];if("object"==typeof a.children)for(var s=0;s<a.children.length;s++)a.children[s].setValue(t[i][o][s]);else a.setValue(t[i][o])}},list:function(){return Object.keys(this.dictionary)}},r.Panel=function(){var e=this,t=arguments.length>=1?arguments[0].container:void 0;r.extend(this,{type:"Panel",active:!0,children:[],shouldDraw:[],fps:30,useRelativeSizesAndPositions:!0,labelSize:"12px",font:"normal 12px Helvetica",serializeMe:["fps","useRelativeSizesAndPositions","labelSize","font","background","fill","stroke","backgroundColor"],container:function(){if("undefined"==typeof t){n("body").css({margin:0,padding:0});var e=n('<div id="container">');return e.css({width:n(window).width(),height:n(window).height(),display:"block",margin:0,padding:0,position:"absolute",left:0,top:0}),n("body").append(e),e}return t}(),canvas:document.createElement("canvas"),touchEvent:function(t){if(e.active){console.log(t),"undefined"==typeof t.changedTouches&&t.originalEvent&&(t.changedTouches=t.originalEvent.changedTouches);for(var i=0;i<t.changedTouches.length;i++)for(var n=t.changedTouches.item(i),r=0;r<e.children.length;r++)n.x=n.pageX-e.x,n.y=n.pageY-e.y,n.type=t.type,e.children[r].touchEvent(n);t.preventDefault()}},mouseEvent:function(t){if(e.active){"mousedown"===t.type?r.mouseDown=!0:"mouseup"===t.type&&(r.mouseDown=!1);for(var i={x:t.offsetX||t.pageX-e.x,y:t.offsetY||t.pageY-e.y,type:t.type},n=0;n<e.children.length;n++)e.children[n].mouseEvent(i)}},init:function(){var e=n(this.container).offset();this.width=n(this.container).width(),this.height=n(this.container).height(),this.x=e.left,this.y=e.top,isNaN(this.x)&&(this.x=0),isNaN(this.y)&&(this.y=0),n(this.canvas).attr({width:this.width,height:this.height}),n(this.container).css({"user-select":"none","-webkit-user-select":"none"}),n(this.container).append(this.canvas),this.ctx=this.canvas.getContext("2d"),this.ctx.translate(.5,.5),this.ctx.lineWidth=1,r.useTouch?(n(this.container).on("touchstart",this.touchEvent),n(this.container).on("touchmove",this.touchEvent),n(this.container).on("touchend",this.touchEvent)):(n(this.container).on("mousedown",this.mouseEvent),n(this.container).on("mousemove",this.mouseEvent),n(this.container).on("mouseup",this.mouseEvent)),n(this.container).css({outline:"none"}),n(this.container).attr("tabindex",5),n(this.container).on("keydown",this.keydown.bind(this)),n(this.container).on("keyup",this.keyup.bind(this))},keydown:function(e){for(var t=0;t<this.children.length;t++)this.children[t].onkeydown&&this.children[t].onkeydown(e)},keyup:function(e){for(var t=0;t<this.children.length;t++)this.children[t].onkeyup&&this.children[t].onkeyup(e)},draw:function(){if(this.active){for(var e=0;e<this.shouldDraw.length;e++)this.shouldDraw[e].draw();this.shouldDraw.length=0}},getWidgetWithName:function(e){for(var t=0;t<this.children.length;t++)if(this.children[t].name===e)return this.children[t]},redoBoundaries:function(){var e=n(this.container).offset();this.width=n(this.container).width(),this.height=n(this.container).height(),this.x=e.left,this.y=e.top,isNaN(this.x)&&(this.x=0),isNaN(this.y)&&(this.y=0),n(this.canvas).attr({width:this.width,height:this.height}),this.ctx.translate(.5,.5),this.ctx.lineWidth=1,this.refresh()},refresh:function(){if(this.active){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);for(var e=0;e<this.children.length;e++)this.children[e].draw()}},add:function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];t.panel=this,t.canvas=this.canvas,t.container=this.container,t.ctx=this.ctx,this.children.push(t),t._init&&!t.added&&t._init(),t.oninit&&!t.added&&t.oninit(),t.draw(),t.added=!0,"function"==typeof t.add&&t.add()}},clear:function(){this.ctx.clearRect(0,0,this.width,this.height),this.children.length=0},remove:function(e){if(this.ctx.clearRect(e._x(),e._y(),e._width(),e._height()),"undefined"!=typeof e.children&&"XY"!==e.type)for(var t=0;t<e.children.length;t++)this.children.splice(this.children.indexOf(e.children[t]),1),r.widgets.splice(r.widgets.indexOf(e.children[t]),1);else this.children.indexOf(e)>-1&&(this.children.splice(this.children.indexOf(e),1),r.widgets.splice(r.widgets.indexOf(e),1),"function"==typeof e.remove&&e.remove())}}),"undefined"!=typeof arguments[0]&&r.extend(this,arguments[0]),this.backgroundColor&&this.setBackgroundColor(this.backgroundColor),this.init(),this.timer=setInterval(function(){e.draw()},Math.round(1e3/this.fps));var i="#000",o="#666",a="#999",s="transparent",e=this,l=this.useRelativeSizesAndPositions;Object.defineProperties(this,{useRelativeSizesAndPositions:{get:function(){return l},set:function(e){if(e!==l)if(l=e,e===!1)for(var t=0;t<this.children.length;t++){var i=this.children[t];i.bounds=[Math.round(i.x*this.width),Math.round(i.y*this.height),Math.round(i.width*this.width),Math.round(i.height*this.height)]}else for(var t=0;t<this.children.length;t++){var i=this.children[t];i.bounds=[i.x/this.width,i.y/this.height,i.width/this.width,i.height/this.height]}this.refresh()}},background:{get:function(){return s},set:function(e){s=e,n(this.container).css({backgroundColor:s})}},childBackground:{get:function(){return i},set:function(t){i=t,e.refresh()}},childStroke:{get:function(){return a},set:function(t){a=t,e.refresh()}},childFill:{get:function(){return o},set:function(t){o=t,e.refresh()}}}),arguments[0]&&(arguments[0].childBackground&&(this.childBackground=arguments[0].childBackground),arguments[0].childFill&&(this.childFill=arguments[0].childFill),arguments[0].childStroke&&(this.childStroke=arguments[0].childStroke)),r.panels.push(this)};var o=function(e){switch(e){case"mousedown":return"touchmousedown";case"mousemove":return"touchmousemove";case"mouseup":return"touchmouseup";default:return e}},a=function(e){switch(e){case"touchstart":return"touchmousedown";case"touchmove":return"touchmousemove";case"touchend":return"touchmouseup";default:return e}},s=0,l={hasFocus:!1,requiresFocus:!0,min:0,max:1,value:0,lastValue:null,name:null,events:{ontouchstart:null,ontouchmove:null,ontouchend:null,onmousedown:null,onmousemove:null,onmouseup:null,ontouchmousedown:null,ontouchmousemove:null,ontouchmouseup:null,onvaluechange:null,onboundschange:null}};r.Widget={init:function(e){this.added=!1,r.extend(this,l),"undefined"==typeof e&&(e={}),this.name=e.name||this.type+"_"+s++,this.target="OSC",this.key="/"+this.name,r.extend(this,e),this.bounds&&(this.x=e.bounds[0],this.y=e.bounds[1],this.width=e.bounds[2],this.height=e.bounds[3]),this.colors&&(this.background=e.colors[0],this.fill=e.colors[1],this.stroke=e.colors[2]),this.focusedTouches=[],this.value&&this.setValue(this.value,!0);{var t=this.bounds||[this.x,this.y,this.width,this.height],i=this.x,n=this.y,o=this.width,a=this.height;this.value}Object.defineProperties(this,{bounds:{configurable:!0,get:function(){return t
},set:function(e){t=e,this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3],this.onboundschange&&this.onboundschange()}},x:{configurable:!0,get:function(){return i},set:function(e){this.clear(),i=e,this.onboundschange&&this.onboundschange(),this.refresh()}},y:{configurable:!0,get:function(){return n},set:function(e){this.clear(),n=e,this.onboundschange&&this.onboundschange(),this.refresh()}},width:{configurable:!0,get:function(){return o},set:function(e){this.clear(),o=e,this.onboundschange&&this.onboundschange(),this.refresh()}},height:{configurable:!0,get:function(){return a},set:function(e){this.clear(),a=e,this.onboundschange&&this.onboundschange(),this.refresh()}}}),r.widgets.push(this)},clear:function(){this.panel&&this.panel.ctx.clearRect(this._x(),this._y(),this._width(),this._height())},refresh:function(){this.panel&&-1===this.panel.shouldDraw.indexOf(this)&&this.panel.shouldDraw.push(this)},setValue:function(e,t){var i=this.max-this.min,n=e;this.value=e,0!==this.min||1!==this.max?(n-=this.min,this._value=n/i):this._value=this.value,t||this.refresh()},hitTest:function(e){return e.x>=this._x()&&e.x<=this._x()+this._width()&&e.y>=this._y()&&e.y<=this._y()+this._height()?!0:!1},mouseEvent:function(e){var t=this.hitTest(e),i=o(e.type);(t||this.hasFocus||!this.requiresFocus)&&("mousedown"===e.type&&(this.hasFocus=!0),this[e.type]&&this[e.type](e,t),this["on"+e.type]&&this["on"+e.type](e,t),this["on"+i]&&this["on"+i](e,t)),"mouseup"===e.type&&(this.hasFocus=!1)},touchEvent:function(e){var t=this.hitTest(e),i=a(e.type);if((t||this.hasFocus||!this.requiresFocus)&&("touchstart"===e.type&&(this.focusedTouches.push(e),this.hasFocus=!0),this[e.type]&&this[e.type](e,t),this["on"+e.type]&&this["on"+e.type](e,t),this["on"+i]&&this["on"+i](e,t)),"touchend"===e.type)for(var n=0;n<this.focusedTouches.length;n++)if(this.focusedTouches[n].id===e.id){this.focusedTouches.splice(n,1),0===this.focusedTouches.length&&(this.hasFocus=!1);break}},draw:function(){},sendTargetMessage:function(){if(this.target&&this.key)if("OSC"===this.target){if(r.OSC)if("undefined"==typeof this.values){var e="string"==typeof this.value?"s":"f";r.OSC.send(this.key,e,[this.value])}else if("undefined"==typeof this.sendValues){for(var e="",t=0;t<this.values.length;t++)e+="string"==typeof this.value?"s":"f";r.OSC.send(this.key,e,this.values)}else this.sendValues()}else"MIDI"===this.target?r.MIDI&&"undefined"==typeof this.values&&r.MIDI.send(this.key[0],this.key[1],this.key[2],this.value):"function"==typeof this.target[this.key]?this.target[this.key](this.values||this.value):this.target[this.key]=this.values||this.value},_background:function(){return this.background||this.panel.childBackground},_stroke:function(){return this.stroke||this.panel.childStroke},_fill:function(){return this.fill||this.panel.childFill},_x:function(){return this.panel.useRelativeSizesAndPositions?Math.floor(this.x*this.panel.width):this.x},_y:function(){return this.panel.useRelativeSizesAndPositions?Math.floor(this.y*this.panel.height):this.y},_width:function(){return this.panel.useRelativeSizesAndPositions?Math.floor(this.width*this.panel.width):this.width},_height:function(){return this.panel.useRelativeSizesAndPositions?Math.floor(this.height*this.panel.height):this.height},_font:function(){var e=this.font||this.panel.font;return e},label:null,_serializeMe:["background","stroke","fill","x","y","width","height","value","label","onmousedown","onmousemove","onmouseup","ontouchmousedown","ontouchmousemove","ontouchmouseup","ontouchstart","ontouchmove","ontouchend","onvaluechange","name","type","target","key"]},r.Slider=function(){r.extend(this,{type:"Slider",isVertical:!0,serializeMe:["isVertical"],draw:function(){var e=this._x(),t=this._y(),i=this._width(),n=this._height();this.ctx.fillStyle=this._background(),this.ctx.fillRect(e,t,i,n),this.ctx.fillStyle=this._fill(),this.isVertical?this.ctx.fillRect(e,t+n-this._value*n,i,this._value*n):this.ctx.fillRect(e,t,i*this._value,n),this.label&&(this.ctx.fillStyle=this._stroke(),this.ctx.textBaseline="middle",this.ctx.textAlign="center",this.ctx.font=this._font(),this.ctx.fillText(this.label,e+i/2,t+n/2)),this.ctx.strokeStyle=this._stroke(),this.ctx.strokeRect(e,t,i,n)},changeValue:function(e,t){(this.hasFocus||!this.requiresFocus)&&(this._value=this.isVertical?1-t/this._height():e/this._width(),this._value<0?this._value=0:this._value>1&&(this._value=1),this.value=this.min+(this.max-this.min)*this._value,this.value!==this.lastValue&&(this.sendTargetMessage(),this.onvaluechange&&this.onvaluechange(),this.refresh(),this.lastValue=this.value))},mousedown:function(e,t){t&&r.mouseDown&&this.changeValue(e.x-this._x(),e.y-this._y())},mousemove:function(e,t){t&&r.mouseDown&&this.changeValue(e.x-this._x(),e.y-this._y())},mouseup:function(e,t){t&&r.mouseDown&&this.changeValue(e.x-this._x(),e.y-this._y())},touchstart:function(e,t){t&&this.changeValue(e.x-this._x(),e.y-this._y())},touchmove:function(e,t){t&&this.changeValue(e.x-this._x(),e.y-this._y())},touchend:function(e,t){t&&this.changeValue(e.x-this._x(),e.y-this._y())}}).init(arguments[0])},r.Slider.prototype=r.Widget,r.Crossfader=function(){r.extend(this,{type:"Crossfader",crossfaderWidth:30,serializeMe:["crossfaderWidth"],_value:.5,draw:function(){var e=this._x(),t=this._y(),i=this._width(),n=this._height();this.ctx.fillStyle=this._background(),this.ctx.fillRect(e,t,i,n),this.ctx.fillStyle=this._fill(),this.ctx.fillRect(e+(i-this.crossfaderWidth)*this._value,t,this.crossfaderWidth,n),this.ctx.strokeStyle=this._stroke(),this.ctx.strokeRect(e,t,i,n)},changeValue:function(e){(this.hasFocus||!this.requiresFocus)&&(this._value=e/this._width(),this._value<0?this._value=0:this._value>1&&(this._value=1),this.value=this.min+(this.max-this.min)*this._value,this.value!==this.lastValue&&(this.sendTargetMessage(),this.onvaluechange&&this.onvaluechange(),this.refresh(),this.lastValue=this.value))},mousedown:function(e){this.changeValue(e.x-this._x(),e.y-this._y())},mousemove:function(e){this.changeValue(e.x-this._x(),e.y-this._y())},mouseup:function(e){this.changeValue(e.x-this._x(),e.y-this._y())},touchstart:function(e,t){t&&this.changeValue(e.x-this._x(),e.y-this._y())},touchmove:function(e,t){t&&this.changeValue(e.x-this._x(),e.y-this._y())},touchend:function(e,t){t&&this.changeValue(e.x-this._x(),e.y-this._y())}}).init(arguments[0])},r.Crossfader.prototype=r.Widget,r.Button=function(){r.extend(this,{type:"Button",_value:0,serializeMe:["mode","label"],mode:"toggle",isMouseOver:!1,isTouchOver:!1,label:null,requiresFocus:!1,draw:function(){var e=this._x(),t=this._y(),i=this._width(),n=this._height();this.ctx.fillStyle=this._value?this._fill():this._background(),this.ctx.fillRect(e,t,i,n),null!==this.label&&(this.ctx.fillStyle=this._stroke(),this.ctx.textBaseline="middle",this.ctx.textAlign="center",this.ctx.font=this._font(),this.ctx.fillText(this.label,e+i/2,t+n/2)),this.ctx.strokeStyle=this._stroke(),this.ctx.strokeRect(e,t,i,n)},changeValue:function(){(this.hasFocus||!this.requiresFocus)&&(this._value=!this._value,this.value=this._value?this.max:this.min,(this.value!==this.lastValue||"contact"===this.mode)&&(this.sendTargetMessage(),this.onvaluechange&&this.onvaluechange(),this.draw(),this.lastValue=this.value))},setValue:function(e,t){var i=this.max-this.min,n=e;this.value=e,0!==this.min||1!==this.max?(n-=this.min,this._value=n/i):this._value=this.value,this.lastValue=this.value,t||"contact"===this.mode||this.refresh()},mousedown:function(e,t){if(t&&r.mouseDown&&(this.isMouseOver=!0,this.changeValue(),"contact"===this.mode)){var i=this;setTimeout(function(){i._value=0,i.draw()},75)}},mousemove:function(e,t){if(!this.requiresFocus&&t&&r.mouseDown&&!this.isMouseOver)if(this.isMouseOver=!0,"contact"!==this.mode)this.changeValue();else{this._value=1,this.draw();var i=this;setTimeout(function(){i._value=0,i.draw()},75)}else!t&&this.isMouseOver&&(console.log("moved off!"),this.isMouseOver=!1)},mouseup:function(){"momentary"===this.mode&&(this.changeValue(),this.isMouseOver=!1)},touchstart:function(e,t){if(t&&(this.isTouchOver=!0,this.changeValue(),"contact"===this.mode)){var i=this;setTimeout(function(){i._value=0,i.draw()},75)}},touchmove:function(e,t){if(this.requiresFocus||!t||this.isTouchOver)!t&&this.isTouchOver&&(this.isTouchOver=!1);else if(this.isTouchOver=!0,"contact"!==this.mode)this.changeValue();else{this._value=1,this.draw();var i=this;setTimeout(function(){i._value=0,i.draw()},75)}},touchend:function(){this.isTouchOver=!1,"momentary"===this.mode&&this.changeValue()}}).init(arguments[0])},r.Button.prototype=r.Widget,r.ButtonV=function(){r.extend(this,{type:"ButtonV",_value:0,serializeMe:["mode","label"],mode:"toggle",isMouseOver:!1,isTouchOver:!1,label:null,points:[{x:0,y:0},{x:0,y:1},{x:1,y:1},{x:1,y:0},{x:0,y:0}],textLocation:{x:.5,y:.5},draw:function(){var e=this._x(),t=this._y(),i=0,n=this._width(),r=this._height();for(this.ctx.fillStyle=this._value?this._fill():this._background(),this.ctx.beginPath(),this.ctx.strokeStyle=this._stroke(),i;i<this.points.length;i++)0===i?this.ctx.moveTo(e+this.points[i].x*n,t+this.points[i].y*r):this.ctx.lineTo(e+this.points[i].x*n,t+this.points[i].y*r);this.ctx.lineTo(e+this.points[0].x*n,t+this.points[0].y*r),this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke(),null!==this.label&&(this.ctx.fillStyle=this._stroke(),this.ctx.textBaseline="middle",this.ctx.textAlign="center",this.ctx.font=this._font(),this.ctx.fillText(this.label,e+n*this.textLocation.x,t+r*this.textLocation.y))},changeValue:function(){(this.hasFocus||!this.requiresFocus)&&(this._value=!this._value,this.value=this._value?this.max:this.min,(this.value!==this.lastValue||"contact"===this.mode)&&(this.sendTargetMessage(),this.onvaluechange&&this.onvaluechange(),this.draw(),this.lastValue=this.value))},hitTest:function(e){var t=this._width(),i=this._height(),n=this._x(),r=this._y();if(e.x>=n&&e.x<=n+t&&e.y>=r&&e.y<=r+i){var o=0,a=this.points,s=0;for(o;o<a.length-1;o++)if(a[o+1].x>a[o].x){if(a[o].x*t+n<=e.x&&e.x<a[o+1].x*t+n){var l=(a[o+1].y-a[o].y)/(a[o+1].x-a[o].x)*i/t*(e.x-a[o].x*t+n)+a[o].y*i+r;l-e.y<0&&s++}}else if(a[o+1].x<a[o].x&&a[o].x*t+n>=e.x&&e.x>a[o+1].x*t+n){var l=(a[o+1].y-a[o].y)/(a[o+1].x-a[o].x)*i/t*(e.x-a[o].x*t+n)+a[o].y*i+r;l-e.y<0&&s++}if(s%2==1)return!0}return!1},setValue:function(e,t){var i=this.max-this.min,n=e;this.value=e,0!==this.min||1!==this.max?(n-=this.min,this._value=n/i):this._value=this.value,this.lastValue=this.value,t||"contact"===this.mode||this.refresh()},mousedown:function(e,t){if(t&&r.mouseDown&&(this.isMouseOver=!0,this.changeValue(),"contact"===this.mode)){var i=this;setTimeout(function(){i._value=0,i.draw()},75)}},mousemove:function(e,t){if(!this.requiresFocus&&t&&r.mouseDown&&!this.isMouseOver)if(this.isMouseOver=!0,"contact"!==this.mode)this.changeValue();else{this._value=1,this.draw();var i=this;setTimeout(function(){i._value=0,i.draw()},75)}else if(!t&&this.isMouseOver)if(this.isMouseOver=!1,"contact"!==this.mode)this.changeValue();else{this._value=1,this.draw();var i=this;setTimeout(function(){i._value=0,i.draw()},75)}},mouseup:function(){"momentary"===this.mode&&(this.requiresFocus||!this.requiresFocus&&this.isMouseOver)&&(this.isMouseOver=!1,this.changeValue())},touchstart:function(e,t){if(t&&(this.isTouchOver=!0,this.changeValue(),"contact"===this.mode)){var i=this;setTimeout(function(){i._value=0,i.draw()},75)}},touchmove:function(e,t){if(this.requiresFocus||!t||this.isTouchOver)if(!t&&this.isTouchOver)if(this.isTouchOver=!1,"contact"!==this.mode)this.changeValue();else{this._value=1,this.draw();var i=this;setTimeout(function(){i._value=0,i.draw()},75)}else!t&&this.isTouchOver&&(this.isTouchOver=!1);else if(this.isTouchOver=!0,"contact"!==this.mode)this.changeValue();else{this._value=1,this.draw();var i=this;setTimeout(function(){i._value=0,i.draw()},75)}},touchend:function(){this.isTouchOver=!1,(this.requiresFocus||!this.requiresFocus&&this.isTouchOver)&&(this.isTouchOver=!1,this.changeValue())}}).init(arguments[0])},r.ButtonV.prototype=r.Widget,r.Piano=function(){r.extend(this,{type:"Piano",_value:0,serializeMe:["mode","label"],mode:"toggle",isMouseOver:!1,isTouchOver:!1,label:null,startletter:"C",startoctave:3,endletter:"C",endoctave:5,target:null,noteLabels:!1,_initialized:!1,keyMap:["Z","S","X","D","C","V","G","B","H","N","J","M",","],children:[],play:function(e,t){isNaN(t)&&(t=4410),"undefined"!=typeof Gibber&&(t=Gibber.Clock.time(t));var i=this.children[e];i&&(i.changeValue(),future(function(){1==i._value&&i.changeValue()},t))},onkeyup:function(e){var t=r.keyCodeToChar[e.keyCode],i=this.keyMap.indexOf(t),n=this.children[i];"undefined"!=typeof n&&1==n._value&&n.changeValue()},onkeydown:function(e){var t=r.keyCodeToChar[e.keyCode],i=this.keyMap.indexOf(t),n=this.children[i];"undefined"!=typeof n&&0==n._value&&n.changeValue()},onvaluechange:function(){this.values=[this.frequency,this.value]},onboundschange:function(){this._initialized&&this.placeKeys()},draw:function(){for(var e=0;e<this.children.length;e++)this.children[e].refresh();return this},placeKeys:function(){var e=(this._x(),this._y(),this._width(),this._height(),this.startoctave),t=0,i=0,n=["0","C","C#/Db","D","D#/Eb","E","F","F#/Gb","G","G#/Ab","A","A#/Bb","B"],o=["0","C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],a=[0,1,2,2,3,3,4,5,5,6,6,7,7],s=i+12*this.endoctave-(t+12*this.startoctave)+1,l=a[i]+7*this.endoctave-(a[t]+7*this.startoctave)+1,u=0;if(this._initialized){this.clear();for(var c=this.children.length-1;c>=0;c--){var h=this.children.pop();this.panel.remove(h)}}for(var c=1;13>c;c++)this.startletter===o[c]&&(t=c),this.endletter===o[c]&&(i=c);[2,4,7,9,11].indexOf(i)>-1&&l--;for(var c=0;s-1>c;c++){var f,p,d,m,g,v;switch(t){case 1:f=[{x:0,y:0},{x:.6,y:0},{x:.6,y:.625},{x:1,y:.625},{x:1,y:1},{x:0,y:1},{x:0,y:0}],d=this._fill(),p={x:.5,y:.75},m=this._background(),g=[u/l*this.width+this.x,this.y,this.width/l,this.height],v=this.noteLabels?n[t]+e:null;break;case 2:f=[{x:.1,y:0},{x:.7,y:0},{x:.7,y:1},{x:.1,y:1},{x:.1,y:0}],p={x:.3925,y:.5},d=this._background(),m=this._fill(),g=[(u-.5)/l*this.width+this.x,this.y,this.width/l,.625*this.height],v=this.noteLabels?n[t]:null;break;case 3:f=[{x:.2,y:0},{x:.8,y:0},{x:.8,y:.625},{x:1,y:.625},{x:1,y:1},{x:0,y:1},{x:0,y:.625},{x:.2,y:.625},{x:.2,y:0}],p={x:.5,y:.75},d=this._fill(),m=this._background(),g=[u/l*this.width+this.x,this.y,this.width/l,this.height],v=this.noteLabels?n[t]:null;break;case 4:f=[{x:.3,y:0},{x:.9,y:0},{x:.9,y:1},{x:.3,y:1},{x:.3,y:0}],p={x:.6075,y:.5},d=this._background(),m=this._fill(),g=[(u-.5)/l*this.width+this.x,this.y,this.width/l,.625*this.height],v=this.noteLabels?n[t]:null;break;case 5:f=[{x:1,y:0},{x:.4,y:0},{x:.4,y:.625},{x:0,y:.625},{x:0,y:1},{x:1,y:1},{x:1,y:0}],p={x:.5,y:.75},d=this._fill(),m=this._background(),g=[u/l*this.width+this.x,this.y,this.width/l,this.height],v=this.noteLabels?n[t]:null;break;case 6:f=[{x:0,y:0},{x:.57142857,y:0},{x:.57142857,y:.625},{x:1,y:.625},{x:1,y:1},{x:0,y:1},{x:0,y:0}],p={x:.5,y:.75},d=this._fill(),m=this._background(),g=[u/l*this.width+this.x,this.y,this.width/l,this.height],v=this.noteLabels?n[t]:null;break;case 7:f=[{x:.07142857,y:0},{x:.64285714,y:0},{x:.64285714,y:1},{x:.07142857,y:1},{x:.07142857,y:0}],p={x:.3925,y:.5},d=this._background(),m=this._fill(),g=[(u-.5)/l*this.width+this.x,this.y,this.width/l,.625*this.height],v=this.noteLabels?n[t]:null;break;case 8:f=[{x:.14285714,y:0},{x:.71428571,y:0},{x:.71428571,y:.625},{x:1,y:.625},{x:1,y:1},{x:0,y:1},{x:0,y:.625},{x:.14285714,y:.625},{x:.14285714,y:0}],p={x:.5,y:.75},d=this._fill(),m=this._background(),g=[u/l*this.width+this.x,this.y,this.width/l,this.height],v=this.noteLabels?n[t]:null;break;case 9:f=[{x:.21428571,y:0},{x:.78571428,y:0},{x:.78571428,y:1},{x:.21428571,y:1},{x:.21428571,y:0}],d=this._background(),m=this._fill(),g=[(u-.5)/l*this.width+this.x,this.y,this.width/l,.625*this.height],v=this.noteLabels?n[t]:null;break;case 10:f=[{x:.28571428,y:0},{x:.85714285,y:0},{x:.85714285,y:.625},{x:1,y:.625},{x:1,y:1},{x:0,y:1},{x:0,y:.625},{x:.28571428,y:.625},{x:.28571428,y:0}],d=this._fill(),m=this._background(),p={x:.5,y:.75},g=[u/l*this.width+this.x,this.y,this.width/l,this.height],v=this.noteLabels?n[t]:null;break;case 11:f=[{x:.35714285,y:0},{x:.92857142,y:0},{x:.92857142,y:1},{x:.35714285,y:1},{x:.35714285,y:0}],d=this._background(),m=this._fill(),p={x:.6075,y:.5},g=[(u-.5)/l*this.width+this.x,this.y,this.width/l,.625*this.height],v=this.noteLabels?n[t]:null;break;case 12:f=[{x:1,y:0},{x:.42857142,y:0},{x:.42857142,y:.625},{x:0,y:.625},{x:0,y:1},{x:1,y:1},{x:1,y:0}],d=this._fill(),m=this._background(),p={x:.5,y:.75},g=[u/l*this.width+this.x,this.y,this.width/l,this.height],v=this.noteLabels?n[t]:null}var y=new r.ButtonV({points:f,textLocation:p,target:this.target,onvaluechange:this.onvaluechange,frequency:261.626*Math.pow(2,(t+12*e-49)/12),background:d,fill:m,stroke:this._stroke(),bounds:g,label:v,requiresFocus:!1,mode:"momentary"});-1===[2,4,7,9,11].indexOf(t)&&u++,this.children.push(y),this.panel.add(y),t++,t>12&&(t=1,e++)}if(2==t||4==t||7==t||9==t||11==t)var b=new r.ButtonV({points:[{x:.166,y:0},{x:.5,y:0},{x:.5,y:1},{x:.166,y:1},{x:.166,y:0}],target:this.target,onvaluechange:this.onvaluechange,background:this._background(),frequency:261.626*Math.pow(2,(t+12*e-49)/12),bounds:[(u-.5)/l*this.width+this.x,this.y,this.width/l,.625*this.height],label:this.noteLabels?n[t]:null,stroke:this._stroke(),requiresFocus:!1,mode:"momentary"});else if(1==t)var b=new r.ButtonV({textLocation:{x:.5,y:.75},target:this.target,onvaluechange:this.onvaluechange,frequency:261.626*Math.pow(2,(t+12*e-49)/12),background:this._fill(),fill:this._background(),stroke:this._stroke(),bounds:[u/l*this.width+this.x,this.y,this.width/l,this.height],label:this.noteLabels?n[t]+e:null,requiresFocus:!1,mode:"momentary"});else if(4==t)var b=new r.ButtonV({textLocation:{x:.5,y:.75},target:this.target,onvaluechange:this.onvaluechange,frequency:261.626*Math.pow(2,(t+12*e-49)/12),background:this._fill(),fill:this._background(),stroke:this._stroke(),bounds:[u/l*this.width+this.x,this.y,this.width/l,this.height],label:this.noteLabels?n[t]:null,requiresFocus:!1,mode:"momentary"});else var b=new r.ButtonV({points:[{x:1,y:0},{x:.33,y:0},{x:.33,y:.625},{x:0,y:.625},{x:0,y:1},{x:1,y:1},{x:1,y:0}],textLocation:{x:.5,y:.75},target:this.target,onvaluechange:this.onvaluechange,frequency:261.626*Math.pow(2,(t+12*e-49)/12),background:this._fill(),fill:this._background(),stroke:this._stroke(),bounds:[u/l*this.width+this.x,this.y,this.width/l,this.height],label:this.noteLabels?n[t]:null,requiresFocus:!1,mode:"momentary"});this.children.push(b),this.panel.add(b),this._initialized=!0},_init:function(){this.placeKeys()}}).init(arguments[0])},r.Piano.prototype=r.Widget,r.Knob=function(){r.extend(this,{type:"Knob",_value:0,serializeMe:["usesRotation","knobBuffer"],knobBuffer:3,lastPosition:0,usesRotation:!0,draw:function(){var e=this._x(),t=this._y(),i=this._width(),n=(this._height(),i/2);this.ctx.clearRect(e,t,2*n,2*n),this.ctx.strokeStyle=this._stroke(),this.ctx.fillStyle=this._background();var r=.6*Math.PI,o=.4*Math.PI;if(this.ctx.beginPath(),this.ctx.arc(e+n,t+n,n-this.knobBuffer,r,o,!1),this.ctx.arc(e+n,t+n,.3*(n-this.knobBuffer),o,r,!0),this.ctx.closePath(),this.ctx.fill(),this.ctx.fillStyle=this._fill(),this.centerZero){var a,s=1.5*Math.PI;a=this._value>=.5?Math.PI*(1.5+1.8*(this._value-.5)):Math.PI*(1.5-.9*(1-2*this._value)),this._value>1.8*Math.PI&&(this._value-=1.8*Math.PI),this.ctx.beginPath(),this.ctx.arc(e+n,t+n,n-this.knobBuffer,s,a,this._value<.5),this.ctx.arc(e+n,t+n,.3*(n-this.knobBuffer),a,s,this._value>.5),this.ctx.closePath(),this.ctx.fill()}else{if(this.isInverted)var l=Math.PI*(.4-1.8*this._value);else{var l=.6*Math.PI+1.8*this._value*Math.PI;l>2*Math.PI&&(l-=2*Math.PI)}this.ctx.beginPath(),this.isInverted?(this.ctx.arc(e+n,t+n,n-this.knobBuffer,o,l,!0),this.ctx.arc(e+n,t+n,.3*(n-this.knobBuffer),l,o,!1)):(this.ctx.arc(e+n,t+n,n-this.knobBuffer,r,l,!1),this.ctx.arc(e+n,t+n,.3*(n-this.knobBuffer),l,r,!0)),this.ctx.closePath(),this.ctx.fill()}this.ctx.beginPath(),this.ctx.arc(e+n,t+n,n-this.knobBuffer,r,o,!1),this.ctx.arc(e+n,t+n,.3*(n-this.knobBuffer),o,r,!0),this.ctx.closePath(),this.ctx.stroke(),null!==this.label&&(this.ctx.fillStyle=this._stroke(),this.ctx.textBaseline="middle",this.ctx.textAlign="center",this.ctx.font=this._font(),this.ctx.fillText(this.label,e+n,t+2.25*n))},setValue:function(e,t){var i=this.max-this.min,n=e;this.lastValue=this.value,this.value=e,0!==this.min||1!==this.max?(n-=this.min,this._value=n/i):this._value=this.value,this.value!==this.lastValue&&(this.sendTargetMessage(),this.onvaluechange&&this.onvaluechange(),this.refresh(),this.lastValue=this.value),t||this.refresh()},changeValue:function(e,t){if(this.hasFocus||!this.requiresFocus){var i=this._width()/2;if(this.lastValue=this.value,this.usesRotation){var n=i-e,r=i-t,o=Math.PI+Math.atan2(r,n);this._value=(o+1.5*Math.PI)%(2*Math.PI)/(2*Math.PI),this.lastRotationValue>.8&&this._value<.2?this._value=1:this.lastRotationValue<.2&&this._value>.8&&(this._value=0)}else-1!=this.lastPosition&&(this._value-=(t-this.lastPosition)/(2*i));this._value>1&&(this._value=1),this._value<0&&(this._value=0),this.lastRotationValue=this._value,this.lastPosition=t;var a=this.max-this.min;this.value=this.min+this._value*a,this.value!==this.lastValue&&(this.sendTargetMessage(),this.onvaluechange&&this.onvaluechange(),this.refresh(),this.lastValue=this.value)}},hitTest:function(e){return e.x>=this._x()&&e.x<this._x()+this._width()&&e.y>=this._y()&&e.y<this._y()+this._width()?!0:!1},mousedown:function(e){this.lastPosition=e.y-this._y(),this.changeValue(e.x-this._x(),e.y-this._y())},mousemove:function(e){this.changeValue(e.x-this._x(),e.y-this._y())},mouseup:function(){},touchstart:function(e){this.lastPosition=e.y-this._y(),this.changeValue(e.x-this._x(),e.y-this._y())},touchmove:function(e){this.changeValue(e.x-this._x(),e.y-this._y())},touchend:function(){},_init:function(){var e=this.width,t=this.height;Object.defineProperty(this,"width",{configurable:!0,get:function(){return e},set:function(i){this.clear(),e=t=i,this.refresh()}}),Object.defineProperty(this,"height",{configurable:!0,get:function(){return t},set:function(e){t=e}})}}).init(arguments[0])},r.Knob.prototype=r.Widget,r.XY=function(){var e=this,t={x:0,y:0},n={x:0,y:0},o={x:0,y:0},s=0;r.extend(this,{type:"XY",_value:0,serializeMe:["childWidth","childHeight","numChildren","usePhysics","values","friction","maxVelocity","detectCollisions","fps"],childWidth:25,childHeight:25,children:[],values:[],_values:[],numChildren:1,usePhysics:!0,friction:.9,activeTouch:null,maxVelocity:10,detectCollisions:!0,touchCount:0,timer:null,fps:30,outputInitialValues:!0,rainbow:function(){for(var e=0;e<this.children.length;e++){var t=this.children[e];t.fill=r.XY.colors[e%r.XY.colors.length]}},remove:function(){this.stopAnimation(),r.widgets.splice(r.widgets.indexOf(this),1)},add:function(){this.usePhysics&&this.startAnimation()},startAnimation:function(){null===this.timer&&(this.timer=setInterval(function(){e.refresh()},1/this.fps*1e3))},stopAnimation:function(){clearInterval(this.timer),this.timer=null},animate:function(){for(var e=(this._x(),this._y(),this._width()),t=this._height(),n=!1,r=0;r<this.children.length;r++){var o=(moveY=!1,this.children[r]);o.x+o.vx<e&&o.x+o.vx>0?o.x+=o.vx:o.x+o.vx>=e&&o.vx>0?o.vx*=-1:o.x+o.vx<=0&&o.vx<0?o.vx*=-1:o.x+=o.vx,o.y+o.vy<t&&o.y+o.vy>0?o.y+=o.vy:o.y+o.vy>=t&&o.vy>0?o.vy*=-1:o.y+o.vy<=0&&o.vy<0?o.vy*=-1:o.y+=o.vy,o.vx*=this.friction,o.vy*=this.friction;var a=o.x/e,s=o.y/t,l=this.max-this.min;(this.values[o.id].x!==a||this.values[o.id].y!==s)&&(this.values[o.id].x=this.min+l*a,this.values[o.id].y=this.min+l*s,n=!0),this.detectCollisions&&(o.collideFlag?o.collideFlag=!1:this.collisionTest(o)),o.vx=Math.abs(o.vx)>this.maxVelocity?this.maxVelocity*i(o.vx):o.vx,o.vy=Math.abs(o.vy)>this.maxVelocity?this.maxVelocity*i(o.vy):o.vy}n&&(this.sendTargetMessage(),this.onvaluechange&&this.onvaluechange())},sendValues:function(){var e="";this._values.length=0;for(var t=0;t<this.values.length;t++)e+="ff",this._values.push(this.values[t].x),this._values.push(this.values[t].y);"OSC"===this.target&&r.OSC&&r.OSC.send(this.key,e,this._values)},collisionTest:function(e){for(var t=2*this.childWidth*2*this.childWidth,i=0;i<this.children.length;i++){var n=this.children[i];if(e.id!==n.id){var r=Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2);t>r&&this.collide(e,n)}}},collide:function(e,r){t.x=e.x-r.x,t.y=e.y-r.y,n.x=e.vx-r.vx,n.y=e.vy-r.vy,s=Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2)),o.x=t.x/s,o.y=t.y/s;var a=o.x*n.x+o.y*n.y;r.vx=e.vx+a*o.x,r.vy=e.vy+a*o.y,e.vx=r.vx-a*o.x,e.vy=r.vy-a*o.y,r.x-=o.x,r.y-=o.y,e.x+=o.x,e.y+=o.y,e.vx=Math.abs(e.vx)>this.maxVelocity?this.maxVelocity*i(e.vx):e.vx,e.vy=Math.abs(e.vy)>this.maxVelocity?this.maxVelocity*i(e.vy):e.vy,r.vx=Math.abs(r.vx)>this.maxVelocity?this.maxVelocity*i(r.vx):r.vx,r.vy=Math.abs(r.vy)>this.maxVelocity?this.maxVelocity*i(r.vy):r.vy,e.collideFlag=!0,r.collideFlag=!0},draw:function(){var e=this._x(),t=this._y(),i=this._width(),n=this._height();this.usePhysics&&this.animate(),this.ctx.fillStyle=this._background(),this.ctx.strokeStyle=this._stroke(),this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(e,t),this.ctx.lineTo(e+i,t),this.ctx.lineTo(e+i,t+n),this.ctx.lineTo(e,t+n),this.ctx.lineTo(e,t),this.ctx.fill(),this.ctx.stroke(),this.ctx.clip(),this.ctx.fillStyle=this._fill();for(var r=0;r<this.children.length;r++){var o=this.children[r];this.ctx.lineWidth=2,this.ctx.fillStyle=o.fill||this._fill(),this.ctx.beginPath(),this.ctx.arc(e+o.x,t+o.y,this.childWidth,0,2*Math.PI,!0),this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke(),this.ctx.textBaseline="middle",this.ctx.textAlign="center",this.ctx.fillStyle=this._stroke(),this.ctx.font=this._font(),this.ctx.fillText(o.id,e+o.x,t+o.y)}this.ctx.closePath(),this.ctx.restore()},changeValue:function(e,t,i){(this.hasFocus||!this.requiresFocus)&&(e.x=t,e.x<0&&(e.x=0),e.x>this._width()&&(e.x=this._width()),e.y=i,e.y<0&&(e.y=0),e.y>this._height()&&(e.y=this._height()),this.values[e.id].x=t/this._width(),this.values[e.id].y=i/this._height(),this.onvaluechange&&this.onvaluechange(),this.usePhysics||(this.sendTargetMessage(),this.refresh()))},makeChildren:function(){for(var e=0;e<this.numChildren;e++){var t=Math.random()*this._width(),i=Math.random()*this._height();this.children.push({id:e,x:t,y:i,vx:0,vy:0,collideFlag:!1,isActive:!1,lastPosition:null}),this.values.push({x:null,y:null})}},touchEvent:function(e){var t=this.hitTest(e),i=a(e.type);t?("touchstart"===e.type?(this.hasFocus=!0,this.touchCount++,this.trackTouch(e.x-this._x(),e.y-this._y(),e)):this[e.type]&&this[e.type](e,t,e.childID),this["on"+e.type]&&this["on"+e.type](e,t,e.childId),this["on"+i]&&this["on"+i](e,t)):"touchend"===e.type&&(this.touchCount--,0===this.touchCount?this.hasFocus=!1:this.touchCount<0&&(this.touchCount=0),this.touchend(e),this["on"+e.type]&&this["on"+e.type](e,t,e.childId),this["on"+i]&&this["on"+i](e,t))},trackMouse:function(e,t){for(var i=1e4,n=null,r=null,o=0;o<this.children.length;o++){var a=this.children[o],s=Math.abs(a.x-e),l=Math.abs(a.y-t);i>s+l&&(i=s+l,n=a,r=o)}n.isActive=!0,n.vx=0,n.vy=0,null!=n&&this.changeValue(n,e,t),this.activeTouch=n,this.activeTouch.lastTouch=null,this.lastTouched=n},mousedown:function(e){this.hitTest(e)&&this.trackMouse(e.x-this._x(),e.y-this._y())},mousemove:function(e){if(this.hitTest(e)&&null!==this.activeTouch){if(null===this.activeTouch.lastTouch)this.activeTouch.lastTouch={x:e.x-this._x(),y:e.y-this._y()};else{var t={x:e.x-this._x(),y:e.y-this._y()};this.activeTouch.velocity={x:t.x-this.activeTouch.lastTouch.x,y:t.y-this.activeTouch.lastTouch.y},this.activeTouch.lastTouch=t}this.changeValue(this.activeTouch,e.x-this._x(),e.y-this._y())}},mouseup:function(){null!==this.activeTouch&&(this.activeTouch.vx=this.activeTouch.velocity.x,this.activeTouch.vy=this.activeTouch.velocity.y,this.activeTouch.lastTouch=null,this.activeTouch=null);for(var e=0;e<this.children.length;e++)this.children[e].isActive=!1},trackTouch:function(e,t,i){for(var n=1e4,r=null,o=null,a=0;a<this.children.length;a++){var s=this.children[a],l=Math.abs(s.x-e),u=Math.abs(s.y-t);n>l+u&&!s.isActive&&(n=l+u,r=s,o=a)}return r.isActive=!0,r.vx=0,r.vy=0,r.identifier=i.identifier,r.childID=o,null!=r&&this.changeValue(r,e,t),this.lastTouched=r,r.childID},touchstart:function(){},touchmove:function(e){for(var t=0;t<this.children.length;t++)if(_t=this.children[t],e.identifier==_t.identifier){this.changeValue(_t,e.x-this._x(),e.y-this._y());var i={x:e.x-this._x(),y:e.y-this._y()};null!==_t.lastPosition&&(_t.velocity={x:i.x-_t.lastPosition.x,y:i.y-_t.lastPosition.y}),_t.lastPosition=i}},touchend:function(e){for(var t=!1,i=null,n=0;n<this.children.length;n++){var r=this.children[n];e.identifier===r.identifier&&(r.vx=r.velocity.x,r.vy=r.velocity.y,r.lastPosition=null,r.isActive=!1,t=!0,i=n.childID)}t&&(this.touchUp=i)},_init:function(){this.makeChildren(),this.outputInitialValues&&this.sendTargetMessage()}}).init(arguments[0]),this.requiresFocus=!1,this.half=this.childWidth/2;var l=this.numChildren;Object.defineProperty(this,"numChildren",{get:function(){return l},set:function(e){for(;e>l;)this.children.push({id:this.children.length,x:Math.random()*this._width(),y:Math.random()*this._height(),vx:0,vy:0,collideFlag:!1,isActive:!1,lastPosition:null}),this.values.push({x:null,y:null}),l++;for(;l>e;)this.chidren.pop(),this.values.pop(),l--;this.refresh(),l=e}})},r.XY.prototype=r.Widget,r.XY.colors=["rgba(255,0,0,.35)","rgba(0,255,0,.35)","rgba(0,0,255,.35)","rgba(0,255,255,.35)","rgba(255,0,255,.35)","rgba(255,255,0,.35)"],r.Menu=function(){r.extend(this,{type:"Menu",_value:0,serializeMe:["options","fontSize"],options:[],fontSize:15,touchEvent:function(e){this.hitTest(e)&&e.stopPropagation()},_init:function(){this.element=n("<select>");for(var e=0;e<this.options.length;e++){var t=n("<option>"+this.options[e]+"</option>");this.element.append(t)}this.element.css({position:"absolute",backgroundColor:this._background(),color:this._stroke(),left:this._x()+this.panel.x,top:this._y()+this.panel.y,width:this._width(),height:this._height(),fontSize:this.fontSize,display:"block",border:"1px solid "+this._stroke()}),this.css&&this.element.css(this.css);var i=this;this.element.change(function(){var e=i.value;i.value=i.element.val(),i.sendTargetMessage(),i.onvaluechange(i.value,e)}),this.element.val(-1!==this.options.indexOf(this.value)?this.value:this.options[0]),n(this.container).append(this.element)}}).init(arguments[0])},r.Menu.prototype=r.Widget,r.Label=function(){r.extend(this,{type:"Label",serializeMe:["size","style","hAlign","vAlign","font"],size:12,style:"normal",hAlign:"center",vAlign:"top",font:"sans-serif",draw:function(){this.ctx.font=this.style+" "+this.size+"px "+this.font,this.ctx.textAlign=this.hAlign,this.ctx.textBaseline=this.vAlign;var e,t,i=this.ctx.measureText(this.lastValue),n={x:0,y:this._y()-this.size/2,width:i.width,height:this.size};switch(this.hAlign){case"center":e=this._x()+this._width()/2,n.x=e-i.width/2;break;case"left":e=this._x(),n.x=e;break;case"right":e=this._x()+this._width(),n.x=e-i.width}switch(this.vAlign){case"middle":t=this._y()+this._height()/2,n.y=t-i.height/2;break;case"top":t=this._y(),n.y=t;break;case"bottom":t=this._y()+this._height(),n.y=t-i.height}this.ctx.clearRect(n.x,n.y,n.width,2*n.height),this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(this._x(),this._y()),this.ctx.lineTo(this._x()+this._width(),this._y()),this.ctx.lineTo(this._x()+this._width(),this._y()+this._height()),this.ctx.lineTo(this._x(),this._y()+this._height()),this.ctx.lineTo(this._x(),this._y()),this.ctx.closePath(),this.ctx.clip(),this.ctx.fillStyle=this._stroke(),this.ctx.fillText(this.value,e,t),this.ctx.restore(),this.lastValue=this.value}}).init(arguments[0]),this.lastValue=this.value},r.Label.prototype=r.Widget,r.TextField=function(){r.extend(this,{type:"TextField",serializeMe:["fontSize"],fontSize:15,touchEvent:function(e){if(this.hitTest(e)){var t=document.createEvent("TouchEvent");
t.initUIEvent("touchstart",!0,!0),t.view=window,t.screenX=e.screenX,t.screenY=e.screenY,t.clientX=e.clientX,t.clientY=e.clientY,t.bubbles=!1,t.view=window,t.altKey=!1,t.ctrlKey=!1,t.shiftKey=!1,t.metaKey=!1,this.element.dispatchEvent(t)}},_init:function(){this.element=n("<input>"),0!==this.value&&this.element.val(this.value),this.element.css({position:"absolute",backgroundColor:this._background(),color:this._fill(),left:this._x()+this.panel.x,top:this._y()+this.panel.y,width:this._width(),height:this._height(),fontSize:this.fontSize,display:"block",border:"1px solid "+this._stroke()}),this.css&&this.element.css(this.css);var e=this;this.element.change(function(){var t=e.value;e.value=e.element.val(),e.sendTargetMessage(),e.onvaluechange(e.value,t)}),n(this.container).append(this.element)}}).init(arguments[0])},r.TextField.prototype=r.Widget,r.MultiSlider=function(){r.extend(this,{type:"MultiSlider",isVertical:!0,serializeMe:["isVertical","count","values"],values:[],_values:[],count:16,draw:function(){var e=this._x(),t=this._y(),i=this._width(),n=this._height(),r=i/this.count;this.ctx.fillStyle=this._background(),this.ctx.fillRect(e,t,i,n),this.ctx.fillStyle=this._fill(),this.ctx.strokeStyle=this._stroke();for(var o=0;o<this.count;o++){var a=o*r+e;this.ctx.fillRect(a,t+n-this._values[o]*n,r,this._values[o]*n),this.ctx.strokeRect(a,t,r,n)}},setValue:function(e,t){this.values[e]=t,this._values[e]=t,this.refresh()},changeValue:function(e,t){if(this.hasFocus||!this.requiresFocus){var i=this._width(),n=i/this.count,o=Math.floor(e/n);_value=0,_value=1-t/this._height(),0>_value?_value=0:_value>1&&(_value=1),this.values[o]=this.min+(this.max-this.min)*_value,this._values[o]=_value,"OSC"!==this.target?this.sendTargetMessage():r.OSC&&r.OSC.send(this.key,"if",[o,this.values[o]]),this.onvaluechange&&this.onvaluechange(o,this.values[o]),this.refresh()}},mousedown:function(e,t){t&&r.mouseDown&&this.changeValue(e.x-this._x(),e.y-this._y())},mousemove:function(e,t){t&&r.mouseDown&&this.changeValue(e.x-this._x(),e.y-this._y())},mouseup:function(e,t){t&&r.mouseDown&&this.changeValue(e.x-this._x(),e.y-this._y())},touchstart:function(e,t){t&&this.changeValue(e.x-this._x(),e.y-this._y())},touchmove:function(e,t){t&&this.changeValue(e.x-this._x(),e.y-this._y())},touchend:function(e,t){t&&this.changeValue(e.x-this._x(),e.y-this._y())},onvaluechange:function(){}}).init(arguments[0]);var e=this.x,t=this.y,i=this.width,n=this.height,o=[e,t,i,n],a=this.count;delete this.bounds,Object.defineProperties(this,{x:{get:function(){return e},set:function(t){e=t,this.refresh()}},y:{get:function(){return t},set:function(e){t=e,this.refresh()}},width:{get:function(){return i},set:function(e){i=e,this.refresh()}},height:{get:function(){return n},set:function(e){n=e,this.refresh()}},bounds:{get:function(){return o},set:function(r){o=r,e=o[0],t=o[1],i=o[2],n=o[3],this.refresh()}},count:{get:function(){return a},set:function(e){a=e,this.refresh()}}})},r.MultiSlider.prototype=r.Widget,r.MultiButton=function(){r.extend(this,{type:"MultiButton",mode:"toggle",serializeMe:["mode","rows","columns","requiresFocus"],rows:8,values:[],_values:[],lastValues:[],mouseOver:null,columns:8,draw:function(){var e=this._x(),t=this._y(),i=this._width(),n=this._height(),r=i/this.columns,o=n/this.rows;this.ctx.strokeStyle=this._stroke();for(var a=0;a<this.rows;a++)for(var s=0;s<this.columns;s++){var l=e+s*r,u=t+a*o,c=a*this.columns+s;this.ctx.fillStyle=this._values[c]?this._fill():this._background(),this.ctx.fillRect(l,u,r,o),this.ctx.strokeRect(l,u,r,o)}},setValue:function(e,t,i){var n=e*this.columns+t;this._values[n]=this.values[n]=this.lastValues[n]=i,this.draw()},changeValue:function(e,t){if(this.hasFocus||!this.requiresFocus){var i=this._width(),n=this._height(),o=i/this.columns,a=Math.floor(e/o),s=n/this.rows,l=Math.floor(t/s),u=l*this.columns+a;if(u!==this.mouseOver){if(this._values[u]=!this._values[u],this.values[u]=this._values[u]?this.max:this.min,(this.values[u]!==this.lastValues[u]||"contact"===this.mode)&&("OSC"!==this.target?this.sendTargetMessage():r.OSC&&r.OSC.send(this.key,"iif",[l,a,this.values[u]]),this.onvaluechange&&this.onvaluechange(l,a,this.values[u]),this.draw(),this.lastValues[u]=this.values[u],"contact"===this.mode)){var c=this;setTimeout(function(){c._values[u]=0,c.draw()},75)}this.mouseOver=u}}},mousedown:function(e,t){t&&r.mouseDown&&this.changeValue(e.x-this._x(),e.y-this._y())},mousemove:function(e,t){t&&r.mouseDown&&this.changeValue(e.x-this._x(),e.y-this._y())},mouseup:function(e,t){t&&r.mouseDown&&this.changeValue(e.x-this._x(),e.y-this._y()),this.mouseOver=null},touchstart:function(e,t){t&&this.changeValue(e.x-this._x(),e.y-this._y())},touchmove:function(e,t){t&&this.changeValue(e.x-this._x(),e.y-this._y())},touchend:function(e,t){t&&this.changeValue(e.x-this._x(),e.y-this._y())}}).init(arguments[0]),this.requiresFocus=!1;var e=this.x,t=this.y,i=this.width,n=this.height,o=[e,t,i,n];rows=this.rows,columns=this.columns,delete this.bounds,Object.defineProperties(this,{x:{get:function(){return e},set:function(t){e=t,this.refresh()}},y:{get:function(){return t},set:function(e){t=e,this.refresh()}},width:{get:function(){return i},set:function(e){i=e,this.refresh()}},height:{get:function(){return n},set:function(e){n=e,this.refresh()}},bounds:{get:function(){return o},set:function(r){o=r,e=o[0],t=o[1],i=o[2],n=o[3],this.refresh()}},rows:{get:function(){return rows},set:function(e){rows=e,this.refresh()}},columns:{get:function(){return columns},set:function(e){columns=e,this.refresh()}}})},r.MultiButton.prototype=r.Widget,r.Accelerometer=function(){var e=this,t=9.80665;r.extend(this,{type:"Accelerometer",serializeMe:["delay"],delay:100,min:0,max:1,values:[0,0,0],update:function(t){var i=t.acceleration;e.x=e.values[0]=e.min+(0-e.hardwareMin+i.x)/e.hardwareRange*e.max,e.y=e.values[1]=e.min+(0-e.hardwareMin+i.y)/e.hardwareRange*e.max,e.z=e.values[2]=e.min+(0-e.hardwareMin+i.z)/e.hardwareRange*e.max,"undefined"!=typeof e.onvaluechange&&e.onvaluechange(e.x,e.y,e.z),e.sendTargetMessage()},start:function(){return window.addEventListener("devicemotion",this.update,!0),this},stop:function(){return window.removeEventListener("devicemotion",this.update),this}}).init(arguments[0]),r.isAndroid?(this.hardwareMin=t,this.hardwareMax=t):(this.hardwareMin=-2.307*t,this.hardwareMax=2.307*t),this.hardwareRange=this.hardwareMax-this.hardwareMin},r.Accelerometer.prototype=r.Widget,r.Orientation=function(){var e=this;r.extend(this,{type:"Orientation",serializeMe:["delay"],delay:100,values:[0,0,0],update:function(t){e.roll=e.values[0]=e.min+(90+t.gamma)/180*e.max,e.pitch=e.values[1]=e.min+(180+t.beta)/360*e.max,e.yaw=e.values[2]=e.min+t.alpha/360*e.max,isNaN(t.webkitCompassHeading)||(e.heading=e.min+t.webkitCompassHeading/360*e.max),e.sendTargetMessage(),"undefined"!=typeof e.onvaluechange&&e.onvaluechange(e.pitch,e.roll,e.yaw,e.heading)},start:function(){return window.addEventListener("deviceorientation",function(t){e.update(t)},!0),this},stop:function(){window.removeEventListener("deviceorientation")}}).init(arguments[0])},r.Orientation.prototype=r.Widget,r.Range=function(){r.extend(this,{type:"Range",serializeMe:["handleSize"],handleSize:20,values:[0,1],_values:[0,1],draw:function(){var e=this._x(),t=this._y(),i=this._width(),n=this._height();this.ctx.fillStyle=this._background(),this.ctx.clearRect(e,t,i,n);var r=e+this._values[1]*i-this.handleSize,o=e+this._values[0]*i;this.ctx.fillStyle=this._background(),this.ctx.fillRect(e,t,i,n),this.ctx.fillStyle=this._fill(),this.ctx.fillRect(o,t,r-o,n),this.ctx.fillStyle=this._stroke(),this.ctx.fillRect(o,t,this.handleSize,n),this.ctx.fillRect(r,t,this.handleSize,n),this.ctx.strokeStyle=this._stroke(),this.ctx.strokeRect(e,t,i,n)},changeValue:function(e,t){if(this.hasFocus||!this.requiresFocus){var i=this.isVertical?1-t/this._height():e/this._width();0>i?i=0:i>1&&(i=1);var n=this.max-this.min;Math.abs(i-this._values[0])<Math.abs(i-this._values[1])?(this._values[0]=i,this.values[0]=this.min+n*i):(this._values[1]=i,this.values[1]=this.min+n*i),this.refresh(),(this.values[0]!==this.lastLeftValue||this.values[1]!==this.lastRightValue)&&(this.onvaluechange&&this.onvaluechange(this.values[0],this.values[1]),this.refresh(),this.lastLeftValue=this.values[0],this.lastRightValue=this.values[1],this.sendTargetMessage())}},mousedown:function(e,t){t&&r.mouseDown&&this.changeValue(e.x-this._x(),e.y-this._y())},mousemove:function(e,t){t&&r.mouseDown&&this.changeValue(e.x-this._x(),e.y-this._y())},mouseup:function(e,t){t&&r.mouseDown&&this.changeValue(e.x-this._x(),e.y-this._y())},touchstart:function(e,t){t&&this.changeValue(e.x-this._x(),e.y-this._y())},touchmove:function(e,t){t&&this.changeValue(e.x-this._x(),e.y-this._y())},touchend:function(e,t){t&&this.changeValue(e.x-this._x(),e.y-this._y())}}).init(arguments[0])},r.Range.prototype=r.Widget,r.Paint=function(){r.extend(this,{lines:[],startTime:0,isAnimating:!1,animationPoint:0,timer:null,shouldLoop:!0,prevTimestamp:null,values:[0,0],draw:function(){var e=this._x(),t=this._y(),i=this._width(),n=this._height();if(this.ctx.fillStyle=this._background(),this.ctx.strokeStyle=this._stroke(),this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(e,t),this.ctx.lineTo(e+i,t),this.ctx.lineTo(e+i,t+n),this.ctx.lineTo(e,t+n),this.ctx.lineTo(e,t),this.ctx.fill(),this.ctx.stroke(),this.ctx.clip(),this.ctx.fillStyle=this._fill(),this.lines.length>=1){this.ctx.lineWidth=8;for(var r=0;r<this.lines.length;r++){var o=this.lines[r];if(o.length>=2){this.ctx.moveTo(o[0].x*i,o[0].y*n),this.ctx.beginPath();for(var a=1;a<o.length-2;a++){var s=(o[a].x+o[a+1].x)/2,l=(o[a].y+o[a+1].y)/2;this.ctx.quadraticCurveTo(o[a].x*i,o[a].y*n,s*i,l*n)}this.ctx.stroke()}}}this.ctx.restore()},animate:function(){var e=this;if(this.isAnimating!==!1){var t=this.lines[0],i=t[this.animationPoint],n=t[this.animationPoint+1];if(this.animationPoint>=t.length-1){if(this.shouldLoop)return this.animationPoint=0,this.draw(),void(this.timeout=setTimeout(function(){e.animate()},5));if(this.ctx.fillStyle=this._background(),this.ctx.fillRect(0,0,this._width(),this._height()),0!==this.speedMod)return}this.ctx.save(),this.ctx.strokeStyle="#f00",this.ctx.lineWidth=8,this.ctx.beginPath(),this.ctx.moveTo(i.x*this._width(),i.y*this._height()),this.ctx.lineTo(n.x*this._width(),n.y*this._height()),this.ctx.stroke(),this.ctx.restore(),this.timeout=setTimeout(function(){e.animate()},i.timestamp-this.prevTimestamp),this.prevTimestamp=i.timestamp,this.animationPoint++,this.values=[i.x,i.y],this.sendTargetMessage()}},startAnimation:function(){this.animate()},stopAnimation:function(){this.timer&&clearInterval(this.timer)},mousedown:function(e){this.hitTest(e)&&(this.lines=[],this.animationPoint=0,0===this.lines.length&&(this.startTime=Date.now()),this.lines.push([]),this.isDrawing=!0,this.isAnimating=!1)},mousemove:function(e){if(this.hitTest(e)&&null!==this.activeTouch&&this.isDrawing){var t=this.lines[this.lines.length-1];t&&(t.push({x:e.x/this._width(),y:e.y/this._height(),timestamp:Date.now()-this.startTime}),this.draw())}},mouseup:function(){this.isDrawing=!1,this.lines.length>0&&(this.isAnimating=!0,this.animate())}}).init(arguments[0])},r.Paint.prototype=r.Widget,r.defineChildProperties=function(e,t){for(var i=0;i<t.length;i++)!function(){var n=t[i],r=e[n];Object.defineProperty(e,n,{get:function(){return r},set:function(t){r=t;for(var i=0;i<e.children.length;i++)e.children[i][n]=r}})}()},t.exports=r}()},{jquery:66}],66:[function(e,t){!function(e,i){"object"==typeof t&&"object"==typeof t.exports?t.exports=e.document?i(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return i(e)}:i(e)}("undefined"!=typeof window?window:this,function(e,t){function i(e){var t=e.length,i=J.type(e);return"function"===i||J.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===i||0===t||"number"==typeof t&&t>0&&t-1 in e}function n(e,t,i){if(J.isFunction(t))return J.grep(e,function(e,n){return!!t.call(e,n,e)!==i});if(t.nodeType)return J.grep(e,function(e){return e===t!==i});if("string"==typeof t){if(st.test(t))return J.filter(t,e,i);t=J.filter(t,e)}return J.grep(e,function(e){return W.call(t,e)>=0!==i})}function r(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}function o(e){var t=dt[e]={};return J.each(e.match(pt)||[],function(e,i){t[i]=!0}),t}function a(){Q.removeEventListener("DOMContentLoaded",a,!1),e.removeEventListener("load",a,!1),J.ready()}function s(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=J.expando+Math.random()}function l(e,t,i){var n;if(void 0===i&&1===e.nodeType)if(n="data-"+t.replace(xt,"-$1").toLowerCase(),i=e.getAttribute(n),"string"==typeof i){try{i="true"===i?!0:"false"===i?!1:"null"===i?null:+i+""===i?+i:bt.test(i)?J.parseJSON(i):i}catch(r){}yt.set(e,t,i)}else i=void 0;return i}function u(){return!0}function c(){return!1}function h(){try{return Q.activeElement}catch(e){}}function f(e,t){return J.nodeName(e,"table")&&J.nodeName(11!==t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function p(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function d(e){var t=Gt.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function m(e,t){for(var i=0,n=e.length;n>i;i++)vt.set(e[i],"globalEval",!t||vt.get(t[i],"globalEval"))}function g(e,t){var i,n,r,o,a,s,l,u;if(1===t.nodeType){if(vt.hasData(e)&&(o=vt.access(e),a=vt.set(t,o),u=o.events)){delete a.handle,a.events={};for(r in u)for(i=0,n=u[r].length;n>i;i++)J.event.add(t,r,u[r][i])}yt.hasData(e)&&(s=yt.access(e),l=J.extend({},s),yt.set(t,l))}}function v(e,t){var i=e.getElementsByTagName?e.getElementsByTagName(t||"*"):e.querySelectorAll?e.querySelectorAll(t||"*"):[];return void 0===t||t&&J.nodeName(e,t)?J.merge([e],i):i}function y(e,t){var i=t.nodeName.toLowerCase();"input"===i&&Mt.test(e.type)?t.checked=e.checked:("input"===i||"textarea"===i)&&(t.defaultValue=e.defaultValue)}function b(t,i){var n,r=J(i.createElement(t)).appendTo(i.body),o=e.getDefaultComputedStyle&&(n=e.getDefaultComputedStyle(r[0]))?n.display:J.css(r[0],"display");return r.detach(),o}function x(e){var t=Q,i=Vt[e];return i||(i=b(e,t),"none"!==i&&i||(It=(It||J("<iframe frameborder='0' width='0' height='0'/>")).appendTo(t.documentElement),t=It[0].contentDocument,t.write(),t.close(),i=b(e,t),It.detach()),Vt[e]=i),i}function w(e,t,i){var n,r,o,a,s=e.style;return i=i||zt(e),i&&(a=i.getPropertyValue(t)||i[t]),i&&(""!==a||J.contains(e.ownerDocument,e)||(a=J.style(e,t)),Bt.test(a)&&Ut.test(t)&&(n=s.width,r=s.minWidth,o=s.maxWidth,s.minWidth=s.maxWidth=s.width=a,a=i.width,s.width=n,s.minWidth=r,s.maxWidth=o)),void 0!==a?a+"":a}function _(e,t){return{get:function(){return e()?void delete this.get:(this.get=t).apply(this,arguments)}}}function S(e,t){if(t in e)return t;for(var i=t[0].toUpperCase()+t.slice(1),n=t,r=Kt.length;r--;)if(t=Kt[r]+i,t in e)return t;return n}function M(e,t,i){var n=Ht.exec(t);return n?Math.max(0,n[1]-(i||0))+(n[2]||"px"):t}function C(e,t,i,n,r){for(var o=i===(n?"border":"content")?4:"width"===t?1:0,a=0;4>o;o+=2)"margin"===i&&(a+=J.css(e,i+_t[o],!0,r)),n?("content"===i&&(a-=J.css(e,"padding"+_t[o],!0,r)),"margin"!==i&&(a-=J.css(e,"border"+_t[o]+"Width",!0,r))):(a+=J.css(e,"padding"+_t[o],!0,r),"padding"!==i&&(a+=J.css(e,"border"+_t[o]+"Width",!0,r)));return a}function A(e,t,i){var n=!0,r="width"===t?e.offsetWidth:e.offsetHeight,o=zt(e),a="border-box"===J.css(e,"boxSizing",!1,o);if(0>=r||null==r){if(r=w(e,t,o),(0>r||null==r)&&(r=e.style[t]),Bt.test(r))return r;n=a&&($.boxSizingReliable()||r===e.style[t]),r=parseFloat(r)||0}return r+C(e,t,i||(a?"border":"content"),n,o)+"px"}function T(e,t){for(var i,n,r,o=[],a=0,s=e.length;s>a;a++)n=e[a],n.style&&(o[a]=vt.get(n,"olddisplay"),i=n.style.display,t?(o[a]||"none"!==i||(n.style.display=""),""===n.style.display&&St(n)&&(o[a]=vt.access(n,"olddisplay",x(n.nodeName)))):(r=St(n),"none"===i&&r||vt.set(n,"olddisplay",r?i:J.css(n,"display"))));for(a=0;s>a;a++)n=e[a],n.style&&(t&&"none"!==n.style.display&&""!==n.style.display||(n.style.display=t?o[a]||"":"none"));return e}function E(e,t,i,n,r){return new E.prototype.init(e,t,i,n,r)}function k(){return setTimeout(function(){$t=void 0}),$t=J.now()}function P(e,t){var i,n=0,r={height:e};for(t=t?1:0;4>n;n+=2-t)i=_t[n],r["margin"+i]=r["padding"+i]=e;return t&&(r.opacity=r.width=e),r}function R(e,t,i){for(var n,r=(ii[t]||[]).concat(ii["*"]),o=0,a=r.length;a>o;o++)if(n=r[o].call(i,t,e))return n}function L(e,t,i){var n,r,o,a,s,l,u,c,h=this,f={},p=e.style,d=e.nodeType&&St(e),m=vt.get(e,"fxshow");i.queue||(s=J._queueHooks(e,"fx"),null==s.unqueued&&(s.unqueued=0,l=s.empty.fire,s.empty.fire=function(){s.unqueued||l()}),s.unqueued++,h.always(function(){h.always(function(){s.unqueued--,J.queue(e,"fx").length||s.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(i.overflow=[p.overflow,p.overflowX,p.overflowY],u=J.css(e,"display"),c="none"===u?vt.get(e,"olddisplay")||x(e.nodeName):u,"inline"===c&&"none"===J.css(e,"float")&&(p.display="inline-block")),i.overflow&&(p.overflow="hidden",h.always(function(){p.overflow=i.overflow[0],p.overflowX=i.overflow[1],p.overflowY=i.overflow[2]}));for(n in t)if(r=t[n],Zt.exec(r)){if(delete t[n],o=o||"toggle"===r,r===(d?"hide":"show")){if("show"!==r||!m||void 0===m[n])continue;d=!0}f[n]=m&&m[n]||J.style(e,n)}else u=void 0;if(J.isEmptyObject(f))"inline"===("none"===u?x(e.nodeName):u)&&(p.display=u);else{m?"hidden"in m&&(d=m.hidden):m=vt.access(e,"fxshow",{}),o&&(m.hidden=!d),d?J(e).show():h.done(function(){J(e).hide()}),h.done(function(){var t;vt.remove(e,"fxshow");for(t in f)J.style(e,t,f[t])});for(n in f)a=R(d?m[n]:0,n,h),n in m||(m[n]=a.start,d&&(a.end=a.start,a.start="width"===n||"height"===n?1:0))}}function D(e,t){var i,n,r,o,a;for(i in e)if(n=J.camelCase(i),r=t[n],o=e[i],J.isArray(o)&&(r=o[1],o=e[i]=o[0]),i!==n&&(e[n]=o,delete e[i]),a=J.cssHooks[n],a&&"expand"in a){o=a.expand(o),delete e[n];for(i in o)i in e||(e[i]=o[i],t[i]=r)}else t[n]=r}function N(e,t,i){var n,r,o=0,a=ti.length,s=J.Deferred().always(function(){delete l.elem}),l=function(){if(r)return!1;for(var t=$t||k(),i=Math.max(0,u.startTime+u.duration-t),n=i/u.duration||0,o=1-n,a=0,l=u.tweens.length;l>a;a++)u.tweens[a].run(o);return s.notifyWith(e,[u,o,i]),1>o&&l?i:(s.resolveWith(e,[u]),!1)},u=s.promise({elem:e,props:J.extend({},t),opts:J.extend(!0,{specialEasing:{}},i),originalProperties:t,originalOptions:i,startTime:$t||k(),duration:i.duration,tweens:[],createTween:function(t,i){var n=J.Tween(e,u.opts,t,i,u.opts.specialEasing[t]||u.opts.easing);return u.tweens.push(n),n},stop:function(t){var i=0,n=t?u.tweens.length:0;if(r)return this;for(r=!0;n>i;i++)u.tweens[i].run(1);return t?s.resolveWith(e,[u,t]):s.rejectWith(e,[u,t]),this}}),c=u.props;for(D(c,u.opts.specialEasing);a>o;o++)if(n=ti[o].call(u,e,c,u.opts))return n;return J.map(c,R,u),J.isFunction(u.opts.start)&&u.opts.start.call(e,u),J.fx.timer(J.extend(l,{elem:e,anim:u,queue:u.opts.queue})),u.progress(u.opts.progress).done(u.opts.done,u.opts.complete).fail(u.opts.fail).always(u.opts.always)}function F(e){return function(t,i){"string"!=typeof t&&(i=t,t="*");var n,r=0,o=t.toLowerCase().match(pt)||[];if(J.isFunction(i))for(;n=o[r++];)"+"===n[0]?(n=n.slice(1)||"*",(e[n]=e[n]||[]).unshift(i)):(e[n]=e[n]||[]).push(i)}}function G(e,t,i,n){function r(s){var l;return o[s]=!0,J.each(e[s]||[],function(e,s){var u=s(t,i,n);return"string"!=typeof u||a||o[u]?a?!(l=u):void 0:(t.dataTypes.unshift(u),r(u),!1)}),l}var o={},a=e===wi;return r(t.dataTypes[0])||!o["*"]&&r("*")}function O(e,t){var i,n,r=J.ajaxSettings.flatOptions||{};for(i in t)void 0!==t[i]&&((r[i]?e:n||(n={}))[i]=t[i]);return n&&J.extend(!0,e,n),e}function j(e,t,i){for(var n,r,o,a,s=e.contents,l=e.dataTypes;"*"===l[0];)l.shift(),void 0===n&&(n=e.mimeType||t.getResponseHeader("Content-Type"));if(n)for(r in s)if(s[r]&&s[r].test(n)){l.unshift(r);break}if(l[0]in i)o=l[0];else{for(r in i){if(!l[0]||e.converters[r+" "+l[0]]){o=r;break}a||(a=r)}o=o||a}return o?(o!==l[0]&&l.unshift(o),i[o]):void 0}function I(e,t,i,n){var r,o,a,s,l,u={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)u[a.toLowerCase()]=e.converters[a];for(o=c.shift();o;)if(e.responseFields[o]&&(i[e.responseFields[o]]=t),!l&&n&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l=o,o=c.shift())if("*"===o)o=l;else if("*"!==l&&l!==o){if(a=u[l+" "+o]||u["* "+o],!a)for(r in u)if(s=r.split(" "),s[1]===o&&(a=u[l+" "+s[0]]||u["* "+s[0]])){a===!0?a=u[r]:u[r]!==!0&&(o=s[0],c.unshift(s[1]));break}if(a!==!0)if(a&&e["throws"])t=a(t);else try{t=a(t)}catch(h){return{state:"parsererror",error:a?h:"No conversion from "+l+" to "+o}}}return{state:"success",data:t}}function V(e,t,i,n){var r;if(J.isArray(t))J.each(t,function(t,r){i||Ci.test(e)?n(e,r):V(e+"["+("object"==typeof r?t:"")+"]",r,i,n)});else if(i||"object"!==J.type(t))n(e,t);else for(r in t)V(e+"["+r+"]",t[r],i,n)}function U(e){return J.isWindow(e)?e:9===e.nodeType&&e.defaultView}var B=[],z=B.slice,q=B.concat,H=B.push,W=B.indexOf,X={},Y=X.toString,K=X.hasOwnProperty,$={},Q=e.document,Z="2.1.1",J=function(e,t){return new J.fn.init(e,t)},et=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,tt=/^-ms-/,it=/-([\da-z])/gi,nt=function(e,t){return t.toUpperCase()};J.fn=J.prototype={jquery:Z,constructor:J,selector:"",length:0,toArray:function(){return z.call(this)},get:function(e){return null!=e?0>e?this[e+this.length]:this[e]:z.call(this)},pushStack:function(e){var t=J.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return J.each(this,e,t)},map:function(e){return this.pushStack(J.map(this,function(t,i){return e.call(t,i,t)}))},slice:function(){return this.pushStack(z.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,i=+e+(0>e?t:0);return this.pushStack(i>=0&&t>i?[this[i]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:H,sort:B.sort,splice:B.splice},J.extend=J.fn.extend=function(){var e,t,i,n,r,o,a=arguments[0]||{},s=1,l=arguments.length,u=!1;for("boolean"==typeof a&&(u=a,a=arguments[s]||{},s++),"object"==typeof a||J.isFunction(a)||(a={}),s===l&&(a=this,s--);l>s;s++)if(null!=(e=arguments[s]))for(t in e)i=a[t],n=e[t],a!==n&&(u&&n&&(J.isPlainObject(n)||(r=J.isArray(n)))?(r?(r=!1,o=i&&J.isArray(i)?i:[]):o=i&&J.isPlainObject(i)?i:{},a[t]=J.extend(u,o,n)):void 0!==n&&(a[t]=n));return a},J.extend({expando:"jQuery"+(Z+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===J.type(e)},isArray:Array.isArray,isWindow:function(e){return null!=e&&e===e.window},isNumeric:function(e){return!J.isArray(e)&&e-parseFloat(e)>=0},isPlainObject:function(e){return"object"!==J.type(e)||e.nodeType||J.isWindow(e)?!1:e.constructor&&!K.call(e.constructor.prototype,"isPrototypeOf")?!1:!0},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?X[Y.call(e)]||"object":typeof e},globalEval:function(e){var t,i=eval;e=J.trim(e),e&&(1===e.indexOf("use strict")?(t=Q.createElement("script"),t.text=e,Q.head.appendChild(t).parentNode.removeChild(t)):i(e))},camelCase:function(e){return e.replace(tt,"ms-").replace(it,nt)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,o=0,a=e.length,s=i(e);if(n){if(s)for(;a>o&&(r=t.apply(e[o],n),r!==!1);o++);else for(o in e)if(r=t.apply(e[o],n),r===!1)break}else if(s)for(;a>o&&(r=t.call(e[o],o,e[o]),r!==!1);o++);else for(o in e)if(r=t.call(e[o],o,e[o]),r===!1)break;return e},trim:function(e){return null==e?"":(e+"").replace(et,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(i(Object(e))?J.merge(n,"string"==typeof e?[e]:e):H.call(n,e)),n},inArray:function(e,t,i){return null==t?-1:W.call(t,e,i)},merge:function(e,t){for(var i=+t.length,n=0,r=e.length;i>n;n++)e[r++]=t[n];return e.length=r,e},grep:function(e,t,i){for(var n,r=[],o=0,a=e.length,s=!i;a>o;o++)n=!t(e[o],o),n!==s&&r.push(e[o]);return r},map:function(e,t,n){var r,o=0,a=e.length,s=i(e),l=[];if(s)for(;a>o;o++)r=t(e[o],o,n),null!=r&&l.push(r);else for(o in e)r=t(e[o],o,n),null!=r&&l.push(r);return q.apply([],l)},guid:1,proxy:function(e,t){var i,n,r;return"string"==typeof t&&(i=e[t],t=e,e=i),J.isFunction(e)?(n=z.call(arguments,2),r=function(){return e.apply(t||this,n.concat(z.call(arguments)))},r.guid=e.guid=e.guid||J.guid++,r):void 0},now:Date.now,support:$}),J.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){X["[object "+t+"]"]=t.toLowerCase()});var rt=function(e){function t(e,t,i,n){var r,o,a,s,l,u,h,p,d,m;if((t?t.ownerDocument||t:V)!==L&&R(t),t=t||L,i=i||[],!e||"string"!=typeof e)return i;if(1!==(s=t.nodeType)&&9!==s)return[];if(N&&!n){if(r=yt.exec(e))if(a=r[1]){if(9===s){if(o=t.getElementById(a),!o||!o.parentNode)return i;if(o.id===a)return i.push(o),i}else if(t.ownerDocument&&(o=t.ownerDocument.getElementById(a))&&j(t,o)&&o.id===a)return i.push(o),i}else{if(r[2])return J.apply(i,t.getElementsByTagName(e)),i;if((a=r[3])&&w.getElementsByClassName&&t.getElementsByClassName)return J.apply(i,t.getElementsByClassName(a)),i}if(w.qsa&&(!F||!F.test(e))){if(p=h=I,d=t,m=9===s&&e,1===s&&"object"!==t.nodeName.toLowerCase()){for(u=C(e),(h=t.getAttribute("id"))?p=h.replace(xt,"\\$&"):t.setAttribute("id",p),p="[id='"+p+"'] ",l=u.length;l--;)u[l]=p+f(u[l]);d=bt.test(e)&&c(t.parentNode)||t,m=u.join(",")}if(m)try{return J.apply(i,d.querySelectorAll(m)),i}catch(g){}finally{h||t.removeAttribute("id")}}}return T(e.replace(lt,"$1"),t,i,n)}function i(){function e(i,n){return t.push(i+" ")>_.cacheLength&&delete e[t.shift()],e[i+" "]=n}var t=[];return e}function n(e){return e[I]=!0,e}function r(e){var t=L.createElement("div");try{return!!e(t)}catch(i){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function o(e,t){for(var i=e.split("|"),n=e.length;n--;)_.attrHandle[i[n]]=t}function a(e,t){var i=t&&e,n=i&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||Y)-(~e.sourceIndex||Y);if(n)return n;if(i)for(;i=i.nextSibling;)if(i===t)return-1;return e?1:-1}function s(e){return function(t){var i=t.nodeName.toLowerCase();return"input"===i&&t.type===e}}function l(e){return function(t){var i=t.nodeName.toLowerCase();return("input"===i||"button"===i)&&t.type===e}}function u(e){return n(function(t){return t=+t,n(function(i,n){for(var r,o=e([],i.length,t),a=o.length;a--;)i[r=o[a]]&&(i[r]=!(n[r]=i[r]))})})}function c(e){return e&&typeof e.getElementsByTagName!==X&&e}function h(){}function f(e){for(var t=0,i=e.length,n="";i>t;t++)n+=e[t].value;return n}function p(e,t,i){var n=t.dir,r=i&&"parentNode"===n,o=B++;return t.first?function(t,i,o){for(;t=t[n];)if(1===t.nodeType||r)return e(t,i,o)}:function(t,i,a){var s,l,u=[U,o];if(a){for(;t=t[n];)if((1===t.nodeType||r)&&e(t,i,a))return!0}else for(;t=t[n];)if(1===t.nodeType||r){if(l=t[I]||(t[I]={}),(s=l[n])&&s[0]===U&&s[1]===o)return u[2]=s[2];if(l[n]=u,u[2]=e(t,i,a))return!0}}}function d(e){return e.length>1?function(t,i,n){for(var r=e.length;r--;)if(!e[r](t,i,n))return!1;return!0}:e[0]}function m(e,i,n){for(var r=0,o=i.length;o>r;r++)t(e,i[r],n);return n}function g(e,t,i,n,r){for(var o,a=[],s=0,l=e.length,u=null!=t;l>s;s++)(o=e[s])&&(!i||i(o,n,r))&&(a.push(o),u&&t.push(s));return a}function v(e,t,i,r,o,a){return r&&!r[I]&&(r=v(r)),o&&!o[I]&&(o=v(o,a)),n(function(n,a,s,l){var u,c,h,f=[],p=[],d=a.length,v=n||m(t||"*",s.nodeType?[s]:s,[]),y=!e||!n&&t?v:g(v,f,e,s,l),b=i?o||(n?e:d||r)?[]:a:y;if(i&&i(y,b,s,l),r)for(u=g(b,p),r(u,[],s,l),c=u.length;c--;)(h=u[c])&&(b[p[c]]=!(y[p[c]]=h));if(n){if(o||e){if(o){for(u=[],c=b.length;c--;)(h=b[c])&&u.push(y[c]=h);o(null,b=[],u,l)}for(c=b.length;c--;)(h=b[c])&&(u=o?tt.call(n,h):f[c])>-1&&(n[u]=!(a[u]=h))}}else b=g(b===a?b.splice(d,b.length):b),o?o(null,a,b,l):J.apply(a,b)})}function y(e){for(var t,i,n,r=e.length,o=_.relative[e[0].type],a=o||_.relative[" "],s=o?1:0,l=p(function(e){return e===t},a,!0),u=p(function(e){return tt.call(t,e)>-1},a,!0),c=[function(e,i,n){return!o&&(n||i!==E)||((t=i).nodeType?l(e,i,n):u(e,i,n))}];r>s;s++)if(i=_.relative[e[s].type])c=[p(d(c),i)];else{if(i=_.filter[e[s].type].apply(null,e[s].matches),i[I]){for(n=++s;r>n&&!_.relative[e[n].type];n++);return v(s>1&&d(c),s>1&&f(e.slice(0,s-1).concat({value:" "===e[s-2].type?"*":""})).replace(lt,"$1"),i,n>s&&y(e.slice(s,n)),r>n&&y(e=e.slice(n)),r>n&&f(e))}c.push(i)}return d(c)}function b(e,i){var r=i.length>0,o=e.length>0,a=function(n,a,s,l,u){var c,h,f,p=0,d="0",m=n&&[],v=[],y=E,b=n||o&&_.find.TAG("*",u),x=U+=null==y?1:Math.random()||.1,w=b.length;for(u&&(E=a!==L&&a);d!==w&&null!=(c=b[d]);d++){if(o&&c){for(h=0;f=e[h++];)if(f(c,a,s)){l.push(c);break}u&&(U=x)}r&&((c=!f&&c)&&p--,n&&m.push(c))}if(p+=d,r&&d!==p){for(h=0;f=i[h++];)f(m,v,a,s);if(n){if(p>0)for(;d--;)m[d]||v[d]||(v[d]=Q.call(l));v=g(v)}J.apply(l,v),u&&!n&&v.length>0&&p+i.length>1&&t.uniqueSort(l)}return u&&(U=x,E=y),m};return r?n(a):a}var x,w,_,S,M,C,A,T,E,k,P,R,L,D,N,F,G,O,j,I="sizzle"+-new Date,V=e.document,U=0,B=0,z=i(),q=i(),H=i(),W=function(e,t){return e===t&&(P=!0),0},X="undefined",Y=1<<31,K={}.hasOwnProperty,$=[],Q=$.pop,Z=$.push,J=$.push,et=$.slice,tt=$.indexOf||function(e){for(var t=0,i=this.length;i>t;t++)if(this[t]===e)return t;return-1},it="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",nt="[\\x20\\t\\r\\n\\f]",rt="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",ot=rt.replace("w","w#"),at="\\["+nt+"*("+rt+")(?:"+nt+"*([*^$|!~]?=)"+nt+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+ot+"))|)"+nt+"*\\]",st=":("+rt+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+at+")*)|.*)\\)|)",lt=new RegExp("^"+nt+"+|((?:^|[^\\\\])(?:\\\\.)*)"+nt+"+$","g"),ut=new RegExp("^"+nt+"*,"+nt+"*"),ct=new RegExp("^"+nt+"*([>+~]|"+nt+")"+nt+"*"),ht=new RegExp("="+nt+"*([^\\]'\"]*?)"+nt+"*\\]","g"),ft=new RegExp(st),pt=new RegExp("^"+ot+"$"),dt={ID:new RegExp("^#("+rt+")"),CLASS:new RegExp("^\\.("+rt+")"),TAG:new RegExp("^("+rt.replace("w","w*")+")"),ATTR:new RegExp("^"+at),PSEUDO:new RegExp("^"+st),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+nt+"*(even|odd|(([+-]|)(\\d*)n|)"+nt+"*(?:([+-]|)"+nt+"*(\\d+)|))"+nt+"*\\)|)","i"),bool:new RegExp("^(?:"+it+")$","i"),needsContext:new RegExp("^"+nt+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+nt+"*((?:-\\d)?\\d*)"+nt+"*\\)|)(?=[^-]|$)","i")},mt=/^(?:input|select|textarea|button)$/i,gt=/^h\d$/i,vt=/^[^{]+\{\s*\[native \w/,yt=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,bt=/[+~]/,xt=/'|\\/g,wt=new RegExp("\\\\([\\da-f]{1,6}"+nt+"?|("+nt+")|.)","ig"),_t=function(e,t,i){var n="0x"+t-65536;return n!==n||i?t:0>n?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320)};try{J.apply($=et.call(V.childNodes),V.childNodes),$[V.childNodes.length].nodeType}catch(St){J={apply:$.length?function(e,t){Z.apply(e,et.call(t))}:function(e,t){for(var i=e.length,n=0;e[i++]=t[n++];);e.length=i-1}}}w=t.support={},M=t.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},R=t.setDocument=function(e){var t,i=e?e.ownerDocument||e:V,n=i.defaultView;return i!==L&&9===i.nodeType&&i.documentElement?(L=i,D=i.documentElement,N=!M(i),n&&n!==n.top&&(n.addEventListener?n.addEventListener("unload",function(){R()},!1):n.attachEvent&&n.attachEvent("onunload",function(){R()})),w.attributes=r(function(e){return e.className="i",!e.getAttribute("className")}),w.getElementsByTagName=r(function(e){return e.appendChild(i.createComment("")),!e.getElementsByTagName("*").length}),w.getElementsByClassName=vt.test(i.getElementsByClassName)&&r(function(e){return e.innerHTML="<div class='a'></div><div class='a i'></div>",e.firstChild.className="i",2===e.getElementsByClassName("i").length}),w.getById=r(function(e){return D.appendChild(e).id=I,!i.getElementsByName||!i.getElementsByName(I).length
}),w.getById?(_.find.ID=function(e,t){if(typeof t.getElementById!==X&&N){var i=t.getElementById(e);return i&&i.parentNode?[i]:[]}},_.filter.ID=function(e){var t=e.replace(wt,_t);return function(e){return e.getAttribute("id")===t}}):(delete _.find.ID,_.filter.ID=function(e){var t=e.replace(wt,_t);return function(e){var i=typeof e.getAttributeNode!==X&&e.getAttributeNode("id");return i&&i.value===t}}),_.find.TAG=w.getElementsByTagName?function(e,t){return typeof t.getElementsByTagName!==X?t.getElementsByTagName(e):void 0}:function(e,t){var i,n=[],r=0,o=t.getElementsByTagName(e);if("*"===e){for(;i=o[r++];)1===i.nodeType&&n.push(i);return n}return o},_.find.CLASS=w.getElementsByClassName&&function(e,t){return typeof t.getElementsByClassName!==X&&N?t.getElementsByClassName(e):void 0},G=[],F=[],(w.qsa=vt.test(i.querySelectorAll))&&(r(function(e){e.innerHTML="<select msallowclip=''><option selected=''></option></select>",e.querySelectorAll("[msallowclip^='']").length&&F.push("[*^$]="+nt+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||F.push("\\["+nt+"*(?:value|"+it+")"),e.querySelectorAll(":checked").length||F.push(":checked")}),r(function(e){var t=i.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&F.push("name"+nt+"*[*^$|!~]?="),e.querySelectorAll(":enabled").length||F.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),F.push(",.*:")})),(w.matchesSelector=vt.test(O=D.matches||D.webkitMatchesSelector||D.mozMatchesSelector||D.oMatchesSelector||D.msMatchesSelector))&&r(function(e){w.disconnectedMatch=O.call(e,"div"),O.call(e,"[s!='']:x"),G.push("!=",st)}),F=F.length&&new RegExp(F.join("|")),G=G.length&&new RegExp(G.join("|")),t=vt.test(D.compareDocumentPosition),j=t||vt.test(D.contains)?function(e,t){var i=9===e.nodeType?e.documentElement:e,n=t&&t.parentNode;return e===n||!(!n||1!==n.nodeType||!(i.contains?i.contains(n):e.compareDocumentPosition&&16&e.compareDocumentPosition(n)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},W=t?function(e,t){if(e===t)return P=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n?n:(n=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,1&n||!w.sortDetached&&t.compareDocumentPosition(e)===n?e===i||e.ownerDocument===V&&j(V,e)?-1:t===i||t.ownerDocument===V&&j(V,t)?1:k?tt.call(k,e)-tt.call(k,t):0:4&n?-1:1)}:function(e,t){if(e===t)return P=!0,0;var n,r=0,o=e.parentNode,s=t.parentNode,l=[e],u=[t];if(!o||!s)return e===i?-1:t===i?1:o?-1:s?1:k?tt.call(k,e)-tt.call(k,t):0;if(o===s)return a(e,t);for(n=e;n=n.parentNode;)l.unshift(n);for(n=t;n=n.parentNode;)u.unshift(n);for(;l[r]===u[r];)r++;return r?a(l[r],u[r]):l[r]===V?-1:u[r]===V?1:0},i):L},t.matches=function(e,i){return t(e,null,null,i)},t.matchesSelector=function(e,i){if((e.ownerDocument||e)!==L&&R(e),i=i.replace(ht,"='$1']"),!(!w.matchesSelector||!N||G&&G.test(i)||F&&F.test(i)))try{var n=O.call(e,i);if(n||w.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(r){}return t(i,L,null,[e]).length>0},t.contains=function(e,t){return(e.ownerDocument||e)!==L&&R(e),j(e,t)},t.attr=function(e,t){(e.ownerDocument||e)!==L&&R(e);var i=_.attrHandle[t.toLowerCase()],n=i&&K.call(_.attrHandle,t.toLowerCase())?i(e,t,!N):void 0;return void 0!==n?n:w.attributes||!N?e.getAttribute(t):(n=e.getAttributeNode(t))&&n.specified?n.value:null},t.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},t.uniqueSort=function(e){var t,i=[],n=0,r=0;if(P=!w.detectDuplicates,k=!w.sortStable&&e.slice(0),e.sort(W),P){for(;t=e[r++];)t===e[r]&&(n=i.push(r));for(;n--;)e.splice(i[n],1)}return k=null,e},S=t.getText=function(e){var t,i="",n=0,r=e.nodeType;if(r){if(1===r||9===r||11===r){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)i+=S(e)}else if(3===r||4===r)return e.nodeValue}else for(;t=e[n++];)i+=S(t);return i},_=t.selectors={cacheLength:50,createPseudo:n,match:dt,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(wt,_t),e[3]=(e[3]||e[4]||e[5]||"").replace(wt,_t),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||t.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&t.error(e[0]),e},PSEUDO:function(e){var t,i=!e[6]&&e[2];return dt.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":i&&ft.test(i)&&(t=C(i,!0))&&(t=i.indexOf(")",i.length-t)-i.length)&&(e[0]=e[0].slice(0,t),e[2]=i.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(wt,_t).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=z[e+" "];return t||(t=new RegExp("(^|"+nt+")"+e+"("+nt+"|$)"))&&z(e,function(e){return t.test("string"==typeof e.className&&e.className||typeof e.getAttribute!==X&&e.getAttribute("class")||"")})},ATTR:function(e,i,n){return function(r){var o=t.attr(r,e);return null==o?"!="===i:i?(o+="","="===i?o===n:"!="===i?o!==n:"^="===i?n&&0===o.indexOf(n):"*="===i?n&&o.indexOf(n)>-1:"$="===i?n&&o.slice(-n.length)===n:"~="===i?(" "+o+" ").indexOf(n)>-1:"|="===i?o===n||o.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,i,n,r){var o="nth"!==e.slice(0,3),a="last"!==e.slice(-4),s="of-type"===t;return 1===n&&0===r?function(e){return!!e.parentNode}:function(t,i,l){var u,c,h,f,p,d,m=o!==a?"nextSibling":"previousSibling",g=t.parentNode,v=s&&t.nodeName.toLowerCase(),y=!l&&!s;if(g){if(o){for(;m;){for(h=t;h=h[m];)if(s?h.nodeName.toLowerCase()===v:1===h.nodeType)return!1;d=m="only"===e&&!d&&"nextSibling"}return!0}if(d=[a?g.firstChild:g.lastChild],a&&y){for(c=g[I]||(g[I]={}),u=c[e]||[],p=u[0]===U&&u[1],f=u[0]===U&&u[2],h=p&&g.childNodes[p];h=++p&&h&&h[m]||(f=p=0)||d.pop();)if(1===h.nodeType&&++f&&h===t){c[e]=[U,p,f];break}}else if(y&&(u=(t[I]||(t[I]={}))[e])&&u[0]===U)f=u[1];else for(;(h=++p&&h&&h[m]||(f=p=0)||d.pop())&&((s?h.nodeName.toLowerCase()!==v:1!==h.nodeType)||!++f||(y&&((h[I]||(h[I]={}))[e]=[U,f]),h!==t)););return f-=r,f===n||f%n===0&&f/n>=0}}},PSEUDO:function(e,i){var r,o=_.pseudos[e]||_.setFilters[e.toLowerCase()]||t.error("unsupported pseudo: "+e);return o[I]?o(i):o.length>1?(r=[e,e,"",i],_.setFilters.hasOwnProperty(e.toLowerCase())?n(function(e,t){for(var n,r=o(e,i),a=r.length;a--;)n=tt.call(e,r[a]),e[n]=!(t[n]=r[a])}):function(e){return o(e,0,r)}):o}},pseudos:{not:n(function(e){var t=[],i=[],r=A(e.replace(lt,"$1"));return r[I]?n(function(e,t,i,n){for(var o,a=r(e,null,n,[]),s=e.length;s--;)(o=a[s])&&(e[s]=!(t[s]=o))}):function(e,n,o){return t[0]=e,r(t,null,o,i),!i.pop()}}),has:n(function(e){return function(i){return t(e,i).length>0}}),contains:n(function(e){return function(t){return(t.textContent||t.innerText||S(t)).indexOf(e)>-1}}),lang:n(function(e){return pt.test(e||"")||t.error("unsupported lang: "+e),e=e.replace(wt,_t).toLowerCase(),function(t){var i;do if(i=N?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return i=i.toLowerCase(),i===e||0===i.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var i=e.location&&e.location.hash;return i&&i.slice(1)===t.id},root:function(e){return e===D},focus:function(e){return e===L.activeElement&&(!L.hasFocus||L.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!_.pseudos.empty(e)},header:function(e){return gt.test(e.nodeName)},input:function(e){return mt.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:u(function(){return[0]}),last:u(function(e,t){return[t-1]}),eq:u(function(e,t,i){return[0>i?i+t:i]}),even:u(function(e,t){for(var i=0;t>i;i+=2)e.push(i);return e}),odd:u(function(e,t){for(var i=1;t>i;i+=2)e.push(i);return e}),lt:u(function(e,t,i){for(var n=0>i?i+t:i;--n>=0;)e.push(n);return e}),gt:u(function(e,t,i){for(var n=0>i?i+t:i;++n<t;)e.push(n);return e})}},_.pseudos.nth=_.pseudos.eq;for(x in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})_.pseudos[x]=s(x);for(x in{submit:!0,reset:!0})_.pseudos[x]=l(x);return h.prototype=_.filters=_.pseudos,_.setFilters=new h,C=t.tokenize=function(e,i){var n,r,o,a,s,l,u,c=q[e+" "];if(c)return i?0:c.slice(0);for(s=e,l=[],u=_.preFilter;s;){(!n||(r=ut.exec(s)))&&(r&&(s=s.slice(r[0].length)||s),l.push(o=[])),n=!1,(r=ct.exec(s))&&(n=r.shift(),o.push({value:n,type:r[0].replace(lt," ")}),s=s.slice(n.length));for(a in _.filter)!(r=dt[a].exec(s))||u[a]&&!(r=u[a](r))||(n=r.shift(),o.push({value:n,type:a,matches:r}),s=s.slice(n.length));if(!n)break}return i?s.length:s?t.error(e):q(e,l).slice(0)},A=t.compile=function(e,t){var i,n=[],r=[],o=H[e+" "];if(!o){for(t||(t=C(e)),i=t.length;i--;)o=y(t[i]),o[I]?n.push(o):r.push(o);o=H(e,b(r,n)),o.selector=e}return o},T=t.select=function(e,t,i,n){var r,o,a,s,l,u="function"==typeof e&&e,h=!n&&C(e=u.selector||e);if(i=i||[],1===h.length){if(o=h[0]=h[0].slice(0),o.length>2&&"ID"===(a=o[0]).type&&w.getById&&9===t.nodeType&&N&&_.relative[o[1].type]){if(t=(_.find.ID(a.matches[0].replace(wt,_t),t)||[])[0],!t)return i;u&&(t=t.parentNode),e=e.slice(o.shift().value.length)}for(r=dt.needsContext.test(e)?0:o.length;r--&&(a=o[r],!_.relative[s=a.type]);)if((l=_.find[s])&&(n=l(a.matches[0].replace(wt,_t),bt.test(o[0].type)&&c(t.parentNode)||t))){if(o.splice(r,1),e=n.length&&f(o),!e)return J.apply(i,n),i;break}}return(u||A(e,h))(n,t,!N,i,bt.test(e)&&c(t.parentNode)||t),i},w.sortStable=I.split("").sort(W).join("")===I,w.detectDuplicates=!!P,R(),w.sortDetached=r(function(e){return 1&e.compareDocumentPosition(L.createElement("div"))}),r(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||o("type|href|height|width",function(e,t,i){return i?void 0:e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),w.attributes&&r(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||o("value",function(e,t,i){return i||"input"!==e.nodeName.toLowerCase()?void 0:e.defaultValue}),r(function(e){return null==e.getAttribute("disabled")})||o(it,function(e,t,i){var n;return i?void 0:e[t]===!0?t.toLowerCase():(n=e.getAttributeNode(t))&&n.specified?n.value:null}),t}(e);J.find=rt,J.expr=rt.selectors,J.expr[":"]=J.expr.pseudos,J.unique=rt.uniqueSort,J.text=rt.getText,J.isXMLDoc=rt.isXML,J.contains=rt.contains;var ot=J.expr.match.needsContext,at=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,st=/^.[^:#\[\.,]*$/;J.filter=function(e,t,i){var n=t[0];return i&&(e=":not("+e+")"),1===t.length&&1===n.nodeType?J.find.matchesSelector(n,e)?[n]:[]:J.find.matches(e,J.grep(t,function(e){return 1===e.nodeType}))},J.fn.extend({find:function(e){var t,i=this.length,n=[],r=this;if("string"!=typeof e)return this.pushStack(J(e).filter(function(){for(t=0;i>t;t++)if(J.contains(r[t],this))return!0}));for(t=0;i>t;t++)J.find(e,r[t],n);return n=this.pushStack(i>1?J.unique(n):n),n.selector=this.selector?this.selector+" "+e:e,n},filter:function(e){return this.pushStack(n(this,e||[],!1))},not:function(e){return this.pushStack(n(this,e||[],!0))},is:function(e){return!!n(this,"string"==typeof e&&ot.test(e)?J(e):e||[],!1).length}});var lt,ut=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,ct=J.fn.init=function(e,t){var i,n;if(!e)return this;if("string"==typeof e){if(i="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:ut.exec(e),!i||!i[1]&&t)return!t||t.jquery?(t||lt).find(e):this.constructor(t).find(e);if(i[1]){if(t=t instanceof J?t[0]:t,J.merge(this,J.parseHTML(i[1],t&&t.nodeType?t.ownerDocument||t:Q,!0)),at.test(i[1])&&J.isPlainObject(t))for(i in t)J.isFunction(this[i])?this[i](t[i]):this.attr(i,t[i]);return this}return n=Q.getElementById(i[2]),n&&n.parentNode&&(this.length=1,this[0]=n),this.context=Q,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):J.isFunction(e)?"undefined"!=typeof lt.ready?lt.ready(e):e(J):(void 0!==e.selector&&(this.selector=e.selector,this.context=e.context),J.makeArray(e,this))};ct.prototype=J.fn,lt=J(Q);var ht=/^(?:parents|prev(?:Until|All))/,ft={children:!0,contents:!0,next:!0,prev:!0};J.extend({dir:function(e,t,i){for(var n=[],r=void 0!==i;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(r&&J(e).is(i))break;n.push(e)}return n},sibling:function(e,t){for(var i=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&i.push(e);return i}}),J.fn.extend({has:function(e){var t=J(e,this),i=t.length;return this.filter(function(){for(var e=0;i>e;e++)if(J.contains(this,t[e]))return!0})},closest:function(e,t){for(var i,n=0,r=this.length,o=[],a=ot.test(e)||"string"!=typeof e?J(e,t||this.context):0;r>n;n++)for(i=this[n];i&&i!==t;i=i.parentNode)if(i.nodeType<11&&(a?a.index(i)>-1:1===i.nodeType&&J.find.matchesSelector(i,e))){o.push(i);break}return this.pushStack(o.length>1?J.unique(o):o)},index:function(e){return e?"string"==typeof e?W.call(J(e),this[0]):W.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(J.unique(J.merge(this.get(),J(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),J.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return J.dir(e,"parentNode")},parentsUntil:function(e,t,i){return J.dir(e,"parentNode",i)},next:function(e){return r(e,"nextSibling")},prev:function(e){return r(e,"previousSibling")},nextAll:function(e){return J.dir(e,"nextSibling")},prevAll:function(e){return J.dir(e,"previousSibling")},nextUntil:function(e,t,i){return J.dir(e,"nextSibling",i)},prevUntil:function(e,t,i){return J.dir(e,"previousSibling",i)},siblings:function(e){return J.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return J.sibling(e.firstChild)},contents:function(e){return e.contentDocument||J.merge([],e.childNodes)}},function(e,t){J.fn[e]=function(i,n){var r=J.map(this,t,i);return"Until"!==e.slice(-5)&&(n=i),n&&"string"==typeof n&&(r=J.filter(n,r)),this.length>1&&(ft[e]||J.unique(r),ht.test(e)&&r.reverse()),this.pushStack(r)}});var pt=/\S+/g,dt={};J.Callbacks=function(e){e="string"==typeof e?dt[e]||o(e):J.extend({},e);var t,i,n,r,a,s,l=[],u=!e.once&&[],c=function(o){for(t=e.memory&&o,i=!0,s=r||0,r=0,a=l.length,n=!0;l&&a>s;s++)if(l[s].apply(o[0],o[1])===!1&&e.stopOnFalse){t=!1;break}n=!1,l&&(u?u.length&&c(u.shift()):t?l=[]:h.disable())},h={add:function(){if(l){var i=l.length;!function o(t){J.each(t,function(t,i){var n=J.type(i);"function"===n?e.unique&&h.has(i)||l.push(i):i&&i.length&&"string"!==n&&o(i)})}(arguments),n?a=l.length:t&&(r=i,c(t))}return this},remove:function(){return l&&J.each(arguments,function(e,t){for(var i;(i=J.inArray(t,l,i))>-1;)l.splice(i,1),n&&(a>=i&&a--,s>=i&&s--)}),this},has:function(e){return e?J.inArray(e,l)>-1:!(!l||!l.length)},empty:function(){return l=[],a=0,this},disable:function(){return l=u=t=void 0,this},disabled:function(){return!l},lock:function(){return u=void 0,t||h.disable(),this},locked:function(){return!u},fireWith:function(e,t){return!l||i&&!u||(t=t||[],t=[e,t.slice?t.slice():t],n?u.push(t):c(t)),this},fire:function(){return h.fireWith(this,arguments),this},fired:function(){return!!i}};return h},J.extend({Deferred:function(e){var t=[["resolve","done",J.Callbacks("once memory"),"resolved"],["reject","fail",J.Callbacks("once memory"),"rejected"],["notify","progress",J.Callbacks("memory")]],i="pending",n={state:function(){return i},always:function(){return r.done(arguments).fail(arguments),this},then:function(){var e=arguments;return J.Deferred(function(i){J.each(t,function(t,o){var a=J.isFunction(e[t])&&e[t];r[o[1]](function(){var e=a&&a.apply(this,arguments);e&&J.isFunction(e.promise)?e.promise().done(i.resolve).fail(i.reject).progress(i.notify):i[o[0]+"With"](this===n?i.promise():this,a?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?J.extend(e,n):n}},r={};return n.pipe=n.then,J.each(t,function(e,o){var a=o[2],s=o[3];n[o[1]]=a.add,s&&a.add(function(){i=s},t[1^e][2].disable,t[2][2].lock),r[o[0]]=function(){return r[o[0]+"With"](this===r?n:this,arguments),this},r[o[0]+"With"]=a.fireWith}),n.promise(r),e&&e.call(r,r),r},when:function(e){var t,i,n,r=0,o=z.call(arguments),a=o.length,s=1!==a||e&&J.isFunction(e.promise)?a:0,l=1===s?e:J.Deferred(),u=function(e,i,n){return function(r){i[e]=this,n[e]=arguments.length>1?z.call(arguments):r,n===t?l.notifyWith(i,n):--s||l.resolveWith(i,n)}};if(a>1)for(t=new Array(a),i=new Array(a),n=new Array(a);a>r;r++)o[r]&&J.isFunction(o[r].promise)?o[r].promise().done(u(r,n,o)).fail(l.reject).progress(u(r,i,t)):--s;return s||l.resolveWith(n,o),l.promise()}});var mt;J.fn.ready=function(e){return J.ready.promise().done(e),this},J.extend({isReady:!1,readyWait:1,holdReady:function(e){e?J.readyWait++:J.ready(!0)},ready:function(e){(e===!0?--J.readyWait:J.isReady)||(J.isReady=!0,e!==!0&&--J.readyWait>0||(mt.resolveWith(Q,[J]),J.fn.triggerHandler&&(J(Q).triggerHandler("ready"),J(Q).off("ready"))))}}),J.ready.promise=function(t){return mt||(mt=J.Deferred(),"complete"===Q.readyState?setTimeout(J.ready):(Q.addEventListener("DOMContentLoaded",a,!1),e.addEventListener("load",a,!1))),mt.promise(t)},J.ready.promise();var gt=J.access=function(e,t,i,n,r,o,a){var s=0,l=e.length,u=null==i;if("object"===J.type(i)){r=!0;for(s in i)J.access(e,t,s,i[s],!0,o,a)}else if(void 0!==n&&(r=!0,J.isFunction(n)||(a=!0),u&&(a?(t.call(e,n),t=null):(u=t,t=function(e,t,i){return u.call(J(e),i)})),t))for(;l>s;s++)t(e[s],i,a?n:n.call(e[s],s,t(e[s],i)));return r?e:u?t.call(e):l?t(e[0],i):o};J.acceptData=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType},s.uid=1,s.accepts=J.acceptData,s.prototype={key:function(e){if(!s.accepts(e))return 0;var t={},i=e[this.expando];if(!i){i=s.uid++;try{t[this.expando]={value:i},Object.defineProperties(e,t)}catch(n){t[this.expando]=i,J.extend(e,t)}}return this.cache[i]||(this.cache[i]={}),i},set:function(e,t,i){var n,r=this.key(e),o=this.cache[r];if("string"==typeof t)o[t]=i;else if(J.isEmptyObject(o))J.extend(this.cache[r],t);else for(n in t)o[n]=t[n];return o},get:function(e,t){var i=this.cache[this.key(e)];return void 0===t?i:i[t]},access:function(e,t,i){var n;return void 0===t||t&&"string"==typeof t&&void 0===i?(n=this.get(e,t),void 0!==n?n:this.get(e,J.camelCase(t))):(this.set(e,t,i),void 0!==i?i:t)},remove:function(e,t){var i,n,r,o=this.key(e),a=this.cache[o];if(void 0===t)this.cache[o]={};else{J.isArray(t)?n=t.concat(t.map(J.camelCase)):(r=J.camelCase(t),t in a?n=[t,r]:(n=r,n=n in a?[n]:n.match(pt)||[])),i=n.length;for(;i--;)delete a[n[i]]}},hasData:function(e){return!J.isEmptyObject(this.cache[e[this.expando]]||{})},discard:function(e){e[this.expando]&&delete this.cache[e[this.expando]]}};var vt=new s,yt=new s,bt=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,xt=/([A-Z])/g;J.extend({hasData:function(e){return yt.hasData(e)||vt.hasData(e)},data:function(e,t,i){return yt.access(e,t,i)},removeData:function(e,t){yt.remove(e,t)},_data:function(e,t,i){return vt.access(e,t,i)},_removeData:function(e,t){vt.remove(e,t)}}),J.fn.extend({data:function(e,t){var i,n,r,o=this[0],a=o&&o.attributes;if(void 0===e){if(this.length&&(r=yt.get(o),1===o.nodeType&&!vt.get(o,"hasDataAttrs"))){for(i=a.length;i--;)a[i]&&(n=a[i].name,0===n.indexOf("data-")&&(n=J.camelCase(n.slice(5)),l(o,n,r[n])));vt.set(o,"hasDataAttrs",!0)}return r}return"object"==typeof e?this.each(function(){yt.set(this,e)}):gt(this,function(t){var i,n=J.camelCase(e);if(o&&void 0===t){if(i=yt.get(o,e),void 0!==i)return i;if(i=yt.get(o,n),void 0!==i)return i;if(i=l(o,n,void 0),void 0!==i)return i}else this.each(function(){var i=yt.get(this,n);yt.set(this,n,t),-1!==e.indexOf("-")&&void 0!==i&&yt.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){yt.remove(this,e)})}}),J.extend({queue:function(e,t,i){var n;return e?(t=(t||"fx")+"queue",n=vt.get(e,t),i&&(!n||J.isArray(i)?n=vt.access(e,t,J.makeArray(i)):n.push(i)),n||[]):void 0},dequeue:function(e,t){t=t||"fx";var i=J.queue(e,t),n=i.length,r=i.shift(),o=J._queueHooks(e,t),a=function(){J.dequeue(e,t)};"inprogress"===r&&(r=i.shift(),n--),r&&("fx"===t&&i.unshift("inprogress"),delete o.stop,r.call(e,a,o)),!n&&o&&o.empty.fire()},_queueHooks:function(e,t){var i=t+"queueHooks";return vt.get(e,i)||vt.access(e,i,{empty:J.Callbacks("once memory").add(function(){vt.remove(e,[t+"queue",i])})})}}),J.fn.extend({queue:function(e,t){var i=2;return"string"!=typeof e&&(t=e,e="fx",i--),arguments.length<i?J.queue(this[0],e):void 0===t?this:this.each(function(){var i=J.queue(this,e,t);J._queueHooks(this,e),"fx"===e&&"inprogress"!==i[0]&&J.dequeue(this,e)})},dequeue:function(e){return this.each(function(){J.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var i,n=1,r=J.Deferred(),o=this,a=this.length,s=function(){--n||r.resolveWith(o,[o])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";a--;)i=vt.get(o[a],e+"queueHooks"),i&&i.empty&&(n++,i.empty.add(s));return s(),r.promise(t)}});var wt=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,_t=["Top","Right","Bottom","Left"],St=function(e,t){return e=t||e,"none"===J.css(e,"display")||!J.contains(e.ownerDocument,e)},Mt=/^(?:checkbox|radio)$/i;!function(){var e=Q.createDocumentFragment(),t=e.appendChild(Q.createElement("div")),i=Q.createElement("input");i.setAttribute("type","radio"),i.setAttribute("checked","checked"),i.setAttribute("name","t"),t.appendChild(i),$.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,t.innerHTML="<textarea>x</textarea>",$.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue}();var Ct="undefined";$.focusinBubbles="onfocusin"in e;var At=/^key/,Tt=/^(?:mouse|pointer|contextmenu)|click/,Et=/^(?:focusinfocus|focusoutblur)$/,kt=/^([^.]*)(?:\.(.+)|)$/;J.event={global:{},add:function(e,t,i,n,r){var o,a,s,l,u,c,h,f,p,d,m,g=vt.get(e);if(g)for(i.handler&&(o=i,i=o.handler,r=o.selector),i.guid||(i.guid=J.guid++),(l=g.events)||(l=g.events={}),(a=g.handle)||(a=g.handle=function(t){return typeof J!==Ct&&J.event.triggered!==t.type?J.event.dispatch.apply(e,arguments):void 0}),t=(t||"").match(pt)||[""],u=t.length;u--;)s=kt.exec(t[u])||[],p=m=s[1],d=(s[2]||"").split(".").sort(),p&&(h=J.event.special[p]||{},p=(r?h.delegateType:h.bindType)||p,h=J.event.special[p]||{},c=J.extend({type:p,origType:m,data:n,handler:i,guid:i.guid,selector:r,needsContext:r&&J.expr.match.needsContext.test(r),namespace:d.join(".")},o),(f=l[p])||(f=l[p]=[],f.delegateCount=0,h.setup&&h.setup.call(e,n,d,a)!==!1||e.addEventListener&&e.addEventListener(p,a,!1)),h.add&&(h.add.call(e,c),c.handler.guid||(c.handler.guid=i.guid)),r?f.splice(f.delegateCount++,0,c):f.push(c),J.event.global[p]=!0)},remove:function(e,t,i,n,r){var o,a,s,l,u,c,h,f,p,d,m,g=vt.hasData(e)&&vt.get(e);if(g&&(l=g.events)){for(t=(t||"").match(pt)||[""],u=t.length;u--;)if(s=kt.exec(t[u])||[],p=m=s[1],d=(s[2]||"").split(".").sort(),p){for(h=J.event.special[p]||{},p=(n?h.delegateType:h.bindType)||p,f=l[p]||[],s=s[2]&&new RegExp("(^|\\.)"+d.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=f.length;o--;)c=f[o],!r&&m!==c.origType||i&&i.guid!==c.guid||s&&!s.test(c.namespace)||n&&n!==c.selector&&("**"!==n||!c.selector)||(f.splice(o,1),c.selector&&f.delegateCount--,h.remove&&h.remove.call(e,c));a&&!f.length&&(h.teardown&&h.teardown.call(e,d,g.handle)!==!1||J.removeEvent(e,p,g.handle),delete l[p])}else for(p in l)J.event.remove(e,p+t[u],i,n,!0);J.isEmptyObject(l)&&(delete g.handle,vt.remove(e,"events"))}},trigger:function(t,i,n,r){var o,a,s,l,u,c,h,f=[n||Q],p=K.call(t,"type")?t.type:t,d=K.call(t,"namespace")?t.namespace.split("."):[];if(a=s=n=n||Q,3!==n.nodeType&&8!==n.nodeType&&!Et.test(p+J.event.triggered)&&(p.indexOf(".")>=0&&(d=p.split("."),p=d.shift(),d.sort()),u=p.indexOf(":")<0&&"on"+p,t=t[J.expando]?t:new J.Event(p,"object"==typeof t&&t),t.isTrigger=r?2:3,t.namespace=d.join("."),t.namespace_re=t.namespace?new RegExp("(^|\\.)"+d.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=n),i=null==i?[t]:J.makeArray(i,[t]),h=J.event.special[p]||{},r||!h.trigger||h.trigger.apply(n,i)!==!1)){if(!r&&!h.noBubble&&!J.isWindow(n)){for(l=h.delegateType||p,Et.test(l+p)||(a=a.parentNode);a;a=a.parentNode)f.push(a),s=a;s===(n.ownerDocument||Q)&&f.push(s.defaultView||s.parentWindow||e)}for(o=0;(a=f[o++])&&!t.isPropagationStopped();)t.type=o>1?l:h.bindType||p,c=(vt.get(a,"events")||{})[t.type]&&vt.get(a,"handle"),c&&c.apply(a,i),c=u&&a[u],c&&c.apply&&J.acceptData(a)&&(t.result=c.apply(a,i),t.result===!1&&t.preventDefault());return t.type=p,r||t.isDefaultPrevented()||h._default&&h._default.apply(f.pop(),i)!==!1||!J.acceptData(n)||u&&J.isFunction(n[p])&&!J.isWindow(n)&&(s=n[u],s&&(n[u]=null),J.event.triggered=p,n[p](),J.event.triggered=void 0,s&&(n[u]=s)),t.result}},dispatch:function(e){e=J.event.fix(e);var t,i,n,r,o,a=[],s=z.call(arguments),l=(vt.get(this,"events")||{})[e.type]||[],u=J.event.special[e.type]||{};if(s[0]=e,e.delegateTarget=this,!u.preDispatch||u.preDispatch.call(this,e)!==!1){for(a=J.event.handlers.call(this,e,l),t=0;(r=a[t++])&&!e.isPropagationStopped();)for(e.currentTarget=r.elem,i=0;(o=r.handlers[i++])&&!e.isImmediatePropagationStopped();)(!e.namespace_re||e.namespace_re.test(o.namespace))&&(e.handleObj=o,e.data=o.data,n=((J.event.special[o.origType]||{}).handle||o.handler).apply(r.elem,s),void 0!==n&&(e.result=n)===!1&&(e.preventDefault(),e.stopPropagation()));return u.postDispatch&&u.postDispatch.call(this,e),e.result}},handlers:function(e,t){var i,n,r,o,a=[],s=t.delegateCount,l=e.target;if(s&&l.nodeType&&(!e.button||"click"!==e.type))for(;l!==this;l=l.parentNode||this)if(l.disabled!==!0||"click"!==e.type){for(n=[],i=0;s>i;i++)o=t[i],r=o.selector+" ",void 0===n[r]&&(n[r]=o.needsContext?J(r,this).index(l)>=0:J.find(r,this,null,[l]).length),n[r]&&n.push(o);n.length&&a.push({elem:l,handlers:n})}return s<t.length&&a.push({elem:this,handlers:t.slice(s)}),a},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var i,n,r,o=t.button;return null==e.pageX&&null!=t.clientX&&(i=e.target.ownerDocument||Q,n=i.documentElement,r=i.body,e.pageX=t.clientX+(n&&n.scrollLeft||r&&r.scrollLeft||0)-(n&&n.clientLeft||r&&r.clientLeft||0),e.pageY=t.clientY+(n&&n.scrollTop||r&&r.scrollTop||0)-(n&&n.clientTop||r&&r.clientTop||0)),e.which||void 0===o||(e.which=1&o?1:2&o?3:4&o?2:0),e}},fix:function(e){if(e[J.expando])return e;var t,i,n,r=e.type,o=e,a=this.fixHooks[r];for(a||(this.fixHooks[r]=a=Tt.test(r)?this.mouseHooks:At.test(r)?this.keyHooks:{}),n=a.props?this.props.concat(a.props):this.props,e=new J.Event(o),t=n.length;t--;)i=n[t],e[i]=o[i];return e.target||(e.target=Q),3===e.target.nodeType&&(e.target=e.target.parentNode),a.filter?a.filter(e,o):e},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==h()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===h()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&J.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(e){return J.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,i,n){var r=J.extend(new J.Event,i,{type:e,isSimulated:!0,originalEvent:{}});n?J.event.trigger(r,null,t):J.event.dispatch.call(t,r),r.isDefaultPrevented()&&i.preventDefault()}},J.removeEvent=function(e,t,i){e.removeEventListener&&e.removeEventListener(t,i,!1)},J.Event=function(e,t){return this instanceof J.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&e.returnValue===!1?u:c):this.type=e,t&&J.extend(this,t),this.timeStamp=e&&e.timeStamp||J.now(),void(this[J.expando]=!0)):new J.Event(e,t)},J.Event.prototype={isDefaultPrevented:c,isPropagationStopped:c,isImmediatePropagationStopped:c,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=u,e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=u,e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=u,e&&e.stopImmediatePropagation&&e.stopImmediatePropagation(),this.stopPropagation()}},J.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){J.event.special[e]={delegateType:t,bindType:t,handle:function(e){var i,n=this,r=e.relatedTarget,o=e.handleObj;return(!r||r!==n&&!J.contains(n,r))&&(e.type=o.origType,i=o.handler.apply(this,arguments),e.type=t),i}}}),$.focusinBubbles||J.each({focus:"focusin",blur:"focusout"},function(e,t){var i=function(e){J.event.simulate(t,e.target,J.event.fix(e),!0)};J.event.special[t]={setup:function(){var n=this.ownerDocument||this,r=vt.access(n,t);r||n.addEventListener(e,i,!0),vt.access(n,t,(r||0)+1)},teardown:function(){var n=this.ownerDocument||this,r=vt.access(n,t)-1;r?vt.access(n,t,r):(n.removeEventListener(e,i,!0),vt.remove(n,t))}}}),J.fn.extend({on:function(e,t,i,n,r){var o,a;if("object"==typeof e){"string"!=typeof t&&(i=i||t,t=void 0);for(a in e)this.on(a,t,i,e[a],r);return this}if(null==i&&null==n?(n=t,i=t=void 0):null==n&&("string"==typeof t?(n=i,i=void 0):(n=i,i=t,t=void 0)),n===!1)n=c;else if(!n)return this;return 1===r&&(o=n,n=function(e){return J().off(e),o.apply(this,arguments)},n.guid=o.guid||(o.guid=J.guid++)),this.each(function(){J.event.add(this,e,n,i,t)})},one:function(e,t,i,n){return this.on(e,t,i,n,1)},off:function(e,t,i){var n,r;if(e&&e.preventDefault&&e.handleObj)return n=e.handleObj,J(e.delegateTarget).off(n.namespace?n.origType+"."+n.namespace:n.origType,n.selector,n.handler),this;if("object"==typeof e){for(r in e)this.off(r,t,e[r]);return this}return(t===!1||"function"==typeof t)&&(i=t,t=void 0),i===!1&&(i=c),this.each(function(){J.event.remove(this,e,i,t)})},trigger:function(e,t){return this.each(function(){J.event.trigger(e,t,this)})},triggerHandler:function(e,t){var i=this[0];return i?J.event.trigger(e,t,i,!0):void 0}});var Pt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Rt=/<([\w:]+)/,Lt=/<|&#?\w+;/,Dt=/<(?:script|style|link)/i,Nt=/checked\s*(?:[^=]|=\s*.checked.)/i,Ft=/^$|\/(?:java|ecma)script/i,Gt=/^true\/(.*)/,Ot=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,jt={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};jt.optgroup=jt.option,jt.tbody=jt.tfoot=jt.colgroup=jt.caption=jt.thead,jt.th=jt.td,J.extend({clone:function(e,t,i){var n,r,o,a,s=e.cloneNode(!0),l=J.contains(e.ownerDocument,e);if(!($.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||J.isXMLDoc(e)))for(a=v(s),o=v(e),n=0,r=o.length;r>n;n++)y(o[n],a[n]);if(t)if(i)for(o=o||v(e),a=a||v(s),n=0,r=o.length;r>n;n++)g(o[n],a[n]);
else g(e,s);return a=v(s,"script"),a.length>0&&m(a,!l&&v(e,"script")),s},buildFragment:function(e,t,i,n){for(var r,o,a,s,l,u,c=t.createDocumentFragment(),h=[],f=0,p=e.length;p>f;f++)if(r=e[f],r||0===r)if("object"===J.type(r))J.merge(h,r.nodeType?[r]:r);else if(Lt.test(r)){for(o=o||c.appendChild(t.createElement("div")),a=(Rt.exec(r)||["",""])[1].toLowerCase(),s=jt[a]||jt._default,o.innerHTML=s[1]+r.replace(Pt,"<$1></$2>")+s[2],u=s[0];u--;)o=o.lastChild;J.merge(h,o.childNodes),o=c.firstChild,o.textContent=""}else h.push(t.createTextNode(r));for(c.textContent="",f=0;r=h[f++];)if((!n||-1===J.inArray(r,n))&&(l=J.contains(r.ownerDocument,r),o=v(c.appendChild(r),"script"),l&&m(o),i))for(u=0;r=o[u++];)Ft.test(r.type||"")&&i.push(r);return c},cleanData:function(e){for(var t,i,n,r,o=J.event.special,a=0;void 0!==(i=e[a]);a++){if(J.acceptData(i)&&(r=i[vt.expando],r&&(t=vt.cache[r]))){if(t.events)for(n in t.events)o[n]?J.event.remove(i,n):J.removeEvent(i,n,t.handle);vt.cache[r]&&delete vt.cache[r]}delete yt.cache[i[yt.expando]]}}}),J.fn.extend({text:function(e){return gt(this,function(e){return void 0===e?J.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=e)})},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=f(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=f(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var i,n=e?J.filter(e,this):this,r=0;null!=(i=n[r]);r++)t||1!==i.nodeType||J.cleanData(v(i)),i.parentNode&&(t&&J.contains(i.ownerDocument,i)&&m(v(i,"script")),i.parentNode.removeChild(i));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(J.cleanData(v(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return J.clone(this,e,t)})},html:function(e){return gt(this,function(e){var t=this[0]||{},i=0,n=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Dt.test(e)&&!jt[(Rt.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(Pt,"<$1></$2>");try{for(;n>i;i++)t=this[i]||{},1===t.nodeType&&(J.cleanData(v(t,!1)),t.innerHTML=e);t=0}catch(r){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=arguments[0];return this.domManip(arguments,function(t){e=this.parentNode,J.cleanData(v(this)),e&&e.replaceChild(t,this)}),e&&(e.length||e.nodeType)?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t){e=q.apply([],e);var i,n,r,o,a,s,l=0,u=this.length,c=this,h=u-1,f=e[0],m=J.isFunction(f);if(m||u>1&&"string"==typeof f&&!$.checkClone&&Nt.test(f))return this.each(function(i){var n=c.eq(i);m&&(e[0]=f.call(this,i,n.html())),n.domManip(e,t)});if(u&&(i=J.buildFragment(e,this[0].ownerDocument,!1,this),n=i.firstChild,1===i.childNodes.length&&(i=n),n)){for(r=J.map(v(i,"script"),p),o=r.length;u>l;l++)a=i,l!==h&&(a=J.clone(a,!0,!0),o&&J.merge(r,v(a,"script"))),t.call(this[l],a,l);if(o)for(s=r[r.length-1].ownerDocument,J.map(r,d),l=0;o>l;l++)a=r[l],Ft.test(a.type||"")&&!vt.access(a,"globalEval")&&J.contains(s,a)&&(a.src?J._evalUrl&&J._evalUrl(a.src):J.globalEval(a.textContent.replace(Ot,"")))}return this}}),J.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){J.fn[e]=function(e){for(var i,n=[],r=J(e),o=r.length-1,a=0;o>=a;a++)i=a===o?this:this.clone(!0),J(r[a])[t](i),H.apply(n,i.get());return this.pushStack(n)}});var It,Vt={},Ut=/^margin/,Bt=new RegExp("^("+wt+")(?!px)[a-z%]+$","i"),zt=function(e){return e.ownerDocument.defaultView.getComputedStyle(e,null)};!function(){function t(){a.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",a.innerHTML="",r.appendChild(o);var t=e.getComputedStyle(a,null);i="1%"!==t.top,n="4px"===t.width,r.removeChild(o)}var i,n,r=Q.documentElement,o=Q.createElement("div"),a=Q.createElement("div");a.style&&(a.style.backgroundClip="content-box",a.cloneNode(!0).style.backgroundClip="",$.clearCloneStyle="content-box"===a.style.backgroundClip,o.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute",o.appendChild(a),e.getComputedStyle&&J.extend($,{pixelPosition:function(){return t(),i},boxSizingReliable:function(){return null==n&&t(),n},reliableMarginRight:function(){var t,i=a.appendChild(Q.createElement("div"));return i.style.cssText=a.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",i.style.marginRight=i.style.width="0",a.style.width="1px",r.appendChild(o),t=!parseFloat(e.getComputedStyle(i,null).marginRight),r.removeChild(o),t}}))}(),J.swap=function(e,t,i,n){var r,o,a={};for(o in t)a[o]=e.style[o],e.style[o]=t[o];r=i.apply(e,n||[]);for(o in t)e.style[o]=a[o];return r};var qt=/^(none|table(?!-c[ea]).+)/,Ht=new RegExp("^("+wt+")(.*)$","i"),Wt=new RegExp("^([+-])=("+wt+")","i"),Xt={position:"absolute",visibility:"hidden",display:"block"},Yt={letterSpacing:"0",fontWeight:"400"},Kt=["Webkit","O","Moz","ms"];J.extend({cssHooks:{opacity:{get:function(e,t){if(t){var i=w(e,"opacity");return""===i?"1":i}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(e,t,i,n){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var r,o,a,s=J.camelCase(t),l=e.style;return t=J.cssProps[s]||(J.cssProps[s]=S(l,s)),a=J.cssHooks[t]||J.cssHooks[s],void 0===i?a&&"get"in a&&void 0!==(r=a.get(e,!1,n))?r:l[t]:(o=typeof i,"string"===o&&(r=Wt.exec(i))&&(i=(r[1]+1)*r[2]+parseFloat(J.css(e,t)),o="number"),null!=i&&i===i&&("number"!==o||J.cssNumber[s]||(i+="px"),$.clearCloneStyle||""!==i||0!==t.indexOf("background")||(l[t]="inherit"),a&&"set"in a&&void 0===(i=a.set(e,i,n))||(l[t]=i)),void 0)}},css:function(e,t,i,n){var r,o,a,s=J.camelCase(t);return t=J.cssProps[s]||(J.cssProps[s]=S(e.style,s)),a=J.cssHooks[t]||J.cssHooks[s],a&&"get"in a&&(r=a.get(e,!0,i)),void 0===r&&(r=w(e,t,n)),"normal"===r&&t in Yt&&(r=Yt[t]),""===i||i?(o=parseFloat(r),i===!0||J.isNumeric(o)?o||0:r):r}}),J.each(["height","width"],function(e,t){J.cssHooks[t]={get:function(e,i,n){return i?qt.test(J.css(e,"display"))&&0===e.offsetWidth?J.swap(e,Xt,function(){return A(e,t,n)}):A(e,t,n):void 0},set:function(e,i,n){var r=n&&zt(e);return M(e,i,n?C(e,t,n,"border-box"===J.css(e,"boxSizing",!1,r),r):0)}}}),J.cssHooks.marginRight=_($.reliableMarginRight,function(e,t){return t?J.swap(e,{display:"inline-block"},w,[e,"marginRight"]):void 0}),J.each({margin:"",padding:"",border:"Width"},function(e,t){J.cssHooks[e+t]={expand:function(i){for(var n=0,r={},o="string"==typeof i?i.split(" "):[i];4>n;n++)r[e+_t[n]+t]=o[n]||o[n-2]||o[0];return r}},Ut.test(e)||(J.cssHooks[e+t].set=M)}),J.fn.extend({css:function(e,t){return gt(this,function(e,t,i){var n,r,o={},a=0;if(J.isArray(t)){for(n=zt(e),r=t.length;r>a;a++)o[t[a]]=J.css(e,t[a],!1,n);return o}return void 0!==i?J.style(e,t,i):J.css(e,t)},e,t,arguments.length>1)},show:function(){return T(this,!0)},hide:function(){return T(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){St(this)?J(this).show():J(this).hide()})}}),J.Tween=E,E.prototype={constructor:E,init:function(e,t,i,n,r,o){this.elem=e,this.prop=i,this.easing=r||"swing",this.options=t,this.start=this.now=this.cur(),this.end=n,this.unit=o||(J.cssNumber[i]?"":"px")},cur:function(){var e=E.propHooks[this.prop];return e&&e.get?e.get(this):E.propHooks._default.get(this)},run:function(e){var t,i=E.propHooks[this.prop];return this.pos=t=this.options.duration?J.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):E.propHooks._default.set(this),this}},E.prototype.init.prototype=E.prototype,E.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=J.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){J.fx.step[e.prop]?J.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[J.cssProps[e.prop]]||J.cssHooks[e.prop])?J.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},E.propHooks.scrollTop=E.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},J.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},J.fx=E.prototype.init,J.fx.step={};var $t,Qt,Zt=/^(?:toggle|show|hide)$/,Jt=new RegExp("^(?:([+-])=|)("+wt+")([a-z%]*)$","i"),ei=/queueHooks$/,ti=[L],ii={"*":[function(e,t){var i=this.createTween(e,t),n=i.cur(),r=Jt.exec(t),o=r&&r[3]||(J.cssNumber[e]?"":"px"),a=(J.cssNumber[e]||"px"!==o&&+n)&&Jt.exec(J.css(i.elem,e)),s=1,l=20;if(a&&a[3]!==o){o=o||a[3],r=r||[],a=+n||1;do s=s||".5",a/=s,J.style(i.elem,e,a+o);while(s!==(s=i.cur()/n)&&1!==s&&--l)}return r&&(a=i.start=+a||+n||0,i.unit=o,i.end=r[1]?a+(r[1]+1)*r[2]:+r[2]),i}]};J.Animation=J.extend(N,{tweener:function(e,t){J.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");for(var i,n=0,r=e.length;r>n;n++)i=e[n],ii[i]=ii[i]||[],ii[i].unshift(t)},prefilter:function(e,t){t?ti.unshift(e):ti.push(e)}}),J.speed=function(e,t,i){var n=e&&"object"==typeof e?J.extend({},e):{complete:i||!i&&t||J.isFunction(e)&&e,duration:e,easing:i&&t||t&&!J.isFunction(t)&&t};return n.duration=J.fx.off?0:"number"==typeof n.duration?n.duration:n.duration in J.fx.speeds?J.fx.speeds[n.duration]:J.fx.speeds._default,(null==n.queue||n.queue===!0)&&(n.queue="fx"),n.old=n.complete,n.complete=function(){J.isFunction(n.old)&&n.old.call(this),n.queue&&J.dequeue(this,n.queue)},n},J.fn.extend({fadeTo:function(e,t,i,n){return this.filter(St).css("opacity",0).show().end().animate({opacity:t},e,i,n)},animate:function(e,t,i,n){var r=J.isEmptyObject(e),o=J.speed(t,i,n),a=function(){var t=N(this,J.extend({},e),o);(r||vt.get(this,"finish"))&&t.stop(!0)};return a.finish=a,r||o.queue===!1?this.each(a):this.queue(o.queue,a)},stop:function(e,t,i){var n=function(e){var t=e.stop;delete e.stop,t(i)};return"string"!=typeof e&&(i=t,t=e,e=void 0),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,r=null!=e&&e+"queueHooks",o=J.timers,a=vt.get(this);if(r)a[r]&&a[r].stop&&n(a[r]);else for(r in a)a[r]&&a[r].stop&&ei.test(r)&&n(a[r]);for(r=o.length;r--;)o[r].elem!==this||null!=e&&o[r].queue!==e||(o[r].anim.stop(i),t=!1,o.splice(r,1));(t||!i)&&J.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,i=vt.get(this),n=i[e+"queue"],r=i[e+"queueHooks"],o=J.timers,a=n?n.length:0;for(i.finish=!0,J.queue(this,e,[]),r&&r.stop&&r.stop.call(this,!0),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;a>t;t++)n[t]&&n[t].finish&&n[t].finish.call(this);delete i.finish})}}),J.each(["toggle","show","hide"],function(e,t){var i=J.fn[t];J.fn[t]=function(e,n,r){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(P(t,!0),e,n,r)}}),J.each({slideDown:P("show"),slideUp:P("hide"),slideToggle:P("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){J.fn[e]=function(e,i,n){return this.animate(t,e,i,n)}}),J.timers=[],J.fx.tick=function(){var e,t=0,i=J.timers;for($t=J.now();t<i.length;t++)e=i[t],e()||i[t]!==e||i.splice(t--,1);i.length||J.fx.stop(),$t=void 0},J.fx.timer=function(e){J.timers.push(e),e()?J.fx.start():J.timers.pop()},J.fx.interval=13,J.fx.start=function(){Qt||(Qt=setInterval(J.fx.tick,J.fx.interval))},J.fx.stop=function(){clearInterval(Qt),Qt=null},J.fx.speeds={slow:600,fast:200,_default:400},J.fn.delay=function(e,t){return e=J.fx?J.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,i){var n=setTimeout(t,e);i.stop=function(){clearTimeout(n)}})},function(){var e=Q.createElement("input"),t=Q.createElement("select"),i=t.appendChild(Q.createElement("option"));e.type="checkbox",$.checkOn=""!==e.value,$.optSelected=i.selected,t.disabled=!0,$.optDisabled=!i.disabled,e=Q.createElement("input"),e.value="t",e.type="radio",$.radioValue="t"===e.value}();var ni,ri,oi=J.expr.attrHandle;J.fn.extend({attr:function(e,t){return gt(this,J.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){J.removeAttr(this,e)})}}),J.extend({attr:function(e,t,i){var n,r,o=e.nodeType;if(e&&3!==o&&8!==o&&2!==o)return typeof e.getAttribute===Ct?J.prop(e,t,i):(1===o&&J.isXMLDoc(e)||(t=t.toLowerCase(),n=J.attrHooks[t]||(J.expr.match.bool.test(t)?ri:ni)),void 0===i?n&&"get"in n&&null!==(r=n.get(e,t))?r:(r=J.find.attr(e,t),null==r?void 0:r):null!==i?n&&"set"in n&&void 0!==(r=n.set(e,i,t))?r:(e.setAttribute(t,i+""),i):void J.removeAttr(e,t))},removeAttr:function(e,t){var i,n,r=0,o=t&&t.match(pt);if(o&&1===e.nodeType)for(;i=o[r++];)n=J.propFix[i]||i,J.expr.match.bool.test(i)&&(e[n]=!1),e.removeAttribute(i)},attrHooks:{type:{set:function(e,t){if(!$.radioValue&&"radio"===t&&J.nodeName(e,"input")){var i=e.value;return e.setAttribute("type",t),i&&(e.value=i),t}}}}}),ri={set:function(e,t,i){return t===!1?J.removeAttr(e,i):e.setAttribute(i,i),i}},J.each(J.expr.match.bool.source.match(/\w+/g),function(e,t){var i=oi[t]||J.find.attr;oi[t]=function(e,t,n){var r,o;return n||(o=oi[t],oi[t]=r,r=null!=i(e,t,n)?t.toLowerCase():null,oi[t]=o),r}});var ai=/^(?:input|select|textarea|button)$/i;J.fn.extend({prop:function(e,t){return gt(this,J.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[J.propFix[e]||e]})}}),J.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(e,t,i){var n,r,o,a=e.nodeType;if(e&&3!==a&&8!==a&&2!==a)return o=1!==a||!J.isXMLDoc(e),o&&(t=J.propFix[t]||t,r=J.propHooks[t]),void 0!==i?r&&"set"in r&&void 0!==(n=r.set(e,i,t))?n:e[t]=i:r&&"get"in r&&null!==(n=r.get(e,t))?n:e[t]},propHooks:{tabIndex:{get:function(e){return e.hasAttribute("tabindex")||ai.test(e.nodeName)||e.href?e.tabIndex:-1}}}}),$.optSelected||(J.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null}}),J.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){J.propFix[this.toLowerCase()]=this});var si=/[\t\r\n\f]/g;J.fn.extend({addClass:function(e){var t,i,n,r,o,a,s="string"==typeof e&&e,l=0,u=this.length;if(J.isFunction(e))return this.each(function(t){J(this).addClass(e.call(this,t,this.className))});if(s)for(t=(e||"").match(pt)||[];u>l;l++)if(i=this[l],n=1===i.nodeType&&(i.className?(" "+i.className+" ").replace(si," "):" ")){for(o=0;r=t[o++];)n.indexOf(" "+r+" ")<0&&(n+=r+" ");a=J.trim(n),i.className!==a&&(i.className=a)}return this},removeClass:function(e){var t,i,n,r,o,a,s=0===arguments.length||"string"==typeof e&&e,l=0,u=this.length;if(J.isFunction(e))return this.each(function(t){J(this).removeClass(e.call(this,t,this.className))});if(s)for(t=(e||"").match(pt)||[];u>l;l++)if(i=this[l],n=1===i.nodeType&&(i.className?(" "+i.className+" ").replace(si," "):"")){for(o=0;r=t[o++];)for(;n.indexOf(" "+r+" ")>=0;)n=n.replace(" "+r+" "," ");a=e?J.trim(n):"",i.className!==a&&(i.className=a)}return this},toggleClass:function(e,t){var i=typeof e;return"boolean"==typeof t&&"string"===i?t?this.addClass(e):this.removeClass(e):this.each(J.isFunction(e)?function(i){J(this).toggleClass(e.call(this,i,this.className,t),t)}:function(){if("string"===i)for(var t,n=0,r=J(this),o=e.match(pt)||[];t=o[n++];)r.hasClass(t)?r.removeClass(t):r.addClass(t);else(i===Ct||"boolean"===i)&&(this.className&&vt.set(this,"__className__",this.className),this.className=this.className||e===!1?"":vt.get(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",i=0,n=this.length;n>i;i++)if(1===this[i].nodeType&&(" "+this[i].className+" ").replace(si," ").indexOf(t)>=0)return!0;return!1}});var li=/\r/g;J.fn.extend({val:function(e){var t,i,n,r=this[0];{if(arguments.length)return n=J.isFunction(e),this.each(function(i){var r;1===this.nodeType&&(r=n?e.call(this,i,J(this).val()):e,null==r?r="":"number"==typeof r?r+="":J.isArray(r)&&(r=J.map(r,function(e){return null==e?"":e+""})),t=J.valHooks[this.type]||J.valHooks[this.nodeName.toLowerCase()],t&&"set"in t&&void 0!==t.set(this,r,"value")||(this.value=r))});if(r)return t=J.valHooks[r.type]||J.valHooks[r.nodeName.toLowerCase()],t&&"get"in t&&void 0!==(i=t.get(r,"value"))?i:(i=r.value,"string"==typeof i?i.replace(li,""):null==i?"":i)}}}),J.extend({valHooks:{option:{get:function(e){var t=J.find.attr(e,"value");return null!=t?t:J.trim(J.text(e))}},select:{get:function(e){for(var t,i,n=e.options,r=e.selectedIndex,o="select-one"===e.type||0>r,a=o?null:[],s=o?r+1:n.length,l=0>r?s:o?r:0;s>l;l++)if(i=n[l],!(!i.selected&&l!==r||($.optDisabled?i.disabled:null!==i.getAttribute("disabled"))||i.parentNode.disabled&&J.nodeName(i.parentNode,"optgroup"))){if(t=J(i).val(),o)return t;a.push(t)}return a},set:function(e,t){for(var i,n,r=e.options,o=J.makeArray(t),a=r.length;a--;)n=r[a],(n.selected=J.inArray(n.value,o)>=0)&&(i=!0);return i||(e.selectedIndex=-1),o}}}}),J.each(["radio","checkbox"],function(){J.valHooks[this]={set:function(e,t){return J.isArray(t)?e.checked=J.inArray(J(e).val(),t)>=0:void 0}},$.checkOn||(J.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),J.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){J.fn[t]=function(e,i){return arguments.length>0?this.on(t,null,e,i):this.trigger(t)}}),J.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,i){return this.on(e,null,t,i)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,i,n){return this.on(t,e,i,n)},undelegate:function(e,t,i){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",i)}});var ui=J.now(),ci=/\?/;J.parseJSON=function(e){return JSON.parse(e+"")},J.parseXML=function(e){var t,i;if(!e||"string"!=typeof e)return null;try{i=new DOMParser,t=i.parseFromString(e,"text/xml")}catch(n){t=void 0}return(!t||t.getElementsByTagName("parsererror").length)&&J.error("Invalid XML: "+e),t};var hi,fi,pi=/#.*$/,di=/([?&])_=[^&]*/,mi=/^(.*?):[ \t]*([^\r\n]*)$/gm,gi=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,vi=/^(?:GET|HEAD)$/,yi=/^\/\//,bi=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,xi={},wi={},_i="*/".concat("*");try{fi=location.href}catch(Si){fi=Q.createElement("a"),fi.href="",fi=fi.href}hi=bi.exec(fi.toLowerCase())||[],J.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:fi,type:"GET",isLocal:gi.test(hi[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":_i,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":J.parseJSON,"text xml":J.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?O(O(e,J.ajaxSettings),t):O(J.ajaxSettings,e)},ajaxPrefilter:F(xi),ajaxTransport:F(wi),ajax:function(e,t){function i(e,t,i,a){var l,c,v,y,x,_=t;2!==b&&(b=2,s&&clearTimeout(s),n=void 0,o=a||"",w.readyState=e>0?4:0,l=e>=200&&300>e||304===e,i&&(y=j(h,w,i)),y=I(h,y,w,l),l?(h.ifModified&&(x=w.getResponseHeader("Last-Modified"),x&&(J.lastModified[r]=x),x=w.getResponseHeader("etag"),x&&(J.etag[r]=x)),204===e||"HEAD"===h.type?_="nocontent":304===e?_="notmodified":(_=y.state,c=y.data,v=y.error,l=!v)):(v=_,(e||!_)&&(_="error",0>e&&(e=0))),w.status=e,w.statusText=(t||_)+"",l?d.resolveWith(f,[c,_,w]):d.rejectWith(f,[w,_,v]),w.statusCode(g),g=void 0,u&&p.trigger(l?"ajaxSuccess":"ajaxError",[w,h,l?c:v]),m.fireWith(f,[w,_]),u&&(p.trigger("ajaxComplete",[w,h]),--J.active||J.event.trigger("ajaxStop")))}"object"==typeof e&&(t=e,e=void 0),t=t||{};var n,r,o,a,s,l,u,c,h=J.ajaxSetup({},t),f=h.context||h,p=h.context&&(f.nodeType||f.jquery)?J(f):J.event,d=J.Deferred(),m=J.Callbacks("once memory"),g=h.statusCode||{},v={},y={},b=0,x="canceled",w={readyState:0,getResponseHeader:function(e){var t;if(2===b){if(!a)for(a={};t=mi.exec(o);)a[t[1].toLowerCase()]=t[2];t=a[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===b?o:null},setRequestHeader:function(e,t){var i=e.toLowerCase();return b||(e=y[i]=y[i]||e,v[e]=t),this},overrideMimeType:function(e){return b||(h.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>b)for(t in e)g[t]=[g[t],e[t]];else w.always(e[w.status]);return this},abort:function(e){var t=e||x;return n&&n.abort(t),i(0,t),this}};if(d.promise(w).complete=m.add,w.success=w.done,w.error=w.fail,h.url=((e||h.url||fi)+"").replace(pi,"").replace(yi,hi[1]+"//"),h.type=t.method||t.type||h.method||h.type,h.dataTypes=J.trim(h.dataType||"*").toLowerCase().match(pt)||[""],null==h.crossDomain&&(l=bi.exec(h.url.toLowerCase()),h.crossDomain=!(!l||l[1]===hi[1]&&l[2]===hi[2]&&(l[3]||("http:"===l[1]?"80":"443"))===(hi[3]||("http:"===hi[1]?"80":"443")))),h.data&&h.processData&&"string"!=typeof h.data&&(h.data=J.param(h.data,h.traditional)),G(xi,h,t,w),2===b)return w;u=h.global,u&&0===J.active++&&J.event.trigger("ajaxStart"),h.type=h.type.toUpperCase(),h.hasContent=!vi.test(h.type),r=h.url,h.hasContent||(h.data&&(r=h.url+=(ci.test(r)?"&":"?")+h.data,delete h.data),h.cache===!1&&(h.url=di.test(r)?r.replace(di,"$1_="+ui++):r+(ci.test(r)?"&":"?")+"_="+ui++)),h.ifModified&&(J.lastModified[r]&&w.setRequestHeader("If-Modified-Since",J.lastModified[r]),J.etag[r]&&w.setRequestHeader("If-None-Match",J.etag[r])),(h.data&&h.hasContent&&h.contentType!==!1||t.contentType)&&w.setRequestHeader("Content-Type",h.contentType),w.setRequestHeader("Accept",h.dataTypes[0]&&h.accepts[h.dataTypes[0]]?h.accepts[h.dataTypes[0]]+("*"!==h.dataTypes[0]?", "+_i+"; q=0.01":""):h.accepts["*"]);for(c in h.headers)w.setRequestHeader(c,h.headers[c]);if(h.beforeSend&&(h.beforeSend.call(f,w,h)===!1||2===b))return w.abort();x="abort";for(c in{success:1,error:1,complete:1})w[c](h[c]);if(n=G(wi,h,t,w)){w.readyState=1,u&&p.trigger("ajaxSend",[w,h]),h.async&&h.timeout>0&&(s=setTimeout(function(){w.abort("timeout")},h.timeout));try{b=1,n.send(v,i)}catch(_){if(!(2>b))throw _;i(-1,_)}}else i(-1,"No Transport");return w},getJSON:function(e,t,i){return J.get(e,t,i,"json")},getScript:function(e,t){return J.get(e,void 0,t,"script")}}),J.each(["get","post"],function(e,t){J[t]=function(e,i,n,r){return J.isFunction(i)&&(r=r||n,n=i,i=void 0),J.ajax({url:e,type:t,dataType:r,data:i,success:n})}}),J.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){J.fn[t]=function(e){return this.on(t,e)}}),J._evalUrl=function(e){return J.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},J.fn.extend({wrapAll:function(e){var t;return J.isFunction(e)?this.each(function(t){J(this).wrapAll(e.call(this,t))}):(this[0]&&(t=J(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this)},wrapInner:function(e){return this.each(J.isFunction(e)?function(t){J(this).wrapInner(e.call(this,t))}:function(){var t=J(this),i=t.contents();i.length?i.wrapAll(e):t.append(e)})},wrap:function(e){var t=J.isFunction(e);return this.each(function(i){J(this).wrapAll(t?e.call(this,i):e)})},unwrap:function(){return this.parent().each(function(){J.nodeName(this,"body")||J(this).replaceWith(this.childNodes)}).end()}}),J.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0},J.expr.filters.visible=function(e){return!J.expr.filters.hidden(e)};var Mi=/%20/g,Ci=/\[\]$/,Ai=/\r?\n/g,Ti=/^(?:submit|button|image|reset|file)$/i,Ei=/^(?:input|select|textarea|keygen)/i;J.param=function(e,t){var i,n=[],r=function(e,t){t=J.isFunction(t)?t():null==t?"":t,n[n.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(void 0===t&&(t=J.ajaxSettings&&J.ajaxSettings.traditional),J.isArray(e)||e.jquery&&!J.isPlainObject(e))J.each(e,function(){r(this.name,this.value)});else for(i in e)V(i,e[i],t,r);return n.join("&").replace(Mi,"+")},J.fn.extend({serialize:function(){return J.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=J.prop(this,"elements");return e?J.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!J(this).is(":disabled")&&Ei.test(this.nodeName)&&!Ti.test(e)&&(this.checked||!Mt.test(e))}).map(function(e,t){var i=J(this).val();return null==i?null:J.isArray(i)?J.map(i,function(e){return{name:t.name,value:e.replace(Ai,"\r\n")}}):{name:t.name,value:i.replace(Ai,"\r\n")}}).get()}}),J.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(e){}};var ki=0,Pi={},Ri={0:200,1223:204},Li=J.ajaxSettings.xhr();e.ActiveXObject&&J(e).on("unload",function(){for(var e in Pi)Pi[e]()}),$.cors=!!Li&&"withCredentials"in Li,$.ajax=Li=!!Li,J.ajaxTransport(function(e){var t;return $.cors||Li&&!e.crossDomain?{send:function(i,n){var r,o=e.xhr(),a=++ki;if(o.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(r in e.xhrFields)o[r]=e.xhrFields[r];e.mimeType&&o.overrideMimeType&&o.overrideMimeType(e.mimeType),e.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest");for(r in i)o.setRequestHeader(r,i[r]);t=function(e){return function(){t&&(delete Pi[a],t=o.onload=o.onerror=null,"abort"===e?o.abort():"error"===e?n(o.status,o.statusText):n(Ri[o.status]||o.status,o.statusText,"string"==typeof o.responseText?{text:o.responseText}:void 0,o.getAllResponseHeaders()))}},o.onload=t(),o.onerror=t("error"),t=Pi[a]=t("abort");try{o.send(e.hasContent&&e.data||null)}catch(s){if(t)throw s}},abort:function(){t&&t()}}:void 0}),J.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return J.globalEval(e),e}}}),J.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),J.ajaxTransport("script",function(e){if(e.crossDomain){var t,i;return{send:function(n,r){t=J("<script>").prop({async:!0,charset:e.scriptCharset,src:e.url}).on("load error",i=function(e){t.remove(),i=null,e&&r("error"===e.type?404:200,e.type)}),Q.head.appendChild(t[0])},abort:function(){i&&i()}}}});var Di=[],Ni=/(=)\?(?=&|$)|\?\?/;J.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Di.pop()||J.expando+"_"+ui++;return this[e]=!0,e}}),J.ajaxPrefilter("json jsonp",function(t,i,n){var r,o,a,s=t.jsonp!==!1&&(Ni.test(t.url)?"url":"string"==typeof t.data&&!(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&Ni.test(t.data)&&"data");return s||"jsonp"===t.dataTypes[0]?(r=t.jsonpCallback=J.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,s?t[s]=t[s].replace(Ni,"$1"+r):t.jsonp!==!1&&(t.url+=(ci.test(t.url)?"&":"?")+t.jsonp+"="+r),t.converters["script json"]=function(){return a||J.error(r+" was not called"),a[0]},t.dataTypes[0]="json",o=e[r],e[r]=function(){a=arguments},n.always(function(){e[r]=o,t[r]&&(t.jsonpCallback=i.jsonpCallback,Di.push(r)),a&&J.isFunction(o)&&o(a[0]),a=o=void 0}),"script"):void 0}),J.parseHTML=function(e,t,i){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(i=t,t=!1),t=t||Q;var n=at.exec(e),r=!i&&[];return n?[t.createElement(n[1])]:(n=J.buildFragment([e],t,r),r&&r.length&&J(r).remove(),J.merge([],n.childNodes))};var Fi=J.fn.load;J.fn.load=function(e,t,i){if("string"!=typeof e&&Fi)return Fi.apply(this,arguments);var n,r,o,a=this,s=e.indexOf(" ");return s>=0&&(n=J.trim(e.slice(s)),e=e.slice(0,s)),J.isFunction(t)?(i=t,t=void 0):t&&"object"==typeof t&&(r="POST"),a.length>0&&J.ajax({url:e,type:r,dataType:"html",data:t}).done(function(e){o=arguments,a.html(n?J("<div>").append(J.parseHTML(e)).find(n):e)}).complete(i&&function(e,t){a.each(i,o||[e.responseText,t,e])}),this},J.expr.filters.animated=function(e){return J.grep(J.timers,function(t){return e===t.elem}).length};var Gi=e.document.documentElement;J.offset={setOffset:function(e,t,i){var n,r,o,a,s,l,u,c=J.css(e,"position"),h=J(e),f={};"static"===c&&(e.style.position="relative"),s=h.offset(),o=J.css(e,"top"),l=J.css(e,"left"),u=("absolute"===c||"fixed"===c)&&(o+l).indexOf("auto")>-1,u?(n=h.position(),a=n.top,r=n.left):(a=parseFloat(o)||0,r=parseFloat(l)||0),J.isFunction(t)&&(t=t.call(e,i,s)),null!=t.top&&(f.top=t.top-s.top+a),null!=t.left&&(f.left=t.left-s.left+r),"using"in t?t.using.call(e,f):h.css(f)}},J.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){J.offset.setOffset(this,e,t)});var t,i,n=this[0],r={top:0,left:0},o=n&&n.ownerDocument;if(o)return t=o.documentElement,J.contains(t,n)?(typeof n.getBoundingClientRect!==Ct&&(r=n.getBoundingClientRect()),i=U(o),{top:r.top+i.pageYOffset-t.clientTop,left:r.left+i.pageXOffset-t.clientLeft}):r},position:function(){if(this[0]){var e,t,i=this[0],n={top:0,left:0};return"fixed"===J.css(i,"position")?t=i.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),J.nodeName(e[0],"html")||(n=e.offset()),n.top+=J.css(e[0],"borderTopWidth",!0),n.left+=J.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-J.css(i,"marginTop",!0),left:t.left-n.left-J.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||Gi;e&&!J.nodeName(e,"html")&&"static"===J.css(e,"position");)e=e.offsetParent;return e||Gi})}}),J.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,i){var n="pageYOffset"===i;J.fn[t]=function(r){return gt(this,function(t,r,o){var a=U(t);return void 0===o?a?a[i]:t[r]:void(a?a.scrollTo(n?e.pageXOffset:o,n?o:e.pageYOffset):t[r]=o)},t,r,arguments.length,null)}}),J.each(["top","left"],function(e,t){J.cssHooks[t]=_($.pixelPosition,function(e,i){return i?(i=w(e,t),Bt.test(i)?J(e).position()[t]+"px":i):void 0})}),J.each({Height:"height",Width:"width"},function(e,t){J.each({padding:"inner"+e,content:t,"":"outer"+e},function(i,n){J.fn[n]=function(n,r){var o=arguments.length&&(i||"boolean"!=typeof n),a=i||(n===!0||r===!0?"margin":"border");return gt(this,function(t,i,n){var r;return J.isWindow(t)?t.document.documentElement["client"+e]:9===t.nodeType?(r=t.documentElement,Math.max(t.body["scroll"+e],r["scroll"+e],t.body["offset"+e],r["offset"+e],r["client"+e])):void 0===n?J.css(t,i,a):J.style(t,i,n,a)},t,o?n:void 0,o,null)}})}),J.fn.size=function(){return this.length},J.fn.andSelf=J.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return J});var Oi=e.jQuery,ji=e.$;return J.noConflict=function(t){return e.$===J&&(e.$=ji),t&&e.jQuery===J&&(e.jQuery=Oi),J},typeof t===Ct&&(e.jQuery=e.$=J),J})},{}],67:[function(e,t){t.exports=function(e){var t=e.Interface,i={hasPageButtons:!1,layout:{bounds:[0,0,1,1],widget:null,sacrosanct:!1,parent:null,id:0,children:[]},getBestChildForNewWidget:function(e){function t(e){if(0===e.children.length)null===e.widget?e.bounds[2]+e.bounds[3]>i&&(n=e,i=e.bounds[2]+e.bounds[3]):(e.bounds[2]+e.bounds[3])/2>i&&(n=e,i=(e.bounds[2]+e.bounds[3])/2);else for(var r=0;r<e.children.length;r++){var o=e.children[r];t(o,i)}}var i=0;e=0;
var n=this.layout;return t(n),n},placeWidget:function(e,t){null===e&&console.log("ALERT ALERT ALERT ALERT ALERT ALERT ALERT ALERT ALERT ALERT ALERT ALERT");var i=null;if(i=this.getBestChildForNewWidget(0),null===i.widget)i.widget=e,e.bounds=i.bounds,e.div=i;else{var n,r,o=i.widget,a=i.bounds[2]>i.bounds[3]?0:1;n=0==a?i.bounds[2]/2:i.bounds[2],r=1==a?i.bounds[3]/2:i.bounds[3];var s={bounds:[i.bounds[0],i.bounds[1],n,r],widget:o,sacrosanct:!1,parent:i,children:[]},l=0==a?i.bounds[0]+n:i.bounds[0],u=1==a?i.bounds[1]+r:i.bounds[1],c={bounds:[l,u,n,r],widget:e,sacrosanct:t,parent:i,children:[]};s.widget.div=s,s.widget.bounds=s.bounds,c.widget.bounds=c.bounds,c.widget.div=c,i.children.push(s),i.children.push(c),i.widget=null}},removeWidget:function(e){e.div.widget=null;var t=e.div.parent;if(null!==t){var i=jQuery.inArray(e.div,t.children),n=1===i?0:1;null===t.children[n].widget&&(t.children=[],t.widget=null)}else e.div.children=[];this.redoLayout()},reset:function(){this.layout={bounds:[0,0,1,1],widget:null,sacrosanct:!1,parent:null,id:0,children:[]}},redoLayout:function(){this.layout={bounds:[0,0,1,1],widget:null,sacrosanct:!1,parent:null,id:0,children:[]};for(var e=0;e<t.panel.children.length;e++){var i=t.panel.children[e];i.useAutogui&&this.placeWidget(i)}}};return i}},{}],68:[function(e,t){t.exports=function(t){var i=t.dollar,n=e("./mouse.js"),r={value:{min:0,max:1,output:t.LINEAR,wrap:!1,timescale:"interface"}},o=0,a=e("interface.js"),s={autogui:e("./autogui")(t),mode:"local",client:0,panel:null,socket:null,callbacks:{},newPanel:function(e){"undefined"==typeof e?e=t.isInstrument?{bodyElement:document.querySelector("body")}:Layout.addColumn({type:"interface"}):e.bodyElement.innerHTML="",e.bodyElement.length&&(e.bodyElement=e.bodyElement[0]);var n=new a.Panel({container:e.bodyElement,useRelativeSizesAndPositions:!0,font:"normal 16px Helvetica"});return n.canvas.style.position="relative",n.canvas.style.width=e.bodyElement.style.width,n.canvas.style.height=e.bodyElement.style.height,this.panel=n,this.panel.column=e,e.onresize=this.onresize.bind(n),s.autogui.reset(),e.onclose=function(){s.panel=null},i.subscribe("/gibber/clear",function(){e.close()}),n},onresize:function(){i(this.canvas).css({position:"relative",width:i(this.column.bodyElement).width(),height:i(this.column.bodyElement).height()}),this.redoBoundaries()},initializers:{Accelerometer:function(e){var i={x:{min:0,max:1,output:t.LINEAR,wrap:!1,timescale:"interface"},y:{min:0,max:1,output:t.LINEAR,wrap:!1,timescale:"interface"},z:{min:0,max:1,output:t.LINEAR,wrap:!1,timescale:"interface"}};return delete e.x,delete e.y,delete e.z,t.createProxyProperties(e,i,!1),e.onvaluechange=function(t,i,n){console.log(t,i,n),e.x(t),e.y(i),e.z(n)},e.start(),e},Orientation:function(e){var i={x:{min:0,max:1,output:t.LINEAR,wrap:!1,timescale:"interface"},y:{min:0,max:1,output:t.LINEAR,wrap:!1,timescale:"interface"},z:{min:0,max:1,output:t.LINEAR,wrap:!1,timescale:"interface"}};return delete e.x,delete e.y,delete e.z,t.createProxyProperties(e,i,!1),e.onvaluechange=function(t,i,n){e.x(t),e.y(i),e.z(n)},e.start(),e},XY:function(e){for(var i={x:{min:0,max:1,output:t.LINEAR,wrap:!1,timescale:"interface"},y:{min:0,max:1,output:t.LINEAR,wrap:!1,timescale:"interface"}},n=0;n<e.values.length;n++)!function(){var r=n,o=e.values[r],a=0,s=0;Object.defineProperties(o,{x:{configurable:!0,get:function(){return a},set:function(e){a=e}},y:{configurable:!0,get:function(){return s},set:function(e){s=e}}}),t.createProxyProperties(o,i,!1),e[r]=o}()},HBox:function(e){for(var t=0;t<e.children.length;t++)!function(){var i=e.children[t];i.kill(),i.panel=e.proxyPanel,Object.defineProperty(e,t,{configurable:!0,get:function(){return i},set:function(){}})}();var i=e.add;e.add=function(){var t=Array.prototype.slice.call(arguments,0);t=t.map(function(e){return e.kill()});for(var n=e.children.length,r=0;r<t.length;r++)!function(){var i=t[r];Object.defineProperty(e,n++,{configurable:!0,get:function(){return i},set:function(){}})}();return i.apply(e,t)},e.layout(),e.draw()},VBox:function(e){for(var t=0;t<e.children.length;t++)!function(){var i=e.children[t];i.kill(),i.panel=e.proxyPanel,Object.defineProperty(e,t,{configurable:!0,get:function(){return i},set:function(){}})}();var i=e.add;e.add=function(){var t=Array.prototype.slice.call(arguments,0);return t=t.map(function(e){return e.kill()}),i.apply(e,t)},e.layout(),e.draw()},MultiSlider:function(e){var i={value:{min:0,max:1,output:t.LINEAR,wrap:!1,timescale:"interface"}};e.children=[];for(var n=0;n<e.count;n++)!function(){var r=n,o={},a=e.values[n];Object.defineProperties(o,{value:{configurable:!0,get:function(){return a},set:function(e){a=e}}}),t.createProxyProperties(o,i,!1),e[r]=o,e.children.push(o),o.valueOf=function(){return this.value()},o.index=r}();e.length=e.count,e.onvaluechange=function(t,i){e[t].value=i}},Patchbay:function(e){e.onconnection=function(e,t){t.object[t.name]=e.object[e.Name]},e.ondisconnection=function(e,t){t.object[t.Name].mapping.remove()},e._createConnection=e.createConnection,e.createConnection=function(t){var i=(this.points[t[0]],this.points[t[1]]);return"Out"===i.Name?void console.log("You can't feed input to an Out patch point"):void e._createConnection(t)}},Paint:function(e){var i={x:{min:0,max:1,output:t.LINEAR,wrap:!1,timescale:"interface"},y:{min:0,max:1,output:t.LINEAR,wrap:!1,timescale:"interface"}},n=e.value,r=0,o=0;Object.defineProperties(n,{x:{get:function(){return r},set:function(e){r=e}},y:{get:function(){return o},set:function(e){o=e}}}),t.createProxyProperties(n,i,!1)},Piano:function(e){var t=e.target;Object.defineProperty(e,"target",{get:function(){return t},set:function(i){t=i;for(var n=0;n<e.children.length;n++)e.children[n].target=t,e.children[n].key="undefined"!=typeof t.note?"note":"frequency",e.children[n].sendTargetMessage=function(){this.target&&this.target.note&&this.target.note(this.frequency,this.value)}}}),e.onboundschange=function(){this._initialized&&this.placeKeys(),this.target=this.target}}},defaults:{XY:{childWidth:40,fill:"rgba(255,255,255,.1)",stroke:"#aaa",numChildren:2,usePhysics:!1},Piano:{startletter:"C",startoctave:3,endletter:"C",endoctave:4,background:"white",fill:"black"}},nonGraphical:["Accelerometer","Orientation"],widget:function(e,n){var l=-1!==s.nonGraphical.indexOf(n);if("local"===this.mode){null!==s.panel||l||s.newPanel(),"undefined"==typeof e&&(e={mode:"toggle"}),s.defaults[n]&&(e=i.extend(s.defaults[n],e));var u=new a[n](e);if(u.type="mapping","undefined"==typeof u.bounds[0]&&(l||(s.autogui.placeWidget(u,!1),u.useAutogui=!0)),l||t.Interface.panel.add(u),s.initializers[n])s.initializers[n](u,e);else{var c="value",h=r[c],f=i.extend({},h,{Name:c.charAt(0).toUpperCase()+c.slice(1),propertyName:c,type:"mapping",value:1,object:u,targets:[]});Object.defineProperty(f.object,f.Name,{get:function(){return f},set:function(e){"object"==typeof e&&"mapping"===e.type&&t.createMappingObject(f,e)}}),u.mappingObjects=[f],u.mappingProperties=r,u.replaceWith=function(e){u.target&&(e.target=u.target),u.key&&(e.key=u.key),s.panel.remove(u),s.panel.add(e),e.setValue(u.value);for(var t=0;t<this.mappingObjects.length;t++){var i=this.mappingObjects[t];if(i.targets.length>0)for(var n=0;n<i.targets.length;n++){var r=i.targets[n];e.mappingProperties[i.propertyName]?r[0].mapping.replace(e,i.propertyName,i.Name):r[0].mapping.remove()}}}}return"number"==typeof u.value&&(u.valueOf=function(){return u.value}),u.mappings=[],u.kill=u.remove=function(){for(var e=0;e<u.mappings.length;e++)u.mappings[e].remove();return u.clearMarks&&u.clearMarks(),l||(u.useAutogui?(s.autogui.removeWidget(u),u.panel.remove(u)):u.panel.remove(u)),u},Object.defineProperty(u,"_",{get:function(){return u.kill()},set:function(){}}),u}e=e||{};var u={value:0,type:"mapping",min:0,max:1,client:this.client,remoteID:"/"+(e.name||o++),mappings:[],setValue:function(e){this.value=e;var t={address:"/clients/"+this.client+this.remoteID,parameters:[e]};s.socket.send(JSON.stringify(t))},kill:function(){var e={address:"/clients/"+this.client+"/interface/removeWidget",parameters:[u.remoteID]};s.socket.send(JSON.stringify(e));for(var t=0;t<u.mappings.length;t++)u.mappings[t].remove();u.clearMarks&&u.clearMarks(),u.useAutogui&&s.autogui.removeWidget(u)},replaceWith:function(){this.kill()}};Object.defineProperty(u,"_",{get:function(){u.kill()},set:function(){}});var c="value",h=r[c],f=i.extend({},h);i.extend(f,{Name:c.charAt(0).toUpperCase()+c.slice(1),propertyName:c,type:"mapping",value:1,object:u,targets:[]}),Object.defineProperty(f.object,f.Name,{get:function(){return f},set:function(e){"object"==typeof e&&"mapping"===e.type&&t.createMappingObject(f,e)}});var p="";Object.defineProperty(u,"label",{get:function(){return p},set:function(e){p=e;var t={address:"/clients/"+this.client+"/interface/setLabel",parameters:[u.remoteID,p]};s.socket.send(JSON.stringify(t))}}),u.mappingObjects=[f],u.mappingProperties=r,this.callbacks[u.remoteID]=function(e){u.value=e.parameters[0],u.onvaluechange&&u.onvaluechange()};var d={address:"/clients/"+this.client+"/interface/addWidget",parameters:[{type:n,target:"OSC",key:u.remoteID,name:u.remoteID}]};return this.socket.send(JSON.stringify(d)),u},use:function(e,i){if("remote"===e){if(null===s.socket||3===s.socket.readyState){var n=JSON.stringify({address:"/createLivecodeServer",parameters:[]}),r=s.socket=new WebSocket("ws://127.0.0.1:10001");s.socket.onopen=function(){r.send(n)},s.socket.onmessage=function(e){var t;try{t=JSON.parse(e.data)}catch(i){return void console.error("ERROR on parsing JSON",i)}s.callbacks[t.address]&&s.callbacks[t.address](t)},window.OSC=t.Interface.socket,window.OSC.callbacks=t.Interface.callbacks}s.mode="remote",s.client=i}else s.mode="local"},clear:function(e){var t=isNaN(e)?s.client:e;if("*"===e&&(t="*"),"remote"===s.mode){var i={address:"/clients/"+t+"/interface/clear",parameters:[]};s.socket.send(JSON.stringify(i))}},button:function(e){return s.widget(e,"Button")},slider:function(e){return s.widget(e,"Slider")},multislider:function(e){return s.widget(e,"MultiSlider")},knob:function(e){return s.widget(e,"Knob")},xy:function(e){return s.widget(e,"XY")},piano:function(e){return s.widget(e,"Piano")},paint:function(e){return s.widget(e,"Paint")},patchbay:function(e){return s.widget(e,"Patchbay")},crossfader:function(e){return s.widget(e,"Crossfader")},accelerometer:function(e){return s.widget(e,"Accelerometer")},orientation:function(e){return s.widget(e,"Orientation")},patchbay:function(e){if(arguments.length>1||e.name){var t={points:Array.prototype.slice.call(arguments,0)};e=t}return s.widget(e,"Patchbay")},hbox:function(e){if(arguments.length>1||e.name){var t={children:Array.prototype.slice.call(arguments,0)};e=t}return s.widget(e,"HBox")},vbox:function(e){if(arguments.length>1||e.name){var t={children:Array.prototype.slice.call(arguments,0)};e=t}return s.widget(e,"VBox")},"export":function(e){e.Button=s.button,e.Slider=s.slider,e.MultiSlider=s.multislider,e.Knob=s.knob,e.XY=s.xy,e.Keyboard=s.piano,e.Paint=s.paint,e.Panel=s.newPanel.bind(s),e.Patchbay=s.patchbay,e.HBox=s.hbox,e.VBox=s.vbox,e.Crossfader=s.crossfader,e.Accelerometer=s.accelerometer,e.Orientation=s.orientation,e.Mouse=n(t)}};return s.use=a.use,s.clear=a.clear,s}},{"./autogui":67,"./mouse.js":69,"interface.js":65}],69:[function(e,t){t.exports=function(e){"use strict";var t=null,i=e.dollar,n=0,r={x:{min:0,max:1,timescale:"interface",output:e.LINEAR},y:{min:0,max:1,timescale:"interface",output:e.LINEAR},shiftX:{min:0,max:1,timescale:"interface",output:e.LINEAR},shiftY:{min:0,max:1,timescale:"interface",output:e.LINEAR},ctrlX:{min:0,max:1,timescale:"interface",output:e.LINEAR},ctrlY:{min:0,max:1,timescale:"interface",output:e.LINEAR},button:{min:0,max:1,timescale:"interface",output:e.LINEAR}};if(null!==t)return t;t={};var o=0,a=0;if(i.extend(t,{x:0,y:0,prevX:0,prevY:0,shiftX:0,shiftY:0,prevShiftX:0,prevShiftY:0,button:0,isOn:!1,name:"Mouse",_onmousemove:function(i){var r="",s="";i.shiftKey&&(r="shift"),i.ctrlKey&&(r="ctrl"),s=""===r?"":r.charAt(0).toUpperCase()+r.slice(1),t["prev"+s+"X"]=o,t["prev"+s+"Y"]=a,o=t[r+(""===r?"x":"X")]=i.pageX-window.scrollX,a=t[r+(""===r?"y":"Y")]=i.pageY-window.scrollY,e.Environment&&(a-=n,t[r+(""===r?"y":"Y")]-=n),"function"==typeof t.onvaluechange&&t.onvaluechange()},_onmousedown:function(){t.button=1,"function"==typeof t.onvaluechange&&t.onvaluechange()},_onmouseup:function(){t.button=0,"function"==typeof t.onvaluechange&&t.onvaluechange()},on:function(){if(!t.isOn){if(t.isOn=!0,e.Environment){if(t.X.max=t.ww=i(window).width(),e.Environment.Layout.isFullScreen)t.Y.max=t.wh=i(window).height();else{var r=i(window).height()-i("thead").height()-i("tfoot").height();t.Y.max=t.wh=r}n=i("thead").height()}else t.X.max=window.innerWidth,t.Y.max=window.innerHeight;window.onmousemove=t._onmousemove}},off:function(){t.isOn&&(i(window).off("mousemove",t._onmousemove),t.isOn=!1)},toggle:function(){t.isOn?t.off():t.on()}}),e.Environment)if(e.Environment.Layout.isFullScreen)r.x.max=i(window).width(),r.y.max=i(window).height();else{var s=i(window).height()-i("thead").height()-i("tfoot").height();r.x.max=i(window).width(),r.y.max=s}else r.x.max=window.innerWidth,r.y.max=window.innerHeight;for(var l in r)!function(){var e=l.charAt(0).toUpperCase()+l.slice(1),i=t[l];Object.defineProperty(t,e,{configurable:!0,get:function(){return"Button"!==e&&t.on(),i},set:function(e){return i=e,t}})}();return i.subscribe("/layout/contentResize",function(e){t.ww=t.X.max=e.w,t.wh=t.Y.max=e.h}),window.onmousedown=t._onmousedown,window.onmouseup=t._onmouseup,e.createProxyProperties(t,r,!0),t}},{}],70:[function(e,t,i){function n(e,t,i){if(!(this instanceof n))return new n(e,t,i);var r=typeof e;if("base64"===t&&"string"===r)for(e=E(e);e.length%4!==0;)e+="=";var o;if("number"===r)o=P(e);else if("string"===r)o=n.byteLength(e,t);else{if("object"!==r)throw new Error("First argument needs to be a number, array or string.");o=P(e.length)}var a;n._useTypedArrays?a=n._augment(new Uint8Array(o)):(a=this,a.length=o,a._isBuffer=!0);var s;if(n._useTypedArrays&&"number"==typeof e.byteLength)a._set(e);else if(L(e))for(s=0;o>s;s++)a[s]=n.isBuffer(e)?e.readUInt8(s):e[s];else if("string"===r)a.write(e,0,t);else if("number"===r&&!n._useTypedArrays&&!i)for(s=0;o>s;s++)a[s]=0;return a}function r(e,t,i,r){i=Number(i)||0;var o=e.length-i;r?(r=Number(r),r>o&&(r=o)):r=o;var a=t.length;z(a%2===0,"Invalid hex string"),r>a/2&&(r=a/2);for(var s=0;r>s;s++){var l=parseInt(t.substr(2*s,2),16);z(!isNaN(l),"Invalid hex string"),e[i+s]=l}return n._charsWritten=2*s,s}function o(e,t,i,r){var o=n._charsWritten=j(N(t),e,i,r);return o}function a(e,t,i,r){var o=n._charsWritten=j(F(t),e,i,r);return o}function s(e,t,i,n){return a(e,t,i,n)}function l(e,t,i,r){var o=n._charsWritten=j(O(t),e,i,r);return o}function u(e,t,i,r){var o=n._charsWritten=j(G(t),e,i,r);return o}function c(e,t,i){return q.fromByteArray(0===t&&i===e.length?e:e.slice(t,i))}function h(e,t,i){var n="",r="";i=Math.min(e.length,i);for(var o=t;i>o;o++)e[o]<=127?(n+=I(r)+String.fromCharCode(e[o]),r=""):r+="%"+e[o].toString(16);return n+I(r)}function f(e,t,i){var n="";i=Math.min(e.length,i);for(var r=t;i>r;r++)n+=String.fromCharCode(e[r]);return n}function p(e,t,i){return f(e,t,i)}function d(e,t,i){var n=e.length;(!t||0>t)&&(t=0),(!i||0>i||i>n)&&(i=n);for(var r="",o=t;i>o;o++)r+=D(e[o]);return r}function m(e,t,i){for(var n=e.slice(t,i),r="",o=0;o<n.length;o+=2)r+=String.fromCharCode(n[o]+256*n[o+1]);return r}function g(e,t,i,n){n||(z("boolean"==typeof i,"missing or invalid endian"),z(void 0!==t&&null!==t,"missing offset"),z(t+1<e.length,"Trying to read beyond buffer length"));var r=e.length;if(!(t>=r)){var o;return i?(o=e[t],r>t+1&&(o|=e[t+1]<<8)):(o=e[t]<<8,r>t+1&&(o|=e[t+1])),o}}function v(e,t,i,n){n||(z("boolean"==typeof i,"missing or invalid endian"),z(void 0!==t&&null!==t,"missing offset"),z(t+3<e.length,"Trying to read beyond buffer length"));var r=e.length;if(!(t>=r)){var o;return i?(r>t+2&&(o=e[t+2]<<16),r>t+1&&(o|=e[t+1]<<8),o|=e[t],r>t+3&&(o+=e[t+3]<<24>>>0)):(r>t+1&&(o=e[t+1]<<16),r>t+2&&(o|=e[t+2]<<8),r>t+3&&(o|=e[t+3]),o+=e[t]<<24>>>0),o}}function y(e,t,i,n){n||(z("boolean"==typeof i,"missing or invalid endian"),z(void 0!==t&&null!==t,"missing offset"),z(t+1<e.length,"Trying to read beyond buffer length"));var r=e.length;if(!(t>=r)){var o=g(e,t,i,!0),a=32768&o;return a?-1*(65535-o+1):o}}function b(e,t,i,n){n||(z("boolean"==typeof i,"missing or invalid endian"),z(void 0!==t&&null!==t,"missing offset"),z(t+3<e.length,"Trying to read beyond buffer length"));var r=e.length;if(!(t>=r)){var o=v(e,t,i,!0),a=2147483648&o;return a?-1*(4294967295-o+1):o}}function x(e,t,i,n){return n||(z("boolean"==typeof i,"missing or invalid endian"),z(t+3<e.length,"Trying to read beyond buffer length")),H.read(e,t,i,23,4)}function w(e,t,i,n){return n||(z("boolean"==typeof i,"missing or invalid endian"),z(t+7<e.length,"Trying to read beyond buffer length")),H.read(e,t,i,52,8)}function _(e,t,i,n,r){r||(z(void 0!==t&&null!==t,"missing value"),z("boolean"==typeof n,"missing or invalid endian"),z(void 0!==i&&null!==i,"missing offset"),z(i+1<e.length,"trying to write beyond buffer length"),V(t,65535));var o=e.length;if(!(i>=o))for(var a=0,s=Math.min(o-i,2);s>a;a++)e[i+a]=(t&255<<8*(n?a:1-a))>>>8*(n?a:1-a)}function S(e,t,i,n,r){r||(z(void 0!==t&&null!==t,"missing value"),z("boolean"==typeof n,"missing or invalid endian"),z(void 0!==i&&null!==i,"missing offset"),z(i+3<e.length,"trying to write beyond buffer length"),V(t,4294967295));var o=e.length;if(!(i>=o))for(var a=0,s=Math.min(o-i,4);s>a;a++)e[i+a]=t>>>8*(n?a:3-a)&255}function M(e,t,i,n,r){r||(z(void 0!==t&&null!==t,"missing value"),z("boolean"==typeof n,"missing or invalid endian"),z(void 0!==i&&null!==i,"missing offset"),z(i+1<e.length,"Trying to write beyond buffer length"),U(t,32767,-32768));var o=e.length;i>=o||(t>=0?_(e,t,i,n,r):_(e,65535+t+1,i,n,r))}function C(e,t,i,n,r){r||(z(void 0!==t&&null!==t,"missing value"),z("boolean"==typeof n,"missing or invalid endian"),z(void 0!==i&&null!==i,"missing offset"),z(i+3<e.length,"Trying to write beyond buffer length"),U(t,2147483647,-2147483648));var o=e.length;i>=o||(t>=0?S(e,t,i,n,r):S(e,4294967295+t+1,i,n,r))}function A(e,t,i,n,r){r||(z(void 0!==t&&null!==t,"missing value"),z("boolean"==typeof n,"missing or invalid endian"),z(void 0!==i&&null!==i,"missing offset"),z(i+3<e.length,"Trying to write beyond buffer length"),B(t,3.4028234663852886e38,-3.4028234663852886e38));var o=e.length;i>=o||H.write(e,t,i,n,23,4)}function T(e,t,i,n,r){r||(z(void 0!==t&&null!==t,"missing value"),z("boolean"==typeof n,"missing or invalid endian"),z(void 0!==i&&null!==i,"missing offset"),z(i+7<e.length,"Trying to write beyond buffer length"),B(t,1.7976931348623157e308,-1.7976931348623157e308));var o=e.length;i>=o||H.write(e,t,i,n,52,8)}function E(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function k(e,t,i){return"number"!=typeof e?i:(e=~~e,e>=t?t:e>=0?e:(e+=t,e>=0?e:0))}function P(e){return e=~~Math.ceil(+e),0>e?0:e}function R(e){return(Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)})(e)}function L(e){return R(e)||n.isBuffer(e)||e&&"object"==typeof e&&"number"==typeof e.length}function D(e){return 16>e?"0"+e.toString(16):e.toString(16)}function N(e){for(var t=[],i=0;i<e.length;i++){var n=e.charCodeAt(i);if(127>=n)t.push(e.charCodeAt(i));else{var r=i;n>=55296&&57343>=n&&i++;for(var o=encodeURIComponent(e.slice(r,i+1)).substr(1).split("%"),a=0;a<o.length;a++)t.push(parseInt(o[a],16))}}return t}function F(e){for(var t=[],i=0;i<e.length;i++)t.push(255&e.charCodeAt(i));return t}function G(e){for(var t,i,n,r=[],o=0;o<e.length;o++)t=e.charCodeAt(o),i=t>>8,n=t%256,r.push(n),r.push(i);return r}function O(e){return q.toByteArray(e)}function j(e,t,i,n){for(var r=0;n>r&&!(r+i>=t.length||r>=e.length);r++)t[r+i]=e[r];return r}function I(e){try{return decodeURIComponent(e)}catch(t){return String.fromCharCode(65533)}}function V(e,t){z("number"==typeof e,"cannot write a non-number as a number"),z(e>=0,"specified a negative value for writing an unsigned value"),z(t>=e,"value is larger than maximum value for type"),z(Math.floor(e)===e,"value has a fractional component")}function U(e,t,i){z("number"==typeof e,"cannot write a non-number as a number"),z(t>=e,"value larger than maximum allowed value"),z(e>=i,"value smaller than minimum allowed value"),z(Math.floor(e)===e,"value has a fractional component")}function B(e,t,i){z("number"==typeof e,"cannot write a non-number as a number"),z(t>=e,"value larger than maximum allowed value"),z(e>=i,"value smaller than minimum allowed value")}function z(e,t){if(!e)throw new Error(t||"Failed assertion")}var q=e("base64-js"),H=e("ieee754");i.Buffer=n,i.SlowBuffer=n,i.INSPECT_MAX_BYTES=50,n.poolSize=8192,n._useTypedArrays=function(){try{var e=new ArrayBuffer(0),t=new Uint8Array(e);return t.foo=function(){return 42},42===t.foo()&&"function"==typeof t.subarray}catch(i){return!1}}(),n.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},n.isBuffer=function(e){return!(null===e||void 0===e||!e._isBuffer)},n.byteLength=function(e,t){var i;switch(e+="",t||"utf8"){case"hex":i=e.length/2;break;case"utf8":case"utf-8":i=N(e).length;break;case"ascii":case"binary":case"raw":i=e.length;break;case"base64":i=O(e).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":i=2*e.length;break;default:throw new Error("Unknown encoding")}return i},n.concat=function(e,t){if(z(R(e),"Usage: Buffer.concat(list, [totalLength])\nlist should be an Array."),0===e.length)return new n(0);if(1===e.length)return e[0];var i;if("number"!=typeof t)for(t=0,i=0;i<e.length;i++)t+=e[i].length;var r=new n(t),o=0;for(i=0;i<e.length;i++){var a=e[i];a.copy(r,o),o+=a.length}return r},n.prototype.write=function(e,t,i,n){if(isFinite(t))isFinite(i)||(n=i,i=void 0);else{var c=n;n=t,t=i,i=c}t=Number(t)||0;var h=this.length-t;i?(i=Number(i),i>h&&(i=h)):i=h,n=String(n||"utf8").toLowerCase();var f;switch(n){case"hex":f=r(this,e,t,i);break;case"utf8":case"utf-8":f=o(this,e,t,i);break;case"ascii":f=a(this,e,t,i);break;case"binary":f=s(this,e,t,i);break;case"base64":f=l(this,e,t,i);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":f=u(this,e,t,i);break;default:throw new Error("Unknown encoding")}return f},n.prototype.toString=function(e,t,i){var n=this;if(e=String(e||"utf8").toLowerCase(),t=Number(t)||0,i=void 0!==i?Number(i):i=n.length,i===t)return"";var r;switch(e){case"hex":r=d(n,t,i);break;case"utf8":case"utf-8":r=h(n,t,i);break;case"ascii":r=f(n,t,i);break;case"binary":r=p(n,t,i);break;case"base64":r=c(n,t,i);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":r=m(n,t,i);break;default:throw new Error("Unknown encoding")}return r},n.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},n.prototype.copy=function(e,t,i,r){var o=this;if(i||(i=0),r||0===r||(r=this.length),t||(t=0),r!==i&&0!==e.length&&0!==o.length){z(r>=i,"sourceEnd < sourceStart"),z(t>=0&&t<e.length,"targetStart out of bounds"),z(i>=0&&i<o.length,"sourceStart out of bounds"),z(r>=0&&r<=o.length,"sourceEnd out of bounds"),r>this.length&&(r=this.length),e.length-t<r-i&&(r=e.length-t+i);var a=r-i;if(100>a||!n._useTypedArrays)for(var s=0;a>s;s++)e[s+t]=this[s+i];else e._set(this.subarray(i,i+a),t)}},n.prototype.slice=function(e,t){var i=this.length;if(e=k(e,i,0),t=k(t,i,i),n._useTypedArrays)return n._augment(this.subarray(e,t));for(var r=t-e,o=new n(r,void 0,!0),a=0;r>a;a++)o[a]=this[a+e];return o},n.prototype.get=function(e){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(e)},n.prototype.set=function(e,t){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(e,t)},n.prototype.readUInt8=function(e,t){return t||(z(void 0!==e&&null!==e,"missing offset"),z(e<this.length,"Trying to read beyond buffer length")),e>=this.length?void 0:this[e]},n.prototype.readUInt16LE=function(e,t){return g(this,e,!0,t)},n.prototype.readUInt16BE=function(e,t){return g(this,e,!1,t)},n.prototype.readUInt32LE=function(e,t){return v(this,e,!0,t)},n.prototype.readUInt32BE=function(e,t){return v(this,e,!1,t)},n.prototype.readInt8=function(e,t){if(t||(z(void 0!==e&&null!==e,"missing offset"),z(e<this.length,"Trying to read beyond buffer length")),!(e>=this.length)){var i=128&this[e];return i?-1*(255-this[e]+1):this[e]}},n.prototype.readInt16LE=function(e,t){return y(this,e,!0,t)},n.prototype.readInt16BE=function(e,t){return y(this,e,!1,t)},n.prototype.readInt32LE=function(e,t){return b(this,e,!0,t)},n.prototype.readInt32BE=function(e,t){return b(this,e,!1,t)},n.prototype.readFloatLE=function(e,t){return x(this,e,!0,t)},n.prototype.readFloatBE=function(e,t){return x(this,e,!1,t)},n.prototype.readDoubleLE=function(e,t){return w(this,e,!0,t)},n.prototype.readDoubleBE=function(e,t){return w(this,e,!1,t)},n.prototype.writeUInt8=function(e,t,i){i||(z(void 0!==e&&null!==e,"missing value"),z(void 0!==t&&null!==t,"missing offset"),z(t<this.length,"trying to write beyond buffer length"),V(e,255)),t>=this.length||(this[t]=e)},n.prototype.writeUInt16LE=function(e,t,i){_(this,e,t,!0,i)},n.prototype.writeUInt16BE=function(e,t,i){_(this,e,t,!1,i)},n.prototype.writeUInt32LE=function(e,t,i){S(this,e,t,!0,i)},n.prototype.writeUInt32BE=function(e,t,i){S(this,e,t,!1,i)},n.prototype.writeInt8=function(e,t,i){i||(z(void 0!==e&&null!==e,"missing value"),z(void 0!==t&&null!==t,"missing offset"),z(t<this.length,"Trying to write beyond buffer length"),U(e,127,-128)),t>=this.length||(e>=0?this.writeUInt8(e,t,i):this.writeUInt8(255+e+1,t,i))},n.prototype.writeInt16LE=function(e,t,i){M(this,e,t,!0,i)},n.prototype.writeInt16BE=function(e,t,i){M(this,e,t,!1,i)},n.prototype.writeInt32LE=function(e,t,i){C(this,e,t,!0,i)},n.prototype.writeInt32BE=function(e,t,i){C(this,e,t,!1,i)},n.prototype.writeFloatLE=function(e,t,i){A(this,e,t,!0,i)},n.prototype.writeFloatBE=function(e,t,i){A(this,e,t,!1,i)},n.prototype.writeDoubleLE=function(e,t,i){T(this,e,t,!0,i)},n.prototype.writeDoubleBE=function(e,t,i){T(this,e,t,!1,i)},n.prototype.fill=function(e,t,i){if(e||(e=0),t||(t=0),i||(i=this.length),"string"==typeof e&&(e=e.charCodeAt(0)),z("number"==typeof e&&!isNaN(e),"value is not a number"),z(i>=t,"end < start"),i!==t&&0!==this.length){z(t>=0&&t<this.length,"start out of bounds"),z(i>=0&&i<=this.length,"end out of bounds");for(var n=t;i>n;n++)this[n]=e}},n.prototype.inspect=function(){for(var e=[],t=this.length,n=0;t>n;n++)if(e[n]=D(this[n]),n===i.INSPECT_MAX_BYTES){e[n+1]="...";break}return"<Buffer "+e.join(" ")+">"},n.prototype.toArrayBuffer=function(){if("undefined"!=typeof Uint8Array){if(n._useTypedArrays)return new n(this).buffer;for(var e=new Uint8Array(this.length),t=0,i=e.length;i>t;t+=1)e[t]=this[t];return e.buffer}throw new Error("Buffer.toArrayBuffer not supported in this browser")};var W=n.prototype;n._augment=function(e){return e._isBuffer=!0,e._get=e.get,e._set=e.set,e.get=W.get,e.set=W.set,e.write=W.write,e.toString=W.toString,e.toLocaleString=W.toString,e.toJSON=W.toJSON,e.copy=W.copy,e.slice=W.slice,e.readUInt8=W.readUInt8,e.readUInt16LE=W.readUInt16LE,e.readUInt16BE=W.readUInt16BE,e.readUInt32LE=W.readUInt32LE,e.readUInt32BE=W.readUInt32BE,e.readInt8=W.readInt8,e.readInt16LE=W.readInt16LE,e.readInt16BE=W.readInt16BE,e.readInt32LE=W.readInt32LE,e.readInt32BE=W.readInt32BE,e.readFloatLE=W.readFloatLE,e.readFloatBE=W.readFloatBE,e.readDoubleLE=W.readDoubleLE,e.readDoubleBE=W.readDoubleBE,e.writeUInt8=W.writeUInt8,e.writeUInt16LE=W.writeUInt16LE,e.writeUInt16BE=W.writeUInt16BE,e.writeUInt32LE=W.writeUInt32LE,e.writeUInt32BE=W.writeUInt32BE,e.writeInt8=W.writeInt8,e.writeInt16LE=W.writeInt16LE,e.writeInt16BE=W.writeInt16BE,e.writeInt32LE=W.writeInt32LE,e.writeInt32BE=W.writeInt32BE,e.writeFloatLE=W.writeFloatLE,e.writeFloatBE=W.writeFloatBE,e.writeDoubleLE=W.writeDoubleLE,e.writeDoubleBE=W.writeDoubleBE,e.fill=W.fill,e.inspect=W.inspect,e.toArrayBuffer=W.toArrayBuffer,e}},{"base64-js":71,ieee754:72}],71:[function(e,t,i){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(e){"use strict";function t(e){var t=e.charCodeAt(0);return t===a?62:t===s?63:l>t?-1:l+10>t?t-l+26+26:c+26>t?t-c:u+26>t?t-u+26:void 0}function i(e){function i(e){u[h++]=e}var n,r,a,s,l,u;if(e.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var c=e.length;l="="===e.charAt(c-2)?2:"="===e.charAt(c-1)?1:0,u=new o(3*e.length/4-l),a=l>0?e.length-4:e.length;var h=0;for(n=0,r=0;a>n;n+=4,r+=3)s=t(e.charAt(n))<<18|t(e.charAt(n+1))<<12|t(e.charAt(n+2))<<6|t(e.charAt(n+3)),i((16711680&s)>>16),i((65280&s)>>8),i(255&s);return 2===l?(s=t(e.charAt(n))<<2|t(e.charAt(n+1))>>4,i(255&s)):1===l&&(s=t(e.charAt(n))<<10|t(e.charAt(n+1))<<4|t(e.charAt(n+2))>>2,i(s>>8&255),i(255&s)),u}function r(e){function t(e){return n.charAt(e)}function i(e){return t(e>>18&63)+t(e>>12&63)+t(e>>6&63)+t(63&e)}var r,o,a,s=e.length%3,l="";for(r=0,a=e.length-s;a>r;r+=3)o=(e[r]<<16)+(e[r+1]<<8)+e[r+2],l+=i(o);switch(s){case 1:o=e[e.length-1],l+=t(o>>2),l+=t(o<<4&63),l+="==";break;case 2:o=(e[e.length-2]<<8)+e[e.length-1],l+=t(o>>10),l+=t(o>>4&63),l+=t(o<<2&63),l+="="}return l}var o="undefined"!=typeof Uint8Array?Uint8Array:Array,a="+".charCodeAt(0),s="/".charCodeAt(0),l="0".charCodeAt(0),u="a".charCodeAt(0),c="A".charCodeAt(0);e.toByteArray=i,e.fromByteArray=r}("undefined"==typeof i?this.base64js={}:i)},{}],72:[function(e,t,i){i.read=function(e,t,i,n,r){var o,a,s=8*r-n-1,l=(1<<s)-1,u=l>>1,c=-7,h=i?r-1:0,f=i?-1:1,p=e[t+h];for(h+=f,o=p&(1<<-c)-1,p>>=-c,c+=s;c>0;o=256*o+e[t+h],h+=f,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=n;c>0;a=256*a+e[t+h],h+=f,c-=8);if(0===o)o=1-u;else{if(o===l)return a?0/0:1/0*(p?-1:1);a+=Math.pow(2,n),o-=u}return(p?-1:1)*a*Math.pow(2,o-n)},i.write=function(e,t,i,n,r,o){var a,s,l,u=8*o-r-1,c=(1<<u)-1,h=c>>1,f=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,d=n?1:-1,m=0>t||0===t&&0>1/t?1:0;for(t=Math.abs(t),isNaN(t)||1/0===t?(s=isNaN(t)?1:0,a=c):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),t+=a+h>=1?f/l:f*Math.pow(2,1-h),t*l>=2&&(a++,l/=2),a+h>=c?(s=0,a=c):a+h>=1?(s=(t*l-1)*Math.pow(2,r),a+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,r),a=0));r>=8;e[i+p]=255&s,p+=d,s/=256,r-=8);for(a=a<<r|s,u+=r;u>0;e[i+p]=255&a,p+=d,a/=256,u-=8);e[i+p-d]|=128*m}},{}],73:[function(e,t){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(e){return"function"==typeof e}function r(e){return"number"==typeof e}function o(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}t.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(e){if(!r(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},i.prototype.emit=function(e){var t,i,r,s,l,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(i=this._events[e],a(i))return!1;if(n(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:for(r=arguments.length,s=new Array(r-1),l=1;r>l;l++)s[l-1]=arguments[l];i.apply(this,s)}else if(o(i)){for(r=arguments.length,s=new Array(r-1),l=1;r>l;l++)s[l-1]=arguments[l];for(u=i.slice(),r=u.length,l=0;r>l;l++)u[l].apply(this,s)}return!0},i.prototype.addListener=function(e,t){var r;if(!n(t))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,n(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned){var r;
r=a(this._maxListeners)?i.defaultMaxListeners:this._maxListeners,r&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())}return this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(e,t){function i(){this.removeListener(e,i),r||(r=!0,t.apply(this,arguments))}if(!n(t))throw TypeError("listener must be a function");var r=!1;return i.listener=t,this.on(e,i),this},i.prototype.removeListener=function(e,t){var i,r,a,s;if(!n(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(i=this._events[e],a=i.length,r=-1,i===t||n(i.listener)&&i.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(i)){for(s=a;s-->0;)if(i[s]===t||i[s].listener&&i[s].listener===t){r=s;break}if(0>r)return this;1===i.length?(i.length=0,delete this._events[e]):i.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},i.prototype.removeAllListeners=function(e){var t,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i=this._events[e],n(i))this.removeListener(e,i);else for(;i.length;)this.removeListener(e,i[i.length-1]);return delete this._events[e],this},i.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?n(this._events[e])?[this._events[e]]:this._events[e].slice():[]},i.listenerCount=function(e,t){var i;return i=e._events&&e._events[t]?n(e._events[t])?1:e._events[t].length:0}},{}],74:[function(e,t){var i=t.exports,n=(e("events").EventEmitter,e("./lib/request")),r=e("url");i.request=function(e,t){"string"==typeof e&&(e=r.parse(e)),e||(e={}),e.host||e.port||(e.port=parseInt(window.location.port,10)),!e.host&&e.hostname&&(e.host=e.hostname),e.scheme||(e.scheme=window.location.protocol.split(":")[0]),e.host||(e.host=window.location.hostname||window.location.host),/:/.test(e.host)&&(e.port||(e.port=e.host.split(":")[1]),e.host=e.host.split(":")[0]),e.port||(e.port="https"==e.scheme?443:80);var i=new n(new o,e);return t&&i.on("response",t),i},i.get=function(e,t){e.method="GET";var n=i.request(e,t);return n.end(),n},i.Agent=function(){},i.Agent.defaultMaxSockets=4;var o=function(){if("undefined"==typeof window)throw new Error("no window object present");if(window.XMLHttpRequest)return window.XMLHttpRequest;if(window.ActiveXObject){for(var e=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"],t=0;t<e.length;t++)try{var i=new window.ActiveXObject(e[t]);return function(){if(i){var n=i;return i=null,n}return new window.ActiveXObject(e[t])}}catch(n){}throw new Error("ajax not supported in this browser")}throw new Error("ajax not supported in this browser")}();i.STATUS_CODES={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Time-out",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Large",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Time-out",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"}},{"./lib/request":75,events:73,url:92}],75:[function(e,t){var i=e("stream"),n=e("./response"),r=e("Base64"),o=e("inherits"),a=t.exports=function(e,t){var i=this;i.writable=!0,i.xhr=e,i.body=[],i.uri=(t.scheme||"http")+"://"+t.host+(t.port?":"+t.port:"")+(t.path||"/"),"undefined"==typeof t.withCredentials&&(t.withCredentials=!0);try{e.withCredentials=t.withCredentials}catch(o){}if(e.open(t.method||"GET",i.uri,!0),i._headers={},t.headers)for(var a=s(t.headers),l=0;l<a.length;l++){var u=a[l];if(i.isSafeRequestHeader(u)){var c=t.headers[u];i.setHeader(u,c)}}t.auth&&this.setHeader("Authorization","Basic "+r.btoa(t.auth));var h=new n;h.on("close",function(){i.emit("close")}),h.on("ready",function(){i.emit("response",h)}),e.onreadystatechange=function(){e.__aborted||h.handle(e)}};o(a,i),a.prototype.setHeader=function(e,t){this._headers[e.toLowerCase()]=t},a.prototype.getHeader=function(e){return this._headers[e.toLowerCase()]},a.prototype.removeHeader=function(e){delete this._headers[e.toLowerCase()]},a.prototype.write=function(e){this.body.push(e)},a.prototype.destroy=function(){this.xhr.__aborted=!0,this.xhr.abort(),this.emit("close")},a.prototype.end=function(e){void 0!==e&&this.body.push(e);for(var t=s(this._headers),i=0;i<t.length;i++){var n=t[i],r=this._headers[n];if(l(r))for(var o=0;o<r.length;o++)this.xhr.setRequestHeader(n,r[o]);else this.xhr.setRequestHeader(n,r)}if(0===this.body.length)this.xhr.send("");else if("string"==typeof this.body[0])this.xhr.send(this.body.join(""));else if(l(this.body[0])){for(var a=[],i=0;i<this.body.length;i++)a.push.apply(a,this.body[i]);this.xhr.send(a)}else if(/Array/.test(Object.prototype.toString.call(this.body[0]))){for(var u=0,i=0;i<this.body.length;i++)u+=this.body[i].length;for(var a=new this.body[0].constructor(u),c=0,i=0;i<this.body.length;i++)for(var h=this.body[i],o=0;o<h.length;o++)a[c++]=h[o];this.xhr.send(a)}else{for(var a="",i=0;i<this.body.length;i++)a+=this.body[i].toString();this.xhr.send(a)}},a.unsafeHeaders=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","content-transfer-encoding","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"],a.prototype.isSafeRequestHeader=function(e){return e?-1===u(a.unsafeHeaders,e.toLowerCase()):!1};var s=Object.keys||function(e){var t=[];for(var i in e)t.push(i);return t},l=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},u=function(e,t){if(e.indexOf)return e.indexOf(t);for(var i=0;i<e.length;i++)if(e[i]===t)return i;return-1}},{"./response":76,Base64:77,inherits:78,stream:85}],76:[function(e,t){function i(e){for(var t=e.getAllResponseHeaders().split(/\r?\n/),i={},n=0;n<t.length;n++){var r=t[n];if(""!==r){var o=r.match(/^([^:]+):\s*(.*)/);if(o){var a=o[1].toLowerCase(),l=o[2];void 0!==i[a]?s(i[a])?i[a].push(l):i[a]=[i[a],l]:i[a]=l}else i[r]=!0}}return i}var n=e("stream"),r=e("util"),o=t.exports=function(){this.offset=0,this.readable=!0};r.inherits(o,n);var a={streaming:!0,status2:!0};o.prototype.getResponse=function(e){var t=String(e.responseType).toLowerCase();return"blob"===t?e.responseBlob||e.response:"arraybuffer"===t?e.response:e.responseText},o.prototype.getHeader=function(e){return this.headers[e.toLowerCase()]},o.prototype.handle=function(e){if(2===e.readyState&&a.status2){try{this.statusCode=e.status,this.headers=i(e)}catch(t){a.status2=!1}a.status2&&this.emit("ready")}else if(a.streaming&&3===e.readyState){try{this.statusCode||(this.statusCode=e.status,this.headers=i(e),this.emit("ready"))}catch(t){}try{this._emitData(e)}catch(t){a.streaming=!1}}else 4===e.readyState&&(this.statusCode||(this.statusCode=e.status,this.emit("ready")),this._emitData(e),e.error?this.emit("error",this.getResponse(e)):this.emit("end"),this.emit("close"))},o.prototype._emitData=function(e){var t=this.getResponse(e);return t.toString().match(/ArrayBuffer/)?(this.emit("data",new Uint8Array(t,this.offset)),void(this.offset=t.byteLength)):void(t.length>this.offset&&(this.emit("data",t.slice(this.offset)),this.offset=t.length))};var s=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{stream:85,util:94}],77:[function(e,t,i){!function(){function e(e){this.message=e}var t="undefined"!=typeof i?i:this,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e.prototype=new Error,e.prototype.name="InvalidCharacterError",t.btoa||(t.btoa=function(t){for(var i,r,o=0,a=n,s="";t.charAt(0|o)||(a="=",o%1);s+=a.charAt(63&i>>8-o%1*8)){if(r=t.charCodeAt(o+=.75),r>255)throw new e("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");i=i<<8|r}return s}),t.atob||(t.atob=function(t){if(t=t.replace(/=+$/,""),t.length%4==1)throw new e("'atob' failed: The string to be decoded is not correctly encoded.");for(var i,r,o=0,a=0,s="";r=t.charAt(a++);~r&&(i=o%4?64*i+r:r,o++%4)?s+=String.fromCharCode(255&i>>(-2*o&6)):0)r=n.indexOf(r);return s})}()},{}],78:[function(e,t){t.exports="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}},{}],79:[function(e,t){function i(){}var n=t.exports={};n.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(t){var i=[];return window.addEventListener("message",function(e){var t=e.source;if((t===window||null===t)&&"process-tick"===e.data&&(e.stopPropagation(),i.length>0)){var n=i.shift();n()}},!0),function(e){i.push(e),window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}(),n.title="browser",n.browser=!0,n.env={},n.argv=[],n.on=i,n.addListener=i,n.once=i,n.off=i,n.removeListener=i,n.removeAllListeners=i,n.emit=i,n.binding=function(){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(){throw new Error("process.chdir is not supported")}},{}],80:[function(e,t,i){(function(e){!function(n){function r(e){throw RangeError(D[e])}function o(e,t){for(var i=e.length;i--;)e[i]=t(e[i]);return e}function a(e,t){return o(e.split(L),t).join(".")}function s(e){for(var t,i,n=[],r=0,o=e.length;o>r;)t=e.charCodeAt(r++),t>=55296&&56319>=t&&o>r?(i=e.charCodeAt(r++),56320==(64512&i)?n.push(((1023&t)<<10)+(1023&i)+65536):(n.push(t),r--)):n.push(t);return n}function l(e){return o(e,function(e){var t="";return e>65535&&(e-=65536,t+=G(e>>>10&1023|55296),e=56320|1023&e),t+=G(e)}).join("")}function u(e){return 10>e-48?e-22:26>e-65?e-65:26>e-97?e-97:_}function c(e,t){return e+22+75*(26>e)-((0!=t)<<5)}function h(e,t,i){var n=0;for(e=i?F(e/A):e>>1,e+=F(e/t);e>N*M>>1;n+=_)e=F(e/N);return F(n+(N+1)*e/(e+C))}function f(e){var t,i,n,o,a,s,c,f,p,d,m=[],g=e.length,v=0,y=E,b=T;for(i=e.lastIndexOf(k),0>i&&(i=0),n=0;i>n;++n)e.charCodeAt(n)>=128&&r("not-basic"),m.push(e.charCodeAt(n));for(o=i>0?i+1:0;g>o;){for(a=v,s=1,c=_;o>=g&&r("invalid-input"),f=u(e.charCodeAt(o++)),(f>=_||f>F((w-v)/s))&&r("overflow"),v+=f*s,p=b>=c?S:c>=b+M?M:c-b,!(p>f);c+=_)d=_-p,s>F(w/d)&&r("overflow"),s*=d;t=m.length+1,b=h(v-a,t,0==a),F(v/t)>w-y&&r("overflow"),y+=F(v/t),v%=t,m.splice(v++,0,y)}return l(m)}function p(e){var t,i,n,o,a,l,u,f,p,d,m,g,v,y,b,x=[];for(e=s(e),g=e.length,t=E,i=0,a=T,l=0;g>l;++l)m=e[l],128>m&&x.push(G(m));for(n=o=x.length,o&&x.push(k);g>n;){for(u=w,l=0;g>l;++l)m=e[l],m>=t&&u>m&&(u=m);for(v=n+1,u-t>F((w-i)/v)&&r("overflow"),i+=(u-t)*v,t=u,l=0;g>l;++l)if(m=e[l],t>m&&++i>w&&r("overflow"),m==t){for(f=i,p=_;d=a>=p?S:p>=a+M?M:p-a,!(d>f);p+=_)b=f-d,y=_-d,x.push(G(c(d+b%y,0))),f=F(b/y);x.push(G(c(f,0))),a=h(i,v,n==o),i=0,++n}++i,++t}return x.join("")}function d(e){return a(e,function(e){return P.test(e)?f(e.slice(4).toLowerCase()):e})}function m(e){return a(e,function(e){return R.test(e)?"xn--"+p(e):e})}var g="object"==typeof i&&i,v="object"==typeof t&&t&&t.exports==g&&t,y="object"==typeof e&&e;(y.global===y||y.window===y)&&(n=y);var b,x,w=2147483647,_=36,S=1,M=26,C=38,A=700,T=72,E=128,k="-",P=/^xn--/,R=/[^ -~]/,L=/\x2E|\u3002|\uFF0E|\uFF61/g,D={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},N=_-S,F=Math.floor,G=String.fromCharCode;if(b={version:"1.2.4",ucs2:{decode:s,encode:l},decode:f,encode:p,toASCII:m,toUnicode:d},"function"==typeof define&&"object"==typeof define.amd&&define.amd)define("punycode",function(){return b});else if(g&&!g.nodeType)if(v)v.exports=b;else for(x in b)b.hasOwnProperty(x)&&(g[x]=b[x]);else n.punycode=b}(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],81:[function(e,t){"use strict";function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.exports=function(e,t,r,o){t=t||"&",r=r||"=";var a={};if("string"!=typeof e||0===e.length)return a;var s=/\+/g;e=e.split(t);var l=1e3;o&&"number"==typeof o.maxKeys&&(l=o.maxKeys);var u=e.length;l>0&&u>l&&(u=l);for(var c=0;u>c;++c){var h,f,p,d,m=e[c].replace(s,"%20"),g=m.indexOf(r);g>=0?(h=m.substr(0,g),f=m.substr(g+1)):(h=m,f=""),p=decodeURIComponent(h),d=decodeURIComponent(f),i(a,p)?n(a[p])?a[p].push(d):a[p]=[a[p],d]:a[p]=d}return a};var n=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{}],82:[function(e,t){"use strict";function i(e,t){if(e.map)return e.map(t);for(var i=[],n=0;n<e.length;n++)i.push(t(e[n],n));return i}var n=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(e,t,a,s){return t=t||"&",a=a||"=",null===e&&(e=void 0),"object"==typeof e?i(o(e),function(i){var o=encodeURIComponent(n(i))+a;return r(e[i])?e[i].map(function(e){return o+encodeURIComponent(n(e))}).join(t):o+encodeURIComponent(n(e[i]))}).join(t):s?encodeURIComponent(n(s))+a+encodeURIComponent(n(e)):""};var r=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},o=Object.keys||function(e){var t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.push(i);return t}},{}],83:[function(e,t,i){"use strict";i.decode=i.parse=e("./decode"),i.encode=i.stringify=e("./encode")},{"./decode":81,"./encode":82}],84:[function(e,t){function i(e){return this instanceof i?(a.call(this,e),s.call(this,e),e&&e.readable===!1&&(this.readable=!1),e&&e.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,e&&e.allowHalfOpen===!1&&(this.allowHalfOpen=!1),void this.once("end",n)):new i(e)}function n(){if(!this.allowHalfOpen&&!this._writableState.ended){var e=this;o(function(){e.end()})}}t.exports=i;var r=e("inherits"),o=e("process/browser.js").nextTick,a=e("./readable.js"),s=e("./writable.js");r(i,a),i.prototype.write=s.prototype.write,i.prototype.end=s.prototype.end,i.prototype._write=s.prototype._write},{"./readable.js":88,"./writable.js":90,inherits:78,"process/browser.js":86}],85:[function(e,t){function i(){n.call(this)}t.exports=i;var n=e("events").EventEmitter,r=e("inherits");r(i,n),i.Readable=e("./readable.js"),i.Writable=e("./writable.js"),i.Duplex=e("./duplex.js"),i.Transform=e("./transform.js"),i.PassThrough=e("./passthrough.js"),i.Stream=i,i.prototype.pipe=function(e,t){function i(t){e.writable&&!1===e.write(t)&&u.pause&&u.pause()}function r(){u.readable&&u.resume&&u.resume()}function o(){c||(c=!0,e.end())}function a(){c||(c=!0,"function"==typeof e.destroy&&e.destroy())}function s(e){if(l(),0===n.listenerCount(this,"error"))throw e}function l(){u.removeListener("data",i),e.removeListener("drain",r),u.removeListener("end",o),u.removeListener("close",a),u.removeListener("error",s),e.removeListener("error",s),u.removeListener("end",l),u.removeListener("close",l),e.removeListener("close",l)}var u=this;u.on("data",i),e.on("drain",r),e._isStdio||t&&t.end===!1||(u.on("end",o),u.on("close",a));var c=!1;return u.on("error",s),e.on("error",s),u.on("end",l),u.on("close",l),e.on("close",l),e.emit("pipe",u),e}},{"./duplex.js":84,"./passthrough.js":87,"./readable.js":88,"./transform.js":89,"./writable.js":90,events:73,inherits:78}],86:[function(e,t){var i=t.exports={};i.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(t){var i=[];return window.addEventListener("message",function(e){var t=e.source;if((t===window||null===t)&&"process-tick"===e.data&&(e.stopPropagation(),i.length>0)){var n=i.shift();n()}},!0),function(e){i.push(e),window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}(),i.title="browser",i.browser=!0,i.env={},i.argv=[],i.binding=function(){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(){throw new Error("process.chdir is not supported")}},{}],87:[function(e,t){function i(e){return this instanceof i?void n.call(this,e):new i(e)}t.exports=i;var n=e("./transform.js"),r=e("inherits");r(i,n),i.prototype._transform=function(e,t,i){i(null,e)}},{"./transform.js":89,inherits:78}],88:[function(e,t){(function(i){function n(t){t=t||{};var i=t.highWaterMark;this.highWaterMark=i||0===i?i:16384,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=!1,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.calledRead=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.objectMode=!!t.objectMode,this.defaultEncoding=t.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(S||(S=e("string_decoder").StringDecoder),this.decoder=new S(t.encoding),this.encoding=t.encoding)}function r(e){return this instanceof r?(this._readableState=new n(e,this),this.readable=!0,void C.call(this)):new r(e)}function o(e,t,i,n,r){var o=u(t,i);if(o)e.emit("error",o);else if(null===i||void 0===i)t.reading=!1,t.ended||c(e,t);else if(t.objectMode||i&&i.length>0)if(t.ended&&!r){var s=new Error("stream.push() after EOF");e.emit("error",s)}else if(t.endEmitted&&r){var s=new Error("stream.unshift() after end event");e.emit("error",s)}else!t.decoder||r||n||(i=t.decoder.write(i)),t.length+=t.objectMode?1:i.length,r?t.buffer.unshift(i):(t.reading=!1,t.buffer.push(i)),t.needReadable&&h(e),p(e,t);else r||(t.reading=!1);return a(t)}function a(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}function s(e){if(e>=k)e=k;else{e--;for(var t=1;32>t;t<<=1)e|=e>>t;e++}return e}function l(e,t){return 0===t.length&&t.ended?0:t.objectMode?0===e?0:1:isNaN(e)||null===e?t.flowing&&t.buffer.length?t.buffer[0].length:t.length:0>=e?0:(e>t.highWaterMark&&(t.highWaterMark=s(e)),e>t.length?t.ended?t.length:(t.needReadable=!0,0):e)}function u(e,t){var i=null;return A.isBuffer(t)||"string"==typeof t||null===t||void 0===t||e.objectMode||i||(i=new TypeError("Invalid non-string/buffer chunk")),i}function c(e,t){if(t.decoder&&!t.ended){var i=t.decoder.end();i&&i.length&&(t.buffer.push(i),t.length+=t.objectMode?1:i.length)}t.ended=!0,t.length>0?h(e):x(e)}function h(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,t.sync?T(function(){f(e)}):f(e))}function f(e){e.emit("readable")}function p(e,t){t.readingMore||(t.readingMore=!0,T(function(){d(e,t)}))}function d(e,t){for(var i=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(e.read(0),i!==t.length);)i=t.length;t.readingMore=!1}function m(e){return function(){var t=e._readableState;t.awaitDrain--,0===t.awaitDrain&&g(e)}}function g(e){function t(e){var t=e.write(i);!1===t&&n.awaitDrain++}var i,n=e._readableState;for(n.awaitDrain=0;n.pipesCount&&null!==(i=e.read());)if(1===n.pipesCount?t(n.pipes,0,null):w(n.pipes,t),e.emit("data",i),n.awaitDrain>0)return;return 0===n.pipesCount?(n.flowing=!1,void(M.listenerCount(e,"data")>0&&y(e))):void(n.ranOut=!0)}function v(){this._readableState.ranOut&&(this._readableState.ranOut=!1,g(this))}function y(e,t){var i=e._readableState;if(i.flowing)throw new Error("Cannot switch to old mode now.");var n=t||!1,r=!1;e.readable=!0,e.pipe=C.prototype.pipe,e.on=e.addListener=C.prototype.on,e.on("readable",function(){r=!0;for(var t;!n&&null!==(t=e.read());)e.emit("data",t);null===t&&(r=!1,e._readableState.needReadable=!0)}),e.pause=function(){n=!0,this.emit("pause")},e.resume=function(){n=!1,r?T(function(){e.emit("readable")}):this.read(0),this.emit("resume")},e.emit("readable")}function b(e,t){var i,n=t.buffer,r=t.length,o=!!t.decoder,a=!!t.objectMode;if(0===n.length)return null;if(0===r)i=null;else if(a)i=n.shift();else if(!e||e>=r)i=o?n.join(""):A.concat(n,r),n.length=0;else if(e<n[0].length){var s=n[0];i=s.slice(0,e),n[0]=s.slice(e)}else if(e===n[0].length)i=n.shift();else{i=o?"":new A(e);for(var l=0,u=0,c=n.length;c>u&&e>l;u++){var s=n[0],h=Math.min(e-l,s.length);o?i+=s.slice(0,h):s.copy(i,l,0,h),h<s.length?n[0]=s.slice(h):n.shift(),l+=h}}return i}function x(e){var t=e._readableState;if(t.length>0)throw new Error("endReadable called on non-empty stream");!t.endEmitted&&t.calledRead&&(t.ended=!0,T(function(){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}))}function w(e,t){for(var i=0,n=e.length;n>i;i++)t(e[i],i)}function _(e,t){for(var i=0,n=e.length;n>i;i++)if(e[i]===t)return i;return-1}t.exports=r,r.ReadableState=n;var S,M=e("events").EventEmitter,C=e("./index.js"),A=e("buffer").Buffer,T=e("process/browser.js").nextTick,E=e("inherits");E(r,C),r.prototype.push=function(e,t){var i=this._readableState;return"string"!=typeof e||i.objectMode||(t=t||i.defaultEncoding,t!==i.encoding&&(e=new A(e,t),t="")),o(this,i,e,t,!1)},r.prototype.unshift=function(e){var t=this._readableState;return o(this,t,e,"",!0)},r.prototype.setEncoding=function(t){S||(S=e("string_decoder").StringDecoder),this._readableState.decoder=new S(t),this._readableState.encoding=t};var k=8388608;r.prototype.read=function(e){var t=this._readableState;t.calledRead=!0;var i=e;if(("number"!=typeof e||e>0)&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return h(this),null;if(e=l(e,t),0===e&&t.ended)return 0===t.length&&x(this),null;var n=t.needReadable;t.length-e<=t.highWaterMark&&(n=!0),(t.ended||t.reading)&&(n=!1),n&&(t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1),n&&!t.reading&&(e=l(i,t));var r;return r=e>0?b(e,t):null,null===r&&(t.needReadable=!0,e=0),t.length-=e,0!==t.length||t.ended||(t.needReadable=!0),t.ended&&!t.endEmitted&&0===t.length&&x(this),r},r.prototype._read=function(){this.emit("error",new Error("not implemented"))},r.prototype.pipe=function(e,t){function n(e){e===c&&o()}function r(){e.end()}function o(){e.removeListener("close",s),e.removeListener("finish",l),e.removeListener("drain",d),e.removeListener("error",a),e.removeListener("unpipe",n),c.removeListener("end",r),c.removeListener("end",o),(!e._writableState||e._writableState.needDrain)&&d()}function a(t){u(),0===y&&0===M.listenerCount(e,"error")&&e.emit("error",t)}function s(){e.removeListener("finish",l),u()}function l(){e.removeListener("close",s),u()}function u(){c.unpipe(e)}var c=this,h=this._readableState;switch(h.pipesCount){case 0:h.pipes=e;break;case 1:h.pipes=[h.pipes,e];break;default:h.pipes.push(e)}h.pipesCount+=1;var f=(!t||t.end!==!1)&&e!==i.stdout&&e!==i.stderr,p=f?r:o;h.endEmitted?T(p):c.once("end",p),e.on("unpipe",n);var d=m(c);e.on("drain",d);var y=M.listenerCount(e,"error");return e.once("error",a),e.once("close",s),e.once("finish",l),e.emit("pipe",c),h.flowing||(this.on("readable",v),h.flowing=!0,T(function(){g(c)})),e},r.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,this.removeListener("readable",v),t.flowing=!1,e&&e.emit("unpipe",this),this);if(!e){var i=t.pipes,n=t.pipesCount;t.pipes=null,t.pipesCount=0,this.removeListener("readable",v),t.flowing=!1;for(var r=0;n>r;r++)i[r].emit("unpipe",this);return this}var r=_(t.pipes,e);return-1===r?this:(t.pipes.splice(r,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this),this)},r.prototype.on=function(e,t){var i=C.prototype.on.call(this,e,t);if("data"!==e||this._readableState.flowing||y(this),"readable"===e&&this.readable){var n=this._readableState;n.readableListening||(n.readableListening=!0,n.emittedReadable=!1,n.needReadable=!0,n.reading?n.length&&h(this,n):this.read(0))}return i},r.prototype.addListener=r.prototype.on,r.prototype.resume=function(){y(this),this.read(0),this.emit("resume")},r.prototype.pause=function(){y(this,!0),this.emit("pause")},r.prototype.wrap=function(e){var t=this._readableState,i=!1,n=this;e.on("end",function(){if(t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&n.push(e)}n.push(null)}),e.on("data",function(r){if(t.decoder&&(r=t.decoder.write(r)),r&&(t.objectMode||r.length)){var o=n.push(r);o||(i=!0,e.pause())}});for(var r in e)"function"==typeof e[r]&&"undefined"==typeof this[r]&&(this[r]=function(t){return function(){return e[t].apply(e,arguments)}}(r));var o=["error","close","destroy","pause","resume"];return w(o,function(t){e.on(t,function(e){return n.emit.apply(n,t,e)})}),n._read=function(){i&&(i=!1,e.resume())},n},r._fromList=b}).call(this,e("oMfpAn"))},{"./index.js":85,buffer:70,events:73,inherits:78,oMfpAn:79,"process/browser.js":86,string_decoder:91}],89:[function(e,t){function i(e,t){this.afterTransform=function(e,i){return n(t,e,i)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null}function n(e,t,i){var n=e._transformState;n.transforming=!1;var r=n.writecb;if(!r)return e.emit("error",new Error("no writecb in Transform class"));n.writechunk=null,n.writecb=null,null!==i&&void 0!==i&&e.push(i),r&&r(t);var o=e._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&e._read(o.highWaterMark)}function r(e){if(!(this instanceof r))return new r(e);a.call(this,e);var t=(this._transformState=new i(e,this),this);this._readableState.needReadable=!0,this._readableState.sync=!1,this.once("finish",function(){"function"==typeof this._flush?this._flush(function(e){o(t,e)}):o(t)})}function o(e,t){if(t)return e.emit("error",t);var i=e._writableState,n=(e._readableState,e._transformState);if(i.length)throw new Error("calling transform done when ws.length != 0");if(n.transforming)throw new Error("calling transform done when still transforming");return e.push(null)}t.exports=r;var a=e("./duplex.js"),s=e("inherits");s(r,a),r.prototype.push=function(e,t){return this._transformState.needTransform=!1,a.prototype.push.call(this,e,t)},r.prototype._transform=function(){throw new Error("not implemented")},r.prototype._write=function(e,t,i){var n=this._transformState;if(n.writecb=i,n.writechunk=e,n.writeencoding=t,!n.transforming){var r=this._readableState;(n.needTransform||r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}},r.prototype._read=function(){var e=this._transformState;e.writechunk&&e.writecb&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0}},{"./duplex.js":84,inherits:78}],90:[function(e,t){function i(e,t,i){this.chunk=e,this.encoding=t,this.callback=i}function n(e,t){e=e||{};var i=e.highWaterMark;this.highWaterMark=i||0===i?i:16384,this.objectMode=!!e.objectMode,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var n=e.decodeStrings===!1;this.decodeStrings=!n,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){f(t,e)},this.writecb=null,this.writelen=0,this.buffer=[]}function r(e){return this instanceof r||this instanceof _.Duplex?(this._writableState=new n(e,this),this.writable=!0,void _.call(this)):new r(e)}function o(e,t,i){var n=new Error("write after end");e.emit("error",n),S(function(){i(n)})}function a(e,t,i,n){var r=!0;if(!M.isBuffer(i)&&"string"!=typeof i&&null!==i&&void 0!==i&&!t.objectMode){var o=new TypeError("Invalid non-string/buffer chunk");e.emit("error",o),S(function(){n(o)}),r=!1}return r}function s(e,t,i){return e.objectMode||e.decodeStrings===!1||"string"!=typeof t||(t=new M(t,i)),t}function l(e,t,n,r,o){n=s(t,n,r);var a=t.objectMode?1:n.length;t.length+=a;var l=t.length<t.highWaterMark;return t.needDrain=!l,t.writing?t.buffer.push(new i(n,r,o)):u(e,t,a,n,r,o),l}function u(e,t,i,n,r,o){t.writelen=i,t.writecb=o,t.writing=!0,t.sync=!0,e._write(n,r,t.onwrite),t.sync=!1}function c(e,t,i,n,r){i?S(function(){r(n)}):r(n),e.emit("error",n)}function h(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function f(e,t){var i=e._writableState,n=i.sync,r=i.writecb;if(h(i),t)c(e,i,n,t,r);else{var o=g(e,i);o||i.bufferProcessing||!i.buffer.length||m(e,i),n?S(function(){p(e,i,o,r)}):p(e,i,o,r)}}function p(e,t,i,n){i||d(e,t),n(),i&&v(e,t)}function d(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function m(e,t){t.bufferProcessing=!0;for(var i=0;i<t.buffer.length;i++){var n=t.buffer[i],r=n.chunk,o=n.encoding,a=n.callback,s=t.objectMode?1:r.length;if(u(e,t,s,r,o,a),t.writing){i++;break}}t.bufferProcessing=!1,i<t.buffer.length?t.buffer=t.buffer.slice(i):t.buffer.length=0}function g(e,t){return t.ending&&0===t.length&&!t.finished&&!t.writing}function v(e,t){var i=g(e,t);return i&&(t.finished=!0,e.emit("finish")),i}function y(e,t,i){t.ending=!0,v(e,t),i&&(t.finished?S(i):e.once("finish",i)),t.ended=!0}t.exports=r,r.WritableState=n;var b="undefined"!=typeof Uint8Array?function(e){return e instanceof Uint8Array}:function(e){return e&&e.constructor&&"Uint8Array"===e.constructor.name},x="undefined"!=typeof ArrayBuffer?function(e){return e instanceof ArrayBuffer}:function(e){return e&&e.constructor&&"ArrayBuffer"===e.constructor.name},w=e("inherits"),_=e("./index.js"),S=e("process/browser.js").nextTick,M=e("buffer").Buffer;w(r,_),r.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},r.prototype.write=function(e,t,i){var n=this._writableState,r=!1;return"function"==typeof t&&(i=t,t=null),!M.isBuffer(e)&&b(e)&&(e=new M(e)),x(e)&&"undefined"!=typeof Uint8Array&&(e=new M(new Uint8Array(e))),M.isBuffer(e)?t="buffer":t||(t=n.defaultEncoding),"function"!=typeof i&&(i=function(){}),n.ended?o(this,n,i):a(this,n,e,i)&&(r=l(this,n,e,t,i)),r},r.prototype._write=function(e,t,i){i(new Error("not implemented"))},r.prototype.end=function(e,t,i){var n=this._writableState;"function"==typeof e?(i=e,e=null,t=null):"function"==typeof t&&(i=t,t=null),"undefined"!=typeof e&&null!==e&&this.write(e,t),n.ending||n.finished||y(this,n,i)}},{"./index.js":85,buffer:70,inherits:78,"process/browser.js":86}],91:[function(e,t,i){function n(e){if(e&&!s.isEncoding(e))throw new Error("Unknown encoding: "+e)}function r(e){return e.toString(this.encoding)}function o(e){var t=this.charReceived=e.length%2;return this.charLength=t?2:0,t}function a(e){var t=this.charReceived=e.length%3;return this.charLength=t?3:0,t}var s=e("buffer").Buffer,l=i.StringDecoder=function(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),n(e),this.encoding){case"utf8":this.surrogateSize=3;
break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=o;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=a;break;default:return void(this.write=r)}this.charBuffer=new s(6),this.charReceived=0,this.charLength=0};l.prototype.write=function(e){for(var t="",i=0;this.charLength;){var n=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,i,n),this.charReceived+=n-i,i=n,this.charReceived<this.charLength)return"";t=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var r=t.charCodeAt(t.length-1);if(!(r>=55296&&56319>=r)){if(this.charReceived=this.charLength=0,n==e.length)return t;e=e.slice(n,e.length);break}this.charLength+=this.surrogateSize,t=""}var o=this.detectIncompleteChar(e),a=e.length;this.charLength&&(e.copy(this.charBuffer,0,e.length-o,a),this.charReceived=o,a-=o),t+=e.toString(this.encoding,0,a);var a=t.length-1,r=t.charCodeAt(a);if(r>=55296&&56319>=r){var s=this.surrogateSize;return this.charLength+=s,this.charReceived+=s,this.charBuffer.copy(this.charBuffer,s,0,s),this.charBuffer.write(t.charAt(t.length-1),this.encoding),t.substring(0,a)}return t},l.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var i=e[e.length-t];if(1==t&&i>>5==6){this.charLength=2;break}if(2>=t&&i>>4==14){this.charLength=3;break}if(3>=t&&i>>3==30){this.charLength=4;break}}return t},l.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var i=this.charReceived,n=this.charBuffer,r=this.encoding;t+=n.slice(0,i).toString(r)}return t}},{buffer:70}],92:[function(e,t,i){function n(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function r(e,t,i){if(e&&u(e)&&e instanceof n)return e;var r=new n;return r.parse(e,t,i),r}function o(e){return l(e)&&(e=r(e)),e instanceof n?e.format():n.prototype.format.call(e)}function a(e,t){return r(e,!1,!0).resolve(t)}function s(e,t){return e?r(e,!1,!0).resolveObject(t):t}function l(e){return"string"==typeof e}function u(e){return"object"==typeof e&&null!==e}function c(e){return null===e}function h(e){return null==e}var f=e("punycode");i.parse=r,i.resolve=a,i.resolveObject=s,i.format=o,i.Url=n;var p=/^([a-z0-9.+-]+:)/i,d=/:[0-9]*$/,m=["<",">",'"',"`"," ","\r","\n","	"],g=["{","}","|","\\","^","`"].concat(m),v=["'"].concat(g),y=["%","/","?",";","#"].concat(v),b=["/","?","#"],x=255,w=/^[a-z0-9A-Z_-]{0,63}$/,_=/^([a-z0-9A-Z_-]{0,63})(.*)$/,S={javascript:!0,"javascript:":!0},M={javascript:!0,"javascript:":!0},C={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},A=e("querystring");n.prototype.parse=function(e,t,i){if(!l(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var n=e;n=n.trim();var r=p.exec(n);if(r){r=r[0];var o=r.toLowerCase();this.protocol=o,n=n.substr(r.length)}if(i||r||n.match(/^\/\/[^@\/]+@[^@\/]+/)){var a="//"===n.substr(0,2);!a||r&&M[r]||(n=n.substr(2),this.slashes=!0)}if(!M[r]&&(a||r&&!C[r])){for(var s=-1,u=0;u<b.length;u++){var c=n.indexOf(b[u]);-1!==c&&(-1===s||s>c)&&(s=c)}var h,d;d=-1===s?n.lastIndexOf("@"):n.lastIndexOf("@",s),-1!==d&&(h=n.slice(0,d),n=n.slice(d+1),this.auth=decodeURIComponent(h)),s=-1;for(var u=0;u<y.length;u++){var c=n.indexOf(y[u]);-1!==c&&(-1===s||s>c)&&(s=c)}-1===s&&(s=n.length),this.host=n.slice(0,s),n=n.slice(s),this.parseHost(),this.hostname=this.hostname||"";var m="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!m)for(var g=this.hostname.split(/\./),u=0,T=g.length;T>u;u++){var E=g[u];if(E&&!E.match(w)){for(var k="",P=0,R=E.length;R>P;P++)k+=E.charCodeAt(P)>127?"x":E[P];if(!k.match(w)){var L=g.slice(0,u),D=g.slice(u+1),N=E.match(_);N&&(L.push(N[1]),D.unshift(N[2])),D.length&&(n="/"+D.join(".")+n),this.hostname=L.join(".");break}}}if(this.hostname=this.hostname.length>x?"":this.hostname.toLowerCase(),!m){for(var F=this.hostname.split("."),G=[],u=0;u<F.length;++u){var O=F[u];G.push(O.match(/[^A-Za-z0-9_-]/)?"xn--"+f.encode(O):O)}this.hostname=G.join(".")}var j=this.port?":"+this.port:"",I=this.hostname||"";this.host=I+j,this.href+=this.host,m&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==n[0]&&(n="/"+n))}if(!S[o])for(var u=0,T=v.length;T>u;u++){var V=v[u],U=encodeURIComponent(V);U===V&&(U=escape(V)),n=n.split(V).join(U)}var B=n.indexOf("#");-1!==B&&(this.hash=n.substr(B),n=n.slice(0,B));var z=n.indexOf("?");if(-1!==z?(this.search=n.substr(z),this.query=n.substr(z+1),t&&(this.query=A.parse(this.query)),n=n.slice(0,z)):t&&(this.search="",this.query={}),n&&(this.pathname=n),C[o]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var j=this.pathname||"",O=this.search||"";this.path=j+O}return this.href=this.format(),this},n.prototype.format=function(){var e=this.auth||"";e&&(e=encodeURIComponent(e),e=e.replace(/%3A/i,":"),e+="@");var t=this.protocol||"",i=this.pathname||"",n=this.hash||"",r=!1,o="";this.host?r=e+this.host:this.hostname&&(r=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(r+=":"+this.port)),this.query&&u(this.query)&&Object.keys(this.query).length&&(o=A.stringify(this.query));var a=this.search||o&&"?"+o||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||C[t])&&r!==!1?(r="//"+(r||""),i&&"/"!==i.charAt(0)&&(i="/"+i)):r||(r=""),n&&"#"!==n.charAt(0)&&(n="#"+n),a&&"?"!==a.charAt(0)&&(a="?"+a),i=i.replace(/[?#]/g,function(e){return encodeURIComponent(e)}),a=a.replace("#","%23"),t+r+i+a+n},n.prototype.resolve=function(e){return this.resolveObject(r(e,!1,!0)).format()},n.prototype.resolveObject=function(e){if(l(e)){var t=new n;t.parse(e,!1,!0),e=t}var i=new n;if(Object.keys(this).forEach(function(e){i[e]=this[e]},this),i.hash=e.hash,""===e.href)return i.href=i.format(),i;if(e.slashes&&!e.protocol)return Object.keys(e).forEach(function(t){"protocol"!==t&&(i[t]=e[t])}),C[i.protocol]&&i.hostname&&!i.pathname&&(i.path=i.pathname="/"),i.href=i.format(),i;if(e.protocol&&e.protocol!==i.protocol){if(!C[e.protocol])return Object.keys(e).forEach(function(t){i[t]=e[t]}),i.href=i.format(),i;if(i.protocol=e.protocol,e.host||M[e.protocol])i.pathname=e.pathname;else{for(var r=(e.pathname||"").split("/");r.length&&!(e.host=r.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==r[0]&&r.unshift(""),r.length<2&&r.unshift(""),i.pathname=r.join("/")}if(i.search=e.search,i.query=e.query,i.host=e.host||"",i.auth=e.auth,i.hostname=e.hostname||e.host,i.port=e.port,i.pathname||i.search){var o=i.pathname||"",a=i.search||"";i.path=o+a}return i.slashes=i.slashes||e.slashes,i.href=i.format(),i}var s=i.pathname&&"/"===i.pathname.charAt(0),u=e.host||e.pathname&&"/"===e.pathname.charAt(0),f=u||s||i.host&&e.pathname,p=f,d=i.pathname&&i.pathname.split("/")||[],r=e.pathname&&e.pathname.split("/")||[],m=i.protocol&&!C[i.protocol];if(m&&(i.hostname="",i.port=null,i.host&&(""===d[0]?d[0]=i.host:d.unshift(i.host)),i.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===r[0]?r[0]=e.host:r.unshift(e.host)),e.host=null),f=f&&(""===r[0]||""===d[0])),u)i.host=e.host||""===e.host?e.host:i.host,i.hostname=e.hostname||""===e.hostname?e.hostname:i.hostname,i.search=e.search,i.query=e.query,d=r;else if(r.length)d||(d=[]),d.pop(),d=d.concat(r),i.search=e.search,i.query=e.query;else if(!h(e.search)){if(m){i.hostname=i.host=d.shift();var g=i.host&&i.host.indexOf("@")>0?i.host.split("@"):!1;g&&(i.auth=g.shift(),i.host=i.hostname=g.shift())}return i.search=e.search,i.query=e.query,c(i.pathname)&&c(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.href=i.format(),i}if(!d.length)return i.pathname=null,i.path=i.search?"/"+i.search:null,i.href=i.format(),i;for(var v=d.slice(-1)[0],y=(i.host||e.host)&&("."===v||".."===v)||""===v,b=0,x=d.length;x>=0;x--)v=d[x],"."==v?d.splice(x,1):".."===v?(d.splice(x,1),b++):b&&(d.splice(x,1),b--);if(!f&&!p)for(;b--;b)d.unshift("..");!f||""===d[0]||d[0]&&"/"===d[0].charAt(0)||d.unshift(""),y&&"/"!==d.join("/").substr(-1)&&d.push("");var w=""===d[0]||d[0]&&"/"===d[0].charAt(0);if(m){i.hostname=i.host=w?"":d.length?d.shift():"";var g=i.host&&i.host.indexOf("@")>0?i.host.split("@"):!1;g&&(i.auth=g.shift(),i.host=i.hostname=g.shift())}return f=f||i.host&&d.length,f&&!w&&d.unshift(""),d.length?i.pathname=d.join("/"):(i.pathname=null,i.path=null),c(i.pathname)&&c(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.auth=e.auth||i.auth,i.slashes=i.slashes||e.slashes,i.href=i.format(),i},n.prototype.parseHost=function(){var e=this.host,t=d.exec(e);t&&(t=t[0],":"!==t&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},{punycode:80,querystring:83}],93:[function(e,t){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],94:[function(e,t,i){(function(t,n){function r(e,t){var n={seen:[],stylize:a};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),m(t)?n.showHidden=t:t&&i._extend(n,t),w(n.showHidden)&&(n.showHidden=!1),w(n.depth)&&(n.depth=2),w(n.colors)&&(n.colors=!1),w(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=o),l(n,e,n.depth)}function o(e,t){var i=r.styles[t];return i?"["+r.colors[i][0]+"m"+e+"["+r.colors[i][1]+"m":e}function a(e){return e}function s(e){var t={};return e.forEach(function(e){t[e]=!0}),t}function l(e,t,n){if(e.customInspect&&t&&A(t.inspect)&&t.inspect!==i.inspect&&(!t.constructor||t.constructor.prototype!==t)){var r=t.inspect(n,e);return b(r)||(r=l(e,r,n)),r}var o=u(e,t);if(o)return o;var a=Object.keys(t),m=s(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(t)),C(t)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return c(t);if(0===a.length){if(A(t)){var g=t.name?": "+t.name:"";return e.stylize("[Function"+g+"]","special")}if(_(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(M(t))return e.stylize(Date.prototype.toString.call(t),"date");if(C(t))return c(t)}var v="",y=!1,x=["{","}"];if(d(t)&&(y=!0,x=["[","]"]),A(t)){var w=t.name?": "+t.name:"";v=" [Function"+w+"]"}if(_(t)&&(v=" "+RegExp.prototype.toString.call(t)),M(t)&&(v=" "+Date.prototype.toUTCString.call(t)),C(t)&&(v=" "+c(t)),0===a.length&&(!y||0==t.length))return x[0]+v+x[1];if(0>n)return _(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special");e.seen.push(t);var S;return S=y?h(e,t,n,m,a):a.map(function(i){return f(e,t,n,m,i,y)}),e.seen.pop(),p(S,v,x)}function u(e,t){if(w(t))return e.stylize("undefined","undefined");if(b(t)){var i="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(i,"string")}return y(t)?e.stylize(""+t,"number"):m(t)?e.stylize(""+t,"boolean"):g(t)?e.stylize("null","null"):void 0}function c(e){return"["+Error.prototype.toString.call(e)+"]"}function h(e,t,i,n,r){for(var o=[],a=0,s=t.length;s>a;++a)o.push(R(t,String(a))?f(e,t,i,n,String(a),!0):"");return r.forEach(function(r){r.match(/^\d+$/)||o.push(f(e,t,i,n,r,!0))}),o}function f(e,t,i,n,r,o){var a,s,u;if(u=Object.getOwnPropertyDescriptor(t,r)||{value:t[r]},u.get?s=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(s=e.stylize("[Setter]","special")),R(n,r)||(a="["+r+"]"),s||(e.seen.indexOf(u.value)<0?(s=g(i)?l(e,u.value,null):l(e,u.value,i-1),s.indexOf("\n")>-1&&(s=o?s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+s.split("\n").map(function(e){return"   "+e}).join("\n"))):s=e.stylize("[Circular]","special")),w(a)){if(o&&r.match(/^\d+$/))return s;a=JSON.stringify(""+r),a.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+s}function p(e,t,i){var n=0,r=e.reduce(function(e,t){return n++,t.indexOf("\n")>=0&&n++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0);return r>60?i[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+i[1]:i[0]+t+" "+e.join(", ")+" "+i[1]}function d(e){return Array.isArray(e)}function m(e){return"boolean"==typeof e}function g(e){return null===e}function v(e){return null==e}function y(e){return"number"==typeof e}function b(e){return"string"==typeof e}function x(e){return"symbol"==typeof e}function w(e){return void 0===e}function _(e){return S(e)&&"[object RegExp]"===E(e)}function S(e){return"object"==typeof e&&null!==e}function M(e){return S(e)&&"[object Date]"===E(e)}function C(e){return S(e)&&("[object Error]"===E(e)||e instanceof Error)}function A(e){return"function"==typeof e}function T(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function E(e){return Object.prototype.toString.call(e)}function k(e){return 10>e?"0"+e.toString(10):e.toString(10)}function P(){var e=new Date,t=[k(e.getHours()),k(e.getMinutes()),k(e.getSeconds())].join(":");return[e.getDate(),F[e.getMonth()],t].join(" ")}function R(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var L=/%[sdj%]/g;i.format=function(e){if(!b(e)){for(var t=[],i=0;i<arguments.length;i++)t.push(r(arguments[i]));return t.join(" ")}for(var i=1,n=arguments,o=n.length,a=String(e).replace(L,function(e){if("%%"===e)return"%";if(i>=o)return e;switch(e){case"%s":return String(n[i++]);case"%d":return Number(n[i++]);case"%j":try{return JSON.stringify(n[i++])}catch(t){return"[Circular]"}default:return e}}),s=n[i];o>i;s=n[++i])a+=g(s)||!S(s)?" "+s:" "+r(s);return a},i.deprecate=function(e,r){function o(){if(!a){if(t.throwDeprecation)throw new Error(r);t.traceDeprecation?console.trace(r):console.error(r),a=!0}return e.apply(this,arguments)}if(w(n.process))return function(){return i.deprecate(e,r).apply(this,arguments)};if(t.noDeprecation===!0)return e;var a=!1;return o};var D,N={};i.debuglog=function(e){if(w(D)&&(D=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!N[e])if(new RegExp("\\b"+e+"\\b","i").test(D)){var n=t.pid;N[e]=function(){var t=i.format.apply(i,arguments);console.error("%s %d: %s",e,n,t)}}else N[e]=function(){};return N[e]},i.inspect=r,r.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},r.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},i.isArray=d,i.isBoolean=m,i.isNull=g,i.isNullOrUndefined=v,i.isNumber=y,i.isString=b,i.isSymbol=x,i.isUndefined=w,i.isRegExp=_,i.isObject=S,i.isDate=M,i.isError=C,i.isFunction=A,i.isPrimitive=T,i.isBuffer=e("./support/isBuffer");var F=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];i.log=function(){console.log("%s - %s",P(),i.format.apply(i,arguments))},i.inherits=e("inherits"),i._extend=function(e,t){if(!t||!S(t))return e;for(var i=Object.keys(t),n=i.length;n--;)e[i[n]]=t[i[n]];return e}}).call(this,e("oMfpAn"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":93,inherits:78,oMfpAn:79}],95:[function(e,t){!function(){var i=e("gibber.core.lib");i.Audio=e("gibber.audio.lib")(i),i.Graphics=e("gibber.graphics.lib")(i),i.Interface=e("gibber.interface.lib")(i),i.Communication=e("gibber.communication.lib")(i),t.exports=i}()},{"gibber.audio.lib":5,"gibber.communication.lib":28,"gibber.core.lib":33,"gibber.graphics.lib":61,"gibber.interface.lib":68}]},{},[95])(95)});