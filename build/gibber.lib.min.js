!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.Gibber=e()}}(function(){var define,module,exports;return function e(t,i,n){function r(a,s){if(!i[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);throw new Error("Cannot find module '"+a+"'")}var c=i[a]={exports:{}};t[a][0].call(c.exports,function(e){var i=t[a][1][e];return r(i?i:e)},c,c.exports,e,t,i,n)}return i[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)r(n[a]);return r}({1:[function(_dereq_,module,exports){(function(global){!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.Gibberish=t()}(this,function(){function createInput(){console.log("connecting audio input..."),navigator.getUserMedia({audio:!0},function(e){console.log("audio input connected"),Gibberish.mediaStreamSource=Gibberish.context.createMediaStreamSource(e),Gibberish.mediaStreamSource.connect(Gibberish.node),_hasInput=!0},function(){console.log("error opening audio input")})}var Gibberish={memo:{},codeblock:[],analysisCodeblock:[],analysisUgens:[],dirtied:[],id:0,isDirty:!1,out:null,debug:!1,callback:"",audioFiles:{},sequencers:[],callbackArgs:["input"],callbackObjects:[],analysisCallbackArgs:[],analysisCallbackObjects:[],createCallback:function(){this.memo={},this.codeblock.length=0,this.callbackArgs.length=0,this.callbackObjects.length=0,this.analysisCallbackArgs.length=0,this.dirtied.length=0,this.codestring="",this.args=["input"],this.memo={},this.out.codegen();var e=this.codeblock.slice(0);if(this.analysisUgens.length>0){this.analysisCodeblock.length=0;for(var t=0;t<this.analysisUgens.length;t++)this.analysisCallbackArgs.push(this.analysisUgens[t].analysisSymbol)}if(this.args=this.args.concat(this.callbackArgs),this.args=this.args.concat(this.analysisCallbackArgs),this.codestring+=e.join("	"),this.codestring+="\n	",this.analysisUgens.length>0){this.analysisCodeblock.length=0;for(var t=0;t<this.analysisUgens.length;t++)this.codeblock.length=0,this.analysisUgens[t].analysisCodegen();this.codestring+=this.analysisCodeblock.join("\n	"),this.codestring+="\n	"}return this.codestring+="return "+this.out.variable+";\n",this.callbackString=this.codestring,this.debug&&console.log(this.callbackString),[this.args,this.codestring]},audioProcess:function(e){var t,i,n=e.outputBuffer.getChannelData(0),r=e.outputBuffer.getChannelData(1),o=e.inputBuffer.getChannelData(0),a=Gibberish,s=a.callback,l=a.sequencers,c=(Gibberish.out.callback,a.callbackObjects.slice(0));c.unshift(0);for(var h=0,u=e.outputBuffer.length;u>h;h++){for(var f=0;f<l.length;f++)l[f].tick();if(a.isDirty){t=a.createCallback();try{s=a.callback=new Function(t[0],t[1])}catch(e){console.error("ERROR WITH CALLBACK : \n\n",t)}a.isDirty=!1,c=a.callbackObjects.slice(0),c.unshift(0)}c[0]=o[h],i=s.apply(null,c),n[h]=i[0],r[h]=i[1]}},audioProcessFirefox:function(e){var t,i=Gibberish,n=i.callback,r=i.sequencers,o=i.callbackObjects.slice(0);o.unshift(0);for(var a=0,s=e.length;s>a;a+=2){for(var l=0;l<r.length;l++)r[l].tick();if(i.isDirty){t=i.createCallback();try{n=i.callback=new Function(t[0],t[1])}catch(c){console.error("ERROR WITH CALLBACK : \n\n",n)}i.isDirty=!1,o=i.callbackObjects.slice(0),o.unshift(0)}var h=n.apply(null,o);e[a]=h[0],e[a+1]=h[1]}},clear:function(){this.out.inputs.length=0,this.analysisUgens.length=0,this.sequencers.length=0,this.callbackArgs.length=2,this.callbackObjects.length=1,Gibberish.dirty(this.out)},dirty:function(e){if("undefined"!=typeof e){for(var t=!1,i=0;i<this.dirtied.length;i++)this.dirtied[i].variable===e.variable&&(t=!0);t||(this.isDirty=!0,this.dirtied.push(e))}else this.isDirty=!0},generateSymbol:function(e){return e+"_"+this.id++},AudioDataDestination:function(e,t){var i=new Audio;i.mozSetup(2,e);var n,r=0,o=e/2,a=null;setInterval(function(){var e;if(a){if(e=i.mozWriteAudio(a.subarray(n)),r+=e,n+=e,n<a.length)return;a=null}var s=i.mozCurrentSampleOffset(),l=s+o-r;if(l>0){var c=new Float32Array(l);t(c),e=i.mozWriteAudio(c),s=i.mozCurrentSampleOffset(),e<c.length&&(a=c,n=e),r+=e}},100)},init:function(){var e,t,i="undefined"==typeof arguments[0]?1024:arguments[0];return"undefined"!=typeof webkitAudioContext?e=webkitAudioContext:"undefined"!=typeof AudioContext&&(e=AudioContext),t=function(){if("undefined"!=typeof e){if(document&&document.documentElement&&"ontouchstart"in document.documentElement&&(window.removeEventListener("touchstart",t),"ontouchstart"in document.documentElement)){var i=Gibberish.context.createBufferSource();i.connect(Gibberish.context.destination),i.noteOn(0)}}else alert("Your browser does not support javascript audio synthesis. Please download a modern web browser that is not Internet Explorer.");Gibberish.onstart&&Gibberish.onstart()},Gibberish.context=new e,Gibberish.node=Gibberish.context.createScriptProcessor(i,2,2,Gibberish.context.sampleRate),Gibberish.node.onaudioprocess=Gibberish.audioProcess,Gibberish.node.connect(Gibberish.context.destination),Gibberish.out=new Gibberish.Bus2,Gibberish.out.codegen(),Gibberish.dirty(Gibberish.out),document&&document.documentElement&&"ontouchstart"in document.documentElement?window.addEventListener("touchstart",t):t(),this},makePanner:function(){for(var e=[],t=[],i=Math.sqrt(2)/2,n=0;1024>n;n++){var r=-1+n/1024*2;e[n]=i*(Math.cos(r)-Math.sin(r)),t[n]=i*(Math.cos(r)+Math.sin(r))}return function(i,n,r){var o,a,s,l,c,h,u="object"==typeof i,f=u?i[0]:i,p=u?i[1]:i;return o=1023*(n+1)/2,a=0|o,s=o-a,a=1023&a,l=1023===a?0:a+1,c=e[a],h=e[l],r[0]=(c+s*(h-c))*f,c=t[a],h=t[l],r[1]=(c+s*(h-c))*p,r}},defineUgenProperty:function(e,t,i){var n=i.properties[e]={value:t,binops:[],parent:i,name:e};Object.defineProperty(i,e,{configurable:!0,get:function(){return n.value},set:function(e){n.value=e,Gibberish.dirty(i)}})},polyInit:function(e){e.mod=e.polyMod,e.removeMod=e.removePolyMod,e.voicesClear=function(){if(e.children.length>0){for(var t=0;t<e.children.length;t++)e.children[t].disconnect();e.children.length=0,e.voiceCount=0}};for(var t in e.polyProperties)!function(t){var i=e.polyProperties[t];Object.defineProperty(e,t,{configurable:!0,get:function(){return i},set:function(n){i=n;for(var r=0;r<e.children.length;r++)e.children[r][t]=i}})}(t);var i=e.maxVoices;Object.defineProperty(e,"maxVoices",{get:function(){return i},set:function(e){i=e,this.voicesClear(),this.initVoices()}})},interpolate:function(e,t){var i=0|t,n=i+1>e.length-1?0:i+1;return frac=t-i,e[i]+frac*(e[n]-e[i])},pushUnique:function(e,t){for(var i=e,n=!0,r=0;r<t.length;r++)if(i===t[r]){n=!1;break}n&&t.push(i)},"export":function(e,t){for(var i in Gibberish[e])t[i]=Gibberish[e][i]},ugen:function(){Gibberish.extend(this,{processProperties:function(){if("object"!=typeof arguments[0][0]||"undefined"!=typeof arguments[0][0].type||Array.isArray(arguments[0][0])||"op"===arguments[0][0].name){var e=0;for(var t in this.properties)"object"==typeof this.properties[t]&&"undefined"!=typeof this.properties[t].binops?"undefined"!=typeof arguments[0][e]&&(this.properties[t].value=arguments[0][e++]):"undefined"!=typeof arguments[0][e]&&(this.properties[t]=arguments[0][e++])}else{var i=arguments[0][0];for(var t in i)"undefined"!=typeof i[t]&&("object"==typeof this.properties[t]&&"undefined"!=typeof this.properties[t].binops?this.properties[t].value=i[t]:this[t]=i[t])}return this},valueOf:function(){return this.codegen(),this.variable},codegen:function(){var e="",t=null;if(Gibberish.memo[this.symbol])return Gibberish.memo[this.symbol];t=this.variable?this.variable:Gibberish.generateSymbol("v"),Gibberish.memo[this.symbol]=t,this.variable=t,e+="var "+t+" = "+this.symbol+"(";for(var i in this.properties){var n=this.properties[i],r="";if(Array.isArray(n.value)){0===n.value.length&&(r=0);for(var o=0;o<n.value.length;o++){var a=n.value[o];r+="object"==typeof a?null!==a?a.valueOf():"null":"function"==typeof n.value?n.value():n.value,r+=o<n.value.length-1?", ":""}}else"object"==typeof n.value?null!==n.value&&(r=n.value.codegen?n.value.valueOf():n.value):"undefined"!==n.name&&(r="function"==typeof n.value?n.value():n.value);if(0!=n.binops.length){for(var s=0;s<n.binops.length;s++)e+="(";for(var l=0;l<n.binops.length;l++){var c,h=n.binops[l];c="number"==typeof h.ugen?h.ugen:null!==h.ugen?h.ugen.valueOf():"null","="===h.binop?(e=e.replace(r,""),e+=c):"++"===h.binop?e+=" + Math.abs("+c+")":(0===l&&(e+=r),e+=" "+h.binop+" "+c+")")}}else e+=r;e+=", "}return" "===e.charAt(e.length-1)&&(e=e.slice(0,-2)),e+=");\n",this.codeblock=e,-1===Gibberish.codeblock.indexOf(this.codeblock)&&Gibberish.codeblock.push(this.codeblock),-1===Gibberish.callbackArgs.indexOf(this.symbol)&&"op"!==this.name&&Gibberish.callbackArgs.push(this.symbol),-1===Gibberish.callbackObjects.indexOf(this.callback)&&"op"!==this.name&&Gibberish.callbackObjects.push(this.callback),this.dirty=!1,t},init:function(){if(this.initalized||(this.symbol=Gibberish.generateSymbol(this.name),this.codeblock=null,this.variable=null),"undefined"==typeof this.properties&&(this.properties={}),!this.initialized){this.destinations=[];for(var e in this.properties)Gibberish.defineUgenProperty(e,this.properties[e],this)}if(arguments.length>0&&"object"==typeof arguments[0][0]&&"undefined"===arguments[0][0].type){var t=arguments[0][0];for(var e in t)this[e]=t[e]}return this.initialized=!0,this},mod:function(e,t,i){var n=this.properties[e],r={ugen:t,binop:i};n.binops.push(r),Gibberish.dirty(this)},removeMod:function(e,t){if("undefined"==typeof t)this.properties[e].binops.length=0;else if("number"==typeof t)this.properties[e].binops.splice(t,1);else if("object"==typeof t)for(var i=0,n=this.properties[e].binops.length;n>i;i++)this.properties[e].binops[i].ugen===t&&this.properties[e].binops.splice(i,1);Gibberish.dirty(this)},polyMod:function(e,t,i){for(var n=0;n<this.children.length;n++)this.children[n].mod(e,t,i);Gibberish.dirty(this)},removePolyMod:function(){var e=Array.prototype.slice.call(arguments,0);if("amp"!==arguments[0]&&"pan"!==arguments[0])for(var t=0;t<this.children.length;t++)this.children[t].removeMod.apply(this.children[t],e);else this.removeMod.apply(this,e);Gibberish.dirty(this)},smooth:function(e){var t=new Gibberish.OnePole;this.mod(e,t,"=")},connect:function(e,t){return"undefined"==typeof e&&(e=Gibberish.out),-1===this.destinations.indexOf(e)&&(e.addConnection(this,1,t),this.destinations.push(e)),this},send:function(e,t){return-1===this.destinations.indexOf(e)?(e.addConnection(this,t),this.destinations.push(e)):e.adjustSendAmount(this,t),this},disconnect:function(e,t){var i;if(e)i=this.destinations.indexOf(e),i>-1&&this.destinations.splice(i,1),e.removeConnection(this);else{for(var n=0;n<this.destinations.length;n++)this.destinations[n].removeConnection(this);this.destinations=[]}return Gibberish.dirty(this),this}})}};Array2=function(){this.length=0},Array2.prototype=[],Array2.prototype.remove=function(e,t){if(t="undefined"==typeof t?!0:t,"undefined"==typeof e){for(var i=0;i<this.length;i++)delete this[i];this.length=0}else if("number"==typeof e)this.splice(e,1);else if("string"==typeof e){for(var n=[],i=0;i<this.length;i++){var r=this[i];if(r.type===e||r.name===e){if(!t)return void this.splice(i,1);n.push(i)}}for(var i=0;i<n.length;i++)this.splice(n[i],1)}else if("object"==typeof e)for(var o=this.indexOf(e);o>-1;)this.splice(o,1),o=this.indexOf(e);this.parent&&Gibberish.dirty(this.parent)},Array2.prototype.get=function(e){if("number"==typeof e)return this[e];if("string"==typeof e)for(var t=0;t<this.length;t++){var i=this[t];if(i.name===e)return i}else if("object"==typeof e){var n=this.indexOf(e);if(n>-1)return this[n]}return null},Array2.prototype.replace=function(e,t){if(t.parent=this,t.input=e.input,"number"!=typeof e){var i=this.indexOf(e);i>-1&&this.splice(i,1,t)}else this.splice(e,1,t);this.parent&&Gibberish.dirty(this.parent)},Array2.prototype.insert=function(e,t){if(e.parent=this,this.input=this.parent,Array.isArray(e))for(var i=0;i<e.length;i++)this.splice(t+i,0,e[i]);else this.splice(t,0,e);this.parent&&Gibberish.dirty(this.parent)},Array2.prototype.add=function(){for(var e=0;e<arguments.length;e++)arguments[e].parent=this,arguments[e].input=this.parent,this.push(arguments[e]);this.parent&&(console.log("DIRTYING"),Gibberish.dirty(this.parent))};var rnd=Math.random;Gibberish.rndf=function(e,t,i,n){if(n="undefined"==typeof n?!0:n,"undefined"==typeof i&&"object"!=typeof e){1==arguments.length?(t=arguments[0],e=0):2==arguments.length?(e=arguments[0],t=arguments[1]):(e=0,t=1);var r=t-e,o=Math.random(),a=r*o;return e+a}var s=[],l=[];"undefined"==typeof i&&(i=t||e.length);for(var c=0;i>c;c++){var h;if("object"==typeof arguments[0])h=arguments[0][rndi(0,arguments[0].length-1)];else if(n)h=Gibberish.rndf(e,t);else{for(h=Gibberish.rndf(e,t);l.indexOf(h)>-1;)h=Gibberish.rndf(e,t);l.push(h)}s.push(h)}return s},Gibberish.Rndf=function(){{var e,t,i,n;Math.random}return 0===arguments.length?(e=0,t=1):1===arguments.length?(t=arguments[0],e=0):2===arguments.length?(e=arguments[0],t=arguments[1]):3===arguments.length?(e=arguments[0],t=arguments[1],i=arguments[2]):(e=arguments[0],t=arguments[1],i=arguments[2],n=arguments[3]),function(){var r,o,a;return o="function"==typeof e?e():e,a="function"==typeof t?t():t,r="undefined"==typeof i?Gibberish.rndf(o,a):Gibberish.rndf(o,a,i,n)}},Gibberish.rndi=function(e,t,i,n){var r;if(0===arguments.length?(e=0,t=1):1===arguments.length?(t=arguments[0],e=0):2===arguments.length?(e=arguments[0],t=arguments[1]):(e=arguments[0],t=arguments[1],i=arguments[2],n=arguments[3]),r=t-e,i>r&&(n=!0),"undefined"==typeof i)return r=t-e,Math.round(e+Math.random()*r);for(var o=[],a=[],s=0;i>s;s++){var l;if(n)l=Gibberish.rndi(e,t);else{for(l=Gibberish.rndi(e,t);a.indexOf(l)>-1;)l=Gibberish.rndi(e,t);a.push(l)}o.push(l)}return o},Gibberish.Rndi=function(){{var e,t,i,n,r;Math.random,Math.round}return 0===arguments.length?(e=0,t=1):1===arguments.length?(t=arguments[0],e=0):2===arguments.length?(e=arguments[0],t=arguments[1]):3===arguments.length?(e=arguments[0],t=arguments[1],i=arguments[2]):(e=arguments[0],t=arguments[1],i=arguments[2],n=arguments[3]),r=t-e,"number"==typeof i&&i>r&&(n=!0),function(){var r,o,a;return o="function"==typeof e?e():e,a="function"==typeof t?t():t,r="undefined"==typeof i?Gibberish.rndi(o,a):Gibberish.rndi(o,a,i,n)}},Gibberish.extend=function(e,t){for(var i in t){{i.split(".")}t[i]instanceof Array&&t[i].length<100?(e[i]=t[i].slice(0),"fx"===i&&(e[i].parent=t[i].parent)):"object"!=typeof t[i]||null===t[i]||t[i]instanceof Float32Array?e[i]=t[i]:(e[i]=e[i]||{},arguments.callee(e[i],t[i]))}return e},Function.prototype.clone=function(){return eval("["+this.toString()+"]")[0]},String.prototype.format=function(e,t,i){function n(){var n=this,r=arguments.length+1;for(e=0;r>e;i=arguments[e++])t=i,n=n.replace(RegExp("\\{"+(e-1)+"\\}","g"),t);return n}return n.native=String.prototype.format,n}(),Gibberish.future=function(e,t){var i=new Gibberish.Sequencer({values:[function(){},function(){e(),i.stop(),i.disconnect()}],durations:[t]}).start();return i.cancel=function(){i.stop(),i.disconnect()},i},Gibberish.Proxy=function(){var e=0;Gibberish.extend(this,{name:"proxy",type:"effect",properties:{},callback:function(){return e}}).init(),this.input=arguments[0],e=this.input.parent[this.input.name],delete this.input.parent[this.input.name],this.input.parent.properties[this.input.name].value=this,Object.defineProperty(this.input.parent,this.input.name,{get:function(){return e},set:function(t){e=t}}),Gibberish.dirty(this.input.parent)},Gibberish.Proxy.prototype=new Gibberish.ugen,Gibberish.Proxy2=function(){var e=arguments[0],t=arguments[1];Gibberish.extend(this,{name:"proxy2",type:"effect",properties:{},callback:function(){var i=e[t];return Array.isArray(i)?(i[0]+i[1]+i[2])/3:i}}).init(),this.getInput=function(){return e},this.setInput=function(t){e=t},this.getName=function(){return t},this.setName=function(e){t=e}},Gibberish.Proxy2.prototype=new Gibberish.ugen,Gibberish.Proxy3=function(){var e=arguments[0],t=arguments[1];Gibberish.extend(this,{name:"proxy3",type:"effect",properties:{},callback:function(){var i=e[t];return i||0}}),this.init(),this.codegen=function(){console.log(" CALLED "),this.variable||(this.variable=Gibberish.generateSymbol("v")),Gibberish.callbackArgs.push(this.symbol),Gibberish.callbackObjects.push(this.callback),this.codeblock="var "+this.variable+" = "+this.symbol+"("+e.properties[t].codegen()+");\n"}},Gibberish.Proxy3.prototype=new Gibberish.ugen,Gibberish.oscillator=function(){this.type="oscillator",this.oscillatorInit=function(){return this.fx=new Array2,this.fx.parent=this,this}},Gibberish.oscillator.prototype=new Gibberish.ugen,Gibberish._oscillator=new Gibberish.oscillator,Gibberish.Wavetable=function(){var e=0,t=null,i=Gibberish.context.sampleRate/1024,n=0;this.properties={frequency:440,amp:.25,sync:0},this.getTable=function(){return t},this.setTable=function(e){t=e,i=Gibberish.context.sampleRate/t.length},this.getTableFreq=function(){return i},this.setTableFreq=function(e){i=e},this.getPhase=function(){return e},this.setPhase=function(t){e=t},this.callback=function(r,o){var a,s,l,c,h,u;for(e+=r/i;e>=1024;)e-=1024;return a=0|e,s=e-a,a=1023&a,l=1023===a?0:a+1,c=t[a],h=t[l],0!==u&&(n=u),(c+s*(h-c))*o}},Gibberish.Wavetable.prototype=Gibberish._oscillator,Gibberish.Table=function(e){this.__proto__=new Gibberish.Wavetable,this.name="table";var t=2*Math.PI;if("undefined"==typeof e){e=new Float32Array(1024);for(var i=1024;i--;)e[i]=Math.sin(i/1024*t)}this.setTable(e),this.init(),this.oscillatorInit()},Gibberish.asmSine=function(e,t,i){"use asm";function n(){for(var e=1024,t=1024;e=e-1|0;)t-=1,l[e>>2]=+a(+(t/1024)*6.2848);h=44100/1024}function r(e,t,i){e=+e,t=+t,i=+i;var n=0,r=0,o=0,a=0,u=0,f=0;return s=+(s+e/h),s>=1024&&(s=+(s-1024)),n=+c(s),a=s-n,r=~~n,o=(r|0)==1024?0:r+1|0,u=+l[r>>2],f=+l[o>>2],+((u+a*(f-u))*t)}function o(e){return e|=0,+l[e>>2]}var a=e.Math.sin,s=0,l=new e.Float32Array(i),c=e.Math.floor,h=0;return{init:n,gen:r,get:o}},Gibberish.asmSine2=function(){this.properties={frequency:440,amp:.5,sr:Gibberish.context.sampleRate},this.name="sine";var e=new ArrayBuffer(4096),t=Gibberish.asmSine(window,null,e);return t.init(),this.getTable=function(){return e},this.get=t.get,this.callback=t.gen,this.init(),this.oscillatorInit(),this.processProperties(arguments),this},Gibberish.asmSine2.prototype=Gibberish._oscillator,Gibberish.Sine=function(){this.__proto__=new Gibberish.Wavetable,this.name="sine";for(var e=2*Math.PI,t=new Float32Array(1024),i=1024;i--;)t[i]=Math.sin(i/1024*e);this.setTable(t),this.init(arguments),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.Sine2=function(){this.__proto__=new Gibberish.Sine,this.name="sine2";var e=this.__proto__.callback,t=Gibberish.makePanner(),i=[0,0];this.callback=function(n,r,o){var a=e(n,r);return i=t(a,o,i)},this.init(),this.oscillatorInit(),Gibberish.defineUgenProperty("pan",0,this),this.processProperties(arguments)},Gibberish.Square=function(){this.__proto__=new Gibberish.Wavetable,this.name="square";for(var e=(2*Math.PI,new Float32Array(1024)),t=1024;t--;)e[t]=t/1024>.5?1:-1;this.setTable(e),this.init(arguments),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.Saw=function(){this.__proto__=new Gibberish.Wavetable,this.name="saw";for(var e=new Float32Array(1024),t=1024;t--;)e[t]=4*((t/1024/2+.25)%.5-.25);this.setTable(e),this.init(arguments),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.Saw2=function(){this.__proto__=new Gibberish.Saw,this.name="saw2";var e=this.__proto__.callback,t=Gibberish.makePanner(),i=[0,0];this.callback=function(n,r,o){var a=e(n,r);return i=t(a,o,i)},this.init(),Gibberish.defineUgenProperty("pan",0,this)},Gibberish.Triangle=function(){this.__proto__=new Gibberish.Wavetable,this.name="triangle";for(var e=new Float32Array(1024),t=Math.abs,i=1024;i--;)e[i]=1-4*t((i/1024+.25)%1-.5);this.setTable(e),this.init(arguments),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.Triangle2=function(){this.__proto__=new Gibberish.Triangle,this.name="triangle2";var e=this.__proto__.callback,t=Gibberish.makePanner(),i=[0,0];this.callback=function(n,r,o){var a=e(n,r);return t(a,o,i)},this.init(),this.oscillatorInit(),Gibberish.defineUgenProperty("pan",0,this),this.processProperties(arguments)},Gibberish.Saw3=function(){var e=0,t=0,i=2.5,n=-1.5,r=0,o=Math.sin,a=11;pi_2=2*Math.PI,flip=0,signHistory=0,ignore=!1,sr=Gibberish.context.sampleRate,Gibberish.extend(this,{name:"saw",properties:{frequency:440,amp:.15,sync:0,sr:Gibberish.context.sampleRate},callback:function(s){var l=s/sr,c=.5-l,h=a*c*c*c*c,u=.376-.752*l,f=1-2*l,p=0;return t+=l,t-=t>1?2:0,e=.5*(e+o(pi_2*(t+e*h))),p=i*e+n*r,r=e,p+=u,p*=f}}),Object.defineProperty(this,"scale",{get:function(){return a},set:function(e){a=e}}),this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.Saw3.prototype=Gibberish._oscillator,Gibberish.PWM=function(){var e=0,t=0,i=0,n=0,r=0,o=2.5,a=-1.5,s=Math.sin,l=11;pi_2=2*Math.PI,test=0,sr=Gibberish.context.sampleRate,Gibberish.extend(this,{name:"pwm",properties:{frequency:440,amp:.15,pulsewidth:.05,sr:Gibberish.context.sampleRate},callback:function(c,h,u){var f=c/sr,p=.5-f,d=l*p*p*p*p,m=1-2*f,g=0;return r+=f,r-=r>1?2:0,e=.5*(e+s(pi_2*(r+e*d))),t=.5*(t+s(pi_2*(r+t*d+u))),g=t-e,g=o*g+a*(i-n),i=e,n=t,g*m*h}}),Object.defineProperty(this,"scale",{get:function(){return l},set:function(e){l=e}}),this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.PWM.prototype=Gibberish._oscillator,Gibberish.Noise=function(){var e=Math.random;Gibberish.extend(this,{name:"noise",properties:{amp:1},callback:function(t){return(2*e()-1)*t}}),this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.Noise.prototype=Gibberish._oscillator,Gibberish.KarplusStrong=function(){var e=[0],t=0,i=Math.random,n=Gibberish.makePanner(),r=Gibberish.context.sampleRate,o=[0,0];Gibberish.extend(this,{name:"karplus_strong",frequency:0,properties:{blend:1,damping:0,amp:1,channels:2,pan:0},note:function(t){var n=Math.floor(r/t);e.length=0;for(var o=0;n>o;o++)e[o]=2*i()-1;this.frequency=t},callback:function(r,a,s,l,c){var h=e.shift(),u=i()>r?-1:1;a=a>0?a:0;var f=u*(h+t)*(.5-a/100);return t=f,e.push(f),f*=s,1===l?f:n(f,c,o)}}).init().oscillatorInit().processProperties(arguments)},Gibberish.KarplusStrong.prototype=Gibberish._oscillator,Gibberish.PolyKarplusStrong=function(){this.__proto__=new Gibberish.Bus2,Gibberish.extend(this,{name:"poly_karplus_strong",maxVoices:5,voiceCount:0,_frequency:0,polyProperties:{blend:1,damping:0},note:function(e,t){var i=this.children[this.voiceCount++];this.voiceCount>=this.maxVoices&&(this.voiceCount=0),i.note(e,t),this._frequency=e},initVoices:function(){for(var e=0;e<this.maxVoices;e++){var t={blend:this.blend,damping:this.damping,channels:2,amp:1},i=new Gibberish.KarplusStrong(t).connect(this);this.children.push(i)}}}),this.amp=1/this.maxVoices,this.children=[],"object"==typeof arguments[0]&&(this.maxVoices=arguments[0].maxVoices?arguments[0].maxVoices:this.maxVoices),Gibberish.polyInit(this),this.initVoices(),this.processProperties(arguments),this.initialized=!1,Gibberish._synth.oscillatorInit.call(this),Gibberish.dirty(this)},Gibberish.bus=function(){this.type="bus",this.inputCodegen=function(){var e,t=this.value.valueOf();return e=t+", "+this.amp,this.codeblock=e,e},this.addConnection=function(){var e=arguments[2],t={value:arguments[0],amp:arguments[1],codegen:this.inputCodegen,valueOf:function(){return this.codegen()}};"undefined"!=typeof e?this.inputs.splice(e,0,t):this.inputs.push(t),Gibberish.dirty(this)},this.removeConnection=function(e){for(var t=0;t<this.inputs.length;t++)if(this.inputs[t].value===e){this.inputs.splice(t,1),Gibberish.dirty(this);break}},this.adjustSendAmount=function(e,t){for(var i=0;i<this.inputs.length;i++)if(this.inputs[i].value===e){this.inputs[i].amp=t,Gibberish.dirty(this);break}},this.callback=function(){var e=arguments[arguments.length-2],t=arguments[arguments.length-1];output[0]=output[1]=0;for(var i=0;i<arguments.length-2;i+=2){var n="object"==typeof arguments[i],r=arguments[i+1];output[0]+=n?arguments[i][0]*r:arguments[i]*r,output[1]+=n?arguments[i][1]*r:arguments[i]*r}return output[0]*=e,output[1]*=e,panner(output,t,output)}},Gibberish.bus.prototype=new Gibberish.ugen,Gibberish._bus=new Gibberish.bus,Gibberish.Bus=function(){return Gibberish.extend(this,{name:"bus",properties:{inputs:[],amp:1},callback:function(){for(var e=0,t=arguments.length-1,i=arguments[t],n=0;t>n;n++)e+=arguments[n];return e*=i}}),this.init(),this.processProperties(arguments),this},Gibberish.Bus.prototype=Gibberish._bus,Gibberish.Bus2=function(){this.name="bus2",this.type="bus",this.properties={inputs:[],amp:1,pan:0};var e=[0,0],t=Gibberish.makePanner();this.callback=function(){var i=arguments,n=i.length,r=i[n-2],o=i[n-1];e[0]=e[1]=0;for(var a=0,s=n-2;s>a;a+=2){var l="object"==typeof i[a],c=i[a+1];e[0]+=l?i[a][0]*c||0:i[a]*c||0,e[1]+=l?i[a][1]*c||0:i[a]*c||0}return e[0]*=r,e[1]*=r,t(e,o,e)},this.show=function(){console.log(e,args)},this.getOutput=function(){return e},this.getArgs=function(){return args},this.init(arguments),this.processProperties(arguments)},Gibberish.Bus2.prototype=Gibberish._bus,Gibberish.envelope=function(){this.type="envelope"},Gibberish.envelope.prototype=new Gibberish.ugen,Gibberish._envelope=new Gibberish.envelope,Gibberish.ExponentialDecay=function(){var e=Math.pow,t=0,i=0;Gibberish.extend(this,{name:"ExponentialDecay",properties:{decay:.5,length:11050},callback:function(n,r){return t=e(n,i),i+=1/r,t},trigger:function(){i="number"==typeof arguments[0]?arguments[0]:0}}).init()},Gibberish.ExponentialDecay.prototype=Gibberish._envelope,Gibberish.Line=function(e,t,i,n){var r,o={name:"line",properties:{start:e||0,end:isNaN(t)?1:t,time:i||Gibberish.context.sampleRate,loops:n||!1},retrigger:function(e,t){a=0,this.start=r,this.end=e,this.time=t,s=(e-r)/t},getPhase:function(){return a},getIncr:function(){return s},getOut:function(){return r}},a=0,s=(t-e)/i;return this.callback=function(e,t,i,n){return r=i>a?e+a++*s:t,a=r>=t&&n?0:a,r},Gibberish.extend(this,o),this.init(),this},Gibberish.Line.prototype=Gibberish._envelope,Gibberish.AD=function(e,t){var i=0,n=0;Gibberish.extend(this,{name:"AD",properties:{attack:e||1e4,decay:t||1e4},run:function(){return n=0,i=0,this},callback:function(e,t){if(e=0>e?22050:e,t=0>t?22050:t,0===n){var r=1/e;i+=r,i>=1&&n++}else if(1===n){var r=1/t;i-=r,0>=i&&(i=0,n++)}return i},getState:function(){return n}}).init().processProperties(arguments)},Gibberish.AD.prototype=Gibberish._envelope,Gibberish.ADSR=function(e,t,i,n,r,o,a){var s={name:"adsr",type:"envelope",requireReleaseTrigger:"undefined"!=typeof a?a:!1,properties:{attack:isNaN(e)?1e4:e,decay:isNaN(t)?1e4:t,sustain:isNaN(i)?22050:i,release:isNaN(n)?1e4:n,attackLevel:r||1,sustainLevel:o||.5,releaseTrigger:0},run:function(){this.setPhase(0),this.setState(0)},stop:function(){this.releaseTrigger=1}};Gibberish.extend(this,s);var l=0,c=0,h=0,u=this;return this.callback=function(e,t,i,n,r,o,a){var s=0;return h=1===h?1:a,0===c?(s=l/e*r,++l/e>=1&&(c++,l=t)):1===c?(s=l/t*(r-o)+o,--l<=0&&(null!==i?(c+=1,l=i):(c+=2,l=n))):2===c?(s=o,u.requireReleaseTrigger&&h?(c++,l=n,u.releaseTrigger=0,h=0):l--<=0&&!u.requireReleaseTrigger&&(c++,l=n)):3===c&&(l--,s=l/n*o,0>=l&&c++),s},this.call=function(){return this.callback(this.attack,this.decay,this.sustain,this.release,this.attackLevel,this.sustainLevel,this.releaseTrigger)},this.getPhase=function(){return l},this.setPhase=function(e){l=e},this.setState=function(e){c=e,l=0},this.getState=function(){return c},this.init(),this},Gibberish.ADSR.prototype=Gibberish._envelope,Gibberish.ADR=function(e,t,i,n,r){var o={name:"adr",type:"envelope",properties:{attack:isNaN(e)?11025:e,decay:isNaN(t)?11025:t,release:isNaN(i)?22050:i,attackLevel:n||1,releaseLevel:r||.2},run:function(){this.setPhase(0),this.setState(0)}};Gibberish.extend(this,o);var a=0,s=0;return this.callback=function(e,t,i,n,r){var o=0;return 0===s?(o=a/e*n,++a/e===1&&(s++,a=t)):1===s?(o=a/t*(n-r)+r,--a<=0&&(s+=1,a=i)):2===s&&(a--,o=a/i*r,0>=a&&s++),o},this.setPhase=function(e){a=e},this.setState=function(e){s=e,a=0},this.getState=function(){return s},this.init(),this},Gibberish.ADR.prototype=Gibberish._envelope,Gibberish.analysis=function(){this.type="analysis",this.codegen=function(){if(Gibberish.memo[this.symbol])return Gibberish.memo[this.symbol];var e=this.variable?this.variable:Gibberish.generateSymbol("v");return Gibberish.memo[this.symbol]=e,this.variable=e,Gibberish.callbackArgs.push(this.symbol),Gibberish.callbackObjects.push(this.callback),this.codeblock="var "+this.variable+" = "+this.symbol+"();\n",-1===Gibberish.codeblock.indexOf(this.codeblock)&&Gibberish.codeblock.push(this.codeblock),this.variable},this.analysisCodegen=function(){var e=0;this.input.codegen?(e=this.input.codegen(),e.indexOf("op")>-1&&console.log("ANALYSIS BUG")):e=this.input.value?"undefined"!=typeof this.input.value.codegen?this.input.value.codegen():this.input.value:"null";var t=this.analysisSymbol+"("+e+",";for(var i in this.properties)"input"!==i&&(t+=this[i]+",");return t=t.slice(0,-1),t+=");",this.analysisCodeblock=t,-1===Gibberish.analysisCodeblock.indexOf(this.analysisCodeblock)&&Gibberish.analysisCodeblock.push(this.analysisCodeblock),-1===Gibberish.callbackObjects.indexOf(this.analysisCallback)&&Gibberish.callbackObjects.push(this.analysisCallback),t},this.remove=function(){Gibberish.analysisUgens.splice(Gibberish.analysisUgens.indexOf(this),1)},this.analysisInit=function(){this.analysisSymbol=Gibberish.generateSymbol(this.name),Gibberish.analysisUgens.push(this),Gibberish.dirty()}},Gibberish.analysis.prototype=new Gibberish.ugen,Gibberish._analysis=new Gibberish.analysis,Gibberish.Follow=function(){this.name="follow",this.properties={input:0,bufferSize:4410,mult:1,useAbsoluteValue:!0};var e=Math.abs,t=[0],i=0,n=0,r=0;this.analysisCallback=function(o,a,s,l){"object"==typeof o&&(o=o[0]+o[1]),i+=l?e(o):o,i-=t[n],t[n]=l?e(o):o,n=(n+1)%a,t[n]=t[n]?t[n]:0,r=i/a*s},this.callback=this.getValue=function(){return r},this.init(),this.analysisInit(),this.processProperties(arguments);var o=(this.__lookupSetter__("bufferSize"),this.bufferSize);Object.defineProperty(this,"bufferSize",{get:function(){return o},set:function(e){o=e,i=0,t=[0],n=0}})},Gibberish.Follow.prototype=Gibberish._analysis,Gibberish.SingleSampleDelay=function(){this.name="single_sample_delay",this.properties={input:arguments[0]||0,amp:arguments[1]||1};var e=0;this.analysisCallback=function(t){e=t},this.callback=function(){return e},this.getValue=function(){return e},this.init(),this.analysisInit(),this.processProperties(arguments)},Gibberish.SingleSampleDelay.prototype=Gibberish._analysis,Gibberish.Record=function(e,t,i){var n=new Float32Array(t),r=0,o=!1,a=this;Gibberish.extend(this,{name:"record",oncomplete:i,properties:{input:0,size:t||0},analysisCallback:function(e,t){o&&(n[r++]="object"==typeof e?e[0]+e[1]:e,r>=t&&(o=!1,a.remove()))},record:function(){return r=0,o=!0,this},getBuffer:function(){return n},getPhase:function(){return r},remove:function(){"undefined"!=typeof this.oncomplete&&this.oncomplete();for(var e=0;e<Gibberish.analysisUgens.length;e++){var t=Gibberish.analysisUgens[e];if(t===this)return Gibberish.callbackArgs.indexOf(this.analysisSymbol)>-1&&Gibberish.callbackArgs.splice(Gibberish.callbackArgs.indexOf(this.analysisSymbol),1),Gibberish.callbackObjects.indexOf(this.analysisCallback)>-1&&Gibberish.callbackObjects.splice(Gibberish.callbackObjects.indexOf(this.analysisCallback),1),void Gibberish.analysisUgens.splice(e,1)}}}),this.properties.input=e,this.init(),this.analysisInit(),Gibberish.dirty()},Gibberish.Record.prototype=Gibberish._analysis,Gibberish.effect=function(){this.type="effect"
},Gibberish.effect.prototype=new Gibberish.ugen,Gibberish._effect=new Gibberish.effect,Gibberish.Distortion=function(){var e=Math.abs,t=Math.log,i=Math.LN2;Gibberish.extend(this,{name:"distortion",properties:{input:0,amount:50},callback:function(n,r){var o;return r=r>2?r:2,"number"==typeof n?(o=n*r,n=o/(1+e(o))/(t(r)/i)):(o=n[0]*r,n[0]=o/(1+e(o))/(t(r)/i),o=n[1]*r,n[1]=o/(1+e(o))/(t(r)/i)),n}}).init().processProperties(arguments)},Gibberish.Distortion.prototype=Gibberish._effect,Gibberish.Gain=function(){Gibberish.extend(this,{name:"gain",properties:{input:0,amount:1},callback:function(e,t){return"number"==typeof e?e*=t:(e[0]*=t,e[1]*=t),e}}).init().processProperties(arguments)},Gibberish.Gain.prototype=Gibberish._effect,Gibberish.Delay=function(){var e=[],t=0;e.push(new Float32Array(2*Gibberish.context.sampleRate)),e.push(new Float32Array(2*Gibberish.context.sampleRate)),Gibberish.extend(this,{name:"delay",properties:{input:0,time:22050,feedback:.5,wet:1,dry:1},callback:function(i,n,r,o,a){var s="number"==typeof i?1:2,l=t++%88200,c=(l+(0|n))%88200;return 1===s?(e[0][c]=(i+e[0][l])*r,i=i*a+e[0][l]*o):(e[0][c]=(i[0]+e[0][l])*r,i[0]=i[0]*a+e[0][l]*o,e[1][c]=(i[1]+e[1][l])*r,i[1]=i[1]*a+e[1][l]*o),i}});var i=Math.round(this.properties.time);Object.defineProperty(this,"time",{configurable:!0,get:function(){return i},set:function(e){i=Math.round(e),Gibberish.dirty(this)}}),this.init(),this.processProperties(arguments)},Gibberish.Delay.prototype=Gibberish._effect,Gibberish.Decimator=function(){var e=0,t=[],i=Math.pow,n=Math.floor;Gibberish.extend(this,{name:"decimator",properties:{input:0,bitDepth:16,sampleRate:1},callback:function(r,o,a){e+=a;var s="number"==typeof r?1:2;if(1===s){if(e>=1){var l=i(o,2);t[0]=n(r*l)/l,e-=1}r=t[0]}else{if(e>=1){var l=i(o,2);t[0]=n(r[0]*l)/l,t[1]=n(r[1]*l)/l,e-=1}r=t}return r}}).init().processProperties(arguments)},Gibberish.Decimator.prototype=Gibberish._effect,Gibberish.RingModulation=function(){var e=(new Gibberish.Sine).callback,t=[0,0];Gibberish.extend(this,{name:"ringmod",properties:{input:0,frequency:440,amp:.5,mix:.5},callback:function(i,n,r,o){var a="number"==typeof i?1:2,s=1===a?i:i[0],l=e(n,r);if(s=s*(1-o)+s*l*o,2===a){var c=i[1];return c=c*(1-o)+c*l*o,t[0]=s,t[1]=c,t}return s}}).init().processProperties(arguments)},Gibberish.RingModulation.prototype=Gibberish._effect,Gibberish.DCBlock=function(){var e=0,t=0;Gibberish.extend(this,{name:"dcblock",type:"effect",properties:{input:0},reset:function(){e=0,t=0},callback:function(i){var n=i-e+.9997*t;return e=i,t=n,n}}).init().processProperties(arguments)},Gibberish.DCBlock.prototype=Gibberish._effect,Gibberish.Tremolo=function(){var e=(new Gibberish.Sine).callback;Gibberish.extend(this,{name:"tremolo",type:"effect",properties:{input:0,frequency:2.5,amp:.5},callback:function(t,i,n){var r="number"==typeof t?1:2,o=e(i,n);return 1===r?t*=o:(t[0]*=o,t[1]*=o),t}}).init().processProperties(arguments)},Gibberish.Tremolo.prototype=Gibberish._effect,Gibberish.OnePole=function(){var e=0;Gibberish.extend(this,{name:"onepole",type:"effect",properties:{input:0,a0:.15,b1:.85},callback:function(t,i,n){var r=t*i+e*n;return e=r,r},smooth:function(t,i){this.input=i[t],e=this.input,i[t]=this,this.obj=i,this.property=t,this.oldSetter=i.__lookupSetter__(t),this.oldGetter=i.__lookupGetter__(t);var n=this;Object.defineProperty(i,t,{get:function(){return n.input},set:function(e){n.input=e}})},remove:function(){Object.defineProperty(this.obj,this.property,{get:this.oldGetter,set:this.oldSetter}),this.obj[this.property]=this.input}}).init().processProperties(arguments)},Gibberish.OnePole.prototype=Gibberish._effect,Gibberish.Filter24=function(){var e=[0,0,0,0],t=[0,0,0,0],i=[0,0],n=isNaN(arguments[0])?.1:arguments[0],r=isNaN(arguments[1])?3:arguments[1];_isLowPass="undefined"!=typeof arguments[2]?arguments[2]:!0,Gibberish.extend(this,{name:"filter24",properties:{input:0,cutoff:n,resonance:r,isLowPass:_isLowPass},callback:function(n,r,o,a){var s="number"==typeof n?1:2,l=1===s?n:n[0],c=e[3]*o;if(c=c>1?1:c,r=0>r?0:r,r=r>1?1:r,l-=c,e[0]=e[0]+(-e[0]+l)*r,e[1]=e[1]+(-e[1]+e[0])*r,e[2]=e[2]+(-e[2]+e[1])*r,e[3]=e[3]+(-e[3]+e[2])*r,l=a?e[3]:l-e[3],2===s){var h=n[1];return c=t[3]*o,c=c>1?1:c,h-=c,t[0]=t[0]+(-t[0]+h)*r,t[1]=t[1]+(-t[1]+t[0])*r,t[2]=t[2]+(-t[2]+t[1])*r,t[3]=t[3]+(-t[3]+t[2])*r,h=a?t[3]:h-t[3],i[0]=l,i[1]=h,i}return l}}).init().processProperties(arguments)},Gibberish.Filter24.prototype=Gibberish._effect,Gibberish.SVF=function(){var e=[0,0],t=[0,0],i=Math.PI,n=[0,0];Gibberish.extend(this,{name:"SVF",properties:{input:0,cutoff:440,Q:2,mode:0,sr:Gibberish.context.sampleRate},callback:function(r,o,a,s,l){var c="number"==typeof r?1:2,h=1===c?r:r[0],u=2*i*o/l;a=1/a;var f=t[0]+u*e[0],p=h-f-a*e[0],d=u*p+e[0],m=p+f;if(e[0]=d,t[0]=f,h=0===s?f:1===s?p:2===s?d:m,2===c){var g=r[1],f=t[1]+u*e[1],p=g-f-a*e[1],d=u*p+e[1],m=p+f;e[1]=d,t[1]=f,g=0===s?f:1===s?p:2===s?d:m,n[0]=h,n[1]=g}else n=h;return n}}).init().processProperties(arguments)},Gibberish.SVF.prototype=Gibberish._effect,Gibberish.Biquad=function(){var e=0,t=0,i=0,n=0,r=0,o=0,a=0,s=0,l=[0,0],c=.001639,h=.003278,u=.001639,f=-1.955777,p=.960601,d="LP",m=2e3,g=.5,v=Gibberish.context.sampleRate;Gibberish.extend(this,{name:"biquad",properties:{input:null},calculateCoefficients:function(){switch(d){case"LP":var e=2*Math.PI*m/v,t=Math.sin(e),i=Math.cos(e),n=t/(2*g);c=(1-i)/2,h=1-i,u=c,a0=1+n,f=-2*i,p=1-n;break;case"HP":var e=2*Math.PI*m/v,t=Math.sin(e),i=Math.cos(e),n=t/(2*g);c=(1+i)/2,h=-(1+i),u=c,a0=1+n,f=-2*i,p=1-n;break;case"BP":var e=2*Math.PI*m/v,t=Math.sin(e),i=Math.cos(e),r=Math.log(2)/2*g*e/t,n=t*(Math.exp(r)-Math.exp(-r))/2;c=n,h=0,u=-n,a0=1+n,f=-2*i,p=1-n;break;default:return}c/=a0,h/=a0,u/=a0,f/=a0,p/=a0},callback:function(d){var m=isNaN(d)?2:1,g=0,v=0,y=1===m?d:d[0];return g=c*y+h*e+u*t-f*i-p*n,t=e,e=y,n=i,i=g,2===m&&(inR=d[1],v=c*inR+h*r+u*o-f*a-p*s,o=r,r=inR,s=a,a=v,l[0]=g,l[1]=v),1===m?g:l}}).init(),Object.defineProperties(this,{mode:{get:function(){return d},set:function(e){d=e,this.calculateCoefficients()}},cutoff:{get:function(){return m},set:function(e){m=e,this.calculateCoefficients()}},Q:{get:function(){return g},set:function(e){g=e,this.calculateCoefficients()}}}),this.processProperties(arguments),this.calculateCoefficients()},Gibberish.Biquad.prototype=Gibberish._effect,Gibberish.Flanger=function(){var e=[new Float32Array(88200),new Float32Array(88200)],t=88200,i=(new Gibberish.Sine).callback,n=Gibberish.interpolate,r=-100,o=0;Gibberish.extend(this,{name:"flanger",properties:{input:0,rate:.25,feedback:0,amount:125,offset:125},callback:function(a,s,l,c){var h="number"==typeof a?1:2,u=r+i(s,.95*c);u>t?u-=t:0>u&&(u+=t);var f=n(e[0],u);return e[0][o]=1===h?a+f*l:a[0]+f*l,2===h?(a[0]+=f,f=n(e[1],u),e[1][o]=a[1]+f*l,a[1]+=f):a+=f,++o>=t&&(o=0),++r>=t&&(r=0),a}}).init().processProperties(arguments),r=-1*this.offset},Gibberish.Flanger.prototype=Gibberish._effect,Gibberish.Vibrato=function(){var e=[new Float32Array(88200),new Float32Array(88200)],t=88200,i=(new Gibberish.Sine).callback,n=Gibberish.interpolate,r=-100,o=0;Gibberish.extend(this,{name:"vibrato",properties:{input:0,rate:5,amount:.5,offset:125},callback:function(a,s,l,c){var h="number"==typeof a?1:2,u=r+i(s,l*c-1);u>t?u-=t:0>u&&(u+=t);var f=n(e[0],u);return e[0][o]=1===h?a:a[0],2===h?(a[0]=f,f=n(e[1],u),e[1][o]=a[1],a[1]=f):a=f,++o>=t&&(o=0),++r>=t&&(r=0),a}}).init().processProperties(arguments),r=-1*this.offset},Gibberish.Vibrato.prototype=Gibberish._effect,Gibberish.BufferShuffler=function(){var e=[new Float32Array(88200),new Float32Array(88200)],t=88200,i=0,n=0,r=0,o=0,a=0,s=Math.random,l=1,c=!1,h=!1,u=!1,f=Gibberish.interpolate,p=!1,d=1,m=!1,g=Gibberish.rndf,v=[0,0];Gibberish.extend(this,{name:"buffer_shuffler",properties:{input:0,chance:.25,rate:11025,length:22050,reverseChange:.5,pitchChance:.5,pitchMin:.25,pitchMax:2,wet:1,dry:0},callback:function(y,b,x,w,_,S,M,C,T,A){var E="number"==typeof y?1:2;a?++o%(w-400)===0&&(c=!1,h=!0,l=1,o=0):(e[0][n]=1===E?y:y[0],e[1][n]=1===E?y:y[1],n++,n%=t,m=0===n?1:m,r++,r%x==0&&s()<b&&(u=s()<_,a=!0,u||(i=n-w,0>i&&(i=t+i)),p=s()<S,p&&(d=g(M,C)),l=1,c=!0,h=!1)),i+=u?-1*d:d,0>i?i+=t:i>=t&&(i-=t);var P,k,R,L,D=f(e[0],i);return c?(l-=.0025,R=D*(1-l),P=1===E?R+y*l:R+y[0]*l,2===E&&(L=f(e[1],i),R=L*(1-l),k=1===E?P:R+y[1]*l),.0025>=l&&(c=!1)):h?(l-=.0025,R=D*l,P=1===E?R+y*l:R+y[0]*(1-l),2===E&&(L=f(e[1],i),R=L*l,k=R+y[1]*(1-l)),.0025>=l&&(h=!1,a=!1,u=!1,d=1,p=0)):1===E?P=a&&m?D*T+y*A:y:(L=f(e[1],i),P=a&&m?D*T+y[0]*A:y[0],k=a&&m?L*T+y[1]*A:y[1]),v=[P,k],1===E?P:v}}).init().processProperties(arguments)},Gibberish.BufferShuffler.prototype=Gibberish._effect,Gibberish.AllPass=function(e){var t=-1,i=new Float32Array(e||500),n=i.length;Gibberish.extend(this,{name:"allpass",properties:{input:0},callback:function(e){t=++t%n;var r=i[t],o=-1*e+r;return i[t]=e+.5*r,o}})},Gibberish.Comb=function(e){var t=new Float32Array(e||1200),i=t.length,n=0,r=0;Gibberish.extend(this,{name:"comb",properties:{input:0,feedback:.84,damping:.2},callback:function(e,o,a){var s=++n%i,l=t[s];return r=l*(1-a)+r*a,t[s]=e+r*o,l}})},Gibberish.Reverb=function(){var e={combCount:8,combTuning:[1116,1188,1277,1356,1422,1491,1557,1617],allPassCount:4,allPassTuning:[556,441,341,225],allPassFeedback:.5,fixedGain:.015,scaleDamping:.4,scaleRoom:.28,offsetRoom:.7,stereoSpread:23},t=.84,i=[],n=[],r=[0,0];Gibberish.extend(this,{name:"reverb",roomSize:.5,properties:{input:0,wet:.5,dry:.55,roomSize:.84,damping:.5},callback:function(e,t,o,a,s){for(var l="object"==typeof e?2:1,c=1===l?e:e[0]+e[1],h=.015*c,u=h,f=0;8>f;f++){var p=i[f](h,.98*a,.4*s);u+=p}for(var f=0;4>f;f++)u=n[f](u);return r[0]=r[1]=c*o+u*t,r}}).init().processProperties(arguments),this.setFeedback=function(e){t=e};for(var o=0;8>o;o++)i.push(new Gibberish.Comb(e.combTuning[o]).callback);for(var o=0;4>o;o++)n.push(new Gibberish.AllPass(e.allPassTuning[o],e.allPassFeedback).callback)},Gibberish.Reverb.prototype=Gibberish._effect,Gibberish.StereoReverb=function(){var e={combCount:8,combTuning:[1116,1188,1277,1356,1422,1491,1557,1617],allPassCount:4,allPassTuning:[556,441,341,225],allPassFeedback:.5,fixedGain:.015,scaleDamping:.4,scaleRoom:.28,offsetRoom:.7,stereoSpread:23},t=.84,i=[],n=[],r=[],o=[],a=[0,0];Gibberish.extend(this,{name:"reverb",roomSize:.5,properties:{input:0,wet:.5,dry:.55,roomSize:.84,damping:.5},callback:function(e,t,s,l,c){for(var h="object"==typeof e?2:1,u=e[0],f=1===h?u:e[1],p=outL=.015*u,d=outR=.015*f,m=0;8>m;m++)outL+=i[m](p,.98*l,.4*c),outR+=n[m](d,.98*l,.4*c);for(var m=0;4>m;m++)outL=r[m](outL),outR=o[m](outR);return a[0]=u*s+outL*t,a[1]=f*s+outR*t,a}}).init().processProperties(arguments),this.setFeedback=function(e){t=e};for(var s=0;8>s;s++)i.push(new Gibberish.Comb(e.combTuning[s]).callback),n.push(new Gibberish.Comb(e.combTuning[s]).callback);for(var s=0;4>s;s++)r.push(new Gibberish.AllPass(e.allPassTuning[s],e.allPassFeedback).callback),o.push(new Gibberish.AllPass(e.allPassTuning[s],e.allPassFeedback).callback)},Gibberish.StereoReverb.prototype=Gibberish._effect,Gibberish.Granulator=function(e){var t=[];buffer=null,interpolate=Gibberish.interpolate,panner=Gibberish.makePanner(),bufferLength=0,debug=0,write=0,self=this,out=[0,0],_out=[0,0],rndf=Gibberish.rndf,numberOfGrains=e.numberOfGrains||20,Gibberish.extend(this,{name:"granulator",bufferLength:88200,reverse:!0,spread:.5,properties:{speed:1,speedMin:-0,speedMax:0,grainSize:1e3,position:.5,positionMin:0,positionMax:0,amp:.2,fade:.1,pan:0,shouldWrite:!1},setBuffer:function(e){buffer=e,bufferLength=e.length},callback:function(e,i,n,r,o,a,s,l,c,h){for(var u=0;numberOfGrains>u;u++){var f=t[u];if(f._speed>0){f.pos>f.end&&(f.pos=(s+rndf(o,a))*buffer.length,f.start=f.pos,f.end=f.start+r,f._speed=e+rndf(i,n),f._speed=f._speed<.1?.1:f._speed,f._speed=f._speed<.1&&f._speed>0?.1:f._speed,f._speed=f._speed>-.1&&f._speed<0?-.1:f._speed,f.fadeAmount=f._speed*c*r,f.pan=rndf(-1*self.spread,self.spread));for(var p=f.pos;p>buffer.length;)p-=buffer.length;for(;0>p;)p+=buffer.length;var d=interpolate(buffer,p);d*=f.pos<f.fadeAmount+f.start?(f.pos-f.start)/f.fadeAmount:1,d*=f.pos>f.end-f.fadeAmount?(f.end-f.pos)/f.fadeAmount:1}else{f.pos<f.end&&(f.pos=(s+rndf(o,a))*buffer.length,f.start=f.pos,f.end=f.start-r,f._speed=e+rndf(i,n),f._speed=f._speed<.1&&f._speed>0?.1:f._speed,f._speed=f._speed>-.1&&f._speed<0?-.1:f._speed,f.fadeAmount=f._speed*c*r);for(var p=f.pos;p>buffer.length;)p-=buffer.length;for(;0>p;)p+=buffer.length;var d=interpolate(buffer,p);d*=f.pos>f.start-f.fadeAmount?(f.start-f.pos)/f.fadeAmount:1,d*=f.pos<f.end+f.fadeAmount?(f.end-f.pos)/f.fadeAmount:1}_out=panner(d*l,f.pan,_out),out[0]+=_out[0],out[1]+=_out[1],f.pos+=f._speed}return panner(out,h,out)}}).init().processProperties(arguments);for(var i=0;numberOfGrains>i;i++)t[i]={pos:self.position+Gibberish.rndf(self.positionMin,self.positionMax),_speed:self.speed+Gibberish.rndf(self.speedMin,self.speedMax)},t[i].start=t[i].pos,t[i].end=t[i].pos+self.grainSize,t[i].fadeAmount=t[i]._speed*self.fade*self.grainSize,t[i].pan=Gibberish.rndf(-1*self.spread,self.spread);"undefined"!=typeof e.buffer&&(buffer=e.buffer,bufferLength=buffer.length)},Gibberish.Granulator.prototype=Gibberish._effect,Gibberish.synth=function(){this.type="oscillator",this.oscillatorInit=function(){this.fx=new Array2,this.fx.parent=this}},Gibberish.synth.prototype=new Gibberish.ugen,Gibberish._synth=new Gibberish.synth,Gibberish.Synth=function(e){this.name="synth",this.properties={frequency:0,pulsewidth:.5,attack:22050,decay:22050,sustain:22050,release:22050,attackLevel:1,sustainLevel:.5,releaseTrigger:0,glide:.15,amp:.25,channels:2,pan:0,sr:Gibberish.context.sampleRate},this.note=function(n,r){if(0!==r){if("object"!=typeof this.frequency){if(t&&n===h&&e.requireReleaseTrigger)return this.releaseTrigger=1,void(h=null);this.frequency=h=n,this.releaseTrigger=0,"object"==typeof n&&Gibberish.dirty(this)}else this.frequency[0]=h=n,this.releaseTrigger=0,Gibberish.dirty(this);"undefined"!=typeof r&&(this.amp=r),i.run()}else this.releaseTrigger=1},e=e||{};var t="undefined"==typeof e.useADSR?!1:e.useADSR,i=t?new Gibberish.ADSR:new Gibberish.AD,n=i.getState,r=i.callback,o=new Gibberish.PWM,a=o.callback,s=(new Gibberish.OnePole).callback,l=Gibberish.makePanner(),c=this,h=0,u=[0,0];i.requireReleaseTrigger=e.requireReleaseTrigger||!1,this.callback=function(e,i,o,h,f,p,d,m,g,v,y,b,x,w){v=v>=1?.99999:v,e=s(e,1-v,v);var _,S;return t?(_=r(o,h,f,p,d,m,g),g&&(c.releaseTrigger=0),n()<4?(S=a(e,1,i,w)*_*y,1===b?S:l(S,x,u)):(S=u[0]=u[1]=0,1===b?S:u)):n()<2?(_=r(o,h),S=a(e,1,i,w)*_*y,1===b?S:l(S,x,u)):(S=u[0]=u[1]=0,1===b?S:u)},this.getEnv=function(){return i},this.getOsc=function(){return o},this.setOsc=function(e){o=e,a=o.callback};var f="PWM";Object.defineProperty(this,"waveform",{get:function(){return f},set:function(e){this.setOsc(new Gibberish[e])}}),this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.Synth.prototype=Gibberish._synth,Gibberish.PolySynth=function(){this.__proto__=new Gibberish.Bus2,Gibberish.extend(this,{name:"polysynth",maxVoices:5,voiceCount:0,frequencies:[],_frequency:0,polyProperties:{frequency:0,glide:0,attack:22050,decay:22050,sustain:22050,release:22050,attackLevel:1,sustainLevel:.5,pulsewidth:.5,waveform:"PWM"},note:function(e,t){var i=this.frequencies.indexOf(e),n=i>-1?i:this.voiceCount++,r=this.children[n];r.note(e,t),-1===i?(this.frequencies[n]=e,this._frequency=e,this.voiceCount>=this.maxVoices&&(this.voiceCount=0)):delete this.frequencies[n]},initVoices:function(){for(var e=0;e<this.maxVoices;e++){var t={waveform:this.waveform,attack:this.attack,decay:this.decay,sustain:this.sustain,release:this.release,attackLevel:this.attackLevel,sustainLevel:this.sustainLevel,pulsewidth:this.pulsewidth,channels:2,amp:1,useADSR:this.useADSR||!1,requireReleaseTrigger:this.requireReleaseTrigger||!1},i=new Gibberish.Synth(t).connect(this);this.children.push(i)}}}),this.amp=1/this.maxVoices,this.children=[],"object"==typeof arguments[0]&&(this.maxVoices=arguments[0].maxVoices?arguments[0].maxVoices:this.maxVoices,this.useADSR="undefined"!=typeof arguments[0].useADSR?arguments[0].useADSR:!1,this.requireReleaseTrigger="undefined"!=typeof arguments[0].requireReleaseTrigger?arguments[0].requireReleaseTrigger:!1),Gibberish.polyInit(this),this.initVoices(),this.processProperties(arguments),Gibberish._synth.oscillatorInit.call(this)},Gibberish.Synth2=function(e){this.name="synth2",this.properties={frequency:0,pulsewidth:.5,attack:22050,decay:22050,sustain:22050,release:22050,attackLevel:1,sustainLevel:.5,releaseTrigger:0,cutoff:.25,resonance:3.5,useLowPassFilter:!0,glide:.15,amp:.25,channels:1,pan:0,sr:Gibberish.context.sampleRate},this.note=function(n,r){if(0!==r){if("object"!=typeof this.frequency){if(t&&n===u&&e.requireReleaseTrigger)return this.releaseTrigger=1,void(u=null);this.frequency=u=n,this.releaseTrigger=0,"object"==typeof n&&Gibberish.dirty(this)}else this.frequency[0]=u=n,this.releaseTrigger=0,Gibberish.dirty(this);"undefined"!=typeof r&&(this.amp=r),i.run()}else this.releaseTrigger=1},e=e||{};var t="undefined"==typeof e.useADSR?!1:e.useADSR,i=t?new Gibberish.ADSR:new Gibberish.AD,n=i.getState,r=i.callback,o=new Gibberish.PWM,a=o.callback,s=new Gibberish.Filter24,l=s.callback,c=(new Gibberish.OnePole).callback,h=Gibberish.makePanner(),u=0,f=this,p=[0,0];i.requireReleaseTrigger=e.requireReleaseTrigger||!1,this.callback=function(e,i,o,s,u,d,m,g,v,y,b,x,w,_,S,M,C){w=w>=1?.99999:w,e=c(e,1-w,w);var T,A;return t?(T=r(o,s,u,d,m,g,v),v&&(f.releaseTrigger=0),n()<4?(A=l(a(e,.15,i,C),y*T,b,x)*T*_,1===S?A:h(A,M,p)):(A=p[0]=p[1]=0,1===S?A:p)):n()<2?(T=r(o,s),A=l(a(e,.15,i,C),y*T,b,x)*T*_,1===S?A:h(A,M,p)):(A=p[0]=p[1]=0,1===S?A:p)},this.getUseADSR=function(){return t},this.getEnv=function(){return i},this.getOsc=function(){return o},this.setOsc=function(e){o=e,a=o.callback};var d="PWM";Object.defineProperty(this,"waveform",{get:function(){return d},set:function(e){this.setOsc(new Gibberish[e])}}),this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.Synth2.prototype=Gibberish._synth,Gibberish.PolySynth2=function(){this.__proto__=new Gibberish.Bus2,Gibberish.extend(this,{name:"polysynth2",maxVoices:5,voiceCount:0,frequencies:[],_frequency:0,polyProperties:{frequency:0,glide:0,attack:22050,decay:22050,sustain:22050,release:22050,attackLevel:1,sustainLevel:.5,pulsewidth:.5,resonance:3.5,cutoff:.25,useLowPassFilter:!0,waveform:"PWM"},note:function(e,t){var i=this.frequencies.indexOf(e),n=i>-1?i:this.voiceCount++,r=this.children[n];r.note(e,t),-1===i?(this.frequencies[n]=e,this._frequency=e,this.voiceCount>=this.maxVoices&&(this.voiceCount=0)):delete this.frequencies[n]},initVoices:function(){this.dirty=!0;for(var e=0;e<this.maxVoices;e++){var t={attack:this.attack,decay:this.decay,sustain:this.sustain,release:this.release,attackLevel:this.attackLevel,sustainLevel:this.sustainLevel,pulsewidth:this.pulsewidth,channels:2,amp:1,useADSR:this.useADSR||!1,requireReleaseTrigger:this.requireReleaseTrigger||!1},i=new Gibberish.Synth2(t).connect(this);this.children.push(i)}}}),this.amp=1/this.maxVoices,this.children=[],"object"==typeof arguments[0]&&(this.maxVoices=arguments[0].maxVoices?arguments[0].maxVoices:this.maxVoices,this.useADSR="undefined"!=typeof arguments[0].useADSR?arguments[0].useADSR:!1,this.requireReleaseTrigger="undefined"!=typeof arguments[0].requireReleaseTrigger?arguments[0].requireReleaseTrigger:!1),Gibberish.polyInit(this),this.initVoices(),this.processProperties(arguments),Gibberish._synth.oscillatorInit.call(this)},Gibberish.FMSynth=function(e){this.name="fmSynth",this.properties={frequency:0,cmRatio:2,index:5,attack:22050,decay:22050,sustain:22050,release:22050,attackLevel:1,sustainLevel:.5,releaseTrigger:0,glide:.15,amp:.25,channels:2,pan:0},this.note=function(n,r){if(0!==r){if("object"!=typeof this.frequency){if(t&&n===u&&e.requireReleaseTrigger)return this.releaseTrigger=1,void(u=null);this.frequency=u=n,this.releaseTrigger=0,"object"==typeof n&&Gibberish.dirty(this)}else this.frequency[0]=u=n,this.releaseTrigger=0,Gibberish.dirty(this);"undefined"!=typeof r&&(this.amp=r),i.run()}else this.releaseTrigger=1},e=e||{};var t="undefined"==typeof e.useADSR?!1:e.useADSR,i=t?new Gibberish.ADSR:new Gibberish.AD,n=i.getState,r=i.callback,o=(new Gibberish.Sine).callback,a=(new Gibberish.Sine).callback,s=(new Gibberish.OnePole).callback,l=Gibberish.makePanner(),c=[0,0],h=this,u=0;i.requireReleaseTrigger=e.requireReleaseTrigger||!1,this.callback=function(e,i,u,f,p,d,m,g,v,y,b,x,w,_){var S,M,C;return b>=1&&(b=.9999),e=s(e,1-b,b),t?(S=r(f,p,d,m,g,v,y),y&&(h.releaseTrigger=0),n()<4?(C=a(e*i,e*u)*S,M=o(e+C,1)*S*x,1===w?M:l(M,_,c)):(M=c[0]=c[1]=0,1===w?M:c)):n()<2?(S=r(f,p),C=a(e*i,e*u)*S,M=o(e+C,1)*S*x,1===w?M:l(M,_,c)):(M=c[0]=c[1]=0,1===w?M:c)},this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.FMSynth.prototype=Gibberish._synth,Gibberish.PolyFM=function(){this.__proto__=new Gibberish.Bus2,Gibberish.extend(this,{name:"polyfm",maxVoices:5,voiceCount:0,children:[],frequencies:[],_frequency:0,polyProperties:{glide:0,attack:22050,decay:22050,sustain:22050,release:22050,attackLevel:1,sustainLevel:.5,index:5,cmRatio:2},note:function(e,t){var i=this.frequencies.indexOf(e),n=i>-1?i:this.voiceCount++,r=this.children[n];r.note(e,t),-1===i?(this.frequencies[n]=e,this._frequency=e,this.voiceCount>=this.maxVoices&&(this.voiceCount=0)):delete this.frequencies[n]},initVoices:function(){for(var e=0;e<this.maxVoices;e++){var t={attack:this.attack,decay:this.decay,sustain:this.sustain,release:this.release,attackLevel:this.attackLevel,sustainLevel:this.sustainLevel,cmRatio:this.cmRatio,index:this.index,channels:2,useADSR:this.useADSR||!1,requireReleaseTrigger:this.requireReleaseTrigger||!1,amp:1},i=new Gibberish.FMSynth(t);i.connect(this),this.children.push(i)}}}),this.amp=1/this.maxVoices,this.children=[],"object"==typeof arguments[0]&&(this.maxVoices=arguments[0].maxVoices?arguments[0].maxVoices:this.maxVoices,this.useADSR="undefined"!=typeof arguments[0].useADSR?arguments[0].useADSR:!1,this.requireReleaseTrigger="undefined"!=typeof arguments[0].requireReleaseTrigger?arguments[0].requireReleaseTrigger:!1),Gibberish.polyInit(this),this.initVoices(),this.processProperties(arguments),Gibberish._synth.oscillatorInit.call(this)},Gibberish.Sampler=function(){function e(e){Gibberish.context.decodeAudioData(e,function(e){o=e.getChannelData(0),s.length=t=s.end=a=o.length,s.isPlaying=!0,s.buffers[s.file]=o,console.log("sample loaded | ",s.file," | length | ",a),Gibberish.audioFiles[s.file]=o,s.onload&&s.onload(),0!==s.playOnLoad&&s.note(s.playOnLoad),s.isLoaded=!0},function(e){console.log("Error decoding file",e)})}var t=1,i=Gibberish.interpolate,n=Gibberish.makePanner(),r=[0,0],o=null,a=1,s=this;if(Gibberish.extend(this,{name:"sampler",file:null,isLoaded:!1,playOnLoad:0,buffers:{},properties:{pitch:1,amp:1,isRecording:!1,isPlaying:!0,input:0,length:0,start:0,end:1,loops:0,pan:0},_onload:function(e){o=e.channels[0],a=e.length,s.length=a,s.end=a,s.length=t=a,s.isPlaying=!0,Gibberish.audioFiles[s.file]=o,s.buffers[s.file]=o,s.onload&&s.onload(),0!==s.playOnLoad&&s.note(s.playOnLoad),s.isLoaded=!0},switchBuffer:function(e){if("string"==typeof e)"undefined"!=typeof s.buffers[e]&&(o=s.buffers[e],a=s.end=s.length=o.length);else if("number"==typeof e){var t=Object.keys(s.buffers);if(0===t.length)return;o=s.buffers[t[e]],a=s.end=s.length=o.length}},floatTo16BitPCM:function(e,t,i){for(var n=0;n<i.length-1;n++,t+=2){var r=Math.max(-1,Math.min(1,i[n]));e.setInt16(t,0>r?32768*r:32767*r,!0)}},encodeWAV:function(){function e(e,t,i){for(var n=0;n<i.length;n++)e.setUint8(t+n,i.charCodeAt(n))}var t=this.getBuffer(),i=new ArrayBuffer(44+2*t.length),n=new DataView(i),r=Gibberish.context.sampleRate;return e(n,0,"RIFF"),n.setUint32(4,32+2*t.length,!0),e(n,8,"WAVE"),e(n,12,"fmt "),n.setUint32(16,16,!0),n.setUint16(20,1,!0),n.setUint16(22,1,!0),n.setUint32(24,r,!0),n.setUint32(28,4*r,!0),n.setUint16(32,2,!0),n.setUint16(34,16,!0),e(n,36,"data"),n.setUint32(40,2*t.length,!0),this.floatTo16BitPCM(n,44,t),n},download:function(){var e=this.encodeWAV(),t=new Blob([e]),i=window.webkitURL.createObjectURL(t),n=window.document.createElement("a");n.href=i,n.download="output.wav";var r=document.createEvent("Event");r.initEvent("click",!0,!0),n.dispatchEvent(r)},note:function(e,i){switch(typeof e){case"number":this.pitch=e;break;case"function":this.pitch=e();break;case"object":this.pitch=Array.isArray(e)?e[0]:e}if("number"==typeof i&&(this.amp=i),null!==this.function){this.isPlaying=!0;var n;switch(typeof this.pitch){case"number":n=this.pitch;break;case"function":n=this.pitch.getValue?this.pitch.getValue():this.pitch();break;case"object":n=Array.isArray(this.pitch)?this.pitch[0]:this.pitch.getValue?this.pitch.getValue():this.pitch.input.getValue(),"function"==typeof n&&(n=n())}t=n>0?this.start:this.end,Gibberish.dirty(this)}},getBuffer:function(){return o},setBuffer:function(e){o=e},getPhase:function(){return t},setPhase:function(e){t=e},getNumberOfBuffers:function(){return Object.keys(s.buffers).length-1},callback:function(e,a,s,l,c,h,u,f,p,d){var m=0;return t+=e,f>t&&t>0?(e>0?m=null!==o&&l?i(o,t):0:t>u?m=null!==o&&l?i(o,t):0:t=p?f:t,n(m*a,d,r)):(t=p&&e>0?u:t,t=p&&0>e?f:t,r[0]=r[1]=m,r)}}).init().oscillatorInit().processProperties(arguments),"undefined"!=typeof arguments[0]&&("string"==typeof arguments[0]?(this.file=arguments[0],this.pitch=0):"object"==typeof arguments[0]&&arguments[0].file&&(this.file=arguments[0].file)),"undefined"!=typeof Gibberish.audioFiles[this.file])o=Gibberish.audioFiles[this.file],this.end=this.bufferLength=o.length,this.buffers[this.file]=o,t=this.bufferLength,Gibberish.dirty(this),this.onload&&this.onload();else if(null!==this.file){var e,l=new XMLHttpRequest;l.open("GET",this.file,!0),l.responseType="arraybuffer",l.onload=function(){e(this.response)},l.send(),console.log("now loading sample",s.file),l.onerror=function(e){console.error("Sampler file loading error",e)}}else"undefined"!=typeof this.buffer&&(this.isLoaded=!0,o=this.buffer,this.end=this.bufferLength=o.length||88200,t=this.bufferLength,arguments[0]&&arguments[0].loops&&(this.loops=1),Gibberish.dirty(this),this.onload&&this.onload())},Gibberish.Sampler.prototype=Gibberish._oscillator,Gibberish.Sampler.prototype.record=function(e,t){this.isRecording=!0;var i=this;return this.recorder=new Gibberish.Record(e,t,function(){i.setBuffer(this.getBuffer()),i.end=bufferLength=i.getBuffer().length,i.setPhase(i.end),i.isRecording=!1}).record(),this},Gibberish.MonoSynth=function(){Gibberish.extend(this,{name:"monosynth",properties:{attack:1e4,decay:1e4,cutoff:.2,resonance:2.5,amp1:1,amp2:1,amp3:1,filterMult:.3,isLowPass:!0,pulsewidth:.5,amp:.6,detune2:.01,detune3:-.01,octave2:1,octave3:-1,glide:0,pan:0,frequency:0,channels:2},waveform:"Saw3",note:function(e,n){"undefined"!=typeof n&&0!==n&&(this.amp=n),0!==n&&("object"!=typeof this.frequency?this.frequency=e:(this.frequency[0]=e,Gibberish.dirty(this)),i()>0&&t.run())},_note:function(e,i){if("object"!=typeof this.frequency){if(useADSR&&e===lastFrequency&&0===i)return this.releaseTrigger=1,void(lastFrequency=null);0!==i&&(this.frequency=lastFrequency=e),this.releaseTrigger=0}else 0!==i&&(this.frequency[0]=lastFrequency=e),this.releaseTrigger=0,Gibberish.dirty(this);"undefined"!=typeof i&&0!==i&&(this.amp=i),0!==i&&t.run()}});var e=this.waveform;Object.defineProperty(this,"waveform",{get:function(){return e},set:function(t){e!==t&&(e=t,o=(new Gibberish[t]).callback,a=(new Gibberish[t]).callback,s=(new Gibberish[t]).callback)}});var t=new Gibberish.AD(this.attack,this.decay),i=t.getState,n=t.callback,r=(new Gibberish.Filter24).callback,o=new Gibberish[this.waveform](this.frequency,this.amp1).callback,a=new Gibberish[this.waveform](this.frequency2,this.amp2).callback,s=new Gibberish[this.waveform](this.frequency3,this.amp3).callback,l=(new Gibberish.OnePole).callback,c=Gibberish.makePanner(),h=[0,0];this.envelope=t,this.callback=function(e,t,u,f,p,d,m,g,v,y,b,x,w,_,S,M,C,T,A){if(i()<2){M>=1&&(M=.9999),T=l(T,1-M,M);var E=T;if(_>0)for(var P=0;_>P;P++)E*=2;else if(0>_)for(var P=0;P>_;P--)E/=2;var k=T;if(S>0)for(var P=0;S>P;P++)k*=2;else if(0>S)for(var P=0;P>S;P--)k/=2;E+=x>0?(2*T-T)*x:(T-T/2)*x,k+=w>0?(2*T-T)*w:(T-T/2)*w;var R=o(T,p,y)+a(E,d,y)+s(k,m,y),L=n(e,t),D=r(R,u+g*L,f,v,1)*L;return D*=b,h[0]=h[1]=D,1===A?h:c(D,C,h)}return h[0]=h[1]=0,h},this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.MonoSynth.prototype=Gibberish._synth,Gibberish.Binops={"export":function(e){Gibberish.export("Binops",e||window)},operator:function(){var e=new Gibberish.ugen,t=arguments[0],i=Array.prototype.slice.call(arguments,1);e.name="op",e.properties={};for(var n=0;n<i.length;n++)e.properties[n]=i[n];return e.init.apply(e,i),e.codegen=function(){var e,i="( ";if("undefined"!=typeof Gibberish.memo[this.symbol])return Gibberish.memo[this.symbol];e=Object.keys(this.properties);for(var n=!1,r=0;r<e.length;r++)if(n)n=!1;else{var o="object"==typeof this[r];i+=o?this[r].codegen():this[r],"*"!==t&&"/"!==t||1!==this[r+1]?r<e.length-1&&(i+=" "+t+" "):n=!0}return i+=" )",this.codeblock=i,i},e.valueOf=function(){return e.codegen()},e},Add:function(){var e=Array.prototype.slice.call(arguments,0);return e.unshift("+"),Gibberish.Binops.operator.apply(null,e)},Sub:function(){var e=Array.prototype.slice.call(arguments,0);return e.unshift("-"),Gibberish.Binops.operator.apply(null,e)},Mul:function(){var e=Array.prototype.slice.call(arguments,0);return e.unshift("*"),Gibberish.Binops.operator.apply(null,e)},Div:function(){var e=Array.prototype.slice.call(arguments,0);return e.unshift("/"),Gibberish.Binops.operator.apply(null,e)},Mod:function(){var e=Array.prototype.slice.call(arguments,0);return e.unshift("%"),Gibberish.Binops.operator.apply(null,e)},Abs:function(){var e=Array.prototype.slice.call(arguments,0),t={name:"abs",properties:{},callback:Math.abs.bind(t)};return t.__proto__=new Gibberish.ugen,t.properties[0]=e[0],t.init(),t},Sqrt:function(){var e=(Array.prototype.slice.call(arguments,0),{name:"sqrt",properties:{},callback:Math.sqrt.bind(e)});return e.__proto__=new Gibberish.ugen,e.properties[i]=arguments[0],e.init(),e},Pow:function(){var e=Array.prototype.slice.call(arguments,0),t={name:"pow",properties:{},callback:Math.pow.bind(t)};t.__proto__=new Gibberish.ugen;for(var i=0;i<e.length;i++)t.properties[i]=e[i];return t.init(),console.log(t.callback),t},Clamp:function(){var e=Array.prototype.slice.call(arguments,0),t={name:"clamp",properties:{input:0,min:0,max:1},callback:function(e,t,i){return t>e?e=t:e>i&&(e=i),e}};return t.__proto__=new Gibberish.ugen,t.init(),t.processProperties(e),t},Merge:function(){var e=Array.prototype.slice.call(arguments,0),t={name:"merge",properties:{},callback:function(e){return e[0]+e[1]}};t.__proto__=new Gibberish.ugen;for(var i=0;i<e.length;i++)t.properties[i]=e[i];return t.init(),t},Map:function(e,t,i,n,r,o,a){var s=Math.pow,l=0,c=0,h={name:"map",properties:{input:e,outputMin:t,outputMax:i,inputMin:n,inputMax:r,curve:o||l,wrap:a||!1},callback:function(e,t,i,n,r,o,a){var l,h=i-t,u=r-n,f=(e-n)/u;return f>1?f=a?f%1:1:0>f&&(f=a?1+f%1:0),l=0===o?t+f*h:t+s(f,1.5)*h,c=l,l},getValue:function(){return c},invert:function(){var e=h.outputMin;h.outputMin=h.outputMax,h.outputMax=e}};return h.__proto__=new Gibberish.ugen,h.init(),h}},Gibberish.Time={bpm:120,"export":function(e){Gibberish.export("Time",e||window)},ms:function(e){return e*Gibberish.context.sampleRate/1e3},seconds:function(e){return e*Gibberish.context.sampleRate},beats:function(e){return function(){var t=Gibberish.context.sampleRate/(Gibberish.Time.bpm/60);return t*e}}},Gibberish.Sequencer2=function(){var e=this,t=0;Gibberish.extend(this,{target:null,key:null,values:null,valuesIndex:0,durations:null,durationsIndex:0,nextTime:0,playOnce:!1,repeatCount:0,repeatTarget:null,isConnected:!0,keysAndValues:null,counts:{},properties:{rate:1,isRunning:!1,nextTime:0},offset:0,name:"seq",callback:function(i,n,r){if(n){if(t>=r){if(null!==e.values){if(e.target){var o=e.values[e.valuesIndex++];
"function"==typeof o&&(o=o()),"function"==typeof e.target[e.key]?e.target[e.key](o):e.target[e.key]=o}else"function"==typeof e.values[e.valuesIndex]&&e.values[e.valuesIndex++]();e.valuesIndex>=e.values.length&&(e.valuesIndex=0)}else if(null!==e.keysAndValues)for(var a in e.keysAndValues){var s=e.counts[a]++,o=e.keysAndValues[a][s];"function"==typeof o&&(o=o()),"function"==typeof e.target[a]?e.target[a](o):e.target[a]=o,e.counts[a]>=e.keysAndValues[a].length&&(e.counts[a]=0),e.chose&&e.chose(a,s)}else"function"==typeof e.target[e.key]&&e.target[e.key]();if(t-=r,Array.isArray(e.durations)){var l=e.durations[e.durationsIndex++];e.nextTime="function"==typeof l?l():l,e.chose&&e.chose("durations",e.durationsIndex-1),e.durationsIndex>=e.durations.length&&(e.durationsIndex=0)}else{var l=e.durations;e.nextTime="function"==typeof l?l():l}return e.repeatTarget&&(e.repeatCount++,e.repeatCount===e.repeatTarget&&(e.isRunning=!1,e.repeatCount=0)),0}t+=i}return 0},start:function(e){return e||(t=0),this.isRunning=!0,this},stop:function(){return this.isRunning=!1,this},repeat:function(e){return this.repeatTarget=e,this},shuffle:function(){for(i in this.keysAndValues)this.shuffleArray(this.keysAndValues[i])},shuffleArray:function(e){for(var t,i,n=e.length;n;t=parseInt(Math.random()*n),i=e[--n],e[n]=e[t],e[t]=i);}}),this.init(arguments),this.processProperties(arguments);for(var i in this.keysAndValues)this.counts[i]=0;this.oscillatorInit(),t+=this.offset,this.connect()},Gibberish.Sequencer2.prototype=Gibberish._oscillator,Gibberish.Sequencer=function(){Gibberish.extend(this,{target:null,key:null,values:null,valuesIndex:0,durations:null,durationsIndex:0,nextTime:0,phase:0,isRunning:!1,playOnce:!1,repeatCount:0,repeatTarget:null,isConnected:!0,keysAndValues:null,counts:{},offset:0,name:"seq",tick:function(){if(this.isRunning){if(this.phase>=this.nextTime){if(null!==this.values){if(this.target){var e=this.values[this.valuesIndex++];if("function"==typeof e)try{e=e()}catch(t){console.error("ERROR: Can't execute function triggered by Sequencer:\n"+e.toString()),this.values.splice(this.valuesIndex-1,1),this.valuesIndex--}"function"==typeof this.target[this.key]?this.target[this.key](e):this.target[this.key]=e}else if("function"==typeof this.values[this.valuesIndex])try{this.values[this.valuesIndex++]()}catch(t){console.error("ERROR: Can't execute function triggered by Sequencer:\n"+this.values[this.valuesIndex-1].toString()),this.values.splice(this.valuesIndex-1,1),this.valuesIndex--}this.valuesIndex>=this.values.length&&(this.valuesIndex=0)}else if(null!==this.keysAndValues)for(var i in this.keysAndValues){var n="function"==typeof this.keysAndValues[i].pick?this.keysAndValues[i].pick():this.counts[i]++,e=this.keysAndValues[i][n];if("function"==typeof e)try{e=e()}catch(t){console.error("ERROR: Can't execute function triggered by Sequencer:\n"+e.toString()),this.keysAndValues[i].splice(n,1),"function"!=typeof this.keysAndValues[i].pick&&this.counts[i]--}"function"==typeof this.target[i]?this.target[i](e):this.target[i]=e,this.counts[i]>=this.keysAndValues[i].length&&(this.counts[i]=0)}else"function"==typeof this.target[this.key]&&this.target[this.key]();if(this.phase-=this.nextTime,Array.isArray(this.durations)){var r="function"==typeof this.durations.pick?this.durations[this.durations.pick()]:this.durations[this.durationsIndex++];this.nextTime="function"==typeof r?r():r,this.durationsIndex>=this.durations.length&&(this.durationsIndex=0)}else{var r=this.durations;this.nextTime="function"==typeof r?r():r}return void(this.repeatTarget&&(this.repeatCount++,this.repeatCount===this.repeatTarget&&(this.isRunning=!1,this.repeatCount=0)))}this.phase++}},start:function(e){return e||(this.phase=this.offset),this.isRunning=!0,this},stop:function(){return this.isRunning=!1,this},repeat:function(e){return this.repeatTarget=e,this},shuffle:function(){for(e in this.keysAndValues)this.shuffleArray(this.keysAndValues[e])},shuffleArray:function(e){for(var t,i,n=e.length;n;t=parseInt(Math.random()*n),i=e[--n],e[n]=e[t],e[t]=i);},disconnect:function(){var e=Gibberish.sequencers.indexOf(this);Gibberish.sequencers.splice(e,1),this.isConnected=!1},connect:function(){return-1===Gibberish.sequencers.indexOf(this)&&Gibberish.sequencers.push(this),this.isConnected=!0,this}});for(var e in arguments[0])this[e]=arguments[0][e];for(var e in this.keysAndValues)this.counts[e]=0;this.connect(),this.phase+=this.offset},Gibberish.Sequencer.prototype=Gibberish._oscillator,Gibberish.PolySeq=function(){var e=this,t=0,i=function(e,t){return t>e?-1:e>t?1:0};Gibberish.extend(this,{seqs:[],timeline:{},playOnce:!1,repeatCount:0,repeatTarget:null,isConnected:!1,properties:{rate:1,isRunning:!1,nextTime:0},offset:0,autofire:[],name:"polyseq",getPhase:function(){return t},timeModifier:null,add:function(i){i.valuesIndex=i.durationsIndex=0,null===i.durations?(i.autofire=!0,e.autofire.push(i)):(e.seqs.push(i),"undefined"!=typeof e.timeline[t]?i.priority?e.timeline[t].unshift(i):e.timeline[t].push(i):e.timeline[t]=[i],e.nextTime=t),!e.scale||"frequency"!==i.key&&"note"!==i.key||e.applyScale&&e.applyScale(),i.shouldStop=!1},callback:function(n,r,o){var a;if(r){if(t>=o){var s=e.timeline[o],l=t-o;if("undefined"==typeof s)return;for(var c=0;c<s.length;c++){var h=s[c];if(!h.shouldStop){var u=h.values.pick?h.values.pick():h.valuesIndex++%h.values.length,f="function"==typeof h.values?h.values():h.values[u];if("function"==typeof f&&(f=f()),h.target&&("function"==typeof h.target[h.key]?h.target[h.key](f):h.target[h.key]=f),e.chose&&e.chose(h.key,u),Array.isArray(h.durations)){var u=h.durations.pick?h.durations.pick():h.durationsIndex++,p="function"==typeof h.durations?h.durations():h.durations[u];a="function"==typeof p?p():p,"function"!=typeof h.durations&&h.durationsIndex>=h.durations.length&&(h.durationsIndex=0),e.chose&&e.chose("durations",u)}else{var p="function"==typeof h.durations?h.durations():h.durations;a="function"==typeof p?p():p}var d;d=null!==e.timeModifier?e.timeModifier(a)+t:a+t,d-=l,a-=l,"undefined"==typeof e.timeline[d]?e.timeline[d]=[h]:h.priority?e.timeline[d].unshift(h):e.timeline[d].push(h)}}for(var c=0,m=e.autofire.length;m>c;c++){var h=e.autofire[c];if(!h.shouldStop){var u=h.values.pick?h.values.pick():h.valuesIndex++%h.values.length,f=h.values[u];"function"==typeof f&&(f=f()),h.target&&("function"==typeof h.target[h.key]?h.target[h.key](f):h.target[h.key]=f),e.chose&&e.chose(h.key,u)}}delete e.timeline[o];var g=Object.keys(e.timeline),v=g.length;if(v>1){for(var y=0;v>y;y++)g[y]=parseFloat(g[y]);g=g.sort(i),e.nextTime=g[0]}else e.nextTime=parseFloat(g[0])}t+=n}return 0},start:function(e,i){if(e&&this.offset){t=0,this.nextTime=this.offset;var n=""+this.offset;this.timeline={},this.timeline[n]=[];for(var r=0;r<this.seqs.length;r++){var o=this.seqs[r];o.valuesIndex=o.durationsIndex=o.shouldStop=0,this.timeline[n].push(o)}}else{t=0,this.nextTime=0,this.timeline={0:[]};for(var r=0;r<this.seqs.length;r++){var o=this.seqs[r];o.valuesIndex=o.durationsIndex=o.shouldStop=0,this.timeline[0].push(o)}}return this.isConnected||(this.connect(Gibberish.Master,i),this.isConnected=!0),this.isRunning=!0,this},stop:function(){return this.isRunning=!1,this.isConnected&&(this.disconnect(),this.isConnected=!1),this},repeat:function(e){return this.repeatTarget=e,this},shuffle:function(e){if("undefined"!=typeof e)for(var t=0;t<this.seqs.length;t++)this.seqs[t].key===e&&this.shuffleArray(this.seqs[t].values);else for(var t=0;t<this.seqs.length;t++)this.shuffleArray(this.seqs[t].values)},shuffleArray:function(e){for(var t,i,n=e.length;n;t=parseInt(Math.random()*n),i=e[--n],e[n]=e[t],e[t]=i);}}),this.init(arguments),this.processProperties(arguments),this.oscillatorInit()},Gibberish.PolySeq.prototype=Gibberish._oscillator;var _hasInput=!1;return"object"==typeof navigator&&(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia),Gibberish.Input=function(){var e=[];_hasInput||createInput(),this.type=this.name="input",this.fx=new Array2,this.fx.parent=this,this.properties={input:"input",amp:.5,channels:1},this.callback=function(t,i,n){return 1===n?e=t*i:(e[0]=t[0]*i,e[1]=t[1]*i),e},this.init(arguments),this.processProperties(arguments)},Gibberish.Input.prototype=new Gibberish.ugen,Gibberish.Kick=function(){var e=!1,t=(new Gibberish.SVF).callback,i=(new Gibberish.SVF).callback,n=.2,r=.8;Gibberish.extend(this,{name:"kick",properties:{pitch:50,__decay:20,__tone:1e3,amp:2,sr:Gibberish.context.sampleRate},callback:function(n,r,o,a,s){var l=e?60:0;return l=t(l,n,r,2,s),l=i(l,o,.5,0,s),l*=a,e=!1,l},note:function(t,i,n,r){"number"==typeof t&&(this.pitch=t),"number"==typeof i&&(this.decay=i),"number"==typeof n&&(this.tone=n),"number"==typeof r&&(this.amp=r),e=!0}}).init().oscillatorInit(),Object.defineProperties(this,{decay:{get:function(){return n},set:function(e){n=e>1?1:e,this.__decay=100*n}},tone:{get:function(){return r},set:function(e){r=e>1?1:e,this.__tone=220+1400*e}}}),this.processProperties(arguments)},Gibberish.Kick.prototype=Gibberish._oscillator,Gibberish.Conga=function(){var e=!1,t=(new Gibberish.SVF).callback;Gibberish.extend(this,{name:"conga",properties:{pitch:190,amp:2,sr:Gibberish.context.sampleRate},callback:function(i,n,r){var o=e?60:0;return o=t(o,i,50,2,r),o*=n,e=!1,o},note:function(t,i){"number"==typeof t&&(this.pitch=t),"number"==typeof i&&(this.amp=i),e=!0}}).init().oscillatorInit(),this.processProperties(arguments)},Gibberish.Conga.prototype=Gibberish._oscillator,Gibberish.Clave=function(){var e=!1,t=new Gibberish.SVF,i=t.callback;Gibberish.extend(this,{name:"clave",properties:{pitch:2500,amp:1,sr:Gibberish.context.sampleRate},callback:function(t,n,r){var o=e?2:0;return o=i(o,t,5,2,r),o*=n,e=!1,o},note:function(t,i){"number"==typeof t&&(this.pitch=t),"number"==typeof i&&(this.amp=i),e=!0}}).init().oscillatorInit(),this.bpf=t,this.processProperties(arguments)},Gibberish.Clave.prototype=Gibberish._oscillator,Gibberish.Tom=function(){var e=!1,t=(new Gibberish.SVF).callback,i=(new Gibberish.SVF).callback,n=new Gibberish.ExponentialDecay,r=n.callback,o=Math.random;Gibberish.extend(this,{name:"tom",properties:{pitch:80,amp:.5,sr:Gibberish.context.sampleRate},callback:function(n,a,s){var l,c=e?60:0;return c=t(c,n,30,2,s),l=16*o()-8,l=l>0?l:0,l*=r(.05,11025),l=i(l,120,.5,0,s),c+=l,c*=a,e=!1,c},note:function(t,i){"number"==typeof t&&(this.pitch=t),"number"==typeof i&&(this.amp=i),n.trigger(),e=!0}}).init().oscillatorInit(),n.trigger(1),this.processProperties(arguments)},Gibberish.Tom.prototype=Gibberish._oscillator,Gibberish.Cowbell=function(){var e=new Gibberish.Square,t=new Gibberish.Square,i=e.callback,n=t.callback,r=new Gibberish.SVF({mode:2}),o=r.callback,a=new Gibberish.ExponentialDecay(.0025,10500),s=a.callback;Gibberish.extend(this,{name:"cowbell",properties:{amp:1,pitch:560,bpfFreq:1e3,bpfRez:3,decay:22050,decayCoeff:1e-4,sr:Gibberish.context.sampleRate},callback:function(e,t,r,a,l,c,h){var u;return u=i(t,1,1,0),u+=n(845,1,1,0),u=o(u,r,a,2,h),u*=s(c,l),u*=e},note:function(e){a.trigger(),e&&(this.decay=e)}}).init().oscillatorInit().processProperties(arguments),this.bpf=r,this.eg=a,a.trigger(1)},Gibberish.Cowbell.prototype=Gibberish._oscillator,Gibberish.Snare=function(){var e=(new Gibberish.SVF).callback,t=(new Gibberish.SVF).callback,i=(new Gibberish.SVF).callback,n=new Gibberish.ExponentialDecay(.0025,11025),r=n.callback,o=Math.random,a=0;Gibberish.extend(this,{name:"snare",properties:{cutoff:1e3,decay:11025,tune:0,snappy:.5,amp:1,sr:Gibberish.context.sampleRate},callback:function(n,s,l,c,h,u){var f,p,d=0,m=0;return d=r(.0025,s),d>.005&&(m=(2*o()-1)*d,m=i(m,n+1e3*l,.5,1,u),m*=c,m=m>0?m:0,a=d,f=e(a,180*(l+1),15,2,u),p=t(a,330*(l+1),15,2,u),m+=f,m+=.8*p,m*=h),m},note:function(e,t,i,r){"number"==typeof e&&(this.tune=e),"number"==typeof r&&(this.cutoff=r),"number"==typeof i&&(this.snappy=i),"number"==typeof t&&(this.amp=t),n.trigger()}}).init().oscillatorInit().processProperties(arguments),n.trigger(1)},Gibberish.Snare.prototype=Gibberish._oscillator,Gibberish.Hat=function(){{var e=new Gibberish.Square,t=new Gibberish.Square,i=new Gibberish.Square,n=new Gibberish.Square,r=new Gibberish.Square,o=new Gibberish.Square,a=e.callback,s=t.callback,l=i.callback,c=n.callback,h=r.callback,u=o.callback,f=new Gibberish.SVF({mode:2}),p=f.callback,d=new Gibberish.Filter24,m=d.callback,g=new Gibberish.ExponentialDecay(.0025,10500),v=g.callback,y=new Gibberish.ExponentialDecay(.1,7500);y.callback}Gibberish.extend(this,{name:"hat",properties:{amp:1,pitch:325,bpfFreq:7e3,bpfRez:2,hpfFreq:.975,hpfRez:0,decay:3500,decay2:3e3,sr:Gibberish.context.sampleRate},callback:function(e,t,i,n,r,o,f,d,g){var y;return y=a(t,1,.5,0),y+=s(1.4471*t,.75,1,0),y+=l(1.617*t,1,1,0),y+=c(1.9265*t,1,1,0),y+=h(2.5028*t,1,1,0),y+=u(2.6637*t,.75,1,0),y=p(y,i,n,2,g),y*=v(.001,f),y=m(y,r,o,0,1),y*=e},note:function(e,t){g.trigger(),y.trigger(),e&&(this.decay=e),t&&(this.decay2=t)}}).init().oscillatorInit().processProperties(arguments),this.bpf=f,this.hpf=d,g.trigger(1),y.trigger(1)},Gibberish.Hat.prototype=Gibberish._oscillator,function(){var e={Soundfont:{instruments:{}}},t=e.Soundfont;"object"==typeof window?window.MIDI=e:global.MIDI=e;var i=function(e,t){function i(e){var i=document.createElement("script");i.innerHTML=e.srcElement?e.srcElement.responseText:e.target.responseText,document.querySelector("head").appendChild(i),t(i)}var n=new XMLHttpRequest;n.addEventListener("load",i,!1),n.addEventListener("error",function(e){console.log("SF load error",e)},!1),n.open("GET",e,!0),n.send()},n={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",decodeArrayBuffer:function(e){var t=e.length/4*3,i=new ArrayBuffer(t);return this.decode(e,i),i},decode:function(e,t){var i=this._keyStr.indexOf(e.charAt(e.length-1)),n=this._keyStr.indexOf(e.charAt(e.length-2)),r=e.length/4*3;64==i&&r--,64==n&&r--;var o,a,s,l,c,h,u,f,p=0,d=0;for(o=new Uint8Array(t?t:r),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,""),p=0;r>p;p+=3)c=this._keyStr.indexOf(e.charAt(d++)),h=this._keyStr.indexOf(e.charAt(d++)),u=this._keyStr.indexOf(e.charAt(d++)),f=this._keyStr.indexOf(e.charAt(d++)),a=c<<2|h>>4,s=(15&h)<<4|u>>2,l=(3&u)<<6|f,o[p]=a,64!=u&&(o[p+1]=s),64!=f&&(o[p+2]=l);return o}},r=function(e){var i=0,r=t[e.instrumentFileName];"undefined"==typeof t.instruments[e.instrumentFileName]&&(t.instruments[e.instrumentFileName]={}),e.buffers=t.instruments[e.instrumentFileName];for(var o in r)i++,!function(){var a=o,s=r[a].split(",")[1],l=n.decodeArrayBuffer(s);Gibberish.context.decodeAudioData(l,function(n){t.instruments[e.instrumentFileName][a]=n.getChannelData(0),i--,0>=i&&(console.log("Soundfont "+e.instrumentFileName+" is loaded."),e.isLoaded=!0,e.onload&&e.onload())},function(e){console.log("ERROR",e.err,arguments,a)})}()};Gibberish.SoundFont=function(e,n){return Gibberish.extend(this,{instrumentFileName:e,name:"soundfont",properties:{amp:1,pan:0},playing:[],buffers:{},onload:null,out:[0,0],isLoaded:!1,resourcePath:n||"./resources/soundfonts/",callback:function(e,t){for(var i=0,n=this.playing.length-1;n>=0;n--){var r=this.playing[n];i+=this.interpolate(r.buffer,r.phase),r.phase+=r.increment,r.phase>r.length&&this.playing.splice(this.playing.indexOf(r),1)}return this.panner(i*e,t,this.out)}.bind(this),note:function(e,t,i){this.isLoaded&&this.playing.push({buffer:this.buffers[e],phase:0,increment:isNaN(i)?1:1+i,length:this.buffers[e].length,amp:isNaN(t)?1:t})},interpolate:Gibberish.interpolate.bind(this),panner:Gibberish.makePanner()}).init().oscillatorInit(),"object"==typeof arguments[0]&&arguments[0].instrumentFileName&&(this.instrumentFileName=arguments[0].instrumentFileName),t.instruments[this.instrumentFileName]||"object"==typeof n?"object"==typeof n?(t[this.instrumentFileName]=n,r(this)):(this.buffers=t.instruments[this.instrumentFileName],this.isLoaded=!0,setTimeout(function(){this.onload&&this.onload()}.bind(this),0)):i("resources/soundfonts/"+this.instrumentFileName+"-mp3.js",r.bind(null,this)),this},Gibberish.SoundFont.storage=t,Gibberish.SoundFont.prototype=Gibberish._oscillator}(),Gibberish.Vocoder=function(){var e=[],t=[],i=Math.abs,n=(Math.sqrt,[0,0]),r=[],o=[],a=128,s=[],l=[],c=[],h=0,u=arguments[3]||330,f=arguments[4]||3200,p=arguments[2]||16,d=arguments[5]||.15;this.name="vocoder",this.properties={carrier:arguments[0]||null,modulator:arguments[1]||null,amp:1,pan:0};for(var m=1200*Math.log(f/u)/Math.LN2,g=m/p,v=Math.pow(2,g/1200),y=u,b=0;p>b;b++)r[b]=new Gibberish.Biquad({mode:"BP",Q:d,cutoff:y}),e[b]=r[b].callback,o[b]=new Gibberish.Biquad({mode:"BP",Q:d,cutoff:y}),t[b]=o[b].callback,s[b]=[0],l[b]=0,c[b]=0,y*=v;this.callback=function(r,o,u){for(var f,d=(h+1)%a,m="number"!=typeof o?o[0]+o[1]:o,g="number"!=typeof r?r[0]+r[1]:r,v=0,y=0;p>y;y++)f=i(e[y](m)),l[y]+=f,l[y]-=s[y][h],s[y][h]=f,s[y][d]=s[y][d]?s[y][d]:0,c[y]=l[y]/a,v+=t[y](g)*c[y];return h=d,n[0]=n[1]=v*u*16,n},this.getEncoders=function(){return r},this.getDecoders=function(){return o},this.init(),this.oscillatorInit()},Gibberish.Vocoder.prototype=Gibberish._synth,Gibberish})}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(_dereq_,module,exports){!function(){var freesound=module.exports={BASE_URI:"http://www.freesound.org/api",apiKey:"",debug:!1,_URI_SOUND:"/sounds/<sound_id>/",_URI_SOUND_ANALYSIS:"/sounds/<sound_id>/analysis/",_URI_SOUND_ANALYSIS_FILTER:"/sounds/<sound_id>/analysis/<filter>",_URI_SIMILAR_SOUNDS:"/sounds/<sound_id>/similar/",_URI_SEARCH:"/sounds/search/",_URI_CONTENT_SEARCH:"/sounds/content_search/",_URI_GEOTAG:"/sounds/geotag",_URI_USER:"/people/<user_name>/",_URI_USER_SOUNDS:"/people/<user_name>/sounds/",_URI_USER_PACKS:"/people/<user_name>/packs/",_URI_USER_BOOKMARKS:"/people/<username>/bookmark_categories",_URI_BOOKMARK_CATEGORY_SOUNDS:"/people/<username>/bookmark_categories/<category_id>/sounds",_URI_PACK:"/packs/<pack_id>/",_URI_PACK_SOUNDS:"/packs/<pack_id>/sounds/",_make_uri:function(e,t){for(var i in t)e=e.replace(/<[\w_]+>/,t[i]);return this.BASE_URI+e},_make_request:function(uri,success,error,params,wrapper){var fs=this;-1==uri.indexOf("?")&&(uri+="?"),uri=uri+"&api_key="+this.apiKey;for(var p in params)uri=uri+"&"+p+"="+params[p];var xhr;try{xhr=new XMLHttpRequest}catch(e){xhr=new ActiveXObject("Microsoft.XMLHTTP")}xhr.onreadystatechange=function(){if(4==xhr.readyState&&200==xhr.status){var data=eval("("+xhr.responseText+")");success(wrapper?wrapper(data):data)}else 4==xhr.readyState&&200!=xhr.status&&error()},freesound.debug&&console.log(uri),xhr.open("GET",uri),xhr.send(null)},_make_sound_object:function(e){return e.get_analysis=function(t,i,n,r){var o=i?freesound._URI_SOUND_ANALYSIS_FILTER:freesound._URI_SOUND_ANALYSIS;freesound._make_request(freesound._make_uri(o,[e.id,i?i:""]),n,r)},e.get_similar_sounds=function(t,i){freesound._make_request(freesound._make_uri(freesound._URI_SIMILAR_SOUNDS,[e.id]),t,i,{},this._make_sound_collection_object)},e},_make_sound_collection_object:function(e){var t=function(e,t,i){freesound._make_request(e,t,i,{},this._make_sound_collection_object)};return e.next_page=function(e,i){t(this.next,e,i)},e.previous_page=function(e,i){t(this.previous,e,i)},e},_make_user_object:function(e){return e.get_sounds=function(t,i){freesound._make_request(freesound._make_uri(freesound._URI_USER_SOUNDS,[e.username]),t,i,{},this._make_sound_collection_object)},e.get_packs=function(t,i){freesound._make_request(freesound._make_uri(freesound._URI_USER_PACKS,[e.username]),t,i,{},this._make_pack_collection_object)},e.get_bookmark_categories=function(t,i){freesound._make_request(freesound._make_uri(freesound._URI_USER_BOOKMARKS,[e.username]),t,i)},e.get_bookmark_category_sounds=function(e,t,i){freesound._make_request(e,t,i)},e},_make_pack_object:function(e){return e.get_sounds=function(t,i){freesound._make_request(freesound._make_uri(freesound._URI_PACK_SOUNDS,[e.id]),t,i,{},this._make_sound_collection_object)},e},_make_pack_collection_object:function(e){var t=function(e,t,i){freesound._make_request(e,t,i,{},this._make_pack_collection_object)};return e.next_page=function(e,i){t(this.next,e,i)},e.previous_page=function(e,i){t(this.previous,e,i)},e},get_from_ref:function(e,t,i){this._make_request(e,t,i,{})},get_sound:function(e,t,i){this._make_request(this._make_uri(this._URI_SOUND,[e]),t,i,{},this._make_sound_object)},get_user:function(e,t,i){this._make_request(this._make_uri(this._URI_USER,[e]),t,i,{},this._make_user_object)},get_pack:function(e,t,i){this._make_request(this._make_uri(this._URI_PACK,[e]),t,i,{},this._make_pack_object)},quick_search:function(e,t,i){this.search(e,0,null,null,t,i)},search:function(e,t,i,n,r,o,a,s,l){var c={q:e?e:" "};t&&(c.p=t),i&&(c.f=i),n&&(c.s=n),r&&(c.num_results=r),a&&(c.sounds_per_page=a),o&&(c.fields=o),this._make_request(this._make_uri(this._URI_SEARCH),s,l,c,this._make_sound_collection_object)},content_based_search:function(e,t,i,n,r,o,a,s){var l={};r&&(l.p=r),t&&(l.f=t),e&&(l.t=e),i&&(l.max_results=i),o&&(l.sounds_per_page=o),n&&(l.fields=n),this._make_request(this._make_uri(this._URI_CONTENT_SEARCH),a,s,l,this._make_sound_collection_object)},geotag:function(e,t,i,n,r,o,a,s,l){var c={};e&&(c.min_lat=e),t&&(c.max_lat=t),i&&(c.min_lon=i),n&&(c.max_lon=n),r&&(c.p=r),a&&(c.sounds_per_page=a),o&&(c.fields=o),this._make_request(this._make_uri(this._URI_GEOTAG),s,l,c,this._make_sound_collection_object)}}}()},{}],3:[function(e,t){!function(){function e(e,t){return e=a[e],t=a[t],e.distance>t.distance?t.distance+12-e.distance:t.distance-e.distance}function i(e,t,i){for(;i>0;i--)e+=t;return e}function n(e,t){if("string"!=typeof e)return null;this.name=e,this.duration=t||4,this.accidental={value:0,sign:""};var i=e.match(/^([abcdefgh])(x|#|bb|b?)(-?\d*)/i);if(i&&e===i[0]&&0!==i[3].length)this.name=i[1].toLowerCase(),this.octave=parseFloat(i[3]),0!==i[2].length&&(this.accidental.sign=i[2].toLowerCase(),this.accidental.value=y[i[2]]);else{e=e.replace(/\u2032/g,"'").replace(/\u0375/g,",");var n=e.match(/^(,*)([abcdefgh])(x|#|bb|b?)([,\']*)$/i);if(!n||5!==n.length||e!==n[0])throw Error("Invalid note format");if(""===n[1]&&""===n[4])this.octave=n[2]===n[2].toLowerCase()?3:2;else if(""!==n[1]&&""===n[4]){if(n[2]===n[2].toLowerCase())throw Error("Invalid note format. Format must respect the Helmholtz notation.");this.octave=2-n[1].length}else{if(""!==n[1]||""===n[4])throw Error("Invalid note format");if(n[4].match(/^'+$/)){if(n[2]===n[2].toUpperCase())throw Error("Invalid note format. Format must respect the Helmholtz notation");this.octave=3+n[4].length}else{if(!n[4].match(/^,+$/))throw Error("Invalid characters after note name.");if(n[2]===n[2].toLowerCase())throw Error("Invalid note format. Format must respect the Helmholtz notation");this.octave=2-n[4].length}}this.name=n[2].toLowerCase(),0!==n[3].length&&(this.accidental.sign=n[3].toLowerCase(),this.accidental.value=y[n[3]])}}function r(e,t){if(!(e instanceof n))return null;t=t||"",this.name=e.name.toUpperCase()+e.accidental.sign+t,this.root=e,this.notes=[e],this.quality="major",this.type="major";var i,r,a,s,l,c=[],h=!1,f="quality",p=!1,d=!1,g=null;for(s=0,l=t.length;l>s;s++){for(i=t[s];" "===i||"("===i||")"===i;)i=t[++s];if(!i)break;if(r=i.charCodeAt(0),a=l>=s+3?t.substr(s,3):"","quality"===f)"M"===i||("maj"===a||916===r?(this.type="major",c.push("M7"),h=!0,(t[s+3]&&"7"===t[s+3]||916===r&&"7"===t[s+1])&&s++):"m"===i||"-"===i||"min"===a?this.quality=this.type="minor":111===r||176===r||"dim"===a?(this.quality="minor",this.type="diminished"):"+"===i||"aug"===a?(this.quality="major",this.type="augmented"):216===r||248===r?(this.quality="minor",this.type="diminished",c.push("m7"),h=!0):"sus"===a?(this.quality="sus",this.type=t[s+3]&&"2"===t[s+3]?"sus2":"sus4"):"5"===i?(this.quality="power",this.type="power"):s-=1),a in u&&(s+=2),f="";else if("#"===i)p=!0;else if("b"===i)d=!0;else if("5"===i)p?(g="A5","major"===this.quality&&(this.type="augmented")):d&&(g="d5","minor"===this.quality&&(this.type="diminished")),d=p=!1;else if("6"===i)c.push("M6"),d=p=!1;else if("7"===i)c.push("diminished"===this.type?"d7":"m7"),h=!0,d=p=!1;else if("9"===i)h||c.push("m7"),c.push(d?"m9":p?"A9":"M9"),d=p=!1;else{if("1"!==i)throw Error("Unexpected character: '"+i+"' in chord name");i=t[++s],"1"===i?c.push(d?"d11":p?"A11":"P11"):"3"===i&&c.push(d?"m13":p?"A13":"M13"),d=p=!1}}for(var v=0,y=m[this.type].length;y>v;v++)this.notes.push("5"===m[this.type][v][1]&&g?o.interval(this.root,g):o.interval(this.root,m[this.type][v]));for(v=0,y=c.length;y>v;v++)this.notes.push(o.interval(this.root,c[v]))}var o={},a={c:{name:"c",distance:0,index:0},d:{name:"d",distance:2,index:1},e:{name:"e",distance:4,index:2},f:{name:"f",distance:5,index:3},g:{name:"g",distance:7,index:4},a:{name:"a",distance:9,index:5},b:{name:"b",distance:11,index:6},h:{name:"h",distance:11,index:6}},s=["c","d","e","f","g","a","b"],l={.25:"longa",.5:"breve",1:"whole",2:"half",4:"quarter",8:"eighth",16:"sixteenth",32:"thirty-second",64:"sixty-fourth",128:"hundred-twenty-eighth"},c=[{name:"unison",quality:"perfect",size:0},{name:"second",quality:"minor",size:1},{name:"third",quality:"minor",size:3},{name:"fourth",quality:"perfect",size:5},{name:"fifth",quality:"perfect",size:7},{name:"sixth",quality:"minor",size:8},{name:"seventh",quality:"minor",size:10},{name:"octave",quality:"perfect",size:12},{name:"ninth",quality:"minor",size:13},{name:"tenth",quality:"minor",size:15},{name:"eleventh",quality:"perfect",size:17},{name:"twelfth",quality:"perfect",size:19},{name:"thirteenth",quality:"minor",size:20},{name:"fourteenth",quality:"minor",size:22},{name:"fifteenth",quality:"perfect",size:24}],h={unison:0,second:1,third:2,fourth:3,fifth:4,sixth:5,seventh:6,octave:7,ninth:8,tenth:9,eleventh:10,twelfth:11,thirteenth:12,fourteenth:13,fifteenth:14},u={P:"perfect",M:"major",m:"minor",A:"augmented",d:"diminished",perf:"perfect",maj:"major",min:"minor",aug:"augmented",dim:"diminished"},f={perfect:"P",major:"M",minor:"m",augmented:"A",diminished:"d"},p={P:"P",M:"m",m:"M",A:"d",d:"A"},d={perfect:["diminished","perfect","augmented"],minor:["diminished","minor","major","augmented"]},m={major:["M3","P5"],minor:["m3","P5"],augmented:["M3","A5"],diminished:["m3","d5"],sus2:["M2","P5"],sus4:["P4","P5"],power:["P5"]},g={major:"M",minor:"m",augmented:"aug",diminished:"dim",power:"5"},v={"-2":"bb","-1":"b",0:"",1:"#",2:"x"},y={bb:-2,b:-1,"#":1,x:2};n.prototype={key:function(e){return e?7*(this.octave-1)+3+Math.ceil(a[this.name].distance/2):12*(this.octave-1)+4+a[this.name].distance+this.accidental.value},fq:function(e){return e=e||440,e*Math.pow(2,(this.key()-49)/12)},scale:function(e,t){return o.scale.list(this,e,t)},interval:function(e,t){return o.interval(this,e,t)},chord:function(e){return e=e||"major",e in g&&(e=g[e]),new r(this,e)},helmholtz:function(){var e,t=3>this.octave?this.name.toUpperCase():this.name.toLowerCase();return 2>=this.octave?(e=i("",",",2-this.octave),e+t+this.accidental.sign):(e=i("","'",this.octave-3),t+this.accidental.sign+e)},scientific:function(){return this.name.toUpperCase()+this.accidental.sign+("number"==typeof this.octave?this.octave:"")},enharmonics:function(){var e=[],t=this.key(),i=this.interval("m2","up"),n=this.interval("m2","down"),r=i.key()-i.accidental.value,o=n.key()-n.accidental.value,a=t-r;return 3>a&&a>-3&&(i.accidental={value:a,sign:v[a]},e.push(i)),a=t-o,3>a&&a>-3&&(n.accidental={value:a,sign:v[a]},e.push(n)),e},valueName:function(){return l[this.duration]},toString:function(e){return e="boolean"==typeof e?e:"number"==typeof this.octave?!1:!0,this.name.toLowerCase()+this.accidental.sign+(e?"":this.octave)}},r.prototype.dominant=function(e){return e=e||"",new r(this.root.interval("P5"),e)},r.prototype.subdominant=function(e){return e=e||"",new r(this.root.interval("P4"),e)},r.prototype.parallel=function(e){if(e=e||"","triad"!==this.chordType()||"diminished"===this.quality||"augmented"===this.quality)throw Error("Only major/minor triads have parallel chords");return"major"===this.quality?new r(this.root.interval("m3","down"),"m"):new r(this.root.interval("m3","up"))},r.prototype.chordType=function(){var e,t,i;if(2===this.notes.length)return"dyad";if(3===this.notes.length){t={unison:!1,third:!1,fifth:!1};for(var n=0,r=this.notes.length;r>n;n++)e=this.root.interval(this.notes[n]),i=c[parseFloat(o.interval.invert(e.simple)[1])-1],e.name in t?t[e.name]=!0:i.name in t&&(t[i.name]=!0);return t.unison&&t.third&&t.fifth?"triad":"trichord"}if(4===this.notes.length){t={unison:!1,third:!1,fifth:!1,seventh:!1};for(var n=0,r=this.notes.length;r>n;n++)e=this.root.interval(this.notes[n]),i=c[parseFloat(o.interval.invert(e.simple)[1])-1],e.name in t?t[e.name]=!0:i.name in t&&(t[i.name]=!0);if(t.unison&&t.third&&t.fifth&&t.seventh)return"tetrad"}return"unknown"},r.prototype.toString=function(){return this.name},o.note=function(e,t){return new n(e,t)},o.note.fromKey=function(e){var t=440*Math.pow(2,(e-49)/12);return o.frequency.note(t).note},o.chord=function(e){var t;if(t=e.match(/^([abcdefgh])(x|#|bb|b?)/i),t&&t[0])return new r(new n(t[0].toLowerCase()),e.substr(t[0].length));throw Error("Invalid Chord. Couldn't find note name")},o.frequency={note:function(e,t){t=t||440;var i,r,o,l,c,h,u;return i=Math.round(49+12*((Math.log(e)-Math.log(t))/Math.log(2))),u=t*Math.pow(2,(i-49)/12),h=1200*(Math.log(e/u)/Math.log(2)),r=Math.floor((i-4)/12),o=i-12*r-4,l=a[s[Math.round(o/2)]],c=l.name,o>l.distance?c+="#":l.distance>o&&(c+="b"),{note:new n(c+(r+1)),cents:h}}},o.interval=function(e,t,i){if("string"==typeof t){"down"===i&&(t=o.interval.invert(t));var r=u[t[0]],a=parseFloat(t.substr(1));if(!r||isNaN(a)||1>a)throw Error("Invalid string-interval format");return o.interval.from(e,{quality:r,interval:c[a-1].name},i)}if(t instanceof n&&e instanceof n)return o.interval.between(e,t);throw Error("Invalid parameters")},o.interval.from=function(t,i,r){i.direction=r||i.direction||"up";var o,l,u,f,p,m;if(p=h[i.interval],m=c[p],p>7&&(p-=7),p=a[t.name].index+p,p>s.length-1&&(p-=s.length),o=s[p],-1===d[m.quality].indexOf(i.quality)||-1===d[m.quality].indexOf(m.quality))throw Error("Invalid interval quality");return l=d[m.quality].indexOf(i.quality)-d[m.quality].indexOf(m.quality),u=m.size+l-e(t.name,o),t.octave&&(f=Math.floor((t.key()-t.accidental.value+e(t.name,o)-4)/12)+1+Math.floor(h[i.interval]/7)),u+=t.accidental.value,u>=11&&(u-=12),u>-3&&3>u&&(o+=v[u]),"down"===r&&f--,new n(o+(f||""))},o.interval.between=function(e,t){var i,n,r,o,s,l,h=e.key(),u=t.key();if(i=u-h,i>24||-25>i)throw Error("Too big interval. Highest interval is a augmented fifteenth (25 semitones)");return 0>i&&(o=e,e=t,t=o),r=a[t.name].index-a[e.name].index+7*(t.octave-e.octave),n=c[r],l=d[n.quality][Math.abs(i)-n.size+1],s=f[l]+(""+Number(r+1)),{name:n.name,quality:l,direction:i>0?"up":"down",simple:s}},o.interval.invert=function(e){if(2!==e.length&&3!==e.length)return!1;var t=p[e[0]],i=parseFloat(2===e.length?e[1]:e.substr(1));return i>8&&(i-=7),8!==i&&1!==i&&(i=9-i),t+(""+i)},o.scale={list:function(e,t,i){var r,a,s=[],l=[];if(!(e instanceof n))return!1;if("string"==typeof t&&(t=o.scale.scales[t],!t))return!1;for(s.push(e),i&&l.push(e.name+(e.accidental.sign||"")),r=0,a=t.length;a>r;r++)s.push(o.interval(e,t[r])),i&&l.push(s[r+1].name+(s[r+1].accidental.sign||""));return i?l:s},scales:{major:["M2","M3","P4","P5","M6","M7"],ionian:["M2","M3","P4","P5","M6","M7"],dorian:["M2","m3","P4","P5","M6","m7"],phrygian:["m2","m3","P4","P5","m6","m7"],lydian:["M2","M3","A4","P5","M6","M7"],mixolydian:["M2","M3","P4","P5","M6","m7"],minor:["M2","m3","P4","P5","m6","m7"],aeolian:["M2","m3","P4","P5","m6","m7"],locrian:["m2","m3","P4","d5","m6","m7"],majorpentatonic:["M2","M3","P5","M6"],minorpentatonic:["m3","P4","P5","m7"],chromatic:["m2","M2","m3","M3","P4","A4","P5","m6","M6","m7","M7"],harmonicchromatic:["m2","M2","m3","M3","P4","A4","P5","m6","M6","m7","M7"]}},t.exports=o}()},{}],4:[function(e,t){t.exports=function(t){"use strict";{var i,n=t.dollar;e("gibberish-dsp")
}return i={"export":function(e){n.extend(e,i.Busses),n.extend(e,i.Oscillators),n.extend(e,i.Synths),n.extend(e,i.Percussion),n.extend(e,i.Envelopes),n.extend(e,i.FX),n.extend(e,i.Seqs),n.extend(e,i.Samplers),n.extend(e,i.PostProcessing),n.extend(e,i.Vocoder),e.Theory=i.Theory,n.extend(e,i.Analysis),e.Clock=i.Clock,e.Seq=i.Seqs.Seq,e.Arp=i.Arp,e.ScaleSeq=i.Seqs.ScaleSeq,e.SoundFont=i.SoundFont,e.Speak=i.Speak,e.Rndi=i.Core.Rndi,e.Rndf=i.Core.Rndf,e.rndi=i.Core.rndi,e.rndf=i.Core.rndf,e.Input=i.Input,e.Freesound=i.Freesound,e.Scale=i.Theory.Scale,e.module=t.import,i.Core.Time.export(e),i.Clock.export(e),i.Core.Binops.export(e)},init:function(){var e=null;i.onstart&&(e=i.onstart),i.context||(i.context={sampleRate:44100}),i.Core.onstart=function(){i.Clock.start(!0),null!==e&&e()},t.Clock=i.Clock,t.Theory=i.Theory,t.Theory.scale=t.scale=t.Audio.Theory.Scale("c4","Minor"),i.Core._init(),n.extend(t.Binops,i.Binops),i.Master=i.Busses.Bus().connect(i.Core.out),i.Master.type="Bus",i.Master.name="Master",n.extend(!0,i.Master,i.ugenTemplate),i.Master.fx.ugen=i.Master,i.ugenTemplate.connect=i.Core._oscillator.connect=i.Core._synth.connect=i.Core._effect.connect=i.Core._bus.connect=i.connect,i.Core.defineUgenProperty=i.defineUgenProperty,n.extend(t.Presets,i.Synths.Presets),n.extend(t.Presets,i.Percussion.Presets),n.extend(t.Presets,i.FX.Presets)},Time:{ms:function(e){return{mode:"absolute",value:t.Audio.Core.context.sampleRate/1e3*e,valueOf:function(){return this.value}}},seconds:function(e){return{mode:"absolute",value:t.Audio.Core.context.sampleRate*e,valueOf:function(){return this.value}}},minutes:function(e){return{mode:"absolute",value:60*t.Audio.Core.context.sampleRate*e,valueOf:function(){return this.value}}}},defineUgenProperty:function(e,t,n){var r=i.Clock.timeProperties.indexOf(e)>-1,o=n.properties[e]={value:r?i.Clock.time(t):t,binops:[],parent:n,name:e},a=e.charAt(0).toUpperCase()+e.slice(1);Object.defineProperty(n,e,{configurable:!0,get:function(){return o.value},set:function(e){return n[a]&&n[a].mapping&&n[a].mapping.remove&&n[a].mapping.remove(!0),o.value=r?i.Clock.time(e):e,i.Core.dirty(n),o.value}}),n[e]=o.value},polyInit:function(e){e.mod=e.polyMod,e.removeMod=e.removePolyMod;for(var t in e.polyProperties)!function(t){var n=e.polyProperties[t],r=i.Clock.timeProperties.indexOf(t)>-1;Object.defineProperty(e,t,{get:function(){return n},set:function(n){for(var o=0;o<e.children.length;o++)e.children[o][t]=r?i.Clock.time(n):n}})}(t)},connect:function(e,t){return"undefined"==typeof e&&(e=i.Master),-1===this.destinations.indexOf(e)&&(e.addConnection(this,1,t),0!==t&&this.destinations.push(e)),this},clear:function(){for(var e=Array.prototype.slice.call(arguments,0),t=0;t<i.Master.inputs.length;t++)-1===e.indexOf(i.Master.inputs[t].value)&&i.Master.inputs[t].value.disconnect();i.Master.inputs.length=arguments.length,i.Clock.reset(),i.Master.fx.remove(),i.Master.amp=1,i.Core.clear(),i.Core.out.addConnection(i.Master,1),i.Master.destinations.push(i.Core.out),console.log("Audio stopped.")},ugenTemplate:{sequencers:[],mappings:[],fx:n.extend([],{add:function(){var e=0===this.length?this.ugen:this[this.length-1];e.disconnect();for(var t=0;t<arguments.length;t++){var n=arguments[t];n.input=e,e=n,this.push(n)}return this.ugen!==i.Master?e.connect():e.connect(i.Core.out),this.ugen},remove:function(){if(arguments.length>0)for(var e=0;e<arguments.length;e++){var t=arguments[e];if("string"!=typeof t)if("object"!=typeof t){if("number"==typeof t){var n=this[t];if(n.disconnect(),this.splice(t,1),"undefined"!=typeof this[t]){var r=t-1;this[t].input=-1!==r?this[r]:this.ugen,"undefined"!=typeof this[t+1]?this[t+1].input=0===t?this.ugen:this[t]:this.ugen.connect(this.ugen!==i.Master?i.Master:i.Core.out)}else this.length>0?this[t-1].connect(i.Master):this.ugen.connect(this.ugen!==i.Master?i.Master:i.Core.out)}}else for(var o=0;o<this.length;o++)this[o]===t&&this.remove(o);else for(var o=0;o<this.length;o++)this[o].name===t&&this.remove(o)}else this.length>0?(this[this.length-1].disconnect(),this.ugen.connect(this.ugen!==i.Master?i.Master:i.Core.out),this.ugen.codegen(),this.length=0):console.log(this.ugen.name+" does not have any fx to remove. ")}}),replaceWith:function(e){for(var t=0;t<this.destinations.length;t++)e.connect(this.destinations[t]);for(var t=0;t<this.sequencers.length;t++)this.sequencers[t].target=e,e.sequencers.push(this.sequencers[t]);for(var t=0;t<this.mappingObjects.length;t++){var i=this.mappingObjects[t];if(i.targets.length>0)for(var n=0;n<i.targets.length;n++){var r=i.targets[n];e.mappingProperties[i.name]?r[0].mapping.replace(e,i.name,i.Name):r[0].mapping.remove()}}this.kill()},kill:function(){var e=0!==this.fx.length?this.fx[this.fx.length-1]:this;this.seq.isRunning&&this.seq.disconnect(),e.disconnect();for(var t=0;t<this.fx.length;t++){var i=this.fx[t];i.seq.isRunning&&i.seq.disconnect()}this.disconnect();for(var t=0;t<this.mappings.length;t++)this.mappings[t].remove();this.clearMarks&&this.clearMarks(),console.log(this.name+" has been terminated.")},play:function(e,t){return this.note?this.note.seq(e,t):this.frequency&&this.frequency.seq(e,t),this},fadeIn:function(e,t){isNaN(t)&&(t=1);var n=i.Clock.time(e),r=(new i.Core.ExponentialDecay({decayCoefficient:.05,length:n}),new i.Core.Line(0,t,n));return this.amp=r,future(function(){this.amp=t}.bind(this),n),this},fadeOut:function(e){var t=i.Clock.time(e),n=(new i.Core.ExponentialDecay({decayCoefficient:5e-5,length:t}),new i.Core.Line(this.amp.value,0,i.Clock.time(t)));return this.amp(n),future(function(){this.amp=0}.bind(this),t),this}}},i.Core=e("gibberish-dsp"),i.Core._init=i.Core.init.bind(i.Core),delete i.Core.init,i.Clock=e("./audio/clock")(t),i.Freesoundjs=e("../external/freesound"),i.Freesound=e("./audio/gibber_freesound")(i.Freesoundjs),i.Seqs=e("./audio/seq")(t),i.Theory=e("./audio/theory")(t),i.FX=e("./audio/fx")(t),i.Oscillators=e("./audio/oscillators")(t),i.Synths=e("./audio/synths")(t),i.Busses=e("./audio/bus")(t),i.Analysis=e("./audio/analysis")(t),i.Envelopes=e("./audio/envelopes")(t),i.Percussion=e("./audio/drums")(t),i.Input=e("./audio/audio_input")(t),i.Samplers=e("./audio/sampler")(t),i.Vocoder=e("./audio/vocoder")(t),i.PostProcessing=e("./audio/postprocessing")(t),i.Arp=e("./audio/arp")(t),i.SoundFont=e("./audio/soundfont")(t),i}},{"../external/freesound":2,"./audio/analysis":5,"./audio/arp":6,"./audio/audio_input":7,"./audio/bus":8,"./audio/clock":9,"./audio/drums":10,"./audio/envelopes":11,"./audio/fx":12,"./audio/gibber_freesound":13,"./audio/oscillators":14,"./audio/postprocessing":15,"./audio/sampler":16,"./audio/seq":17,"./audio/soundfont":18,"./audio/synths":19,"./audio/theory":20,"./audio/vocoder":21,"gibberish-dsp":1}],5:[function(e,t){t.exports=function(t){"use strict";var i,n={value:{min:0,max:255,output:s,wrap:!1,timescale:"graphics"}},r=e("gibberish-dsp"),o=t.dollar,a=t.outputCurves,s=(a.LINEAR,a.LOGARITHMIC),l={FFT:function(e,a){if("undefined"==typeof i){i=r.context.createAnalyser(),r.node.connect(i),i.fftSize=e||32,i.updateRate=a||40,i.values=new Uint8Array(i.frequencyBinCount),i.children=[];for(var s=0;s<i.frequencyBinCount;s++)!function(){var e=s,r={},a=0;Object.defineProperties(r,{value:{configurable:!0,get:function(){return a},set:function(e){a=e}}}),t.createProxyProperties(r,o.extend({},n),!1),i[e]=r,i.children.push(r),r.type="mapping",r.index=e,r.min=0,r.max=255,r.valueOf=function(){return this.value.value}}();setInterval(function(){i.getByteFrequencyData(i.values);for(var e=0;e<i.values.length;e++)i[e].value=i.values[e]},i.updateRate)}else e&&(i.fftSize=e),a&&(i.updateRate=a);return i},Follow:function(e,i){var n=new r.Follow(e,i),o={value:{min:0,max:1,output:s,timescale:"audio"}};return t.createProxyProperties(n,o),n}};return l}},{"gibberish-dsp":1}],6:[function(e,t){t.exports=function(t){var i,n=e("../../external/teoria.min"),r=t.dollar,o=(t.outputCurves,e("./seq")(t).Seq);return i=function(e,i,a,s,l){var c=o();r.extend(c,{name:"Arp",notes:[],pattern:a||"up",notation:e||"C4m7",mult:s||1,init:!1,speed:isNaN(i)?_4:i,scale:l||null,chord:function(e){var i=[];if(this.notation=e,"undefined"==typeof this.scale||null===this.scale&&"string"==typeof e)for(var r=0;r<this.mult;r++){var o,a,s=[],l=this.notation.slice(0,1);isNaN(this.notation.charAt(1))?(l+=this.notation.charAt(1),o=parseInt(this.notation.slice(2,3)),a=this.notation.slice(3)):(o=parseInt(this.notation.slice(1,2)),a=this.notation.slice(2)),o+=r;for(var e=n.note(l+o).chord(a),c=0;c<e.notes.length;c++){var h=e.notes[c].fq();s[c]=h}i=i.concat(s)}else for(var r=0;r<this.mult;r++){for(var s=[],c=0;c<this.notation.length;c++)s[c]=this.notation[c]+7*r;i=i.concat(s)}this.notes=t.construct(t.Pattern,this.patterns[this.pattern](i)),this.seqs[0]&&(this.seqs[0].values=[this.notes])},set:function(e,t,i,n,r){this.speed=t||this.speed,this.pattern=i||this.pattern,this.mult=n||this.mult,this.chord(e,r)},shuffle:function(){this.notes.shuffle()},reset:function(){this.notes.reset()},patterns:{up:function(e){return e},down:function(e){return e.reverse()},updown:function(e){var t=e.slice(0);return t.reverse(),e.concat(t)},updown2:function(e){var t=e.slice(0);return t.pop(),t.reverse(),t.pop(),e.concat(t)}}}),c.seq=c,t.createProxyMethods(c,["shuffle","reset","chord"]),c.chord(c.notation);var h=null;Object.defineProperty(c,"target",{get:function(){return h},set:function(e){h=e;var n={key:"note",target:h,values:c.notes,durations:t.Clock.time(i)};c.add(n),c.start()}});var u=i;return Object.defineProperty(c,"speed",{get:function(){return u},set:function(e){u=e;for(var i=0;i<c.seqs.length;i++)c.seqs[0].durations=t.Clock.time(u)}}),c}}},{"../../external/teoria.min":3,"./seq":17}],7:[function(e,t){t.exports=function(t){"use strict";var i={},n=e("gibberish-dsp"),r=t.outputCurves,o=r.LINEAR,a=r.LOGARITHMIC,s={amp:{min:0,max:1,hardMax:2,output:a,timescale:"audio",dimensions:1},out:{min:0,max:1,output:o,timescale:"audio",dimensions:1}},l="Input";return i=function(){var e=(new n.Input).connect(t.Master),i=Array.prototype.slice.call(arguments,0);return e.type="Gen",$.extend(!0,e,t.Audio.ugenTemplate),e.fx.ugen=e,Object.defineProperty(e,"_",{get:function(){return e.kill(),e},set:function(){}}),t.createProxyProperties(e,s),t.processArguments2(e,i,l),e.toString=function(){return"> "+l},e}}},{"gibberish-dsp":1}],8:[function(e,t){t.exports=function(t){"use strict";for(var i=t.dollar,n=e("gibberish-dsp"),r=t.outputCurves,o=r.LINEAR,a=(r.LOGARITHMIC,[["Bus2","Bus"]]),s={amp:{min:0,max:1,output:o,timescale:"audio"},pan:{min:-.75,max:.75,output:o,timescale:"audio"},out:{min:0,max:1,output:o,timescale:"audio",dimensions:1}},l=!1,c={mappingProperties:s,Presets:{}},h=0;h<a.length;h++)!function(){var e=Array.isArray(a[h])?a[h][0]:a[h],r=Array.isArray(a[h])?a[h][1]:a[h];c[r]=function(){var o=t.processArguments(arguments,r);return Array.isArray(o)?(o.unshift(0),o=t.construct(n[e],o)):o=new n[e](o),l?o.connect(Master):l=!0,o.type="Gen",Object.defineProperty(o,"_",{get:function(){return o.kill(),o},set:function(){}}),i.extend(!0,o,t.Audio.ugenTemplate),o.fx.ugen=o,t.createProxyProperties(o,s),o}}();return c.Group=function(){var e=t.processArguments(arguments,"Bus2");e=new n.Bus2,l?e.connect(Master):l=!0,e.type="FX",i.extend(!0,e,t.Audio.ugenTemplate),e.fx.ugen=e,t.createProxyProperties(e,s),i.extend(e,{add:function(){for(var t=0;t<arguments.length;t++)arguments[t].disconnect(),arguments[t].connect(e)},remove:function(){for(var t=0;t<arguments.length;t++)arguments[t].disconnect(e)},free:function(){for(var t=0;t<arguments.length;t++)arguments[t].disconnect(e),arguments[t].connect()}});for(var r=0;r<arguments.length;r++)e.add(arguments[r]);return e},c}},{"gibberish-dsp":1}],9:[function(_dereq_,module,exports){!function(){var times=[],$=null,curves=null,LINEAR=null,LOGARITHMIC=null,Gibberish=_dereq_("gibberish-dsp"),Gibber,Clock={seq:null,bpm:null,maxMeasures:44,baseBPM:120,metronome:null,currentBeat:0,beatsPerMeasure:4,codeToExecute:[],signature:{lower:4,upper:4},sequencers:[],timeProperties:["attack","decay","sustain","release","offset","time"],phase:0,"export":function(e){e.beats=Clock.beats,e.Beats=Clock.Beats,e.measures=Clock.measures,e.Measures=Clock.Measures},processBeat:function(){if(Clock.currentBeat=Clock.currentBeat>=Clock.signature.upper?1:Clock.currentBeat+1,1===Clock.currentBeat&&Clock.codeToExecute.length>0){for(var i=0;i<Clock.codeToExecute.length;i++)try{"function"==typeof Clock.codeToExecute[i].function?Clock.codeToExecute[i].function():Gibber.Environment?Gibber.Environment.modes[Clock.codeToExecute[i].cm.doc.mode.name].run(Clock.codeToExecute[i].cm.column,Clock.codeToExecute[i].code,Clock.codeToExecute[i].pos,Clock.codeToExecute[i].cm,!1):eval(Clock.codeToExecute[i].code)}catch(e){console.error("FAILED TO EXECUTE CODE:",Clock.codeToExecute[i].code,e)}Clock.codeToExecute.length=0}null!==Clock.metronome&&Clock.metronome.draw(Clock.currentBeat,Clock.signature.upper),Clock.phase+=Clock.beats(1)},getTimeSinceStart:function(){return Clock.phase+Clock.seq.phase},reset:function(){this.phase=0,this.currentBeat=0,this.rate=1,this.start()},tap:function(){var e=Gibber.Clock.getTimeSinceStart();for(times[2]&&e-times[2]>88200&&(times.length=0),times.unshift(e);times.length>3;)times.pop();if(3===times.length){var t=(times[0]+times[1]-2*times[2])/3,i=44100/t,n=60*i;Gibber.Clock.bpm=n}},start:function(e){if(e){$.extend(this,{properties:{rate:1},name:"master_clock",callback:function(e){return e}}),this.__proto__=new Gibberish.ugen,this.__proto__.init.call(this);var t=this.baseBPM;Object.defineProperty(Clock,"bpm",{get:function(){return t},set:function(e){t=e,Clock.rate=t/Clock.baseBPM}}),Object.defineProperty(this,"timeSignature",{get:function(){return Clock.signature.upper+"/"+Clock.signature.lower},set:function(e){var t=e.split("/");2!==t.length||t[0]===Clock.signature.upper&&t[1]===Clock.signature.lower||(Clock.signature.upper=parseInt(t[0]),Clock.signature.lower=parseInt(t[1]),Clock.currentBeat=1!=Clock.currentBeat?0:1)}}),Gibber.createProxyProperties(this,{rate:{min:.1,max:2,output:LINEAR,timescale:"audio"},bpm:{min:20,max:200,output:LINEAR,timescale:"audio"}})}Clock.seq=new Gibberish.PolySeq({seqs:[{target:Clock,values:[Clock.processBeat.bind(Clock)],durations:[.25]}],rate:Clock}),Clock.seq.connect().start(),Clock.seq.timeModifier=Clock.time.bind(Clock)},addMetronome:function(e){this.metronome=e,this.metronome.init()},time:function(e){var t;return t=e<Clock.maxMeasures?Clock.beats(e*Clock.signature.lower):e},Time:function(e){var t;return t=Clock.Beats(e<this.maxMeasures?e*Clock.signature.lower:e)},beats:function(e){var t="undefined"!=typeof Gibberish.context?Gibberish.context.sampleRate:44100,i=t/(Clock.baseBPM/60);return i*e*(4/Clock.signature.lower)},Beats:function(e){return function(){return Gibber.Clock.beats(e)}},measures:function(e){return Clock.beats(e*Clock.signature.upper)},Measures:function(e){return Clock.Beats(e*Clock.signature.upper)}};module.exports=function(e){"use strict";return Gibber=e,$=Gibber.dollar,curves=Gibber.outputCurves,LINEAR=curves.LINEAR,LOGARITHMIC=curves.LOGARITHMIC,Clock}}()},{"gibberish-dsp":1}],10:[function(_dereq_,module,exports){module.exports=function(Gibber){"use strict";for(var Percussion={Presets:{}},Gibberish=_dereq_("gibberish-dsp"),$=Gibber.dollar,Clock=Gibber.Clock,curves=Gibber.outputCurves,LINEAR=curves.LINEAR,LOGARITHMIC=curves.LOGARITHMIC,types=["Kick","Snare","Hat","Conga","Cowbell","Clave","Tom"],_mappingProperties={Drums:{pitch:{min:.25,max:4,output:LINEAR,timescale:"audio"},amp:{min:0,max:1,output:LOGARITHMIC,timescale:"audio"},pan:{min:0,max:1,output:LINEAR,timescale:"audio"},out:{min:0,max:1,output:LINEAR,timescale:"audio",dimensions:1}},XOX:{amp:{min:0,max:1,output:LOGARITHMIC,timescale:"audio"},pan:{min:0,max:1,output:LINEAR,timescale:"audio"},out:{min:0,max:1,output:LINEAR,timescale:"audio",dimensions:1}},Kick:{amp:{min:0,max:1,output:LOGARITHMIC,timescale:"audio"},out:{min:0,max:1,output:LINEAR,timescale:"audio",dimensions:1}},Snare:{amp:{min:0,max:1,output:LOGARITHMIC,timescale:"audio"},snappy:{min:.25,max:1.5,output:LOGARITHMIC,timescale:"audio"},tune:{min:0,max:2,output:LOGARITHMIC,timescale:"audio"},out:{min:0,max:1,output:LINEAR,timescale:"audio",dimensions:1}},Hat:{amp:{min:0,max:1,output:LOGARITHMIC,timescale:"audio"},out:{min:0,max:1,output:LINEAR,timescale:"audio",dimensions:1}},Conga:{amp:{min:0,max:1,output:LOGARITHMIC,timescale:"audio"},out:{min:0,max:1,output:LINEAR,timescale:"audio",dimensions:1}},Cowbell:{out:{min:0,max:1,output:LINEAR,timescale:"audio",dimensions:1},amp:{min:0,max:1,output:LOGARITHMIC,timescale:"audio"}},Clave:{out:{min:0,max:1,output:LINEAR,timescale:"audio",dimensions:1},amp:{min:0,max:1,output:LOGARITHMIC,timescale:"audio"}},Tom:{out:{min:0,max:1,output:LINEAR,timescale:"audio",dimensions:1},amp:{min:0,max:1,output:LOGARITHMIC,timescale:"audio"}}},i=0;i<types.length;i++)!function(){var e=Array.isArray(types[i])?types[i][0]:types[i],t=Array.isArray(types[i])?types[i][1]:types[i];Percussion[t]=function(){var i,n=Array.prototype.slice.call(arguments);return"object"==typeof n[0]&&"undefined"==typeof n[0].maxVoices?n[0].maxVoices=1:"undefined"==typeof n[0]&&(n[0]={maxVoices:1}),i=Gibber.processArguments(n,t),i=Array.isArray(i)?Gibber.construct(Gibberish[e],i).connect(Gibber.Master):new Gibberish[e](i).connect(Gibber.Master),i.type="Gen",$.extend(!0,i,Gibber.Audio.ugenTemplate),i.fx.ugen=i,i._note=i.note.bind(i),i.note=function(){var e=Array.prototype.splice.call(arguments,0);"string"==typeof e[0]&&(e[0]=Gibber.Theory.Teoria.note(e[0]).fq()),this._note.apply(this,e)},Gibber.createProxyProperties(i,_mappingProperties[t]),Gibber.createProxyMethods(i,["note","send"]),i.toString=function(){return"> "+t},Object.defineProperty(i,"_",{get:function(){return i.kill(),i},set:function(){}}),i}}();return Percussion.Drums=function(_sequence,_timeValue,_amp,_freq){var args=Array.prototype.slice.call(arguments),obj={},props=Gibber.processArguments(args,"Drums");$.extend(!0,obj,props),obj=Array.isArray(obj)?Gibber.construct(Gibberish.Bus2,obj).connect(Gibber.Master):new Gibberish.Bus2(obj).connect(Gibber.Master),obj.name="Drums",obj.type="Gen",obj.children=[],$.extend(!0,obj,Gibber.Audio.ugenTemplate),obj.fx.ugen=obj,Object.defineProperty(obj,"_",{get:function(){return obj.kill(),obj},set:function(){}}),obj.kit=Percussion.Drums.kits["default"],"object"==typeof arguments[0]&&arguments[0].kit&&(obj.kit=Percussion.Drums.kits[arguments[0].kit],arguments[0].kit=obj.kit);for(var key in obj.kit){var drum=obj.kit[key];obj[key]={sampler:new Gibberish.Sampler({file:drum.file,pitch:1,amp:drum.amp}),pitch:drum.pitch,amp:drum.amp},obj[key].sampler.pan=drum.pan,obj[key].sampler.connect(obj),obj[key].fx=obj[key].sampler.fx,obj.children.push(obj[key].sampler)}if(obj.mod=obj.polyMod,obj.removeMod=obj.removePolyMod,obj.connect(),Gibber.createProxyProperties(obj,_mappingProperties.Drums),obj.note=function(e){var t=obj.pitch.value;if($.isArray(e))for(var i=0;i<e.length;i++){var n=e[i];if("string"==typeof n){for(var r in obj.kit)if(n===obj.kit[r].symbol){obj[r].sampler.note(t,obj[r].amp);break}}else{var o=obj[Object.keys(obj.kit)[n]];o.sampler.note(t.value,o.sampler.amp)}}else if("string"==typeof e){for(var r in obj.kit)if(e===obj.kit[r].symbol){obj[r].sampler.note(t,obj[r].amp),obj[r].sampler.pitch=t;break}}else{var a=Object.keys(obj.kit),s=Math.abs(e),r=a[s%a.length],o=obj[r];o.sampler.note(t,o.sampler.amp)}},obj.pitch=1,"undefined"!=typeof props)switch($.type(props[0])){case"string":for(var notes=props[0],_seqs=[],_durations=[],__durations=[],seqs=notes.split("|"),timeline={},i=0;i<seqs.length;i++){var seq=seqs[i],duration,hasTime=!1,idx=seq.indexOf(",");if(idx>-1){var _value=seq.substr(0,idx),duration=seq.substr(idx+1);duration=eval(duration),hasTime=!0,seq=_value.trim().split("")}else seq=seq.trim().split(""),duration=1/seq.length;if(seq.indexOf(".rnd(")>-1&&(seq=seq.split(".rnd")[0],seq=seq.split("").rnd()),"undefined"!=typeof props[1]){duration=props[1],Array.isArray(duration)||(duration=[duration]);var durationsPattern=Gibber.construct(Gibber.Pattern,duration);if(duration.randomFlag){durationsPattern.filters.push(function(){return[durationsPattern.values[rndi(0,durationsPattern.values.length-1)],1]});for(var i=0;i<duration.randomArgs.length;i+=2)durationsPattern.repeat(duration.randomArgs[i],duration.randomArgs[i+1])}duration=durationsPattern}obj.seq.add({key:"note",values:Gibber.construct(Gibber.Pattern,seq),durations:Gibber.construct(Gibber.Pattern,[duration]),target:obj});var seqNumber=obj.seq.seqs.length-1;Object.defineProperties(obj.note,{values:{configurable:!0,get:function(){return obj.seq.seqs[seqNumber].values},set:function(e){var t=Gibber.construct(Gibber.Pattern,e);Array.isArray(t)||(t=[t]),obj.seq.seqs[seqNumber].values=t}},durations:{configurable:!0,get:function(){return obj.seq.seqs[seqNumber].durations},set:function(e){Array.isArray(e)||(e=[e]),obj.seq.seqs[seqNumber].durations=e}}})}break;case"object":"string"==typeof props[0].note&&(props[0].note=props[0].note.split("")),props[0].target=obj,props[0].durations=Gibber.Clock.Time(props[0].durations?props[0].durations:1/props[0].note.length),props[0].offset=props[0].offset?Gibber.Clock.time(props[0].offset):0;break;case"function":case"array":var length=props[0].length||props[0].values.length,durations="undefined"!=typeof arguments[1]?arguments[1]:Gibber.Clock.Time(1/length);"function"!=typeof durations&&(durations=Gibber.Clock.Time(durations)),obj.seq.add({key:"note",values:[props[0]],durations:durations,target:obj}),obj.pattern=obj.seq.seqs[obj.seq.seqs.length-1].values[0]}return"undefined"==typeof props&&(props={}),props.pitch&&(obj.pitch=props.pitch),"undefined"!=typeof props.snare&&($.extend(obj.snare.sampler,props.snare),$.extend(obj.snare,props.snare)),"undefined"!=typeof props.kick&&($.extend(obj.kick.sampler,props.kick),$.extend(obj.kick,props.kick)),"undefined"!=typeof props.hat&&($.extend(obj.hat.sampler,props.hat),$.extend(obj.hat,props.hat)),"undefined"!=typeof props.openHat&&($.extend(obj.openHat.sampler,props.openHat),$.extend(obj.openHat,props.openHat)),obj.amp=isNaN(_amp)?1:_amp,obj.seq&&obj.seq.tick&&Gibberish.future(obj.seq.tick,1),obj.start=function(){obj.seq.start(!0)},obj.stop=function(){obj.seq.stop()},obj.shuffle=function(){obj.seq.shuffle()},obj.reset=function(){obj.seq.reset()},Gibber.createProxyMethods(obj,["play","stop","shuffle","reset","start","send","note"]),obj.seq.start(!0),Object.defineProperties(obj,{offset:{get:function(){return obj.seq.offset},set:function(e){obj.seq.offset=Gibber.Clock.time(e)}}}),obj},Percussion.EDrums=function(_sequence,_timeValue,_amp,_freq){var args=Array.prototype.slice.call(arguments),obj={},props=Gibber.processArguments(args,"Drums");$.extend(!0,obj,props),obj=Array.isArray(obj)?Gibber.construct(Gibberish.Bus2,obj).connect(Gibber.Master):new Gibberish.Bus2(obj).connect(Gibber.Master),obj.name="XOX",obj.type="Gen",obj.children=[],$.extend(!0,obj,Gibber.Audio.ugenTemplate),obj.fx.ugen=obj,Object.defineProperty(obj,"_",{get:function(){return obj.kill(),obj},set:function(){}}),obj.pitch=1,obj.kick=Gibber.Audio.Percussion.Kick().disconnect(),obj.snare=Gibber.Audio.Percussion.Snare().disconnect(),obj.hat=Gibber.Audio.Percussion.Hat().disconnect(),obj.kick.connect(obj),obj.snare.connect(obj),obj.hat.connect(obj),obj.children.push(obj.kick,obj.snare,obj.hat),obj.mod=obj.polyMod,obj.removeMod=obj.removePolyMod,obj.set=function(e){obj.seq.note=e.split("")},Gibber.createProxyProperties(obj,_mappingProperties.XOX),obj.start=function(){obj.seq.start(!0)},obj.stop=function(){obj.seq.stop()},obj.shuffle=function(){obj.seq.shuffle()},obj.reset=function(){obj.seq.reset()};var kcd=1,scd=1,hcd=1,kf=null,sf=null,hf=null;if(obj.note=function(e){switch(e){case"x":1===kcd&&(kcd=0),obj.kick.note(),null!==kf&&(kf(),kf=null),kf=Gibber.Utilities.future(function(){kcd=1,kf=null},11e4*obj.kick.decay);break;case"o":1===scd&&(scd=0),obj.snare.note(),null!==sf&&(sf(),sf=null),sf=Gibber.Utilities.future(function(){scd=1,sf=null},obj.snare.decay);break;case"*":1===hcd&&(hcd=0),obj.hat.note(5e3),null!==hf&&(hf(),hf=null),hf=Gibber.Utilities.future(function(){hcd=1,hf=null},5500);break;case"-":1===hcd&&(hcd=0),obj.hat.note(3e4),null!==hf&&(hf(),hf=null),hf=Gibber.Utilities.future(function(){hcd=1,hf=null},30500)}},Gibber.createProxyMethods(obj,["play","stop","shuffle","reset","start","send"]),"undefined"!=typeof props)switch($.type(props[0])){case"string":for(var notes=props[0],_seqs=[],_durations=[],__durations=[],seqs=notes.split("|"),timeline={},i=0;i<seqs.length;i++)!function(num){var seq=seqs[num],duration,hasTime=!1,idx=seq.indexOf(",");if(idx>-1){var _value=seq.substr(0,idx),duration=seq.substr(idx+1);duration=eval(duration),hasTime=!0,seq=_value.trim().split("")}else seq=seq.trim().split(""),duration=1/seq.length;if(seq.indexOf(".rnd(")>-1&&(seq=seq.split(".rnd")[0],seq=seq.split("").rnd()),"undefined"!=typeof props[1]){duration=props[1],Array.isArray(duration)||(duration=[duration]);var durationsPattern=Gibber.construct(Gibber.Pattern,duration);if(duration.randomFlag){durationsPattern.filters.push(function(){return[durationsPattern.values[rndi(0,durationsPattern.values.length-1)],1]});for(var i=0;i<duration.randomArgs.length;i+=2)durationsPattern.repeat(duration.randomArgs[i],duration.randomArgs[i+1])}duration=durationsPattern}obj.seq.add({key:"note",values:Gibber.construct(Gibber.Pattern,seq),durations:Gibber.construct(Gibber.Pattern,[duration]),target:obj});var seqNumber=obj.seq.seqs.length-1;Object.defineProperties(obj.note,{values:{configurable:!0,get:function(){return obj.seq.seqs[seqNumber].values},set:function(e){var t=Gibber.construct(Gibber.Pattern,e);Array.isArray(t)||(t=[t]),obj.seq.seqs[seqNumber].values=t}},durations:{configurable:!0,get:function(){return obj.seq.seqs[seqNumber].durations},set:function(e){Array.isArray(e)||(e=[e]),obj.seq.seqs[seqNumber].durations=e}}})}(i);break;case"object":"string"==typeof props[0].note&&(props[0].note=props[0].note.split("")),props[0].target=obj,props[0].durations=Gibber.Clock.Time(props[0].durations?props[0].durations:1/props[0].note.length),props[0].offset=props[0].offset?Gibber.Clock.time(props[0].offset):0,obj.seq=Seq(props[0])}return"undefined"==typeof props&&(props={}),props.pitch&&(obj.pitch=props.pitch),"undefined"!=typeof props.snare&&($.extend(obj.snare.sampler,props.snare),$.extend(obj.snare,props.snare)),"undefined"!=typeof props.kick&&($.extend(obj.kick.sampler,props.kick),$.extend(obj.kick,props.kick)),"undefined"!=typeof props.hat&&($.extend(obj.hat.sampler,props.hat),$.extend(obj.hat,props.hat)),"undefined"!=typeof props.openHat&&($.extend(obj.openHat.sampler,props.openHat),$.extend(obj.openHat,props.openHat)),obj.amp=isNaN(_amp)?1:_amp,obj.seq.tick&&Gibberish.future(obj.seq.tick,1),obj.seq.start(!0),obj.toString=function(){return"EDrums : "+obj.seq.seqs[0].values.join("")},obj},Percussion.XOX=Percussion.EDrums,Percussion.Drums.kits={original:{kick:{file:"resources/audiofiles/kick.wav",symbol:"x",amp:1,pitch:1,pan:0},snare:{file:"resources/audiofiles/snare.wav",symbol:"o",amp:1,pitch:1,pan:.15},hat:{file:"resources/audiofiles/hat.wav",symbol:"*",amp:1,pitch:1,pan:-.1},openHat:{file:"resources/audiofiles/openHat.wav",symbol:"-",amp:1,pitch:1,pan:-.2}},electronic:{kick:{file:"resources/audiofiles/electronic/kick.wav",symbol:"x",amp:1.5,pitch:1,pan:0},snare:{file:"resources/audiofiles/electronic/snare.wav",symbol:"o",amp:1.5,pitch:1,pan:.15},hat:{file:"resources/audiofiles/electronic/hat.wav",symbol:"*",amp:1.5,pitch:1,pan:-.1},openHat:{file:"resources/audiofiles/electronic/openhat.wav",symbol:"-",amp:1.5,pitch:1,pan:-.2}},beatbox:{in_tss:{file:"resources/audiofiles/beatbox/^tss.wav",symbol:"T",amp:1,pitch:1,pan:.1},f:{file:"resources/audiofiles/beatbox/f.wav",symbol:"f",amp:1,pitch:1,pan:-.1},h:{file:"resources/audiofiles/beatbox/h.wav",symbol:"h",amp:1,pitch:1,pan:.1},s:{file:"resources/audiofiles/beatbox/s.wav",symbol:"s",amp:1,pitch:1,pan:-.1},d:{file:"resources/audiofiles/beatbox/d.wav",symbol:"d",amp:1,pitch:1,pan:.8},t:{file:"resources/audiofiles/beatbox/t.wav",symbol:"t",amp:1,pitch:1,pan:.4},k:{file:"resources/audiofiles/beatbox/k.wav",symbol:"k",amp:1,pitch:1,pan:-.1},in_k:{file:"resources/audiofiles/beatbox/^k.wav",symbol:"K",amp:1,pitch:1,pan:-.4},eight:{file:"resources/audiofiles/beatbox/8.wav",symbol:"8",amp:1,pitch:1,pan:-.8},psh:{file:"resources/audiofiles/beatbox/psh.wav",symbol:"p",amp:1,pitch:1,pan:.1},in_p:{file:"resources/audiofiles/beatbox/^p.wav",symbol:"P",amp:1,pitch:1,pan:-.1},pf:{file:"resources/audiofiles/beatbox/pf.wav",symbol:"F",amp:1,pitch:1,pan:.2},phs:{file:"resources/audiofiles/beatbox/phs.wav",symbol:"H",amp:1,pitch:1,pan:-.2},b:{file:"resources/audiofiles/beatbox/b.wav",symbol:"b",amp:1,pitch:1,pan:.3},dot:{file:"resources/audiofiles/beatbox/dot.wav",symbol:".",amp:1,pitch:1,pan:0},duf:{file:"resources/audiofiles/beatbox/duf.wav",symbol:"D",amp:1,pitch:1,pan:-.3},o:{file:"resources/audiofiles/beatbox/o.wav",symbol:"o",amp:1,pitch:1,pan:.6},a:{file:"resources/audiofiles/beatbox/a.wav",symbol:"a",amp:1,pitch:1,pan:.8},u:{file:"resources/audiofiles/beatbox/u.wav",symbol:"u",amp:1,pitch:1,pan:-.8},m:{file:"resources/audiofiles/beatbox/m.wav",symbol:"m",amp:1,pitch:1,pan:-.6},n:{file:"resources/audiofiles/beatbox/n.wav",symbol:"n",amp:1,pitch:1,pan:0}}},Percussion.Drums.kits.default=Percussion.Drums.kits.electronic,Percussion}},{"gibberish-dsp":1}],11:[function(e,t){t.exports=function(t){"use strict";for(var i={},n=e("gibberish-dsp"),r=t.dollar,o=(t.Clock,t.outputCurves),a=o.LINEAR,s=(o.LOGARITHMIC,["Line","AD","ADSR"]),l={Line:{start:{min:0,max:1,output:a,timescale:"audio"},end:{min:0,max:1,output:a,timescale:"audio"},time:{min:0,max:8,output:a,timescale:"audio"}},AD:{attack:{min:0,max:8,output:a,timescale:"audio"},decay:{min:0,max:8,output:a,timescale:"audio"},ADSR:{attack:{min:0,max:8,output:a,timescale:"audio"},decay:{min:0,max:8,output:a,timescale:"audio"},sustain:{min:0,max:8,output:a,timescale:"audio"},release:{min:0,max:8,output:a,timescale:"audio"}}}},c=0;c<s.length;c++)!function(){var e=Array.isArray(s[c])?s[c][0]:s[c],o=Array.isArray(s[c])?s[c][1]:s[c];i[o]=function(){var i,a=Array.prototype.slice.call(arguments,0);return i="object"!=typeof a[0]?new n[e](a[0],a[1],t.Clock.time(a[2]),a[3]):t.construct(n[e],a[0]),i.name=o,r.extend(!0,i,t.Audio.ugenTemplate),t.createProxyProperties(i,l[o]),t.processArguments2(i,a,i.name),("AD"===o||"ADSR"===o)&&t.createProxyMethods(i,["run"]),console.log(o+" is created."),i}}();return i}},{"gibberish-dsp":1}],12:[function(e,t){t.exports=function(t){"use strict";var i={Presets:{}},n=e("gibberish-dsp"),r=t.dollar,o=t.outputCurves,a=o.LINEAR,s=o.LOGARITHMIC;n.Gain=function(){n.extend(this,{name:"gain",type:"effect",properties:{input:0,amount:1},callback:function(e,t){return"object"==typeof e?(e[0]*=t,e[1]*=t):e*=t,e}}).init().processProperties(arguments)},n.Gain.prototype=n._effect;for(var l=["Reverb",["StereoReverb","StereoVerb"],"Delay","Flanger","Vibrato","Distortion","Biquad","Gain","Filter24",["RingModulation","RingMod"],["BufferShuffler","Schizo"],["Decimator","Crush"],"Tremolo"],c={Reverb:{roomSize:{min:.5,max:.995,output:a,timescale:"audio"},damping:{min:0,max:1,output:a,timescale:"audio"},out:{min:0,max:1,output:a,timescale:"audio",dimensions:1}},StereoReverb:{roomSize:{min:.5,max:.995,output:a,timescale:"audio"},damping:{min:0,max:1,output:a,timescale:"audio"},out:{min:0,max:1,output:a,timescale:"audio",dimensions:1}},Delay:{feedback:{min:0,max:1,output:a,timescale:"audio"},time:{min:50,max:88200,output:a,timescale:"audio"},out:{min:0,max:1,output:a,timescale:"audio",dimensions:1}},RingMod:{frequency:{min:20,max:3e3,output:a,timescale:"audio"},amp:{min:0,max:1,output:a,timescale:"audio"},mix:{min:0,max:1,output:a,timescale:"audio"},out:{min:0,max:1,output:a,timescale:"audio",dimensions:1}},Flanger:{rate:{min:.01,max:20,output:s,timescale:"audio"},feedback:{min:0,max:.99,output:a,timescale:"audio"},amount:{min:25,max:300,output:a,timescale:"audio"},out:{min:0,max:1,output:a,timescale:"audio",dimensions:1}},Gain:{amount:{min:0,max:1,output:a,timescale:"audio"}},Vibrato:{rate:{min:.2,max:8,output:s,timescale:"audio"},amount:{min:25,max:300,output:a,timescale:"audio"},feedback:{min:.45,max:.55,output:a,timescale:"audio"},out:{min:0,max:1,output:a,timescale:"audio",dimensions:1}},Filter24:{cutoff:{min:0,max:.7,output:a,timescale:"audio"},resonance:{min:0,max:5.5,output:a,timescale:"audio"},out:{min:0,max:1,output:a,timescale:"audio",dimensions:1}},LPF:{cutoff:{min:.05,max:.7,output:a,timescale:"audio"},resonance:{min:0,max:5.5,output:a,timescale:"audio"},out:{min:0,max:1,output:a,timescale:"audio",dimensions:1}},HPF:{cutoff:{min:0,max:.7,output:a,timescale:"audio"},resonance:{min:0,max:5.5,output:a,timescale:"audio"},out:{min:0,max:1,output:a,timescale:"audio",dimensions:1}},Crush:{bitDepth:{min:1,max:16,output:a,timescale:"audio"},sampleRate:{min:0,max:1,output:a,timescale:"audio"},amp:{min:0,max:1,output:s,timescale:"audio"},out:{min:0,max:1,output:a,timescale:"audio",dimensions:1}},Schizo:{amp:{min:0,max:1,output:s,timescale:"audio"},out:{min:0,max:1,output:a,timescale:"audio",dimensions:1}},Tremolo:{amp:{min:0,max:1,output:s,timescale:"audio"},frequency:{min:.05,max:20,output:s,timescale:"audio"},out:{min:0,max:1,output:a,timescale:"audio",dimensions:1}}},h=0;h<l.length;h++)!function(){var e=Array.isArray(l[h])?l[h][0]:l[h],o=Array.isArray(l[h])?l[h][1]:l[h];
i[o]=function(){var i,a=Array.prototype.slice.call(arguments,0);return i=new n[e],i.type="FX",i.name=o,r.extend(!0,i,t.Audio.ugenTemplate),t.createProxyProperties(i,c[o]),t.createProxyMethods(i,["send"]),t.processArguments2(i,a,i.name),a.input=0,i.toString=function(){return"> "+o},i}}();return i.Chorus=function(e,t,i){var n=e||1,r=i||ms(1),o=t||0,a=Flanger(n,o,r,30*ms(1));return a.name="Chorus",a.type="FX",a},i.LPF=function(e,t){var i=isNaN(e)?.2:e,n=isNaN(t)?3.5:t,r=Filter24(i,n,!0);return r.name="LPF",r.type="FX",r},i.HPF=function(e,t){var i=isNaN(e)?.25:e,n=isNaN(t)?3.5:t,r=Filter24(i,n,!0);return r.isLowPass=!1,r.name="HPF",r.type="FX",r},i.Presets.Schizo={sane:{chance:.1,reverseChance:0,pitchChance:.5,mix:.5},borderline:{chance:.1,pitchChance:.25,reverseChance:.5,mix:1},paranoid:{chance:.2,reverseChance:.5,pitchChance:.5,mix:1}},i.Presets.Reverb={space:{roomSize:.99,damping:.23,wet:.75,dry:.25},small:{roomSize:.6,damping:.75,wet:.15,dry:.85},medium:{roomSize:.8,damping:.5,wet:.35,dry:.65},large:{roomSize:.85,damping:.3,wet:.55,dry:.45}},i.Presets.StereoVerb={space:{roomSize:.99,damping:.23,wet:.75,dry:.25},small:{roomSize:.6,damping:.75,wet:.15,dry:.85},medium:{roomSize:.8,damping:.5,wet:.35,dry:.65},large:{roomSize:.85,damping:.3,wet:.55,dry:.45}},i.Presets.Crush={clean:{sampleRate:1,bitDepth:16},dirty:{sampleRate:.25,bitDepth:4},filthy:{sampleRate:.1,bitDepth:2.5}},i}},{"gibberish-dsp":1}],13:[function(e,t){t.exports=function(e){e.apiKey="4287s0onpqpp492n8snr27sp3o228nns".replace(/[a-zA-Z]/g,function(e){return String.fromCharCode(("Z">=e?90:122)>=(e=e.charCodeAt(0)+13)?e:e-26)});var t=function(){var i,n,r=Sampler(),o=arguments[0]||96541,a=null;r.done=function(e){a=e};var s=function(e){Gibber.log(i+" loaded."),Gibber.Audio.Core.context.decodeAudioData(e.response,function(e){t.loaded[i]=e.getChannelData(0),r.buffer=t.loaded[i],r.bufferLength=r.buffer.length,r.isLoaded=!0,r.end=r.bufferLength,r.setBuffer(r.buffer),r.setPhase(r.bufferLength),r.filename=i,r.send(Master,1),a&&a()},function(e){console.log("Error with decoding audio data"+e.err)})};if("string"==typeof o){var l=o;Gibber.log("searching freesound for "+l),e.search(l,0,"duration:[0.0 TO 10.0]","rating_desc",null,null,null,function(n){if(i=n.sounds[0].original_filename,"undefined"==typeof t.loaded[i]){var o=new XMLHttpRequest;Gibber.log("now downloading "+i+", "+n.sounds[0].duration+" seconds in length"),o.open("GET",n.sounds[0].serve+"?&api_key="+e.apiKey,!0),o.responseType="arraybuffer",o.onload=function(){s(o)},o.send()}else r.buffer=t.loaded[i],r.filename=i,r.bufferLength=r.buffer.length,r.isLoaded=!0,r.end=r.bufferLength,r.setBuffer(r.buffer),r.setPhase(r.bufferLength),r.send(Master,1),a&&a()},function(){displayError("Error while searching...")})}else if("object"==typeof o){var l=o.query,c=o.filter||"",h=o.sort||"rating_desc",u=o.page||0;pick=o.pick||0,Gibber.log("searching freesound for "+l),c+=" duration:[0.0 TO 10.0]",e.search(l,u,c,h,null,null,null,function(l){if(l.num_results>0){var c=0;"number"==typeof o.pick?c=o.pick:"function"==typeof o.pick?c=o.pick():"random"===o.pick&&(c=rndi(0,l.sounds.length)),i=l.sounds[c].original_filename,"undefined"==typeof t.loaded[i]?(n=new XMLHttpRequest,Gibber.log("now downloading "+i+", "+l.sounds[c].duration+" seconds in length"),n.open("GET",l.sounds[c].serve+"?&api_key="+e.apiKey,!0),n.responseType="arraybuffer",n.onload=function(){s(n)},n.send()):(Gibber.log("using exising loaded sample "+i),r.buffer=t.loaded[i],r.bufferLength=r.buffer.length,r.isLoaded=!0,r.end=r.bufferLength,r.setBuffer(r.buffer),r.setPhase(r.bufferLength),r.send(Master,1),a&&a())}else Gibber.log("No Freesound files matched your query.")},function(){console.log("Error while searching...")})}else"number"==typeof o&&(Gibber.log("downloading sound #"+o+" from freesound.org"),e.get_sound(o,function(t){n=new XMLHttpRequest,i=t.original_filename,n.open("GET",t.serve+"?api_key="+e.apiKey,!0),n.responseType="arraybuffer",n.onload=function(){s(n)},n.send()}));return r};return t.loaded={},t}},{}],14:[function(e,t){t.exports=function(t){"use strict";for(var i=t.dollar,n={Presets:{}},r=e("gibberish-dsp"),o=t.outputCurves,a=o.LINEAR,s=o.LOGARITHMIC,l=["Sine","Triangle","Saw","Square","Noise","PWM"],c={frequency:{min:50,max:3200,hardMin:.01,hardMax:22050,output:s,timescale:"audio",dimensions:1},amp:{min:0,max:1,hardMax:2,output:s,timescale:"audio",dimensions:1},pulsewidth:{min:.01,max:.99,output:a,timescale:"audio",dimensions:1},out:{min:0,max:1,output:a,timescale:"audio",dimensions:1},pan:{min:-1,max:1,output:s,timescale:"audio"},note:{min:50,max:3200,hardMin:.01,hardMax:22050,output:s,timescale:"audio",doNotProxy:!0}},h=0;h<l.length;h++)!function(){var e=Array.isArray(l[h])?l[h][0]:l[h],o=Array.isArray(l[h])?l[h][1]:l[h];n[o]=function(){var n=(new r[e]).connect(t.Master),a=Array.prototype.slice.call(arguments,0);n.type="Gen",i.extend(!0,n,t.Audio.ugenTemplate),n.fx.ugen=n,Object.defineProperty(n,"_",{get:function(){return n.kill(),n},set:function(){}}),"undefined"==typeof n.note&&(n.note=function(e){var t=this.frequency();"number"==typeof t||"function"==typeof t?this.frequency="function"==typeof e?e():e:t[0]=e}),n.name=o,t.createProxyProperties(n,c);var s=["note","send"];return"Sampler"===o&&s.push("pickBuffer"),t.createProxyMethods(n,s),t.processArguments2(n,a,o),n.toString=function(){return"> "+o},n}}();return n.Wavetable=function(e){var n=(new r.Table).connect(t.Master);return e&&n.setTable(e),n.type="Gen",i.extend(!0,n,t.Audio.ugenTemplate),n.fx.ugen=n,Object.defineProperty(n,"_",{get:function(){return n.kill(),n},set:function(){}}),"undefined"==typeof n.note&&(n.note=function(e){var t=this.frequency();"number"==typeof t||"function"==typeof t?this.frequency="function"==typeof e?e():e:t[0]=e}),t.createProxyProperties(n,{frequency:{min:50,max:3200,output:s,timescale:"audio",dimensions:1},amp:{min:0,max:1,output:s,timescale:"audio",dimensions:1},out:{min:0,max:1,output:a,timescale:"audio",dimensions:1}}),t.createProxyMethods(n,["note"]),obj.toString=function(){return"> Wavetable"},n},n.Grains=function(){var e,n="object"==typeof arguments[0]?arguments[0]:arguments[1],o=n.bufferLength||88200,a=Sampler().record(n.input,o);if("string"==typeof arguments[0]){var s=t.Presets.Grains[arguments[0]];"undefined"!=typeof n&&i.extend(s,n),e=new r.Granulator(s)}else e=new r.Granulator(n);return e.loop=function(e,i,n,o){var a=this.position;e=isNaN(e)?.25:e,i=isNaN(i)?.75:i,n=t.Clock.time(isNaN(n)?1:n),o="undefined"==typeof o?!0:o,this.position=new r.Line(e,i,n,o);var s=this;o===!1&&future(function(){s.position=a},t.Clock.time(n))},future(function(){e.setBuffer(a.getBuffer()),e.connect(),e.loop(0,1,o),a.disconnect()},o+1),e.type="Gen",i.extend(!0,e,t.Audio.ugenTemplate),e.fx.ugen=e,Object.defineProperty(e,"_",{get:function(){return e.disconnect(),e},set:function(){}}),e.toString=function(){return"Grains"},e},n.Presets.Grains={tight:{numberOfGrains:10,grainSize:1100,positionMin:-.05,positionMax:.05,speedMin:-.1,speedMax:.1,shouldReverse:!1},cloudy:{numberOfGrains:20,positionMin:-.25,positionMax:.25,speedMin:-.1,speedMax:4,grainSize:4400,shouldReverse:!0},flurry:{speed:2,speedMin:-2,speedMax:2,position:0,positionMin:0,positionMax:0,numberOfGrains:20,grainSize:1100}},n}},{"gibberish-dsp":1}],15:[function(e,t){t.exports=function(){"use strict";var t,i=e("gibberish-dsp"),n=null,r=null,o=null,a=t={Compressor:function(e){if(null===n){n=i.context.createDynamicsCompressor();var t=n.threshold,r=n.ratio,o=n.attack,s=n.release;Object.defineProperties(n,{threshold:{get:function(){return t.value},set:function(e){t.value=e}},ratio:{get:function(){return r.value},set:function(e){r.value=e}},attack:{get:function(){return o.value},set:function(e){o.value=e}},release:{get:function(){return s.value},set:function(e){s.value=e}}}),a.insert(n,e)}return n},LowShelf:function(e){if(null===o){o=i.context.createBiquadFilter(),o.type=3,o.frequency.value=220,o.Q.value=0,o.gain.value=6;var t=o.gain,n=o.frequency,r=o.Q;Object.defineProperties(o,{frequency:{get:function(){return n.value},set:function(e){n.value=e}},gain:{get:function(){return t.value},set:function(e){t.value=e}},Q:{get:function(){return r.value},set:function(e){r.value=e}}}),a.insert(o,e)}return o},HiShelf:function(e){if(null===r){r=i.context.createBiquadFilter(),r.type=4,r.frequency.value=880,r.Q.value=0,r.gain.value=6;var t=r.gain,n=r.frequency,o=r.Q;Object.defineProperties(r,{frequency:{get:function(){return n.value},set:function(e){n.value=e}},gain:{get:function(){return t.value},set:function(e){t.value=e}},Q:{get:function(){return o.value},set:function(e){o.value=e}}}),a.insert(r,e)}return r}};return t}},{"gibberish-dsp":1}],16:[function(e,t){t.exports=function(t){"use strict";var i={Presets:{}},n=e("gibberish-dsp"),r=t.dollar,o=e("./clock")(t),a=t.outputCurves,s=a.LINEAR,l=a.LOGARITHMIC,c={amp:{min:0,max:1,hardMax:2,output:l,timescale:"audio",dimensions:1},start:{min:0,max:1,output:s,timescale:"audio",dimensions:1},end:{min:0,max:1,output:s,timescale:"audio",dimensions:1},pitch:{min:1,max:4,hardMin:.01,hardMax:20,output:l,timescale:"audio"},out:{min:0,max:1,output:s,timescale:"audio",dimensions:1},pan:{min:-1,max:1,output:l,timescale:"audio"},note:{min:.1,max:4,output:l,timescale:"audio",doNotProxy:!0}};return i.Sampler=function(){var e=Array.prototype.slice.call(arguments,0),i=e[0]&&e[0].file?e[0].file:void 0,o=new n.Sampler(i).connect(t.Master);name="Sampler",o.type="Gen",r.extend(!0,o,t.Audio.ugenTemplate),o.fx.ugen=o,Object.defineProperty(o,"_",{get:function(){return o.kill(),o},set:function(){}}),"undefined"==typeof o.note&&(o.note=function(e){var t=this.frequency();"number"==typeof t||"function"==typeof t?this.frequency="object"==typeof e?e.value:e:t[0]=e});var a=o.__lookupSetter__("start").bind(o),s=0;Object.defineProperty(o,"start",{configurable:!0,get:function(){return s},set:function(e){return s=1>=e?e*o.bufferLength:e,a(s),s}});var l=o.__lookupSetter__("end").bind(o),h=1;Object.defineProperty(o,"end",{configurable:!0,get:function(){return h},set:function(e){return h=1>=e?e*o.bufferLength:e,l(h),h}}),t.createProxyProperties(o,c);var u=["note","pickBuffer"];return t.createProxyMethods(o,u),t.processArguments2(o,e,name),o.toString=function(){return name},o},n.Sampler.prototype.readFile=function(e){var t=this;if(e.isFile)return void e.file(function(e){t.readFile(e)});var i=new FileReader;i.readAsArrayBuffer(e),i.onload=function(){n.context.decodeAudioData(i.result,function(i){var r=i.getChannelData(0);t.setBuffer(r),t.length=t.end=r.length,t.buffers[e.name]=r,t.isPlaying=!0,console.log("LOADED",e.name,r.length),n.audioFiles[e.name]=r,t.onload&&t.onload(),0!==t.playOnLoad&&t.note(t.playOnLoad),t.isLoaded=!0})}},n.Sampler.prototype.ondrop=function(e){for(var t=0;t<e.length;t++)!function(i){{var n,r=e[t];new FileReader}if(n=r.webkitGetAsEntry(),n.isDirectory){var o=n.createReader();o.readEntries(function(e){for(var t=e.length;t--;)i.readFile(e[t])})}else i.readFile(n)}(this)},n.Sampler.prototype.pickBuffer=function(){this.switchBuffer(rndi(0,this.getNumberOfBuffers()))},n.Sampler.prototype.record=function(e,i){this.isRecording=!0,console.log("starting recording");var r=this;return this.recorder=new n.Record(e,t.Clock.time(i),function(){console.log("recording finished"),r.setBuffer(this.getBuffer()),r.length=r.end=r.getBuffer().length,r.setPhase(r.length),r.isRecording=!1}).record(),this},i.Looper=function(e,i,n){var a=Bus();r.extend(a,{children:[],input:e,length:o.time(i),numberOfLoops:n,pitch:1,currentLoop:0,loop:function(){a.children[a.currentLoop].record(a.input,a.length);var e={target:a.children[a.currentLoop],durations:a.length,key:"note",values:[null]};return a.seq.add(e),a.seq.start(),future(a.nextLoop,i),a},nextLoop:function(){a.children[++a.currentLoop].record(a.input,a.length),a.currentLoop<a.numberOfLoops-1&&future(a.nextLoop,i);var e={target:a.children[a.currentLoop],durations:a.length,key:"note",values:[null]};a.seq.add(e)}});var s=1;Object.defineProperty(a,"pitch",{configurable:!0,get:function(){return s},set:function(e){s=e;for(var t=0;t<a.children.length;t++)a.children[t].pitch=s}});for(var l=0;n>l;l++)a.children.push(Sampler({pitch:a.pitch})._),a.children[l].send(a,1);return t.createProxyProperties(a,{pitch:c.pitch}),a.stop=function(){a.seq.stop()},a.play=function(){a.seq.play()},a},i}},{"./clock":9,"gibberish-dsp":1}],17:[function(e,t){t.exports=function(t){var i=e("gibberish-dsp"),n=t.dollar,r=["durations","target","scale","offset","doNotStart","priority"],o=function(){var e,a={},s=[];if("object"!=typeof arguments[0]||Array.isArray(arguments[0]))("function"==typeof arguments[0]||Array.isArray(arguments[0]))&&(a.seqs=[{key:"functions",values:Array.isArray(arguments[0])?arguments[0]:[arguments[0]],durations:t.Clock.time(arguments[1])}],s.push("functions"));else{{var l=arguments[0];typeof l.durations,typeof l.target,l.priority}if(a.target=l.target,"object"==typeof l.scale&&(a.scale=l.scale),"number"==typeof l.offset&&(a.offset=t.Clock.time(l.offset)),a.durations=l.durations,a.keysAndValues={},a.seqs=[],a.autofire=[],a.durations){Array.isArray(a.durations)||(a.durations=[a.durations]);var c=t.construct(t.Pattern,a.durations);if(a.durations.randomFlag){c.filters.push(function(){var e=t.Utilities.rndi(0,c.values.length-1);return[c.values[e],1,e]});for(var h=0;h<a.durations.randomArgs.length;h+=2)c.repeat(a.durations.randomArgs[h],a.durations.randomArgs[h+1])}}for(var u in l)!function(){var e=u;if(-1===r.indexOf(e)){var i,n=Array.isArray(l[e]),o={key:e,target:a.target,durations:c};if(n?i=t.construct(t.Pattern,l[e]):"undefined"!=typeof l[e]&&(i=t.construct(t.Pattern,[l[e]])),l[e].randomFlag){i.filters.push(function(){var e=t.Utilities.rndi(0,i.values.length-1);return[i.values[e],1,e]});for(var h=0;h<l[e].randomArgs.length;h+=2)i.repeat(l[e].randomArgs[h],l[e].randomArgs[h+1])}"note"===e&&i.filters.push(function(){var e=arguments[0][0];return e<t.minNoteFrequency&&(e=a.scale?a.scale.notes[e]:t.scale.notes[e]),[e,arguments[0][1],arguments[0][2]]}),o.values=i,a.seqs.push(o),s.push(e)}}();if("scale"in a){var f=(s.indexOf("note"),s.indexOf("chord"));if(f>-1){var p=n.extend([],a.seqs[f]),d=0;a.seqs[f]=[function(){var e,t=[];return e="function"==typeof p.pick?p[p.pick()]:"function"==typeof p[d]?p[d]():p[d++],t=a.scale.chord(e),d>=p.length&&(d=0),t}]}}}e=new i.PolySeq(a),e.timeModifier=t.Clock.time.bind(t.Clock),e.name="Seq",e.save={},e.oldShuffle=e.shuffle,delete e.shuffle,e.rate=t.Clock;var m=e.__lookupSetter__("rate"),g=e.rate;Object.defineProperty(e,"rate",{get:function(){return g},set:function(i){g=Mul(t.Clock,i),m.call(e,g)}});var v=e.nextTime,y=e.__lookupSetter__("nextTime");Object.defineProperty(e,"nextTime",{get:function(){return v},set:function(e){v=t.Clock.time(e),y(v)}});var b=e.offset;Object.defineProperty(e,"offset",{get:function(){return b},set:function(t){b=t,e.nextTime+=b}}),e.nextTime+=e.offset;for(var h=0;h<s.length;h++)!function(e){var t=s[h],i=h;Object.defineProperty(e,t,{get:function(){return e.seqs[i].values},set:function(t){e.seqs[i].values=t}})}(e);var x=c;return Object.defineProperty(e,"durations",{get:function(){return x},set:function(t){x=t;for(var i=0;i<e.seqs.length;i++){var n=e.seqs[i];n.durations=x}}}),arguments[0]&&!arguments[0].doNotStart&&e.start(!0),e.toString=function(){return"> Seq"},e.gibber=!0,n.extend(e,{constructor:o,replaceWith:function(){this.kill()},kill:function(){this.target&&this.target.sequencers&&this.target.sequencers.splice(this.target.sequencers.indexOf(this),1),console.log("SEQ KILL",this),this.stop().disconnect()},applyScale:function(){},once:function(){return this.repeat(1),this},reset:function(){for(var e=0;e<this.seqs.length;e++)this.seqs[e].values[0].reset()},shuffle:function(){for(var e=0;e<this.seqs.length;e++)this.seqs[e].values[0].shuffle()}}),e},a=function(){var e,i=arguments[0];return i.root=i.root||"c4",i.mode=i.mode||"aeolian",e=t.Theory.Scale(i.root,i.mode),delete i.root,delete i.mode,i.scale=e,o(i)},s={Seq:o,ScaleSeq:a};return s}},{"gibberish-dsp":1}],18:[function(e,t){t.exports=function(t,i){var n,r=e("gibberish-dsp"),o=t.outputCurves,a=e("./theory")(t).Teoria,s=(o.LINEAR,o.LOGARITHMIC),l={amp:{min:0,max:1,hardMax:2,output:s,timescale:"audio",dimensions:1}},c=function(e,t){return e*Math.pow(2,t/1200)};n={piano:"acoustic_grand_piano",guitar:"electric_guitar_clean",bass:"acoustic_bass",organ:"rock_organ",brass:"synth_brass_1",strings:"synth_strings_1",choir:"choir_aahs"};var h=function(e){var i,o=h.path;return t.Environment&&t.Environment.Storage.values.soundfonts&&t.Environment.Storage.values.soundfonts[e]&&(o=t.Environment.Storage.values.soundfonts[e]),n[e]&&(e=n[e]),i=new r.SoundFont(arguments[0],o).connect(t.Master),$.extend(!0,i,t.Audio.ugenTemplate),i.fx.ugen=i,i.chord=t.Theory.chord,Object.defineProperty(i,"_",{get:function(){return i.kill(),i},set:function(){}}),i.onload=function(){if(t.Environment&&t.Environment.Storage.values.saveSoundFonts){if(t.Environment.Storage.values.soundfonts){if(t.Environment.Storage.values.soundfonts[e])return}else t.Environment.Storage.values.soundfonts={};t.Environment.Storage.values.soundfonts[e]=t.Audio.Core.SoundFont.storage[e];try{t.Environment.Storage.save()}catch(i){console.log("STORAGE ERROR",i),"QuotaExceededError"===i.name&&console.log("Your localStorage for Gibber has been exceeded; we can't save the soundfile. It is still usable.")}}},i._note=i.note.bind(i),i.note=function(e,n){if("number"==typeof e){if(e<t.minNoteFrequency){var r=this.scale||t.scale,o=r.notes[e];if(this.octave&&0!==this.octave)for(var s=this.octave>0?1:0,l=Math.abs(this.octave),h=0;l>h;h++)o*=s?2:.5;e=o}var u,f=a.frequency.note(e),p=0;if(1===f.note.accidental.value&&"b"!==f.note.accidental.sign)for(var d=f.note.enharmonics(),h=0;h<d.length;h++){var m=d[h];if("b"===m.accidental.sign){f.note=m;break}}p=f.cents,u=f.note.name.toUpperCase(),0!==f.note.accidental.value&&(u+=f.note.accidental.sign),u+=f.note.octave,e=u}i._note(e,isNaN(n)?1:n,c(1,p))},t.createProxyProperties(i,l),t.createProxyMethods(i,["note","chord","send"]),i};return h.path=i||"../../../resources/soundfonts/",h}},{"./theory":20,"gibberish-dsp":1}],19:[function(e,t){t.exports=function(t){"use strict";for(var i={Presets:{}},n=e("gibberish-dsp"),r=t.dollar,o=e("./clock")(t),a=t.outputCurves,s=a.LINEAR,l=a.LOGARITHMIC,c=[["PolySynth","Synth"],["PolyFM","FM"],["PolySynth2","Synth2"],["MonoSynth","Mono"],["PolyKarplusStrong","Pluck"]],h={Synth:{note:{min:50,max:3200,output:l,timescale:"audio",doNotProxy:!0},frequency:{min:50,max:3200,output:l,timescale:"audio"},amp:{min:0,max:1,output:l,timescale:"audio"},pulsewidth:{min:.01,max:.99,output:s,timescale:"audio"},attack:{min:o.maxMeasures+1,max:176400,output:s,timescale:"audio"},decay:{min:o.maxMeasures+1,max:176400,output:s,timescale:"audio"},sustain:{min:o.maxMeasures+1,max:176400,output:s,timescale:"audio"},release:{min:o.maxMeasures+1,max:176400,output:s,timescale:"audio"},pan:{min:-1,max:1,output:l,timescale:"audio"},sustainLevel:{min:.01,max:1,output:l,timescale:"audio"},out:{min:0,max:1,output:s,timescale:"audio",dimensions:1}},Synth2:{note:{min:50,max:3200,output:l,timescale:"audio",doNotProxy:!0},frequency:{min:50,max:3200,output:s,timescale:"audio"},amp:{min:0,max:1,output:l,timescale:"audio"},pulsewidth:{min:.01,max:.99,output:s,timescale:"audio"},attack:{min:o.maxMeasures+1,max:176400,output:s,timescale:"audio"},decay:{min:o.maxMeasures+1,max:176400,output:s,timescale:"audio"},sustain:{min:o.maxMeasures+1,max:176400,output:s,timescale:"audio"},release:{min:o.maxMeasures+1,max:176400,output:s,timescale:"audio"},sustainLevel:{min:.01,max:1,output:l,timescale:"audio"},cutoff:{min:0,max:.7,output:s,timescale:"audio"},resonance:{min:0,max:5.5,output:s,timescale:"audio"},pan:{min:-1,max:1,output:l,timescale:"audio"},out:{min:0,max:1,output:s,timescale:"audio",dimensions:1}},Mono:{note:{min:50,max:3200,output:l,timescale:"audio",doNotProxy:!0},frequency:{min:50,max:3200,output:s,timescale:"audio"},amp:{min:0,max:1,output:l,timescale:"audio"},pulsewidth:{min:.01,max:.99,output:s,timescale:"audio"},attack:{min:o.maxMeasures+1,max:176400,output:l,timescale:"audio"},decay:{min:o.maxMeasures+1,max:176400,output:l,timescale:"audio"},cutoff:{min:0,max:.7,output:s,timescale:"audio"},detune2:{min:0,max:.15,output:s,timescale:"audio"},detune3:{min:0,max:.15,output:s,timescale:"audio"},glide:{min:.99,max:.999995,output:s,timescale:"audio"},resonance:{min:0,max:5.5,output:s,timescale:"audio"},pan:{min:-1,max:1,output:l,timescale:"audio"},out:{min:0,max:1,output:s,timescale:"audio",dimensions:1}},FM:{note:{min:50,max:3200,output:l,timescale:"audio",doNotProxy:!0},frequency:{min:50,max:3200,output:s,timescale:"audio"},amp:{min:0,max:1,output:l,timescale:"audio"},attack:{min:o.maxMeasures+1,max:176400,output:s,timescale:"audio"},decay:{min:o.maxMeasures+1,max:176400,output:s,timescale:"audio"},sustain:{min:o.maxMeasures+1,max:176400,output:s,timescale:"audio"},release:{min:o.maxMeasures+1,max:176400,output:s,timescale:"audio"},sustainLevel:{min:.01,max:1,output:l,timescale:"audio"},cmRatio:{min:.1,max:50,output:s,timescale:"audio"},index:{min:.1,max:50,output:s,timescale:"audio"},pan:{min:-1,max:1,output:l,timescale:"audio"},out:{min:0,max:1,output:s,timescale:"audio",dimensions:1}},Pluck:{note:{min:50,max:3200,output:l,timescale:"audio",doNotProxy:!0},frequency:{min:50,max:3200,output:s,timescale:"audio"},amp:{min:0,max:1,output:l,timescale:"audio"},blend:{min:0,max:1,output:s,timescale:"audio"},damping:{min:0,max:1,output:s,timescale:"audio"},pan:{min:-1,max:1,output:l,timescale:"audio"},out:{min:0,max:1,output:s,timescale:"audio",dimensions:1}}},u=0;u<c.length;u++)!function(){var e=Array.isArray(c[u])?c[u][0]:c[u],o=Array.isArray(c[u])?c[u][1]:c[u];i[o]=function(){var i,a,s=Array.prototype.slice.call(arguments),l=1,c=!1,u=!1;if("object"==typeof s[0]&&("undefined"!=typeof s[0].maxVoices&&s[0].maxVoices&&(l=s[0].maxVoices),"undefined"!=typeof s[0].useADSR?(c=s[0].useADSR,"undefined"!=typeof s[0].requireReleaseTrigger&&(u=s[0].requireReleaseTrigger)):u=!1,"undefined"!=typeof s[0].useADSR&&(c=s[0].useADSR),"undefined"!=typeof s[0].scale&&(a=s[0].scale)),i=new n[e]({maxVoices:l,useADSR:c,requireReleaseTrigger:u,scale:a}).connect(t.Master),i.type="Gen",r.extend(!0,i,t.Audio.ugenTemplate),i.fx.ugen=i,"Vocoder"===o)return i;if("Mono"===o&&(i.note=function(e,t){"undefined"!=typeof t&&0!==t&&(this.amp=t),0!==t&&("object"!=typeof this.frequency?this.frequency=e:"property"!==this.frequency.type?(this.frequency[0]=e,n.dirty(this)):this.frequency=e,i.envelope.getState()>0&&i.envelope.run())}),i._note=i.note.bind(i),i.note=function(){var e=Array.prototype.splice.call(arguments,0);if("string"==typeof e[0])e[0]=t.Theory.Teoria.note(e[0]).fq();else if(e[0]<t.minNoteFrequency){var n=i.scale||t.scale,r=n.notes[e[0]];if(i.octave&&0!==i.octave)for(var o=i.octave>0?1:0,a=Math.abs(i.octave),s=0;a>s;s++)r*=o?2:.5;e[0]=r}return this._note.apply(this,e),this},i.chord=t.Theory.chord,Object.defineProperty(i,"_",{get:function(){return i.kill(),i},set:function(){}}),t.createProxyProperties(i,h[o]),t.createProxyMethods(i,["note","chord","send"]),i.name=o,t.processArguments2(i,s,i.name),i.toString=function(){return o},"Mono"!==o){var f=i._frequency;Object.defineProperty(i,"frequency",{configurable:!0,get:function(){return this._frequency},set:function(e){if(f=e,this.children)for(var t=0;t<this.children.length;t++)"number"==typeof this.children[t].frequency?this.children[t].frequency=f:this.children[t].frequency[0]=f}})}var p=i.scale;return i.scale&&(i.seq.scale=p),Object.defineProperty(i,"scale",{get:function(){return p},set:function(e){p=e,i.seq.scale=p}}),i}}();return i.Presets.Synth={"short":{attack:44,decay:1/16},bleep:{waveform:"Sine",attack:44,decay:1/16},cascade:{waveform:"Sine",maxVoices:10,attack:o.maxMeasures,decay:o.beats(1/32),presetInit:function(){this.fx.add(t.Audio.FX.Delay(1/9,.2),t.Audio.FX.Flanger()),this.pan=Sine(.25,1)._}},rhodes:{waveform:"Sine",maxVoices:4,attack:44,decay:1,presetInit:function(){this.fx.add(t.Audio.FX.Tremolo(2,.2))}},calvin:{waveform:"PWM",maxVoices:4,amp:.075,attack:o.maxMeasures,decay:.25,presetInit:function(){this.fx.add(t.Audio.FX.Delay(1/6,.5),t.Audio.FX.Vibrato())}},warble:{waveform:"Sine",attack:o.maxMeasures,presetInit:function(){this.fx.add(t.Audio.FX.Vibrato(2),t.Audio.FX.Delay(1/6,.75))}}},i.Presets.Synth2={pad2:{waveform:"Saw",maxVoices:4,attack:1.5,decay:.5,cutoff:.3,filterMult:.35,resonance:4.5,amp:.2,presetInit:function(){this.fx.add(t.Audio.FX.Delay(1/9,.75))}},pad4:{waveform:"Saw",maxVoices:4,attack:2,decay:2,cutoff:.3,filterMult:.35,resonance:4.5,amp:.2,presetInit:function(){this.fx.add(t.Audio.FX.Delay(1/9,.75))}}},i.Presets.Mono={"short":{attack:44,decay:1/16},lead:{presetInit:function(){this.fx.add(t.Audio.FX.Delay(.25,.35),t.Audio.FX.Reverb())},attack:1/8,decay:.5,octave3:0,cutoff:.2,filterMult:.5,resonance:5,isLowPass:!1},winsome:{presetInit:function(){this.lfo=t.Audio.Oscillators.Sine(.234375)._,this.lfo.amp=.075,this.lfo.frequency=2,this.cutoff=this.lfo,this.detune2=this.lfo},attack:o.maxMeasures,decay:1,cutoff:.2},bass:{attack:o.maxMeasures,decay:1/8-o.maxMeasures,octave:-2,octave2:-1,cutoff:.5,filterMult:.2,resonance:1},bass2:{attack:o.maxMeasures,decay:1/6,octave:-2,octave2:0,octave3:0,cutoff:.5,filterMult:.2,resonance:1,amp:.65},easy:{attack:o.maxMeasures,decay:2,octave2:0,octave3:0,cutoff:.3,glide:.9995},easyfx:{attack:o.maxMeasures,decay:2,presetInit:function(){this.fx.add(t.Audio.FX.Delay(o.time(1/6),.3))},amp:.3,octave2:0,octave3:0,cutoff:.3,glide:.9995},dark:{resonance:0,attack:44,cutoff:.075,amp:.35,filterMult:0},dark2:{filterMult:.1,attack:o.maxMeasures,octave2:0,octave3:0,decay:.25,amp:.45},noise:{resonance:20,decay:.5,cutoff:.3,glide:.99995,detune3:0,detune2:0,filterMult:0,presetInit:function(){this.fx.add(t.Audio.FX.Gain(.1),t.Audio.FX.Delay(1/6,.35))}}},i.Presets.FM={stabs:{maxVoices:4,cmRatio:1/1.0007,index:5,attack:o.maxMeasures,decay:1/8,amp:.1,presetInit:function(){this.bus=t.Audio.Busses.Bus().fx.add(t.Audio.FX.Delay(1/8,.75),t.Audio.FX.LPF({resonance:4})),this.bus.fx[1].cutoff=t.Audio.Core.Binops.Add(.25,t.Audio.Oscillators.Sine(.1,.2)._),this.send(this.bus,.65)}},bass:{cmRatio:1,index:3,presetInit:function(){this.attack=ms(1)},decay:1/16,octave:-2},glockenspiel:{cmRatio:3.5307,index:1,attack:44,decay:44100},radio:{cmRatio:1,index:40,attack:13230,decay:22050},noise:{cmRatio:.04,index:1e3,attack:44.1,decay:4410},frog:{cmRatio:.1,index:2,attack:13230,decay:220.5},gong:{cmRatio:1.4,index:.95,attack:44.1,decay:220500},drum:{cmRatio:1.40007,index:2,attack:44,decay:44100},drum2:{cmRatio:1+Math.sqrt(2),index:.2,attack:44,decay:882},brass:{maxVoices:4,cmRatio:1/1.0007,index:5,attack:4100,decay:1},clarinet:{cmRatio:1.5,index:1.5,attack:2205,decay:8820}},i}},{"./clock":9,"gibberish-dsp":1}],20:[function(e,t){t.exports=function(t){"use strict";var i=e("../../external/teoria.min"),n=t.dollar,r={Teoria:i,Scale:function(e,o){var a={root:"string"==typeof e?i.note(e):e,notes:[],degree:1,chord:function(e,t){var i=[];t=t||0;for(var n=0;n<e.length;n++)i.push(this.notes[e[n]+t]);return i},create:function(){var e="number"!=typeof l?i.note(l).fq():l,n=s;if(this.notes.length=0,t.Theory.Scales[n]){var r=t.Theory.Scales[n](e);r.create(e),this.notes=r.notes}else console.log("No scale for the mode "+s+" exists.")},set:function(e,t){Array.isArray(arguments[0])?(this.root=arguments[0][0],this.mode=arguments[0][1]):(this.root=e,this.mode=t)}},s=o||"aeolian";Object.defineProperty(a,"mode",{configurable:!0,get:function(){return s},set:function(e){s=e,a.create()}});var l=e||440;return Object.defineProperty(a,"root",{get:function(){return l},set:function(e){"number"==typeof e?l=e:"string"==typeof e?l=r.Teoria.note(e).fq():"object"==typeof e&&(l=e.accidental?e.fq():r.Teoria.note(e.value).fq()),a.create()}}),a.gibber=!0,t.createProxyProperty(a,"root",!0,!1,null,!1,1),t.createProxyProperty(a,"mode",!0,!1,null,!1,1),n.subscribe("/gibber/clear",function(){a.seq.isConnected=!1,a.seq.isRunning=!1,a.seq.destinations.length=0}),a.create(l),a},CustomScale:function(e,t){var n={notes:[],degree:1,ratios:t||[1,1.1,1.25,1.3333,1.5,1.666,1.75],create:function(e){this.notes=[];for(var t="number"==typeof e?e:i.note(e).fq(),n=0;8>n;n++){for(var r=0;r<this.ratios.length;r++){var o=r,a=t*(1+Math.floor(o/this.ratios.length));this.notes.push(a*this.ratios[o%this.ratios.length])}t*=2}t="number"==typeof e?e:i.note(e).fq();for(var n=-1;n>=-8;n--){t/=2;for(var r=0;r<this.ratios.length;r++){var s=n*this.ratios.length+r,o=r,a=t*(1+Math.floor(o/this.ratios.length));this.notes[s]=a*this.ratios[o%this.ratios.length]}}},chord:function(e,t){var i=[];t=t||0;for(var n=0;n<e.length;n++)i.push(this.notes[e[n]+t]);return i}};return n.create(e),n},Scales:{Major:function(e){return r.CustomScale(e,[1,9/8,5/4,4/3,1.5,5/3,15/8])},Ionian:function(e){return r.CustomScale(e,[1,9/8,5/4,4/3,1.5,5/3,15/8])},Dorian:function(e){return r.CustomScale(e,[1,9/8,1.2,4/3,1.5,5/3,1.8])},Phrygian:function(e){return r.CustomScale(e,[1,16/15,1.2,4/3,1.5,1.6,1.8])},Lydian:function(e){return r.CustomScale(e,[1,9/8,5/4,45/32,1.5,5/3,15/8])},Mixolydian:function(e){return r.CustomScale(e,[1,9/8,5/4,4/3,1.5,1.6,1.8])},Minor:function(e){return r.CustomScale(e,[1,9/8,1.2,4/3,1.5,1.6,1.8])},Aeolian:function(e){return r.CustomScale(e,[1,9/8,1.2,4/3,1.5,1.6,1.8])},Locrian:function(e){return r.CustomScale(e,[1,16/15,1.2,4/3,62/45,1.6,15/8])},MajorPentatonic:function(e){return r.CustomScale(e,[1,9/8,5/4,1.5,5/3])},MinorPentatonic:function(e){return r.CustomScale(e,[1,1.2,4/3,1.5,15/8])},Chromatic:function(e){return r.CustomScale(e,[1,16/15,9/8,1.2,5/4,4/3,45/32,1.5,1.6,5/3,7/4,15/8])},HalfWhole:function(e){return r.CustomScale(e,[1,1.059463,1.189207,1.259921,1.414214,1.498307,1.681793,1.781797])},WholeHalf:function(e){return r.CustomScale(e,[1,1.122462,1.189207,1.33484,1.414214,1.587401,1.681793,1.887749])},Pythagorean:function(e){return r.CustomScale(e,[1,256/243,9/8,32/27,81/64,4/3,729/512,1.5,128/81,27/16,16/9,243/128])},PythagoreanMajor:function(e){return r.CustomScale(e,[1,9/8,81/64,4/3,1.5,27/16,243/128])},PythagoreanMinor:function(e){return r.CustomScale(e,[1,9/8,32/27,4/3,1.5,128/81,16/9])},Limit5:function(e){return r.CustomScale(e,[1,16/15,9/8,1.2,5/4,4/3,45/32,1.5,1.6,5/3,1.8,15/8])},Limit5Major:function(e){return r.CustomScale(e,[1,9/8,5/4,4/3,1.5,5/3,15/8])},Limit5Minor:function(e){return r.CustomScale(e,[1,9/8,1.2,4/3,1.5,1.6,1.8])},Mess3:function(e){return r.CustomScale(e,[1,1.122462,1.189207,1.259921,1.414214,1.498307,1.587401,1.781797,1.887749])},Mess4:function(e){return r.CustomScale(e,[1,1.059463,1.122462,1.33484,1.414214,1.498307,1.587401,1.887749])},Mess5:function(e){return r.CustomScale(e,[1,1.059463,1.33484,1.414214,1.498307,1.887749])},Mess6:function(e){return r.CustomScale(e,[1,1.122462,1.259921,1.33484,1.414214,1.587401,1.781797,1.887749])},Mess7:function(e){return r.CustomScale(e,[1,1.059463,1.122462,1.189207,1.33484,1.414214,1.498307,1.587401,1.681793,1.887749])},Adams:function(e){return r.CustomScale(e,[1,1.122462,1.259921,1.414214,1.498307,1.681793,1.781797])},Equal5Tone:function(e){return r.CustomScale(e,[1,1.15,1.32,1.35,1.52,1.74])},Equal7Tone:function(e){return r.CustomScale(e,[1,1.1,1.22,1.35,1.49,1.64,1.81])},Just:function(e){return r.CustomScale(e,[1,1.0417,1.125,1.2,1.25,1.3333,1.4063,1.5,1.6,1.6667,1.8,1.875])},Shruti:function(e){return r.CustomScale(e,[1,256/243,16/15,10/9,9/8,32/27,1.2,5/4,81/64,4/3,1.35,45/32,729/512,1.5,128/81,1.6,5/3,27/16,16/9,1.8,15/8,243/128,2])}},chord:function(e){if(this.notation=e,"string"==typeof this.notation){var t,n,o=this.notation.slice(0,1);isNaN(this.notation.charAt(1))?(o+=this.notation.charAt(1),t=parseInt(this.notation.slice(2,3)),n=this.notation.slice(3)):(t=parseInt(this.notation.slice(1,2)),n=this.notation.slice(2));for(var a=i.note(o+t).chord(n),s=0;s<a.notes.length;s++){var l=a.notes[s];this.note("number"==typeof h?h:l.fq())}}else for(var c=0;c<this.notation.length;c++){var h,u=this.scale?this.scale.notes[this.notation[c]]:this.notation[c];
switch(typeof u){case"number":h=u;break;case"object":h=u.fq?u.fq():u;break;case"string":h=r.Teoria.note(u).fq()}this.note(h)}return"undefined"!=typeof arguments[1]&&(this.amp=arguments[1]),this}};return r}},{"../../external/teoria.min":3}],21:[function(e,t){t.exports=function(t){"use strict";var i={Presets:{}},n=e("gibberish-dsp"),r=t.dollar,o=(e("./clock")(t),t.outputCurves),a=o.LINEAR,s=o.LOGARITHMIC,l={amp:{min:0,max:1,output:s,timescale:"audio"},pan:{min:-1,max:1,output:s,timescale:"audio"},out:{min:0,max:1,output:a,timescale:"audio",dimensions:1}};return i.Vocoder=function(e,i,o,a,s,l){var c=new n.Vocoder(e,i,o,a,s,l).connect(t.Master);return c.type="Gen",r.extend(!0,c,t.Audio.ugenTemplate),c.fx.ugen=c,c},i.Robot=function(e){function i(){n.modulator=Speak(o),n.modulator._,n.say=n.modulator.say.bind(n),t.defineSequencedProperty(n,"say"),c&&(n.say.values=a,n.say.durations=s),n.connect()}var n,o=e||{};n=t.Audio.Vocoder.Vocoder(null,null,o.numBands||16),n.disconnect(),isNaN(o.maxVoices)&&(o.maxVoices=1),isNaN(o.resonance)&&(o.resonance=4),isNaN(o.attack)&&(o.attack=ms(1)),isNaN(o.decay)&&(o.decay=measures(8)),isNaN(o.pulsewidth)&&(o.pulsewidth=.05),n.carrier=t.Audio.Synths.Synth2(o),n.note=n.carrier.note.bind(n),n._note=n.carrier._note.bind(n),n.chord=n.carrier.chord.bind(n),n.carrier._;var a,s,c=!1;return n.say=function(e,t){c===!1&&(a=e,s=t,c=!0)},t.Modules["gibber/publications/SpeakLib"]?i():t.import("gibber/publications/SpeakLib").done(function(){var e=setInterval(function(){"undefined"!=typeof Speak&&(i(),clearInterval(e))},250)}),t.defineSequencedProperty(n,"say"),console.log(0),t.defineSequencedProperty(n,"chord"),console.log(1),t.defineSequencedProperty(n,"note"),console.log(2),r.extend(!0,n,t.Audio.ugenTemplate),t.createProxyProperties(n,l),n},i}},{"./clock":9,"gibberish-dsp":1}],22:[function(e,t){t.exports=function(t){var i={"export":function(e){e.MIDI=this.MIDI},MIDI:e("./midi.js")(t)};return i}},{"./midi.js":23}],23:[function(e,t){t.exports=function(e){var t={_midi:null,inputs:[],outputs:[],seq:null,clock:function(i,n){var r=0,o=0,a=(e.Audio.Core.context,window.performance.now(),{output:t.outputs[i],channel:n||0,properties:{rate:e.Clock},name:"midi_clock",callback:function(e){var t=s/e/24;if(o++,r++>=t){r-=t,a.output.send([248])}return 0}}),s=22050;return a.__proto__=new e.Audio.Core.ugen,a.__proto__.init.call(a),a.connect(),t.Clock=a,a},readClock:function(e){this.clockMaster=e},init:function(){var n=this;return navigator.requestMIDIAccess().then(function(r){console.log("MIDI access granted.",r),n._midi=r;for(var o=n._midi.inputs.entries(),a=0,s=null,l={min:0,max:127,output:e.outputCurves.LINEAR,timescale:"interface"};null===s||o.done===!1;)!function(){t.inputs[a++]=s=o.next().value[1],Object.defineProperty(n,i,{get:function(){return s},set:function(){}}),s.onmidimessage=t.parse,s.defaultChannel=0,Object.defineProperties(s,{cc:{get:function(){return s.channel[s.defaultChannel].cc},set:function(){}},target:{get:function(){return s.channel[s.defaultChannel].target},set:function(e){s.channel[s.defaultChannel].target=e}}}),s.channel=[];for(var r=0;16>r;r++){s.channel[r]={target:null,cc:[]};for(var c=0;127>c;c++)s.channel[r].cc[c]={value:0,type:"mapping"},e.createProxyProperties(s.channel[r].cc[c],{value:l},!0,!0)}}();for(var c=null,h=n._midi.outputs.entries(),a=0;null===c||h.done===!1;)t.outputs[a++]=c=h.next().value[1],!function(){var t=c;c.channel=[];for(var i=0;16>i;i++)!function(){var n=i;c.channel[i]={cc:[],note:function(e){var i=e[0],r="undefined"==typeof e[1]?127:e[1];"function"==typeof i&&(i=i()),"function"==typeof r&&(r=r()),t.send([144+n,i,r])}},e.defineSequencedProperty(c.channel[i],"note",!1);for(var r=0;127>r;r++)c.channel[i].cc[r]={value:0,type:"mapping"},e.createProxyProperties(c.channel[i].cc[r],{value:l},!0,!0)}()}()}.bind(this),function(){console.log("failed to initialize midi")}.bind(this)),this},channels:[],types:{8:"noteoff",9:"noteon",11:"cc",12:"programchange"},ntof:function(e){return 261.626*Math.pow(2,(e-49)/12)},log:!1,onmessage:null,showInputs:function(){for(var e=0;e<t._midi.inputs.length;e++){var i=t[e];console.log("Input port "+e+" |  manufacturer:"+i.manufacturer+", name: "+i.name)}},clockMaster:null,clockHistory:[],clockIndex:0,clockAvg:0,lastReceivedTime:0,clockBufferSize:12,clockReceived:function(i,n){if(this.clockMaster===i&&this.clockIsRunning){if(0===this.lastReceivedTime)return void(this.lastReceivedTime=n.receivedTime);var r=n.receivedTime-this.lastReceivedTime;this.clockAvg+=r,this.lastReceivedTime=n.receivedTime,this.clockAvg-=this.clockHistory[this.clockIndex]||0,this.clockHistory[this.clockIndex]=r,this.clockIndex=(this.clockIndex+1)%this.clockBufferSize;var o=this.clockAvg/this.clockHistory.length,a=24*o,s=1/(2*a/1e3);e.Clock.rate=t.clockRate=s}},clockRate:1,clockIsRunning:!1,onstartmessage:function(i){this.clockMaster===i&&(console.log("MIDI CLOCK START"),e.Clock.currentBeat=1,e.Clock.phase=0,e.Clock.rate=t.clockRate,this.clockHistory.length=0,this.lastReceivedTime=0,this.clockIndex=0,this.clockAvg=0,this.clockIsRunning=!0)},oncontinuemessage:function(e){console.log("CONTINUE"),this.clockMaster===e&&console.log("MC CONTINUE")},onstopmessage:function(t){console.log("MC END"),this.clockMaster===t&&(console.log("MIDI CLOCK END"),e.Clock.rate=0,this.clockIsRunning=!1)},onsppmessage:function(e,i){this.clockMaster===e&&0===i.data[1]&&0===i.data[2]&&t.onstartmessage(e)},processIncomingClock:function(e,i){var n=!0;switch(e.data[0]){case 242:t.onsppmessage(i,e),n=!1,console.log(e.data[0],e.data[1],e.data[2]);break;case 248:t.clockReceived(i,e);break;case 250:t.onstartmessage(i);break;case 251:t.oncontinuemessage(i);break;case 252:t.onstopmessage(i);break;default:n=!1}return n},parse:function(e){var i=t.inputs.indexOf(e.target),n=t.processIncomingClock(e,i);if(!n){var r=t.types[Math.floor(e.data[0]/16)],o=e.data[0]%16,a=e.data[1],s="undefined"!=typeof e.data[2]?e.data[2]:0;switch(t.log&&log(r,o,a,s,i),r){case"noteon":t.inputs[i].channel[o].target&&t.inputs[i].channel[o].target.note(t.ntof(a),s/127);break;case"noteoff":t.inputs[i].channel[o].target&&t.inputs[i].channel[o].target.note(t.ntof(a),0);break;case"cc":t.inputs[i].channel[o].cc[a].value(s)}t.onmessage&&t.onmessage(i,r,o,a,s),t.inputs[i].onmessage&&t[i.onmessage(r,o,a,s)]}}};return t}},{}],24:[function(e,t){(function(e){!function(){"use strict";function i(e,t,n){for(var r in t)n&&(h(t[r])||l(t[r]))?(h(t[r])&&!h(e[r])&&(e[r]={}),l(t[r])&&!l(e[r])&&(e[r]=[]),i(e[r],t[r],n)):void 0!==t[r]&&(e[r]=t[r])}var n="function"==typeof Zepto,r="function"==typeof jQuery,o="object"==typeof e.$||"function"==typeof e.$,a=null,s=n||r||o,l=Array.isArray,c=function(e){return"object"==typeof e},h=function(e){return c(e)&&Object.getPrototypeOf(e)==Object.prototype};a=s?r?jQuery:n?Zepto:o?e.$:{}:{},s||(a.extend=function(e){var t,n=Array.prototype.slice.call(arguments,1);return"boolean"==typeof e&&(t=e,e=n.shift()),n.forEach(function(n){i(e,n,t)}),e},a.isArray=Array.isArray,a.isPlainObject=h,a.type=function(e){return typeof e});var u={};a.subscribe=function(e,t){"undefined"==typeof u[e]&&(u[e]=[]),u[e].push(t)},a.unsubscribe=function(e,t){if("undefined"!=typeof u[e]){var i=u[e];i.splice(i.indexOf(t),1)}},a.publish=function(e,t){if("undefined"!=typeof u[e])for(var i=u[e],n=0;n<i.length;n++)i[n](t)},t.exports=a}()}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],25:[function(_dereq_,module,exports){!function(){var $=_dereq_("./dollar"),Gibber={dollar:$,Presets:{},scale:null,minNoteFrequency:50,started:!1,outputCurves:{LINEAR:0,LOGARITHMIC:1},Pattern:_dereq_("./pattern"),"export":function(e){Gibber.Utilities.export(e),e.Pattern=Gibber.Pattern,Gibber.Audio&&Gibber.Audio.export(e),Gibber.Graphics&&Gibber.Graphics.export(e),Gibber.Interface&&Gibber.Interface.export(e),Gibber.Communication&&Gibber.Communication.export(e)},init:function(e){"undefined"==typeof window?(window=GLOBAL,document=GLOBAL.document=!1):"undefined"!=typeof GLOBAL&&(GLOBAL.document||(document=GLOBAL.document=!1));var t={globalize:!0,canvas:null,target:window,graphicsMode:"3d"};if("object"==typeof e&&$.extend(t,e),Gibber.Audio)if(Gibber.Audio.init(),t.globalize)t.target.Master=Gibber.Audio.Master;else{var i=Gibber.export.bind(Gibber);$.extend(Gibber,Gibber.Audio),Gibber.export=i}Gibber.Graphics,Gibber.Interface,t.globalize&&Gibber.export(t.target),t.target.$=$,Gibber.Utilities.init()},Modules:{},"import":function(e,t){var i=null;if(console.log("Loading module "+e+"..."),-1===e.indexOf("http:"))console.log("loading via post",e),$.post(Gibber.Environment.SERVER_URL+"/gibber/"+e,{},function(n){n=JSON.parse(n);var r=new Function("return "+n.text);return Gibber.Modules[e]=r(),t&&Gibber.Modules[e]&&$.extend(t,Gibber.Modules[e]),Gibber.Modules[e]?("function"==typeof Gibber.Modules[e].init&&Gibber.Modules[e].init(),"object"==typeof Gibber.Modules[e]&&(Gibber.Modules[e].moduleText=n.text),console.log("Module "+e+" is now loaded.")):console.log("Publication "+e+" is loaded. It may not be a valid module."),null!==i&&i(Gibber.Modules[e]),!1});else{var n=document.createElement("script");n.src=e,n.onload=function(){console.log("Module "+e+" is now loaded."),null!==i&&i()},document.head.appendChild(n)}return{done:function(e){i=e}}},scriptCallbacks:[],run:function(script,pos,cm){var _start=pos.start?pos.start.line:pos.line,tree;try{tree=Gibber.Esprima.parse(script,{loc:!0,range:!0})}catch(e){return void console.error("Parse error on line "+(_start+e.lineNumber)+" : "+e.message.split(":")[1])}for(var __i__=0;__i__<tree.body.length;__i__++){var obj=tree.body[__i__],start={line:_start+obj.loc.start.line-1,ch:obj.loc.start.column},end={line:_start+obj.loc.end.line-1,ch:obj.loc.end.column},src=cm.getRange(start,end),result=null;try{result=eval(src),log("function"!=typeof result?result:"Function")}catch(e){console.error("Error evaluating expression beginning on line "+(start.line+1)+"\n"+e.message)}if(this.scriptCallbacks.length>0)for(var ___i___=0;___i___<this.scriptCallbacks.length;___i___++)this.scriptCallbacks[___i___](obj,cm,pos,start,end,src,_start)}},processArguments:function(e,t){var i;return e.length?"string"==typeof e[0]&&"Drums"!==t&&"XOX"!==t?(i=Gibber.getPreset(e[0],t),"object"==typeof e[1]&&$.extend(i,e[1]),i):Array.prototype.slice.call(e,0):i},processArguments2:function(e,t,i){if(t.length){var n=t[0];if("string"==typeof n&&"Drums"!==i&&"XOX"!==i&&"Shader"!==i)preset=Gibber.getPreset(t[0],i),"object"==typeof t[1]&&$.extend(preset,t[1]),$.extend(e,preset),e.presetInit&&e.presetInit();else if($.isPlainObject(n)&&"undefined"==typeof n.type)$.extend(e,n);else{var r=Object.keys(e.properties);if("FX"===e.type)for(var o=0;o<t.length;o++)e[r[o+1]]=t[o];else for(var o=0;o<t.length;o++)e[r[o]]=t[o]}}},getPreset:function(e,t){var i={};return Gibber.Presets[t]&&Gibber.Presets[t][e]?i=Gibber.Presets[t][e]:Gibber.log(t+" does not have a preset named "+e+"."),i},clear:function(){var e=Array.prototype.slice.call(arguments,0);Gibber.Audio&&Gibber.Audio.clear.apply(Gibber.Audio,e),Gibber.Graphics&&Gibber.Graphics.clear(Gibber.Graphics,e),Gibber.proxy(window,[a]),$.publish("/gibber/clear",{}),console.log("Gibber has been cleared.")},proxy:function(e){for(var t="abcdefghijklmnopqrstuvwxyz",i=0;i<t.length;i++){var n=t.charAt(i);"undefined"!=typeof window[n]&&-1===arguments[1].indexOf(window[n])&&(delete window[n],delete window["___"+n]),function(){var t=n;Object.defineProperty(e,t,{configurable:!0,get:function(){return e["___"+t]},set:function(i){if(i)e["___"+t]&&"function"==typeof e["___"+t].replaceWith&&(e["___"+t].replaceWith(i),console.log(e["___"+t].name+" was replaced with "+i.name)),e["___"+t]=i;else if(e["___"+t]){var n=e["___"+t];n&&"function"==typeof n.kill&&n.kill()}}})}()}},construct:function(e,t){function i(){return e.apply(this,t)}return i.prototype=e.prototype,new i},createMappingObject:function(e,t){var i="function"==typeof e.min?e.min():e.min,n="function"==typeof e.max?e.max():e.max,r="function"==typeof t.min?t.min():t.min,o="function"==typeof t.max?t.max():t.max;if("undefined"==typeof t.object&&t.Value&&(t=t.Value),"undefined"!=typeof e.object[e.Name].mapping)return void e.object[e.Name].mapping.replace(t.object,t.propertyName,t.Name);"undefined"!=typeof t.targets&&-1===t.targets.indexOf(e)&&t.targets.push([e,e.Name]);var a="Out"!==t.Name?t.timescale:"audioOut";return mapping=Gibber.mappings[e.timescale][a](e,t),Object.defineProperties(e.object[e.Name],{min:{configurable:!0,get:function(){return i},set:function(t){i=t,e.object[e.Name].mapping.outputMin=i}},max:{configurable:!0,get:function(){return n},set:function(t){n=t,e.object[e.Name].mapping.outputMax=n}}}),e.object[e.Name].mappingObjects=[],Gibber.createProxyProperty(e.object[e.Name],"min",1,0,{min:i,max:n,output:e.output,timescale:e.timescale,dimensions:1}),Gibber.createProxyProperty(e.object[e.Name],"max",1,0,{min:i,max:n,output:e.output,timescale:e.timescale,dimensions:1}),Object.defineProperties(t.object[t.Name],{min:{configurable:!0,get:function(){return r},set:function(t){r=t,e.object[e.Name].mapping.inputMin=r}},max:{configurable:!0,get:function(){return o},set:function(t){o=t,e.object[e.Name].mapping.inputMax=o}}}),e.object[e.Name].invert=function(){e.object[e.Name].mapping.invert()},"undefined"==typeof e.object.mappings&&(e.object.mappings=[]),e.object.mappings.push(mapping),"undefined"==typeof t.object.mappings&&(t.object.mappings=[]),t.object.mappings.push(mapping),Gibber.defineSequencedProperty(e.object[e.Name],"invert"),mapping},defineSequencedProperty:function(e,t,i){var n,r,o=e[t];!e.seq&&Gibber.Audio&&(e.seq=Gibber.Audio.Seqs.Seq({doNotStart:!0,scale:e.scale,priority:i,target:e})),o.seq=function(a,s){var l=$.isArray(a)?a:[a],c=$.isArray(s)?s:"undefined"!=typeof s?[s]:null,h={key:t,values:[Gibber.construct(Gibber.Pattern,l)],durations:null!==c?[Gibber.construct(Gibber.Pattern,c)]:null,target:e,priority:i};"undefined"!=typeof n&&(n.shouldStop=!0,e.seq.seqs.splice(r,1));var u=h.values[0];if(l.randomFlag){u.filters.push(function(){var e=Gibber.Utilities.rndi(0,u.values.length-1);return[u.values[e],1,e]});for(var f=0;f<l.randomArgs.length;f+=2)u.repeat(l.randomArgs[f],l.randomArgs[f+1])}if(null!==c){var p=h.durations[0];if(c.randomFlag){p.filters.push(function(){var e=Gibber.Utilities.rndi(0,p.values.length-1);return[p.values[e],1,e]});for(var f=0;f<c.randomArgs.length;f+=2)p.repeat(c.randomArgs[f],c.randomArgs[f+1])}}return e.seq.add(h),r=null!==c?e.seq.seqs.length-1:e.seq.autofire.length-1,n=null!==c?e.seq.seqs[r]:e.seq.autofire[r],Object.defineProperties(o,{values:{configurable:!0,get:function(){return null!==c?e.seq.seqs[r].values[0]:e.seq.autofire[r].values[0]},set:function(t){var i=Gibber.construct(Gibber.Pattern,t);Array.isArray(i)||(i=[i]),null!==c?e.seq.seqs[r].values=i:e.seq.autofire[r].values=i}},durations:{configurable:!0,get:function(){return null!==c?e.seq.seqs[r].durations[0]:null},set:function(t){Array.isArray(t)||(t=[t]),e.seq.seqs[r].durations=t}}}),e.seq.isRunning||(e.seq.offset=Gibber.Clock.time(e.offset),e.seq.start(!0,i)),e},o.seq.stop=function(){n.shouldStop=!0},o.seq.start=function(){n.shouldStop=!1,e.seq.timeline[0]=[n],e.seq.nextTime=0,e.seq.isRunning||e.seq.start(!1,i)}},defineRampedProperty:function(e,t){var i,n=e[t],r=t.slice(1);n.ramp=function(t,n,o){return arguments.length<2?void console.err("ramp requires at least two arguments: target and time."):("undefined"==typeof o&&(o=n,n=t,t=e[r]()),i&&i(),"object"!=typeof t?e[r]=Line(t,n,o):t.retrigger(n,Gibber.Clock.time(o)),i=future(function(){e[r]=n},o),e)}},createProxyMethods:function(e,t,i){for(var n=0;n<t.length;n++)Gibber.defineSequencedProperty(e,t[n],i)},defineProperty:function(e,t,i,n,r,o,a){var s="object"==typeof e[t]?e[t].valueOf():e[t],l=t.charAt(0).toUpperCase()+t.slice(1),c=function(i){var n=c;return"undefined"!=typeof i&&(c.oldSetter?c.oldSetter.call(e,i):e[t]=i,n=e),n};r=o?r||e.mappingProperties[t]:null,$.extend(c,r),$.extend(c,{propertyName:t,Name:l,value:s,type:"property",object:e,targets:[],valueOf:function(){return c.value},toString:function(){var e="";return e="object"==typeof c.value?c.value.toString():c.value},oldSetter:e.__lookupSetter__(t),oldGetter:e.__lookupGetter__(t),oldMappingObjectGetter:e.__lookupGetter__(l),oldMappingObjectSetter:e.__lookupSetter__(l)}),Object.defineProperty(e,t,{configurable:!0,get:function(){return c},set:function(t){if("function"!=typeof t&&("object"!=typeof t||"mapping"!==t.type)||"property"!==t.type&&"mapping"!==t.type){o&&e[c.Name]&&"undefined"!=typeof e[c.Name].mapping&&e[c.Name].mapping.remove&&e[c.Name].mapping.remove(!0);var i=t;if(c.oldSetter){var n=c.oldSetter.call(e,t);"undefined"!=typeof n&&(i=n)}c.value=i}else Gibber.createMappingObject(c,t);return e}}),i&&Gibber.defineSequencedProperty(e,t,a),n&&Gibber.defineRampedProperty(e,t),o&&Object.defineProperty(e,c.Name,{configurable:!0,get:function(){return"function"==typeof c.oldMappingObjectGetter&&c.oldMappingObjectGetter(),c},set:function(t){e[c.Name]=t,"function"==typeof mapping.oldMappingObjectSetter&&mapping.oldMappingObjectSetter(t)}})},createProxyProperty:function(e,t,i,n,r,o,a){o=o===!1?!1:!0,Gibber.defineProperty(e,t,i,n,r,o,a)},createProxyProperties:function(e,t,i,n){var r="undefined"==typeof i?!0:i,o="undefined"==typeof n?!0:n;e.gibber=!0,e.mappingProperties=t,e.mappingObjects=[];for(var a in t)t[a].doNotProxy||Gibber.createProxyProperty(e,a,r,o,t[a])}};Gibber.Utilities=_dereq_("./utilities")(Gibber),Gibber.mappings=_dereq_("./mappings")(Gibber),module.exports=Gibber}()},{"./dollar":24,"./mappings":26,"./pattern":27,"./utilities":28}],26:[function(e,t){t.exports=function(e){var t={audio:{graphics:function(t,i){"undefined"==typeof i.object.track&&(i.object.track={});var n,r="undefined"!=typeof i.object.track[i.propertyName]?i.object.track[i.propertyName]:new e.Audio.Core.Proxy2(i.object,i.propertyName),o=new e.Audio.Core.OnePole({a0:.005,b1:.995});return i.object.track=r,n=t.object[t.Name].mapping=e.Audio.Core.Binops.Map(r,t.min,t.max,i.min,i.max,t.output,i.wrap),o.input=n,t.object[t.propertyName]=o,n.proxy=r,n.op=o,n.remove=function(e){e||(t.object[t.propertyName]=t.object[t.Name].mapping.getValue()),delete t.object[t.Name].mapping},n},"interface":function(t,i){var n,r="undefined"!=typeof i.track?i.track:new e.Audio.Core.Proxy2(i.object,i.propertyName),o=new e.Audio.Core.OnePole({a0:.005,b1:.995}),a=t.max-t.min,s=(t.object[t.propertyName]-t.min)/a,l=i.min+(i.max-i.min)*s;if(i.object.setValue&&i.object.setValue(l),i.track=r,n=t.object[t.Name].mapping=e.Audio.Core.Binops.Map(r,t.min,t.max,i.min,i.max,t.output,i.wrap),o.input=n,t.object[t.propertyName]=o,n.proxy=r,n.op=o,n.remove=function(e){e||(t.object[t.propertyName]=n.getValue()),delete n},"undefined"!=typeof i.object.label){for(var c="",h=0;h<i.targets.length;h++){var u=i.targets[h];c+=u[0].object.name+"."+u[1],h!==i.targets.length-1&&(c+=" & ")}i.object.label=c}return n.replace=function(e,i,n){r.setInput(e),-1===e[n].targets.indexOf(t)&&e[n].targets.push([t,t.Name])},n},audio:function(t,i){var n,r;return"undefined"!=typeof i.object.track?(n=i.object.track,n.count++):(n=new e.Audio.Core.Proxy2(i.object,i.propertyName),n.count=1),i.object.track=n,t.object[t.propertyName]=e.Audio.Core.Binops.Map(n,t.min,t.max,i.min,i.max),r=t.object[t.Name].mapping=t.object[t.propertyName],r.remove=function(e){e||(t.object[t.propertyName]=r.getValue()),r.op&&r.op.remove(),delete t.object[t.Name].mapping},r.replace=function(i,n,o){var a=new e.Audio.Core.Proxy2(i,n);r.input=a,i[o].targets&&-1===i[o].targets.indexOf(t)&&i[o].targets.push([t,t.Name])},r},audioOut:function(t,i){var n;n=e.Audio.Core.Binops.Map(null,t.min,t.max,0,1,0),t.object[t.propertyName]=t.object[t.Name].mapping=n,"undefined"!=typeof i.object.track?(n.follow=i.object.track,n.follow.count++):(n.follow=new e.Audio.Analysis.Follow({input:i.object,useAbsoluteValue:!0}),n.follow.count=1),i.object.track=n.input=n.follow,n.remove=function(e){e||(t.object[t.propertyName]=t.object[t.Name].mapping.getValue()),n.bus&&n.bus.disconnect(),n.follow&&(n.follow.count--,0===n.follow.count&&(delete i.object.track,n.follow.remove())),delete t.object[t.Name].mapping},n.replace=function(e,i,r){n.follow.input=e,-1===e[r].targets.indexOf(t)&&e[r].targets.push([t,t.Name])};var r=n.follow.bufferSize;return Object.defineProperty(t.object[t.Name],"env",{configurable:!0,get:function(){return r},set:function(t){r=e.Clock.time(t),n.follow.bufferSize=r}}),n}},graphics:{graphics:function(t,i){var n,r=e.Audio.Core.Binops.Map(i.object[i.propertyName],t.min,t.max,i.min,i.max,t.output,i.wrap),o=r.getValue.bind(r);return r.getValue=function(){return r.callback(i.object[i.propertyName],t.min,t.max,i.min,i.max,t.output,i.wrap),o()},n=t.object[t.Name].mapping=r,t.object.mod?t.object.mod(t.propertyName,n,"="):t.modObject.mod(t.modName,n,"="),n.remove=function(){t.object.mod?t.object.removeMod(t.propertyName):t.modObject.removeMod(t.modName),t.object[t.propertyName]=t.object[t.Name].mapping.getValue(),delete t.object[t.Name].mapping},n.replace=function(e){n.input=e},n},"interface":function(t,i){var n,r=e.Audio.Core.Binops.Map(i.object[i.propertyName],t.min,t.max,i.min,i.max,t.output,i.wrap);"undefined"==typeof i.object.functions&&(i.object.functions={},i.object.onvaluechange=function(){for(var e in i.object.functions)i.object.functions[e]()}),n=t.object[t.Name].mapping=r,t.mapping.from=i;var o=t.propertyName+" <- "+i.object.propertyName+"."+i.Name;if(i.object.functions[o]=function(){var e=n.callback(i.object[i.propertyName],t.min,t.max,i.min,i.max,t.output,i.wrap);t.object[t.Name].oldSetter.call(t.object[t.Name],e)},n.replace=function(){},n.remove=function(){console.log("mapping removed"),delete i.object.functions[o]},i.object.setValue&&i.object.setValue(t.object[t.propertyName]),"undefined"!=typeof i.object.label){for(var a="",s=0;s<i.targets.length;s++){var l=i.targets[s];a+=l[0].object.propertyName+"."+l[1],s!==i.targets.length-1&&(a+=" & ")}i.object.label=a}return n},audio:function(t,i){var n;n=t.object[t.Name].mapping=e.Audio.Core.Binops.Map(null,t.min,t.max,i.min,i.max,t.output,i.wrap),n.follow="undefined"!=typeof i.object.track?i.object.track:new e.Audio.Core.Follow({input:i.object[i.propertyName],useAbsoluteValue:!1}),i.object.track=t.object[t.Name].mapping.follow,n.input=n.follow,n.bus=new e.Audio.Core.Bus2({amp:0}).connect(),n.connect(n.bus),n.replace=function(e,i,r){n.follow.input=e,-1===e[r].targets.indexOf(t)&&e[r].targets.push([t,t.Name])};var r=n.follow.bufferSize;return Object.defineProperty(t.object[t.Name],"env",{get:function(){return r},set:function(t){r=e.Clock.time(t),n.follow.bufferSize=r}}),t.object.mod?t.object.mod(t.propertyName,n,"="):t.modObject.mod(t.modName,n,"="),n.remove=function(){this.bus.disconnect(),this.follow&&(this.follow.count--,0===this.follow.count&&(delete i.object.track,this.follow.remove())),t.object.mod?t.object.removeMod(t.propertyName):t.modObject.removeMod(t.modName),delete t.object[t.Name].mapping},n},audioOut:function(i,n){if("undefined"!=typeof i.object[i.Name].mapping)return r.replace(n.object,n.propertyName,n.Name),r;var r=i.object[i.Name].mapping=e.Audio.Core.Binops.Map(null,i.min,i.max,0,1,0);"undefined"!=typeof n.object.track?(r.follow=n.object.track,r.follow.count++):(r.follow=new e.Audio.Core.Follow({input:n.object}),r.follow.count=1),n.object.track=r.follow;var o=r.follow.bufferSize;return Object.defineProperty(i.object[i.Name],"env",{configurable:!0,get:function(){return o},set:function(t){o=e.Clock.time(t),r.follow.bufferSize=o}}),r.input=r.follow,r.bus=new e.Audio.Core.Bus2({amp:0}).connect(),r.connect(r.bus),r.replace=function(t,o,a){if(t[a].timescale===n.timescale){var s=r.follow.input[n.Name].targets.indexOf(i);s>=-1&&r.follow.input[n.Name].targets.splice(s,1),r.follow.input=t,-1===t[a].targets.indexOf(i)&&t[a].targets.push([i,i.Name])}else r.bus.disconnect(),r.follow.remove(),e.createMappingObject(i,t)},i.object.mod?i.object.mod(i.propertyName,r,"="):i.modObject?i.modObject.mod(i.modName,r,"="):!function(){var e=r;i.object.update=function(){i.object[i.propertyName](e.getValue())}}(),r.remove=function(){this.bus.disconnect(),this.follow&&(this.follow.count--,0===this.follow.count&&(delete n.object.track,this.follow.remove())),i.object.mod?i.object.removeMod(i.propertyName):i.modObject&&i.modObject.removeMod(i.modName),i.object.mappings.splice(i.object.mappings.indexOf(r),1),n.object.mappings.splice(n.object.mappings.indexOf(r),1);var e=i.object[i.Name].targets,o=e.indexOf(t);-1!==o&&e.splice(o,1),delete i.object[i.Name].mapping},r}},notation:{graphics:function(t,i){var n,r=e.Audio.Core.Binops.Map(i.object[i.propertyName],t.min,t.max,i.min,i.max,t.output,i.wrap),o=r.getValue.bind(r);return r.getValue=function(){return r.callback(i.object[i.propertyName],t.min,t.max,i.min,i.max,t.output,i.wrap),o()},n=t.object[t.Name].mapping=r,t.object.mod?t.object.mod(t.propertyName,n,"="):t.modObject.mod(t.modName,n,"="),n.remove=function(){t.object.mod?t.object.removeMod(t.propertyName):t.modObject.removeMod(t.modName),t.object[t.propertyName]=t.object[t.Name].mapping.getValue(),delete t.object[t.Name].mapping},n.replace=function(e){n.input=e},n},"interface":function(t,i){var n,r=e.Audio.Core.Binops.Map(i.object[i.propertyName],t.min,t.max,i.min,i.max,t.output,i.wrap);"undefined"==typeof i.object.functions&&(i.object.functions={},i.object.onvaluechange=function(){for(var e in i.object.functions)i.object.functions[e]()}),n=t.object[t.Name].mapping=r,t.mapping.from=i;var o=t.propertyName+" <- "+i.object.propertyName+"."+i.Name;if(i.object.functions[o]=function(){var e=n.callback(i.object[i.propertyName],t.min,t.max,i.min,i.max,t.output,i.wrap);t.object[t.Name].oldSetter.call(t.object[t.Name],e)},n.replace=function(){},n.remove=function(){console.log("mapping removed"),delete i.object.functions[o]},i.object.setValue&&i.object.setValue(t.object[t.propertyName]),"undefined"!=typeof i.object.label){for(var a="",s=0;s<i.targets.length;s++){var l=i.targets[s];a+=l[0].object.propertyName+"."+l[1],s!==i.targets.length-1&&(a+=" & ")}i.object.label=a}return n},audio:function(t,i){var n;n=t.object[t.Name].mapping=e.Audio.Core.Binops.Map(null,t.min,t.max,i.min,i.max,t.output,i.wrap),"undefined"!=typeof i.object.track&&i.object.track.input===i.object.properties[i.propertyName]?(n.follow=i.object.track,n.follow.count++):(n.follow=new e.Audio.Core.Follow({input:i.object.properties[i.propertyName],useAbsoluteValue:!1}),n.follow.count=1),i.object.track=t.object[t.Name].mapping.follow,n.input=n.follow,n.bus=new e.Audio.Core.Bus2({amp:0}).connect(),n.connect(n.bus),n.replace=function(e,i,r){n.follow.input=e,-1===e[r].targets.indexOf(t)&&e[r].targets.push([t,t.Name])};var r=n.follow.bufferSize;return Object.defineProperty(t.object[t.Name],"env",{get:function(){return r},set:function(t){r=e.Clock.time(t),n.follow.bufferSize=r}}),n.update=function(){t.object[t.propertyName](n.getValue())},n.text=t.object,e.Environment.Notation.add(n),n.remove=function(){this.bus.disconnect(),this.follow&&(this.follow.count--,0===this.follow.count&&(delete i.object.track,this.follow.remove())),e.Environment.Notation.remove(n),delete t.object[t.Name].mapping},n},audioOut:function(t,i){if("undefined"!=typeof t.object[t.Name].mapping)return n.replace(i.object,i.propertyName,i.Name),n;var n=t.object[t.Name].mapping=e.Audio.Core.Binops.Map(null,t.min,t.max,0,1,0);"undefined"!=typeof i.object.track&&i.object.track.input===i.object.properties[i.propertyName]?(n.follow=i.object.track,n.follow.count++):(n.follow=new e.Audio.Core.Follow({input:i.object,useAbsoluteValue:!0}),n.follow.count=1),i.object.track=n.follow;var r=n.follow.bufferSize;return Object.defineProperty(t.object[t.Name],"env",{configurable:!0,get:function(){return r},set:function(t){r=e.Clock.time(t),n.follow.bufferSize=r}}),n.input=n.follow,n.bus=new e.Audio.Core.Bus2({amp:0}).connect(),n.connect(n.bus),n.replace=function(r,o,a){if(r[a].timescale===i.timescale){var s=n.follow.input[i.Name].targets.indexOf(t);s>=-1&&n.follow.input[i.Name].targets.splice(s,1),n.follow.input=r,-1===r[a].targets.indexOf(t)&&r[a].targets.push([t,t.Name])}else n.bus.disconnect(),n.follow.remove(),e.createMappingObject(t,r)},n.update=function(){t.object[t.propertyName](n.getValue())},n.text=t.object,e.Environment.Notation.add(n),n.remove=function(){this.bus.disconnect(),this.follow&&(this.follow.count--,0===this.follow.count&&(delete i.object.track,this.follow.remove())),e.Environment.Notation.remove(n),delete t.object[t.Name].mapping},n}}};return t},t.exports.outputCurves={LINEAR:0,LOGARITHMIC:1}},{}],27:[function(e,t){!function(){"use strict";var e={concat:function(e){this.values=this.values.concat(e.values)},toString:function(){return this.values.toString()},valueOf:function(){return this.values},getLength:function(){var e;return e=this.start<=this.end?this.end-this.start+1:this.values.length+this.end-this.start+1},runFilters:function(e,t){for(var i=[e,1,t],n=0;n<this.filters.length;n++)i=this.filters[n](i);return i},_onchange:function(){}},i=function(){if(!(this instanceof i)){var e=Array.prototype.slice.call(arguments,0);return Gibber.construct(i,e)}var t=function(){var e,i,n,r=t.getLength();return e=1===r?0:Math.floor(t.phase>-1?t.start+t.phase%r:t.end+t.phase%r),i=t.values[Math.floor(e%t.values.length)],n=t.runFilters(i,e),t.phase+=t.stepSize*n[1],i=n[0],"function"==typeof i&&(i=i()),t.update&&(t.update.value=i),i};return $.extend(t,{start:0,end:0,phase:0,values:Array.prototype.slice.call(arguments,0),original:null,storage:[],stepSize:1,integersOnly:!1,repeats:[],filters:[],onchange:null,range:function(){return Array.isArray(arguments[0])?(t.start=arguments[0][0],t.end=arguments[0][1]):(t.start=arguments[0],t.end=arguments[1]),t},reverse:function(){var e,i=t.values,n=null,r=null,o=i.length;for(n=0,r=o-1;r>n;n+=1,r-=1)e=i[n],i[n]=i[r],i[r]=e;return t._onchange(),t},repeat:function(){for(var e={},i=0;i<arguments.length;i+=2)e[arguments[i]]={phase:0,target:arguments[i+1]};var n=!1,r=null,o=function(t){var i=t[0],o=(t[1],t);return n===!1&&e[i]&&(n=!0,r=i),n===!0&&(e[r].phase!==e[r].target?(o[0]=r,o[1]=0,e[r].phase++):(e[r].phase=0,o[1]=1,i!==r?n=!1:e[r].phase++)),o};return t.filters.push(o),t},reset:function(){return t.values=t.original.slice(0),t._onchange(),t},store:function(){return t.storage[t.storage.length]=t.values.slice(0),t},transpose:function(e){for(var i=0;i<t.values.length;i++)t.values[i]+=e;return t._onchange(),t},shuffle:function(){return Gibber.Utilities.shuffle(t.values),t._onchange(),t},scale:function(e){for(var i=0;i<t.values.length;i++)t.values[i]=t.integersOnly?Math.round(t.values[i]*e):t.values[i]*e;return t._onchange(),t},flip:function(){var e=[],i=null;i=t.values.filter(function(t){var i=-1===e.indexOf(t);return i&&e.push(t),i}),i=i.sort(function(e,t){return e-t});for(var n=0;n<t.values.length;n++){var r=i.indexOf(t.values[n]);t.values[n]=i[i.length-r-1]}return t._onchange(),t},invert:function(){for(var e=t.values[0],i=1;i<t.values.length;i++){var n=e+(e-t.values[i]);t.values[i]=n}return t._onchange(),t},"switch":function(e){return t.storage[e]&&(t.values=t.storage[e].slice(0)),t._onchange(),t},rotate:function(e){if(e>0)for(;e>0;){var i=t.values.pop();t.values.unshift(i),e--}else if(0>e)for(;0>e;){var n=t.values.shift();t.values.push(n),e++}return t._onchange(),t}}),t.retrograde=t.reverse.bind(t),t.end=t.values.length-1,t.original=t.values.slice(0),t.storage[0]=t.original.slice(0),t.integersOnly=t.values.every(function(e){return e===+e&&e===(0|e)}),Gibber.createProxyMethods(t,["rotate","switch","invert","reset","flip","transpose","reverse","shuffle","scale","store","range"],!0),Gibber.createProxyProperties(t,{stepSize:0,start:0,end:0}),t.__proto__=this.__proto__,t};i.prototype=e,t.exports=i}()},{}],28:[function(e,t){t.exports=function(e){"use strict";var t=[],i=!1,n=(e.dollar,e.Audio?e.Audio.Core:null,e.Clock,Math.random,{seq:function(){var e=arguments[0],t=typeof e,i=null;return"object"===t&&Array.isArray(e)&&(t="array"),i},random:function(){return this.randomFlag=!0,this.randomArgs=Array.prototype.slice.call(arguments,0),this
},random2:function(){for(var e={},t=null,i=this,r=0;r<arguments.length;r+=2)e[""+arguments[r]]={repeat:arguments[r+1],count:0};return this.pick=function(){var r,o,a=0;return i[t]&&(o=i[t]),null!==t&&e[o].count++<=e[o].repeat?(r=t,e[o].count>=e[o].repeat&&(e[o].count=0,t=null)):(r=n.rndi(0,i.length-1),a=i[r],"undefined"!=typeof e[""+a]?(e[""+a].count=1,t=r):t=null),i[r]},this.pick},choose:function(e){var t=null;if(isNaN(e)&&(e=1),1!==e){for(var i=[],r=0;e>r;r++)i[r]=this[n.rndi(0,this.length-1)];t=i}else t=this[n.rndi(0,this.length-1)];return t},future:function(t,i){var n=0,r=e.Audio.Seqs.Seq(function(){1===n&&(t(),r.stop(),r.disconnect()),n++},e.Audio.Clock.time(i));return function(){r.stop(),r.disconnect()}},shuffle:function(e){for(var t,i,n=e.length;n;t=parseInt(Math.random()*n),i=e[--n],e[n]=e[t],e[t]=i);},solo:function(e){var r=Array.prototype.slice.call(arguments,0);if(e){i&&n.solo();for(var o=0;o<r.length;o++){var a=r[o];a.fx.length>0&&(r[o]=a.fx[a.fx.length-1])}for(var s=0;s<Master.inputs.length;s++){var l=r.indexOf(Master.inputs[s].value),c=Master.inputs[s].value,h=c.name;-1===l&&"polyseq"!==h&&"Seq"!==h&&(Master.inputs[s]._amp=Master.inputs[s].amp,Master.inputs[s].amp=0,t.push(Master.inputs[s]))}i=!0}else{for(var s=0;s<t.length;s++)t[s].amp=t[s]._amp;t.length=0,i=!1}},fill:function(e,t){isNaN(e)&&(e=16),"function"!=typeof t&&(t=Rndf()),t=t.bind(this);for(var i=0;e>i;i++)this[i]=t();return this},merge:function(){for(var e=[],t=0;t<this.length;t++){var i=this[t];if(Array.isArray(i))for(var n=0;n<i.length;n++)e.push(i[n]);else e.push(i)}return e},weight:function(){var e=Array.prototype.slice.call(arguments,0);return this.pick=function(){for(var t=this[0],i=0,r=n.rndf(),o=0;o<e.length;o++)if(i+=e[o],i>r){t=o;break}return t},this},gibberArray:function(){},rndf:function(e,t,i,r){if(r="undefined"==typeof r?!0:r,"undefined"==typeof i&&"object"!=typeof e){1==arguments.length?(t=arguments[0],e=0):2==arguments.length?(e=arguments[0],t=arguments[1]):(e=0,t=1);var o=t-e,a=Math.random(),s=o*a;return e+s}var l=[],c=[];"undefined"==typeof i&&(i=t||e.length);for(var h=0;i>h;h++){var u;if("object"==typeof arguments[0])u=arguments[0][rndi(0,arguments[0].length-1)];else if(r)u=n.rndf(e,t);else{for(u=n.rndf(e,t);c.indexOf(u)>-1;)u=n.rndf(e,t);c.push(u)}l.push(u)}return l},Rndf:function(){{var e,t,i,r;Math.random}return 0===arguments.length?(e=0,t=1):1===arguments.length?(t=arguments[0],e=0):2===arguments.length?(e=arguments[0],t=arguments[1]):3===arguments.length?(e=arguments[0],t=arguments[1],i=arguments[2]):(e=arguments[0],t=arguments[1],i=arguments[2],r=arguments[3]),function(){var o,a,s;return a="function"==typeof e?e():e,s="function"==typeof t?t():t,o="undefined"==typeof i?n.rndf(a,s):n.rndf(a,s,i,r)}},rndi:function(e,t,i,r){var o;if(0===arguments.length?(e=0,t=1):1===arguments.length?(t=arguments[0],e=0):2===arguments.length?(e=arguments[0],t=arguments[1]):(e=arguments[0],t=arguments[1],i=arguments[2],r=arguments[3]),o=t-e,i>o&&(r=!0),"undefined"==typeof i)return o=t-e,Math.round(e+Math.random()*o);for(var a=[],s=[],l=0;i>l;l++){var c;if(r)c=n.rndi(e,t);else{for(c=n.rndi(e,t);s.indexOf(c)>-1;)c=n.rndi(e,t);s.push(c)}a.push(c)}return a},Rndi:function(){{var e,t,i,r,o;Math.random,Math.round}return 0===arguments.length?(e=0,t=1):1===arguments.length?(t=arguments[0],e=0):2===arguments.length?(e=arguments[0],t=arguments[1]):3===arguments.length?(e=arguments[0],t=arguments[1],i=arguments[2]):(e=arguments[0],t=arguments[1],i=arguments[2],r=arguments[3]),o=t-e,"number"==typeof i&&i>o&&(r=!0),function(){var o,a,s;return a="function"==typeof e?e():e,s="function"==typeof t?t():t,o="undefined"==typeof i?n.rndi(a,s):n.rndi(a,s,i,r)}},"export":function(e){e.rndi=n.rndi,e.rndf=n.rndf,e.Rndi=n.Rndi,e.Rndf=n.Rndf,e.future=n.future,e.solo=n.solo},init:function(){Array.prototype.random=Array.prototype.rnd=n.random}});return n}},{}],29:[function(e,t){var i=e("color-convert"),n=e("color-string");t.exports=function(e){return new r(e)};var r=function(e){if(this.values={rgb:[0,0,0],hsl:[0,0,0],hsv:[0,0,0],hwb:[0,0,0],cmyk:[0,0,0,0],alpha:1},"string"==typeof e){var t=n.getRgba(e);if(t)this.setValues("rgb",t);else if(t=n.getHsla(e))this.setValues("hsl",t);else{if(!(t=n.getHwb(e)))throw new Error("Unable to parse color from string "+e);this.setValues("hwb",t)}}else if("object"==typeof e){var t=e;if(void 0!==t.r||void 0!==t.red)this.setValues("rgb",t);else if(void 0!==t.l||void 0!==t.lightness)this.setValues("hsl",t);else if(void 0!==t.v||void 0!==t.value)this.setValues("hsv",t);else if(void 0!==t.w||void 0!==t.whiteness)this.setValues("hwb",t);else{if(void 0===t.c&&void 0===t.cyan)throw new Error("Unable to parse color from object "+JSON.stringify(e));this.setValues("cmyk",t)}}};r.prototype={rgb:function(){return this.setSpace("rgb",arguments)},hsl:function(){return this.setSpace("hsl",arguments)},hsv:function(){return this.setSpace("hsv",arguments)},hwb:function(){return this.setSpace("hwb",arguments)},cmyk:function(){return this.setSpace("cmyk",arguments)},rgbArray:function(){return this.values.rgb},hslArray:function(){return this.values.hsl},hsvArray:function(){return this.values.hsv},hwbArray:function(){return 1!==this.values.alpha?this.values.hwb.concat([this.values.alpha]):this.values.hwb},cmykArray:function(){return this.values.cmyk},rgbaArray:function(){var e=this.values.rgb;return e.concat([this.values.alpha])},hslaArray:function(){var e=this.values.hsl;return e.concat([this.values.alpha])},alpha:function(e){return void 0===e?this.values.alpha:(this.setValues("alpha",e),this)},red:function(e){return this.setChannel("rgb",0,e)},green:function(e){return this.setChannel("rgb",1,e)},blue:function(e){return this.setChannel("rgb",2,e)},hue:function(e){return this.setChannel("hsl",0,e)},saturation:function(e){return this.setChannel("hsl",1,e)},lightness:function(e){return this.setChannel("hsl",2,e)},saturationv:function(e){return this.setChannel("hsv",1,e)},whiteness:function(e){return this.setChannel("hwb",1,e)},blackness:function(e){return this.setChannel("hwb",2,e)},value:function(e){return this.setChannel("hsv",2,e)},cyan:function(e){return this.setChannel("cmyk",0,e)},magenta:function(e){return this.setChannel("cmyk",1,e)},yellow:function(e){return this.setChannel("cmyk",2,e)},black:function(e){return this.setChannel("cmyk",3,e)},hexString:function(){return n.hexString(this.values.rgb)},rgbString:function(){return n.rgbString(this.values.rgb,this.values.alpha)},rgbaString:function(){return n.rgbaString(this.values.rgb,this.values.alpha)},percentString:function(){return n.percentString(this.values.rgb,this.values.alpha)},hslString:function(){return n.hslString(this.values.hsl,this.values.alpha)},hslaString:function(){return n.hslaString(this.values.hsl,this.values.alpha)},hwbString:function(){return n.hwbString(this.values.hwb,this.values.alpha)},keyword:function(){return n.keyword(this.values.rgb,this.values.alpha)},luminosity:function(){for(var e=this.values.rgb,t=[],i=0;i<e.length;i++){var n=e[i]/255;t[i]=.03928>=n?n/12.92:Math.pow((n+.055)/1.055,2.4)}return.2126*t[0]+.7152*t[1]+.0722*t[2]},contrast:function(e){var t=this.luminosity(),i=e.luminosity();return t>i?(t+.05)/(i+.05):(i+.05)/(t+.05)},level:function(e){var t=this.contrast(e);return t>=7.1?"AAA":t>=4.5?"AA":""},dark:function(){var e=this.values.rgb,t=(299*e[0]+587*e[1]+114*e[2])/1e3;return 128>t},light:function(){return!this.dark()},negate:function(){for(var e=[],t=0;3>t;t++)e[t]=255-this.values.rgb[t];return this.setValues("rgb",e),this},lighten:function(e){return this.values.hsl[2]+=this.values.hsl[2]*e,this.setValues("hsl",this.values.hsl),this},darken:function(e){return this.values.hsl[2]-=this.values.hsl[2]*e,this.setValues("hsl",this.values.hsl),this},saturate:function(e){return this.values.hsl[1]+=this.values.hsl[1]*e,this.setValues("hsl",this.values.hsl),this},desaturate:function(e){return this.values.hsl[1]-=this.values.hsl[1]*e,this.setValues("hsl",this.values.hsl),this},whiten:function(e){return this.values.hwb[1]+=this.values.hwb[1]*e,this.setValues("hwb",this.values.hwb),this},blacken:function(e){return this.values.hwb[2]+=this.values.hwb[2]*e,this.setValues("hwb",this.values.hwb),this},greyscale:function(){var e=this.values.rgb,t=.3*e[0]+.59*e[1]+.11*e[2];return this.setValues("rgb",[t,t,t]),this},clearer:function(e){return this.setValues("alpha",this.values.alpha-this.values.alpha*e),this},opaquer:function(e){return this.setValues("alpha",this.values.alpha+this.values.alpha*e),this},rotate:function(e){var t=this.values.hsl[0];return t=(t+e)%360,t=0>t?360+t:t,this.values.hsl[0]=t,this.setValues("hsl",this.values.hsl),this},mix:function(e,t){t=1-(null==t?.5:t);for(var i=2*t-1,n=this.alpha()-e.alpha(),r=((i*n==-1?i:(i+n)/(1+i*n))+1)/2,o=1-r,a=this.rgbArray(),s=e.rgbArray(),l=0;l<a.length;l++)a[l]=a[l]*r+s[l]*o;this.setValues("rgb",a);var c=this.alpha()*t+e.alpha()*(1-t);return this.setValues("alpha",c),this},toJSON:function(){return this.rgb()},clone:function(){return new r(this.rgb())}},r.prototype.getValues=function(e){for(var t={},i=0;i<e.length;i++)t[e[i]]=this.values[e][i];return 1!=this.values.alpha&&(t.a=this.values.alpha),t},r.prototype.setValues=function(e,t){var n={rgb:["red","green","blue"],hsl:["hue","saturation","lightness"],hsv:["hue","saturation","value"],hwb:["hue","whiteness","blackness"],cmyk:["cyan","magenta","yellow","black"]},r={rgb:[255,255,255],hsl:[360,100,100],hsv:[360,100,100],hwb:[360,100,100],cmyk:[100,100,100,100]},o=1;if("alpha"==e)o=t;else if(t.length)this.values[e]=t.slice(0,e.length),o=t[e.length];else if(void 0!==t[e[0]]){for(var a=0;a<e.length;a++)this.values[e][a]=t[e[a]];o=t.a}else if(void 0!==t[n[e][0]]){for(var s=n[e],a=0;a<e.length;a++)this.values[e][a]=t[s[a]];o=t.alpha}if(this.values.alpha=Math.max(0,Math.min(1,void 0!==o?o:this.values.alpha)),"alpha"!=e){for(var a=0;a<e.length;a++){var l=Math.max(0,Math.min(r[e][a],this.values[e][a]));this.values[e][a]=Math.round(l)}for(var c in n){c!=e&&(this.values[c]=i[e][c](this.values[e]));for(var a=0;a<c.length;a++){var l=Math.max(0,Math.min(r[c][a],this.values[c][a]));this.values[c][a]=Math.round(l)}}return!0}},r.prototype.setSpace=function(e,t){var i=t[0];return void 0===i?this.getValues(e):("number"==typeof i&&(i=Array.prototype.slice.call(t)),this.setValues(e,i),this)},r.prototype.setChannel=function(e,t,i){return void 0===i?this.values[e][t]:(this.values[e][t]=i,this.setValues(e,this.values[e]),this)}},{"color-convert":31,"color-string":32}],30:[function(e,t){function i(e){var t,i,n,r=e[0]/255,o=e[1]/255,a=e[2]/255,s=Math.min(r,o,a),l=Math.max(r,o,a),c=l-s;return l==s?t=0:r==l?t=(o-a)/c:o==l?t=2+(a-r)/c:a==l&&(t=4+(r-o)/c),t=Math.min(60*t,360),0>t&&(t+=360),n=(s+l)/2,i=l==s?0:.5>=n?c/(l+s):c/(2-l-s),[t,100*i,100*n]}function n(e){var t,i,n,r=e[0],o=e[1],a=e[2],s=Math.min(r,o,a),l=Math.max(r,o,a),c=l-s;return i=0==l?0:c/l*1e3/10,l==s?t=0:r==l?t=(o-a)/c:o==l?t=2+(a-r)/c:a==l&&(t=4+(r-o)/c),t=Math.min(60*t,360),0>t&&(t+=360),n=l/255*1e3/10,[t,i,n]}function o(e){var t=e[0],n=e[1],r=e[2],o=i(e)[0];return w=1/255*Math.min(t,Math.min(n,r)),r=1-1/255*Math.max(t,Math.max(n,r)),[o,100*w,100*r]}function a(e){var t,i,n,r,o=e[0]/255,a=e[1]/255,s=e[2]/255;return r=Math.min(1-o,1-a,1-s),t=(1-o-r)/(1-r),i=(1-a-r)/(1-r),n=(1-s-r)/(1-r),[100*t,100*i,100*n,100*r]}function s(e){return Q[JSON.stringify(e)]}function l(e){var t=e[0]/255,i=e[1]/255,n=e[2]/255;t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92,i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92;var r=.4124*t+.3576*i+.1805*n,o=.2126*t+.7152*i+.0722*n,a=.0193*t+.1192*i+.9505*n;return[100*r,100*o,100*a]}function c(e){var t,i,n,r=l(e),o=r[0],a=r[1],s=r[2];return o/=95.047,a/=100,s/=108.883,o=o>.008856?Math.pow(o,1/3):7.787*o+16/116,a=a>.008856?Math.pow(a,1/3):7.787*a+16/116,s=s>.008856?Math.pow(s,1/3):7.787*s+16/116,t=116*a-16,i=500*(o-a),n=200*(a-s),[t,i,n]}function h(e){return O(c(e))}function u(e){var t,i,n,r,o,a=e[0]/360,s=e[1]/100,l=e[2]/100;if(0==s)return o=255*l,[o,o,o];i=.5>l?l*(1+s):l+s-l*s,t=2*l-i,r=[0,0,0];for(var c=0;3>c;c++)n=a+1/3*-(c-1),0>n&&n++,n>1&&n--,o=1>6*n?t+6*(i-t)*n:1>2*n?i:2>3*n?t+(i-t)*(2/3-n)*6:t,r[c]=255*o;return r}function f(e){var t,i,n=e[0],r=e[1]/100,o=e[2]/100;return o*=2,r*=1>=o?o:2-o,i=(o+r)/2,t=2*r/(o+r),[n,100*t,100*i]}function p(e){return o(u(e))}function d(e){return a(u(e))}function m(e){return s(u(e))}function v(e){var t=e[0]/60,i=e[1]/100,n=e[2]/100,r=Math.floor(t)%6,o=t-Math.floor(t),a=255*n*(1-i),s=255*n*(1-i*o),l=255*n*(1-i*(1-o)),n=255*n;switch(r){case 0:return[n,l,a];case 1:return[s,n,a];case 2:return[a,n,l];case 3:return[a,s,n];case 4:return[l,a,n];case 5:return[n,a,s]}}function y(e){var t,i,n=e[0],r=e[1]/100,o=e[2]/100;return i=(2-r)*o,t=r*o,t/=1>=i?i:2-i,i/=2,[n,100*t,100*i]}function x(e){return o(v(e))}function _(e){return a(v(e))}function S(e){return s(v(e))}function M(e){var t,i,n,o,a=e[0]/360,s=e[1]/100,l=e[2]/100,c=s+l;switch(c>1&&(s/=c,l/=c),t=Math.floor(6*a),i=1-l,n=6*a-t,0!=(1&t)&&(n=1-n),o=s+n*(i-s),t){default:case 6:case 0:r=i,g=o,b=s;break;case 1:r=o,g=i,b=s;break;case 2:r=s,g=i,b=o;break;case 3:r=s,g=o,b=i;break;case 4:r=o,g=s,b=i;break;case 5:r=i,g=s,b=o}return[255*r,255*g,255*b]}function C(e){return i(M(e))}function T(e){return n(M(e))}function A(e){return a(M(e))}function E(e){return s(M(e))}function P(e){var t,i,n,r=e[0]/100,o=e[1]/100,a=e[2]/100,s=e[3]/100;return t=1-Math.min(1,r*(1-s)+s),i=1-Math.min(1,o*(1-s)+s),n=1-Math.min(1,a*(1-s)+s),[255*t,255*i,255*n]}function k(e){return i(P(e))}function R(e){return n(P(e))}function L(e){return o(P(e))}function D(e){return s(P(e))}function F(e){var t,i,n,r=e[0]/100,o=e[1]/100,a=e[2]/100;return t=3.2406*r+-1.5372*o+a*-.4986,i=r*-.9689+1.8758*o+.0415*a,n=.0557*r+o*-.204+1.057*a,t=t>.0031308?1.055*Math.pow(t,1/2.4)-.055:t=12.92*t,i=i>.0031308?1.055*Math.pow(i,1/2.4)-.055:i=12.92*i,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:n=12.92*n,t=Math.min(Math.max(0,t),1),i=Math.min(Math.max(0,i),1),n=Math.min(Math.max(0,n),1),[255*t,255*i,255*n]}function G(e){var t,i,n,r=e[0],o=e[1],a=e[2];return r/=95.047,o/=100,a/=108.883,r=r>.008856?Math.pow(r,1/3):7.787*r+16/116,o=o>.008856?Math.pow(o,1/3):7.787*o+16/116,a=a>.008856?Math.pow(a,1/3):7.787*a+16/116,t=116*o-16,i=500*(r-o),n=200*(o-a),[t,i,n]}function N(e){return O(G(e))}function V(e){var t,i,n,r,o=e[0],a=e[1],s=e[2];return 8>=o?(i=100*o/903.3,r=7.787*(i/100)+16/116):(i=100*Math.pow((o+16)/116,3),r=Math.pow(i/100,1/3)),t=.008856>=t/95.047?t=95.047*(a/500+r-16/116)/7.787:95.047*Math.pow(a/500+r,3),n=.008859>=n/108.883?n=108.883*(r-s/200-16/116)/7.787:108.883*Math.pow(r-s/200,3),[t,i,n]}function O(e){var t,i,n,r=e[0],o=e[1],a=e[2];return t=Math.atan2(a,o),i=360*t/2/Math.PI,0>i&&(i+=360),n=Math.sqrt(o*o+a*a),[r,n,i]}function j(e){return F(V(e))}function I(e){var t,i,n,r=e[0],o=e[1],a=e[2];return n=a/360*2*Math.PI,t=o*Math.cos(n),i=o*Math.sin(n),[r,t,i]}function U(e){return V(I(e))}function z(e){return j(I(e))}function B(e){return $[e]}function H(e){return i(B(e))}function q(e){return n(B(e))}function W(e){return o(B(e))}function X(e){return a(B(e))}function Y(e){return c(B(e))}function K(e){return l(B(e))}t.exports={rgb2hsl:i,rgb2hsv:n,rgb2hwb:o,rgb2cmyk:a,rgb2keyword:s,rgb2xyz:l,rgb2lab:c,rgb2lch:h,hsl2rgb:u,hsl2hsv:f,hsl2hwb:p,hsl2cmyk:d,hsl2keyword:m,hsv2rgb:v,hsv2hsl:y,hsv2hwb:x,hsv2cmyk:_,hsv2keyword:S,hwb2rgb:M,hwb2hsl:C,hwb2hsv:T,hwb2cmyk:A,hwb2keyword:E,cmyk2rgb:P,cmyk2hsl:k,cmyk2hsv:R,cmyk2hwb:L,cmyk2keyword:D,keyword2rgb:B,keyword2hsl:H,keyword2hsv:q,keyword2hwb:W,keyword2cmyk:X,keyword2lab:Y,keyword2xyz:K,xyz2rgb:F,xyz2lab:G,xyz2lch:N,lab2xyz:V,lab2rgb:j,lab2lch:O,lch2lab:I,lch2xyz:U,lch2rgb:z};var $={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},Q={};for(var Z in $)Q[JSON.stringify($[Z])]=Z},{}],31:[function(e,t){var i=e("./conversions"),n=function(){return new l};for(var r in i){n[r+"Raw"]=function(e){return function(t){return"number"==typeof t&&(t=Array.prototype.slice.call(arguments)),i[e](t)}}(r);var o=/(\w+)2(\w+)/.exec(r),a=o[1],s=o[2];n[a]=n[a]||{},n[a][s]=n[r]=function(e){return function(t){"number"==typeof t&&(t=Array.prototype.slice.call(arguments));var n=i[e](t);if("string"==typeof n||void 0===n)return n;for(var r=0;r<n.length;r++)n[r]=Math.round(n[r]);return n}}(r)}var l=function(){this.convs={}};l.prototype.routeSpace=function(e,t){var i=t[0];return void 0===i?this.getValues(e):("number"==typeof i&&(i=Array.prototype.slice.call(t)),this.setValues(e,i))},l.prototype.setValues=function(e,t){return this.space=e,this.convs={},this.convs[e]=t,this},l.prototype.getValues=function(e){var t=this.convs[e];if(!t){var i=this.space,r=this.convs[i];t=n[i][e](r),this.convs[e]=t}return t},["rgb","hsl","hsv","cmyk","keyword"].forEach(function(e){l.prototype[e]=function(){return this.routeSpace(e,arguments)}}),t.exports=n},{"./conversions":30}],32:[function(e,t){function i(e){if(e){var t=/^#([a-fA-F0-9]{3})$/,i=/^#([a-fA-F0-9]{6})$/,n=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*([\d\.]+)\s*)?\)$/,r=/^rgba?\(\s*([\d\.]+)\%\s*,\s*([\d\.]+)\%\s*,\s*([\d\.]+)\%\s*(?:,\s*([\d\.]+)\s*)?\)$/,o=/(\D+)/,a=[0,0,0],s=1,l=e.match(t);if(l){l=l[1];for(var c=0;c<a.length;c++)a[c]=parseInt(l[c]+l[c],16)}else if(l=e.match(i)){l=l[1];for(var c=0;c<a.length;c++)a[c]=parseInt(l.slice(2*c,2*c+2),16)}else if(l=e.match(n)){for(var c=0;c<a.length;c++)a[c]=parseInt(l[c+1]);s=parseFloat(l[4])}else if(l=e.match(r)){for(var c=0;c<a.length;c++)a[c]=Math.round(2.55*parseFloat(l[c+1]));s=parseFloat(l[4])}else if(l=e.match(o)){if("transparent"==l[1])return[0,0,0,0];if(a=b.keyword2rgb(l[1]),!a)return}for(var c=0;c<a.length;c++)a[c]=v(a[c],0,255);return s=s||0==s?v(s,0,1):1,a.push(s),a}}function n(e){if(e){var t=/^hsla?\(\s*(\d+)\s*,\s*([\d\.]+)%\s*,\s*([\d\.]+)%\s*(?:,\s*([\d\.]+)\s*)?\)/,i=e.match(t);if(i){var n=v(parseInt(i[1]),0,360),r=v(parseFloat(i[2]),0,100),o=v(parseFloat(i[3]),0,100),a=v(parseFloat(i[4])||1,0,1);return[n,r,o,a]}}}function r(e){if(e){var t=/^hwb\(\s*(\d+)\s*,\s*([\d\.]+)%\s*,\s*([\d\.]+)%\s*(?:,\s*([\d\.]+)\s*)?\)/,i=e.match(t);if(i){var n=v(parseInt(i[1]),0,360),r=v(parseFloat(i[2]),0,100),o=v(parseFloat(i[3]),0,100),a=v(parseFloat(i[4])||1,0,1);return[n,r,o,a]}}}function o(e){var t=i(e);return t&&t.slice(0,3)}function a(e){var t=n(e);return t&&t.slice(0,3)}function s(e){var t=i(e);return t?t[3]:(t=n(e))?t[3]:(t=r(e))?t[3]:void 0}function l(e){return"#"+y(e[0])+y(e[1])+y(e[2])}function c(e,t){return 1>t||e[3]&&e[3]<1?h(e,t):"rgb("+e[0]+", "+e[1]+", "+e[2]+")"}function h(e,t){return void 0===t&&(t=void 0!==e[3]?e[3]:1),"rgba("+e[0]+", "+e[1]+", "+e[2]+", "+t+")"}function u(e,t){if(1>t||e[3]&&e[3]<1)return f(e,t);var i=Math.round(e[0]/255*100),n=Math.round(e[1]/255*100),r=Math.round(e[2]/255*100);return"rgb("+i+"%, "+n+"%, "+r+"%)"}function f(e,t){var i=Math.round(e[0]/255*100),n=Math.round(e[1]/255*100),r=Math.round(e[2]/255*100);return"rgba("+i+"%, "+n+"%, "+r+"%, "+(t||e[3]||1)+")"}function p(e,t){return 1>t||e[3]&&e[3]<1?d(e,t):"hsl("+e[0]+", "+e[1]+"%, "+e[2]+"%)"}function d(e,t){return void 0===t&&(t=void 0!==e[3]?e[3]:1),"hsla("+e[0]+", "+e[1]+"%, "+e[2]+"%, "+t+")"}function m(e,t){return void 0===t&&(t=void 0!==e[3]?e[3]:1),"hwb("+e[0]+", "+e[1]+"%, "+e[2]+"%"+(void 0!==t&&1!==t?", "+t:"")+")"}function g(e){return b.rgb2keyword(e.slice(0,3))}function v(e,t,i){return Math.min(Math.max(t,e),i)}function y(e){var t=e.toString(16).toUpperCase();return t.length<2?"0"+t:t}var b=e("color-convert");t.exports={getRgba:i,getHsla:n,getRgb:o,getHsl:a,getHwb:r,getAlpha:s,hexString:l,rgbString:c,rgbaString:h,percentString:u,percentaString:f,hslString:p,hslaString:d,hwbString:m,keyword:g}},{"color-convert":31}],33:[function(){THREE.CopyShader={uniforms:{tDiffuse:{type:"t",value:null},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")}},{}],34:[function(){THREE.DotScreenPass=function(e,t,i,n){void 0===THREE.DotScreenShader&&console.error("THREE.DotScreenPass relies on THREE.DotScreenShader");var r=THREE.DotScreenShader;this.uniforms=THREE.UniformsUtils.clone(r.uniforms),void 0!==e&&this.uniforms.center.value.copy(e),void 0!==t&&(this.uniforms.angle.value=t),void 0!==i&&(this.uniforms.scale.value=i),void 0!==n&&(this.uniforms.mix.value=n),this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader}),this.enabled=!0,this.renderToScreen=!1,this.needsSwap=!0},THREE.DotScreenPass.prototype={render:function(e,t,i){this.uniforms.tDiffuse.value=i,this.uniforms.tSize.value.set(i.width,i.height),THREE.EffectComposer.quad.material=this.material,this.renderToScreen?e.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera):e.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera,t,!1)}}},{}],35:[function(){THREE.EffectComposer=function(e,t){if(this.renderer=e,void 0===t){var i=window.innerWidth||1,n=window.innerHeight||1,r={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1};t=new THREE.WebGLRenderTarget(i,n,r)}this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.passes=[],void 0===THREE.CopyShader&&console.error("THREE.EffectComposer relies on THREE.CopyShader"),this.copyPass=new THREE.ShaderPass(THREE.CopyShader)},THREE.EffectComposer.prototype={swapBuffers:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e},addPass:function(e){this.passes.push(e)},insertPass:function(e,t){this.passes.splice(t,0,e)},render:function(e){this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2;var t,i,n=!1,r=this.passes.length;for(i=0;r>i;i++)if(t=this.passes[i],t.enabled){if(t.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),t.needsSwap){if(n){var o=this.renderer.context;o.stencilFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),o.stencilFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}t instanceof THREE.MaskPass?n=!0:t instanceof THREE.ClearMaskPass&&(n=!1)}},reset:function(e){void 0===e&&(e=this.renderTarget1.clone(),e.width=window.innerWidth,e.height=window.innerHeight),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(e,t){var i=this.renderTarget1.clone();i.width=e,i.height=t,this.reset(i)}},THREE.EffectComposer.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),THREE.EffectComposer.quad=new THREE.Mesh(new THREE.PlaneGeometry(2,2),null),THREE.EffectComposer.scene=new THREE.Scene,THREE.EffectComposer.scene.add(THREE.EffectComposer.quad)},{}],36:[function(){THREE.FilmPass=function(e,t,i,n){void 0===THREE.FilmShader&&console.error("THREE.FilmPass relies on THREE.FilmShader");var r=THREE.FilmShader;this.uniforms=THREE.UniformsUtils.clone(r.uniforms),this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader}),void 0!==n&&(this.uniforms.grayscale.value=n),void 0!==e&&(this.uniforms.nIntensity.value=e),void 0!==t&&(this.uniforms.sIntensity.value=t),void 0!==i&&(this.uniforms.sCount.value=i),this.enabled=!0,this.renderToScreen=!1,this.needsSwap=!0},THREE.FilmPass.prototype={render:function(e,t,i,n){this.uniforms.tDiffuse.value=i,this.uniforms.time.value+=n,THREE.EffectComposer.quad.material=this.material,this.renderToScreen?e.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera):e.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera,t,!1)}}},{}],37:[function(){THREE.MaskPass=function(e,t){this.scene=e,this.camera=t,this.enabled=!0,this.clear=!0,this.needsSwap=!1,this.inverse=!1},THREE.MaskPass.prototype={render:function(e,t,i){var n=e.context;n.colorMask(!1,!1,!1,!1),n.depthMask(!1);var r,o;this.inverse?(r=0,o=1):(r=1,o=0),n.enable(n.STENCIL_TEST),n.stencilOp(n.REPLACE,n.REPLACE,n.REPLACE),n.stencilFunc(n.ALWAYS,r,4294967295),n.clearStencil(o),e.render(this.scene,this.camera,i,this.clear),e.render(this.scene,this.camera,t,this.clear),n.colorMask(!0,!0,!0,!0),n.depthMask(!0),n.stencilFunc(n.EQUAL,1,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP)}},THREE.ClearMaskPass=function(){this.enabled=!0},THREE.ClearMaskPass.prototype={render:function(e){var t=e.context;t.disable(t.STENCIL_TEST)}}},{}],38:[function(){THREE.RenderPass=function(e,t,i,n,r){this.scene=e,this.camera=t,this.overrideMaterial=i,this.clearColor=n,this.clearAlpha=void 0!==r?r:1,this.oldClearColor=new THREE.Color,this.oldClearAlpha=1,this.enabled=!0,this.clear=!0,this.needsSwap=!1},THREE.RenderPass.prototype={render:function(e,t,i){this.scene.overrideMaterial=this.overrideMaterial,this.clearColor&&(this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),e.render(this.scene,this.camera,i,this.clear),this.clearColor&&e.setClearColor(this.oldClearColor,this.oldClearAlpha),this.scene.overrideMaterial=null}}},{}],39:[function(){THREE.ShaderPass=function(e,t){this.textureID=void 0!==t?t:"tDiffuse",this.uniforms=THREE.UniformsUtils.clone(e.uniforms),this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}),this.renderToScreen=!1,this.enabled=!0,this.needsSwap=!0,this.clear=!1},THREE.ShaderPass.prototype={render:function(e,t,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i),THREE.EffectComposer.quad.material=this.material,this.renderToScreen?e.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera):e.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera,t,this.clear)}}},{}],40:[function(){THREE.BleachBypassShader={uniforms:{tDiffuse:{type:"t",value:null},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 base = texture2D( tDiffuse, vUv );","vec3 lumCoeff = vec3( 0.25, 0.65, 0.1 );","float lum = dot( lumCoeff, base.rgb );","vec3 blend = vec3( lum );","float L = min( 1.0, max( 0.0, 10.0 * ( lum - 0.45 ) ) );","vec3 result1 = 2.0 * base.rgb * blend;","vec3 result2 = 1.0 - 2.0 * ( 1.0 - blend ) * ( 1.0 - base.rgb );","vec3 newColor = mix( result1, result2, L );","float A2 = opacity * base.a;","vec3 mixRGB = A2 * newColor.rgb;","mixRGB += ( ( 1.0 - A2 ) * base.rgb );","gl_FragColor = vec4( mixRGB, base.a );","}"].join("\n")}},{}],41:[function(){THREE.ColorifyShader={uniforms:{tDiffuse:{type:"t",value:null},color:{type:"c",value:new THREE.Color(16777215)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","gl_FragColor = vec4( v * color, texel.w );","}"].join("\n")}},{}],42:[function(){THREE.DotScreenShader={uniforms:{tDiffuse:{type:"t",value:null},tSize:{type:"v2",value:new THREE.Vector2(256,256)},center:{type:"v2",value:new THREE.Vector2(.5,.5)},angle:{type:"f",value:1.57},scale:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec2 center;","uniform float angle;","uniform float scale;","uniform vec2 tSize;","uniform sampler2D tDiffuse;","varying vec2 vUv;","float pattern() {","float s = sin( angle ), c = cos( angle );","vec2 tex = vUv * tSize - center;","vec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;","return ( sin( point.x ) * sin( point.y ) ) * 4.0;","}","void main() {","vec4 color = texture2D( tDiffuse, vUv );","float average = ( color.r + color.g + color.b ) / 3.0;","gl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );","}"].join("\n")}},{}],43:[function(){THREE.EdgeShader={uniforms:{tDiffuse:{type:"t",value:null},aspect:{type:"v2",value:new THREE.Vector2(512,512)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","uniform vec2 aspect;","vec2 texel = vec2(1.0 / aspect.x, 1.0 / aspect.y);","mat3 G[9];","const mat3 g0 = mat3( 0.3535533845424652, 0, -0.3535533845424652, 0.5, 0, -0.5, 0.3535533845424652, 0, -0.3535533845424652 );","const mat3 g1 = mat3( 0.3535533845424652, 0.5, 0.3535533845424652, 0, 0, 0, -0.3535533845424652, -0.5, -0.3535533845424652 );","const mat3 g2 = mat3( 0, 0.3535533845424652, -0.5, -0.3535533845424652, 0, 0.3535533845424652, 0.5, -0.3535533845424652, 0 );","const mat3 g3 = mat3( 0.5, -0.3535533845424652, 0, -0.3535533845424652, 0, 0.3535533845424652, 0, 0.3535533845424652, -0.5 );","const mat3 g4 = mat3( 0, -0.5, 0, 0.5, 0, 0.5, 0, -0.5, 0 );","const mat3 g5 = mat3( -0.5, 0, 0.5, 0, 0, 0, 0.5, 0, -0.5 );","const mat3 g6 = mat3( 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.6666666865348816, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204 );","const mat3 g7 = mat3( -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, 0.6666666865348816, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408 );","const mat3 g8 = mat3( 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408 );","void main(void)","{","G[0] = g0,","G[1] = g1,","G[2] = g2,","G[3] = g3,","G[4] = g4,","G[5] = g5,","G[6] = g6,","G[7] = g7,","G[8] = g8;","mat3 I;","float cnv[9];","vec3 sample;","for (float i=0.0; i<3.0; i++) {","for (float j=0.0; j<3.0; j++) {","sample = texture2D(tDiffuse, vUv + texel * vec2(i-1.0,j-1.0) ).rgb;","I[int(i)][int(j)] = length(sample);","}","}","for (int i=0; i<9; i++) {","float dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);","cnv[i] = dp3 * dp3;","}","float M = (cnv[0] + cnv[1]) + (cnv[2] + cnv[3]);","float S = (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]) + (cnv[8] + M);","gl_FragColor = vec4(vec3(sqrt(M/S)), 1.0);","}"].join("\n")}
},{}],44:[function(){THREE.FilmShader={uniforms:{tDiffuse:{type:"t",value:null},time:{type:"f",value:0},nIntensity:{type:"f",value:.5},sIntensity:{type:"f",value:.05},sCount:{type:"f",value:4096},grayscale:{type:"i",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float time;","uniform bool grayscale;","uniform float nIntensity;","uniform float sIntensity;","uniform float sCount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 cTextureScreen = texture2D( tDiffuse, vUv );","float x = vUv.x * vUv.y * time *  1000.0;","x = mod( x, 13.0 ) * mod( x, 123.0 );","float dx = mod( x, 0.01 );","vec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx * 100.0, 0.0, 1.0 );","vec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );","cResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;","cResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );","if( grayscale ) {","cResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );","}","gl_FragColor =  vec4( cResult, cTextureScreen.a );","}"].join("\n")}},{}],45:[function(){THREE.FocusShader={uniforms:{tDiffuse:{type:"t",value:null},screenWidth:{type:"f",value:1024},screenHeight:{type:"f",value:1024},sampleDistance:{type:"f",value:.94},waveFactor:{type:"f",value:.00125}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float screenWidth;","uniform float screenHeight;","uniform float sampleDistance;","uniform float waveFactor;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 color, org, tmp, add;","float sample_dist, f;","vec2 vin;","vec2 uv = vUv;","add = color = org = texture2D( tDiffuse, uv );","vin = ( uv - vec2( 0.5 ) ) * vec2( 1.4 );","sample_dist = dot( vin, vin ) * 2.0;","f = ( waveFactor * 100.0 + sample_dist ) * sampleDistance * 4.0;","vec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2( f );","add += tmp = texture2D( tDiffuse, uv + vec2( 0.111964, 0.993712 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( 0.846724, 0.532032 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( 0.943883, -0.330279 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( 0.330279, -0.943883 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( -0.532032, -0.846724 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( -0.993712, -0.111964 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( -0.707107, 0.707107 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","color = color * vec4( 2.0 ) - ( add / vec4( 8.0 ) );","color = color + ( add / vec4( 8.0 ) - color ) * ( vec4( 1.0 ) - vec4( sample_dist * 0.5 ) );","gl_FragColor = vec4( color.rgb * color.rgb * vec3( 0.95 ) + color.rgb, 1.0 );","}"].join("\n")}},{}],46:[function(){THREE.KaleidoShader={uniforms:{tDiffuse:{type:"t",value:null},sides:{type:"f",value:6},angle:{type:"f",value:0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float sides;","uniform float angle;","varying vec2 vUv;","void main() {","vec2 p = vUv - 0.5;","float r = length(p);","float a = atan(p.y, p.x) + angle;","float tau = 2. * 3.1416 ;","a = mod(a, tau/sides);","a = abs(a - tau/sides/2.) ;","p = r * vec2(cos(a), sin(a));","vec4 color = texture2D(tDiffuse, p + 0.5);","gl_FragColor = color;","}"].join("\n")}},{}],47:[function(){THREE.ShaderGodRays={godrays_generate:{uniforms:{tInput:{type:"t",value:null},fStepSize:{type:"f",value:1},vSunPositionScreenSpace:{type:"v2",value:new THREE.Vector2(.5,.5)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define TAPS_PER_PASS 6.0","varying vec2 vUv;","uniform sampler2D tInput;","uniform vec2 vSunPositionScreenSpace;","uniform float fStepSize;","void main() {","vec2 delta = vSunPositionScreenSpace - vUv;","float dist = length( delta );","vec2 stepv = fStepSize * delta / dist;","float iters = dist/fStepSize;","vec2 uv = vUv.xy;","float col = 0.0;","if ( 0.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 1.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 2.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 3.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 4.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 5.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","gl_FragColor = vec4( col/TAPS_PER_PASS );","gl_FragColor.a = 1.0;","}"].join("\n")},godrays_combine:{uniforms:{tColors:{type:"t",value:null},tGodRays:{type:"t",value:null},fGodRayIntensity:{type:"f",value:.69},vSunPositionScreenSpace:{type:"v2",value:new THREE.Vector2(.5,.5)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform sampler2D tColors;","uniform sampler2D tGodRays;","uniform vec2 vSunPositionScreenSpace;","uniform float fGodRayIntensity;","void main() {","gl_FragColor = texture2D( tColors, vUv ) + fGodRayIntensity * vec4( 1.0 - texture2D( tGodRays, vUv ).r );","gl_FragColor.a = 1.0;","}"].join("\n")},godrays_fake_sun:{uniforms:{vSunPositionScreenSpace:{type:"v2",value:new THREE.Vector2(.5,.5)},fAspect:{type:"f",value:1},sunColor:{type:"c",value:new THREE.Color(16772608)},bgColor:{type:"c",value:new THREE.Color(0)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform vec2 vSunPositionScreenSpace;","uniform float fAspect;","uniform vec3 sunColor;","uniform vec3 bgColor;","void main() {","vec2 diff = vUv - vSunPositionScreenSpace;","diff.x *= fAspect;","float prop = clamp( length( diff ) / 0.5, 0.0, 1.0 );","prop = 0.35 * pow( 1.0 - prop, 3.0 );","gl_FragColor.xyz = mix( sunColor, bgColor, 1.0 - prop );","gl_FragColor.w = 1.0;","}"].join("\n")}}},{}],48:[function(e,t){!function(){"use strict";var e=window.THREE=e||{REVISION:"58"};self.console=self.console||{info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}},self.Int32Array=self.Int32Array||Array,self.Float32Array=self.Float32Array||Array,String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},e.extend=function(e,t){if(Object.keys)for(var i=Object.keys(t),n=0,r=i.length;r>n;n++){var o=i[n];Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(t,o))}else for(o in i={}.hasOwnProperty,t)i.call(t,o)&&(e[o]=t[o]);return e},function(){for(var e=0,t=["ms","moz","webkit","o"],i=0;i<t.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[t[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[i]+"CancelAnimationFrame"]||window[t[i]+"CancelRequestAnimationFrame"];void 0===window.requestAnimationFrame&&(window.requestAnimationFrame=function(t){var i=Date.now(),n=Math.max(0,16-(i-e)),r=window.setTimeout(function(){t(i+n)},n);return e=i+n,r}),window.cancelAnimationFrame=window.cancelAnimationFrame||function(e){window.clearTimeout(e)}}(),e.CullFaceNone=0,e.CullFaceBack=1,e.CullFaceFront=2,e.CullFaceFrontBack=3,e.FrontFaceDirectionCW=0,e.FrontFaceDirectionCCW=1,e.BasicShadowMap=0,e.PCFShadowMap=1,e.PCFSoftShadowMap=2,e.FrontSide=0,e.BackSide=1,e.DoubleSide=2,e.NoShading=0,e.FlatShading=1,e.SmoothShading=2,e.NoColors=0,e.FaceColors=1,e.VertexColors=2,e.NoBlending=0,e.NormalBlending=1,e.AdditiveBlending=2,e.SubtractiveBlending=3,e.MultiplyBlending=4,e.CustomBlending=5,e.AddEquation=100,e.SubtractEquation=101,e.ReverseSubtractEquation=102,e.ZeroFactor=200,e.OneFactor=201,e.SrcColorFactor=202,e.OneMinusSrcColorFactor=203,e.SrcAlphaFactor=204,e.OneMinusSrcAlphaFactor=205,e.DstAlphaFactor=206,e.OneMinusDstAlphaFactor=207,e.DstColorFactor=208,e.OneMinusDstColorFactor=209,e.SrcAlphaSaturateFactor=210,e.MultiplyOperation=0,e.MixOperation=1,e.AddOperation=2,e.UVMapping=function(){},e.CubeReflectionMapping=function(){},e.CubeRefractionMapping=function(){},e.SphericalReflectionMapping=function(){},e.SphericalRefractionMapping=function(){},e.RepeatWrapping=1e3,e.ClampToEdgeWrapping=1001,e.MirroredRepeatWrapping=1002,e.NearestFilter=1003,e.NearestMipMapNearestFilter=1004,e.NearestMipMapLinearFilter=1005,e.LinearFilter=1006,e.LinearMipMapNearestFilter=1007,e.LinearMipMapLinearFilter=1008,e.UnsignedByteType=1009,e.ByteType=1010,e.ShortType=1011,e.UnsignedShortType=1012,e.IntType=1013,e.UnsignedIntType=1014,e.FloatType=1015,e.UnsignedShort4444Type=1016,e.UnsignedShort5551Type=1017,e.UnsignedShort565Type=1018,e.AlphaFormat=1019,e.RGBFormat=1020,e.RGBAFormat=1021,e.LuminanceFormat=1022,e.LuminanceAlphaFormat=1023,e.RGB_S3TC_DXT1_Format=2001,e.RGBA_S3TC_DXT1_Format=2002,e.RGBA_S3TC_DXT3_Format=2003,e.RGBA_S3TC_DXT5_Format=2004,e.Color=function(e){return void 0!==e&&this.set(e),this},e.Color.prototype={constructor:e.Color,r:1,g:1,b:1,set:function(t){return t instanceof e.Color?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,i){return this.r=e,this.g=t,this.b=i,this},setHSL:function(e,t,i){if(0===t)this.r=this.g=this.b=i;else{var n=function(e,t,i){return 0>i&&(i+=1),i>1&&(i-=1),1/6>i?e+6*(t-e)*i:.5>i?t:2/3>i?e+6*(t-e)*(2/3-i):e},t=.5>=i?i*(1+t):i+t-i*t,i=2*i-t;this.r=n(i,t,e+1/3),this.g=n(i,t,e),this.b=n(i,t,e-1/3)}return this},setStyle:function(t){return/^rgb\((\d+),(\d+),(\d+)\)$/i.test(t)?(t=/^rgb\((\d+),(\d+),(\d+)\)$/i.exec(t),this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,this):/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i.test(t)?(t=/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i.exec(t),this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,this):/^\#([0-9a-f]{6})$/i.test(t)?(t=/^\#([0-9a-f]{6})$/i.exec(t),this.setHex(parseInt(t[1],16)),this):/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(t)?(t=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(t),this.setHex(parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3],16)),this):/^(\w+)$/i.test(t)?(this.setHex(e.ColorKeywords[t]),this):void 0},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e){return this.r=e.r*e.r,this.g=e.g*e.g,this.b=e.b*e.b,this},copyLinearToGamma:function(e){return this.r=Math.sqrt(e.r),this.g=Math.sqrt(e.g),this.b=Math.sqrt(e.b),this},convertGammaToLinear:function(){var e=this.r,t=this.g,i=this.b;return this.r=e*e,this.g=t*t,this.b=i*i,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(){var e={h:0,s:0,l:0};return function(){var t,i=this.r,n=this.g,r=this.b,o=Math.max(i,n,r),a=Math.min(i,n,r),s=(a+o)/2;if(a===o)a=t=0;else{var l=o-a,a=.5>=s?l/(o+a):l/(2-o-a);switch(o){case i:t=(n-r)/l+(r>n?6:0);break;case n:t=(r-i)/l+2;break;case r:t=(i-n)/l+4}t/=6}return e.h=t,e.s=a,e.l=s,e}}(),getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,i){var n=this.getHSL();return n.h+=e,n.s+=t,n.l+=i,this.setHSL(n.h,n.s,n.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},clone:function(){return(new e.Color).setRGB(this.r,this.g,this.b)}},e.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},e.Quaternion=function(e,t,i,n){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==n?n:1},e.Quaternion.prototype={constructor:e.Quaternion,set:function(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},setFromEuler:function(e,t){var i=Math.cos(e.x/2),n=Math.cos(e.y/2),r=Math.cos(e.z/2),o=Math.sin(e.x/2),a=Math.sin(e.y/2),s=Math.sin(e.z/2);return void 0===t||"XYZ"===t?(this.x=o*n*r+i*a*s,this.y=i*a*r-o*n*s,this.z=i*n*s+o*a*r,this.w=i*n*r-o*a*s):"YXZ"===t?(this.x=o*n*r+i*a*s,this.y=i*a*r-o*n*s,this.z=i*n*s-o*a*r,this.w=i*n*r+o*a*s):"ZXY"===t?(this.x=o*n*r-i*a*s,this.y=i*a*r+o*n*s,this.z=i*n*s+o*a*r,this.w=i*n*r-o*a*s):"ZYX"===t?(this.x=o*n*r-i*a*s,this.y=i*a*r+o*n*s,this.z=i*n*s-o*a*r,this.w=i*n*r+o*a*s):"YZX"===t?(this.x=o*n*r+i*a*s,this.y=i*a*r+o*n*s,this.z=i*n*s-o*a*r,this.w=i*n*r-o*a*s):"XZY"===t&&(this.x=o*n*r-i*a*s,this.y=i*a*r-o*n*s,this.z=i*n*s+o*a*r,this.w=i*n*r+o*a*s),this},setFromAxisAngle:function(e,t){var i=t/2,n=Math.sin(i);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(i),this},setFromRotationMatrix:function(e){var t=e.elements,i=t[0],e=t[4],n=t[8],r=t[1],o=t[5],a=t[9],s=t[2],l=t[6],t=t[10],c=i+o+t;return c>0?(i=.5/Math.sqrt(c+1),this.w=.25/i,this.x=(l-a)*i,this.y=(n-s)*i,this.z=(r-e)*i):i>o&&i>t?(i=2*Math.sqrt(1+i-o-t),this.w=(l-a)/i,this.x=.25*i,this.y=(e+r)/i,this.z=(n+s)/i):o>t?(i=2*Math.sqrt(1+o-i-t),this.w=(n-s)/i,this.x=(e+r)/i,this.y=.25*i,this.z=(a+l)/i):(i=2*Math.sqrt(1+t-i-o),this.w=(r-e)/i,this.x=(n+s)/i,this.y=(a+l)/i,this.z=.25*i),this},inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var e=this.length();return 0===e?(this.z=this.y=this.x=0,this.w=1):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this},multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Quaternion's .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var i=e.x,n=e.y,r=e.z,o=e.w,a=t.x,s=t.y,l=t.z,c=t.w;return this.x=i*c+o*a+n*l-r*s,this.y=n*c+o*s+r*a-i*l,this.z=r*c+o*l+i*s-n*a,this.w=o*c-i*a-n*s-r*l,this},multiplyVector3:function(e){return console.warn("DEPRECATED: Quaternion's .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},slerp:function(e,t){var i=this.x,n=this.y,r=this.z,o=this.w,a=o*e.w+i*e.x+n*e.y+r*e.z;if(0>a?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,a=-a):this.copy(e),a>=1)return this.w=o,this.x=i,this.y=n,this.z=r,this;var s=Math.acos(a),l=Math.sqrt(1-a*a);return.001>Math.abs(l)?(this.w=.5*(o+this.w),this.x=.5*(i+this.x),this.y=.5*(n+this.y),this.z=.5*(r+this.z),this):(a=Math.sin((1-t)*s)/l,s=Math.sin(t*s)/l,this.w=o*a+this.w*s,this.x=i*a+this.x*s,this.y=n*a+this.y*s,this.z=r*a+this.z*s,this)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this.w=e[3],this},toArray:function(){return[this.x,this.y,this.z,this.w]},clone:function(){return new e.Quaternion(this.x,this.y,this.z,this.w)}},e.Quaternion.slerp=function(e,t,i,n){return i.copy(e).slerp(t,n)},e.Vector2=function(e,t){this.x=e||0,this.y=t||0},e.Vector2.prototype={constructor:e.Vector2,set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector2's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScalar:function(e){return this.x+=e,this.y+=e,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector2's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divideScalar:function(e){return 0!==e?(this.x/=e,this.y/=e):this.set(0,0),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,e=this.y-e.y;return t*t+e*e},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e){return this.x=e[0],this.y=e[1],this},toArray:function(){return[this.x,this.y]},clone:function(){return new e.Vector2(this.x,this.y)}},e.Vector3=function(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0},e.Vector3.prototype={constructor:e.Vector3,set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyMatrix3:function(e){var t=this.x,i=this.y,n=this.z,e=e.elements;return this.x=e[0]*t+e[3]*i+e[6]*n,this.y=e[1]*t+e[4]*i+e[7]*n,this.z=e[2]*t+e[5]*i+e[8]*n,this},applyMatrix4:function(e){var t=this.x,i=this.y,n=this.z,e=e.elements;return this.x=e[0]*t+e[4]*i+e[8]*n+e[12],this.y=e[1]*t+e[5]*i+e[9]*n+e[13],this.z=e[2]*t+e[6]*i+e[10]*n+e[14],this},applyProjection:function(e){var t=this.x,i=this.y,n=this.z,e=e.elements,r=1/(e[3]*t+e[7]*i+e[11]*n+e[15]);return this.x=(e[0]*t+e[4]*i+e[8]*n+e[12])*r,this.y=(e[1]*t+e[5]*i+e[9]*n+e[13])*r,this.z=(e[2]*t+e[6]*i+e[10]*n+e[14])*r,this},applyQuaternion:function(e){var t=this.x,i=this.y,n=this.z,r=e.x,o=e.y,a=e.z,e=e.w,s=e*t+o*n-a*i,l=e*i+a*t-r*n,c=e*n+r*i-o*t,t=-r*t-o*i-a*n;return this.x=s*e+t*-r+l*-a-c*-o,this.y=l*e+t*-o+c*-r-s*-a,this.z=c*e+t*-a+s*-o-l*-r,this},transformDirection:function(e){var t=this.x,i=this.y,n=this.z,e=e.elements;return this.x=e[0]*t+e[4]*i+e[8]*n,this.y=e[1]*t+e[5]*i+e[9]*n,this.z=e[2]*t+e[6]*i+e[10]*n,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return 0!==e?(this.x/=e,this.y/=e,this.z/=e):this.z=this.y=this.x=0,this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},cross:function(e,t){if(void 0!==t)return console.warn("DEPRECATED: Vector3's .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var i=this.x,n=this.y,r=this.z;return this.x=n*e.z-r*e.y,this.y=r*e.x-i*e.z,this.z=i*e.y-n*e.x,this},crossVectors:function(e,t){return this.x=e.y*t.z-e.z*t.y,this.y=e.z*t.x-e.x*t.z,this.z=e.x*t.y-e.y*t.x,this},angleTo:function(t){return t=this.dot(t)/(this.length()*t.length()),Math.acos(e.Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y,e=this.z-e.z;return t*t+i*i+e*e},setEulerFromRotationMatrix:function(e,t){function i(e){return Math.min(Math.max(e,-1),1)}var n=e.elements,r=n[0],o=n[4],a=n[8],s=n[1],l=n[5],c=n[9],h=n[2],u=n[6],n=n[10];return void 0===t||"XYZ"===t?(this.y=Math.asin(i(a)),.99999>Math.abs(a)?(this.x=Math.atan2(-c,n),this.z=Math.atan2(-o,r)):(this.x=Math.atan2(u,l),this.z=0)):"YXZ"===t?(this.x=Math.asin(-i(c)),.99999>Math.abs(c)?(this.y=Math.atan2(a,n),this.z=Math.atan2(s,l)):(this.y=Math.atan2(-h,r),this.z=0)):"ZXY"===t?(this.x=Math.asin(i(u)),.99999>Math.abs(u)?(this.y=Math.atan2(-h,n),this.z=Math.atan2(-o,l)):(this.y=0,this.z=Math.atan2(s,r))):"ZYX"===t?(this.y=Math.asin(-i(h)),.99999>Math.abs(h)?(this.x=Math.atan2(u,n),this.z=Math.atan2(s,r)):(this.x=0,this.z=Math.atan2(-o,l))):"YZX"===t?(this.z=Math.asin(i(s)),.99999>Math.abs(s)?(this.x=Math.atan2(-c,l),this.y=Math.atan2(-h,r)):(this.x=0,this.y=Math.atan2(a,n))):"XZY"===t&&(this.z=Math.asin(-i(o)),.99999>Math.abs(o)?(this.x=Math.atan2(u,l),this.y=Math.atan2(a,r)):(this.x=Math.atan2(-c,n),this.y=0)),this},setEulerFromQuaternion:function(e,t){function i(e){return Math.min(Math.max(e,-1),1)}var n=e.x*e.x,r=e.y*e.y,o=e.z*e.z,a=e.w*e.w;return void 0===t||"XYZ"===t?(this.x=Math.atan2(2*(e.x*e.w-e.y*e.z),a-n-r+o),this.y=Math.asin(i(2*(e.x*e.z+e.y*e.w))),this.z=Math.atan2(2*(e.z*e.w-e.x*e.y),a+n-r-o)):"YXZ"===t?(this.x=Math.asin(i(2*(e.x*e.w-e.y*e.z))),this.y=Math.atan2(2*(e.x*e.z+e.y*e.w),a-n-r+o),this.z=Math.atan2(2*(e.x*e.y+e.z*e.w),a-n+r-o)):"ZXY"===t?(this.x=Math.asin(i(2*(e.x*e.w+e.y*e.z))),this.y=Math.atan2(2*(e.y*e.w-e.z*e.x),a-n-r+o),this.z=Math.atan2(2*(e.z*e.w-e.x*e.y),a-n+r-o)):"ZYX"===t?(this.x=Math.atan2(2*(e.x*e.w+e.z*e.y),a-n-r+o),this.y=Math.asin(i(2*(e.y*e.w-e.x*e.z))),this.z=Math.atan2(2*(e.x*e.y+e.z*e.w),a+n-r-o)):"YZX"===t?(this.x=Math.atan2(2*(e.x*e.w-e.z*e.y),a-n+r-o),this.y=Math.atan2(2*(e.y*e.w-e.x*e.z),a+n-r-o),this.z=Math.asin(i(2*(e.x*e.y+e.z*e.w)))):"XZY"===t&&(this.x=Math.atan2(2*(e.x*e.w+e.y*e.z),a-n+r-o),this.y=Math.atan2(2*(e.x*e.z+e.y*e.w),a+n-r-o),this.z=Math.asin(i(2*(e.z*e.w-e.x*e.y)))),this},getPositionFromMatrix:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},getScaleFromMatrix:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),i=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),e=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=i,this.z=e,this},getColumnFromMatrix:function(e,t){var i=4*e,n=t.elements;return this.x=n[i],this.y=n[i+1],this.z=n[i+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this},toArray:function(){return[this.x,this.y,this.z]},clone:function(){return new e.Vector3(this.x,this.y,this.z)}},e.extend(e.Vector3.prototype,{applyEuler:function(){var t=new e.Quaternion;return function(e,i){var n=t.setFromEuler(e,i);return this.applyQuaternion(n),this}}(),applyAxisAngle:function(){var t=new e.Quaternion;return function(e,i){var n=t.setFromAxisAngle(e,i);return this.applyQuaternion(n),this}}(),projectOnVector:function(){var t=new e.Vector3;return function(e){return t.copy(e).normalize(),e=this.dot(t),this.copy(t).multiplyScalar(e)}}(),projectOnPlane:function(){var t=new e.Vector3;return function(e){return t.copy(this).projectOnVector(e),this.sub(t)}}(),reflect:function(){var t=new e.Vector3;return function(e){return t.copy(this).projectOnVector(e).multiplyScalar(2),this.subVectors(t,this)}}()}),e.Vector4=function(e,t,i,n){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==n?n:1},e.Vector4.prototype={constructor:e.Vector4,set:function(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector4's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector4's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,i=this.y,n=this.z,r=this.w,e=e.elements;return this.x=e[0]*t+e[4]*i+e[8]*n+e[12]*r,this.y=e[1]*t+e[5]*i+e[9]*n+e[13]*r,this.z=e[2]*t+e[6]*i+e[10]*n+e[14]*r,this.w=e[3]*t+e[7]*i+e[11]*n+e[15]*r,this},divideScalar:function(e){return 0!==e?(this.x/=e,this.y/=e,this.z/=e,this.w/=e):(this.z=this.y=this.x=0,this.w=1),this},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return 1e-4>t?(this.x=1,this.z=this.y=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,i,n,e=e.elements,r=e[0];n=e[4];var o=e[8],a=e[1],s=e[5],l=e[9];i=e[2],t=e[6];var c=e[10];return.01>Math.abs(n-a)&&.01>Math.abs(o-i)&&.01>Math.abs(l-t)?.1>Math.abs(n+a)&&.1>Math.abs(o+i)&&.1>Math.abs(l+t)&&.1>Math.abs(r+s+c-3)?(this.set(1,0,0,0),this):(e=Math.PI,r=(r+1)/2,s=(s+1)/2,c=(c+1)/2,n=(n+a)/4,o=(o+i)/4,l=(l+t)/4,r>s&&r>c?.01>r?(t=0,n=i=.707106781):(t=Math.sqrt(r),i=n/t,n=o/t):s>c?.01>s?(t=.707106781,i=0,n=.707106781):(i=Math.sqrt(s),t=n/i,n=l/i):.01>c?(i=t=.707106781,n=0):(n=Math.sqrt(c),t=o/n,i=l/n),this.set(t,i,n,e),this):(e=Math.sqrt((t-l)*(t-l)+(o-i)*(o-i)+(a-n)*(a-n)),.001>Math.abs(e)&&(e=1),this.x=(t-l)/e,this.y=(o-i)/e,this.z=(a-n)/e,this.w=Math.acos((r+s+c-1)/2),this)
},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this.w>e.w&&(this.w=e.w),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this.w<e.w&&(this.w=e.w),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this.w<e.w?this.w=e.w:this.w>t.w&&(this.w=t.w),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this.w=e[3],this},toArray:function(){return[this.x,this.y,this.z,this.w]},clone:function(){return new e.Vector4(this.x,this.y,this.z,this.w)}},e.Line3=function(t,i){this.start=void 0!==t?t:new e.Vector3,this.end=void 0!==i?i:new e.Vector3},e.Line3.prototype={constructor:e.Line3,set:function(e,t){return this.start.copy(e),this.end.copy(t),this},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},center:function(t){return(t||new e.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){return(t||new e.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,i){var n=i||new e.Vector3;return this.delta(n).multiplyScalar(t).add(this.start)},closestPointToPointParameter:function(){var t=new e.Vector3,i=new e.Vector3;return function(n,r){t.subVectors(n,this.start),i.subVectors(this.end,this.start);var o=i.dot(i),o=i.dot(t)/o;return r&&(o=e.Math.clamp(o,0,1)),o}}(),closestPointToPoint:function(t,i,n){return t=this.closestPointToPointParameter(t,i),n=n||new e.Vector3,this.delta(n).multiplyScalar(t).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)},clone:function(){return(new e.Line3).copy(this)}},e.Box2=function(t,i){this.min=void 0!==t?t:new e.Vector2(1/0,1/0),this.max=void 0!==i?i:new e.Vector2(-1/0,-1/0)},e.Box2.prototype={constructor:e.Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){if(0<e.length){var t=e[0];this.min.copy(t),this.max.copy(t);for(var i=1,n=e.length;n>i;i++)t=e[i],t.x<this.min.x?this.min.x=t.x:t.x>this.max.x&&(this.max.x=t.x),t.y<this.min.y?this.min.y=t.y:t.y>this.max.y&&(this.max.y=t.y)}else this.makeEmpty();return this},setFromCenterAndSize:function(){var t=new e.Vector2;return function(e,i){var n=t.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(t){return(t||new e.Vector2).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(t){return(t||new e.Vector2).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y?!0:!1},getParameter:function(t){return new e.Vector2((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y?!1:!0},clampPoint:function(t,i){return(i||new e.Vector2).copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new e.Vector2;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new e.Box2).copy(this)}},e.Box3=function(t,i){this.min=void 0!==t?t:new e.Vector3(1/0,1/0,1/0),this.max=void 0!==i?i:new e.Vector3(-1/0,-1/0,-1/0)},e.Box3.prototype={constructor:e.Box3,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){if(0<e.length){var t=e[0];this.min.copy(t),this.max.copy(t);for(var i=1,n=e.length;n>i;i++)t=e[i],t.x<this.min.x?this.min.x=t.x:t.x>this.max.x&&(this.max.x=t.x),t.y<this.min.y?this.min.y=t.y:t.y>this.max.y&&(this.max.y=t.y),t.z<this.min.z?this.min.z=t.z:t.z>this.max.z&&(this.max.z=t.z)}else this.makeEmpty();return this},setFromCenterAndSize:function(){var t=new e.Vector3;return function(e,i){var n=t.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(t){return(t||new e.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(t){return(t||new e.Vector3).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z?!0:!1},getParameter:function(t){return new e.Vector3((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z?!1:!0},clampPoint:function(t,i){return(i||new e.Vector3).copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new e.Vector3;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),getBoundingSphere:function(){var t=new e.Vector3;return function(i){return i=i||new e.Sphere,i.center=this.center(),i.radius=.5*this.size(t).length(),i}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var t=[new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3];return function(e){return t[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),t[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),t[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),t[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),t[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),t[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),t[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),t[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.makeEmpty(),this.setFromPoints(t),this}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new e.Box3).copy(this)}},e.Matrix3=function(e,t,i,n,r,o,a,s,l){this.elements=new Float32Array(9),this.set(void 0!==e?e:1,t||0,i||0,n||0,void 0!==r?r:1,o||0,a||0,s||0,void 0!==l?l:1)},e.Matrix3.prototype={constructor:e.Matrix3,set:function(e,t,i,n,r,o,a,s,l){var c=this.elements;return c[0]=e,c[3]=t,c[6]=i,c[1]=n,c[4]=r,c[7]=o,c[2]=a,c[5]=s,c[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(e){return e=e.elements,this.set(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]),this},multiplyVector3:function(e){return console.warn("DEPRECATED: Matrix3's .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){var t=new e.Vector3;return function(e){for(var i=0,n=e.length;n>i;i+=3)t.x=e[i],t.y=e[i+1],t.z=e[i+2],t.applyMatrix3(this),e[i]=t.x,e[i+1]=t.y,e[i+2]=t.z;return e}}(),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],o=e[4],a=e[5],s=e[6],l=e[7],e=e[8];return t*o*e-t*a*l-i*r*e+i*a*s+n*r*l-n*o*s},getInverse:function(e,t){var i=e.elements,n=this.elements;if(n[0]=i[10]*i[5]-i[6]*i[9],n[1]=-i[10]*i[1]+i[2]*i[9],n[2]=i[6]*i[1]-i[2]*i[5],n[3]=-i[10]*i[4]+i[6]*i[8],n[4]=i[10]*i[0]-i[2]*i[8],n[5]=-i[6]*i[0]+i[2]*i[4],n[6]=i[9]*i[4]-i[5]*i[8],n[7]=-i[9]*i[0]+i[1]*i[8],n[8]=i[5]*i[0]-i[1]*i[4],i=i[0]*n[0]+i[1]*n[3]+i[2]*n[6],0===i){if(t)throw Error("Matrix3.getInverse(): can't invert matrix, determinant is 0");return console.warn("Matrix3.getInverse(): can't invert matrix, determinant is 0"),this.identity(),this}return this.multiplyScalar(1/i),this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},clone:function(){var t=this.elements;return new e.Matrix3(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8])}},e.Matrix4=function(e,t,i,n,r,o,a,s,l,c,h,u,f,p,d,m){var g=this.elements=new Float32Array(16);g[0]=void 0!==e?e:1,g[4]=t||0,g[8]=i||0,g[12]=n||0,g[1]=r||0,g[5]=void 0!==o?o:1,g[9]=a||0,g[13]=s||0,g[2]=l||0,g[6]=c||0,g[10]=void 0!==h?h:1,g[14]=u||0,g[3]=f||0,g[7]=p||0,g[11]=d||0,g[15]=void 0!==m?m:1},e.Matrix4.prototype={constructor:e.Matrix4,set:function(e,t,i,n,r,o,a,s,l,c,h,u,f,p,d,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=n,g[1]=r,g[5]=o,g[9]=a,g[13]=s,g[2]=l,g[6]=c,g[10]=h,g[14]=u,g[3]=f,g[7]=p,g[11]=d,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return e=e.elements,this.set(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]),this},extractPosition:function(e){return console.warn("DEPRECATED: Matrix4's .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},copyPosition:function(e){var t=this.elements,e=e.elements;return t[12]=e[12],t[13]=e[13],t[14]=e[14],this},extractRotation:function(){var t=new e.Vector3;return function(e){var i=this.elements,e=e.elements,n=1/t.set(e[0],e[1],e[2]).length(),r=1/t.set(e[4],e[5],e[6]).length(),o=1/t.set(e[8],e[9],e[10]).length();return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[4]=e[4]*r,i[5]=e[5]*r,i[6]=e[6]*r,i[8]=e[8]*o,i[9]=e[9]*o,i[10]=e[10]*o,this}}(),setRotationFromEuler:function(e,t){return console.warn("DEPRECATED: Matrix4's .setRotationFromEuler() has been deprecated in favor of makeRotationFromEuler.  Please update your code."),this.makeRotationFromEuler(e,t)},makeRotationFromEuler:function(e,t){var i=this.elements,n=e.x,r=e.y,o=e.z,a=Math.cos(n),n=Math.sin(n),s=Math.cos(r),r=Math.sin(r),l=Math.cos(o),o=Math.sin(o);if(void 0===t||"XYZ"===t){var c=a*l,h=a*o,u=n*l,f=n*o;i[0]=s*l,i[4]=-s*o,i[8]=r,i[1]=h+u*r,i[5]=c-f*r,i[9]=-n*s,i[2]=f-c*r,i[6]=u+h*r,i[10]=a*s}else"YXZ"===t?(c=s*l,h=s*o,u=r*l,f=r*o,i[0]=c+f*n,i[4]=u*n-h,i[8]=a*r,i[1]=a*o,i[5]=a*l,i[9]=-n,i[2]=h*n-u,i[6]=f+c*n,i[10]=a*s):"ZXY"===t?(c=s*l,h=s*o,u=r*l,f=r*o,i[0]=c-f*n,i[4]=-a*o,i[8]=u+h*n,i[1]=h+u*n,i[5]=a*l,i[9]=f-c*n,i[2]=-a*r,i[6]=n,i[10]=a*s):"ZYX"===t?(c=a*l,h=a*o,u=n*l,f=n*o,i[0]=s*l,i[4]=u*r-h,i[8]=c*r+f,i[1]=s*o,i[5]=f*r+c,i[9]=h*r-u,i[2]=-r,i[6]=n*s,i[10]=a*s):"YZX"===t?(c=a*s,h=a*r,u=n*s,f=n*r,i[0]=s*l,i[4]=f-c*o,i[8]=u*o+h,i[1]=o,i[5]=a*l,i[9]=-n*l,i[2]=-r*l,i[6]=h*o+u,i[10]=c-f*o):"XZY"===t&&(c=a*s,h=a*r,u=n*s,f=n*r,i[0]=s*l,i[4]=-o,i[8]=r*l,i[1]=c*o+f,i[5]=a*l,i[9]=h*o-u,i[2]=u*o-h,i[6]=n*l,i[10]=f*o+c);return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this},setRotationFromQuaternion:function(e){return console.warn("DEPRECATED: Matrix4's .setRotationFromQuaternion() has been deprecated in favor of makeRotationFromQuaternion.  Please update your code."),this.makeRotationFromQuaternion(e)},makeRotationFromQuaternion:function(e){var t=this.elements,i=e.x,n=e.y,r=e.z,o=e.w,a=i+i,s=n+n,l=r+r,e=i*a,c=i*s,i=i*l,h=n*s,n=n*l,r=r*l,a=o*a,s=o*s,o=o*l;return t[0]=1-(h+r),t[4]=c-o,t[8]=i+s,t[1]=c+o,t[5]=1-(e+r),t[9]=n-a,t[2]=i-s,t[6]=n+a,t[10]=1-(e+h),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var t=new e.Vector3,i=new e.Vector3,n=new e.Vector3;return function(e,r,o){var a=this.elements;return n.subVectors(e,r).normalize(),0===n.length()&&(n.z=1),t.crossVectors(o,n).normalize(),0===t.length()&&(n.x+=1e-4,t.crossVectors(o,n).normalize()),i.crossVectors(n,t),a[0]=t.x,a[4]=i.x,a[8]=n.x,a[1]=t.y,a[5]=i.y,a[9]=n.y,a[2]=t.z,a[6]=i.z,a[10]=n.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Matrix4's .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var i=e.elements,n=t.elements,r=this.elements,o=i[0],a=i[4],s=i[8],l=i[12],c=i[1],h=i[5],u=i[9],f=i[13],p=i[2],d=i[6],m=i[10],g=i[14],v=i[3],y=i[7],b=i[11],i=i[15],x=n[0],w=n[4],_=n[8],S=n[12],M=n[1],C=n[5],T=n[9],A=n[13],E=n[2],P=n[6],k=n[10],R=n[14],L=n[3],D=n[7],F=n[11],n=n[15];return r[0]=o*x+a*M+s*E+l*L,r[4]=o*w+a*C+s*P+l*D,r[8]=o*_+a*T+s*k+l*F,r[12]=o*S+a*A+s*R+l*n,r[1]=c*x+h*M+u*E+f*L,r[5]=c*w+h*C+u*P+f*D,r[9]=c*_+h*T+u*k+f*F,r[13]=c*S+h*A+u*R+f*n,r[2]=p*x+d*M+m*E+g*L,r[6]=p*w+d*C+m*P+g*D,r[10]=p*_+d*T+m*k+g*F,r[14]=p*S+d*A+m*R+g*n,r[3]=v*x+y*M+b*E+i*L,r[7]=v*w+y*C+b*P+i*D,r[11]=v*_+y*T+b*k+i*F,r[15]=v*S+y*A+b*R+i*n,this},multiplyToArray:function(e,t,i){var n=this.elements;return this.multiplyMatrices(e,t),i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},multiplyVector3:function(e){return console.warn("DEPRECATED: Matrix4's .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)},multiplyVector4:function(e){return console.warn("DEPRECATED: Matrix4's .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){var t=new e.Vector3;return function(e){for(var i=0,n=e.length;n>i;i+=3)t.x=e[i],t.y=e[i+1],t.z=e[i+2],t.applyProjection(this),e[i]=t.x,e[i+1]=t.y,e[i+2]=t.z;return e}}(),rotateAxis:function(e){console.warn("DEPRECATED: Matrix4's .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("DEPRECATED: Matrix4's .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},determinant:function(){var e=this.elements,t=e[0],i=e[4],n=e[8],r=e[12],o=e[1],a=e[5],s=e[9],l=e[13],c=e[2],h=e[6],u=e[10],f=e[14];return e[3]*(+r*s*h-n*l*h-r*a*u+i*l*u+n*a*f-i*s*f)+e[7]*(+t*s*f-t*l*u+r*o*u-n*o*f+n*l*c-r*s*c)+e[11]*(+t*l*h-t*a*f-r*o*h+i*o*f+r*a*c-i*l*c)+e[15]*(-n*a*c-t*s*h+t*a*u+n*o*h-i*o*u+i*s*c)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},flattenToArrayOffset:function(e,t){var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e},getPosition:function(){var t=new e.Vector3;return function(){console.warn("DEPRECATED: Matrix4's .getPosition() has been removed. Use Vector3.getPositionFromMatrix( matrix ) instead.");var e=this.elements;return t.set(e[12],e[13],e[14])}}(),setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var i=this.elements,n=e.elements,r=n[0],o=n[4],a=n[8],s=n[12],l=n[1],c=n[5],h=n[9],u=n[13],f=n[2],p=n[6],d=n[10],m=n[14],g=n[3],v=n[7],y=n[11],b=n[15];if(i[0]=h*m*v-u*d*v+u*p*y-c*m*y-h*p*b+c*d*b,i[4]=s*d*v-a*m*v-s*p*y+o*m*y+a*p*b-o*d*b,i[8]=a*u*v-s*h*v+s*c*y-o*u*y-a*c*b+o*h*b,i[12]=s*h*p-a*u*p-s*c*d+o*u*d+a*c*m-o*h*m,i[1]=u*d*g-h*m*g-u*f*y+l*m*y+h*f*b-l*d*b,i[5]=a*m*g-s*d*g+s*f*y-r*m*y-a*f*b+r*d*b,i[9]=s*h*g-a*u*g-s*l*y+r*u*y+a*l*b-r*h*b,i[13]=a*u*f-s*h*f+s*l*d-r*u*d-a*l*m+r*h*m,i[2]=c*m*g-u*p*g+u*f*v-l*m*v-c*f*b+l*p*b,i[6]=s*p*g-o*m*g-s*f*v+r*m*v+o*f*b-r*p*b,i[10]=o*u*g-s*c*g+s*l*v-r*u*v-o*l*b+r*c*b,i[14]=s*c*f-o*u*f-s*l*p+r*u*p+o*l*m-r*c*m,i[3]=h*p*g-c*d*g-h*f*v+l*d*v+c*f*y-l*p*y,i[7]=o*d*g-a*p*g+a*f*v-r*d*v-o*f*y+r*p*y,i[11]=a*c*g-o*h*g-a*l*v+r*h*v+o*l*y-r*c*y,i[15]=o*h*f-a*c*f+a*l*p-r*h*p-o*l*d+r*c*d,i=n[0]*i[0]+n[1]*i[4]+n[2]*i[8]+n[3]*i[12],0==i){if(t)throw Error("Matrix4.getInverse(): can't invert matrix, determinant is 0");return console.warn("Matrix4.getInverse(): can't invert matrix, determinant is 0"),this.identity(),this}return this.multiplyScalar(1/i),this},translate:function(){console.warn("DEPRECATED: Matrix4's .translate() has been removed.")},rotateX:function(){console.warn("DEPRECATED: Matrix4's .rotateX() has been removed.")},rotateY:function(){console.warn("DEPRECATED: Matrix4's .rotateY() has been removed.")},rotateZ:function(){console.warn("DEPRECATED: Matrix4's .rotateZ() has been removed.")},rotateByAxis:function(){console.warn("DEPRECATED: Matrix4's .rotateByAxis() has been removed.")},scale:function(e){var t=this.elements,i=e.x,n=e.y,e=e.z;return t[0]*=i,t[4]*=n,t[8]*=e,t[1]*=i,t[5]*=n,t[9]*=e,t[2]*=i,t[6]*=n,t[10]*=e,t[3]*=i,t[7]*=n,t[11]*=e,this},getMaxScaleOnAxis:function(){var e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],Math.max(e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10])))},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t),n=Math.sin(t),r=1-i,o=e.x,a=e.y,s=e.z,l=r*o,c=r*a;return this.set(l*o+i,l*a-n*s,l*s+n*a,0,l*a+n*s,c*a+i,c*s-n*o,0,l*s-n*a,c*s+n*o,r*s*s+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},compose:function(e,t,i){return console.warn("DEPRECATED: Matrix4's .compose() has been deprecated in favor of makeFromPositionQuaternionScale. Please update your code."),this.makeFromPositionQuaternionScale(e,t,i)},makeFromPositionQuaternionScale:function(e,t,i){return this.makeRotationFromQuaternion(t),this.scale(i),this.setPosition(e),this},makeFromPositionEulerScale:function(e,t,i,n){return this.makeRotationFromEuler(t,i),this.scale(n),this.setPosition(e),this},makeFrustum:function(e,t,i,n,r,o){var a=this.elements;return a[0]=2*r/(t-e),a[4]=0,a[8]=(t+e)/(t-e),a[12]=0,a[1]=0,a[5]=2*r/(n-i),a[9]=(n+i)/(n-i),a[13]=0,a[2]=0,a[6]=0,a[10]=-(o+r)/(o-r),a[14]=-2*o*r/(o-r),a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makePerspective:function(t,i,n,r){var t=n*Math.tan(e.Math.degToRad(.5*t)),o=-t;return this.makeFrustum(o*i,t*i,o,t,n,r)},makeOrthographic:function(e,t,i,n,r,o){var a=this.elements,s=t-e,l=i-n,c=o-r;return a[0]=2/s,a[4]=0,a[8]=0,a[12]=-((t+e)/s),a[1]=0,a[5]=2/l,a[9]=0,a[13]=-((i+n)/l),a[2]=0,a[6]=0,a[10]=-2/c,a[14]=-((o+r)/c),a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},clone:function(){var t=this.elements;return new e.Matrix4(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15])}},e.extend(e.Matrix4.prototype,{decompose:function(){var t=new e.Vector3,i=new e.Vector3,n=new e.Vector3,r=new e.Matrix4;return function(o,a,s){var l=this.elements;return t.set(l[0],l[1],l[2]),i.set(l[4],l[5],l[6]),n.set(l[8],l[9],l[10]),o=o instanceof e.Vector3?o:new e.Vector3,a=a instanceof e.Quaternion?a:new e.Quaternion,s=s instanceof e.Vector3?s:new e.Vector3,s.x=t.length(),s.y=i.length(),s.z=n.length(),o.x=l[12],o.y=l[13],o.z=l[14],r.copy(this),r.elements[0]/=s.x,r.elements[1]/=s.x,r.elements[2]/=s.x,r.elements[4]/=s.y,r.elements[5]/=s.y,r.elements[6]/=s.y,r.elements[8]/=s.z,r.elements[9]/=s.z,r.elements[10]/=s.z,a.setFromRotationMatrix(r),[o,a,s]}}()}),e.Ray=function(t,i){this.origin=void 0!==t?t:new e.Vector3,this.direction=void 0!==i?i:new e.Vector3},e.Ray.prototype={constructor:e.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(t,i){return(i||new e.Vector3).copy(this.direction).multiplyScalar(t).add(this.origin)},recast:function(){var t=new e.Vector3;return function(e){return this.origin.copy(this.at(e,t)),this}}(),closestPointToPoint:function(t,i){var n=i||new e.Vector3;n.subVectors(t,this.origin);var r=n.dot(this.direction);return n.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(){var t=new e.Vector3;return function(e){var i=t.subVectors(e,this.origin).dot(this.direction);return t.copy(this.direction).multiplyScalar(i).add(this.origin),t.distanceTo(e)}}(),isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},isIntersectionPlane:function(e){return 0!=e.normal.dot(this.direction)||0==e.distanceToPoint(this.origin)?!0:!1},distanceToPlane:function(e){var t=e.normal.dot(this.direction);return 0!=t?-(this.origin.dot(e.normal)+e.constant)/t:0==e.distanceToPoint(this.origin)?0:void 0},intersectPlane:function(e,t){var i=this.distanceToPlane(e);return void 0===i?void 0:this.at(i,t)},applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new e.Ray).copy(this)}},e.Sphere=function(t,i){this.center=void 0!==t?t:new e.Vector3,this.radius=void 0!==i?i:0},e.Sphere.prototype={constructor:e.Sphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromCenterAndPoints:function(e,t){for(var i=0,n=0,r=t.length;r>n;n++)var o=e.distanceToSquared(t[n]),i=Math.max(i,o);return this.center=e,this.radius=Math.sqrt(i),this},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return 0>=this.radius},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(t,i){var n=this.center.distanceToSquared(t),r=i||new e.Vector3;return r.copy(t),n>this.radius*this.radius&&(r.sub(this.center).normalize(),r.multiplyScalar(this.radius).add(this.center)),r},getBoundingBox:function(t){return t=t||new e.Box3,t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius*=e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new e.Sphere).copy(this)}},e.Frustum=function(t,i,n,r,o,a){this.planes=[void 0!==t?t:new e.Plane,void 0!==i?i:new e.Plane,void 0!==n?n:new e.Plane,void 0!==r?r:new e.Plane,void 0!==o?o:new e.Plane,void 0!==a?a:new e.Plane]},e.Frustum.prototype={constructor:e.Frustum,set:function(e,t,i,n,r,o){var a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(n),a[4].copy(r),a[5].copy(o),this},copy:function(e){for(var t=this.planes,i=0;6>i;i++)t[i].copy(e.planes[i]);return this},setFromMatrix:function(e){var t=this.planes,i=e.elements,e=i[0],n=i[1],r=i[2],o=i[3],a=i[4],s=i[5],l=i[6],c=i[7],h=i[8],u=i[9],f=i[10],p=i[11],d=i[12],m=i[13],g=i[14],i=i[15];return t[0].setComponents(o-e,c-a,p-h,i-d).normalize(),t[1].setComponents(o+e,c+a,p+h,i+d).normalize(),t[2].setComponents(o+n,c+s,p+u,i+m).normalize(),t[3].setComponents(o-n,c-s,p-u,i-m).normalize(),t[4].setComponents(o-r,c-l,p-f,i-g).normalize(),t[5].setComponents(o+r,c+l,p+f,i+g).normalize(),this},intersectsObject:function(){var t=new e.Vector3;return function(e){var i=e.matrixWorld,n=this.planes,e=-e.geometry.boundingSphere.radius*i.getMaxScaleOnAxis();for(t.getPositionFromMatrix(i),i=0;6>i;i++)if(n[i].distanceToPoint(t)<e)return!1;return!0}}(),intersectsSphere:function(e){for(var t=this.planes,i=e.center,e=-e.radius,n=0;6>n;n++)if(t[n].distanceToPoint(i)<e)return!1;return!0},containsPoint:function(e){for(var t=this.planes,i=0;6>i;i++)if(0>t[i].distanceToPoint(e))return!1;return!0},clone:function(){return(new e.Frustum).copy(this)}},e.Plane=function(t,i){this.normal=void 0!==t?t:new e.Vector3(1,0,0),this.constant=void 0!==i?i:0},e.Plane.prototype={constructor:e.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,i,n){return this.normal.set(e,t,i),this.constant=n,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var t=new e.Vector3,i=new e.Vector3;return function(e,n,r){return n=t.subVectors(r,n).cross(i.subVectors(e,n)).normalize(),this.setFromNormalAndCoplanarPoint(n,e),this}}(),copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(t,i){var n=this.distanceToPoint(t);return(i||new e.Vector3).copy(this.normal).multiplyScalar(n)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start),e=this.distanceToPoint(e.end);return 0>t&&e>0||0>e&&t>0},intersectLine:function(){var t=new e.Vector3;return function(i,n){var r=n||new e.Vector3,o=i.delta(t),a=this.normal.dot(o);return 0!=a?(a=-(i.start.dot(this.normal)+this.constant)/a,0>a||a>1?void 0:r.copy(o).multiplyScalar(a).add(i.start)):0==this.distanceToPoint(i.start)?r.copy(i.start):void 0}}(),coplanarPoint:function(t){return(t||new e.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var t=new e.Vector3,i=new e.Vector3;return function(n,r){var r=r||(new e.Matrix3).getNormalMatrix(n),o=t.copy(this.normal).applyMatrix3(r),a=this.coplanarPoint(i);return a.applyMatrix4(n),this.setFromNormalAndCoplanarPoint(o,a),this}}(),translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new e.Plane).copy(this)}},e.Math={clamp:function(e,t,i){return t>e?t:e>i?i:e},clampBottom:function(e,t){return t>e?t:e},mapLinear:function(e,t,i,n,r){return n+(e-t)*(r-n)/(i-t)},smoothstep:function(e,t,i){return t>=e?0:e>=i?1:(e=(e-t)/(i-t),e*e*(3-2*e))},smootherstep:function(e,t,i){return t>=e?0:e>=i?1:(e=(e-t)/(i-t),e*e*e*(e*(6*e-15)+10))},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},sign:function(e){return 0>e?-1:e>0?1:0},degToRad:function(){var e=Math.PI/180;return function(t){return t*e}}(),radToDeg:function(){var e=180/Math.PI;return function(t){return t*e}}()},e.Spline=function(t){function i(e,t,i,n,r,o,a){return e=.5*(i-e),n=.5*(n-t),(2*(t-i)+e+n)*a+(-3*(t-i)-2*e-n)*o+e*r+t}this.points=t;var n,r,o,a,s,l,c,h,u,f=[],p={x:0,y:0,z:0};this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return n=(this.points.length-1)*e,r=Math.floor(n),o=n-r,f[0]=0===r?r:r-1,f[1]=r,f[2]=r>this.points.length-2?this.points.length-1:r+1,f[3]=r>this.points.length-3?this.points.length-1:r+2,l=this.points[f[0]],c=this.points[f[1]],h=this.points[f[2]],u=this.points[f[3]],a=o*o,s=o*a,p.x=i(l.x,c.x,h.x,u.x,o,a,s),p.y=i(l.y,c.y,h.y,u.y,o,a,s),p.z=i(l.z,c.z,h.z,u.z,o,a,s),p},this.getControlPointsArray=function(){var e,t,i=this.points.length,n=[];for(e=0;i>e;e++)t=this.points[e],n[e]=[t.x,t.y,t.z];return n},this.getLength=function(t){var i,n,r,o=i=i=0,a=new e.Vector3,s=new e.Vector3,l=[],c=0;for(l[0]=0,t||(t=100),n=this.points.length*t,a.copy(this.points[0]),t=1;n>t;t++)i=t/n,r=this.getPoint(i),s.copy(r),c+=s.distanceTo(a),a.copy(r),i*=this.points.length-1,i=Math.floor(i),i!=o&&(l[i]=c,o=i);return l[l.length]=c,{chunks:l,total:c}},this.reparametrizeByArcLength=function(t){var i,n,r,o,a,s,l=[],c=new e.Vector3,h=this.getLength();for(l.push(c.copy(this.points[0]).clone()),i=1;i<this.points.length;i++){for(n=h.chunks[i]-h.chunks[i-1],s=Math.ceil(t*n/h.total),o=(i-1)/(this.points.length-1),a=i/(this.points.length-1),n=1;s-1>n;n++)r=o+n*(1/s)*(a-o),r=this.getPoint(r),l.push(c.copy(r).clone());l.push(c.copy(this.points[i]).clone())}this.points=l}},e.Triangle=function(t,i,n){this.a=void 0!==t?t:new e.Vector3,this.b=void 0!==i?i:new e.Vector3,this.c=void 0!==n?n:new e.Vector3},e.Triangle.normal=function(){var t=new e.Vector3;return function(i,n,r,o){return o=o||new e.Vector3,o.subVectors(r,n),t.subVectors(i,n),o.cross(t),i=o.lengthSq(),i>0?o.multiplyScalar(1/Math.sqrt(i)):o.set(0,0,0)}}(),e.Triangle.barycoordFromPoint=function(){var t=new e.Vector3,i=new e.Vector3,n=new e.Vector3;return function(r,o,a,s,l){t.subVectors(s,o),i.subVectors(a,o),n.subVectors(r,o);var r=t.dot(t),o=t.dot(i),a=t.dot(n),c=i.dot(i),s=i.dot(n),h=r*c-o*o,l=l||new e.Vector3;return 0==h?l.set(-2,-1,-1):(h=1/h,c=(c*a-o*s)*h,r=(r*s-o*a)*h,l.set(1-c-r,r,c))}}(),e.Triangle.containsPoint=function(){var t=new e.Vector3;
return function(i,n,r,o){return i=e.Triangle.barycoordFromPoint(i,n,r,o,t),0<=i.x&&0<=i.y&&1>=i.x+i.y}}(),e.Triangle.prototype={constructor:e.Triangle,set:function(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this},setFromPointsAndIndices:function(e,t,i,n){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[n]),this},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var t=new e.Vector3,i=new e.Vector3;return function(){return t.subVectors(this.c,this.b),i.subVectors(this.a,this.b),.5*t.cross(i).length()}}(),midpoint:function(t){return(t||new e.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(t){return e.Triangle.normal(this.a,this.b,this.c,t)},plane:function(t){return(t||new e.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(t,i){return e.Triangle.barycoordFromPoint(t,this.a,this.b,this.c,i)},containsPoint:function(t){return e.Triangle.containsPoint(t,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return(new e.Triangle).copy(this)}},e.Vertex=function(e){return console.warn("THREE.Vertex has been DEPRECATED. Use THREE.Vector3 instead."),e},e.UV=function(t,i){return console.warn("THREE.UV has been DEPRECATED. Use THREE.Vector2 instead."),new e.Vector2(t,i)},e.Clock=function(e){this.autoStart=void 0!==e?e:!0,this.elapsedTime=this.oldTime=this.startTime=0,this.running=!1},e.Clock.prototype={constructor:e.Clock,start:function(){this.oldTime=this.startTime=void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now(),this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running&&this.start(),this.running){var t=void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now(),e=.001*(t-this.oldTime);this.oldTime=t,this.elapsedTime+=e}return e}},e.EventDispatcher=function(){},e.EventDispatcher.prototype={constructor:e.EventDispatcher,addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)?!0:!1},removeEventListener:function(e,t){if(void 0!==this._listeners){var i=this._listeners,n=i[e].indexOf(t);-1!==n&&i[e].splice(n,1)}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var i=0,n=t.length;n>i;i++)t[i].call(this,e)}}}},function(e){e.Raycaster=function(t,i,n,r){this.ray=new e.Ray(t,i),0<this.ray.direction.lengthSq()&&this.ray.direction.normalize(),this.near=n||0,this.far=r||1/0};var t=new e.Sphere,i=new e.Ray,n=new e.Plane,r=new e.Vector3,o=new e.Vector3,a=new e.Matrix4,s=function(e,t){return e.distance-t.distance},l=function(s,c,h){if(s instanceof e.Particle){o.getPositionFromMatrix(s.matrixWorld);var u=c.ray.distanceToPoint(o);if(u>s.scale.x)return h;h.push({distance:u,point:s.position,face:null,object:s})}else if(s instanceof e.LOD)o.getPositionFromMatrix(s.matrixWorld),u=c.ray.origin.distanceTo(o),l(s.getObjectForDistance(u),c,h);else if(s instanceof e.Mesh){if(o.getPositionFromMatrix(s.matrixWorld),t.set(o,s.geometry.boundingSphere.radius*s.matrixWorld.getMaxScaleOnAxis()),!c.ray.isIntersectionSphere(t))return h;var f,p,d,u=s.geometry,m=u.vertices,g=s.material instanceof e.MeshFaceMaterial,v=!0===g?s.material.materials:null,y=s.material.side,b=c.precision;a.getInverse(s.matrixWorld),i.copy(c.ray).applyMatrix4(a);for(var x=0,w=u.faces.length;w>x;x++){var _=u.faces[x],y=!0===g?v[_.materialIndex]:s.material;if(void 0!==y){n.setFromNormalAndCoplanarPoint(_.normal,m[_.a]);var S=i.distanceToPlane(n);if(!(Math.abs(S)<b||0>S)){if(y=y.side,y!==e.DoubleSide&&(f=i.direction.dot(n.normal),!(y===e.FrontSide?0>f:f>0)))continue;if(!(S<c.near||S>c.far)){if(r=i.at(S,r),_ instanceof e.Face3){if(y=m[_.a],f=m[_.b],p=m[_.c],!e.Triangle.containsPoint(r,y,f,p))continue}else{if(!(_ instanceof e.Face4))throw Error("face type not supported");if(y=m[_.a],f=m[_.b],p=m[_.c],d=m[_.d],!e.Triangle.containsPoint(r,y,f,d)&&!e.Triangle.containsPoint(r,f,p,d))continue}h.push({distance:S,point:c.ray.at(S),face:_,faceIndex:x,object:s})}}}}}},c=function(e,t,i){for(var e=e.getDescendants(),n=0,r=e.length;r>n;n++)l(e[n],t,i)};e.Raycaster.prototype.precision=1e-4,e.Raycaster.prototype.set=function(e,t){this.ray.set(e,t),0<this.ray.direction.length()&&this.ray.direction.normalize()},e.Raycaster.prototype.intersectObject=function(e,t){var i=[];return!0===t&&c(e,this,i),l(e,this,i),i.sort(s),i},e.Raycaster.prototype.intersectObjects=function(e,t){for(var i=[],n=0,r=e.length;r>n;n++)l(e[n],this,i),!0===t&&c(e[n],this,i);return i.sort(s),i}}(e),e.Object3D=function(){this.id=e.Object3DIdCount++,this.name="",this.parent=void 0,this.children=[],this.up=new e.Vector3(0,1,0),this.position=new e.Vector3,this.rotation=new e.Vector3,this.eulerOrder=e.Object3D.defaultEulerOrder,this.scale=new e.Vector3(1,1,1),this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new e.Matrix4,this.matrixWorld=new e.Matrix4,this.matrixWorldNeedsUpdate=this.matrixAutoUpdate=!0,this.quaternion=new e.Quaternion,this.useQuaternion=!1,this.visible=!0,this.receiveShadow=this.castShadow=!1,this.frustumCulled=!0,this.userData={}},e.Object3D.prototype={constructor:e.Object3D,applyMatrix:function(){var t=new e.Matrix4;return function(e){this.matrix.multiplyMatrices(e,this.matrix),this.position.getPositionFromMatrix(this.matrix),this.scale.getScaleFromMatrix(this.matrix),t.extractRotation(this.matrix),!0===this.useQuaternion?this.quaternion.setFromRotationMatrix(t):this.rotation.setEulerFromRotationMatrix(t,this.eulerOrder)}}(),rotateOnAxis:function(){var t=new e.Quaternion,i=new e.Quaternion;return function(e,n){return t.setFromAxisAngle(e,n),!0===this.useQuaternion?this.quaternion.multiply(t):(i.setFromEuler(this.rotation,this.eulerOrder),i.multiply(t),this.rotation.setEulerFromQuaternion(i,this.eulerOrder)),this}}(),translateOnAxis:function(){var t=new e.Vector3;return function(e,i){return t.copy(e),!0===this.useQuaternion?t.applyQuaternion(this.quaternion):t.applyEuler(this.rotation,this.eulerOrder),this.position.add(t.multiplyScalar(i)),this}}(),translate:function(e,t){return console.warn("DEPRECATED: Object3D's .translate() has been removed. Use .translateOnAxis( axis, distance ) instead. Note args have been changed."),this.translateOnAxis(t,e)},translateX:function(){var t=new e.Vector3(1,0,0);return function(e){return this.translateOnAxis(t,e)}}(),translateY:function(){var t=new e.Vector3(0,1,0);return function(e){return this.translateOnAxis(t,e)}}(),translateZ:function(){var t=new e.Vector3(0,0,1);return function(e){return this.translateOnAxis(t,e)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var t=new e.Matrix4;return function(e){return e.applyMatrix4(t.getInverse(this.matrixWorld))}}(),lookAt:function(){var t=new e.Matrix4;return function(e){t.lookAt(e,this.position,this.up),!0===this.useQuaternion?this.quaternion.setFromRotationMatrix(t):this.rotation.setEulerFromRotationMatrix(t,this.eulerOrder)}}(),add:function(t){if(t===this)console.warn("THREE.Object3D.add: An object can't be added as a child of itself.");else if(t instanceof e.Object3D){void 0!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t);for(var i=this;void 0!==i.parent;)i=i.parent;void 0!==i&&i instanceof e.Scene&&i.__addObject(t)}},remove:function(t){var i=this.children.indexOf(t);if(-1!==i){for(t.parent=void 0,this.children.splice(i,1),i=this;void 0!==i.parent;)i=i.parent;void 0!==i&&i instanceof e.Scene&&i.__removeObject(t)}},traverse:function(e){e(this);for(var t=0,i=this.children.length;i>t;t++)this.children[t].traverse(e)},getObjectById:function(e,t){for(var i=0,n=this.children.length;n>i;i++){var r=this.children[i];if(r.id===e||!0===t&&(r=r.getObjectById(e,t),void 0!==r))return r}},getObjectByName:function(e,t){for(var i=0,n=this.children.length;n>i;i++){var r=this.children[i];if(r.name===e||!0===t&&(r=r.getObjectByName(e,t),void 0!==r))return r}},getChildByName:function(e,t){return console.warn("DEPRECATED: Object3D's .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e,t)},getDescendants:function(e){void 0===e&&(e=[]),Array.prototype.push.apply(e,this.children);for(var t=0,i=this.children.length;i>t;t++)this.children[t].getDescendants(e);return e},updateMatrix:function(){!1===this.useQuaternion?this.matrix.makeFromPositionEulerScale(this.position,this.rotation,this.eulerOrder,this.scale):this.matrix.makeFromPositionQuaternionScale(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){!0===this.matrixAutoUpdate&&this.updateMatrix(),(!0===this.matrixWorldNeedsUpdate||!0===e)&&(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,i=this.children.length;i>t;t++)this.children[t].updateMatrixWorld(e)},clone:function(t){void 0===t&&(t=new e.Object3D),t.name=this.name,t.up.copy(this.up),t.position.copy(this.position),t.rotation instanceof e.Vector3&&t.rotation.copy(this.rotation),t.eulerOrder=this.eulerOrder,t.scale.copy(this.scale),t.renderDepth=this.renderDepth,t.rotationAutoUpdate=this.rotationAutoUpdate,t.matrix.copy(this.matrix),t.matrixWorld.copy(this.matrixWorld),t.matrixAutoUpdate=this.matrixAutoUpdate,t.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,t.quaternion.copy(this.quaternion),t.useQuaternion=this.useQuaternion,t.visible=this.visible,t.castShadow=this.castShadow,t.receiveShadow=this.receiveShadow,t.frustumCulled=this.frustumCulled,t.userData=JSON.parse(JSON.stringify(this.userData));for(var i=0;i<this.children.length;i++)t.add(this.children[i].clone());return t}},e.Object3D.defaultEulerOrder="XYZ",e.Object3DIdCount=0,e.Projector=function(){function t(){if(a===y){var t=new e.RenderableObject;return v.push(t),y++,a++,t}return v[a++]}function i(){if(l===x){var t=new e.RenderableVertex;return b.push(t),x++,l++,t}return b[l++]}function n(e,t){return t.z-e.z}function r(e,t){var i=0,n=1,r=e.z+e.w,o=t.z+t.w,a=-e.z+e.w,s=-t.z+t.w;return r>=0&&o>=0&&a>=0&&s>=0?!0:0>r&&0>o||0>a&&0>s?!1:(0>r?i=Math.max(i,r/(r-o)):0>o&&(n=Math.min(n,r/(r-o))),0>a?i=Math.max(i,a/(a-s)):0>s&&(n=Math.min(n,a/(a-s))),i>n?!1:(e.lerp(t,i),t.lerp(e,1-n),!0))}var o,a,s,l,c,h,u,f,p,d,m,g,v=[],y=0,b=[],x=0,w=[],_=0,S=[],M=0,C=[],T=0,A=[],E=0,P={objects:[],sprites:[],lights:[],elements:[]},k=new e.Vector3,R=new e.Vector4,L=new e.Box3(new e.Vector3(-1,-1,-1),new e.Vector3(1,1,1)),D=new e.Box3,F=Array(3),G=Array(4),N=new e.Matrix4,V=new e.Matrix4,O=new e.Matrix4,j=new e.Matrix3,I=new e.Matrix3,U=new e.Vector3,z=new e.Frustum,B=new e.Vector4,H=new e.Vector4;this.projectVector=function(e,t){return t.matrixWorldInverse.getInverse(t.matrixWorld),V.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),e.applyProjection(V)},this.unprojectVector=function(e,t){return t.projectionMatrixInverse.getInverse(t.projectionMatrix),V.multiplyMatrices(t.matrixWorld,t.projectionMatrixInverse),e.applyProjection(V)},this.pickingRay=function(t,i){t.z=-1;var n=new e.Vector3(t.x,t.y,1);return this.unprojectVector(t,i),this.unprojectVector(n,i),n.sub(t).normalize(),new e.Raycaster(t,n)},this.projectScene=function(v,y,x,q){var W,X,Y,K,$,Q,Z,J,et,tt,it,nt,rt,ot=!1;m=p=u=h=0,P.elements.length=0,!0===v.autoUpdate&&v.updateMatrixWorld(),void 0===y.parent&&y.updateMatrixWorld(),N.copy(y.matrixWorldInverse.getInverse(y.matrixWorld)),V.multiplyMatrices(y.projectionMatrix,N),I.getNormalMatrix(N),z.setFromMatrix(V),a=0,P.objects.length=0,P.sprites.length=0,P.lights.length=0;var at=function(i){for(var n=0,r=i.children.length;r>n;n++){var a=i.children[n];!1!==a.visible&&(a instanceof e.Light?P.lights.push(a):a instanceof e.Mesh||a instanceof e.Line?(!1===a.frustumCulled||!0===z.intersectsObject(a))&&(o=t(),o.object=a,null!==a.renderDepth?o.z=a.renderDepth:(k.getPositionFromMatrix(a.matrixWorld),k.applyProjection(V),o.z=k.z),P.objects.push(o)):a instanceof e.Sprite||a instanceof e.Particle?(o=t(),o.object=a,null!==a.renderDepth?o.z=a.renderDepth:(k.getPositionFromMatrix(a.matrixWorld),k.applyProjection(V),o.z=k.z),P.sprites.push(o)):(o=t(),o.object=a,null!==a.renderDepth?o.z=a.renderDepth:(k.getPositionFromMatrix(a.matrixWorld),k.applyProjection(V),o.z=k.z),P.objects.push(o)),at(a))}};for(at(v),!0===x&&P.objects.sort(n),v=0,x=P.objects.length;x>v;v++)if(J=P.objects[v].object,g=J.matrixWorld,l=0,J instanceof e.Mesh){for(et=J.geometry,Y=et.vertices,tt=et.faces,et=et.faceVertexUvs,j.getNormalMatrix(g),nt=J.material instanceof e.MeshFaceMaterial,rt=!0===nt?J.material:null,W=0,X=Y.length;X>W;W++)s=i(),s.positionWorld.copy(Y[W]).applyMatrix4(g),s.positionScreen.copy(s.positionWorld).applyMatrix4(V),s.positionScreen.x/=s.positionScreen.w,s.positionScreen.y/=s.positionScreen.w,s.positionScreen.z/=s.positionScreen.w,s.visible=!(-1>s.positionScreen.x||1<s.positionScreen.x||-1>s.positionScreen.y||1<s.positionScreen.y||-1>s.positionScreen.z||1<s.positionScreen.z);for(Y=0,W=tt.length;W>Y;Y++){X=tt[Y];var st=!0===nt?rt.materials[X.materialIndex]:J.material;if(void 0!==st){if(Q=st.side,X instanceof e.Face3){if(K=b[X.a],$=b[X.b],Z=b[X.c],F[0]=K.positionScreen,F[1]=$.positionScreen,F[2]=Z.positionScreen,!0!==K.visible&&!0!==$.visible&&!0!==Z.visible&&!L.isIntersectionBox(D.setFromPoints(F)))continue;if(ot=0>(Z.positionScreen.x-K.positionScreen.x)*($.positionScreen.y-K.positionScreen.y)-(Z.positionScreen.y-K.positionScreen.y)*($.positionScreen.x-K.positionScreen.x),Q!==e.DoubleSide&&ot!==(Q===e.FrontSide))continue;h===_?(it=new e.RenderableFace3,w.push(it),_++,h++,c=it):c=w[h++],c.v1.copy(K),c.v2.copy($),c.v3.copy(Z)}else if(X instanceof e.Face4){if(K=b[X.a],$=b[X.b],Z=b[X.c],it=b[X.d],G[0]=K.positionScreen,G[1]=$.positionScreen,G[2]=Z.positionScreen,G[3]=it.positionScreen,!0!==K.visible&&!0!==$.visible&&!0!==Z.visible&&!0!==it.visible&&!L.isIntersectionBox(D.setFromPoints(G)))continue;if(ot=0>(it.positionScreen.x-K.positionScreen.x)*($.positionScreen.y-K.positionScreen.y)-(it.positionScreen.y-K.positionScreen.y)*($.positionScreen.x-K.positionScreen.x)||0>($.positionScreen.x-Z.positionScreen.x)*(it.positionScreen.y-Z.positionScreen.y)-($.positionScreen.y-Z.positionScreen.y)*(it.positionScreen.x-Z.positionScreen.x),Q!==e.DoubleSide&&ot!==(Q===e.FrontSide))continue;if(u===M){var lt=new e.RenderableFace4;S.push(lt),M++,u++,c=lt}else c=S[u++];c.v1.copy(K),c.v2.copy($),c.v3.copy(Z),c.v4.copy(it)}for(c.normalModel.copy(X.normal),!1===ot&&(Q===e.BackSide||Q===e.DoubleSide)&&c.normalModel.negate(),c.normalModel.applyMatrix3(j).normalize(),c.normalModelView.copy(c.normalModel).applyMatrix3(I),c.centroidModel.copy(X.centroid).applyMatrix4(g),Z=X.vertexNormals,K=0,$=Z.length;$>K;K++)it=c.vertexNormalsModel[K],it.copy(Z[K]),!1===ot&&(Q===e.BackSide||Q===e.DoubleSide)&&it.negate(),it.applyMatrix3(j).normalize(),c.vertexNormalsModelView[K].copy(it).applyMatrix3(I);for(c.vertexNormalsLength=Z.length,K=0,$=et.length;$>K;K++)if(it=et[K][Y],void 0!==it)for(Q=0,Z=it.length;Z>Q;Q++)c.uvs[K][Q]=it[Q];c.color=X.color,c.material=st,U.copy(c.centroidModel).applyProjection(V),c.z=U.z,P.elements.push(c)}}}else if(J instanceof e.Line)for(O.multiplyMatrices(V,g),Y=J.geometry.vertices,K=i(),K.positionScreen.copy(Y[0]).applyMatrix4(O),tt=J.type===e.LinePieces?2:1,W=1,X=Y.length;X>W;W++)K=i(),K.positionScreen.copy(Y[W]).applyMatrix4(O),(W+1)%tt>0||($=b[l-2],B.copy(K.positionScreen),H.copy($.positionScreen),!0===r(B,H)&&(B.multiplyScalar(1/B.w),H.multiplyScalar(1/H.w),p===T?(et=new e.RenderableLine,C.push(et),T++,p++,f=et):f=C[p++],f.v1.positionScreen.copy(B),f.v2.positionScreen.copy(H),f.z=Math.max(B.z,H.z),f.material=J.material,J.material.vertexColors===e.VertexColors&&(f.vertexColors[0].copy(J.geometry.colors[W]),f.vertexColors[1].copy(J.geometry.colors[W-1])),P.elements.push(f)));for(v=0,x=P.sprites.length;x>v;v++)J=P.sprites[v].object,g=J.matrixWorld,J instanceof e.Particle&&(R.set(g.elements[12],g.elements[13],g.elements[14],1),R.applyMatrix4(V),R.z/=R.w,0<R.z&&1>R.z&&(m===E?(ot=new e.RenderableParticle,A.push(ot),E++,m++,d=ot):d=A[m++],d.object=J,d.x=R.x/R.w,d.y=R.y/R.w,d.z=R.z,d.rotation=J.rotation.z,d.scale.x=J.scale.x*Math.abs(d.x-(R.x+y.projectionMatrix.elements[0])/(R.w+y.projectionMatrix.elements[12])),d.scale.y=J.scale.y*Math.abs(d.y-(R.y+y.projectionMatrix.elements[5])/(R.w+y.projectionMatrix.elements[13])),d.material=J.material,P.elements.push(d)));return!0===q&&P.elements.sort(n),P}},e.Face3=function(t,i,n,r,o,a){this.a=t,this.b=i,this.c=n,this.normal=r instanceof e.Vector3?r:new e.Vector3,this.vertexNormals=r instanceof Array?r:[],this.color=o instanceof e.Color?o:new e.Color,this.vertexColors=o instanceof Array?o:[],this.vertexTangents=[],this.materialIndex=void 0!==a?a:0,this.centroid=new e.Vector3},e.Face3.prototype={constructor:e.Face3,clone:function(){var t=new e.Face3(this.a,this.b,this.c);t.normal.copy(this.normal),t.color.copy(this.color),t.centroid.copy(this.centroid),t.materialIndex=this.materialIndex;var i,n;for(i=0,n=this.vertexNormals.length;n>i;i++)t.vertexNormals[i]=this.vertexNormals[i].clone();for(i=0,n=this.vertexColors.length;n>i;i++)t.vertexColors[i]=this.vertexColors[i].clone();for(i=0,n=this.vertexTangents.length;n>i;i++)t.vertexTangents[i]=this.vertexTangents[i].clone();return t}},e.Face4=function(t,i,n,r,o,a,s){this.a=t,this.b=i,this.c=n,this.d=r,this.normal=o instanceof e.Vector3?o:new e.Vector3,this.vertexNormals=o instanceof Array?o:[],this.color=a instanceof e.Color?a:new e.Color,this.vertexColors=a instanceof Array?a:[],this.vertexTangents=[],this.materialIndex=void 0!==s?s:0,this.centroid=new e.Vector3},e.Face4.prototype={constructor:e.Face4,clone:function(){var t=new e.Face4(this.a,this.b,this.c,this.d);t.normal.copy(this.normal),t.color.copy(this.color),t.centroid.copy(this.centroid),t.materialIndex=this.materialIndex;var i,n;for(i=0,n=this.vertexNormals.length;n>i;i++)t.vertexNormals[i]=this.vertexNormals[i].clone();for(i=0,n=this.vertexColors.length;n>i;i++)t.vertexColors[i]=this.vertexColors[i].clone();for(i=0,n=this.vertexTangents.length;n>i;i++)t.vertexTangents[i]=this.vertexTangents[i].clone();return t}},e.Geometry=function(){this.id=e.GeometryIdCount++,this.name="",this.vertices=[],this.colors=[],this.normals=[],this.faces=[],this.faceUvs=[[]],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingSphere=this.boundingBox=null,this.hasTangents=!1,this.dynamic=!0,this.buffersNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.tangentsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.elementsNeedUpdate=this.verticesNeedUpdate=!1},e.Geometry.prototype={constructor:e.Geometry,addEventListener:e.EventDispatcher.prototype.addEventListener,hasEventListener:e.EventDispatcher.prototype.hasEventListener,removeEventListener:e.EventDispatcher.prototype.removeEventListener,dispatchEvent:e.EventDispatcher.prototype.dispatchEvent,applyMatrix:function(t){for(var i=(new e.Matrix3).getNormalMatrix(t),n=0,r=this.vertices.length;r>n;n++)this.vertices[n].applyMatrix4(t);for(n=0,r=this.faces.length;r>n;n++){var o=this.faces[n];o.normal.applyMatrix3(i).normalize();for(var a=0,s=o.vertexNormals.length;s>a;a++)o.vertexNormals[a].applyMatrix3(i).normalize();o.centroid.applyMatrix4(t)}},computeCentroids:function(){var t,i,n;for(t=0,i=this.faces.length;i>t;t++)n=this.faces[t],n.centroid.set(0,0,0),n instanceof e.Face3?(n.centroid.add(this.vertices[n.a]),n.centroid.add(this.vertices[n.b]),n.centroid.add(this.vertices[n.c]),n.centroid.divideScalar(3)):n instanceof e.Face4&&(n.centroid.add(this.vertices[n.a]),n.centroid.add(this.vertices[n.b]),n.centroid.add(this.vertices[n.c]),n.centroid.add(this.vertices[n.d]),n.centroid.divideScalar(4))},computeFaceNormals:function(){for(var t=new e.Vector3,i=new e.Vector3,n=0,r=this.faces.length;r>n;n++){var o=this.faces[n],a=this.vertices[o.a],s=this.vertices[o.b];t.subVectors(this.vertices[o.c],s),i.subVectors(a,s),t.cross(i),t.normalize(),o.normal.copy(t)}},computeVertexNormals:function(t){var i,n,r,o;if(void 0===this.__tmpVertices){for(o=this.__tmpVertices=Array(this.vertices.length),i=0,n=this.vertices.length;n>i;i++)o[i]=new e.Vector3;for(i=0,n=this.faces.length;n>i;i++)r=this.faces[i],r instanceof e.Face3?r.vertexNormals=[new e.Vector3,new e.Vector3,new e.Vector3]:r instanceof e.Face4&&(r.vertexNormals=[new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3])}else for(o=this.__tmpVertices,i=0,n=this.vertices.length;n>i;i++)o[i].set(0,0,0);if(t){var a,s,l,c=new e.Vector3,h=new e.Vector3,u=new e.Vector3,f=new e.Vector3,p=new e.Vector3;for(i=0,n=this.faces.length;n>i;i++)r=this.faces[i],r instanceof e.Face3?(t=this.vertices[r.a],a=this.vertices[r.b],s=this.vertices[r.c],c.subVectors(s,a),h.subVectors(t,a),c.cross(h),o[r.a].add(c),o[r.b].add(c),o[r.c].add(c)):r instanceof e.Face4&&(t=this.vertices[r.a],a=this.vertices[r.b],s=this.vertices[r.c],l=this.vertices[r.d],u.subVectors(l,a),h.subVectors(t,a),u.cross(h),o[r.a].add(u),o[r.b].add(u),o[r.d].add(u),f.subVectors(l,s),p.subVectors(a,s),f.cross(p),o[r.b].add(f),o[r.c].add(f),o[r.d].add(f))}else for(i=0,n=this.faces.length;n>i;i++)r=this.faces[i],r instanceof e.Face3?(o[r.a].add(r.normal),o[r.b].add(r.normal),o[r.c].add(r.normal)):r instanceof e.Face4&&(o[r.a].add(r.normal),o[r.b].add(r.normal),o[r.c].add(r.normal),o[r.d].add(r.normal));for(i=0,n=this.vertices.length;n>i;i++)o[i].normalize();for(i=0,n=this.faces.length;n>i;i++)r=this.faces[i],r instanceof e.Face3?(r.vertexNormals[0].copy(o[r.a]),r.vertexNormals[1].copy(o[r.b]),r.vertexNormals[2].copy(o[r.c])):r instanceof e.Face4&&(r.vertexNormals[0].copy(o[r.a]),r.vertexNormals[1].copy(o[r.b]),r.vertexNormals[2].copy(o[r.c]),r.vertexNormals[3].copy(o[r.d]))},computeMorphNormals:function(){var t,i,n,r,o;for(n=0,r=this.faces.length;r>n;n++)for(o=this.faces[n],o.__originalFaceNormal?o.__originalFaceNormal.copy(o.normal):o.__originalFaceNormal=o.normal.clone(),o.__originalVertexNormals||(o.__originalVertexNormals=[]),t=0,i=o.vertexNormals.length;i>t;t++)o.__originalVertexNormals[t]?o.__originalVertexNormals[t].copy(o.vertexNormals[t]):o.__originalVertexNormals[t]=o.vertexNormals[t].clone();var a=new e.Geometry;for(a.faces=this.faces,t=0,i=this.morphTargets.length;i>t;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];var s,l,c=this.morphNormals[t].faceNormals,h=this.morphNormals[t].vertexNormals;for(n=0,r=this.faces.length;r>n;n++)o=this.faces[n],s=new e.Vector3,l=o instanceof e.Face3?{a:new e.Vector3,b:new e.Vector3,c:new e.Vector3}:{a:new e.Vector3,b:new e.Vector3,c:new e.Vector3,d:new e.Vector3},c.push(s),h.push(l)}for(c=this.morphNormals[t],a.vertices=this.morphTargets[t].vertices,a.computeFaceNormals(),a.computeVertexNormals(),n=0,r=this.faces.length;r>n;n++)o=this.faces[n],s=c.faceNormals[n],l=c.vertexNormals[n],s.copy(o.normal),o instanceof e.Face3?(l.a.copy(o.vertexNormals[0]),l.b.copy(o.vertexNormals[1]),l.c.copy(o.vertexNormals[2])):(l.a.copy(o.vertexNormals[0]),l.b.copy(o.vertexNormals[1]),l.c.copy(o.vertexNormals[2]),l.d.copy(o.vertexNormals[3]))}for(n=0,r=this.faces.length;r>n;n++)o=this.faces[n],o.normal=o.__originalFaceNormal,o.vertexNormals=o.__originalVertexNormals},computeTangents:function(){function t(e,t,i,n,r,o,a){l=e.vertices[t],c=e.vertices[i],h=e.vertices[n],u=s[r],f=s[o],p=s[a],d=c.x-l.x,m=h.x-l.x,g=c.y-l.y,v=h.y-l.y,y=c.z-l.z,b=h.z-l.z,x=f.x-u.x,w=p.x-u.x,_=f.y-u.y,S=p.y-u.y,M=1/(x*S-w*_),E.set((S*d-_*m)*M,(S*g-_*v)*M,(S*y-_*b)*M),P.set((x*m-w*d)*M,(x*v-w*g)*M,(x*b-w*y)*M),T[t].add(E),T[i].add(E),T[n].add(E),A[t].add(P),A[i].add(P),A[n].add(P)}var i,n,r,o,a,s,l,c,h,u,f,p,d,m,g,v,y,b,x,w,_,S,M,C,T=[],A=[],E=new e.Vector3,P=new e.Vector3,k=new e.Vector3,R=new e.Vector3,L=new e.Vector3;for(i=0,n=this.vertices.length;n>i;i++)T[i]=new e.Vector3,A[i]=new e.Vector3;for(i=0,n=this.faces.length;n>i;i++)a=this.faces[i],s=this.faceVertexUvs[0][i],a instanceof e.Face3?t(this,a.a,a.b,a.c,0,1,2):a instanceof e.Face4&&(t(this,a.a,a.b,a.d,0,1,3),t(this,a.b,a.c,a.d,1,2,3));var D=["a","b","c","d"];for(i=0,n=this.faces.length;n>i;i++)for(a=this.faces[i],r=0;r<a.vertexNormals.length;r++)L.copy(a.vertexNormals[r]),o=a[D[r]],C=T[o],k.copy(C),k.sub(L.multiplyScalar(L.dot(C))).normalize(),R.crossVectors(a.vertexNormals[r],C),o=R.dot(A[o]),o=0>o?-1:1,a.vertexTangents[r]=new e.Vector4(k.x,k.y,k.z,o);this.hasTangents=!0},computeLineDistances:function(){for(var e=0,t=this.vertices,i=0,n=t.length;n>i;i++)i>0&&(e+=t[i].distanceTo(t[i-1])),this.lineDistances[i]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new e.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new e.Sphere),this.boundingSphere.setFromCenterAndPoints(this.boundingSphere.center,this.vertices)},mergeVertices:function(){var t,i,n,r,o,a,s={},l=[],c=[],h=Math.pow(10,4);for(this.__tmpVertices=void 0,i=0,n=this.vertices.length;n>i;i++)t=this.vertices[i],t=[Math.round(t.x*h),Math.round(t.y*h),Math.round(t.z*h)].join("_"),void 0===s[t]?(s[t]=i,l.push(this.vertices[i]),c[i]=l.length-1):c[i]=c[s[t]];for(h=[],i=0,n=this.faces.length;n>i;i++)if(s=this.faces[i],s instanceof e.Face3){for(s.a=c[s.a],s.b=c[s.b],s.c=c[s.c],r=[s.a,s.b,s.c],t=-1,o=0;3>o;o++)if(r[o]==r[(o+1)%3]){h.push(i);break}}else if(s instanceof e.Face4){for(s.a=c[s.a],s.b=c[s.b],s.c=c[s.c],s.d=c[s.d],r=[s.a,s.b,s.c,s.d],t=-1,o=0;4>o;o++)r[o]==r[(o+1)%4]&&(t>=0&&h.push(i),t=o);if(t>=0){r.splice(t,1);var u=new e.Face3(r[0],r[1],r[2],s.normal,s.color,s.materialIndex);for(r=0,o=this.faceVertexUvs.length;o>r;r++)(a=this.faceVertexUvs[r][i])&&a.splice(t,1);s.vertexNormals&&0<s.vertexNormals.length&&(u.vertexNormals=s.vertexNormals,u.vertexNormals.splice(t,1)),s.vertexColors&&0<s.vertexColors.length&&(u.vertexColors=s.vertexColors,u.vertexColors.splice(t,1)),this.faces[i]=u}}for(i=h.length-1;i>=0;i--)for(this.faces.splice(i,1),r=0,o=this.faceVertexUvs.length;o>r;r++)this.faceVertexUvs[r].splice(i,1);return c=this.vertices.length-l.length,this.vertices=l,c},clone:function(){for(var t=new e.Geometry,i=this.vertices,n=0,r=i.length;r>n;n++)t.vertices.push(i[n].clone());for(i=this.faces,n=0,r=i.length;r>n;n++)t.faces.push(i[n].clone());for(i=this.faceVertexUvs[0],n=0,r=i.length;r>n;n++){for(var o=i[n],a=[],s=0,l=o.length;l>s;s++)a.push(new e.Vector2(o[s].x,o[s].y));t.faceVertexUvs[0].push(a)}return t},dispose:function(){this.dispatchEvent({type:"dispose"})}},e.GeometryIdCount=0,e.BufferGeometry=function(){this.id=e.GeometryIdCount++,this.attributes={},this.dynamic=!1,this.offsets=[],this.boundingSphere=this.boundingBox=null,this.hasTangents=!1,this.morphTargets=[]},e.BufferGeometry.prototype={constructor:e.BufferGeometry,addEventListener:e.EventDispatcher.prototype.addEventListener,hasEventListener:e.EventDispatcher.prototype.hasEventListener,removeEventListener:e.EventDispatcher.prototype.removeEventListener,dispatchEvent:e.EventDispatcher.prototype.dispatchEvent,applyMatrix:function(t){var i,n;this.attributes.position&&(i=this.attributes.position.array),this.attributes.normal&&(n=this.attributes.normal.array),void 0!==i&&(t.multiplyVector3Array(i),this.verticesNeedUpdate=!0),void 0!==n&&((new e.Matrix3).getNormalMatrix(t).multiplyVector3Array(n),this.normalizeNormals(),this.normalsNeedUpdate=!0)},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new e.Box3);var t=this.attributes.position.array;if(t){var i,n,r,o=this.boundingBox;3<=t.length&&(o.min.x=o.max.x=t[0],o.min.y=o.max.y=t[1],o.min.z=o.max.z=t[2]);for(var a=3,s=t.length;s>a;a+=3)i=t[a],n=t[a+1],r=t[a+2],i<o.min.x?o.min.x=i:i>o.max.x&&(o.max.x=i),n<o.min.y?o.min.y=n:n>o.max.y&&(o.max.y=n),r<o.min.z?o.min.z=r:r>o.max.z&&(o.max.z=r)}(void 0===t||0===t.length)&&(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0))},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new e.Sphere);var t=this.attributes.position.array;if(t){for(var i,n,r,o=0,a=0,s=t.length;s>a;a+=3)i=t[a],n=t[a+1],r=t[a+2],i=i*i+n*n+r*r,i>o&&(o=i);this.boundingSphere.radius=Math.sqrt(o)}},computeVertexNormals:function(){if(this.attributes.position){var t,i,n,r;if(t=this.attributes.position.array.length,void 0===this.attributes.normal)this.attributes.normal={itemSize:3,array:new Float32Array(t),numItems:t};else for(t=0,i=this.attributes.normal.array.length;i>t;t++)this.attributes.normal.array[t]=0;var o,a,s,l,c,h,u=this.attributes.position.array,f=this.attributes.normal.array,p=new e.Vector3,d=new e.Vector3,m=new e.Vector3,g=new e.Vector3,v=new e.Vector3;if(this.attributes.index){var y=this.attributes.index.array,b=this.offsets;for(n=0,r=b.length;r>n;++n){i=b[n].start,o=b[n].count;var x=b[n].index;for(t=i,i+=o;i>t;t+=3)o=x+y[t],a=x+y[t+1],s=x+y[t+2],l=u[3*o],c=u[3*o+1],h=u[3*o+2],p.set(l,c,h),l=u[3*a],c=u[3*a+1],h=u[3*a+2],d.set(l,c,h),l=u[3*s],c=u[3*s+1],h=u[3*s+2],m.set(l,c,h),g.subVectors(m,d),v.subVectors(p,d),g.cross(v),f[3*o]+=g.x,f[3*o+1]+=g.y,f[3*o+2]+=g.z,f[3*a]+=g.x,f[3*a+1]+=g.y,f[3*a+2]+=g.z,f[3*s]+=g.x,f[3*s+1]+=g.y,f[3*s+2]+=g.z}}else for(t=0,i=u.length;i>t;t+=9)l=u[t],c=u[t+1],h=u[t+2],p.set(l,c,h),l=u[t+3],c=u[t+4],h=u[t+5],d.set(l,c,h),l=u[t+6],c=u[t+7],h=u[t+8],m.set(l,c,h),g.subVectors(m,d),v.subVectors(p,d),g.cross(v),f[t]=g.x,f[t+1]=g.y,f[t+2]=g.z,f[t+3]=g.x,f[t+4]=g.y,f[t+5]=g.z,f[t+6]=g.x,f[t+7]=g.y,f[t+8]=g.z;this.normalizeNormals(),this.normalsNeedUpdate=!0}},normalizeNormals:function(){for(var e,t,i,n=this.attributes.normal.array,r=0,o=n.length;o>r;r+=3)e=n[r],t=n[r+1],i=n[r+2],e=1/Math.sqrt(e*e+t*t+i*i),n[r]*=e,n[r+1]*=e,n[r+2]*=e},computeTangents:function(){function t(e){I.x=r[3*e],I.y=r[3*e+1],I.z=r[3*e+2],U.copy(I),N=c[e],O.copy(N),O.sub(I.multiplyScalar(I.dot(N))).normalize(),j.crossVectors(U,N),V=j.dot(h[e]),G=0>V?-1:1,l[4*e]=O.x,l[4*e+1]=O.y,l[4*e+2]=O.z,l[4*e+3]=G}if(void 0===this.attributes.index||void 0===this.attributes.position||void 0===this.attributes.normal||void 0===this.attributes.uv)console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");else{var i=this.attributes.index.array,n=this.attributes.position.array,r=this.attributes.normal.array,o=this.attributes.uv.array,a=n.length/3;if(void 0===this.attributes.tangent){var s=4*a;this.attributes.tangent={itemSize:4,array:new Float32Array(s),numItems:s}}for(var l=this.attributes.tangent.array,c=[],h=[],s=0;a>s;s++)c[s]=new e.Vector3,h[s]=new e.Vector3;var u,f,p,d,m,g,v,y,b,x,w,_,S,M,C,T,A,E,P,k,R,L,a=new e.Vector3,s=new e.Vector3,D=this.offsets;for(E=0,P=D.length;P>E;++E){A=D[E].start,k=D[E].count;var F=D[E].index;for(T=A,A+=k;A>T;T+=3)k=F+i[T],R=F+i[T+1],L=F+i[T+2],u=n[3*k],f=n[3*k+1],p=n[3*k+2],d=n[3*R],m=n[3*R+1],g=n[3*R+2],v=n[3*L],y=n[3*L+1],b=n[3*L+2],x=o[2*k],w=o[2*k+1],_=o[2*R],S=o[2*R+1],M=o[2*L],C=o[2*L+1],d-=u,u=v-u,m-=f,f=y-f,g-=p,p=b-p,_-=x,x=M-x,S-=w,w=C-w,C=1/(_*w-x*S),a.set((w*d-S*u)*C,(w*m-S*f)*C,(w*g-S*p)*C),s.set((_*u-x*d)*C,(_*f-x*m)*C,(_*p-x*g)*C),c[k].add(a),c[R].add(a),c[L].add(a),h[k].add(s),h[R].add(s),h[L].add(s)}var G,N,V,O=new e.Vector3,j=new e.Vector3,I=new e.Vector3,U=new e.Vector3;for(E=0,P=D.length;P>E;++E)for(A=D[E].start,k=D[E].count,F=D[E].index,T=A,A+=k;A>T;T+=3)k=F+i[T],R=F+i[T+1],L=F+i[T+2],t(k),t(R),t(L);this.tangentsNeedUpdate=this.hasTangents=!0}},dispose:function(){this.dispatchEvent({type:"dispose"})}},e.Camera=function(){e.Object3D.call(this),this.matrixWorldInverse=new e.Matrix4,this.projectionMatrix=new e.Matrix4,this.projectionMatrixInverse=new e.Matrix4
},e.Camera.prototype=Object.create(e.Object3D.prototype),e.Camera.prototype.lookAt=function(){var t=new e.Matrix4;return function(e){t.lookAt(this.position,e,this.up),!0===this.useQuaternion?this.quaternion.setFromRotationMatrix(t):this.rotation.setEulerFromRotationMatrix(t,this.eulerOrder)}}(),e.OrthographicCamera=function(t,i,n,r,o,a){e.Camera.call(this),this.left=t,this.right=i,this.top=n,this.bottom=r,this.near=void 0!==o?o:.1,this.far=void 0!==a?a:2e3,this.updateProjectionMatrix()},e.OrthographicCamera.prototype=Object.create(e.Camera.prototype),e.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)},e.PerspectiveCamera=function(t,i,n,r){e.Camera.call(this),this.fov=void 0!==t?t:50,this.aspect=void 0!==i?i:1,this.near=void 0!==n?n:.1,this.far=void 0!==r?r:2e3,this.updateProjectionMatrix()},e.PerspectiveCamera.prototype=Object.create(e.Camera.prototype),e.PerspectiveCamera.prototype.setLens=function(t,i){void 0===i&&(i=24),this.fov=2*e.Math.radToDeg(Math.atan(i/(2*t))),this.updateProjectionMatrix()},e.PerspectiveCamera.prototype.setViewOffset=function(e,t,i,n,r,o){this.fullWidth=e,this.fullHeight=t,this.x=i,this.y=n,this.width=r,this.height=o,this.updateProjectionMatrix()},e.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var t=this.fullWidth/this.fullHeight,i=Math.tan(e.Math.degToRad(.5*this.fov))*this.near,n=-i,r=t*n,t=Math.abs(t*i-r),n=Math.abs(i-n);this.projectionMatrix.makeFrustum(r+this.x*t/this.fullWidth,r+(this.x+this.width)*t/this.fullWidth,i-(this.y+this.height)*n/this.fullHeight,i-this.y*n/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},e.Light=function(t){e.Object3D.call(this),this.color=new e.Color(t)},e.Light.prototype=Object.create(e.Object3D.prototype),e.Light.prototype.clone=function(t){return void 0===t&&(t=new e.Light),e.Object3D.prototype.clone.call(this,t),t.color.copy(this.color),t},e.AmbientLight=function(t){e.Light.call(this,t)},e.AmbientLight.prototype=Object.create(e.Light.prototype),e.AmbientLight.prototype.clone=function(){var t=new e.AmbientLight;return e.Light.prototype.clone.call(this,t),t},e.AreaLight=function(t,i){e.Light.call(this,t),this.normal=new e.Vector3(0,-1,0),this.right=new e.Vector3(1,0,0),this.intensity=void 0!==i?i:1,this.height=this.width=1,this.constantAttenuation=1.5,this.linearAttenuation=.5,this.quadraticAttenuation=.1},e.AreaLight.prototype=Object.create(e.Light.prototype),e.DirectionalLight=function(t,i){e.Light.call(this,t),this.position.set(0,1,0),this.target=new e.Object3D,this.intensity=void 0!==i?i:1,this.onlyShadow=this.castShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraTop=this.shadowCameraRight=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapHeight=this.shadowMapWidth=512,this.shadowCascade=!1,this.shadowCascadeOffset=new e.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null},e.DirectionalLight.prototype=Object.create(e.Light.prototype),e.DirectionalLight.prototype.clone=function(){var t=new e.DirectionalLight;return e.Light.prototype.clone.call(this,t),t.target=this.target.clone(),t.intensity=this.intensity,t.castShadow=this.castShadow,t.onlyShadow=this.onlyShadow,t},e.HemisphereLight=function(t,i,n){e.Light.call(this,t),this.position.set(0,100,0),this.groundColor=new e.Color(i),this.intensity=void 0!==n?n:1},e.HemisphereLight.prototype=Object.create(e.Light.prototype),e.HemisphereLight.prototype.clone=function(){var t=new e.PointLight;return e.Light.prototype.clone.call(this,t),t.groundColor.copy(this.groundColor),t.intensity=this.intensity,t},e.PointLight=function(t,i,n){e.Light.call(this,t),this.intensity=void 0!==i?i:1,this.distance=void 0!==n?n:0},e.PointLight.prototype=Object.create(e.Light.prototype),e.PointLight.prototype.clone=function(){var t=new e.PointLight;return e.Light.prototype.clone.call(this,t),t.intensity=this.intensity,t.distance=this.distance,t},e.SpotLight=function(t,i,n,r,o){e.Light.call(this,t),this.position.set(0,1,0),this.target=new e.Object3D,this.intensity=void 0!==i?i:1,this.distance=void 0!==n?n:0,this.angle=void 0!==r?r:Math.PI/3,this.exponent=void 0!==o?o:10,this.onlyShadow=this.castShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapHeight=this.shadowMapWidth=512,this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null},e.SpotLight.prototype=Object.create(e.Light.prototype),e.SpotLight.prototype.clone=function(){var t=new e.SpotLight;return e.Light.prototype.clone.call(this,t),t.target=this.target.clone(),t.intensity=this.intensity,t.distance=this.distance,t.angle=this.angle,t.exponent=this.exponent,t.castShadow=this.castShadow,t.onlyShadow=this.onlyShadow,t},e.Loader=function(t){this.statusDomElement=(this.showStatus=t)?e.Loader.prototype.addStatusElement():null,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},e.Loader.prototype={constructor:e.Loader,crossOrigin:"anonymous",addStatusElement:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.right="0px",e.style.top="0px",e.style.fontSize="0.8em",e.style.textAlign="left",e.style.background="rgba(0,0,0,0.25)",e.style.color="#fff",e.style.width="120px",e.style.padding="0.5em 0.5em 0.5em 0.5em",e.style.zIndex=1e3,e.innerHTML="Loading ...",e},updateProgress:function(e){var t="Loaded ",t=e.total?t+((100*e.loaded/e.total).toFixed(0)+"%"):t+((e.loaded/1e3).toFixed(2)+" KB");this.statusDomElement.innerHTML=t},extractUrlBase:function(e){return e=e.split("/"),e.pop(),(1>e.length?".":e.join("/"))+"/"},initMaterials:function(t,i){for(var n=[],r=0;r<t.length;++r)n[r]=e.Loader.prototype.createMaterial(t[r],i);return n},needsTangents:function(t){for(var i=0,n=t.length;n>i;i++)if(t[i]instanceof e.ShaderMaterial)return!0;return!1},createMaterial:function(t,i){function n(e){return e=Math.log(e)/Math.LN2,Math.floor(e)==e}function r(e){return e=Math.log(e)/Math.LN2,Math.pow(2,Math.round(e))}function o(t,o,a,l,c,h,u){var f=/\.dds$/i.test(a),p=i+"/"+a;if(f){var d=e.ImageUtils.loadCompressedTexture(p);t[o]=d}else d=document.createElement("canvas"),t[o]=new e.Texture(d);if(t[o].sourceFile=a,l&&(t[o].repeat.set(l[0],l[1]),1!==l[0]&&(t[o].wrapS=e.RepeatWrapping),1!==l[1]&&(t[o].wrapT=e.RepeatWrapping)),c&&t[o].offset.set(c[0],c[1]),h&&(a={repeat:e.RepeatWrapping,mirror:e.MirroredRepeatWrapping},void 0!==a[h[0]]&&(t[o].wrapS=a[h[0]]),void 0!==a[h[1]]&&(t[o].wrapT=a[h[1]])),u&&(t[o].anisotropy=u),!f){var m=t[o],t=new Image;t.onload=function(){if(n(this.width)&&n(this.height))m.image=this;else{var e=r(this.width),t=r(this.height);m.image.width=e,m.image.height=t,m.image.getContext("2d").drawImage(this,0,0,e,t)}m.needsUpdate=!0},t.crossOrigin=s.crossOrigin,t.src=p}}function a(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]}var s=this,l="MeshLambertMaterial",c={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(t.shading){var h=t.shading.toLowerCase();"phong"===h?l="MeshPhongMaterial":"basic"===h&&(l="MeshBasicMaterial")}return void 0!==t.blending&&void 0!==e[t.blending]&&(c.blending=e[t.blending]),(void 0!==t.transparent||1>t.opacity)&&(c.transparent=t.transparent),void 0!==t.depthTest&&(c.depthTest=t.depthTest),void 0!==t.depthWrite&&(c.depthWrite=t.depthWrite),void 0!==t.visible&&(c.visible=t.visible),void 0!==t.flipSided&&(c.side=e.BackSide),void 0!==t.doubleSided&&(c.side=e.DoubleSide),void 0!==t.wireframe&&(c.wireframe=t.wireframe),void 0!==t.vertexColors&&("face"===t.vertexColors?c.vertexColors=e.FaceColors:t.vertexColors&&(c.vertexColors=e.VertexColors)),t.colorDiffuse?c.color=a(t.colorDiffuse):t.DbgColor&&(c.color=t.DbgColor),t.colorSpecular&&(c.specular=a(t.colorSpecular)),t.colorAmbient&&(c.ambient=a(t.colorAmbient)),t.transparency&&(c.opacity=t.transparency),t.specularCoef&&(c.shininess=t.specularCoef),t.mapDiffuse&&i&&o(c,"map",t.mapDiffuse,t.mapDiffuseRepeat,t.mapDiffuseOffset,t.mapDiffuseWrap,t.mapDiffuseAnisotropy),t.mapLight&&i&&o(c,"lightMap",t.mapLight,t.mapLightRepeat,t.mapLightOffset,t.mapLightWrap,t.mapLightAnisotropy),t.mapBump&&i&&o(c,"bumpMap",t.mapBump,t.mapBumpRepeat,t.mapBumpOffset,t.mapBumpWrap,t.mapBumpAnisotropy),t.mapNormal&&i&&o(c,"normalMap",t.mapNormal,t.mapNormalRepeat,t.mapNormalOffset,t.mapNormalWrap,t.mapNormalAnisotropy),t.mapSpecular&&i&&o(c,"specularMap",t.mapSpecular,t.mapSpecularRepeat,t.mapSpecularOffset,t.mapSpecularWrap,t.mapSpecularAnisotropy),t.mapBumpScale&&(c.bumpScale=t.mapBumpScale),t.mapNormal?(l=e.ShaderLib.normalmap,h=e.UniformsUtils.clone(l.uniforms),h.tNormal.value=c.normalMap,t.mapNormalFactor&&h.uNormalScale.value.set(t.mapNormalFactor,t.mapNormalFactor),c.map&&(h.tDiffuse.value=c.map,h.enableDiffuse.value=!0),c.specularMap&&(h.tSpecular.value=c.specularMap,h.enableSpecular.value=!0),c.lightMap&&(h.tAO.value=c.lightMap,h.enableAO.value=!0),h.uDiffuseColor.value.setHex(c.color),h.uSpecularColor.value.setHex(c.specular),h.uAmbientColor.value.setHex(c.ambient),h.uShininess.value=c.shininess,void 0!==c.opacity&&(h.uOpacity.value=c.opacity),l=new e.ShaderMaterial({fragmentShader:l.fragmentShader,vertexShader:l.vertexShader,uniforms:h,lights:!0,fog:!0}),c.transparent&&(l.transparent=!0)):l=new e[l](c),void 0!==t.DbgName&&(l.name=t.DbgName),l}},e.ImageLoader=function(){this.crossOrigin=null},e.ImageLoader.prototype={constructor:e.ImageLoader,addEventListener:e.EventDispatcher.prototype.addEventListener,hasEventListener:e.EventDispatcher.prototype.hasEventListener,removeEventListener:e.EventDispatcher.prototype.removeEventListener,dispatchEvent:e.EventDispatcher.prototype.dispatchEvent,load:function(e,t){var i=this;void 0===t&&(t=new Image),t.addEventListener("load",function(){i.dispatchEvent({type:"load",content:t})},!1),t.addEventListener("error",function(){i.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})},!1),i.crossOrigin&&(t.crossOrigin=i.crossOrigin),t.src=e}},e.JSONLoader=function(t){e.Loader.call(this,t),this.withCredentials=!1},e.JSONLoader.prototype=Object.create(e.Loader.prototype),e.JSONLoader.prototype.load=function(e,t,i){i=i&&"string"==typeof i?i:this.extractUrlBase(e),this.onLoadStart(),this.loadAjaxJSON(this,e,t,i)},e.JSONLoader.prototype.loadAjaxJSON=function(e,t,i,n,r){var o=new XMLHttpRequest,a=0;o.onreadystatechange=function(){if(o.readyState===o.DONE)if(200===o.status||0===o.status){if(o.responseText){var s=JSON.parse(o.responseText),s=e.parse(s,n);i(s.geometry,s.materials)}else console.warn("THREE.JSONLoader: ["+t+"] seems to be unreachable or file there is empty");e.onLoadComplete()}else console.error("THREE.JSONLoader: Couldn't load ["+t+"] ["+o.status+"]");else o.readyState===o.LOADING?r&&(0===a&&(a=o.getResponseHeader("Content-Length")),r({total:a,loaded:o.responseText.length})):o.readyState===o.HEADERS_RECEIVED&&void 0!==r&&(a=o.getResponseHeader("Content-Length"))},o.open("GET",t,!0),o.withCredentials=this.withCredentials,o.send(null)},e.JSONLoader.prototype.parse=function(t,i){var n,r,o,a,s,l,c,h,u,f,p,d,m,g,v,y=new e.Geometry,b=void 0!==t.scale?1/t.scale:1,x=t.faces;f=t.vertices;var w=t.normals,_=t.colors,S=0;for(n=0;n<t.uvs.length;n++)t.uvs[n].length&&S++;for(n=0;S>n;n++)y.faceUvs[n]=[],y.faceVertexUvs[n]=[];for(a=0,s=f.length;s>a;)l=new e.Vector3,l.x=f[a++]*b,l.y=f[a++]*b,l.z=f[a++]*b,y.vertices.push(l);for(a=0,s=x.length;s>a;){if(f=x[a++],l=1&f,o=2&f,n=4&f,r=8&f,h=16&f,c=32&f,p=64&f,f&=128,l?(d=new e.Face4,d.a=x[a++],d.b=x[a++],d.c=x[a++],d.d=x[a++],l=4):(d=new e.Face3,d.a=x[a++],d.b=x[a++],d.c=x[a++],l=3),o&&(o=x[a++],d.materialIndex=o),o=y.faces.length,n)for(n=0;S>n;n++)m=t.uvs[n],u=x[a++],v=m[2*u],u=m[2*u+1],y.faceUvs[n][o]=new e.Vector2(v,u);if(r)for(n=0;S>n;n++){for(m=t.uvs[n],g=[],r=0;l>r;r++)u=x[a++],v=m[2*u],u=m[2*u+1],g[r]=new e.Vector2(v,u);y.faceVertexUvs[n][o]=g}if(h&&(h=3*x[a++],r=new e.Vector3,r.x=w[h++],r.y=w[h++],r.z=w[h],d.normal=r),c)for(n=0;l>n;n++)h=3*x[a++],r=new e.Vector3,r.x=w[h++],r.y=w[h++],r.z=w[h],d.vertexNormals.push(r);if(p&&(c=x[a++],c=new e.Color(_[c]),d.color=c),f)for(n=0;l>n;n++)c=x[a++],c=new e.Color(_[c]),d.vertexColors.push(c);y.faces.push(d)}if(t.skinWeights)for(a=0,s=t.skinWeights.length;s>a;a+=2)x=t.skinWeights[a],w=t.skinWeights[a+1],y.skinWeights.push(new e.Vector4(x,w,0,0));if(t.skinIndices)for(a=0,s=t.skinIndices.length;s>a;a+=2)x=t.skinIndices[a],w=t.skinIndices[a+1],y.skinIndices.push(new e.Vector4(x,w,0,0));if(y.bones=t.bones,y.animation=t.animation,void 0!==t.morphTargets)for(a=0,s=t.morphTargets.length;s>a;a++)for(y.morphTargets[a]={},y.morphTargets[a].name=t.morphTargets[a].name,y.morphTargets[a].vertices=[],_=y.morphTargets[a].vertices,S=t.morphTargets[a].vertices,x=0,w=S.length;w>x;x+=3)f=new e.Vector3,f.x=S[x]*b,f.y=S[x+1]*b,f.z=S[x+2]*b,_.push(f);if(void 0!==t.morphColors)for(a=0,s=t.morphColors.length;s>a;a++)for(y.morphColors[a]={},y.morphColors[a].name=t.morphColors[a].name,y.morphColors[a].colors=[],w=y.morphColors[a].colors,_=t.morphColors[a].colors,b=0,x=_.length;x>b;b+=3)S=new e.Color(16755200),S.setRGB(_[b],_[b+1],_[b+2]),w.push(S);return y.computeCentroids(),y.computeFaceNormals(),void 0===t.materials?{geometry:y}:(b=this.initMaterials(t.materials,i),this.needsTangents(b)&&y.computeTangents(),{geometry:y,materials:b})},e.LoadingMonitor=function(){var e=this,t=0,i=0,n=function(){t++,e.dispatchEvent({type:"progress",loaded:t,total:i}),t===i&&e.dispatchEvent({type:"load"})};this.add=function(e){i++,e.addEventListener("load",n,!1)}},e.LoadingMonitor.prototype={constructor:e.LoadingMonitor,addEventListener:e.EventDispatcher.prototype.addEventListener,hasEventListener:e.EventDispatcher.prototype.hasEventListener,removeEventListener:e.EventDispatcher.prototype.removeEventListener,dispatchEvent:e.EventDispatcher.prototype.dispatchEvent},e.GeometryLoader=function(){},e.GeometryLoader.prototype={constructor:e.GeometryLoader,addEventListener:e.EventDispatcher.prototype.addEventListener,hasEventListener:e.EventDispatcher.prototype.hasEventListener,removeEventListener:e.EventDispatcher.prototype.removeEventListener,dispatchEvent:e.EventDispatcher.prototype.dispatchEvent,load:function(e){var t=this,i=new XMLHttpRequest;i.addEventListener("load",function(e){e=t.parse(JSON.parse(e.target.responseText)),t.dispatchEvent({type:"load",content:e})},!1),i.addEventListener("progress",function(e){t.dispatchEvent({type:"progress",loaded:e.loaded,total:e.total})},!1),i.addEventListener("error",function(){t.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})},!1),i.open("GET",e,!0),i.send(null)},parse:function(){}},e.MaterialLoader=function(){},e.MaterialLoader.prototype={constructor:e.MaterialLoader,addEventListener:e.EventDispatcher.prototype.addEventListener,hasEventListener:e.EventDispatcher.prototype.hasEventListener,removeEventListener:e.EventDispatcher.prototype.removeEventListener,dispatchEvent:e.EventDispatcher.prototype.dispatchEvent,load:function(e){var t=this,i=new XMLHttpRequest;i.addEventListener("load",function(e){e=t.parse(JSON.parse(e.target.responseText)),t.dispatchEvent({type:"load",content:e})},!1),i.addEventListener("progress",function(e){t.dispatchEvent({type:"progress",loaded:e.loaded,total:e.total})},!1),i.addEventListener("error",function(){t.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})},!1),i.open("GET",e,!0),i.send(null)},parse:function(t){var i;switch(t.type){case"MeshBasicMaterial":i=new e.MeshBasicMaterial({color:t.color,opacity:t.opacity,transparent:t.transparent,wireframe:t.wireframe});break;case"MeshLambertMaterial":i=new e.MeshLambertMaterial({color:t.color,ambient:t.ambient,emissive:t.emissive,opacity:t.opacity,transparent:t.transparent,wireframe:t.wireframe});break;case"MeshPhongMaterial":i=new e.MeshPhongMaterial({color:t.color,ambient:t.ambient,emissive:t.emissive,specular:t.specular,shininess:t.shininess,opacity:t.opacity,transparent:t.transparent,wireframe:t.wireframe});break;case"MeshNormalMaterial":i=new e.MeshNormalMaterial({opacity:t.opacity,transparent:t.transparent,wireframe:t.wireframe});break;case"MeshDepthMaterial":i=new e.MeshDepthMaterial({opacity:t.opacity,transparent:t.transparent,wireframe:t.wireframe})}return i}},e.SceneLoader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){},this.callbackSync=function(){},this.callbackProgress=function(){},this.geometryHandlerMap={},this.hierarchyHandlerMap={},this.addGeometryHandler("ascii",e.JSONLoader)},e.SceneLoader.prototype.constructor=e.SceneLoader,e.SceneLoader.prototype.load=function(e,t){var i=this,n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status||0===n.status){var r=JSON.parse(n.responseText);i.parse(r,t,e)}else console.error("THREE.SceneLoader: Couldn't load ["+e+"] ["+n.status+"]")},n.open("GET",e,!0),n.send(null)},e.SceneLoader.prototype.addGeometryHandler=function(e,t){this.geometryHandlerMap[e]={loaderClass:t}},e.SceneLoader.prototype.addHierarchyHandler=function(e,t){this.hierarchyHandlerMap[e]={loaderClass:t}},e.SceneLoader.prototype.parse=function(t,i,n){function r(e,t){return"relativeToHTML"==t?e:T+"/"+e}function o(){a(S.scene,E.objects)}function a(t,i){var n,o,s,c,h,d,m;for(m in i)if(void 0===S.objects[m]){var b=i[m],x=null;if(b.type&&b.type in C.hierarchyHandlerMap){if(void 0===b.loading){o={type:1,url:1,material:1,position:1,rotation:1,scale:1,visible:1,children:1,userData:1,skin:1,morph:1,mirroredLoop:1,duration:1},s={};for(var w in b)w in o||(s[w]=b[w]);f=S.materials[b.material],b.loading=!0,o=C.hierarchyHandlerMap[b.type].loaderObject,o.options?o.load(r(b.url,E.urlBaseType),l(m,t,f,b)):o.load(r(b.url,E.urlBaseType),l(m,t,f,b),s)}}else if(void 0!==b.geometry){if(u=S.geometries[b.geometry]){if(x=!1,f=S.materials[b.material],x=f instanceof e.ShaderMaterial,s=b.position,c=b.rotation,h=b.scale,n=b.matrix,d=b.quaternion,b.material||(f=new e.MeshFaceMaterial(S.face_materials[b.geometry])),f instanceof e.MeshFaceMaterial&&0===f.materials.length&&(f=new e.MeshFaceMaterial(S.face_materials[b.geometry])),f instanceof e.MeshFaceMaterial)for(o=0;o<f.materials.length;o++)x=x||f.materials[o]instanceof e.ShaderMaterial;x&&u.computeTangents(),b.skin?x=new e.SkinnedMesh(u,f):b.morph?(x=new e.MorphAnimMesh(u,f),void 0!==b.duration&&(x.duration=b.duration),void 0!==b.time&&(x.time=b.time),void 0!==b.mirroredLoop&&(x.mirroredLoop=b.mirroredLoop),f.morphNormals&&u.computeMorphNormals()):x=new e.Mesh(u,f),x.name=m,n?(x.matrixAutoUpdate=!1,x.matrix.set(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15])):(x.position.set(s[0],s[1],s[2]),d?(x.quaternion.set(d[0],d[1],d[2],d[3]),x.useQuaternion=!0):x.rotation.set(c[0],c[1],c[2]),x.scale.set(h[0],h[1],h[2])),x.visible=b.visible,x.castShadow=b.castShadow,x.receiveShadow=b.receiveShadow,t.add(x),S.objects[m]=x}}else"DirectionalLight"===b.type||"PointLight"===b.type||"AmbientLight"===b.type?(v=void 0!==b.color?b.color:16777215,y=void 0!==b.intensity?b.intensity:1,"DirectionalLight"===b.type?(s=b.direction,g=new e.DirectionalLight(v,y),g.position.set(s[0],s[1],s[2]),b.target&&(A.push({object:g,targetName:b.target}),g.target=null)):"PointLight"===b.type?(s=b.position,o=b.distance,g=new e.PointLight(v,y,o),g.position.set(s[0],s[1],s[2])):"AmbientLight"===b.type&&(g=new e.AmbientLight(v)),t.add(g),g.name=m,S.lights[m]=g,S.objects[m]=g):"PerspectiveCamera"===b.type||"OrthographicCamera"===b.type?(s=b.position,c=b.rotation,d=b.quaternion,"PerspectiveCamera"===b.type?p=new e.PerspectiveCamera(b.fov,b.aspect,b.near,b.far):"OrthographicCamera"===b.type&&(p=new e.OrthographicCamera(b.left,b.right,b.top,b.bottom,b.near,b.far)),p.name=m,p.position.set(s[0],s[1],s[2]),void 0!==d?(p.quaternion.set(d[0],d[1],d[2],d[3]),p.useQuaternion=!0):void 0!==c&&p.rotation.set(c[0],c[1],c[2]),t.add(p),S.cameras[m]=p,S.objects[m]=p):(s=b.position,c=b.rotation,h=b.scale,d=b.quaternion,x=new e.Object3D,x.name=m,x.position.set(s[0],s[1],s[2]),d?(x.quaternion.set(d[0],d[1],d[2],d[3]),x.useQuaternion=!0):x.rotation.set(c[0],c[1],c[2]),x.scale.set(h[0],h[1],h[2]),x.visible=void 0!==b.visible?b.visible:!1,t.add(x),S.objects[m]=x,S.empties[m]=x);if(x){if(void 0!==b.userData)for(var _ in b.userData)x.userData[_]=b.userData[_];if(void 0!==b.groups)for(o=0;o<b.groups.length;o++)s=b.groups[o],void 0===S.groups[s]&&(S.groups[s]=[]),S.groups[s].push(m);void 0!==b.children&&a(x,b.children)}}}function s(e){return function(t,i){t.name=e,S.geometries[e]=t,S.face_materials[e]=i,o(),b-=1,C.onLoadComplete(),h()}}function l(e,t,i,n){return function(r){var r=r.content?r.content:r.dae?r.scene:r,a=n.position,s=n.rotation,l=n.quaternion,c=n.scale;r.position.set(a[0],a[1],a[2]),l?(r.quaternion.set(l[0],l[1],l[2],l[3]),r.useQuaternion=!0):r.rotation.set(s[0],s[1],s[2]),r.scale.set(c[0],c[1],c[2]),i&&r.traverse(function(e){e.material=i});var u=void 0!==n.visible?n.visible:!0;r.traverse(function(e){e.visible=u}),t.add(r),r.name=e,S.objects[e]=r,o(),b-=1,C.onLoadComplete(),h()}}function c(e){return function(t,i){t.name=e,S.geometries[e]=t,S.face_materials[e]=i}}function h(){if(C.callbackProgress({totalModels:w,totalTextures:_,loadedModels:w-b,loadedTextures:_-x},S),C.onLoadProgress(),0===b&&0===x){for(var t=0;t<A.length;t++){var n=A[t],r=S.objects[n.targetName];r?n.object.target=r:(n.object.target=new e.Object3D,S.scene.add(n.object.target)),n.object.target.userData.targetInverse=n.object}i(S)}}var u,f,p,d,m,g,v,y,b,x,w,_,S,M,C=this,T=e.Loader.prototype.extractUrlBase(n),A=[],E=t;for(M in this.geometryHandlerMap)t=this.geometryHandlerMap[M].loaderClass,this.geometryHandlerMap[M].loaderObject=new t;for(M in this.hierarchyHandlerMap)t=this.hierarchyHandlerMap[M].loaderClass,this.hierarchyHandlerMap[M].loaderObject=new t;x=b=0,S={scene:new e.Scene,geometries:{},face_materials:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{},groups:{}},E.transform&&(M=E.transform.position,t=E.transform.rotation,n=E.transform.scale,M&&S.scene.position.set(M[0],M[1],M[2]),t&&S.scene.rotation.set(t[0],t[1],t[2]),n&&S.scene.scale.set(n[0],n[1],n[2]),M||t||n)&&(S.scene.updateMatrix(),S.scene.updateMatrixWorld()),M=function(e){return function(){x-=e,h(),C.onLoadComplete()}};for(var P in E.fogs)t=E.fogs[P],"linear"===t.type?d=new e.Fog(0,t.near,t.far):"exp2"===t.type&&(d=new e.FogExp2(0,t.density)),t=t.color,d.color.setRGB(t[0],t[1],t[2]),S.fogs[P]=d;for(var k in E.geometries)d=E.geometries[k],d.type in this.geometryHandlerMap&&(b+=1,C.onLoadStart());for(var R in E.objects)d=E.objects[R],d.type&&d.type in this.hierarchyHandlerMap&&(b+=1,C.onLoadStart());w=b;for(k in E.geometries)if(d=E.geometries[k],"cube"===d.type)u=new e.CubeGeometry(d.width,d.height,d.depth,d.widthSegments,d.heightSegments,d.depthSegments),u.name=k,S.geometries[k]=u;else if("plane"===d.type)u=new e.PlaneGeometry(d.width,d.height,d.widthSegments,d.heightSegments),u.name=k,S.geometries[k]=u;else if("sphere"===d.type)u=new e.SphereGeometry(d.radius,d.widthSegments,d.heightSegments),u.name=k,S.geometries[k]=u;else if("cylinder"===d.type)u=new e.CylinderGeometry(d.topRad,d.botRad,d.height,d.radSegs,d.heightSegs),u.name=k,S.geometries[k]=u;else if("torus"===d.type)u=new e.TorusGeometry(d.radius,d.tube,d.segmentsR,d.segmentsT),u.name=k,S.geometries[k]=u;else if("icosahedron"===d.type)u=new e.IcosahedronGeometry(d.radius,d.subdivisions),u.name=k,S.geometries[k]=u;else if(d.type in this.geometryHandlerMap){R={};for(m in d)"type"!==m&&"url"!==m&&(R[m]=d[m]);this.geometryHandlerMap[d.type].loaderObject.load(r(d.url,E.urlBaseType),s(k),R)}else"embedded"===d.type&&(R=E.embeds[d.id],R.metadata=E.metadata,R&&(R=this.geometryHandlerMap.ascii.loaderObject.parse(R,""),c(k)(R.geometry,R.materials)));for(var L in E.textures)if(k=E.textures[L],k.url instanceof Array)for(x+=k.url.length,m=0;m<k.url.length;m++)C.onLoadStart();else x+=1,C.onLoadStart();_=x;for(L in E.textures){if(k=E.textures[L],void 0!==k.mapping&&void 0!==e[k.mapping]&&(k.mapping=new e[k.mapping]),k.url instanceof Array){for(R=k.url.length,d=[],m=0;R>m;m++)d[m]=r(k.url[m],E.urlBaseType);m=(m=/\.dds$/i.test(d[0]))?e.ImageUtils.loadCompressedTextureCube(d,k.mapping,M(R)):e.ImageUtils.loadTextureCube(d,k.mapping,M(R))}else m=/\.dds$/i.test(k.url),R=r(k.url,E.urlBaseType),d=M(1),m=m?e.ImageUtils.loadCompressedTexture(R,k.mapping,d):e.ImageUtils.loadTexture(R,k.mapping,d),void 0!==e[k.minFilter]&&(m.minFilter=e[k.minFilter]),void 0!==e[k.magFilter]&&(m.magFilter=e[k.magFilter]),k.anisotropy&&(m.anisotropy=k.anisotropy),k.repeat&&(m.repeat.set(k.repeat[0],k.repeat[1]),1!==k.repeat[0]&&(m.wrapS=e.RepeatWrapping),1!==k.repeat[1]&&(m.wrapT=e.RepeatWrapping)),k.offset&&m.offset.set(k.offset[0],k.offset[1]),k.wrap&&(R={repeat:e.RepeatWrapping,mirror:e.MirroredRepeatWrapping},void 0!==R[k.wrap[0]]&&(m.wrapS=R[k.wrap[0]]),void 0!==R[k.wrap[1]]&&(m.wrapT=R[k.wrap[1]]));S.textures[L]=m}var D,F;for(D in E.materials){L=E.materials[D];for(F in L.parameters)"envMap"===F||"map"===F||"lightMap"===F||"bumpMap"===F?L.parameters[F]=S.textures[L.parameters[F]]:"shading"===F?L.parameters[F]="flat"===L.parameters[F]?e.FlatShading:e.SmoothShading:"side"===F?L.parameters[F]="double"==L.parameters[F]?e.DoubleSide:"back"==L.parameters[F]?e.BackSide:e.FrontSide:"blending"===F?L.parameters[F]=L.parameters[F]in e?e[L.parameters[F]]:e.NormalBlending:"combine"===F?L.parameters[F]=L.parameters[F]in e?e[L.parameters[F]]:e.MultiplyOperation:"vertexColors"===F?"face"==L.parameters[F]?L.parameters[F]=e.FaceColors:L.parameters[F]&&(L.parameters[F]=e.VertexColors):"wrapRGB"===F&&(M=L.parameters[F],L.parameters[F]=new e.Vector3(M[0],M[1],M[2]));void 0!==L.parameters.opacity&&1>L.parameters.opacity&&(L.parameters.transparent=!0),L.parameters.normalMap?(M=e.ShaderLib.normalmap,k=e.UniformsUtils.clone(M.uniforms),m=L.parameters.color,R=L.parameters.specular,d=L.parameters.ambient,P=L.parameters.shininess,k.tNormal.value=S.textures[L.parameters.normalMap],L.parameters.normalScale&&k.uNormalScale.value.set(L.parameters.normalScale[0],L.parameters.normalScale[1]),L.parameters.map&&(k.tDiffuse.value=L.parameters.map,k.enableDiffuse.value=!0),L.parameters.envMap&&(k.tCube.value=L.parameters.envMap,k.enableReflection.value=!0,k.uReflectivity.value=L.parameters.reflectivity),L.parameters.lightMap&&(k.tAO.value=L.parameters.lightMap,k.enableAO.value=!0),L.parameters.specularMap&&(k.tSpecular.value=S.textures[L.parameters.specularMap],k.enableSpecular.value=!0),L.parameters.displacementMap&&(k.tDisplacement.value=S.textures[L.parameters.displacementMap],k.enableDisplacement.value=!0,k.uDisplacementBias.value=L.parameters.displacementBias,k.uDisplacementScale.value=L.parameters.displacementScale),k.uDiffuseColor.value.setHex(m),k.uSpecularColor.value.setHex(R),k.uAmbientColor.value.setHex(d),k.uShininess.value=P,L.parameters.opacity&&(k.uOpacity.value=L.parameters.opacity),f=new e.ShaderMaterial({fragmentShader:M.fragmentShader,vertexShader:M.vertexShader,uniforms:k,lights:!0,fog:!0})):f=new e[L.type](L.parameters),f.name=D,S.materials[D]=f}for(D in E.materials)if(L=E.materials[D],L.parameters.materials){for(F=[],m=0;m<L.parameters.materials.length;m++)F.push(S.materials[L.parameters.materials[m]]);S.materials[D].materials=F}o(),S.cameras&&E.defaults.camera&&(S.currentCamera=S.cameras[E.defaults.camera]),S.fogs&&E.defaults.fog&&(S.scene.fog=S.fogs[E.defaults.fog]),C.callbackSync(S),h()},e.TextureLoader=function(){this.crossOrigin=null},e.TextureLoader.prototype={constructor:e.TextureLoader,addEventListener:e.EventDispatcher.prototype.addEventListener,hasEventListener:e.EventDispatcher.prototype.hasEventListener,removeEventListener:e.EventDispatcher.prototype.removeEventListener,dispatchEvent:e.EventDispatcher.prototype.dispatchEvent,load:function(t){var i=this,n=new Image;n.addEventListener("load",function(){var t=new e.Texture(n);t.needsUpdate=!0,i.dispatchEvent({type:"load",content:t})},!1),n.addEventListener("error",function(){i.dispatchEvent({type:"error",message:"Couldn't load URL ["+t+"]"})},!1),i.crossOrigin&&(n.crossOrigin=i.crossOrigin),n.src=t}},e.Material=function(){this.id=e.MaterialIdCount++,this.name="",this.side=e.FrontSide,this.opacity=1,this.transparent=!1,this.blending=e.NormalBlending,this.blendSrc=e.SrcAlphaFactor,this.blendDst=e.OneMinusSrcAlphaFactor,this.blendEquation=e.AddEquation,this.depthWrite=this.depthTest=!0,this.polygonOffset=!1,this.alphaTest=this.polygonOffsetUnits=this.polygonOffsetFactor=0,this.overdraw=!1,this.needsUpdate=this.visible=!0},e.Material.prototype={constructor:e.Material,addEventListener:e.EventDispatcher.prototype.addEventListener,hasEventListener:e.EventDispatcher.prototype.hasEventListener,removeEventListener:e.EventDispatcher.prototype.removeEventListener,dispatchEvent:e.EventDispatcher.prototype.dispatchEvent,setValues:function(t){if(void 0!==t)for(var i in t){var n=t[i];if(void 0===n)console.warn("THREE.Material: '"+i+"' parameter is undefined.");else if(i in this){var r=this[i];r instanceof e.Color?r.set(n):r instanceof e.Vector3&&n instanceof e.Vector3?r.copy(n):this[i]=n}}},clone:function(t){return void 0===t&&(t=new e.Material),t.name=this.name,t.side=this.side,t.opacity=this.opacity,t.transparent=this.transparent,t.blending=this.blending,t.blendSrc=this.blendSrc,t.blendDst=this.blendDst,t.blendEquation=this.blendEquation,t.depthTest=this.depthTest,t.depthWrite=this.depthWrite,t.polygonOffset=this.polygonOffset,t.polygonOffsetFactor=this.polygonOffsetFactor,t.polygonOffsetUnits=this.polygonOffsetUnits,t.alphaTest=this.alphaTest,t.overdraw=this.overdraw,t.visible=this.visible,t},dispose:function(){this.dispatchEvent({type:"dispose"})}},e.MaterialIdCount=0,e.LineBasicMaterial=function(t){e.Material.call(this),this.color=new e.Color(16777215),this.linewidth=1,this.linejoin=this.linecap="round",this.vertexColors=!1,this.fog=!0,this.setValues(t)},e.LineBasicMaterial.prototype=Object.create(e.Material.prototype),e.LineBasicMaterial.prototype.clone=function(){var t=new e.LineBasicMaterial;return e.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.linewidth=this.linewidth,t.linecap=this.linecap,t.linejoin=this.linejoin,t.vertexColors=this.vertexColors,t.fog=this.fog,t},e.LineDashedMaterial=function(t){e.Material.call(this),this.color=new e.Color(16777215),this.scale=this.linewidth=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(t)},e.LineDashedMaterial.prototype=Object.create(e.Material.prototype),e.LineDashedMaterial.prototype.clone=function(){var t=new e.LineDashedMaterial;return e.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.linewidth=this.linewidth,t.scale=this.scale,t.dashSize=this.dashSize,t.gapSize=this.gapSize,t.vertexColors=this.vertexColors,t.fog=this.fog,t},e.MeshBasicMaterial=function(t){e.Material.call(this),this.color=new e.Color(16777215),this.envMap=this.specularMap=this.lightMap=this.map=null,this.combine=e.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=e.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=e.NoColors,this.morphTargets=this.skinning=!1,this.setValues(t)},e.MeshBasicMaterial.prototype=Object.create(e.Material.prototype),e.MeshBasicMaterial.prototype.clone=function(){var t=new e.MeshBasicMaterial;return e.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.map=this.map,t.lightMap=this.lightMap,t.specularMap=this.specularMap,t.envMap=this.envMap,t.combine=this.combine,t.reflectivity=this.reflectivity,t.refractionRatio=this.refractionRatio,t.fog=this.fog,t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t.wireframeLinecap=this.wireframeLinecap,t.wireframeLinejoin=this.wireframeLinejoin,t.vertexColors=this.vertexColors,t.skinning=this.skinning,t.morphTargets=this.morphTargets,t
},e.MeshLambertMaterial=function(t){e.Material.call(this),this.color=new e.Color(16777215),this.ambient=new e.Color(16777215),this.emissive=new e.Color(0),this.wrapAround=!1,this.wrapRGB=new e.Vector3(1,1,1),this.envMap=this.specularMap=this.lightMap=this.map=null,this.combine=e.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=e.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=e.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(t)},e.MeshLambertMaterial.prototype=Object.create(e.Material.prototype),e.MeshLambertMaterial.prototype.clone=function(){var t=new e.MeshLambertMaterial;return e.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.ambient.copy(this.ambient),t.emissive.copy(this.emissive),t.wrapAround=this.wrapAround,t.wrapRGB.copy(this.wrapRGB),t.map=this.map,t.lightMap=this.lightMap,t.specularMap=this.specularMap,t.envMap=this.envMap,t.combine=this.combine,t.reflectivity=this.reflectivity,t.refractionRatio=this.refractionRatio,t.fog=this.fog,t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t.wireframeLinecap=this.wireframeLinecap,t.wireframeLinejoin=this.wireframeLinejoin,t.vertexColors=this.vertexColors,t.skinning=this.skinning,t.morphTargets=this.morphTargets,t.morphNormals=this.morphNormals,t},e.MeshPhongMaterial=function(t){e.Material.call(this),this.color=new e.Color(16777215),this.ambient=new e.Color(16777215),this.emissive=new e.Color(0),this.specular=new e.Color(1118481),this.shininess=30,this.metal=!1,this.perPixel=!0,this.wrapAround=!1,this.wrapRGB=new e.Vector3(1,1,1),this.bumpMap=this.lightMap=this.map=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new e.Vector2(1,1),this.envMap=this.specularMap=null,this.combine=e.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=e.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=e.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(t)},e.MeshPhongMaterial.prototype=Object.create(e.Material.prototype),e.MeshPhongMaterial.prototype.clone=function(){var t=new e.MeshPhongMaterial;return e.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.ambient.copy(this.ambient),t.emissive.copy(this.emissive),t.specular.copy(this.specular),t.shininess=this.shininess,t.metal=this.metal,t.perPixel=this.perPixel,t.wrapAround=this.wrapAround,t.wrapRGB.copy(this.wrapRGB),t.map=this.map,t.lightMap=this.lightMap,t.bumpMap=this.bumpMap,t.bumpScale=this.bumpScale,t.normalMap=this.normalMap,t.normalScale.copy(this.normalScale),t.specularMap=this.specularMap,t.envMap=this.envMap,t.combine=this.combine,t.reflectivity=this.reflectivity,t.refractionRatio=this.refractionRatio,t.fog=this.fog,t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t.wireframeLinecap=this.wireframeLinecap,t.wireframeLinejoin=this.wireframeLinejoin,t.vertexColors=this.vertexColors,t.skinning=this.skinning,t.morphTargets=this.morphTargets,t.morphNormals=this.morphNormals,t},e.MeshDepthMaterial=function(t){e.Material.call(this),this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)},e.MeshDepthMaterial.prototype=Object.create(e.Material.prototype),e.MeshDepthMaterial.prototype.clone=function(){var t=new e.MeshDepthMaterial;return e.Material.prototype.clone.call(this,t),t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t},e.MeshNormalMaterial=function(t){e.Material.call(this,t),this.shading=e.FlatShading,this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(t)},e.MeshNormalMaterial.prototype=Object.create(e.Material.prototype),e.MeshNormalMaterial.prototype.clone=function(){var t=new e.MeshNormalMaterial;return e.Material.prototype.clone.call(this,t),t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t},e.MeshFaceMaterial=function(e){this.materials=e instanceof Array?e:[]},e.MeshFaceMaterial.prototype.clone=function(){return new e.MeshFaceMaterial(this.materials.slice(0))},e.ParticleBasicMaterial=function(t){e.Material.call(this),this.color=new e.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=!1,this.fog=!0,this.setValues(t)},e.ParticleBasicMaterial.prototype=Object.create(e.Material.prototype),e.ParticleBasicMaterial.prototype.clone=function(){var t=new e.ParticleBasicMaterial;return e.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.map=this.map,t.size=this.size,t.sizeAttenuation=this.sizeAttenuation,t.vertexColors=this.vertexColors,t.fog=this.fog,t},e.ParticleCanvasMaterial=function(t){e.Material.call(this),this.color=new e.Color(16777215),this.program=function(){},this.setValues(t)},e.ParticleCanvasMaterial.prototype=Object.create(e.Material.prototype),e.ParticleCanvasMaterial.prototype.clone=function(){var t=new e.ParticleCanvasMaterial;return e.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.program=this.program,t},e.ShaderMaterial=function(t){e.Material.call(this),this.vertexShader=this.fragmentShader="void main() {}",this.uniforms={},this.defines={},this.attributes=null,this.shading=e.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.lights=this.fog=!1,this.vertexColors=e.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(t)},e.ShaderMaterial.prototype=Object.create(e.Material.prototype),e.ShaderMaterial.prototype.clone=function(){var t=new e.ShaderMaterial;return e.Material.prototype.clone.call(this,t),t.fragmentShader=this.fragmentShader,t.vertexShader=this.vertexShader,t.uniforms=e.UniformsUtils.clone(this.uniforms),t.attributes=this.attributes,t.defines=this.defines,t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t.fog=this.fog,t.lights=this.lights,t.vertexColors=this.vertexColors,t.skinning=this.skinning,t.morphTargets=this.morphTargets,t.morphNormals=this.morphNormals,t},e.SpriteMaterial=function(t){e.Material.call(this),this.color=new e.Color(16777215),this.map=new e.Texture,this.useScreenCoordinates=!0,this.depthTest=!this.useScreenCoordinates,this.sizeAttenuation=!this.useScreenCoordinates,this.scaleByViewport=!this.sizeAttenuation,this.alignment=e.SpriteAlignment.center.clone(),this.fog=!1,this.uvOffset=new e.Vector2(0,0),this.uvScale=new e.Vector2(1,1),this.setValues(t),t=t||{},void 0===t.depthTest&&(this.depthTest=!this.useScreenCoordinates),void 0===t.sizeAttenuation&&(this.sizeAttenuation=!this.useScreenCoordinates),void 0===t.scaleByViewport&&(this.scaleByViewport=!this.sizeAttenuation)},e.SpriteMaterial.prototype=Object.create(e.Material.prototype),e.SpriteMaterial.prototype.clone=function(){var t=new e.SpriteMaterial;return e.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.map=this.map,t.useScreenCoordinates=this.useScreenCoordinates,t.sizeAttenuation=this.sizeAttenuation,t.scaleByViewport=this.scaleByViewport,t.alignment.copy(this.alignment),t.uvOffset.copy(this.uvOffset),t.uvScale.copy(this.uvScale),t.fog=this.fog,t},e.SpriteAlignment={},e.SpriteAlignment.topLeft=new e.Vector2(1,-1),e.SpriteAlignment.topCenter=new e.Vector2(0,-1),e.SpriteAlignment.topRight=new e.Vector2(-1,-1),e.SpriteAlignment.centerLeft=new e.Vector2(1,0),e.SpriteAlignment.center=new e.Vector2(0,0),e.SpriteAlignment.centerRight=new e.Vector2(-1,0),e.SpriteAlignment.bottomLeft=new e.Vector2(1,1),e.SpriteAlignment.bottomCenter=new e.Vector2(0,1),e.SpriteAlignment.bottomRight=new e.Vector2(-1,1),e.Texture=function(t,i,n,r,o,a,s,l,c){this.id=e.TextureIdCount++,this.name="",this.image=t,this.mipmaps=[],this.mapping=void 0!==i?i:new e.UVMapping,this.wrapS=void 0!==n?n:e.ClampToEdgeWrapping,this.wrapT=void 0!==r?r:e.ClampToEdgeWrapping,this.magFilter=void 0!==o?o:e.LinearFilter,this.minFilter=void 0!==a?a:e.LinearMipMapLinearFilter,this.anisotropy=void 0!==c?c:1,this.format=void 0!==s?s:e.RGBAFormat,this.type=void 0!==l?l:e.UnsignedByteType,this.offset=new e.Vector2(0,0),this.repeat=new e.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.needsUpdate=!1,this.onUpdate=null},e.Texture.prototype={constructor:e.Texture,addEventListener:e.EventDispatcher.prototype.addEventListener,hasEventListener:e.EventDispatcher.prototype.hasEventListener,removeEventListener:e.EventDispatcher.prototype.removeEventListener,dispatchEvent:e.EventDispatcher.prototype.dispatchEvent,clone:function(t){return void 0===t&&(t=new e.Texture),t.image=this.image,t.mipmaps=this.mipmaps.slice(0),t.mapping=this.mapping,t.wrapS=this.wrapS,t.wrapT=this.wrapT,t.magFilter=this.magFilter,t.minFilter=this.minFilter,t.anisotropy=this.anisotropy,t.format=this.format,t.type=this.type,t.offset.copy(this.offset),t.repeat.copy(this.repeat),t.generateMipmaps=this.generateMipmaps,t.premultiplyAlpha=this.premultiplyAlpha,t.flipY=this.flipY,t.unpackAlignment=this.unpackAlignment,t},dispose:function(){this.dispatchEvent({type:"dispose"})}},e.TextureIdCount=0,e.CompressedTexture=function(t,i,n,r,o,a,s,l,c,h,u){e.Texture.call(this,null,a,s,l,c,h,r,o,u),this.image={width:i,height:n},this.mipmaps=t,this.generateMipmaps=!1},e.CompressedTexture.prototype=Object.create(e.Texture.prototype),e.CompressedTexture.prototype.clone=function(){var t=new e.CompressedTexture;return e.Texture.prototype.clone.call(this,t),t},e.DataTexture=function(t,i,n,r,o,a,s,l,c,h,u){e.Texture.call(this,null,a,s,l,c,h,r,o,u),this.image={data:t,width:i,height:n}},e.DataTexture.prototype=Object.create(e.Texture.prototype),e.DataTexture.prototype.clone=function(){var t=new e.DataTexture;return e.Texture.prototype.clone.call(this,t),t},e.Particle=function(t){e.Object3D.call(this),this.material=t},e.Particle.prototype=Object.create(e.Object3D.prototype),e.Particle.prototype.clone=function(t){return void 0===t&&(t=new e.Particle(this.material)),e.Object3D.prototype.clone.call(this,t),t},e.ParticleSystem=function(t,i){e.Object3D.call(this),this.geometry=t,this.material=void 0!==i?i:new e.ParticleBasicMaterial({color:16777215*Math.random()}),this.sortParticles=!1,this.geometry&&null===this.geometry.boundingSphere&&this.geometry.computeBoundingSphere(),this.frustumCulled=!1},e.ParticleSystem.prototype=Object.create(e.Object3D.prototype),e.ParticleSystem.prototype.clone=function(t){return void 0===t&&(t=new e.ParticleSystem(this.geometry,this.material)),t.sortParticles=this.sortParticles,e.Object3D.prototype.clone.call(this,t),t},e.Line=function(t,i,n){e.Object3D.call(this),this.geometry=t,this.material=void 0!==i?i:new e.LineBasicMaterial({color:16777215*Math.random()}),this.type=void 0!==n?n:e.LineStrip,this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere())},e.LineStrip=0,e.LinePieces=1,e.Line.prototype=Object.create(e.Object3D.prototype),e.Line.prototype.clone=function(t){return void 0===t&&(t=new e.Line(this.geometry,this.material,this.type)),e.Object3D.prototype.clone.call(this,t),t},e.Mesh=function(t,i){e.Object3D.call(this),this.material=this.geometry=null,this.setGeometry(t),this.setMaterial(i)},e.Mesh.prototype=Object.create(e.Object3D.prototype),e.Mesh.prototype.setGeometry=function(e){void 0!==e&&(this.geometry=e,null===this.geometry.boundingSphere&&this.geometry.computeBoundingSphere(),this.updateMorphTargets())},e.Mesh.prototype.setMaterial=function(t){this.material=void 0!==t?t:new e.MeshBasicMaterial({color:16777215*Math.random(),wireframe:!0})},e.Mesh.prototype.updateMorphTargets=function(){if(0<this.geometry.morphTargets.length){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;t>e;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},e.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},e.Mesh.prototype.clone=function(t){return void 0===t&&(t=new e.Mesh(this.geometry,this.material)),e.Object3D.prototype.clone.call(this,t),t},e.Bone=function(t){e.Object3D.call(this),this.skin=t,this.skinMatrix=new e.Matrix4},e.Bone.prototype=Object.create(e.Object3D.prototype),e.Bone.prototype.update=function(e,t){this.matrixAutoUpdate&&(t|=this.updateMatrix()),(t||this.matrixWorldNeedsUpdate)&&(e?this.skinMatrix.multiplyMatrices(e,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);var i,n=this.children.length;for(i=0;n>i;i++)this.children[i].update(this.skinMatrix,t)},e.SkinnedMesh=function(t,i,n){e.Mesh.call(this,t,i),this.useVertexTexture=void 0!==n?n:!0,this.identityMatrix=new e.Matrix4,this.bones=[],this.boneMatrices=[];var r,o,a;if(this.geometry&&void 0!==this.geometry.bones){for(t=0;t<this.geometry.bones.length;t++)n=this.geometry.bones[t],r=n.pos,o=n.rotq,a=n.scl,i=this.addBone(),i.name=n.name,i.position.set(r[0],r[1],r[2]),i.quaternion.set(o[0],o[1],o[2],o[3]),i.useQuaternion=!0,void 0!==a?i.scale.set(a[0],a[1],a[2]):i.scale.set(1,1,1);for(t=0;t<this.bones.length;t++)n=this.geometry.bones[t],i=this.bones[t],-1===n.parent?this.add(i):this.bones[n.parent].add(i);t=this.bones.length,this.useVertexTexture?(this.boneTextureHeight=this.boneTextureWidth=t=t>256?64:t>64?32:t>16?16:8,this.boneMatrices=new Float32Array(4*this.boneTextureWidth*this.boneTextureHeight),this.boneTexture=new e.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,e.RGBAFormat,e.FloatType),this.boneTexture.minFilter=e.NearestFilter,this.boneTexture.magFilter=e.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1):this.boneMatrices=new Float32Array(16*t),this.pose()}},e.SkinnedMesh.prototype=Object.create(e.Mesh.prototype),e.SkinnedMesh.prototype.addBone=function(t){return void 0===t&&(t=new e.Bone(this)),this.bones.push(t),t},e.SkinnedMesh.prototype.updateMatrixWorld=function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent?this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1);for(var t=0,i=this.children.length;i>t;t++){var n=this.children[t];n instanceof e.Bone?n.update(this.identityMatrix,!1):n.updateMatrixWorld(!0)}if(void 0==this.boneInverses)for(this.boneInverses=[],t=0,i=this.bones.length;i>t;t++)n=new e.Matrix4,n.getInverse(this.bones[t].skinMatrix),this.boneInverses.push(n);for(t=0,i=this.bones.length;i>t;t++)e.SkinnedMesh.offsetMatrix.multiplyMatrices(this.bones[t].skinMatrix,this.boneInverses[t]),e.SkinnedMesh.offsetMatrix.flattenToArrayOffset(this.boneMatrices,16*t);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)},e.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(!0);for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e],i=1/t.lengthManhattan();1/0!==i?t.multiplyScalar(i):t.set(1)}},e.SkinnedMesh.prototype.clone=function(t){return void 0===t&&(t=new e.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)),e.Mesh.prototype.clone.call(this,t),t},e.SkinnedMesh.offsetMatrix=new e.Matrix4,e.MorphAnimMesh=function(t,i){e.Mesh.call(this,t,i),this.duration=1e3,this.mirroredLoop=!1,this.currentKeyframe=this.lastKeyframe=this.time=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},e.MorphAnimMesh.prototype=Object.create(e.Mesh.prototype),e.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e,this.endKeyframe=t,this.length=this.endKeyframe-this.startKeyframe+1},e.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},e.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},e.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;e.animations||(e.animations={});for(var t,i=e.animations,n=/([a-z]+)(\d+)/,r=0,o=e.morphTargets.length;o>r;r++){var a=e.morphTargets[r].name.match(n);if(a&&1<a.length){a=a[1],i[a]||(i[a]={start:1/0,end:-1/0});var s=i[a];r<s.start&&(s.start=r),r>s.end&&(s.end=r),t||(t=a)}}e.firstAnimation=t},e.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,i){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[e]={start:t,end:i}},e.MorphAnimMesh.prototype.playAnimation=function(e,t){var i=this.geometry.animations[e];i?(this.setFrameRange(i.start,i.end),this.duration=1e3*((i.end-i.start)/t),this.time=0):console.warn("animation["+e+"] undefined")},e.MorphAnimMesh.prototype.updateAnimation=function(t){var i=this.duration/this.length;this.time+=this.direction*t,this.mirroredLoop?(this.time>this.duration||0>this.time)&&(this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),0>this.time&&(this.time=0,this.directionBackwards=!1)):(this.time%=this.duration,0>this.time&&(this.time+=this.duration)),t=this.startKeyframe+e.Math.clamp(Math.floor(this.time/i),0,this.length-1),t!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[t]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=t),i=this.time%i/i,this.directionBackwards&&(i=1-i),this.morphTargetInfluences[this.currentKeyframe]=i,this.morphTargetInfluences[this.lastKeyframe]=1-i},e.MorphAnimMesh.prototype.clone=function(t){return void 0===t&&(t=new e.MorphAnimMesh(this.geometry,this.material)),t.duration=this.duration,t.mirroredLoop=this.mirroredLoop,t.time=this.time,t.lastKeyframe=this.lastKeyframe,t.currentKeyframe=this.currentKeyframe,t.direction=this.direction,t.directionBackwards=this.directionBackwards,e.Mesh.prototype.clone.call(this,t),t},e.Ribbon=function(t,i){e.Object3D.call(this),this.geometry=t,this.material=i},e.Ribbon.prototype=Object.create(e.Object3D.prototype),e.Ribbon.prototype.clone=function(t){return void 0===t&&(t=new e.Ribbon(this.geometry,this.material)),e.Object3D.prototype.clone.call(this,t),t},e.LOD=function(){e.Object3D.call(this),this.objects=[]},e.LOD.prototype=Object.create(e.Object3D.prototype),e.LOD.prototype.addLevel=function(e,t){void 0===t&&(t=0);for(var t=Math.abs(t),i=0;i<this.objects.length&&!(t<this.objects[i].distance);i++);this.objects.splice(i,0,{distance:t,object:e}),this.add(e)},e.LOD.prototype.getObjectForDistance=function(e){for(var t=1,i=this.objects.length;i>t&&!(e<this.objects[t].distance);t++);return this.objects[t-1].object},e.LOD.prototype.update=function(){var t=new e.Vector3,i=new e.Vector3;return function(e){if(1<this.objects.length){t.getPositionFromMatrix(e.matrixWorld),i.getPositionFromMatrix(this.matrixWorld),e=t.distanceTo(i),this.objects[0].object.visible=!0;for(var n=1,r=this.objects.length;r>n&&e>=this.objects[n].distance;n++)this.objects[n-1].object.visible=!1,this.objects[n].object.visible=!0;for(;r>n;n++)this.objects[n].object.visible=!1}}}(),e.LOD.prototype.clone=function(){},e.Sprite=function(t){e.Object3D.call(this),this.material=void 0!==t?t:new e.SpriteMaterial,this.rotation3d=this.rotation,this.rotation=0},e.Sprite.prototype=Object.create(e.Object3D.prototype),e.Sprite.prototype.updateMatrix=function(){this.rotation3d.set(0,0,this.rotation),this.quaternion.setFromEuler(this.rotation3d,this.eulerOrder),this.matrix.makeFromPositionQuaternionScale(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},e.Sprite.prototype.clone=function(t){return void 0===t&&(t=new e.Sprite(this.material)),e.Object3D.prototype.clone.call(this,t),t},e.Scene=function(){e.Object3D.call(this),this.overrideMaterial=this.fog=null,this.autoUpdate=!0,this.matrixAutoUpdate=!1,this.__objects=[],this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},e.Scene.prototype=Object.create(e.Object3D.prototype),e.Scene.prototype.__addObject=function(t){if(t instanceof e.Light)-1===this.__lights.indexOf(t)&&this.__lights.push(t),t.target&&void 0===t.target.parent&&this.add(t.target);else if(!(t instanceof e.Camera||t instanceof e.Bone)&&-1===this.__objects.indexOf(t)){this.__objects.push(t),this.__objectsAdded.push(t);var i=this.__objectsRemoved.indexOf(t);-1!==i&&this.__objectsRemoved.splice(i,1)}for(i=0;i<t.children.length;i++)this.__addObject(t.children[i])},e.Scene.prototype.__removeObject=function(t){if(t instanceof e.Light){var i=this.__lights.indexOf(t);-1!==i&&this.__lights.splice(i,1)}else t instanceof e.Camera||(i=this.__objects.indexOf(t),-1!==i&&(this.__objects.splice(i,1),this.__objectsRemoved.push(t),i=this.__objectsAdded.indexOf(t),-1!==i&&this.__objectsAdded.splice(i,1)));for(i=0;i<t.children.length;i++)this.__removeObject(t.children[i])},e.Fog=function(t,i,n){this.name="",this.color=new e.Color(t),this.near=void 0!==i?i:1,this.far=void 0!==n?n:1e3},e.Fog.prototype.clone=function(){return new e.Fog(this.color.getHex(),this.near,this.far)},e.FogExp2=function(t,i){this.name="",this.color=new e.Color(t),this.density=void 0!==i?i:25e-5},e.FogExp2.prototype.clone=function(){return new e.FogExp2(this.color.getHex(),this.density)},e.CanvasRenderer=function(t){function i(e){it!==e&&(it=J.globalAlpha=e)}function n(t){nt!==t&&(t===e.NormalBlending?J.globalCompositeOperation="source-over":t===e.AdditiveBlending?J.globalCompositeOperation="lighter":t===e.SubtractiveBlending&&(J.globalCompositeOperation="darker"),nt=t)}function r(e){at!==e&&(at=J.lineWidth=e)}function o(e){st!==e&&(st=J.lineCap=e)}function a(e){lt!==e&&(lt=J.lineJoin=e)}function s(e){rt!==e&&(rt=J.strokeStyle=e)}function l(e){ot!==e&&(ot=J.fillStyle=e)}function c(e,t){(ct!==e||ht!==t)&&(J.setLineDash([e,t]),ct=e,ht=t)}console.log("THREE.CanvasRenderer",e.REVISION);var h,u,f,p,d,m,g,v,y,b,x,w,_,S,M,C,T,A,E,P,k,R,L,D,F,G,N,V,O,j,I,U,z,B,H,q,W,X,Y,K=e.Math.smoothstep,t=t||{},$=this,Q=new e.Projector,Z=void 0!==t.canvas?t.canvas:document.createElement("canvas"),J=Z.getContext("2d"),et=new e.Color(0),tt=0,it=1,nt=0,rt=null,ot=null,at=null,st=null,lt=null,ct=null,ht=0,ut=new e.RenderableVertex,ft=new e.RenderableVertex,pt=new e.Color,dt=new e.Color,mt=new e.Color,gt=new e.Color,vt=new e.Color,yt=new e.Color,bt=new e.Color,xt=new e.Color,wt={},_t={},St=new e.Box2,Mt=new e.Box2,Ct=new e.Box2,Tt=new e.Color,At=new e.Color,Et=new e.Color,Pt=new e.Vector3,kt=16;B=document.createElement("canvas"),B.width=B.height=2,H=B.getContext("2d"),H.fillStyle="rgba(0,0,0,1)",H.fillRect(0,0,2,2),q=H.getImageData(0,0,2,2),W=q.data,X=document.createElement("canvas"),X.width=X.height=kt,Y=X.getContext("2d"),Y.translate(-kt/2,-kt/2),Y.scale(kt,kt),kt--,void 0===J.setLineDash&&(J.setLineDash=void 0!==J.mozDash?function(e){J.mozDash=null!==e[0]?e:null}:function(){}),this.domElement=Z,this.devicePixelRatio=void 0!==t.devicePixelRatio?t.devicePixelRatio:void 0!==window.devicePixelRatio?window.devicePixelRatio:1,this.sortElements=this.sortObjects=this.autoClear=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.setSize=function(t,i,n){p=t*this.devicePixelRatio,d=i*this.devicePixelRatio,m=Math.floor(p/2),g=Math.floor(d/2),Z.width=p,Z.height=d,1!==this.devicePixelRatio&&!1!==n&&(Z.style.width=t+"px",Z.style.height=i+"px"),St.set(new e.Vector2(-m,-g),new e.Vector2(m,g)),Mt.set(new e.Vector2(-m,-g),new e.Vector2(m,g)),it=1,nt=0,lt=st=at=ot=rt=null},this.setClearColor=function(t,i){et.set(t),tt=void 0!==i?i:1,Mt.set(new e.Vector2(-m,-g),new e.Vector2(m,g))},this.setClearColorHex=function(e,t){console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getMaxAnisotropy=function(){return 0},this.clear=function(){J.setTransform(1,0,0,-1,m,g),!1===Mt.empty()&&(Mt.intersect(St),Mt.expandByScalar(2),1>tt&&J.clearRect(0|Mt.min.x,0|Mt.min.y,Mt.max.x-Mt.min.x|0,Mt.max.y-Mt.min.y|0),tt>0&&(n(e.NormalBlending),i(1),l("rgba("+Math.floor(255*et.r)+","+Math.floor(255*et.g)+","+Math.floor(255*et.b)+","+tt+")"),J.fillRect(0|Mt.min.x,0|Mt.min.y,Mt.max.x-Mt.min.x|0,Mt.max.y-Mt.min.y|0)),Mt.makeEmpty())},this.render=function(t,p){function d(t,i,n){for(var r=0,o=f.length;o>r;r++){var a=f[r];if(xt.copy(a.color),a instanceof e.DirectionalLight){var s=Pt.getPositionFromMatrix(a.matrixWorld).normalize(),l=i.dot(s);0>=l||(l*=a.intensity,n.add(xt.multiplyScalar(l)))}else a instanceof e.PointLight&&(s=Pt.getPositionFromMatrix(a.matrixWorld),l=i.dot(Pt.subVectors(s,t).normalize()),0>=l||(l*=0==a.distance?1:1-Math.min(t.distanceTo(s)/a.distance,1),0!=l&&(l*=a.intensity,n.add(xt.multiplyScalar(l)))))}}function Z(t,r,o,a,s,l,c,h){$.info.render.vertices+=3,$.info.render.faces++,i(h.opacity),n(h.blending),w=t.positionScreen.x,_=t.positionScreen.y,S=r.positionScreen.x,M=r.positionScreen.y,C=o.positionScreen.x,T=o.positionScreen.y,et(w,_,S,M,C,T),(h instanceof e.MeshLambertMaterial||h instanceof e.MeshPhongMaterial)&&null===h.map?(yt.copy(h.color),bt.copy(h.emissive),h.vertexColors===e.FaceColors&&yt.multiply(c.color),!1===h.wireframe&&h.shading==e.SmoothShading&&3==c.vertexNormalsLength?(dt.copy(Tt),mt.copy(Tt),gt.copy(Tt),d(c.v1.positionWorld,c.vertexNormalsModel[0],dt),d(c.v2.positionWorld,c.vertexNormalsModel[1],mt),d(c.v3.positionWorld,c.vertexNormalsModel[2],gt),dt.multiply(yt).add(bt),mt.multiply(yt).add(bt),gt.multiply(yt).add(bt),vt.addColors(mt,gt).multiplyScalar(.5),G=at(dt,mt,gt,vt),ot(w,_,S,M,C,T,0,0,1,0,0,1,G)):(pt.copy(Tt),d(c.centroidModel,c.normalModel,pt),pt.multiply(yt).add(bt),!0===h.wireframe?it(pt,h.wireframeLinewidth,h.wireframeLinecap,h.wireframeLinejoin):nt(pt))):h instanceof e.MeshBasicMaterial||h instanceof e.MeshLambertMaterial||h instanceof e.MeshPhongMaterial?null!==h.map?h.map.mapping instanceof e.UVMapping&&(N=c.uvs[0],rt(w,_,S,M,C,T,N[a].x,N[a].y,N[s].x,N[s].y,N[l].x,N[l].y,h.map)):null!==h.envMap?h.envMap.mapping instanceof e.SphericalReflectionMapping&&(Pt.copy(c.vertexNormalsModelView[a]),V=.5*Pt.x+.5,O=.5*Pt.y+.5,Pt.copy(c.vertexNormalsModelView[s]),j=.5*Pt.x+.5,I=.5*Pt.y+.5,Pt.copy(c.vertexNormalsModelView[l]),U=.5*Pt.x+.5,z=.5*Pt.y+.5,rt(w,_,S,M,C,T,V,O,j,I,U,z,h.envMap)):(pt.copy(h.color),h.vertexColors===e.FaceColors&&pt.multiply(c.color),!0===h.wireframe?it(pt,h.wireframeLinewidth,h.wireframeLinecap,h.wireframeLinejoin):nt(pt)):h instanceof e.MeshDepthMaterial?(D=p.near,F=p.far,dt.r=dt.g=dt.b=1-K(t.positionScreen.z*t.positionScreen.w,D,F),mt.r=mt.g=mt.b=1-K(r.positionScreen.z*r.positionScreen.w,D,F),gt.r=gt.g=gt.b=1-K(o.positionScreen.z*o.positionScreen.w,D,F),vt.addColors(mt,gt).multiplyScalar(.5),G=at(dt,mt,gt,vt),ot(w,_,S,M,C,T,0,0,1,0,0,1,G)):h instanceof e.MeshNormalMaterial&&(h.shading==e.FlatShading?(t=c.normalModelView,pt.setRGB(t.x,t.y,t.z).multiplyScalar(.5).addScalar(.5),!0===h.wireframe?it(pt,h.wireframeLinewidth,h.wireframeLinecap,h.wireframeLinejoin):nt(pt)):h.shading==e.SmoothShading&&(t=c.vertexNormalsModelView[a],dt.setRGB(t.x,t.y,t.z).multiplyScalar(.5).addScalar(.5),t=c.vertexNormalsModelView[s],mt.setRGB(t.x,t.y,t.z).multiplyScalar(.5).addScalar(.5),t=c.vertexNormalsModelView[l],gt.setRGB(t.x,t.y,t.z).multiplyScalar(.5).addScalar(.5),vt.addColors(mt,gt).multiplyScalar(.5),G=at(dt,mt,gt,vt),ot(w,_,S,M,C,T,0,0,1,0,0,1,G)))}function et(e,t,i,n,r,o){J.beginPath(),J.moveTo(e,t),J.lineTo(i,n),J.lineTo(r,o),J.closePath()}function tt(e,t,i,n,r,o,a,s){J.beginPath(),J.moveTo(e,t),J.lineTo(i,n),J.lineTo(r,o),J.lineTo(a,s),J.closePath()}function it(e,t,i,n){r(t),o(i),a(n),s(e.getStyle()),J.stroke(),Ct.expandByScalar(2*t)}function nt(e){l(e.getStyle()),J.fill()}function rt(t,i,n,r,o,a,s,c,h,u,f,p,d){if(!(d instanceof e.DataTexture||void 0===d.image||0==d.image.width)){if(!0===d.needsUpdate){var m=d.wrapS==e.RepeatWrapping,g=d.wrapT==e.RepeatWrapping;wt[d.id]=J.createPattern(d.image,!0===m&&!0===g?"repeat":!0===m&&!1===g?"repeat-x":!1===m&&!0===g?"repeat-y":"no-repeat"),d.needsUpdate=!1}l(void 0===wt[d.id]?"rgba(0,0,0,1)":wt[d.id]);var m=d.offset.x/d.repeat.x,g=d.offset.y/d.repeat.y,v=d.image.width*d.repeat.x,y=d.image.height*d.repeat.y,s=(s+m)*v,c=(1-c+g)*y,n=n-t,r=r-i,o=o-t,a=a-i,h=(h+m)*v-s,u=(1-u+g)*y-c,f=(f+m)*v-s,p=(1-p+g)*y-c,m=h*p-f*u;0===m?(void 0===_t[d.id]&&(i=document.createElement("canvas"),i.width=d.image.width,i.height=d.image.height,i=i.getContext("2d"),i.drawImage(d.image,0,0),_t[d.id]=i.getImageData(0,0,d.image.width,d.image.height).data),i=_t[d.id],s=4*(Math.floor(s)+Math.floor(c)*d.image.width),pt.setRGB(i[s]/255,i[s+1]/255,i[s+2]/255),nt(pt)):(m=1/m,d=(p*n-u*o)*m,u=(p*r-u*a)*m,n=(h*o-f*n)*m,r=(h*a-f*r)*m,t=t-d*s-n*c,s=i-u*s-r*c,J.save(),J.transform(d,u,n,r,t,s),J.fill(),J.restore())}}function ot(e,t,i,n,r,o,a,s,l,c,h,u,f){var p,d;p=f.width-1,d=f.height-1,a*=p,s*=d,i-=e,n-=t,r-=e,o-=t,l=l*p-a,c=c*d-s,h=h*p-a,u=u*d-s,d=1/(l*u-h*c),p=(u*i-c*r)*d,c=(u*n-c*o)*d,i=(l*r-h*i)*d,n=(l*o-h*n)*d,e=e-p*a-i*s,t=t-c*a-n*s,J.save(),J.transform(p,c,i,n,e,t),J.clip(),J.drawImage(f,0,0),J.restore()}function at(e,t,i,n){return W[0]=255*e.r|0,W[1]=255*e.g|0,W[2]=255*e.b|0,W[4]=255*t.r|0,W[5]=255*t.g|0,W[6]=255*t.b|0,W[8]=255*i.r|0,W[9]=255*i.g|0,W[10]=255*i.b|0,W[12]=255*n.r|0,W[13]=255*n.g|0,W[14]=255*n.b|0,H.putImageData(q,0,0),Y.drawImage(B,0,0),X}function st(e,t){var i=t.x-e.x,n=t.y-e.y,r=i*i+n*n;0!==r&&(r=1/Math.sqrt(r),i*=r,n*=r,t.x+=i,t.y+=n,e.x-=i,e.y-=n)}if(!1==p instanceof e.Camera)console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");else{!0===this.autoClear&&this.clear(),J.setTransform(1,0,0,-1,m,g),$.info.render.vertices=0,$.info.render.faces=0,h=Q.projectScene(t,p,this.sortObjects,this.sortElements),u=h.elements,f=h.lights,Tt.setRGB(0,0,0),At.setRGB(0,0,0),Et.setRGB(0,0,0);for(var lt=0,ct=f.length;ct>lt;lt++){var ht=f[lt],kt=ht.color;ht instanceof e.AmbientLight?Tt.add(kt):ht instanceof e.DirectionalLight?At.add(kt):ht instanceof e.PointLight&&Et.add(kt)}for(lt=0,ct=u.length;ct>lt;lt++){var Rt=u[lt],ht=Rt.material;if(void 0!==ht&&!1!==ht.visible){if(Ct.makeEmpty(),Rt instanceof e.RenderableParticle){v=Rt,v.x*=m,v.y*=g,kt=v,i(ht.opacity),n(ht.blending);var Lt=void 0,Dt=void 0,Ft=void 0,Gt=void 0,Nt=void 0,Vt=void 0,Ot=void 0;ht instanceof e.ParticleBasicMaterial?null===ht.map?(Ft=Rt.object.scale.x,Gt=Rt.object.scale.y,Ft*=Rt.scale.x*m,Gt*=Rt.scale.y*g,Ct.min.set(kt.x-Ft,kt.y-Gt),Ct.max.set(kt.x+Ft,kt.y+Gt),!1===St.isIntersectionBox(Ct)?Ct.makeEmpty():(l(ht.color.getStyle()),J.save(),J.translate(kt.x,kt.y),J.rotate(-Rt.rotation),J.scale(Ft,Gt),J.fillRect(-1,-1,2,2),J.restore())):(Nt=ht.map.image,Vt=Nt.width>>1,Ot=Nt.height>>1,Ft=Rt.scale.x*m,Gt=Rt.scale.y*g,Lt=Ft*Vt,Dt=Gt*Ot,Ct.min.set(kt.x-Lt,kt.y-Dt),Ct.max.set(kt.x+Lt,kt.y+Dt),!1===St.isIntersectionBox(Ct)?Ct.makeEmpty():(J.save(),J.translate(kt.x,kt.y),J.rotate(-Rt.rotation),J.scale(Ft,-Gt),J.translate(-Vt,-Ot),J.drawImage(Nt,0,0),J.restore())):ht instanceof e.ParticleCanvasMaterial&&(Lt=Rt.scale.x*m,Dt=Rt.scale.y*g,Ct.min.set(kt.x-Lt,kt.y-Dt),Ct.max.set(kt.x+Lt,kt.y+Dt),!1===St.isIntersectionBox(Ct)?Ct.makeEmpty():(s(ht.color.getStyle()),l(ht.color.getStyle()),J.save(),J.translate(kt.x,kt.y),J.rotate(-Rt.rotation),J.scale(Lt,Dt),ht.program(J),J.restore()))}else if(Rt instanceof e.RenderableLine){if(v=Rt.v1,y=Rt.v2,v.positionScreen.x*=m,v.positionScreen.y*=g,y.positionScreen.x*=m,y.positionScreen.y*=g,Ct.setFromPoints([v.positionScreen,y.positionScreen]),!0===St.isIntersectionBox(Ct))if(kt=v,Lt=y,i(ht.opacity),n(ht.blending),J.beginPath(),J.moveTo(kt.positionScreen.x,kt.positionScreen.y),J.lineTo(Lt.positionScreen.x,Lt.positionScreen.y),ht instanceof e.LineBasicMaterial){if(r(ht.linewidth),o(ht.linecap),a(ht.linejoin),ht.vertexColors!==e.VertexColors)s(ht.color.getStyle());else if(Dt=Rt.vertexColors[0].getStyle(),Rt=Rt.vertexColors[1].getStyle(),Dt===Rt)s(Dt);else{try{var jt=J.createLinearGradient(kt.positionScreen.x,kt.positionScreen.y,Lt.positionScreen.x,Lt.positionScreen.y);
jt.addColorStop(0,Dt),jt.addColorStop(1,Rt)}catch(It){jt=Dt}s(jt)}J.stroke(),Ct.expandByScalar(2*ht.linewidth)}else ht instanceof e.LineDashedMaterial&&(r(ht.linewidth),o(ht.linecap),a(ht.linejoin),s(ht.color.getStyle()),c(ht.dashSize,ht.gapSize),J.stroke(),Ct.expandByScalar(2*ht.linewidth),c(null,null))}else if(Rt instanceof e.RenderableFace3){if(v=Rt.v1,y=Rt.v2,b=Rt.v3,-1>v.positionScreen.z||1<v.positionScreen.z)continue;if(-1>y.positionScreen.z||1<y.positionScreen.z)continue;if(-1>b.positionScreen.z||1<b.positionScreen.z)continue;v.positionScreen.x*=m,v.positionScreen.y*=g,y.positionScreen.x*=m,y.positionScreen.y*=g,b.positionScreen.x*=m,b.positionScreen.y*=g,!0===ht.overdraw&&(st(v.positionScreen,y.positionScreen),st(y.positionScreen,b.positionScreen),st(b.positionScreen,v.positionScreen)),Ct.setFromPoints([v.positionScreen,y.positionScreen,b.positionScreen]),!0===St.isIntersectionBox(Ct)&&Z(v,y,b,0,1,2,Rt,ht)}else if(Rt instanceof e.RenderableFace4){if(v=Rt.v1,y=Rt.v2,b=Rt.v3,x=Rt.v4,-1>v.positionScreen.z||1<v.positionScreen.z)continue;if(-1>y.positionScreen.z||1<y.positionScreen.z)continue;if(-1>b.positionScreen.z||1<b.positionScreen.z)continue;if(-1>x.positionScreen.z||1<x.positionScreen.z)continue;v.positionScreen.x*=m,v.positionScreen.y*=g,y.positionScreen.x*=m,y.positionScreen.y*=g,b.positionScreen.x*=m,b.positionScreen.y*=g,x.positionScreen.x*=m,x.positionScreen.y*=g,ut.positionScreen.copy(y.positionScreen),ft.positionScreen.copy(x.positionScreen),!0===ht.overdraw&&(st(v.positionScreen,y.positionScreen),st(y.positionScreen,x.positionScreen),st(x.positionScreen,v.positionScreen),st(b.positionScreen,ut.positionScreen),st(b.positionScreen,ft.positionScreen)),Ct.setFromPoints([v.positionScreen,y.positionScreen,b.positionScreen,x.positionScreen]),!0===St.isIntersectionBox(Ct)&&(kt=v,Lt=y,Dt=b,Ft=x,Gt=ut,Nt=ft,$.info.render.vertices+=4,$.info.render.faces++,i(ht.opacity),n(ht.blending),void 0!==ht.map&&null!==ht.map||void 0!==ht.envMap&&null!==ht.envMap?(Z(kt,Lt,Ft,0,1,3,Rt,ht),Z(Gt,Dt,Nt,1,2,3,Rt,ht)):(w=kt.positionScreen.x,_=kt.positionScreen.y,S=Lt.positionScreen.x,M=Lt.positionScreen.y,C=Dt.positionScreen.x,T=Dt.positionScreen.y,A=Ft.positionScreen.x,E=Ft.positionScreen.y,P=Gt.positionScreen.x,k=Gt.positionScreen.y,R=Nt.positionScreen.x,L=Nt.positionScreen.y,ht instanceof e.MeshLambertMaterial||ht instanceof e.MeshPhongMaterial?(yt.copy(ht.color),bt.copy(ht.emissive),ht.vertexColors===e.FaceColors&&yt.multiply(Rt.color),!1===ht.wireframe&&ht.shading==e.SmoothShading&&4==Rt.vertexNormalsLength?(dt.copy(Tt),mt.copy(Tt),gt.copy(Tt),vt.copy(Tt),d(Rt.v1.positionWorld,Rt.vertexNormalsModel[0],dt),d(Rt.v2.positionWorld,Rt.vertexNormalsModel[1],mt),d(Rt.v4.positionWorld,Rt.vertexNormalsModel[3],gt),d(Rt.v3.positionWorld,Rt.vertexNormalsModel[2],vt),dt.multiply(yt).add(bt),mt.multiply(yt).add(bt),gt.multiply(yt).add(bt),vt.multiply(yt).add(bt),G=at(dt,mt,gt,vt),et(w,_,S,M,A,E),ot(w,_,S,M,A,E,0,0,1,0,0,1,G),et(P,k,C,T,R,L),ot(P,k,C,T,R,L,1,0,1,1,0,1,G)):(pt.copy(Tt),d(Rt.centroidModel,Rt.normalModel,pt),pt.multiply(yt).add(bt),tt(w,_,S,M,C,T,A,E),!0===ht.wireframe?it(pt,ht.wireframeLinewidth,ht.wireframeLinecap,ht.wireframeLinejoin):nt(pt))):ht instanceof e.MeshBasicMaterial?(pt.copy(ht.color),ht.vertexColors===e.FaceColors&&pt.multiply(Rt.color),tt(w,_,S,M,C,T,A,E),!0===ht.wireframe?it(pt,ht.wireframeLinewidth,ht.wireframeLinecap,ht.wireframeLinejoin):nt(pt)):ht instanceof e.MeshNormalMaterial?(kt=void 0,ht.shading==e.FlatShading?(kt=Rt.normalModelView,pt.setRGB(kt.x,kt.y,kt.z).multiplyScalar(.5).addScalar(.5),tt(w,_,S,M,C,T,A,E),!0===ht.wireframe?it(pt,ht.wireframeLinewidth,ht.wireframeLinecap,ht.wireframeLinejoin):nt(pt)):ht.shading==e.SmoothShading&&(kt=Rt.vertexNormalsModelView[0],dt.setRGB(kt.x,kt.y,kt.z).multiplyScalar(.5).addScalar(.5),kt=Rt.vertexNormalsModelView[1],mt.setRGB(kt.x,kt.y,kt.z).multiplyScalar(.5).addScalar(.5),kt=Rt.vertexNormalsModelView[3],gt.setRGB(kt.x,kt.y,kt.z).multiplyScalar(.5).addScalar(.5),kt=Rt.vertexNormalsModelView[2],vt.setRGB(kt.x,kt.y,kt.z).multiplyScalar(.5).addScalar(.5),G=at(dt,mt,gt,vt),et(w,_,S,M,A,E),ot(w,_,S,M,A,E,0,0,1,0,0,1,G),et(P,k,C,T,R,L),ot(P,k,C,T,R,L,1,0,1,1,0,1,G))):ht instanceof e.MeshDepthMaterial&&(D=p.near,F=p.far,dt.r=dt.g=dt.b=1-K(kt.positionScreen.z*kt.positionScreen.w,D,F),mt.r=mt.g=mt.b=1-K(Lt.positionScreen.z*Lt.positionScreen.w,D,F),gt.r=gt.g=gt.b=1-K(Ft.positionScreen.z*Ft.positionScreen.w,D,F),vt.r=vt.g=vt.b=1-K(Dt.positionScreen.z*Dt.positionScreen.w,D,F),G=at(dt,mt,gt,vt),et(w,_,S,M,A,E),ot(w,_,S,M,A,E,0,0,1,0,0,1,G),et(P,k,C,T,R,L),ot(P,k,C,T,R,L,1,0,1,1,0,1,G))))}Mt.union(Ct)}}J.setTransform(1,0,0,1,0,0)}}},e.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform float flipEnvMap;\nuniform int combine;\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nuniform bool useRefract;\nuniform float refractionRatio;\n#else\nvarying vec3 vReflect;\n#endif\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\nvec3 reflectVec;\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\nif ( useRefract ) {\nreflectVec = refract( cameraToVertex, normal, refractionRatio );\n} else { \nreflectVec = reflect( cameraToVertex, normal );\n}\n#else\nreflectVec = vReflect;\n#endif\n#ifdef DOUBLE_SIDED\nfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\nvec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n#else\nvec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n#endif\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\nif ( combine == 1 ) {\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );\n} else if ( combine == 2 ) {\ngl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;\n} else {\ngl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );\n}\n#endif",envmap_pars_vertex:"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n#ifdef USE_SKINNING\nvec4 worldPosition = modelMatrix * skinned;\n#endif\n#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\nvec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\n#endif\n#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\nvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n#endif\n#endif",envmap_vertex:"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\nvec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;\nworldNormal = normalize( worldNormal );\nvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\nif ( useRefract ) {\nvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n} else {\nvReflect = reflect( cameraToVertex, worldNormal );\n}\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );\n#endif",map_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\nvarying vec2 vUv;\nuniform vec4 offsetRepeat;\n#endif",map_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\nvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\nvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",map_fragment:"#ifdef USE_MAP\nvec4 texelColor = texture2D( map, vUv );\n#ifdef GAMMA_INPUT\ntexelColor.xyz *= texelColor.xyz;\n#endif\ngl_FragColor = gl_FragColor * texelColor;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\nuniform sampler2D bumpMap;\nuniform float bumpScale;\nvec2 dHdxy_fwd() {\nvec2 dSTdx = dFdx( vUv );\nvec2 dSTdy = dFdy( vUv );\nfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\nfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\nfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\nreturn vec2( dBx, dBy );\n}\nvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\nvec3 vSigmaX = dFdx( surf_pos );\nvec3 vSigmaY = dFdy( surf_pos );\nvec3 vN = surf_norm;\nvec3 R1 = cross( vSigmaY, vN );\nvec3 R2 = cross( vN, vSigmaX );\nfloat fDet = dot( vSigmaX, R1 );\nvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\nreturn normalize( abs( fDet ) * surf_norm - vGrad );\n}\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\nuniform sampler2D normalMap;\nuniform vec2 normalScale;\nvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\nvec3 q0 = dFdx( eye_pos.xyz );\nvec3 q1 = dFdy( eye_pos.xyz );\nvec2 st0 = dFdx( vUv.st );\nvec2 st1 = dFdy( vUv.st );\nvec3 S = normalize(  q0 * st1.t - q1 * st0.t );\nvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\nvec3 N = normalize( surf_norm );\nvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\nmapN.xy = normalScale * mapN.xy;\nmat3 tsn = mat3( S, T, N );\nreturn normalize( tsn * mapN );\n}\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\nuniform sampler2D specularMap;\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\nvec4 texelSpecular = texture2D( specularMap, vUv );\nspecularStrength = texelSpecular.r;\n#else\nspecularStrength = 1.0;\n#endif",lights_lambert_pars_vertex:"uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\nuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif",lights_lambert_vertex:"vLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\nvLightBack = vec3( 0.0 );\n#endif\ntransformedNormal = normalize( transformedNormal );\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( transformedNormal, dirVector );\nvec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\ndirectionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\ndirectionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n#ifdef DOUBLE_SIDED\nvLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n#endif\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat dotProduct = dot( transformedNormal, lVector );\nvec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\npointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\npointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;\n#ifdef DOUBLE_SIDED\nvLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\nif ( spotEffect > spotLightAngleCos[ i ] ) {\nspotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat dotProduct = dot( transformedNormal, lVector );\nvec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\nspotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\nspotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;\n#ifdef DOUBLE_SIDED\nvLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;\n#endif\n}\n}\n#endif\n#if MAX_HEMI_LIGHTS > 0\nfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\nvec3 lVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( transformedNormal, lVector );\nfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\nfloat hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\nvLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n#ifdef DOUBLE_SIDED\nvLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n#endif\n}\n#endif\nvLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;\n#ifdef DOUBLE_SIDED\nvLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;\n#endif",lights_phong_pars_vertex:"#ifndef PHONG_PER_PIXEL\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\nvarying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )\nvarying vec3 vWorldPosition;\n#endif",lights_phong_vertex:"#ifndef PHONG_PER_PIXEL\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nvSpotLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )\nvWorldPosition = worldPosition.xyz;\n#endif",lights_phong_pars_fragment:"uniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\nuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#else\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#else\nvarying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )\nvarying vec3 vWorldPosition;\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_phong_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#ifdef DOUBLE_SIDED\nnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n#endif\n#ifdef USE_NORMALMAP\nnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\nnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse  = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vPointLight[ i ].xyz );\nfloat lDistance = vPointLight[ i ].w;\n#endif\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n#else\nfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n#endif\npointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\nvec3 pointHalfVector = normalize( lVector + viewPosition );\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n#else\npointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvec3 spotDiffuse  = vec3( 0.0 );\nvec3 spotSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vSpotLight[ i ].xyz );\nfloat lDistance = vSpotLight[ i ].w;\n#endif\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\nif ( spotEffect > spotLightAngleCos[ i ] ) {\nspotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n#else\nfloat spotDiffuseWeight = max( dotProduct, 0.0 );\n#endif\nspotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;\nvec3 spotHalfVector = normalize( lVector + viewPosition );\nfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\nfloat spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );\nspotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n#else\nspotSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;\n#endif\n}\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse  = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( normal, dirVector );\n#ifdef WRAP_AROUND\nfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n#else\nfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n#endif\ndirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\nvec3 dirHalfVector = normalize( dirVector + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n#else\ndirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;\n#endif\n}\n#endif\n#if MAX_HEMI_LIGHTS > 0\nvec3 hemiDiffuse  = vec3( 0.0 );\nvec3 hemiSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\nvec3 lVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( normal, lVector );\nfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\nvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\nhemiDiffuse += diffuse * hemiColor;\nvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\nfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\nfloat hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );\nvec3 lVectorGround = -lVector;\nvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\nfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\nfloat hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat dotProductGround = dot( normal, lVectorGround );\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );\nvec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );\nhemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n#else\nhemiSpecular += specular * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;\n#endif\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_HEMI_LIGHTS > 0\ntotalDiffuse += hemiDiffuse;\ntotalSpecular += hemiSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\n#if MAX_SPOT_LIGHTS > 0\ntotalDiffuse += spotDiffuse;\ntotalSpecular += spotSpecular;\n#endif\n#ifdef METAL\ngl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n#ifdef GAMMA_INPUT\nvColor = color * color;\n#else\nvColor = color;\n#endif\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n#ifdef BONE_TEXTURE\nuniform sampler2D boneTexture;\nmat4 getBoneMatrix( const in float i ) {\nfloat j = i * 4.0;\nfloat x = mod( j, N_BONE_PIXEL_X );\nfloat y = floor( j / N_BONE_PIXEL_X );\nconst float dx = 1.0 / N_BONE_PIXEL_X;\nconst float dy = 1.0 / N_BONE_PIXEL_Y;\ny = dy * ( y + 0.5 );\nvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\nvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\nvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\nvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\nmat4 bone = mat4( v1, v2, v3, v4 );\nreturn bone;\n}\n#else\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\nmat4 getBoneMatrix( const in float i ) {\nmat4 bone = boneGlobalMatrices[ int(i) ];\nreturn bone;\n}\n#endif\n#endif",skinbase_vertex:"#ifdef USE_SKINNING\nmat4 boneMatX = getBoneMatrix( skinIndex.x );\nmat4 boneMatY = getBoneMatrix( skinIndex.y );\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n#ifdef USE_MORPHTARGETS\nvec4 skinVertex = vec4( morphed, 1.0 );\n#else\nvec4 skinVertex = vec4( position, 1.0 );\n#endif\nvec4 skinned  = boneMatX * skinVertex * skinWeight.x;\nskinned 	  += boneMatY * skinVertex * skinWeight.y;\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n#ifndef USE_MORPHNORMALS\nuniform float morphTargetInfluences[ 8 ];\n#else\nuniform float morphTargetInfluences[ 4 ];\n#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n#ifndef USE_MORPHNORMALS\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n#endif\nmorphed += position;\n#endif",default_vertex:"vec4 mvPosition;\n#ifdef USE_SKINNING\nmvPosition = modelViewMatrix * skinned;\n#endif\n#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )\nmvPosition = modelViewMatrix * vec4( morphed, 1.0 );\n#endif\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )\nmvPosition = modelViewMatrix * vec4( position, 1.0 );\n#endif\ngl_Position = projectionMatrix * mvPosition;",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\nvec3 morphedNormal = vec3( 0.0 );\nmorphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\nmorphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\nmorphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\nmorphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\nmorphedNormal += normal;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\nmat4 skinMatrix = skinWeight.x * boneMatX;\nskinMatrix 	+= skinWeight.y * boneMatY;\n#ifdef USE_MORPHNORMALS\nvec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\n#else\nvec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\n#endif\n#endif",defaultnormal_vertex:"vec3 objectNormal;\n#ifdef USE_SKINNING\nobjectNormal = skinnedNormal.xyz;\n#endif\n#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )\nobjectNormal = morphedNormal;\n#endif\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )\nobjectNormal = normal;\n#endif\n#ifdef FLIP_SIDED\nobjectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\nuniform sampler2D shadowMap[ MAX_SHADOWS ];\nuniform vec2 shadowMapSize[ MAX_SHADOWS ];\nuniform float shadowDarkness[ MAX_SHADOWS ];\nuniform float shadowBias[ MAX_SHADOWS ];\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\nfloat depth = dot( rgba_depth, bit_shift );\nreturn depth;\n}\n#endif",shadowmap_fragment:"#ifdef USE_SHADOWMAP\n#ifdef SHADOWMAP_DEBUG\nvec3 frustumColors[3];\nfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\nfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\nfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n#endif\n#ifdef SHADOWMAP_CASCADE\nint inFrustumCount = 0;\n#endif\nfloat fDepth;\nvec3 shadowColor = vec3( 1.0 );\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\nbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\nbool inFrustum = all( inFrustumVec );\n#ifdef SHADOWMAP_CASCADE\ninFrustumCount += int( inFrustum );\nbvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n#else\nbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n#endif\nbool frustumTest = all( frustumTestVec );\nif ( frustumTest ) {\nshadowCoord.z += shadowBias[ i ];\n#if defined( SHADOWMAP_TYPE_PCF )\nfloat shadow = 0.0;\nconst float shadowDelta = 1.0 / 9.0;\nfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\nfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\nfloat dx0 = -1.25 * xPixelOffset;\nfloat dy0 = -1.25 * yPixelOffset;\nfloat dx1 = 1.25 * xPixelOffset;\nfloat dy1 = 1.25 * yPixelOffset;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\nfloat shadow = 0.0;\nfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\nfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\nfloat dx0 = -1.0 * xPixelOffset;\nfloat dy0 = -1.0 * yPixelOffset;\nfloat dx1 = 1.0 * xPixelOffset;\nfloat dy1 = 1.0 * yPixelOffset;\nmat3 shadowKernel;\nmat3 depthKernel;\ndepthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\ndepthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\ndepthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\ndepthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\ndepthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\ndepthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\ndepthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\ndepthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\ndepthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\nvec3 shadowZ = vec3( shadowCoord.z );\nshadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\nshadowKernel[0] *= vec3(0.25);\nshadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\nshadowKernel[1] *= vec3(0.25);\nshadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\nshadowKernel[2] *= vec3(0.25);\nvec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\nshadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\nshadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\nvec4 shadowValues;\nshadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\nshadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\nshadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\nshadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\nshadow = dot( shadowValues, vec4( 1.0 ) );\nshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n#else\nvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\nfloat fDepth = unpackDepth( rgbaDepth );\nif ( fDepth < shadowCoord.z )\nshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n#endif\n}\n#ifdef SHADOWMAP_DEBUG\n#ifdef SHADOWMAP_CASCADE\nif ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];\n#else\nif ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];\n#endif\n#endif\n}\n#ifdef GAMMA_OUTPUT\nshadowColor *= shadowColor;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n}\n#endif",alphatest_fragment:"#ifdef ALPHATEST\nif ( gl_FragColor.a < ALPHATEST ) discard;\n#endif",linear_to_gamma_fragment:"#ifdef GAMMA_OUTPUT\ngl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n#endif"},e.UniformsUtils={merge:function(e){var t,i,n,r={};
for(t=0;t<e.length;t++)for(i in n=this.clone(e[t]))r[i]=n[i];return r},clone:function(t){var i,n,r,o={};for(i in t)for(n in o[i]={},t[i])r=t[i][n],o[i][n]=r instanceof e.Color||r instanceof e.Vector2||r instanceof e.Vector3||r instanceof e.Vector4||r instanceof e.Matrix4||r instanceof e.Texture?r.clone():r instanceof Array?r.slice():r;return o}},e.UniformsLib={common:{diffuse:{type:"c",value:new e.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new e.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new e.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new e.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new e.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new e.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},e.ShaderLib={basic:{uniforms:e.UniformsUtils.merge([e.UniformsLib.common,e.UniformsLib.fog,e.UniformsLib.shadowmap]),vertexShader:[e.ShaderChunk.map_pars_vertex,e.ShaderChunk.lightmap_pars_vertex,e.ShaderChunk.envmap_pars_vertex,e.ShaderChunk.color_pars_vertex,e.ShaderChunk.morphtarget_pars_vertex,e.ShaderChunk.skinning_pars_vertex,e.ShaderChunk.shadowmap_pars_vertex,"void main() {",e.ShaderChunk.map_vertex,e.ShaderChunk.lightmap_vertex,e.ShaderChunk.color_vertex,e.ShaderChunk.skinbase_vertex,"#ifdef USE_ENVMAP",e.ShaderChunk.morphnormal_vertex,e.ShaderChunk.skinnormal_vertex,e.ShaderChunk.defaultnormal_vertex,"#endif",e.ShaderChunk.morphtarget_vertex,e.ShaderChunk.skinning_vertex,e.ShaderChunk.default_vertex,e.ShaderChunk.worldpos_vertex,e.ShaderChunk.envmap_vertex,e.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",e.ShaderChunk.color_pars_fragment,e.ShaderChunk.map_pars_fragment,e.ShaderChunk.lightmap_pars_fragment,e.ShaderChunk.envmap_pars_fragment,e.ShaderChunk.fog_pars_fragment,e.ShaderChunk.shadowmap_pars_fragment,e.ShaderChunk.specularmap_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",e.ShaderChunk.map_fragment,e.ShaderChunk.alphatest_fragment,e.ShaderChunk.specularmap_fragment,e.ShaderChunk.lightmap_fragment,e.ShaderChunk.color_fragment,e.ShaderChunk.envmap_fragment,e.ShaderChunk.shadowmap_fragment,e.ShaderChunk.linear_to_gamma_fragment,e.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:e.UniformsUtils.merge([e.UniformsLib.common,e.UniformsLib.fog,e.UniformsLib.lights,e.UniformsLib.shadowmap,{ambient:{type:"c",value:new e.Color(16777215)},emissive:{type:"c",value:new e.Color(0)},wrapRGB:{type:"v3",value:new e.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\nvarying vec3 vLightBack;\n#endif",e.ShaderChunk.map_pars_vertex,e.ShaderChunk.lightmap_pars_vertex,e.ShaderChunk.envmap_pars_vertex,e.ShaderChunk.lights_lambert_pars_vertex,e.ShaderChunk.color_pars_vertex,e.ShaderChunk.morphtarget_pars_vertex,e.ShaderChunk.skinning_pars_vertex,e.ShaderChunk.shadowmap_pars_vertex,"void main() {",e.ShaderChunk.map_vertex,e.ShaderChunk.lightmap_vertex,e.ShaderChunk.color_vertex,e.ShaderChunk.morphnormal_vertex,e.ShaderChunk.skinbase_vertex,e.ShaderChunk.skinnormal_vertex,e.ShaderChunk.defaultnormal_vertex,e.ShaderChunk.morphtarget_vertex,e.ShaderChunk.skinning_vertex,e.ShaderChunk.default_vertex,e.ShaderChunk.worldpos_vertex,e.ShaderChunk.envmap_vertex,e.ShaderChunk.lights_lambert_vertex,e.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\nvarying vec3 vLightBack;\n#endif",e.ShaderChunk.color_pars_fragment,e.ShaderChunk.map_pars_fragment,e.ShaderChunk.lightmap_pars_fragment,e.ShaderChunk.envmap_pars_fragment,e.ShaderChunk.fog_pars_fragment,e.ShaderChunk.shadowmap_pars_fragment,e.ShaderChunk.specularmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",e.ShaderChunk.map_fragment,e.ShaderChunk.alphatest_fragment,e.ShaderChunk.specularmap_fragment,"#ifdef DOUBLE_SIDED\nif ( gl_FrontFacing )\ngl_FragColor.xyz *= vLightFront;\nelse\ngl_FragColor.xyz *= vLightBack;\n#else\ngl_FragColor.xyz *= vLightFront;\n#endif",e.ShaderChunk.lightmap_fragment,e.ShaderChunk.color_fragment,e.ShaderChunk.envmap_fragment,e.ShaderChunk.shadowmap_fragment,e.ShaderChunk.linear_to_gamma_fragment,e.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:e.UniformsUtils.merge([e.UniformsLib.common,e.UniformsLib.bump,e.UniformsLib.normalmap,e.UniformsLib.fog,e.UniformsLib.lights,e.UniformsLib.shadowmap,{ambient:{type:"c",value:new e.Color(16777215)},emissive:{type:"c",value:new e.Color(0)},specular:{type:"c",value:new e.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new e.Vector3(1,1,1)}}]),vertexShader:["#define PHONG\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",e.ShaderChunk.map_pars_vertex,e.ShaderChunk.lightmap_pars_vertex,e.ShaderChunk.envmap_pars_vertex,e.ShaderChunk.lights_phong_pars_vertex,e.ShaderChunk.color_pars_vertex,e.ShaderChunk.morphtarget_pars_vertex,e.ShaderChunk.skinning_pars_vertex,e.ShaderChunk.shadowmap_pars_vertex,"void main() {",e.ShaderChunk.map_vertex,e.ShaderChunk.lightmap_vertex,e.ShaderChunk.color_vertex,e.ShaderChunk.morphnormal_vertex,e.ShaderChunk.skinbase_vertex,e.ShaderChunk.skinnormal_vertex,e.ShaderChunk.defaultnormal_vertex,"vNormal = normalize( transformedNormal );",e.ShaderChunk.morphtarget_vertex,e.ShaderChunk.skinning_vertex,e.ShaderChunk.default_vertex,"vViewPosition = -mvPosition.xyz;",e.ShaderChunk.worldpos_vertex,e.ShaderChunk.envmap_vertex,e.ShaderChunk.lights_phong_vertex,e.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;",e.ShaderChunk.color_pars_fragment,e.ShaderChunk.map_pars_fragment,e.ShaderChunk.lightmap_pars_fragment,e.ShaderChunk.envmap_pars_fragment,e.ShaderChunk.fog_pars_fragment,e.ShaderChunk.lights_phong_pars_fragment,e.ShaderChunk.shadowmap_pars_fragment,e.ShaderChunk.bumpmap_pars_fragment,e.ShaderChunk.normalmap_pars_fragment,e.ShaderChunk.specularmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",e.ShaderChunk.map_fragment,e.ShaderChunk.alphatest_fragment,e.ShaderChunk.specularmap_fragment,e.ShaderChunk.lights_phong_fragment,e.ShaderChunk.lightmap_fragment,e.ShaderChunk.color_fragment,e.ShaderChunk.envmap_fragment,e.ShaderChunk.shadowmap_fragment,e.ShaderChunk.linear_to_gamma_fragment,e.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:e.UniformsUtils.merge([e.UniformsLib.particle,e.UniformsLib.shadowmap]),vertexShader:["uniform float size;\nuniform float scale;",e.ShaderChunk.color_pars_vertex,e.ShaderChunk.shadowmap_pars_vertex,"void main() {",e.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;",e.ShaderChunk.worldpos_vertex,e.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",e.ShaderChunk.color_pars_fragment,e.ShaderChunk.map_particle_pars_fragment,e.ShaderChunk.fog_pars_fragment,e.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",e.ShaderChunk.map_particle_fragment,e.ShaderChunk.alphatest_fragment,e.ShaderChunk.color_fragment,e.ShaderChunk.shadowmap_fragment,e.ShaderChunk.fog_fragment,"}"].join("\n")},dashed:{uniforms:e.UniformsUtils.merge([e.UniformsLib.common,e.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;",e.ShaderChunk.color_pars_vertex,"void main() {",e.ShaderChunk.color_vertex,"vLineDistance = scale * lineDistance;\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;",e.ShaderChunk.color_pars_fragment,e.ShaderChunk.fog_pars_fragment,"void main() {\nif ( mod( vLineDistance, totalSize ) > dashSize ) {\ndiscard;\n}\ngl_FragColor = vec4( diffuse, opacity );",e.ShaderChunk.color_fragment,e.ShaderChunk.fog_fragment,"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}"},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",e.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvNormal = normalize( normalMatrix * normal );",e.ShaderChunk.morphtarget_vertex,e.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}"},normalmap:{uniforms:e.UniformsUtils.merge([e.UniformsLib.fog,e.UniformsLib.lights,e.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new e.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new e.Color(16777215)},uSpecularColor:{type:"c",value:new e.Color(1118481)},uAmbientColor:{type:"c",value:new e.Color(16777215)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},useRefract:{type:"i",value:0},uRefractionRatio:{type:"f",value:.98},uReflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new e.Vector2(0,0)},uRepeat:{type:"v2",value:new e.Vector2(1,1)},wrapRGB:{type:"v3",value:new e.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;\nuniform vec3 uDiffuseColor;\nuniform vec3 uSpecularColor;\nuniform float uShininess;\nuniform float uOpacity;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform bool enableReflection;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform samplerCube tCube;\nuniform vec2 uNormalScale;\nuniform bool useRefract;\nuniform float uRefractionRatio;\nuniform float uReflectivity;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\nuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif\nvarying vec3 vWorldPosition;\nvarying vec3 vViewPosition;",e.ShaderChunk.shadowmap_pars_fragment,e.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3( 1.0 ), uOpacity );\nvec3 specularTex = vec3( 1.0 );\nvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\nnormalTex.xy *= uNormalScale;\nnormalTex = normalize( normalTex );\nif( enableDiffuse ) {\n#ifdef GAMMA_INPUT\nvec4 texelColor = texture2D( tDiffuse, vUv );\ntexelColor.xyz *= texelColor.xyz;\ngl_FragColor = gl_FragColor * texelColor;\n#else\ngl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );\n#endif\n}\nif( enableAO ) {\n#ifdef GAMMA_INPUT\nvec4 aoColor = texture2D( tAO, vUv );\naoColor.xyz *= aoColor.xyz;\ngl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;\n#endif\n}\nif( enableSpecular )\nspecularTex = texture2D( tSpecular, vUv ).xyz;\nmat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );\nvec3 finalNormal = tsb * normalTex;\n#ifdef FLIP_SIDED\nfinalNormal = -finalNormal;\n#endif\nvec3 normal = normalize( finalNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 pointVector = lPosition.xyz + vViewPosition.xyz;\nfloat pointDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\npointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );\npointVector = normalize( pointVector );\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );\nfloat pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );\nvec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n#else\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\n#endif\npointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;\nvec3 pointHalfVector = normalize( pointVector + viewPosition );\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;\n#else\npointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvec3 spotDiffuse = vec3( 0.0 );\nvec3 spotSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 spotVector = lPosition.xyz + vViewPosition.xyz;\nfloat spotDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nspotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );\nspotVector = normalize( spotVector );\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\nif ( spotEffect > spotLightAngleCos[ i ] ) {\nspotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\n#ifdef WRAP_AROUND\nfloat spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );\nfloat spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );\nvec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n#else\nfloat spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );\n#endif\nspotDiffuse += spotDistance * spotLightColor[ i ] * uDiffuseColor * spotDiffuseWeight * spotEffect;\nvec3 spotHalfVector = normalize( spotVector + viewPosition );\nfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\nfloat spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );\nspotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;\n#else\nspotSpecular += spotDistance * spotLightColor[ i ] * uSpecularColor * spotSpecularWeight * spotDiffuseWeight * spotEffect;\n#endif\n}\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\n#ifdef WRAP_AROUND\nfloat directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );\nfloat directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );\nvec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );\n#else\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\n#endif\ndirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;\nvec3 dirHalfVector = normalize( dirVector + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n#else\ndirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;\n#endif\n}\n#endif\n#if MAX_HEMI_LIGHTS > 0\nvec3 hemiDiffuse  = vec3( 0.0 );\nvec3 hemiSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\nvec3 lVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( normal, lVector );\nfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\nvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\nhemiDiffuse += uDiffuseColor * hemiColor;\nvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\nfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\nfloat hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, uShininess ), 0.0 );\nvec3 lVectorGround = -lVector;\nvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\nfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\nfloat hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat dotProductGround = dot( normal, lVectorGround );\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlickSky = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );\nvec3 schlickGround = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );\nhemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n#else\nhemiSpecular += uSpecularColor * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;\n#endif\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_HEMI_LIGHTS > 0\ntotalDiffuse += hemiDiffuse;\ntotalSpecular += hemiSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\n#if MAX_SPOT_LIGHTS > 0\ntotalDiffuse += spotDiffuse;\ntotalSpecular += spotSpecular;\n#endif\n#ifdef METAL\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor + totalSpecular );\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor ) + totalSpecular;\n#endif\nif ( enableReflection ) {\nvec3 vReflect;\nvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\nif ( useRefract ) {\nvReflect = refract( cameraToVertex, normal, uRefractionRatio );\n} else {\nvReflect = reflect( cameraToVertex, normal );\n}\nvec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * uReflectivity );\n}",e.ShaderChunk.shadowmap_fragment,e.ShaderChunk.linear_to_gamma_fragment,e.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;\nuniform vec2 uOffset;\nuniform vec2 uRepeat;\nuniform bool enableDisplacement;\n#ifdef VERTEX_TEXTURES\nuniform sampler2D tDisplacement;\nuniform float uDisplacementScale;\nuniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vWorldPosition;\nvarying vec3 vViewPosition;",e.ShaderChunk.skinning_pars_vertex,e.ShaderChunk.shadowmap_pars_vertex,"void main() {",e.ShaderChunk.skinbase_vertex,e.ShaderChunk.skinnormal_vertex,"#ifdef USE_SKINNING\nvNormal = normalize( normalMatrix * skinnedNormal.xyz );\nvec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );\nvTangent = normalize( normalMatrix * skinnedTangent.xyz );\n#else\nvNormal = normalize( normalMatrix * normal );\nvTangent = normalize( normalMatrix * tangent.xyz );\n#endif\nvBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );\nvUv = uv * uRepeat + uOffset;\nvec3 displacedPosition;\n#ifdef VERTEX_TEXTURES\nif ( enableDisplacement ) {\nvec3 dv = texture2D( tDisplacement, uv ).xyz;\nfloat df = uDisplacementScale * dv.x + uDisplacementBias;\ndisplacedPosition = position + normalize( normal ) * df;\n} else {\n#ifdef USE_SKINNING\nvec4 skinVertex = vec4( position, 1.0 );\nvec4 skinned  = boneMatX * skinVertex * skinWeight.x;\nskinned 	  += boneMatY * skinVertex * skinWeight.y;\ndisplacedPosition  = skinned.xyz;\n#else\ndisplacedPosition = position;\n#endif\n}\n#else\n#ifdef USE_SKINNING\nvec4 skinVertex = vec4( position, 1.0 );\nvec4 skinned  = boneMatX * skinVertex * skinWeight.x;\nskinned 	  += boneMatY * skinVertex * skinWeight.y;\ndisplacedPosition  = skinned.xyz;\n#else\ndisplacedPosition = position;\n#endif\n#endif\nvec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );\nvec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\nvWorldPosition = worldPosition.xyz;\nvViewPosition = -mvPosition.xyz;\n#ifdef USE_SHADOWMAP\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n}\n#endif\n}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:"varying vec3 vWorldPosition;\nvoid main() {\nvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\nvWorldPosition = worldPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform samplerCube tCube;\nuniform float tFlip;\nvarying vec3 vWorldPosition;\nvoid main() {\ngl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n}"},depthRGBA:{uniforms:{},vertexShader:[e.ShaderChunk.morphtarget_pars_vertex,e.ShaderChunk.skinning_pars_vertex,"void main() {",e.ShaderChunk.skinbase_vertex,e.ShaderChunk.morphtarget_vertex,e.ShaderChunk.skinning_vertex,e.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:"vec4 pack_depth( const in float depth ) {\nconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\nconst vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\nvec4 res = fract( depth * bit_shift );\nres -= res.xxyz * bit_mask;\nreturn res;\n}\nvoid main() {\ngl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\n}"}},e.WebGLRenderer=function(t){function i(e){if(e.__webglCustomAttributesList)for(var t in e.__webglCustomAttributesList)B.deleteBuffer(e.__webglCustomAttributesList[t].buffer)}function n(e,t){var i=e.vertices.length,n=t.material;if(n.attributes){void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]);for(var r in n.attributes){var o=n.attributes[r];if(!o.__webglInitialized||o.createUniqueBuffers){o.__webglInitialized=!0;var a=1;"v2"===o.type?a=2:"v3"===o.type?a=3:"v4"===o.type?a=4:"c"===o.type&&(a=3),o.size=a,o.array=new Float32Array(i*a),o.buffer=B.createBuffer(),o.buffer.belongsToAttribute=r,o.needsUpdate=!0}e.__webglCustomAttributesList.push(o)}}}function r(e,t){var i=t.geometry,n=e.faces3,r=e.faces4,l=3*n.length+4*r.length,c=1*n.length+2*r.length,r=3*n.length+4*r.length,n=o(t,e),h=s(n),u=a(n),f=n.vertexColors?n.vertexColors:!1;if(e.__vertexArray=new Float32Array(3*l),u&&(e.__normalArray=new Float32Array(3*l)),i.hasTangents&&(e.__tangentArray=new Float32Array(4*l)),f&&(e.__colorArray=new Float32Array(3*l)),h&&((0<i.faceUvs.length||0<i.faceVertexUvs.length)&&(e.__uvArray=new Float32Array(2*l)),(1<i.faceUvs.length||1<i.faceVertexUvs.length)&&(e.__uv2Array=new Float32Array(2*l))),t.geometry.skinWeights.length&&t.geometry.skinIndices.length&&(e.__skinIndexArray=new Float32Array(4*l),e.__skinWeightArray=new Float32Array(4*l)),e.__faceArray=new Uint16Array(3*c),e.__lineArray=new Uint16Array(2*r),e.numMorphTargets)for(e.__morphTargetsArrays=[],i=0,h=e.numMorphTargets;h>i;i++)e.__morphTargetsArrays.push(new Float32Array(3*l));if(e.numMorphNormals)for(e.__morphNormalsArrays=[],i=0,h=e.numMorphNormals;h>i;i++)e.__morphNormalsArrays.push(new Float32Array(3*l));if(e.__webglFaceCount=3*c,e.__webglLineCount=2*r,n.attributes){void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]);for(var p in n.attributes){var d,c=n.attributes[p],i={};for(d in c)i[d]=c[d];(!i.__webglInitialized||i.createUniqueBuffers)&&(i.__webglInitialized=!0,r=1,"v2"===i.type?r=2:"v3"===i.type?r=3:"v4"===i.type?r=4:"c"===i.type&&(r=3),i.size=r,i.array=new Float32Array(l*r),i.buffer=B.createBuffer(),i.buffer.belongsToAttribute=p,c.needsUpdate=!0,i.__original=c),e.__webglCustomAttributesList.push(i)}}e.__inittedArrays=!0}function o(t,i){return t.material instanceof e.MeshFaceMaterial?t.material.materials[i.materialIndex]:t.material}function a(t){return t instanceof e.MeshBasicMaterial&&!t.envMap||t instanceof e.MeshDepthMaterial?!1:t&&void 0!==t.shading&&t.shading===e.SmoothShading?e.SmoothShading:e.FlatShading}function s(t){return t.map||t.lightMap||t.bumpMap||t.normalMap||t.specularMap||t instanceof e.ShaderMaterial?!0:!1}function l(e){_t[e]||(B.enableVertexAttribArray(e),_t[e]=!0)}function c(){for(var e in _t)_t[e]&&(B.disableVertexAttribArray(e),_t[e]=!1)}function h(e,t){return e.z!==t.z?t.z-e.z:e.id-t.id}function u(e,t){return t[0]-e[0]}function f(e,t,i){if(e.length)for(var n=0,r=e.length;r>n;n++)tt=Q=null,J=et=ot=rt=ut=ht=at=-1,Et=!0,e[n].render(t,i,xt,wt),tt=Q=null,J=et=ot=rt=ut=ht=at=-1,Et=!0}function p(t,i,n,r,o,a,s,l){var c,h,u,f;i?(h=t.length-1,f=i=-1):(h=0,i=t.length,f=1);for(var p=h;p!==i;p+=f)if(c=t[p],c.render){if(h=c.object,u=c.buffer,l)c=l;else{if(c=c[n],!c)continue;s&&Y.setBlending(c.blending,c.blendEquation,c.blendSrc,c.blendDst),Y.setDepthTest(c.depthTest),Y.setDepthWrite(c.depthWrite),A(c.polygonOffset,c.polygonOffsetFactor,c.polygonOffsetUnits)}Y.setMaterialFaces(c),u instanceof e.BufferGeometry?Y.renderBufferDirect(r,o,a,c,u,h):Y.renderBuffer(r,o,a,c,u,h)}}function d(e,t,i,n,r,o,a){for(var s,l,c=0,h=e.length;h>c;c++)if(s=e[c],l=s.object,l.visible){if(a)s=a;else{if(s=s[t],!s)continue;o&&Y.setBlending(s.blending,s.blendEquation,s.blendSrc,s.blendDst),Y.setDepthTest(s.depthTest),Y.setDepthWrite(s.depthWrite),A(s.polygonOffset,s.polygonOffsetFactor,s.polygonOffsetUnits)}Y.renderImmediateObject(i,n,r,s,l)}}function m(t,i){var o,a,s,l;if(void 0===t.__webglInit&&(t.__webglInit=!0,t._modelViewMatrix=new e.Matrix4,t._normalMatrix=new e.Matrix3,void 0!==t.geometry&&void 0===t.geometry.__webglInit&&(t.geometry.__webglInit=!0,t.geometry.addEventListener("dispose",Bt)),a=t.geometry,void 0!==a))if(a instanceof e.BufferGeometry){var c,h;for(c in a.attributes)h="index"===c?B.ELEMENT_ARRAY_BUFFER:B.ARRAY_BUFFER,l=a.attributes[c],l.buffer=B.createBuffer(),B.bindBuffer(h,l.buffer),B.bufferData(h,l.array,B.STATIC_DRAW)}else if(t instanceof e.Mesh){if(s=t.material,void 0===a.geometryGroups){c=a;var u,f,p,d,m;h={};var v=c.morphTargets.length,y=c.morphNormals.length,b=s instanceof e.MeshFaceMaterial;for(c.geometryGroups={},s=0,u=c.faces.length;u>s;s++)f=c.faces[s],p=b?f.materialIndex:0,void 0===h[p]&&(h[p]={hash:p,counter:0}),m=h[p].hash+"_"+h[p].counter,void 0===c.geometryGroups[m]&&(c.geometryGroups[m]={faces3:[],faces4:[],materialIndex:p,vertices:0,numMorphTargets:v,numMorphNormals:y}),d=f instanceof e.Face3?3:4,65535<c.geometryGroups[m].vertices+d&&(h[p].counter+=1,m=h[p].hash+"_"+h[p].counter,void 0===c.geometryGroups[m]&&(c.geometryGroups[m]={faces3:[],faces4:[],materialIndex:p,vertices:0,numMorphTargets:v,numMorphNormals:y})),f instanceof e.Face3?c.geometryGroups[m].faces3.push(s):c.geometryGroups[m].faces4.push(s),c.geometryGroups[m].vertices+=d;c.geometryGroupsList=[];for(l in c.geometryGroups)c.geometryGroups[l].id=it++,c.geometryGroupsList.push(c.geometryGroups[l])}for(o in a.geometryGroups)if(l=a.geometryGroups[o],!l.__webglVertexBuffer){if(c=l,c.__webglVertexBuffer=B.createBuffer(),c.__webglNormalBuffer=B.createBuffer(),c.__webglTangentBuffer=B.createBuffer(),c.__webglColorBuffer=B.createBuffer(),c.__webglUVBuffer=B.createBuffer(),c.__webglUV2Buffer=B.createBuffer(),c.__webglSkinIndicesBuffer=B.createBuffer(),c.__webglSkinWeightsBuffer=B.createBuffer(),c.__webglFaceBuffer=B.createBuffer(),c.__webglLineBuffer=B.createBuffer(),v=h=void 0,c.numMorphTargets)for(c.__webglMorphTargetsBuffers=[],h=0,v=c.numMorphTargets;v>h;h++)c.__webglMorphTargetsBuffers.push(B.createBuffer());if(c.numMorphNormals)for(c.__webglMorphNormalsBuffers=[],h=0,v=c.numMorphNormals;v>h;h++)c.__webglMorphNormalsBuffers.push(B.createBuffer());Y.info.memory.geometries++,r(l,t),a.verticesNeedUpdate=!0,a.morphTargetsNeedUpdate=!0,a.elementsNeedUpdate=!0,a.uvsNeedUpdate=!0,a.normalsNeedUpdate=!0,a.tangentsNeedUpdate=!0,a.colorsNeedUpdate=!0
}}else t instanceof e.Ribbon?a.__webglVertexBuffer||(l=a,l.__webglVertexBuffer=B.createBuffer(),l.__webglColorBuffer=B.createBuffer(),l.__webglNormalBuffer=B.createBuffer(),Y.info.memory.geometries++,l=a,c=l.vertices.length,l.__vertexArray=new Float32Array(3*c),l.__colorArray=new Float32Array(3*c),l.__normalArray=new Float32Array(3*c),l.__webglVertexCount=c,n(l,t),a.verticesNeedUpdate=!0,a.colorsNeedUpdate=!0,a.normalsNeedUpdate=!0):t instanceof e.Line?a.__webglVertexBuffer||(l=a,l.__webglVertexBuffer=B.createBuffer(),l.__webglColorBuffer=B.createBuffer(),l.__webglLineDistanceBuffer=B.createBuffer(),Y.info.memory.geometries++,l=a,c=l.vertices.length,l.__vertexArray=new Float32Array(3*c),l.__colorArray=new Float32Array(3*c),l.__lineDistanceArray=new Float32Array(1*c),l.__webglLineCount=c,n(l,t),a.verticesNeedUpdate=!0,a.colorsNeedUpdate=!0,a.lineDistancesNeedUpdate=!0):t instanceof e.ParticleSystem&&!a.__webglVertexBuffer&&(l=a,l.__webglVertexBuffer=B.createBuffer(),l.__webglColorBuffer=B.createBuffer(),Y.info.memory.geometries++,l=a,c=l.vertices.length,l.__vertexArray=new Float32Array(3*c),l.__colorArray=new Float32Array(3*c),l.__sortArray=[],l.__webglParticleCount=c,n(l,t),a.verticesNeedUpdate=!0,a.colorsNeedUpdate=!0);if(void 0===t.__webglActive){if(t instanceof e.Mesh){if(a=t.geometry,a instanceof e.BufferGeometry)g(i.__webglObjects,a,t);else if(a instanceof e.Geometry)for(o in a.geometryGroups)l=a.geometryGroups[o],g(i.__webglObjects,l,t)}else t instanceof e.Ribbon||t instanceof e.Line||t instanceof e.ParticleSystem?(a=t.geometry,g(i.__webglObjects,a,t)):t instanceof e.ImmediateRenderObject||t.immediateRenderCallback?i.__webglObjectsImmediate.push({object:t,opaque:null,transparent:null}):t instanceof e.Sprite?i.__webglSprites.push(t):t instanceof e.LensFlare&&i.__webglFlares.push(t);t.__webglActive=!0}}function g(e,t,i){e.push({buffer:t,object:i,opaque:null,transparent:null})}function v(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function y(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}function b(t,i){t instanceof e.Mesh||t instanceof e.ParticleSystem||t instanceof e.Ribbon||t instanceof e.Line?x(i.__webglObjects,t):t instanceof e.Sprite?w(i.__webglSprites,t):t instanceof e.LensFlare?w(i.__webglFlares,t):(t instanceof e.ImmediateRenderObject||t.immediateRenderCallback)&&x(i.__webglObjectsImmediate,t),delete t.__webglActive}function x(e,t){for(var i=e.length-1;i>=0;i--)e[i].object===t&&e.splice(i,1)}function w(e,t){for(var i=e.length-1;i>=0;i--)e[i]===t&&e.splice(i,1)}function _(t,i,n,r,o){nt=0,r.needsUpdate&&(r.program&&Xt(r),Y.initMaterial(r,i,n,o),r.needsUpdate=!1),r.morphTargets&&!o.__webglMorphTargetInfluences&&(o.__webglMorphTargetInfluences=new Float32Array(Y.maxMorphTargets));var a=!1,s=r.program,l=s.uniforms,c=r.uniforms;if(s!==Q&&(B.useProgram(s),Q=s,a=!0),r.id!==J&&(J=r.id,a=!0),(a||t!==tt)&&(B.uniformMatrix4fv(l.projectionMatrix,!1,t.projectionMatrix.elements),t!==tt&&(tt=t)),r.skinning)if(Nt&&o.useVertexTexture){if(null!==l.boneTexture){var h=S();B.uniform1i(l.boneTexture,h),Y.setTexture(o.boneTexture,h)}}else null!==l.boneGlobalMatrices&&B.uniformMatrix4fv(l.boneGlobalMatrices,!1,o.boneMatrices);if(a){if(n&&r.fog&&(c.fogColor.value=n.color,n instanceof e.Fog?(c.fogNear.value=n.near,c.fogFar.value=n.far):n instanceof e.FogExp2&&(c.fogDensity.value=n.density)),r instanceof e.MeshPhongMaterial||r instanceof e.MeshLambertMaterial||r.lights){if(Et){for(var u,f,p,d,m=h=0,g=0,v=Pt,y=v.directional.colors,b=v.directional.positions,x=v.point.colors,w=v.point.positions,_=v.point.distances,T=v.spot.colors,A=v.spot.positions,E=v.spot.distances,P=v.spot.directions,R=v.spot.anglesCos,L=v.spot.exponents,G=v.hemi.skyColors,N=v.hemi.groundColors,V=v.hemi.positions,O=0,j=0,I=0,U=0,z=0,H=0,q=0,W=0,X=u=0,n=d=X=0,a=i.length;a>n;n++)u=i[n],u.onlyShadow||(f=u.color,p=u.intensity,d=u.distance,u instanceof e.AmbientLight?u.visible&&(Y.gammaInput?(h+=f.r*f.r,m+=f.g*f.g,g+=f.b*f.b):(h+=f.r,m+=f.g,g+=f.b)):u instanceof e.DirectionalLight?(z+=1,u.visible&&(At.getPositionFromMatrix(u.matrixWorld),Tt.getPositionFromMatrix(u.target.matrixWorld),At.sub(Tt),At.normalize(),0===At.x&&0===At.y&&0===At.z||(u=3*O,b[u]=At.x,b[u+1]=At.y,b[u+2]=At.z,Y.gammaInput?M(y,u,f,p*p):C(y,u,f,p),O+=1))):u instanceof e.PointLight?(H+=1,u.visible&&(X=3*j,Y.gammaInput?M(x,X,f,p*p):C(x,X,f,p),Tt.getPositionFromMatrix(u.matrixWorld),w[X]=Tt.x,w[X+1]=Tt.y,w[X+2]=Tt.z,_[j]=d,j+=1)):u instanceof e.SpotLight?(q+=1,u.visible&&(X=3*I,Y.gammaInput?M(T,X,f,p*p):C(T,X,f,p),Tt.getPositionFromMatrix(u.matrixWorld),A[X]=Tt.x,A[X+1]=Tt.y,A[X+2]=Tt.z,E[I]=d,At.copy(Tt),Tt.getPositionFromMatrix(u.target.matrixWorld),At.sub(Tt),At.normalize(),P[X]=At.x,P[X+1]=At.y,P[X+2]=At.z,R[I]=Math.cos(u.angle),L[I]=u.exponent,I+=1)):u instanceof e.HemisphereLight&&(W+=1,u.visible&&(At.getPositionFromMatrix(u.matrixWorld),At.normalize(),0===At.x&&0===At.y&&0===At.z||(d=3*U,V[d]=At.x,V[d+1]=At.y,V[d+2]=At.z,f=u.color,u=u.groundColor,Y.gammaInput?(p*=p,M(G,d,f,p),M(N,d,u,p)):(C(G,d,f,p),C(N,d,u,p)),U+=1))));for(n=3*O,a=Math.max(y.length,3*z);a>n;n++)y[n]=0;for(n=3*j,a=Math.max(x.length,3*H);a>n;n++)x[n]=0;for(n=3*I,a=Math.max(T.length,3*q);a>n;n++)T[n]=0;for(n=3*U,a=Math.max(G.length,3*W);a>n;n++)G[n]=0;for(n=3*U,a=Math.max(N.length,3*W);a>n;n++)N[n]=0;v.directional.length=O,v.point.length=j,v.spot.length=I,v.hemi.length=U,v.ambient[0]=h,v.ambient[1]=m,v.ambient[2]=g,Et=!1}n=Pt,c.ambientLightColor.value=n.ambient,c.directionalLightColor.value=n.directional.colors,c.directionalLightDirection.value=n.directional.positions,c.pointLightColor.value=n.point.colors,c.pointLightPosition.value=n.point.positions,c.pointLightDistance.value=n.point.distances,c.spotLightColor.value=n.spot.colors,c.spotLightPosition.value=n.spot.positions,c.spotLightDistance.value=n.spot.distances,c.spotLightDirection.value=n.spot.directions,c.spotLightAngleCos.value=n.spot.anglesCos,c.spotLightExponent.value=n.spot.exponents,c.hemisphereLightSkyColor.value=n.hemi.skyColors,c.hemisphereLightGroundColor.value=n.hemi.groundColors,c.hemisphereLightDirection.value=n.hemi.positions}if(r instanceof e.MeshBasicMaterial||r instanceof e.MeshLambertMaterial||r instanceof e.MeshPhongMaterial){c.opacity.value=r.opacity,Y.gammaInput?c.diffuse.value.copyGammaToLinear(r.color):c.diffuse.value=r.color,c.map.value=r.map,c.lightMap.value=r.lightMap,c.specularMap.value=r.specularMap,r.bumpMap&&(c.bumpMap.value=r.bumpMap,c.bumpScale.value=r.bumpScale),r.normalMap&&(c.normalMap.value=r.normalMap,c.normalScale.value.copy(r.normalScale));var K;r.map?K=r.map:r.specularMap?K=r.specularMap:r.normalMap?K=r.normalMap:r.bumpMap&&(K=r.bumpMap),void 0!==K&&(n=K.offset,K=K.repeat,c.offsetRepeat.value.set(n.x,n.y,K.x,K.y)),c.envMap.value=r.envMap,c.flipEnvMap.value=r.envMap instanceof e.WebGLRenderTargetCube?1:-1,c.reflectivity.value=r.reflectivity,c.refractionRatio.value=r.refractionRatio,c.combine.value=r.combine,c.useRefract.value=r.envMap&&r.envMap.mapping instanceof e.CubeRefractionMapping}if(r instanceof e.LineBasicMaterial?(c.diffuse.value=r.color,c.opacity.value=r.opacity):r instanceof e.LineDashedMaterial?(c.diffuse.value=r.color,c.opacity.value=r.opacity,c.dashSize.value=r.dashSize,c.totalSize.value=r.dashSize+r.gapSize,c.scale.value=r.scale):r instanceof e.ParticleBasicMaterial?(c.psColor.value=r.color,c.opacity.value=r.opacity,c.size.value=r.size,c.scale.value=F.height/2,c.map.value=r.map):r instanceof e.MeshPhongMaterial?(c.shininess.value=r.shininess,Y.gammaInput?(c.ambient.value.copyGammaToLinear(r.ambient),c.emissive.value.copyGammaToLinear(r.emissive),c.specular.value.copyGammaToLinear(r.specular)):(c.ambient.value=r.ambient,c.emissive.value=r.emissive,c.specular.value=r.specular),r.wrapAround&&c.wrapRGB.value.copy(r.wrapRGB)):r instanceof e.MeshLambertMaterial?(Y.gammaInput?(c.ambient.value.copyGammaToLinear(r.ambient),c.emissive.value.copyGammaToLinear(r.emissive)):(c.ambient.value=r.ambient,c.emissive.value=r.emissive),r.wrapAround&&c.wrapRGB.value.copy(r.wrapRGB)):r instanceof e.MeshDepthMaterial?(c.mNear.value=t.near,c.mFar.value=t.far,c.opacity.value=r.opacity):r instanceof e.MeshNormalMaterial&&(c.opacity.value=r.opacity),o.receiveShadow&&!r._shadowPass&&c.shadowMatrix)for(n=K=0,a=i.length;a>n;n++)h=i[n],h.castShadow&&(h instanceof e.SpotLight||h instanceof e.DirectionalLight&&!h.shadowCascade)&&(c.shadowMap.value[K]=h.shadowMap,c.shadowMapSize.value[K]=h.shadowMapSize,c.shadowMatrix.value[K]=h.shadowMatrix,c.shadowDarkness.value[K]=h.shadowDarkness,c.shadowBias.value[K]=h.shadowBias,K++);for(i=r.uniformsList,c=0,K=i.length;K>c;c++)if(a=s.uniforms[i[c][1]])if(n=i[c][0],m=n.type,h=n.value,"i"===m)B.uniform1i(a,h);else if("f"===m)B.uniform1f(a,h);else if("v2"===m)B.uniform2f(a,h.x,h.y);else if("v3"===m)B.uniform3f(a,h.x,h.y,h.z);else if("v4"===m)B.uniform4f(a,h.x,h.y,h.z,h.w);else if("c"===m)B.uniform3f(a,h.r,h.g,h.b);else if("iv1"===m)B.uniform1iv(a,h);else if("iv"===m)B.uniform3iv(a,h);else if("fv1"===m)B.uniform1fv(a,h);else if("fv"===m)B.uniform3fv(a,h);else if("v2v"===m){for(void 0===n._array&&(n._array=new Float32Array(2*h.length)),m=0,g=h.length;g>m;m++)v=2*m,n._array[v]=h[m].x,n._array[v+1]=h[m].y;B.uniform2fv(a,n._array)}else if("v3v"===m){for(void 0===n._array&&(n._array=new Float32Array(3*h.length)),m=0,g=h.length;g>m;m++)v=3*m,n._array[v]=h[m].x,n._array[v+1]=h[m].y,n._array[v+2]=h[m].z;B.uniform3fv(a,n._array)}else if("v4v"===m){for(void 0===n._array&&(n._array=new Float32Array(4*h.length)),m=0,g=h.length;g>m;m++)v=4*m,n._array[v]=h[m].x,n._array[v+1]=h[m].y,n._array[v+2]=h[m].z,n._array[v+3]=h[m].w;B.uniform4fv(a,n._array)}else if("m4"===m)void 0===n._array&&(n._array=new Float32Array(16)),h.flattenToArray(n._array),B.uniformMatrix4fv(a,!1,n._array);else if("m4v"===m){for(void 0===n._array&&(n._array=new Float32Array(16*h.length)),m=0,g=h.length;g>m;m++)h[m].flattenToArrayOffset(n._array,16*m);B.uniformMatrix4fv(a,!1,n._array)}else if("t"===m){if(v=h,h=S(),B.uniform1i(a,h),v)if(v.image instanceof Array&&6===v.image.length){if(n=v,a=h,6===n.image.length)if(n.needsUpdate){for(n.image.__webglTextureCube||(n.image.__webglTextureCube=B.createTexture(),Y.info.memory.textures++),B.activeTexture(B.TEXTURE0+a),B.bindTexture(B.TEXTURE_CUBE_MAP,n.image.__webglTextureCube),B.pixelStorei(B.UNPACK_FLIP_Y_WEBGL,n.flipY),a=n instanceof e.CompressedTexture,h=[],m=0;6>m;m++)Y.autoScaleCubemaps&&!a?(g=h,v=m,y=n.image[m],x=Dt,y.width<=x&&y.height<=x||(w=Math.max(y.width,y.height),b=Math.floor(y.width*x/w),x=Math.floor(y.height*x/w),w=document.createElement("canvas"),w.width=b,w.height=x,w.getContext("2d").drawImage(y,0,0,y.width,y.height,0,0,b,x),y=w),g[v]=y):h[m]=n.image[m];for(m=h[0],g=0===(m.width&m.width-1)&&0===(m.height&m.height-1),v=D(n.format),y=D(n.type),k(B.TEXTURE_CUBE_MAP,n,g),m=0;6>m;m++)if(a)for(x=h[m].mipmaps,w=0,_=x.length;_>w;w++)b=x[w],B.compressedTexImage2D(B.TEXTURE_CUBE_MAP_POSITIVE_X+m,w,v,b.width,b.height,0,b.data);else B.texImage2D(B.TEXTURE_CUBE_MAP_POSITIVE_X+m,0,v,v,y,h[m]);n.generateMipmaps&&g&&B.generateMipmap(B.TEXTURE_CUBE_MAP),n.needsUpdate=!1,n.onUpdate&&n.onUpdate()}else B.activeTexture(B.TEXTURE0+a),B.bindTexture(B.TEXTURE_CUBE_MAP,n.image.__webglTextureCube)}else v instanceof e.WebGLRenderTargetCube?(n=v,B.activeTexture(B.TEXTURE0+h),B.bindTexture(B.TEXTURE_CUBE_MAP,n.__webglTexture)):Y.setTexture(v,h)}else if("tv"===m){for(void 0===n._array&&(n._array=[]),m=0,g=n.value.length;g>m;m++)n._array[m]=S();for(B.uniform1iv(a,n._array),m=0,g=n.value.length;g>m;m++)v=n.value[m],h=n._array[m],v&&Y.setTexture(v,h)}(r instanceof e.ShaderMaterial||r instanceof e.MeshPhongMaterial||r.envMap)&&null!==l.cameraPosition&&(Tt.getPositionFromMatrix(t.matrixWorld),B.uniform3f(l.cameraPosition,Tt.x,Tt.y,Tt.z)),(r instanceof e.MeshPhongMaterial||r instanceof e.MeshLambertMaterial||r instanceof e.ShaderMaterial||r.skinning)&&null!==l.viewMatrix&&B.uniformMatrix4fv(l.viewMatrix,!1,t.matrixWorldInverse.elements)}return B.uniformMatrix4fv(l.modelViewMatrix,!1,o._modelViewMatrix.elements),l.normalMatrix&&B.uniformMatrix3fv(l.normalMatrix,!1,o._normalMatrix.elements),null!==l.modelMatrix&&B.uniformMatrix4fv(l.modelMatrix,!1,o.matrixWorld.elements),s}function S(){var e=nt;return e>=Rt&&console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+Rt),nt+=1,e}function M(e,t,i,n){e[t]=i.r*i.r*n,e[t+1]=i.g*i.g*n,e[t+2]=i.b*i.b*n}function C(e,t,i,n){e[t]=i.r*n,e[t+1]=i.g*n,e[t+2]=i.b*n}function T(e){e!==mt&&(B.lineWidth(e),mt=e)}function A(e,t,i){ft!==e&&(e?B.enable(B.POLYGON_OFFSET_FILL):B.disable(B.POLYGON_OFFSET_FILL),ft=e),!e||pt===t&&dt===i||(B.polygonOffset(t,i),pt=t,dt=i)}function E(e){for(var e=e.split("\n"),t=0,i=e.length;i>t;t++)e[t]=t+1+": "+e[t];return e.join("\n")}function P(e,t){var i;return"fragment"===e?i=B.createShader(B.FRAGMENT_SHADER):"vertex"===e&&(i=B.createShader(B.VERTEX_SHADER)),B.shaderSource(i,t),B.compileShader(i),B.getShaderParameter(i,B.COMPILE_STATUS)?i:(console.error(B.getShaderInfoLog(i)),console.error(E(t)),null)}function k(t,i,n){n?(B.texParameteri(t,B.TEXTURE_WRAP_S,D(i.wrapS)),B.texParameteri(t,B.TEXTURE_WRAP_T,D(i.wrapT)),B.texParameteri(t,B.TEXTURE_MAG_FILTER,D(i.magFilter)),B.texParameteri(t,B.TEXTURE_MIN_FILTER,D(i.minFilter))):(B.texParameteri(t,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE),B.texParameteri(t,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE),B.texParameteri(t,B.TEXTURE_MAG_FILTER,L(i.magFilter)),B.texParameteri(t,B.TEXTURE_MIN_FILTER,L(i.minFilter))),W&&i.type!==e.FloatType&&(1<i.anisotropy||i.__oldAnisotropy)&&(B.texParameterf(t,W.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(i.anisotropy,Ft)),i.__oldAnisotropy=i.anisotropy)}function R(e,t){B.bindRenderbuffer(B.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(B.renderbufferStorage(B.RENDERBUFFER,B.DEPTH_COMPONENT16,t.width,t.height),B.framebufferRenderbuffer(B.FRAMEBUFFER,B.DEPTH_ATTACHMENT,B.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(B.renderbufferStorage(B.RENDERBUFFER,B.DEPTH_STENCIL,t.width,t.height),B.framebufferRenderbuffer(B.FRAMEBUFFER,B.DEPTH_STENCIL_ATTACHMENT,B.RENDERBUFFER,e)):B.renderbufferStorage(B.RENDERBUFFER,B.RGBA4,t.width,t.height)}function L(t){return t===e.NearestFilter||t===e.NearestMipMapNearestFilter||t===e.NearestMipMapLinearFilter?B.NEAREST:B.LINEAR}function D(t){if(t===e.RepeatWrapping)return B.REPEAT;if(t===e.ClampToEdgeWrapping)return B.CLAMP_TO_EDGE;if(t===e.MirroredRepeatWrapping)return B.MIRRORED_REPEAT;if(t===e.NearestFilter)return B.NEAREST;if(t===e.NearestMipMapNearestFilter)return B.NEAREST_MIPMAP_NEAREST;if(t===e.NearestMipMapLinearFilter)return B.NEAREST_MIPMAP_LINEAR;if(t===e.LinearFilter)return B.LINEAR;if(t===e.LinearMipMapNearestFilter)return B.LINEAR_MIPMAP_NEAREST;if(t===e.LinearMipMapLinearFilter)return B.LINEAR_MIPMAP_LINEAR;if(t===e.UnsignedByteType)return B.UNSIGNED_BYTE;if(t===e.UnsignedShort4444Type)return B.UNSIGNED_SHORT_4_4_4_4;if(t===e.UnsignedShort5551Type)return B.UNSIGNED_SHORT_5_5_5_1;if(t===e.UnsignedShort565Type)return B.UNSIGNED_SHORT_5_6_5;if(t===e.ByteType)return B.BYTE;if(t===e.ShortType)return B.SHORT;if(t===e.UnsignedShortType)return B.UNSIGNED_SHORT;if(t===e.IntType)return B.INT;if(t===e.UnsignedIntType)return B.UNSIGNED_INT;if(t===e.FloatType)return B.FLOAT;if(t===e.AlphaFormat)return B.ALPHA;if(t===e.RGBFormat)return B.RGB;if(t===e.RGBAFormat)return B.RGBA;if(t===e.LuminanceFormat)return B.LUMINANCE;if(t===e.LuminanceAlphaFormat)return B.LUMINANCE_ALPHA;if(t===e.AddEquation)return B.FUNC_ADD;if(t===e.SubtractEquation)return B.FUNC_SUBTRACT;if(t===e.ReverseSubtractEquation)return B.FUNC_REVERSE_SUBTRACT;if(t===e.ZeroFactor)return B.ZERO;if(t===e.OneFactor)return B.ONE;if(t===e.SrcColorFactor)return B.SRC_COLOR;if(t===e.OneMinusSrcColorFactor)return B.ONE_MINUS_SRC_COLOR;if(t===e.SrcAlphaFactor)return B.SRC_ALPHA;if(t===e.OneMinusSrcAlphaFactor)return B.ONE_MINUS_SRC_ALPHA;if(t===e.DstAlphaFactor)return B.DST_ALPHA;if(t===e.OneMinusDstAlphaFactor)return B.ONE_MINUS_DST_ALPHA;if(t===e.DstColorFactor)return B.DST_COLOR;if(t===e.OneMinusDstColorFactor)return B.ONE_MINUS_DST_COLOR;if(t===e.SrcAlphaSaturateFactor)return B.SRC_ALPHA_SATURATE;if(void 0!==X){if(t===e.RGB_S3TC_DXT1_Format)return X.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===e.RGBA_S3TC_DXT1_Format)return X.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===e.RGBA_S3TC_DXT3_Format)return X.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===e.RGBA_S3TC_DXT5_Format)return X.COMPRESSED_RGBA_S3TC_DXT5_EXT}return 0}console.log("THREE.WebGLRenderer",e.REVISION);var t=t||{},F=void 0!==t.canvas?t.canvas:document.createElement("canvas"),G=void 0!==t.precision?t.precision:"highp",N=void 0!==t.alpha?t.alpha:!0,V=void 0!==t.premultipliedAlpha?t.premultipliedAlpha:!0,O=void 0!==t.antialias?t.antialias:!1,j=void 0!==t.stencil?t.stencil:!0,I=void 0!==t.preserveDrawingBuffer?t.preserveDrawingBuffer:!1,U=new e.Color(0),z=0;void 0!==t.clearColor&&(console.warn("DEPRECATED: clearColor in WebGLRenderer constructor parameters is being removed. Use .setClearColor() instead."),U.setHex(t.clearColor)),void 0!==t.clearAlpha&&(console.warn("DEPRECATED: clearAlpha in WebGLRenderer constructor parameters is being removed. Use .setClearColor() instead."),z=t.clearAlpha),this.domElement=F,this.context=null,this.devicePixelRatio=void 0!==t.devicePixelRatio?t.devicePixelRatio:void 0!==window.devicePixelRatio?window.devicePixelRatio:1,this.autoUpdateObjects=this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0,this.shadowMapEnabled=this.physicallyBasedShading=this.gammaOutput=this.gammaInput=!1,this.shadowMapAutoUpdate=!0,this.shadowMapType=e.PCFShadowMap,this.shadowMapCullFace=e.CullFaceFront,this.shadowMapCascade=this.shadowMapDebug=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.renderPluginsPre=[],this.renderPluginsPost=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var B,H,q,W,X,Y=this,K=[],$=0,Q=null,Z=null,J=-1,et=null,tt=null,it=0,nt=0,rt=-1,ot=-1,at=-1,st=-1,lt=-1,ct=-1,ht=-1,ut=-1,ft=null,pt=null,dt=null,mt=null,gt=0,vt=0,yt=0,bt=0,xt=0,wt=0,_t={},St=new e.Frustum,Mt=new e.Matrix4,Ct=new e.Matrix4,Tt=new e.Vector3,At=new e.Vector3,Et=!0,Pt={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}};try{if(!(B=F.getContext("experimental-webgl",{alpha:N,premultipliedAlpha:V,antialias:O,stencil:j,preserveDrawingBuffer:I})))throw"Error creating WebGL context."}catch(kt){console.error(kt)}H=B.getExtension("OES_texture_float"),q=B.getExtension("OES_standard_derivatives"),W=B.getExtension("EXT_texture_filter_anisotropic")||B.getExtension("MOZ_EXT_texture_filter_anisotropic")||B.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),X=B.getExtension("WEBGL_compressed_texture_s3tc")||B.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||B.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),H||console.log("THREE.WebGLRenderer: Float textures not supported."),q||console.log("THREE.WebGLRenderer: Standard derivatives not supported."),W||console.log("THREE.WebGLRenderer: Anisotropic texture filtering not supported."),X||console.log("THREE.WebGLRenderer: S3TC compressed textures not supported."),void 0===B.getShaderPrecisionFormat&&(B.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),B.clearColor(0,0,0,1),B.clearDepth(1),B.clearStencil(0),B.enable(B.DEPTH_TEST),B.depthFunc(B.LEQUAL),B.frontFace(B.CCW),B.cullFace(B.BACK),B.enable(B.CULL_FACE),B.enable(B.BLEND),B.blendEquation(B.FUNC_ADD),B.blendFunc(B.SRC_ALPHA,B.ONE_MINUS_SRC_ALPHA),B.clearColor(U.r,U.g,U.b,z),this.context=B;var Rt=B.getParameter(B.MAX_TEXTURE_IMAGE_UNITS),Lt=B.getParameter(B.MAX_VERTEX_TEXTURE_IMAGE_UNITS);B.getParameter(B.MAX_TEXTURE_SIZE);var Dt=B.getParameter(B.MAX_CUBE_MAP_TEXTURE_SIZE),Ft=W?B.getParameter(W.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,Gt=Lt>0,Nt=Gt&&H;X&&B.getParameter(B.COMPRESSED_TEXTURE_FORMATS);var Vt=B.getShaderPrecisionFormat(B.VERTEX_SHADER,B.HIGH_FLOAT),Ot=B.getShaderPrecisionFormat(B.VERTEX_SHADER,B.MEDIUM_FLOAT);B.getShaderPrecisionFormat(B.VERTEX_SHADER,B.LOW_FLOAT);var jt=B.getShaderPrecisionFormat(B.FRAGMENT_SHADER,B.HIGH_FLOAT),It=B.getShaderPrecisionFormat(B.FRAGMENT_SHADER,B.MEDIUM_FLOAT);B.getShaderPrecisionFormat(B.FRAGMENT_SHADER,B.LOW_FLOAT),B.getShaderPrecisionFormat(B.VERTEX_SHADER,B.HIGH_INT),B.getShaderPrecisionFormat(B.VERTEX_SHADER,B.MEDIUM_INT),B.getShaderPrecisionFormat(B.VERTEX_SHADER,B.LOW_INT),B.getShaderPrecisionFormat(B.FRAGMENT_SHADER,B.HIGH_INT),B.getShaderPrecisionFormat(B.FRAGMENT_SHADER,B.MEDIUM_INT),B.getShaderPrecisionFormat(B.FRAGMENT_SHADER,B.LOW_INT);var Ut=0<Vt.precision&&0<jt.precision,zt=0<Ot.precision&&0<It.precision;"highp"===G&&!Ut&&(zt?(G="mediump",console.warn("WebGLRenderer: highp not supported, using mediump")):(G="lowp",console.warn("WebGLRenderer: highp and mediump not supported, using lowp"))),"mediump"===G&&!zt&&(G="lowp",console.warn("WebGLRenderer: mediump not supported, using lowp")),this.getContext=function(){return B},this.supportsVertexTextures=function(){return Gt},this.supportsFloatTextures=function(){return H},this.supportsStandardDerivatives=function(){return q},this.supportsCompressedTextureS3TC=function(){return X},this.getMaxAnisotropy=function(){return Ft},this.getPrecision=function(){return G},this.setSize=function(e,t,i){F.width=e*this.devicePixelRatio,F.height=t*this.devicePixelRatio,1!==this.devicePixelRatio&&!1!==i&&(F.style.width=e+"px",F.style.height=t+"px"),this.setViewport(0,0,F.width,F.height)},this.setViewport=function(e,t,i,n){gt=void 0!==e?e:0,vt=void 0!==t?t:0,yt=void 0!==i?i:F.width,bt=void 0!==n?n:F.height,B.viewport(gt,vt,yt,bt)},this.setScissor=function(e,t,i,n){B.scissor(e,t,i,n)},this.enableScissorTest=function(e){e?B.enable(B.SCISSOR_TEST):B.disable(B.SCISSOR_TEST)},this.setClearColor=function(e,t){U.set(e),z=void 0!==t?t:1,B.clearColor(U.r,U.g,U.b,z)},this.setClearColorHex=function(e,t){console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getClearColor=function(){return U},this.getClearAlpha=function(){return z},this.clear=function(e,t,i){var n=0;(void 0===e||e)&&(n|=B.COLOR_BUFFER_BIT),(void 0===t||t)&&(n|=B.DEPTH_BUFFER_BIT),(void 0===i||i)&&(n|=B.STENCIL_BUFFER_BIT),B.clear(n)},this.clearTarget=function(e,t,i,n){this.setRenderTarget(e),this.clear(t,i,n)},this.addPostPlugin=function(e){e.init(this),this.renderPluginsPost.push(e)},this.addPrePlugin=function(e){e.init(this),this.renderPluginsPre.push(e)},this.updateShadowMap=function(e,t){Q=null,J=et=ut=ht=at=-1,Et=!0,ot=rt=-1,this.shadowMapPlugin.update(e,t)};var Bt=function(e){if(e=e.target,e.removeEventListener("dispose",Bt),e.__webglInit=void 0,void 0!==e.__webglVertexBuffer&&B.deleteBuffer(e.__webglVertexBuffer),void 0!==e.__webglNormalBuffer&&B.deleteBuffer(e.__webglNormalBuffer),void 0!==e.__webglTangentBuffer&&B.deleteBuffer(e.__webglTangentBuffer),void 0!==e.__webglColorBuffer&&B.deleteBuffer(e.__webglColorBuffer),void 0!==e.__webglUVBuffer&&B.deleteBuffer(e.__webglUVBuffer),void 0!==e.__webglUV2Buffer&&B.deleteBuffer(e.__webglUV2Buffer),void 0!==e.__webglSkinIndicesBuffer&&B.deleteBuffer(e.__webglSkinIndicesBuffer),void 0!==e.__webglSkinWeightsBuffer&&B.deleteBuffer(e.__webglSkinWeightsBuffer),void 0!==e.__webglFaceBuffer&&B.deleteBuffer(e.__webglFaceBuffer),void 0!==e.__webglLineBuffer&&B.deleteBuffer(e.__webglLineBuffer),void 0!==e.__webglLineDistanceBuffer&&B.deleteBuffer(e.__webglLineDistanceBuffer),void 0!==e.geometryGroups)for(var t in e.geometryGroups){var n=e.geometryGroups[t];if(void 0!==n.numMorphTargets)for(var r=0,o=n.numMorphTargets;o>r;r++)B.deleteBuffer(n.__webglMorphTargetsBuffers[r]);if(void 0!==n.numMorphNormals)for(r=0,o=n.numMorphNormals;o>r;r++)B.deleteBuffer(n.__webglMorphNormalsBuffers[r]);i(n)}i(e),Y.info.memory.geometries--},Ht=function(e){e=e.target,e.removeEventListener("dispose",Ht),e.image&&e.image.__webglTextureCube?B.deleteTexture(e.image.__webglTextureCube):e.__webglInit&&(e.__webglInit=!1,B.deleteTexture(e.__webglTexture)),Y.info.memory.textures--},qt=function(t){if(t=t.target,t.removeEventListener("dispose",qt),t&&t.__webglTexture)if(B.deleteTexture(t.__webglTexture),t instanceof e.WebGLRenderTargetCube)for(var i=0;6>i;i++)B.deleteFramebuffer(t.__webglFramebuffer[i]),B.deleteRenderbuffer(t.__webglRenderbuffer[i]);else B.deleteFramebuffer(t.__webglFramebuffer),B.deleteRenderbuffer(t.__webglRenderbuffer);Y.info.memory.textures--},Wt=function(e){e=e.target,e.removeEventListener("dispose",Wt),Xt(e)},Xt=function(e){var t=e.program;if(void 0!==t){e.program=void 0;var i,n,r=!1,e=0;for(i=K.length;i>e;e++)if(n=K[e],n.program===t){n.usedTimes--,0===n.usedTimes&&(r=!0);break}if(!0===r){for(r=[],e=0,i=K.length;i>e;e++)n=K[e],n.program!==t&&r.push(n);K=r,B.deleteProgram(t),Y.info.memory.programs--}}};this.renderBufferImmediate=function(t,i,n){if(t.hasPositions&&!t.__webglVertexBuffer&&(t.__webglVertexBuffer=B.createBuffer()),t.hasNormals&&!t.__webglNormalBuffer&&(t.__webglNormalBuffer=B.createBuffer()),t.hasUvs&&!t.__webglUvBuffer&&(t.__webglUvBuffer=B.createBuffer()),t.hasColors&&!t.__webglColorBuffer&&(t.__webglColorBuffer=B.createBuffer()),t.hasPositions&&(B.bindBuffer(B.ARRAY_BUFFER,t.__webglVertexBuffer),B.bufferData(B.ARRAY_BUFFER,t.positionArray,B.DYNAMIC_DRAW),B.enableVertexAttribArray(i.attributes.position),B.vertexAttribPointer(i.attributes.position,3,B.FLOAT,!1,0,0)),t.hasNormals){if(B.bindBuffer(B.ARRAY_BUFFER,t.__webglNormalBuffer),n.shading===e.FlatShading){var r,o,a,s,l,c,h,u,f,p,d,m=3*t.count;for(d=0;m>d;d+=9)p=t.normalArray,r=p[d],o=p[d+1],a=p[d+2],s=p[d+3],c=p[d+4],u=p[d+5],l=p[d+6],h=p[d+7],f=p[d+8],r=(r+s+l)/3,o=(o+c+h)/3,a=(a+u+f)/3,p[d]=r,p[d+1]=o,p[d+2]=a,p[d+3]=r,p[d+4]=o,p[d+5]=a,p[d+6]=r,p[d+7]=o,p[d+8]=a}B.bufferData(B.ARRAY_BUFFER,t.normalArray,B.DYNAMIC_DRAW),B.enableVertexAttribArray(i.attributes.normal),B.vertexAttribPointer(i.attributes.normal,3,B.FLOAT,!1,0,0)}t.hasUvs&&n.map&&(B.bindBuffer(B.ARRAY_BUFFER,t.__webglUvBuffer),B.bufferData(B.ARRAY_BUFFER,t.uvArray,B.DYNAMIC_DRAW),B.enableVertexAttribArray(i.attributes.uv),B.vertexAttribPointer(i.attributes.uv,2,B.FLOAT,!1,0,0)),t.hasColors&&n.vertexColors!==e.NoColors&&(B.bindBuffer(B.ARRAY_BUFFER,t.__webglColorBuffer),B.bufferData(B.ARRAY_BUFFER,t.colorArray,B.DYNAMIC_DRAW),B.enableVertexAttribArray(i.attributes.color),B.vertexAttribPointer(i.attributes.color,3,B.FLOAT,!1,0,0)),B.drawArrays(B.TRIANGLES,0,t.count),t.count=0},this.renderBufferDirect=function(t,i,n,r,o,a){if(!1!==r.visible){var s,h,u;if(s=_(t,i,n,r,a),t=s.attributes,i=o.attributes,n=!1,s=16777215*o.id+2*s.id+(r.wireframe?1:0),s!==et&&(et=s,n=!0),n&&c(),a instanceof e.Mesh)if(r=i.index){o=o.offsets,1<o.length&&(n=!0);for(var f=0,p=o.length;p>f;f++){var d=o[f].index;if(n){for(h in i)"index"!==h&&(s=t[h],a=i[h],u=a.itemSize,s>=0&&(B.bindBuffer(B.ARRAY_BUFFER,a.buffer),l(s),B.vertexAttribPointer(s,u,B.FLOAT,!1,0,4*d*u)));B.bindBuffer(B.ELEMENT_ARRAY_BUFFER,r.buffer)}B.drawElements(B.TRIANGLES,o[f].count,B.UNSIGNED_SHORT,2*o[f].start),Y.info.render.calls++,Y.info.render.vertices+=o[f].count,Y.info.render.faces+=o[f].count/3}}else{if(n)for(h in i)"index"!==h&&(s=t[h],a=i[h],u=a.itemSize,s>=0&&(B.bindBuffer(B.ARRAY_BUFFER,a.buffer),l(s),B.vertexAttribPointer(s,u,B.FLOAT,!1,0,0)));h=o.attributes.position,B.drawArrays(B.TRIANGLES,0,h.numItems/3),Y.info.render.calls++,Y.info.render.vertices+=h.numItems/3,Y.info.render.faces+=h.numItems/3/3}else if(a instanceof e.ParticleSystem){if(n){for(h in i)s=t[h],a=i[h],u=a.itemSize,s>=0&&(B.bindBuffer(B.ARRAY_BUFFER,a.buffer),l(s),B.vertexAttribPointer(s,u,B.FLOAT,!1,0,0));h=i.position,B.drawArrays(B.POINTS,0,h.numItems/3),Y.info.render.calls++,Y.info.render.points+=h.numItems/3}}else if(a instanceof e.Line&&n){for(h in i)s=t[h],a=i[h],u=a.itemSize,s>=0&&(B.bindBuffer(B.ARRAY_BUFFER,a.buffer),l(s),B.vertexAttribPointer(s,u,B.FLOAT,!1,0,0));T(r.linewidth),h=i.position,B.drawArrays(B.LINE_STRIP,0,h.numItems/3),Y.info.render.calls++,Y.info.render.points+=h.numItems}}},this.renderBuffer=function(t,i,n,r,o,a){if(!1!==r.visible){var s,h,n=_(t,i,n,r,a),t=n.attributes,i=!1,n=16777215*o.id+2*n.id+(r.wireframe?1:0);if(n!==et&&(et=n,i=!0),i&&c(),!r.morphTargets&&0<=t.position)i&&(B.bindBuffer(B.ARRAY_BUFFER,o.__webglVertexBuffer),l(t.position),B.vertexAttribPointer(t.position,3,B.FLOAT,!1,0,0));else if(a.morphTargetBase){if(n=r.program.attributes,-1!==a.morphTargetBase&&0<=n.position?(B.bindBuffer(B.ARRAY_BUFFER,o.__webglMorphTargetsBuffers[a.morphTargetBase]),l(n.position),B.vertexAttribPointer(n.position,3,B.FLOAT,!1,0,0)):0<=n.position&&(B.bindBuffer(B.ARRAY_BUFFER,o.__webglVertexBuffer),l(n.position),B.vertexAttribPointer(n.position,3,B.FLOAT,!1,0,0)),a.morphTargetForcedOrder.length){var f=0;for(h=a.morphTargetForcedOrder,s=a.morphTargetInfluences;f<r.numSupportedMorphTargets&&f<h.length;)0<=n["morphTarget"+f]&&(B.bindBuffer(B.ARRAY_BUFFER,o.__webglMorphTargetsBuffers[h[f]]),l(n["morphTarget"+f]),B.vertexAttribPointer(n["morphTarget"+f],3,B.FLOAT,!1,0,0)),0<=n["morphNormal"+f]&&r.morphNormals&&(B.bindBuffer(B.ARRAY_BUFFER,o.__webglMorphNormalsBuffers[h[f]]),l(n["morphNormal"+f]),B.vertexAttribPointer(n["morphNormal"+f],3,B.FLOAT,!1,0,0)),a.__webglMorphTargetInfluences[f]=s[h[f]],f++}else{h=[],s=a.morphTargetInfluences;var p,d=s.length;for(p=0;d>p;p++)f=s[p],f>0&&h.push([f,p]);for(h.length>r.numSupportedMorphTargets?(h.sort(u),h.length=r.numSupportedMorphTargets):h.length>r.numSupportedMorphNormals?h.sort(u):0===h.length&&h.push([0,0]),f=0;f<r.numSupportedMorphTargets;)h[f]?(p=h[f][1],0<=n["morphTarget"+f]&&(B.bindBuffer(B.ARRAY_BUFFER,o.__webglMorphTargetsBuffers[p]),l(n["morphTarget"+f]),B.vertexAttribPointer(n["morphTarget"+f],3,B.FLOAT,!1,0,0)),0<=n["morphNormal"+f]&&r.morphNormals&&(B.bindBuffer(B.ARRAY_BUFFER,o.__webglMorphNormalsBuffers[p]),l(n["morphNormal"+f]),B.vertexAttribPointer(n["morphNormal"+f],3,B.FLOAT,!1,0,0)),a.__webglMorphTargetInfluences[f]=s[p]):a.__webglMorphTargetInfluences[f]=0,f++}null!==r.program.uniforms.morphTargetInfluences&&B.uniform1fv(r.program.uniforms.morphTargetInfluences,a.__webglMorphTargetInfluences)}if(i){if(o.__webglCustomAttributesList)for(s=0,h=o.__webglCustomAttributesList.length;h>s;s++)n=o.__webglCustomAttributesList[s],0<=t[n.buffer.belongsToAttribute]&&(B.bindBuffer(B.ARRAY_BUFFER,n.buffer),l(t[n.buffer.belongsToAttribute]),B.vertexAttribPointer(t[n.buffer.belongsToAttribute],n.size,B.FLOAT,!1,0,0));0<=t.color&&(B.bindBuffer(B.ARRAY_BUFFER,o.__webglColorBuffer),l(t.color),B.vertexAttribPointer(t.color,3,B.FLOAT,!1,0,0)),0<=t.normal&&(B.bindBuffer(B.ARRAY_BUFFER,o.__webglNormalBuffer),l(t.normal),B.vertexAttribPointer(t.normal,3,B.FLOAT,!1,0,0)),0<=t.tangent&&(B.bindBuffer(B.ARRAY_BUFFER,o.__webglTangentBuffer),l(t.tangent),B.vertexAttribPointer(t.tangent,4,B.FLOAT,!1,0,0)),0<=t.uv&&(B.bindBuffer(B.ARRAY_BUFFER,o.__webglUVBuffer),l(t.uv),B.vertexAttribPointer(t.uv,2,B.FLOAT,!1,0,0)),0<=t.uv2&&(B.bindBuffer(B.ARRAY_BUFFER,o.__webglUV2Buffer),l(t.uv2),B.vertexAttribPointer(t.uv2,2,B.FLOAT,!1,0,0)),r.skinning&&0<=t.skinIndex&&0<=t.skinWeight&&(B.bindBuffer(B.ARRAY_BUFFER,o.__webglSkinIndicesBuffer),l(t.skinIndex),B.vertexAttribPointer(t.skinIndex,4,B.FLOAT,!1,0,0),B.bindBuffer(B.ARRAY_BUFFER,o.__webglSkinWeightsBuffer),l(t.skinWeight),B.vertexAttribPointer(t.skinWeight,4,B.FLOAT,!1,0,0)),0<=t.lineDistance&&(B.bindBuffer(B.ARRAY_BUFFER,o.__webglLineDistanceBuffer),l(t.lineDistance),B.vertexAttribPointer(t.lineDistance,1,B.FLOAT,!1,0,0))}a instanceof e.Mesh?(r.wireframe?(T(r.wireframeLinewidth),i&&B.bindBuffer(B.ELEMENT_ARRAY_BUFFER,o.__webglLineBuffer),B.drawElements(B.LINES,o.__webglLineCount,B.UNSIGNED_SHORT,0)):(i&&B.bindBuffer(B.ELEMENT_ARRAY_BUFFER,o.__webglFaceBuffer),B.drawElements(B.TRIANGLES,o.__webglFaceCount,B.UNSIGNED_SHORT,0)),Y.info.render.calls++,Y.info.render.vertices+=o.__webglFaceCount,Y.info.render.faces+=o.__webglFaceCount/3):a instanceof e.Line?(a=a.type===e.LineStrip?B.LINE_STRIP:B.LINES,T(r.linewidth),B.drawArrays(a,0,o.__webglLineCount),Y.info.render.calls++):a instanceof e.ParticleSystem?(B.drawArrays(B.POINTS,0,o.__webglParticleCount),Y.info.render.calls++,Y.info.render.points+=o.__webglParticleCount):a instanceof e.Ribbon&&(B.drawArrays(B.TRIANGLE_STRIP,0,o.__webglVertexCount),Y.info.render.calls++)
}},this.render=function(t,i,n,r){if(!1==i instanceof e.Camera)console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else{var o,a,s,l,c=t.__lights,u=t.fog;for(J=-1,Et=!0,!0===t.autoUpdate&&t.updateMatrixWorld(),void 0===i.parent&&i.updateMatrixWorld(),i.matrixWorldInverse.getInverse(i.matrixWorld),Mt.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),St.setFromMatrix(Mt),this.autoUpdateObjects&&this.initWebGLObjects(t),f(this.renderPluginsPre,t,i),Y.info.render.calls=0,Y.info.render.vertices=0,Y.info.render.faces=0,Y.info.render.points=0,this.setRenderTarget(n),(this.autoClear||r)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),l=t.__webglObjects,r=0,o=l.length;o>r;r++)if(a=l[r],s=a.object,a.id=r,a.render=!1,s.visible&&(!(s instanceof e.Mesh||s instanceof e.ParticleSystem)||!s.frustumCulled||St.intersectsObject(s))){var m=s;m._modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,m.matrixWorld),m._normalMatrix.getNormalMatrix(m._modelViewMatrix);var m=a,g=m.buffer,v=void 0,y=v=void 0,y=m.object.material;y instanceof e.MeshFaceMaterial?(v=g.materialIndex,v=y.materials[v],v.transparent?(m.transparent=v,m.opaque=null):(m.opaque=v,m.transparent=null)):(v=y)&&(v.transparent?(m.transparent=v,m.opaque=null):(m.opaque=v,m.transparent=null)),a.render=!0,!0===this.sortObjects&&(null!==s.renderDepth?a.z=s.renderDepth:(Tt.getPositionFromMatrix(s.matrixWorld),Tt.applyProjection(Mt),a.z=Tt.z))}for(this.sortObjects&&l.sort(h),l=t.__webglObjectsImmediate,r=0,o=l.length;o>r;r++)a=l[r],s=a.object,s.visible&&(s._modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,s.matrixWorld),s._normalMatrix.getNormalMatrix(s._modelViewMatrix),s=a.object.material,s.transparent?(a.transparent=s,a.opaque=null):(a.opaque=s,a.transparent=null));t.overrideMaterial?(r=t.overrideMaterial,this.setBlending(r.blending,r.blendEquation,r.blendSrc,r.blendDst),this.setDepthTest(r.depthTest),this.setDepthWrite(r.depthWrite),A(r.polygonOffset,r.polygonOffsetFactor,r.polygonOffsetUnits),p(t.__webglObjects,!1,"",i,c,u,!0,r),d(t.__webglObjectsImmediate,"",i,c,u,!1,r)):(r=null,this.setBlending(e.NoBlending),p(t.__webglObjects,!0,"opaque",i,c,u,!1,r),d(t.__webglObjectsImmediate,"opaque",i,c,u,!1,r),p(t.__webglObjects,!1,"transparent",i,c,u,!0,r),d(t.__webglObjectsImmediate,"transparent",i,c,u,!0,r)),f(this.renderPluginsPost,t,i),n&&n.generateMipmaps&&n.minFilter!==e.NearestFilter&&n.minFilter!==e.LinearFilter&&(n instanceof e.WebGLRenderTargetCube?(B.bindTexture(B.TEXTURE_CUBE_MAP,n.__webglTexture),B.generateMipmap(B.TEXTURE_CUBE_MAP),B.bindTexture(B.TEXTURE_CUBE_MAP,null)):(B.bindTexture(B.TEXTURE_2D,n.__webglTexture),B.generateMipmap(B.TEXTURE_2D),B.bindTexture(B.TEXTURE_2D,null))),this.setDepthTest(!0),this.setDepthWrite(!0)}},this.renderImmediateObject=function(e,t,i,n,r){var o=_(e,t,i,n,r);et=-1,Y.setMaterialFaces(n),r.immediateRenderCallback?r.immediateRenderCallback(o,B,St):r.render(function(e){Y.renderBufferImmediate(e,o,n)})},this.initWebGLObjects=function(t){for(t.__webglObjects||(t.__webglObjects=[],t.__webglObjectsImmediate=[],t.__webglSprites=[],t.__webglFlares=[]);t.__objectsAdded.length;)m(t.__objectsAdded[0],t),t.__objectsAdded.splice(0,1);for(;t.__objectsRemoved.length;)b(t.__objectsRemoved[0],t),t.__objectsRemoved.splice(0,1);for(var i=0,n=t.__webglObjects.length;n>i;i++){var l=t.__webglObjects[i].object;void 0===l.__webglInit&&(void 0!==l.__webglActive&&b(l,t),m(l,t));var c=l,h=c.geometry,f=void 0,p=void 0,d=void 0;if(h instanceof e.BufferGeometry){var g=B.DYNAMIC_DRAW,x=!h.dynamic,w=h.attributes,_=void 0,S=void 0;for(_ in w)S=w[_],S.needsUpdate&&("index"===_?(B.bindBuffer(B.ELEMENT_ARRAY_BUFFER,S.buffer),B.bufferData(B.ELEMENT_ARRAY_BUFFER,S.array,g)):(B.bindBuffer(B.ARRAY_BUFFER,S.buffer),B.bufferData(B.ARRAY_BUFFER,S.array,g)),S.needsUpdate=!1),x&&!S.dynamic&&delete S.array}else if(c instanceof e.Mesh){for(var M=0,C=h.geometryGroupsList.length;C>M;M++)if(f=h.geometryGroupsList[M],d=o(c,f),h.buffersNeedUpdate&&r(f,c),p=d.attributes&&v(d),h.verticesNeedUpdate||h.morphTargetsNeedUpdate||h.elementsNeedUpdate||h.uvsNeedUpdate||h.normalsNeedUpdate||h.colorsNeedUpdate||h.tangentsNeedUpdate||p){var T=f,A=c,E=B.DYNAMIC_DRAW,P=!h.dynamic,k=d;if(T.__inittedArrays){var R=a(k),L=k.vertexColors?k.vertexColors:!1,D=s(k),F=R===e.SmoothShading,G=void 0,N=void 0,V=void 0,O=void 0,j=void 0,I=void 0,U=void 0,z=void 0,H=void 0,q=void 0,W=void 0,X=void 0,Y=void 0,K=void 0,$=void 0,Q=void 0,Z=void 0,J=void 0,et=void 0,tt=void 0,it=void 0,nt=void 0,rt=void 0,ot=void 0,at=void 0,st=void 0,lt=void 0,ct=void 0,ht=void 0,ut=void 0,ft=void 0,pt=void 0,dt=void 0,mt=void 0,gt=void 0,vt=void 0,yt=void 0,bt=void 0,xt=void 0,wt=void 0,_t=void 0,St=void 0,At=void 0,Et=void 0,Pt=void 0,kt=void 0,Rt=0,Lt=0,Dt=0,Ft=0,Gt=0,Nt=0,Vt=0,Ot=0,jt=0,It=0,Ut=0,zt=0,Bt=void 0,Ht=T.__vertexArray,qt=T.__uvArray,Wt=T.__uv2Array,Xt=T.__normalArray,Yt=T.__tangentArray,Kt=T.__colorArray,$t=T.__skinIndexArray,Qt=T.__skinWeightArray,Zt=T.__morphTargetsArrays,Jt=T.__morphNormalsArrays,ei=T.__webglCustomAttributesList,ti=void 0,ii=T.__faceArray,ni=T.__lineArray,ri=A.geometry,oi=ri.elementsNeedUpdate,ai=ri.uvsNeedUpdate,si=ri.normalsNeedUpdate,li=ri.tangentsNeedUpdate,ci=ri.colorsNeedUpdate,hi=ri.morphTargetsNeedUpdate,ui=ri.vertices,fi=T.faces3,pi=T.faces4,di=ri.faces,mi=ri.faceVertexUvs[0],gi=ri.faceVertexUvs[1],vi=ri.skinIndices,yi=ri.skinWeights,bi=ri.morphTargets,xi=ri.morphNormals;if(ri.verticesNeedUpdate){for(G=0,N=fi.length;N>G;G++)O=di[fi[G]],X=ui[O.a],Y=ui[O.b],K=ui[O.c],Ht[Lt]=X.x,Ht[Lt+1]=X.y,Ht[Lt+2]=X.z,Ht[Lt+3]=Y.x,Ht[Lt+4]=Y.y,Ht[Lt+5]=Y.z,Ht[Lt+6]=K.x,Ht[Lt+7]=K.y,Ht[Lt+8]=K.z,Lt+=9;for(G=0,N=pi.length;N>G;G++)O=di[pi[G]],X=ui[O.a],Y=ui[O.b],K=ui[O.c],$=ui[O.d],Ht[Lt]=X.x,Ht[Lt+1]=X.y,Ht[Lt+2]=X.z,Ht[Lt+3]=Y.x,Ht[Lt+4]=Y.y,Ht[Lt+5]=Y.z,Ht[Lt+6]=K.x,Ht[Lt+7]=K.y,Ht[Lt+8]=K.z,Ht[Lt+9]=$.x,Ht[Lt+10]=$.y,Ht[Lt+11]=$.z,Lt+=12;B.bindBuffer(B.ARRAY_BUFFER,T.__webglVertexBuffer),B.bufferData(B.ARRAY_BUFFER,Ht,E)}if(hi)for(_t=0,St=bi.length;St>_t;_t++){for(G=Ut=0,N=fi.length;N>G;G++)Pt=fi[G],O=di[Pt],X=bi[_t].vertices[O.a],Y=bi[_t].vertices[O.b],K=bi[_t].vertices[O.c],At=Zt[_t],At[Ut]=X.x,At[Ut+1]=X.y,At[Ut+2]=X.z,At[Ut+3]=Y.x,At[Ut+4]=Y.y,At[Ut+5]=Y.z,At[Ut+6]=K.x,At[Ut+7]=K.y,At[Ut+8]=K.z,k.morphNormals&&(F?(kt=xi[_t].vertexNormals[Pt],tt=kt.a,it=kt.b,nt=kt.c):nt=it=tt=xi[_t].faceNormals[Pt],Et=Jt[_t],Et[Ut]=tt.x,Et[Ut+1]=tt.y,Et[Ut+2]=tt.z,Et[Ut+3]=it.x,Et[Ut+4]=it.y,Et[Ut+5]=it.z,Et[Ut+6]=nt.x,Et[Ut+7]=nt.y,Et[Ut+8]=nt.z),Ut+=9;for(G=0,N=pi.length;N>G;G++)Pt=pi[G],O=di[Pt],X=bi[_t].vertices[O.a],Y=bi[_t].vertices[O.b],K=bi[_t].vertices[O.c],$=bi[_t].vertices[O.d],At=Zt[_t],At[Ut]=X.x,At[Ut+1]=X.y,At[Ut+2]=X.z,At[Ut+3]=Y.x,At[Ut+4]=Y.y,At[Ut+5]=Y.z,At[Ut+6]=K.x,At[Ut+7]=K.y,At[Ut+8]=K.z,At[Ut+9]=$.x,At[Ut+10]=$.y,At[Ut+11]=$.z,k.morphNormals&&(F?(kt=xi[_t].vertexNormals[Pt],tt=kt.a,it=kt.b,nt=kt.c,rt=kt.d):rt=nt=it=tt=xi[_t].faceNormals[Pt],Et=Jt[_t],Et[Ut]=tt.x,Et[Ut+1]=tt.y,Et[Ut+2]=tt.z,Et[Ut+3]=it.x,Et[Ut+4]=it.y,Et[Ut+5]=it.z,Et[Ut+6]=nt.x,Et[Ut+7]=nt.y,Et[Ut+8]=nt.z,Et[Ut+9]=rt.x,Et[Ut+10]=rt.y,Et[Ut+11]=rt.z),Ut+=12;B.bindBuffer(B.ARRAY_BUFFER,T.__webglMorphTargetsBuffers[_t]),B.bufferData(B.ARRAY_BUFFER,Zt[_t],E),k.morphNormals&&(B.bindBuffer(B.ARRAY_BUFFER,T.__webglMorphNormalsBuffers[_t]),B.bufferData(B.ARRAY_BUFFER,Jt[_t],E))}if(yi.length){for(G=0,N=fi.length;N>G;G++)O=di[fi[G]],ct=yi[O.a],ht=yi[O.b],ut=yi[O.c],Qt[It]=ct.x,Qt[It+1]=ct.y,Qt[It+2]=ct.z,Qt[It+3]=ct.w,Qt[It+4]=ht.x,Qt[It+5]=ht.y,Qt[It+6]=ht.z,Qt[It+7]=ht.w,Qt[It+8]=ut.x,Qt[It+9]=ut.y,Qt[It+10]=ut.z,Qt[It+11]=ut.w,pt=vi[O.a],dt=vi[O.b],mt=vi[O.c],$t[It]=pt.x,$t[It+1]=pt.y,$t[It+2]=pt.z,$t[It+3]=pt.w,$t[It+4]=dt.x,$t[It+5]=dt.y,$t[It+6]=dt.z,$t[It+7]=dt.w,$t[It+8]=mt.x,$t[It+9]=mt.y,$t[It+10]=mt.z,$t[It+11]=mt.w,It+=12;for(G=0,N=pi.length;N>G;G++)O=di[pi[G]],ct=yi[O.a],ht=yi[O.b],ut=yi[O.c],ft=yi[O.d],Qt[It]=ct.x,Qt[It+1]=ct.y,Qt[It+2]=ct.z,Qt[It+3]=ct.w,Qt[It+4]=ht.x,Qt[It+5]=ht.y,Qt[It+6]=ht.z,Qt[It+7]=ht.w,Qt[It+8]=ut.x,Qt[It+9]=ut.y,Qt[It+10]=ut.z,Qt[It+11]=ut.w,Qt[It+12]=ft.x,Qt[It+13]=ft.y,Qt[It+14]=ft.z,Qt[It+15]=ft.w,pt=vi[O.a],dt=vi[O.b],mt=vi[O.c],gt=vi[O.d],$t[It]=pt.x,$t[It+1]=pt.y,$t[It+2]=pt.z,$t[It+3]=pt.w,$t[It+4]=dt.x,$t[It+5]=dt.y,$t[It+6]=dt.z,$t[It+7]=dt.w,$t[It+8]=mt.x,$t[It+9]=mt.y,$t[It+10]=mt.z,$t[It+11]=mt.w,$t[It+12]=gt.x,$t[It+13]=gt.y,$t[It+14]=gt.z,$t[It+15]=gt.w,It+=16;It>0&&(B.bindBuffer(B.ARRAY_BUFFER,T.__webglSkinIndicesBuffer),B.bufferData(B.ARRAY_BUFFER,$t,E),B.bindBuffer(B.ARRAY_BUFFER,T.__webglSkinWeightsBuffer),B.bufferData(B.ARRAY_BUFFER,Qt,E))}if(ci&&L){for(G=0,N=fi.length;N>G;G++)O=di[fi[G]],U=O.vertexColors,z=O.color,3===U.length&&L===e.VertexColors?(ot=U[0],at=U[1],st=U[2]):st=at=ot=z,Kt[jt]=ot.r,Kt[jt+1]=ot.g,Kt[jt+2]=ot.b,Kt[jt+3]=at.r,Kt[jt+4]=at.g,Kt[jt+5]=at.b,Kt[jt+6]=st.r,Kt[jt+7]=st.g,Kt[jt+8]=st.b,jt+=9;for(G=0,N=pi.length;N>G;G++)O=di[pi[G]],U=O.vertexColors,z=O.color,4===U.length&&L===e.VertexColors?(ot=U[0],at=U[1],st=U[2],lt=U[3]):lt=st=at=ot=z,Kt[jt]=ot.r,Kt[jt+1]=ot.g,Kt[jt+2]=ot.b,Kt[jt+3]=at.r,Kt[jt+4]=at.g,Kt[jt+5]=at.b,Kt[jt+6]=st.r,Kt[jt+7]=st.g,Kt[jt+8]=st.b,Kt[jt+9]=lt.r,Kt[jt+10]=lt.g,Kt[jt+11]=lt.b,jt+=12;jt>0&&(B.bindBuffer(B.ARRAY_BUFFER,T.__webglColorBuffer),B.bufferData(B.ARRAY_BUFFER,Kt,E))}if(li&&ri.hasTangents){for(G=0,N=fi.length;N>G;G++)O=di[fi[G]],H=O.vertexTangents,Q=H[0],Z=H[1],J=H[2],Yt[Vt]=Q.x,Yt[Vt+1]=Q.y,Yt[Vt+2]=Q.z,Yt[Vt+3]=Q.w,Yt[Vt+4]=Z.x,Yt[Vt+5]=Z.y,Yt[Vt+6]=Z.z,Yt[Vt+7]=Z.w,Yt[Vt+8]=J.x,Yt[Vt+9]=J.y,Yt[Vt+10]=J.z,Yt[Vt+11]=J.w,Vt+=12;for(G=0,N=pi.length;N>G;G++)O=di[pi[G]],H=O.vertexTangents,Q=H[0],Z=H[1],J=H[2],et=H[3],Yt[Vt]=Q.x,Yt[Vt+1]=Q.y,Yt[Vt+2]=Q.z,Yt[Vt+3]=Q.w,Yt[Vt+4]=Z.x,Yt[Vt+5]=Z.y,Yt[Vt+6]=Z.z,Yt[Vt+7]=Z.w,Yt[Vt+8]=J.x,Yt[Vt+9]=J.y,Yt[Vt+10]=J.z,Yt[Vt+11]=J.w,Yt[Vt+12]=et.x,Yt[Vt+13]=et.y,Yt[Vt+14]=et.z,Yt[Vt+15]=et.w,Vt+=16;B.bindBuffer(B.ARRAY_BUFFER,T.__webglTangentBuffer),B.bufferData(B.ARRAY_BUFFER,Yt,E)}if(si&&R){for(G=0,N=fi.length;N>G;G++)if(O=di[fi[G]],j=O.vertexNormals,I=O.normal,3===j.length&&F)for(vt=0;3>vt;vt++)bt=j[vt],Xt[Nt]=bt.x,Xt[Nt+1]=bt.y,Xt[Nt+2]=bt.z,Nt+=3;else for(vt=0;3>vt;vt++)Xt[Nt]=I.x,Xt[Nt+1]=I.y,Xt[Nt+2]=I.z,Nt+=3;for(G=0,N=pi.length;N>G;G++)if(O=di[pi[G]],j=O.vertexNormals,I=O.normal,4===j.length&&F)for(vt=0;4>vt;vt++)bt=j[vt],Xt[Nt]=bt.x,Xt[Nt+1]=bt.y,Xt[Nt+2]=bt.z,Nt+=3;else for(vt=0;4>vt;vt++)Xt[Nt]=I.x,Xt[Nt+1]=I.y,Xt[Nt+2]=I.z,Nt+=3;B.bindBuffer(B.ARRAY_BUFFER,T.__webglNormalBuffer),B.bufferData(B.ARRAY_BUFFER,Xt,E)}if(ai&&mi&&D){for(G=0,N=fi.length;N>G;G++)if(V=fi[G],q=mi[V],void 0!==q)for(vt=0;3>vt;vt++)xt=q[vt],qt[Dt]=xt.x,qt[Dt+1]=xt.y,Dt+=2;for(G=0,N=pi.length;N>G;G++)if(V=pi[G],q=mi[V],void 0!==q)for(vt=0;4>vt;vt++)xt=q[vt],qt[Dt]=xt.x,qt[Dt+1]=xt.y,Dt+=2;Dt>0&&(B.bindBuffer(B.ARRAY_BUFFER,T.__webglUVBuffer),B.bufferData(B.ARRAY_BUFFER,qt,E))}if(ai&&gi&&D){for(G=0,N=fi.length;N>G;G++)if(V=fi[G],W=gi[V],void 0!==W)for(vt=0;3>vt;vt++)wt=W[vt],Wt[Ft]=wt.x,Wt[Ft+1]=wt.y,Ft+=2;for(G=0,N=pi.length;N>G;G++)if(V=pi[G],W=gi[V],void 0!==W)for(vt=0;4>vt;vt++)wt=W[vt],Wt[Ft]=wt.x,Wt[Ft+1]=wt.y,Ft+=2;Ft>0&&(B.bindBuffer(B.ARRAY_BUFFER,T.__webglUV2Buffer),B.bufferData(B.ARRAY_BUFFER,Wt,E))}if(oi){for(G=0,N=fi.length;N>G;G++)ii[Gt]=Rt,ii[Gt+1]=Rt+1,ii[Gt+2]=Rt+2,Gt+=3,ni[Ot]=Rt,ni[Ot+1]=Rt+1,ni[Ot+2]=Rt,ni[Ot+3]=Rt+2,ni[Ot+4]=Rt+1,ni[Ot+5]=Rt+2,Ot+=6,Rt+=3;for(G=0,N=pi.length;N>G;G++)ii[Gt]=Rt,ii[Gt+1]=Rt+1,ii[Gt+2]=Rt+3,ii[Gt+3]=Rt+1,ii[Gt+4]=Rt+2,ii[Gt+5]=Rt+3,Gt+=6,ni[Ot]=Rt,ni[Ot+1]=Rt+1,ni[Ot+2]=Rt,ni[Ot+3]=Rt+3,ni[Ot+4]=Rt+1,ni[Ot+5]=Rt+2,ni[Ot+6]=Rt+2,ni[Ot+7]=Rt+3,Ot+=8,Rt+=4;B.bindBuffer(B.ELEMENT_ARRAY_BUFFER,T.__webglFaceBuffer),B.bufferData(B.ELEMENT_ARRAY_BUFFER,ii,E),B.bindBuffer(B.ELEMENT_ARRAY_BUFFER,T.__webglLineBuffer),B.bufferData(B.ELEMENT_ARRAY_BUFFER,ni,E)}if(ei)for(vt=0,yt=ei.length;yt>vt;vt++)if(ti=ei[vt],ti.__original.needsUpdate){if(zt=0,1===ti.size){if(void 0===ti.boundTo||"vertices"===ti.boundTo){for(G=0,N=fi.length;N>G;G++)O=di[fi[G]],ti.array[zt]=ti.value[O.a],ti.array[zt+1]=ti.value[O.b],ti.array[zt+2]=ti.value[O.c],zt+=3;for(G=0,N=pi.length;N>G;G++)O=di[pi[G]],ti.array[zt]=ti.value[O.a],ti.array[zt+1]=ti.value[O.b],ti.array[zt+2]=ti.value[O.c],ti.array[zt+3]=ti.value[O.d],zt+=4}else if("faces"===ti.boundTo){for(G=0,N=fi.length;N>G;G++)Bt=ti.value[fi[G]],ti.array[zt]=Bt,ti.array[zt+1]=Bt,ti.array[zt+2]=Bt,zt+=3;for(G=0,N=pi.length;N>G;G++)Bt=ti.value[pi[G]],ti.array[zt]=Bt,ti.array[zt+1]=Bt,ti.array[zt+2]=Bt,ti.array[zt+3]=Bt,zt+=4}}else if(2===ti.size){if(void 0===ti.boundTo||"vertices"===ti.boundTo){for(G=0,N=fi.length;N>G;G++)O=di[fi[G]],X=ti.value[O.a],Y=ti.value[O.b],K=ti.value[O.c],ti.array[zt]=X.x,ti.array[zt+1]=X.y,ti.array[zt+2]=Y.x,ti.array[zt+3]=Y.y,ti.array[zt+4]=K.x,ti.array[zt+5]=K.y,zt+=6;for(G=0,N=pi.length;N>G;G++)O=di[pi[G]],X=ti.value[O.a],Y=ti.value[O.b],K=ti.value[O.c],$=ti.value[O.d],ti.array[zt]=X.x,ti.array[zt+1]=X.y,ti.array[zt+2]=Y.x,ti.array[zt+3]=Y.y,ti.array[zt+4]=K.x,ti.array[zt+5]=K.y,ti.array[zt+6]=$.x,ti.array[zt+7]=$.y,zt+=8}else if("faces"===ti.boundTo){for(G=0,N=fi.length;N>G;G++)K=Y=X=Bt=ti.value[fi[G]],ti.array[zt]=X.x,ti.array[zt+1]=X.y,ti.array[zt+2]=Y.x,ti.array[zt+3]=Y.y,ti.array[zt+4]=K.x,ti.array[zt+5]=K.y,zt+=6;for(G=0,N=pi.length;N>G;G++)$=K=Y=X=Bt=ti.value[pi[G]],ti.array[zt]=X.x,ti.array[zt+1]=X.y,ti.array[zt+2]=Y.x,ti.array[zt+3]=Y.y,ti.array[zt+4]=K.x,ti.array[zt+5]=K.y,ti.array[zt+6]=$.x,ti.array[zt+7]=$.y,zt+=8}}else if(3===ti.size){var wi;if(wi="c"===ti.type?["r","g","b"]:["x","y","z"],void 0===ti.boundTo||"vertices"===ti.boundTo){for(G=0,N=fi.length;N>G;G++)O=di[fi[G]],X=ti.value[O.a],Y=ti.value[O.b],K=ti.value[O.c],ti.array[zt]=X[wi[0]],ti.array[zt+1]=X[wi[1]],ti.array[zt+2]=X[wi[2]],ti.array[zt+3]=Y[wi[0]],ti.array[zt+4]=Y[wi[1]],ti.array[zt+5]=Y[wi[2]],ti.array[zt+6]=K[wi[0]],ti.array[zt+7]=K[wi[1]],ti.array[zt+8]=K[wi[2]],zt+=9;for(G=0,N=pi.length;N>G;G++)O=di[pi[G]],X=ti.value[O.a],Y=ti.value[O.b],K=ti.value[O.c],$=ti.value[O.d],ti.array[zt]=X[wi[0]],ti.array[zt+1]=X[wi[1]],ti.array[zt+2]=X[wi[2]],ti.array[zt+3]=Y[wi[0]],ti.array[zt+4]=Y[wi[1]],ti.array[zt+5]=Y[wi[2]],ti.array[zt+6]=K[wi[0]],ti.array[zt+7]=K[wi[1]],ti.array[zt+8]=K[wi[2]],ti.array[zt+9]=$[wi[0]],ti.array[zt+10]=$[wi[1]],ti.array[zt+11]=$[wi[2]],zt+=12}else if("faces"===ti.boundTo){for(G=0,N=fi.length;N>G;G++)K=Y=X=Bt=ti.value[fi[G]],ti.array[zt]=X[wi[0]],ti.array[zt+1]=X[wi[1]],ti.array[zt+2]=X[wi[2]],ti.array[zt+3]=Y[wi[0]],ti.array[zt+4]=Y[wi[1]],ti.array[zt+5]=Y[wi[2]],ti.array[zt+6]=K[wi[0]],ti.array[zt+7]=K[wi[1]],ti.array[zt+8]=K[wi[2]],zt+=9;for(G=0,N=pi.length;N>G;G++)$=K=Y=X=Bt=ti.value[pi[G]],ti.array[zt]=X[wi[0]],ti.array[zt+1]=X[wi[1]],ti.array[zt+2]=X[wi[2]],ti.array[zt+3]=Y[wi[0]],ti.array[zt+4]=Y[wi[1]],ti.array[zt+5]=Y[wi[2]],ti.array[zt+6]=K[wi[0]],ti.array[zt+7]=K[wi[1]],ti.array[zt+8]=K[wi[2]],ti.array[zt+9]=$[wi[0]],ti.array[zt+10]=$[wi[1]],ti.array[zt+11]=$[wi[2]],zt+=12}else if("faceVertices"===ti.boundTo){for(G=0,N=fi.length;N>G;G++)Bt=ti.value[fi[G]],X=Bt[0],Y=Bt[1],K=Bt[2],ti.array[zt]=X[wi[0]],ti.array[zt+1]=X[wi[1]],ti.array[zt+2]=X[wi[2]],ti.array[zt+3]=Y[wi[0]],ti.array[zt+4]=Y[wi[1]],ti.array[zt+5]=Y[wi[2]],ti.array[zt+6]=K[wi[0]],ti.array[zt+7]=K[wi[1]],ti.array[zt+8]=K[wi[2]],zt+=9;for(G=0,N=pi.length;N>G;G++)Bt=ti.value[pi[G]],X=Bt[0],Y=Bt[1],K=Bt[2],$=Bt[3],ti.array[zt]=X[wi[0]],ti.array[zt+1]=X[wi[1]],ti.array[zt+2]=X[wi[2]],ti.array[zt+3]=Y[wi[0]],ti.array[zt+4]=Y[wi[1]],ti.array[zt+5]=Y[wi[2]],ti.array[zt+6]=K[wi[0]],ti.array[zt+7]=K[wi[1]],ti.array[zt+8]=K[wi[2]],ti.array[zt+9]=$[wi[0]],ti.array[zt+10]=$[wi[1]],ti.array[zt+11]=$[wi[2]],zt+=12}}else if(4===ti.size)if(void 0===ti.boundTo||"vertices"===ti.boundTo){for(G=0,N=fi.length;N>G;G++)O=di[fi[G]],X=ti.value[O.a],Y=ti.value[O.b],K=ti.value[O.c],ti.array[zt]=X.x,ti.array[zt+1]=X.y,ti.array[zt+2]=X.z,ti.array[zt+3]=X.w,ti.array[zt+4]=Y.x,ti.array[zt+5]=Y.y,ti.array[zt+6]=Y.z,ti.array[zt+7]=Y.w,ti.array[zt+8]=K.x,ti.array[zt+9]=K.y,ti.array[zt+10]=K.z,ti.array[zt+11]=K.w,zt+=12;for(G=0,N=pi.length;N>G;G++)O=di[pi[G]],X=ti.value[O.a],Y=ti.value[O.b],K=ti.value[O.c],$=ti.value[O.d],ti.array[zt]=X.x,ti.array[zt+1]=X.y,ti.array[zt+2]=X.z,ti.array[zt+3]=X.w,ti.array[zt+4]=Y.x,ti.array[zt+5]=Y.y,ti.array[zt+6]=Y.z,ti.array[zt+7]=Y.w,ti.array[zt+8]=K.x,ti.array[zt+9]=K.y,ti.array[zt+10]=K.z,ti.array[zt+11]=K.w,ti.array[zt+12]=$.x,ti.array[zt+13]=$.y,ti.array[zt+14]=$.z,ti.array[zt+15]=$.w,zt+=16}else if("faces"===ti.boundTo){for(G=0,N=fi.length;N>G;G++)K=Y=X=Bt=ti.value[fi[G]],ti.array[zt]=X.x,ti.array[zt+1]=X.y,ti.array[zt+2]=X.z,ti.array[zt+3]=X.w,ti.array[zt+4]=Y.x,ti.array[zt+5]=Y.y,ti.array[zt+6]=Y.z,ti.array[zt+7]=Y.w,ti.array[zt+8]=K.x,ti.array[zt+9]=K.y,ti.array[zt+10]=K.z,ti.array[zt+11]=K.w,zt+=12;for(G=0,N=pi.length;N>G;G++)$=K=Y=X=Bt=ti.value[pi[G]],ti.array[zt]=X.x,ti.array[zt+1]=X.y,ti.array[zt+2]=X.z,ti.array[zt+3]=X.w,ti.array[zt+4]=Y.x,ti.array[zt+5]=Y.y,ti.array[zt+6]=Y.z,ti.array[zt+7]=Y.w,ti.array[zt+8]=K.x,ti.array[zt+9]=K.y,ti.array[zt+10]=K.z,ti.array[zt+11]=K.w,ti.array[zt+12]=$.x,ti.array[zt+13]=$.y,ti.array[zt+14]=$.z,ti.array[zt+15]=$.w,zt+=16}else if("faceVertices"===ti.boundTo){for(G=0,N=fi.length;N>G;G++)Bt=ti.value[fi[G]],X=Bt[0],Y=Bt[1],K=Bt[2],ti.array[zt]=X.x,ti.array[zt+1]=X.y,ti.array[zt+2]=X.z,ti.array[zt+3]=X.w,ti.array[zt+4]=Y.x,ti.array[zt+5]=Y.y,ti.array[zt+6]=Y.z,ti.array[zt+7]=Y.w,ti.array[zt+8]=K.x,ti.array[zt+9]=K.y,ti.array[zt+10]=K.z,ti.array[zt+11]=K.w,zt+=12;for(G=0,N=pi.length;N>G;G++)Bt=ti.value[pi[G]],X=Bt[0],Y=Bt[1],K=Bt[2],$=Bt[3],ti.array[zt]=X.x,ti.array[zt+1]=X.y,ti.array[zt+2]=X.z,ti.array[zt+3]=X.w,ti.array[zt+4]=Y.x,ti.array[zt+5]=Y.y,ti.array[zt+6]=Y.z,ti.array[zt+7]=Y.w,ti.array[zt+8]=K.x,ti.array[zt+9]=K.y,ti.array[zt+10]=K.z,ti.array[zt+11]=K.w,ti.array[zt+12]=$.x,ti.array[zt+13]=$.y,ti.array[zt+14]=$.z,ti.array[zt+15]=$.w,zt+=16}B.bindBuffer(B.ARRAY_BUFFER,ti.buffer),B.bufferData(B.ARRAY_BUFFER,ti.array,E)}P&&(delete T.__inittedArrays,delete T.__colorArray,delete T.__normalArray,delete T.__tangentArray,delete T.__uvArray,delete T.__uv2Array,delete T.__faceArray,delete T.__vertexArray,delete T.__lineArray,delete T.__skinIndexArray,delete T.__skinWeightArray)}}h.verticesNeedUpdate=!1,h.morphTargetsNeedUpdate=!1,h.elementsNeedUpdate=!1,h.uvsNeedUpdate=!1,h.normalsNeedUpdate=!1,h.colorsNeedUpdate=!1,h.tangentsNeedUpdate=!1,h.buffersNeedUpdate=!1,d.attributes&&y(d)}else if(c instanceof e.Ribbon){if(d=o(c,h),p=d.attributes&&v(d),h.verticesNeedUpdate||h.colorsNeedUpdate||h.normalsNeedUpdate||p){var _i=h,Si=B.DYNAMIC_DRAW,Mi=void 0,Ci=void 0,Ti=void 0,Ai=void 0,Ei=void 0,Pi=void 0,ki=void 0,Ri=void 0,Li=void 0,Di=void 0,Fi=void 0,Gi=void 0,Ni=void 0,Vi=_i.vertices,Oi=_i.colors,ji=_i.normals,Ii=Vi.length,Ui=Oi.length,zi=ji.length,Bi=_i.__vertexArray,Hi=_i.__colorArray,qi=_i.__normalArray,Wi=_i.colorsNeedUpdate,Xi=_i.normalsNeedUpdate,Yi=_i.__webglCustomAttributesList;if(_i.verticesNeedUpdate){for(Mi=0;Ii>Mi;Mi++)Ai=Vi[Mi],Ei=3*Mi,Bi[Ei]=Ai.x,Bi[Ei+1]=Ai.y,Bi[Ei+2]=Ai.z;B.bindBuffer(B.ARRAY_BUFFER,_i.__webglVertexBuffer),B.bufferData(B.ARRAY_BUFFER,Bi,Si)}if(Wi){for(Ci=0;Ui>Ci;Ci++)Pi=Oi[Ci],Ei=3*Ci,Hi[Ei]=Pi.r,Hi[Ei+1]=Pi.g,Hi[Ei+2]=Pi.b;B.bindBuffer(B.ARRAY_BUFFER,_i.__webglColorBuffer),B.bufferData(B.ARRAY_BUFFER,Hi,Si)}if(Xi){for(Ti=0;zi>Ti;Ti++)ki=ji[Ti],Ei=3*Ti,qi[Ei]=ki.x,qi[Ei+1]=ki.y,qi[Ei+2]=ki.z;B.bindBuffer(B.ARRAY_BUFFER,_i.__webglNormalBuffer),B.bufferData(B.ARRAY_BUFFER,qi,Si)}if(Yi)for(Ri=0,Li=Yi.length;Li>Ri;Ri++)if(Gi=Yi[Ri],Gi.needsUpdate&&(void 0===Gi.boundTo||"vertices"===Gi.boundTo)){if(Ei=0,Fi=Gi.value.length,1===Gi.size)for(Di=0;Fi>Di;Di++)Gi.array[Di]=Gi.value[Di];else if(2===Gi.size)for(Di=0;Fi>Di;Di++)Ni=Gi.value[Di],Gi.array[Ei]=Ni.x,Gi.array[Ei+1]=Ni.y,Ei+=2;else if(3===Gi.size)if("c"===Gi.type)for(Di=0;Fi>Di;Di++)Ni=Gi.value[Di],Gi.array[Ei]=Ni.r,Gi.array[Ei+1]=Ni.g,Gi.array[Ei+2]=Ni.b,Ei+=3;else for(Di=0;Fi>Di;Di++)Ni=Gi.value[Di],Gi.array[Ei]=Ni.x,Gi.array[Ei+1]=Ni.y,Gi.array[Ei+2]=Ni.z,Ei+=3;else if(4===Gi.size)for(Di=0;Fi>Di;Di++)Ni=Gi.value[Di],Gi.array[Ei]=Ni.x,Gi.array[Ei+1]=Ni.y,Gi.array[Ei+2]=Ni.z,Gi.array[Ei+3]=Ni.w,Ei+=4;B.bindBuffer(B.ARRAY_BUFFER,Gi.buffer),B.bufferData(B.ARRAY_BUFFER,Gi.array,Si)}}h.verticesNeedUpdate=!1,h.colorsNeedUpdate=!1,h.normalsNeedUpdate=!1,d.attributes&&y(d)}else if(c instanceof e.Line){if(d=o(c,h),p=d.attributes&&v(d),h.verticesNeedUpdate||h.colorsNeedUpdate||h.lineDistancesNeedUpdate||p){var Ki=h,$i=B.DYNAMIC_DRAW,Qi=void 0,Zi=void 0,Ji=void 0,en=void 0,tn=void 0,nn=void 0,rn=Ki.vertices,on=Ki.colors,an=Ki.lineDistances,sn=rn.length,ln=on.length,cn=an.length,hn=Ki.__vertexArray,un=Ki.__colorArray,fn=Ki.__lineDistanceArray,pn=Ki.colorsNeedUpdate,dn=Ki.lineDistancesNeedUpdate,mn=Ki.__webglCustomAttributesList,gn=void 0,vn=void 0,yn=void 0,bn=void 0,xn=void 0,wn=void 0;if(Ki.verticesNeedUpdate){for(Qi=0;sn>Qi;Qi++)en=rn[Qi],tn=3*Qi,hn[tn]=en.x,hn[tn+1]=en.y,hn[tn+2]=en.z;B.bindBuffer(B.ARRAY_BUFFER,Ki.__webglVertexBuffer),B.bufferData(B.ARRAY_BUFFER,hn,$i)}if(pn){for(Zi=0;ln>Zi;Zi++)nn=on[Zi],tn=3*Zi,un[tn]=nn.r,un[tn+1]=nn.g,un[tn+2]=nn.b;B.bindBuffer(B.ARRAY_BUFFER,Ki.__webglColorBuffer),B.bufferData(B.ARRAY_BUFFER,un,$i)}if(dn){for(Ji=0;cn>Ji;Ji++)fn[Ji]=an[Ji];B.bindBuffer(B.ARRAY_BUFFER,Ki.__webglLineDistanceBuffer),B.bufferData(B.ARRAY_BUFFER,fn,$i)}if(mn)for(gn=0,vn=mn.length;vn>gn;gn++)if(wn=mn[gn],wn.needsUpdate&&(void 0===wn.boundTo||"vertices"===wn.boundTo)){if(tn=0,bn=wn.value.length,1===wn.size)for(yn=0;bn>yn;yn++)wn.array[yn]=wn.value[yn];else if(2===wn.size)for(yn=0;bn>yn;yn++)xn=wn.value[yn],wn.array[tn]=xn.x,wn.array[tn+1]=xn.y,tn+=2;else if(3===wn.size)if("c"===wn.type)for(yn=0;bn>yn;yn++)xn=wn.value[yn],wn.array[tn]=xn.r,wn.array[tn+1]=xn.g,wn.array[tn+2]=xn.b,tn+=3;else for(yn=0;bn>yn;yn++)xn=wn.value[yn],wn.array[tn]=xn.x,wn.array[tn+1]=xn.y,wn.array[tn+2]=xn.z,tn+=3;else if(4===wn.size)for(yn=0;bn>yn;yn++)xn=wn.value[yn],wn.array[tn]=xn.x,wn.array[tn+1]=xn.y,wn.array[tn+2]=xn.z,wn.array[tn+3]=xn.w,tn+=4;B.bindBuffer(B.ARRAY_BUFFER,wn.buffer),B.bufferData(B.ARRAY_BUFFER,wn.array,$i)}}h.verticesNeedUpdate=!1,h.colorsNeedUpdate=!1,h.lineDistancesNeedUpdate=!1,d.attributes&&y(d)}else if(c instanceof e.ParticleSystem){if(d=o(c,h),p=d.attributes&&v(d),h.verticesNeedUpdate||h.colorsNeedUpdate||c.sortParticles||p){var _n=h,Sn=B.DYNAMIC_DRAW,Mn=c,Cn=void 0,Tn=void 0,An=void 0,En=void 0,Pn=void 0,kn=void 0,Rn=_n.vertices,Ln=Rn.length,Dn=_n.colors,Fn=Dn.length,Gn=_n.__vertexArray,Nn=_n.__colorArray,Vn=_n.__sortArray,On=_n.verticesNeedUpdate,jn=_n.colorsNeedUpdate,In=_n.__webglCustomAttributesList,Un=void 0,zn=void 0,Bn=void 0,Hn=void 0,qn=void 0,Wn=void 0;if(Mn.sortParticles){for(Ct.copy(Mt),Ct.multiply(Mn.matrixWorld),Cn=0;Ln>Cn;Cn++)An=Rn[Cn],Tt.copy(An),Tt.applyProjection(Ct),Vn[Cn]=[Tt.z,Cn];for(Vn.sort(u),Cn=0;Ln>Cn;Cn++)An=Rn[Vn[Cn][1]],En=3*Cn,Gn[En]=An.x,Gn[En+1]=An.y,Gn[En+2]=An.z;for(Tn=0;Fn>Tn;Tn++)En=3*Tn,kn=Dn[Vn[Tn][1]],Nn[En]=kn.r,Nn[En+1]=kn.g,Nn[En+2]=kn.b;if(In)for(Un=0,zn=In.length;zn>Un;Un++)if(Wn=In[Un],void 0===Wn.boundTo||"vertices"===Wn.boundTo)if(En=0,Hn=Wn.value.length,1===Wn.size)for(Bn=0;Hn>Bn;Bn++)Pn=Vn[Bn][1],Wn.array[Bn]=Wn.value[Pn];else if(2===Wn.size)for(Bn=0;Hn>Bn;Bn++)Pn=Vn[Bn][1],qn=Wn.value[Pn],Wn.array[En]=qn.x,Wn.array[En+1]=qn.y,En+=2;else if(3===Wn.size)if("c"===Wn.type)for(Bn=0;Hn>Bn;Bn++)Pn=Vn[Bn][1],qn=Wn.value[Pn],Wn.array[En]=qn.r,Wn.array[En+1]=qn.g,Wn.array[En+2]=qn.b,En+=3;else for(Bn=0;Hn>Bn;Bn++)Pn=Vn[Bn][1],qn=Wn.value[Pn],Wn.array[En]=qn.x,Wn.array[En+1]=qn.y,Wn.array[En+2]=qn.z,En+=3;else if(4===Wn.size)for(Bn=0;Hn>Bn;Bn++)Pn=Vn[Bn][1],qn=Wn.value[Pn],Wn.array[En]=qn.x,Wn.array[En+1]=qn.y,Wn.array[En+2]=qn.z,Wn.array[En+3]=qn.w,En+=4}else{if(On)for(Cn=0;Ln>Cn;Cn++)An=Rn[Cn],En=3*Cn,Gn[En]=An.x,Gn[En+1]=An.y,Gn[En+2]=An.z;if(jn)for(Tn=0;Fn>Tn;Tn++)kn=Dn[Tn],En=3*Tn,Nn[En]=kn.r,Nn[En+1]=kn.g,Nn[En+2]=kn.b;if(In)for(Un=0,zn=In.length;zn>Un;Un++)if(Wn=In[Un],Wn.needsUpdate&&(void 0===Wn.boundTo||"vertices"===Wn.boundTo))if(Hn=Wn.value.length,En=0,1===Wn.size)for(Bn=0;Hn>Bn;Bn++)Wn.array[Bn]=Wn.value[Bn];else if(2===Wn.size)for(Bn=0;Hn>Bn;Bn++)qn=Wn.value[Bn],Wn.array[En]=qn.x,Wn.array[En+1]=qn.y,En+=2;else if(3===Wn.size)if("c"===Wn.type)for(Bn=0;Hn>Bn;Bn++)qn=Wn.value[Bn],Wn.array[En]=qn.r,Wn.array[En+1]=qn.g,Wn.array[En+2]=qn.b,En+=3;else for(Bn=0;Hn>Bn;Bn++)qn=Wn.value[Bn],Wn.array[En]=qn.x,Wn.array[En+1]=qn.y,Wn.array[En+2]=qn.z,En+=3;else if(4===Wn.size)for(Bn=0;Hn>Bn;Bn++)qn=Wn.value[Bn],Wn.array[En]=qn.x,Wn.array[En+1]=qn.y,Wn.array[En+2]=qn.z,Wn.array[En+3]=qn.w,En+=4}if((On||Mn.sortParticles)&&(B.bindBuffer(B.ARRAY_BUFFER,_n.__webglVertexBuffer),B.bufferData(B.ARRAY_BUFFER,Gn,Sn)),(jn||Mn.sortParticles)&&(B.bindBuffer(B.ARRAY_BUFFER,_n.__webglColorBuffer),B.bufferData(B.ARRAY_BUFFER,Nn,Sn)),In)for(Un=0,zn=In.length;zn>Un;Un++)Wn=In[Un],(Wn.needsUpdate||Mn.sortParticles)&&(B.bindBuffer(B.ARRAY_BUFFER,Wn.buffer),B.bufferData(B.ARRAY_BUFFER,Wn.array,Sn))}h.verticesNeedUpdate=!1,h.colorsNeedUpdate=!1,d.attributes&&y(d)}}},this.initMaterial=function(t,i,n,r){var o,a,s,l;t.addEventListener("dispose",Wt);var c,h,u,f,p;if(t instanceof e.MeshDepthMaterial?p="depth":t instanceof e.MeshNormalMaterial?p="normal":t instanceof e.MeshBasicMaterial?p="basic":t instanceof e.MeshLambertMaterial?p="lambert":t instanceof e.MeshPhongMaterial?p="phong":t instanceof e.LineBasicMaterial?p="basic":t instanceof e.LineDashedMaterial?p="dashed":t instanceof e.ParticleBasicMaterial&&(p="particle_basic"),p){var d=e.ShaderLib[p];t.uniforms=e.UniformsUtils.clone(d.uniforms),t.vertexShader=d.vertexShader,t.fragmentShader=d.fragmentShader}var m,g,v;for(o=s=g=v=d=0,a=i.length;a>o;o++)m=i[o],m.onlyShadow||(m instanceof e.DirectionalLight&&s++,m instanceof e.PointLight&&g++,m instanceof e.SpotLight&&v++,m instanceof e.HemisphereLight&&d++);for(o=s,a=g,s=v,l=d,d=m=0,v=i.length;v>d;d++)g=i[d],g.castShadow&&(g instanceof e.SpotLight&&m++,g instanceof e.DirectionalLight&&!g.shadowCascade&&m++);f=m,Nt&&r&&r.useVertexTexture?u=1024:(i=B.getParameter(B.MAX_VERTEX_UNIFORM_VECTORS),i=Math.floor((i-20)/4),void 0!==r&&r instanceof e.SkinnedMesh&&(i=Math.min(r.bones.length,i),i<r.bones.length&&console.warn("WebGLRenderer: too many bones - "+r.bones.length+", this GPU supports just "+i+" (try OpenGL instead of ANGLE)")),u=i);e:{v=t.fragmentShader,g=t.vertexShader,d=t.uniforms,i=t.attributes,m=t.defines;var y,b,x,n={map:!!t.map,envMap:!!t.envMap,lightMap:!!t.lightMap,bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,specularMap:!!t.specularMap,vertexColors:t.vertexColors,fog:n,useFog:t.fog,fogExp:n instanceof e.FogExp2,sizeAttenuation:t.sizeAttenuation,skinning:t.skinning,maxBones:u,useVertexTexture:Nt&&r&&r.useVertexTexture,boneTextureWidth:r&&r.boneTextureWidth,boneTextureHeight:r&&r.boneTextureHeight,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:o,maxPointLights:a,maxSpotLights:s,maxHemiLights:l,maxShadows:f,shadowMapEnabled:this.shadowMapEnabled&&r.receiveShadow,shadowMapType:this.shadowMapType,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:t.alphaTest,metal:t.metal,perPixel:t.perPixel,wrapAround:t.wrapAround,doubleSided:t.side===e.DoubleSide,flipSided:t.side===e.BackSide},r=[];p?r.push(p):(r.push(v),r.push(g));for(b in m)r.push(b),r.push(m[b]);for(y in n)r.push(y),r.push(n[y]);for(p=r.join(),y=0,b=K.length;b>y;y++)if(r=K[y],r.code===p){r.usedTimes++,h=r.program;break e}y="SHADOWMAP_TYPE_BASIC",n.shadowMapType===e.PCFShadowMap?y="SHADOWMAP_TYPE_PCF":n.shadowMapType===e.PCFSoftShadowMap&&(y="SHADOWMAP_TYPE_PCF_SOFT"),b=[];for(x in m)r=m[x],!1!==r&&(r="#define "+x+" "+r,b.push(r));r=b.join("\n"),x=B.createProgram(),b=["precision "+G+" float;",r,Gt?"#define VERTEX_TEXTURES":"",Y.gammaInput?"#define GAMMA_INPUT":"",Y.gammaOutput?"#define GAMMA_OUTPUT":"",Y.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+n.maxDirLights,"#define MAX_POINT_LIGHTS "+n.maxPointLights,"#define MAX_SPOT_LIGHTS "+n.maxSpotLights,"#define MAX_HEMI_LIGHTS "+n.maxHemiLights,"#define MAX_SHADOWS "+n.maxShadows,"#define MAX_BONES "+n.maxBones,n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.lightMap?"#define USE_LIGHTMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.vertexColors?"#define USE_COLOR":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.boneTextureWidth?"#define N_BONE_PIXEL_X "+n.boneTextureWidth.toFixed(1):"",n.boneTextureHeight?"#define N_BONE_PIXEL_Y "+n.boneTextureHeight.toFixed(1):"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals?"#define USE_MORPHNORMALS":"",n.perPixel?"#define PHONG_PER_PIXEL":"",n.wrapAround?"#define WRAP_AROUND":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+y:"",n.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",n.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\n#ifdef USE_MORPHNORMALS\nattribute vec3 morphNormal0;\nattribute vec3 morphNormal1;\nattribute vec3 morphNormal2;\nattribute vec3 morphNormal3;\n#else\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n"),y=["precision "+G+" float;",n.bumpMap||n.normalMap?"#extension GL_OES_standard_derivatives : enable":"",r,"#define MAX_DIR_LIGHTS "+n.maxDirLights,"#define MAX_POINT_LIGHTS "+n.maxPointLights,"#define MAX_SPOT_LIGHTS "+n.maxSpotLights,"#define MAX_HEMI_LIGHTS "+n.maxHemiLights,"#define MAX_SHADOWS "+n.maxShadows,n.alphaTest?"#define ALPHATEST "+n.alphaTest:"",Y.gammaInput?"#define GAMMA_INPUT":"",Y.gammaOutput?"#define GAMMA_OUTPUT":"",Y.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.lightMap?"#define USE_LIGHTMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.vertexColors?"#define USE_COLOR":"",n.metal?"#define METAL":"",n.perPixel?"#define PHONG_PER_PIXEL":"",n.wrapAround?"#define WRAP_AROUND":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+y:"",n.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",n.shadowMapCascade?"#define SHADOWMAP_CASCADE":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n"),b=P("vertex",b+g),y=P("fragment",y+v),B.attachShader(x,b),B.attachShader(x,y),B.linkProgram(x),B.getProgramParameter(x,B.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+B.getProgramParameter(x,B.VALIDATE_STATUS)+", gl error ["+B.getError()+"]"),B.deleteShader(y),B.deleteShader(b),x.uniforms={},x.attributes={};var w;y="viewMatrix modelViewMatrix projectionMatrix normalMatrix modelMatrix cameraPosition morphTargetInfluences".split(" "),y.push(n.useVertexTexture?"boneTexture":"boneGlobalMatrices");for(w in d)y.push(w);for(w=y,y=0,b=w.length;b>y;y++)d=w[y],x.uniforms[d]=B.getUniformLocation(x,d);for(y="position normal uv uv2 tangent color skinIndex skinWeight lineDistance".split(" "),w=0;w<n.maxMorphTargets;w++)y.push("morphTarget"+w);
for(w=0;w<n.maxMorphNormals;w++)y.push("morphNormal"+w);for(h in i)y.push(h);for(h=y,w=0,i=h.length;i>w;w++)y=h[w],x.attributes[y]=B.getAttribLocation(x,y);x.id=$++,K.push({program:x,code:p,usedTimes:1}),Y.info.memory.programs=K.length,h=x}if(t.program=h,w=t.program.attributes,t.morphTargets)for(t.numSupportedMorphTargets=0,i="morphTarget",h=0;h<this.maxMorphTargets;h++)x=i+h,0<=w[x]&&t.numSupportedMorphTargets++;if(t.morphNormals)for(t.numSupportedMorphNormals=0,i="morphNormal",h=0;h<this.maxMorphNormals;h++)x=i+h,0<=w[x]&&t.numSupportedMorphNormals++;t.uniformsList=[];for(c in t.uniforms)t.uniformsList.push([t.uniforms[c],c])},this.setFaceCulling=function(t,i){t===e.CullFaceNone?B.disable(B.CULL_FACE):(B.frontFace(i===e.FrontFaceDirectionCW?B.CW:B.CCW),B.cullFace(t===e.CullFaceBack?B.BACK:t===e.CullFaceFront?B.FRONT:B.FRONT_AND_BACK),B.enable(B.CULL_FACE))},this.setMaterialFaces=function(t){var i=t.side===e.DoubleSide,t=t.side===e.BackSide;rt!==i&&(i?B.disable(B.CULL_FACE):B.enable(B.CULL_FACE),rt=i),ot!==t&&(B.frontFace(t?B.CW:B.CCW),ot=t)},this.setDepthTest=function(e){ht!==e&&(e?B.enable(B.DEPTH_TEST):B.disable(B.DEPTH_TEST),ht=e)},this.setDepthWrite=function(e){ut!==e&&(B.depthMask(e),ut=e)},this.setBlending=function(t,i,n,r){t!==at&&(t===e.NoBlending?B.disable(B.BLEND):t===e.AdditiveBlending?(B.enable(B.BLEND),B.blendEquation(B.FUNC_ADD),B.blendFunc(B.SRC_ALPHA,B.ONE)):t===e.SubtractiveBlending?(B.enable(B.BLEND),B.blendEquation(B.FUNC_ADD),B.blendFunc(B.ZERO,B.ONE_MINUS_SRC_COLOR)):t===e.MultiplyBlending?(B.enable(B.BLEND),B.blendEquation(B.FUNC_ADD),B.blendFunc(B.ZERO,B.SRC_COLOR)):t===e.CustomBlending?B.enable(B.BLEND):(B.enable(B.BLEND),B.blendEquationSeparate(B.FUNC_ADD,B.FUNC_ADD),B.blendFuncSeparate(B.SRC_ALPHA,B.ONE_MINUS_SRC_ALPHA,B.ONE,B.ONE_MINUS_SRC_ALPHA)),at=t),t===e.CustomBlending?(i!==st&&(B.blendEquation(D(i)),st=i),(n!==lt||r!==ct)&&(B.blendFunc(D(n),D(r)),lt=n,ct=r)):ct=lt=st=null},this.setTexture=function(t,i){if(t.needsUpdate){t.__webglInit||(t.__webglInit=!0,t.addEventListener("dispose",Ht),t.__webglTexture=B.createTexture(),Y.info.memory.textures++),B.activeTexture(B.TEXTURE0+i),B.bindTexture(B.TEXTURE_2D,t.__webglTexture),B.pixelStorei(B.UNPACK_FLIP_Y_WEBGL,t.flipY),B.pixelStorei(B.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),B.pixelStorei(B.UNPACK_ALIGNMENT,t.unpackAlignment);var n=t.image,r=0===(n.width&n.width-1)&&0===(n.height&n.height-1),o=D(t.format),a=D(t.type);k(B.TEXTURE_2D,t,r);var s=t.mipmaps;if(t instanceof e.DataTexture)if(0<s.length&&r){for(var l=0,c=s.length;c>l;l++)n=s[l],B.texImage2D(B.TEXTURE_2D,l,o,n.width,n.height,0,o,a,n.data);t.generateMipmaps=!1}else B.texImage2D(B.TEXTURE_2D,0,o,n.width,n.height,0,o,a,n.data);else if(t instanceof e.CompressedTexture)for(l=0,c=s.length;c>l;l++)n=s[l],B.compressedTexImage2D(B.TEXTURE_2D,l,o,n.width,n.height,0,n.data);else if(0<s.length&&r){for(l=0,c=s.length;c>l;l++)n=s[l],B.texImage2D(B.TEXTURE_2D,l,o,o,a,n);t.generateMipmaps=!1}else B.texImage2D(B.TEXTURE_2D,0,o,o,a,t.image);t.generateMipmaps&&r&&B.generateMipmap(B.TEXTURE_2D),t.needsUpdate=!1,t.onUpdate&&t.onUpdate()}else B.activeTexture(B.TEXTURE0+i),B.bindTexture(B.TEXTURE_2D,t.__webglTexture)},this.setRenderTarget=function(t){var i=t instanceof e.WebGLRenderTargetCube;if(t&&!t.__webglFramebuffer){void 0===t.depthBuffer&&(t.depthBuffer=!0),void 0===t.stencilBuffer&&(t.stencilBuffer=!0),t.addEventListener("dispose",qt),t.__webglTexture=B.createTexture(),Y.info.memory.textures++;var n=0===(t.width&t.width-1)&&0===(t.height&t.height-1),r=D(t.format),o=D(t.type);if(i){t.__webglFramebuffer=[],t.__webglRenderbuffer=[],B.bindTexture(B.TEXTURE_CUBE_MAP,t.__webglTexture),k(B.TEXTURE_CUBE_MAP,t,n);for(var a=0;6>a;a++){t.__webglFramebuffer[a]=B.createFramebuffer(),t.__webglRenderbuffer[a]=B.createRenderbuffer(),B.texImage2D(B.TEXTURE_CUBE_MAP_POSITIVE_X+a,0,r,t.width,t.height,0,r,o,null);var s=t,l=B.TEXTURE_CUBE_MAP_POSITIVE_X+a;B.bindFramebuffer(B.FRAMEBUFFER,t.__webglFramebuffer[a]),B.framebufferTexture2D(B.FRAMEBUFFER,B.COLOR_ATTACHMENT0,l,s.__webglTexture,0),R(t.__webglRenderbuffer[a],t)}n&&B.generateMipmap(B.TEXTURE_CUBE_MAP)}else t.__webglFramebuffer=B.createFramebuffer(),t.__webglRenderbuffer=t.shareDepthFrom?t.shareDepthFrom.__webglRenderbuffer:B.createRenderbuffer(),B.bindTexture(B.TEXTURE_2D,t.__webglTexture),k(B.TEXTURE_2D,t,n),B.texImage2D(B.TEXTURE_2D,0,r,t.width,t.height,0,r,o,null),r=B.TEXTURE_2D,B.bindFramebuffer(B.FRAMEBUFFER,t.__webglFramebuffer),B.framebufferTexture2D(B.FRAMEBUFFER,B.COLOR_ATTACHMENT0,r,t.__webglTexture,0),t.shareDepthFrom?t.depthBuffer&&!t.stencilBuffer?B.framebufferRenderbuffer(B.FRAMEBUFFER,B.DEPTH_ATTACHMENT,B.RENDERBUFFER,t.__webglRenderbuffer):t.depthBuffer&&t.stencilBuffer&&B.framebufferRenderbuffer(B.FRAMEBUFFER,B.DEPTH_STENCIL_ATTACHMENT,B.RENDERBUFFER,t.__webglRenderbuffer):R(t.__webglRenderbuffer,t),n&&B.generateMipmap(B.TEXTURE_2D);i?B.bindTexture(B.TEXTURE_CUBE_MAP,null):B.bindTexture(B.TEXTURE_2D,null),B.bindRenderbuffer(B.RENDERBUFFER,null),B.bindFramebuffer(B.FRAMEBUFFER,null)}t?(i=i?t.__webglFramebuffer[t.activeCubeFace]:t.__webglFramebuffer,n=t.width,t=t.height,o=r=0):(i=null,n=yt,t=bt,r=gt,o=vt),i!==Z&&(B.bindFramebuffer(B.FRAMEBUFFER,i),B.viewport(r,o,n,t),Z=i),xt=n,wt=t},this.shadowMapPlugin=new e.ShadowMapPlugin,this.addPrePlugin(this.shadowMapPlugin),this.addPostPlugin(new e.SpritePlugin),this.addPostPlugin(new e.LensFlarePlugin)},e.WebGLRenderTarget=function(t,i,n){this.width=t,this.height=i,n=n||{},this.wrapS=void 0!==n.wrapS?n.wrapS:e.ClampToEdgeWrapping,this.wrapT=void 0!==n.wrapT?n.wrapT:e.ClampToEdgeWrapping,this.magFilter=void 0!==n.magFilter?n.magFilter:e.LinearFilter,this.minFilter=void 0!==n.minFilter?n.minFilter:e.LinearMipMapLinearFilter,this.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,this.offset=new e.Vector2(0,0),this.repeat=new e.Vector2(1,1),this.format=void 0!==n.format?n.format:e.RGBAFormat,this.type=void 0!==n.type?n.type:e.UnsignedByteType,this.depthBuffer=void 0!==n.depthBuffer?n.depthBuffer:!0,this.stencilBuffer=void 0!==n.stencilBuffer?n.stencilBuffer:!0,this.generateMipmaps=!0,this.shareDepthFrom=null},e.WebGLRenderTarget.prototype={constructor:e.WebGLRenderTarget,addEventListener:e.EventDispatcher.prototype.addEventListener,hasEventListener:e.EventDispatcher.prototype.hasEventListener,removeEventListener:e.EventDispatcher.prototype.removeEventListener,dispatchEvent:e.EventDispatcher.prototype.dispatchEvent,clone:function(){var t=new e.WebGLRenderTarget(this.width,this.height);return t.wrapS=this.wrapS,t.wrapT=this.wrapT,t.magFilter=this.magFilter,t.minFilter=this.minFilter,t.anisotropy=this.anisotropy,t.offset.copy(this.offset),t.repeat.copy(this.repeat),t.format=this.format,t.type=this.type,t.depthBuffer=this.depthBuffer,t.stencilBuffer=this.stencilBuffer,t.generateMipmaps=this.generateMipmaps,t.shareDepthFrom=this.shareDepthFrom,t},dispose:function(){this.dispatchEvent({type:"dispose"})}},e.WebGLRenderTargetCube=function(t,i,n){e.WebGLRenderTarget.call(this,t,i,n),this.activeCubeFace=0},e.WebGLRenderTargetCube.prototype=Object.create(e.WebGLRenderTarget.prototype),e.RenderableVertex=function(){this.positionWorld=new e.Vector3,this.positionScreen=new e.Vector4,this.visible=!0},e.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},e.RenderableFace3=function(){this.v1=new e.RenderableVertex,this.v2=new e.RenderableVertex,this.v3=new e.RenderableVertex,this.centroidModel=new e.Vector3,this.normalModel=new e.Vector3,this.normalModelView=new e.Vector3,this.vertexNormalsLength=0,this.vertexNormalsModel=[new e.Vector3,new e.Vector3,new e.Vector3],this.vertexNormalsModelView=[new e.Vector3,new e.Vector3,new e.Vector3],this.material=this.color=null,this.uvs=[[]],this.z=null},e.RenderableFace4=function(){this.v1=new e.RenderableVertex,this.v2=new e.RenderableVertex,this.v3=new e.RenderableVertex,this.v4=new e.RenderableVertex,this.centroidModel=new e.Vector3,this.normalModel=new e.Vector3,this.normalModelView=new e.Vector3,this.vertexNormalsLength=0,this.vertexNormalsModel=[new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3],this.vertexNormalsModelView=[new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3],this.material=this.color=null,this.uvs=[[]],this.z=null},e.RenderableObject=function(){this.z=this.object=null},e.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=this.object=null,this.scale=new e.Vector2,this.material=null},e.RenderableLine=function(){this.z=null,this.v1=new e.RenderableVertex,this.v2=new e.RenderableVertex,this.vertexColors=[new e.Color,new e.Color],this.material=null},e.GeometryUtils={merge:function(t,i,n){var r,o,a=t.vertices.length,s=i instanceof e.Mesh?i.geometry:i,l=t.vertices,c=s.vertices,h=t.faces,u=s.faces,t=t.faceVertexUvs[0],s=s.faceVertexUvs[0];void 0===n&&(n=0),i instanceof e.Mesh&&(i.matrixAutoUpdate&&i.updateMatrix(),r=i.matrix,o=(new e.Matrix3).getNormalMatrix(r));for(var i=0,f=c.length;f>i;i++){var p=c[i].clone();r&&p.applyMatrix4(r),l.push(p)}for(i=0,f=u.length;f>i;i++){var d,m,p=u[i],g=p.vertexNormals,v=p.vertexColors;for(p instanceof e.Face3?d=new e.Face3(p.a+a,p.b+a,p.c+a):p instanceof e.Face4&&(d=new e.Face4(p.a+a,p.b+a,p.c+a,p.d+a)),d.normal.copy(p.normal),o&&d.normal.applyMatrix3(o).normalize(),l=0,c=g.length;c>l;l++)m=g[l].clone(),o&&m.applyMatrix3(o).normalize(),d.vertexNormals.push(m);for(d.color.copy(p.color),l=0,c=v.length;c>l;l++)m=v[l],d.vertexColors.push(m.clone());d.materialIndex=p.materialIndex+n,d.centroid.copy(p.centroid),r&&d.centroid.applyMatrix4(r),h.push(d)}for(i=0,f=s.length;f>i;i++){for(n=s[i],r=[],l=0,c=n.length;c>l;l++)r.push(new e.Vector2(n[l].x,n[l].y));t.push(r)}},removeMaterials:function(e,t){for(var i={},n=0,r=t.length;r>n;n++)i[t[n]]=!0;for(var o,a=[],n=0,r=e.faces.length;r>n;n++)o=e.faces[n],o.materialIndex in i||a.push(o);e.faces=a},randomPointInTriangle:function(t,i,n){var r,o,a,s=new e.Vector3,l=e.GeometryUtils.__v1;return r=e.GeometryUtils.random(),o=e.GeometryUtils.random(),r+o>1&&(r=1-r,o=1-o),a=1-r-o,s.copy(t),s.multiplyScalar(r),l.copy(i),l.multiplyScalar(o),s.add(l),l.copy(n),l.multiplyScalar(a),s.add(l),s},randomPointInFace:function(t,i,n){var r,o,a;if(t instanceof e.Face3)return r=i.vertices[t.a],o=i.vertices[t.b],a=i.vertices[t.c],e.GeometryUtils.randomPointInTriangle(r,o,a);if(t instanceof e.Face4){r=i.vertices[t.a],o=i.vertices[t.b],a=i.vertices[t.c];var s,i=i.vertices[t.d];return n?t._area1&&t._area2?(n=t._area1,s=t._area2):(n=e.GeometryUtils.triangleArea(r,o,i),s=e.GeometryUtils.triangleArea(o,a,i),t._area1=n,t._area2=s):(n=e.GeometryUtils.triangleArea(r,o,i),s=e.GeometryUtils.triangleArea(o,a,i)),e.GeometryUtils.random()*(n+s)<n?e.GeometryUtils.randomPointInTriangle(r,o,i):e.GeometryUtils.randomPointInTriangle(o,a,i)}},randomPointsInGeometry:function(t,i){function n(e){function t(i,n){if(i>n)return i;var r=i+Math.floor((n-i)/2);return d[r]>e?t(i,r-1):d[r]<e?t(r+1,n):r}return t(0,d.length-1)}var r,o,a,s,l,c,h=t.faces,u=t.vertices,f=h.length,p=0,d=[];for(o=0;f>o;o++)r=h[o],r instanceof e.Face3?(a=u[r.a],s=u[r.b],l=u[r.c],r._area=e.GeometryUtils.triangleArea(a,s,l)):r instanceof e.Face4&&(a=u[r.a],s=u[r.b],l=u[r.c],c=u[r.d],r._area1=e.GeometryUtils.triangleArea(a,s,c),r._area2=e.GeometryUtils.triangleArea(s,l,c),r._area=r._area1+r._area2),p+=r._area,d[o]=p;for(r=[],o=0;i>o;o++)u=e.GeometryUtils.random()*p,u=n(u),r[o]=e.GeometryUtils.randomPointInFace(h[u],t,!0);return r},triangleArea:function(t,i,n){var r=e.GeometryUtils.__v1,o=e.GeometryUtils.__v2;return r.subVectors(i,t),o.subVectors(n,t),r.cross(o),.5*r.length()},center:function(t){t.computeBoundingBox();var i=t.boundingBox,n=new e.Vector3;return n.addVectors(i.min,i.max),n.multiplyScalar(-.5),t.applyMatrix((new e.Matrix4).makeTranslation(n.x,n.y,n.z)),t.computeBoundingBox(),n},normalizeUVs:function(e){for(var e=e.faceVertexUvs[0],t=0,i=e.length;i>t;t++)for(var n=e[t],r=0,o=n.length;o>r;r++)1!==n[r].x&&(n[r].x-=Math.floor(n[r].x)),1!==n[r].y&&(n[r].y-=Math.floor(n[r].y))},triangulateQuads:function(t){var i,n,r,o,a=[],s=[],l=[];for(i=0,n=t.faceUvs.length;n>i;i++)s[i]=[];for(i=0,n=t.faceVertexUvs.length;n>i;i++)l[i]=[];for(i=0,n=t.faces.length;n>i;i++)if(r=t.faces[i],r instanceof e.Face4){o=r.a;var c=r.b,h=r.c,u=r.d,f=new e.Face3,p=new e.Face3;for(f.color.copy(r.color),p.color.copy(r.color),f.materialIndex=r.materialIndex,p.materialIndex=r.materialIndex,f.a=o,f.b=c,f.c=u,p.a=c,p.b=h,p.c=u,4===r.vertexColors.length&&(f.vertexColors[0]=r.vertexColors[0].clone(),f.vertexColors[1]=r.vertexColors[1].clone(),f.vertexColors[2]=r.vertexColors[3].clone(),p.vertexColors[0]=r.vertexColors[1].clone(),p.vertexColors[1]=r.vertexColors[2].clone(),p.vertexColors[2]=r.vertexColors[3].clone()),a.push(f,p),r=0,o=t.faceVertexUvs.length;o>r;r++)t.faceVertexUvs[r].length&&(f=t.faceVertexUvs[r][i],c=f[1],h=f[2],u=f[3],f=[f[0].clone(),c.clone(),u.clone()],c=[c.clone(),h.clone(),u.clone()],l[r].push(f,c));for(r=0,o=t.faceUvs.length;o>r;r++)t.faceUvs[r].length&&(c=t.faceUvs[r][i],s[r].push(c,c))}else{for(a.push(r),r=0,o=t.faceUvs.length;o>r;r++)s[r].push(t.faceUvs[r][i]);for(r=0,o=t.faceVertexUvs.length;o>r;r++)l[r].push(t.faceVertexUvs[r][i])}t.faces=a,t.faceUvs=s,t.faceVertexUvs=l,t.computeCentroids(),t.computeFaceNormals(),t.computeVertexNormals(),t.hasTangents&&t.computeTangents()},setMaterialIndex:function(e,t,i,n){for(e=e.faces,n=n||e.length-1,i=i||0;n>=i;i++)e[i].materialIndex=t}},e.GeometryUtils.random=e.Math.random16,e.GeometryUtils.__v1=new e.Vector3,e.GeometryUtils.__v2=new e.Vector3,e.ImageUtils={crossOrigin:"anonymous",loadTexture:function(t,i,n,r){var o=new Image,a=new e.Texture(o,i),i=new e.ImageLoader;return i.addEventListener("load",function(e){a.image=e.content,a.needsUpdate=!0,n&&n(a)}),i.addEventListener("error",function(e){r&&r(e.message)}),i.crossOrigin=this.crossOrigin,i.load(t,o),a.sourceFile=t,a},loadCompressedTexture:function(t,i,n,r){var o=new e.CompressedTexture;o.mapping=i;var a=new XMLHttpRequest;return a.onload=function(){var t=e.ImageUtils.parseDDS(a.response,!0);o.format=t.format,o.mipmaps=t.mipmaps,o.image.width=t.width,o.image.height=t.height,o.generateMipmaps=!1,o.needsUpdate=!0,n&&n(o)},a.onerror=r,a.open("GET",t,!0),a.responseType="arraybuffer",a.send(null),o},loadTextureCube:function(t,i,n,r){var o=[];o.loadCount=0;var a=new e.Texture;a.image=o,void 0!==i&&(a.mapping=i),a.flipY=!1;for(var i=0,s=t.length;s>i;++i){var l=new Image;o[i]=l,l.onload=function(){o.loadCount+=1,6===o.loadCount&&(a.needsUpdate=!0,n&&n(a))},l.onerror=r,l.crossOrigin=this.crossOrigin,l.src=t[i]}return a},loadCompressedTextureCube:function(t,i,n,r){var o=[];o.loadCount=0;var a=new e.CompressedTexture;if(a.image=o,void 0!==i&&(a.mapping=i),a.flipY=!1,a.generateMipmaps=!1,i=function(t,i){return function(){var r=e.ImageUtils.parseDDS(t.response,!0);i.format=r.format,i.mipmaps=r.mipmaps,i.width=r.width,i.height=r.height,o.loadCount+=1,6===o.loadCount&&(a.format=r.format,a.needsUpdate=!0,n&&n(a))}},t instanceof Array)for(var s=0,l=t.length;l>s;++s){var c={};o[s]=c;var h=new XMLHttpRequest;h.onload=i(h,c),h.onerror=r,c=t[s],h.open("GET",c,!0),h.responseType="arraybuffer",h.send(null)}else h=new XMLHttpRequest,h.onload=function(){var t=e.ImageUtils.parseDDS(h.response,!0);if(t.isCubemap){for(var i=t.mipmaps.length/t.mipmapCount,r=0;i>r;r++){o[r]={mipmaps:[]};for(var s=0;s<t.mipmapCount;s++)o[r].mipmaps.push(t.mipmaps[r*t.mipmapCount+s]),o[r].format=t.format,o[r].width=t.width,o[r].height=t.height}a.format=t.format,a.needsUpdate=!0,n&&n(a)}},h.onerror=r,h.open("GET",t,!0),h.responseType="arraybuffer",h.send(null);return a},parseDDS:function(t,i){function n(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}var r={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},o=n("DXT1"),a=n("DXT3"),s=n("DXT5"),l=new Int32Array(t,0,31);if(542327876!==l[0])return console.error("ImageUtils.parseDDS(): Invalid magic number in DDS header"),r;if(4&!l[20])return console.error("ImageUtils.parseDDS(): Unsupported format, must contain a FourCC code"),r;var c=l[21];switch(c){case o:o=8,r.format=e.RGB_S3TC_DXT1_Format;break;case a:o=16,r.format=e.RGBA_S3TC_DXT3_Format;break;case s:o=16,r.format=e.RGBA_S3TC_DXT5_Format;break;default:return console.error("ImageUtils.parseDDS(): Unsupported FourCC code: ",String.fromCharCode(255&c,c>>8&255,c>>16&255,c>>24&255)),r}r.mipmapCount=1,131072&l[2]&&!1!==i&&(r.mipmapCount=Math.max(1,l[7])),r.isCubemap=512&l[28]?!0:!1,r.width=l[4],r.height=l[3];for(var l=l[1]+4,a=r.width,s=r.height,c=r.isCubemap?6:1,h=0;c>h;h++){for(var u=0;u<r.mipmapCount;u++){var f=Math.max(4,a)/4*Math.max(4,s)/4*o,p={data:new Uint8Array(t,l,f),width:a,height:s};r.mipmaps.push(p),l+=f,a=Math.max(.5*a,1),s=Math.max(.5*s,1)}a=r.width,s=r.height}return r},getNormalMap:function(e,t){var i=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]},t=1|t,n=e.width,r=e.height,o=document.createElement("canvas");o.width=n,o.height=r;var a=o.getContext("2d");a.drawImage(e,0,0);for(var s=a.getImageData(0,0,n,r).data,l=a.createImageData(n,r),c=l.data,h=0;n>h;h++)for(var u=0;r>u;u++){var f=0>u-1?0:u-1,p=u+1>r-1?r-1:u+1,d=0>h-1?0:h-1,m=h+1>n-1?n-1:h+1,g=[],v=[0,0,s[4*(u*n+h)]/255*t];for(g.push([-1,0,s[4*(u*n+d)]/255*t]),g.push([-1,-1,s[4*(f*n+d)]/255*t]),g.push([0,-1,s[4*(f*n+h)]/255*t]),g.push([1,-1,s[4*(f*n+m)]/255*t]),g.push([1,0,s[4*(u*n+m)]/255*t]),g.push([1,1,s[4*(p*n+m)]/255*t]),g.push([0,1,s[4*(p*n+h)]/255*t]),g.push([-1,1,s[4*(p*n+d)]/255*t]),f=[],d=g.length,p=0;d>p;p++){var m=g[p],y=g[(p+1)%d],m=[m[0]-v[0],m[1]-v[1],m[2]-v[2]],y=[y[0]-v[0],y[1]-v[1],y[2]-v[2]];f.push(i([m[1]*y[2]-m[2]*y[1],m[2]*y[0]-m[0]*y[2],m[0]*y[1]-m[1]*y[0]]))}for(g=[0,0,0],p=0;p<f.length;p++)g[0]+=f[p][0],g[1]+=f[p][1],g[2]+=f[p][2];g[0]/=f.length,g[1]/=f.length,g[2]/=f.length,v=4*(u*n+h),c[v]=255*((g[0]+1)/2)|0,c[v+1]=255*((g[1]+1)/2)|0,c[v+2]=255*g[2]|0,c[v+3]=255}return a.putImageData(l,0,0),o},generateDataTexture:function(t,i,n){for(var r=t*i,o=new Uint8Array(3*r),a=Math.floor(255*n.r),s=Math.floor(255*n.g),n=Math.floor(255*n.b),l=0;r>l;l++)o[3*l]=a,o[3*l+1]=s,o[3*l+2]=n;return t=new e.DataTexture(o,t,i,e.RGBFormat),t.needsUpdate=!0,t}},e.SceneUtils={createMultiMaterialObject:function(t,i){for(var n=new e.Object3D,r=0,o=i.length;o>r;r++)n.add(new e.Mesh(t,i[r]));return n},detach:function(e,t,i){e.applyMatrix(t.matrixWorld),t.remove(e),i.add(e)},attach:function(t,i,n){var r=new e.Matrix4;r.getInverse(n.matrixWorld),t.applyMatrix(r),i.remove(t),n.add(t)}},e.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(e){var t=e.familyName.toLowerCase();return this.faces[t]=this.faces[t]||{},this.faces[t][e.cssFontWeight]=this.faces[t][e.cssFontWeight]||{},this.faces[t][e.cssFontWeight][e.cssFontStyle]=e,this.faces[t][e.cssFontWeight][e.cssFontStyle]=e},drawText:function(t){for(var i=this.getFace(),n=this.size/i.resolution,r=0,o=String(t).split(""),a=o.length,s=[],t=0;a>t;t++){var l=new e.Path,l=this.extractGlyphPoints(o[t],i,n,r,l),r=r+l.offset;s.push(l.path)}return{paths:s,offset:r/2}},extractGlyphPoints:function(t,i,n,r,o){var a,s,l,c,h,u,f,p,d,m,g,v=[],y=i.glyphs[t]||i.glyphs["?"];if(y){if(y.o)for(i=y._cachedOutline||(y._cachedOutline=y.o.split(" ")),c=i.length,t=0;c>t;)switch(l=i[t++]){case"m":l=i[t++]*n+r,h=i[t++]*n,o.moveTo(l,h);break;case"l":l=i[t++]*n+r,h=i[t++]*n,o.lineTo(l,h);break;case"q":if(l=i[t++]*n+r,h=i[t++]*n,p=i[t++]*n+r,d=i[t++]*n,o.quadraticCurveTo(p,d,l,h),a=v[v.length-1])for(u=a.x,f=a.y,a=1,s=this.divisions;s>=a;a++){var b=a/s;e.Shape.Utils.b2(b,u,p,l),e.Shape.Utils.b2(b,f,d,h)}break;case"b":if(l=i[t++]*n+r,h=i[t++]*n,p=i[t++]*n+r,d=i[t++]*-n,m=i[t++]*n+r,g=i[t++]*-n,o.bezierCurveTo(l,h,p,d,m,g),a=v[v.length-1])for(u=a.x,f=a.y,a=1,s=this.divisions;s>=a;a++)b=a/s,e.Shape.Utils.b3(b,u,p,m,l),e.Shape.Utils.b3(b,f,d,g,h)}return{offset:y.ha*n,path:o}}}},e.FontUtils.generateShapes=function(t,i){var i=i||{},n=void 0!==i.curveSegments?i.curveSegments:4,r=void 0!==i.font?i.font:"helvetiker",o=void 0!==i.weight?i.weight:"normal",a=void 0!==i.style?i.style:"normal";for(e.FontUtils.size=void 0!==i.size?i.size:100,e.FontUtils.divisions=n,e.FontUtils.face=r,e.FontUtils.weight=o,e.FontUtils.style=a,n=e.FontUtils.drawText(t).paths,r=[],o=0,a=n.length;a>o;o++)Array.prototype.push.apply(r,n[o].toShapes());return r},function(e){var t=function(e){for(var t=e.length,i=0,n=t-1,r=0;t>r;n=r++)i+=e[n].x*e[r].y-e[r].x*e[n].y;return.5*i};return e.Triangulate=function(e,i){var n=e.length;if(3>n)return null;var r,o,a,s=[],l=[],c=[];if(0<t(e))for(o=0;n>o;o++)l[o]=o;else for(o=0;n>o;o++)l[o]=n-1-o;var h=2*n;for(o=n-1;n>2;){if(0>=h--){console.log("Warning, unable to triangulate polygon!");break}r=o,r>=n&&(r=0),o=r+1,o>=n&&(o=0),a=o+1,a>=n&&(a=0);var u;e:{var f=u=void 0,p=void 0,d=void 0,m=void 0,g=void 0,v=void 0,y=void 0,b=void 0,f=e[l[r]].x,p=e[l[r]].y,d=e[l[o]].x,m=e[l[o]].y,g=e[l[a]].x,v=e[l[a]].y;if(1e-10>(d-f)*(v-p)-(m-p)*(g-f))u=!1;else{var x=void 0,w=void 0,_=void 0,S=void 0,M=void 0,C=void 0,T=void 0,A=void 0,E=void 0,P=void 0,E=A=T=b=y=void 0,x=g-d,w=v-m,_=f-g,S=p-v,M=d-f,C=m-p;for(u=0;n>u;u++)if(u!==r&&u!==o&&u!==a&&(y=e[l[u]].x,b=e[l[u]].y,T=y-f,A=b-p,E=y-d,P=b-m,y-=g,b-=v,E=x*P-w*E,T=M*A-C*T,A=_*b-S*y,E>=0&&A>=0&&T>=0)){u=!1;break e}u=!0}}if(u){for(s.push([e[l[r]],e[l[o]],e[l[a]]]),c.push([l[r],l[o],l[a]]),r=o,a=o+1;n>a;r++,a++)l[r]=l[a];n--,h=2*n}}return i?c:s},e.Triangulate.area=t,e}(e.FontUtils),self._typeface_js={faces:e.FontUtils.faces,loadFace:e.FontUtils.loadFace},e.typeface_js=self._typeface_js,e.Curve=function(){},e.Curve.prototype.getPoint=function(){return console.log("Warning, getPoint() not implemented!"),null},e.Curve.prototype.getPointAt=function(e){return e=this.getUtoTmapping(e),this.getPoint(e)},e.Curve.prototype.getPoints=function(e){e||(e=5);var t,i=[];for(t=0;e>=t;t++)i.push(this.getPoint(t/e));return i},e.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,i=[];for(t=0;e>=t;t++)i.push(this.getPointAt(t/e));return i},e.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},e.Curve.prototype.getLengths=function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,i,n=[],r=this.getPoint(0),o=0;for(n.push(0),i=1;e>=i;i++)t=this.getPoint(i/e),o+=t.distanceTo(r),n.push(o),r=t;return this.cacheArcLengths=n},e.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},e.Curve.prototype.getUtoTmapping=function(e,t){var i,n=this.getLengths(),r=0,o=n.length;i=t?t:e*n[o-1];for(var a,s=0,l=o-1;l>=s;)if(r=Math.floor(s+(l-s)/2),a=n[r]-i,0>a)s=r+1;else{if(!(a>0)){l=r;break}l=r-1}return r=l,n[r]==i?r/(o-1):(s=n[r],n=(r+(i-s)/(n[r+1]-s))/(o-1))},e.Curve.prototype.getTangent=function(e){var t=e-1e-4,e=e+1e-4;return 0>t&&(t=0),e>1&&(e=1),t=this.getPoint(t),this.getPoint(e).clone().sub(t).normalize()},e.Curve.prototype.getTangentAt=function(e){return e=this.getUtoTmapping(e),this.getTangent(e)},e.LineCurve=function(e,t){this.v1=e,this.v2=t},e.LineCurve.prototype=Object.create(e.Curve.prototype),e.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},e.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},e.LineCurve.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},e.QuadraticBezierCurve=function(e,t,i){this.v0=e,this.v1=t,this.v2=i},e.QuadraticBezierCurve.prototype=Object.create(e.Curve.prototype),e.QuadraticBezierCurve.prototype.getPoint=function(t){var i;return i=e.Shape.Utils.b2(t,this.v0.x,this.v1.x,this.v2.x),t=e.Shape.Utils.b2(t,this.v0.y,this.v1.y,this.v2.y),new e.Vector2(i,t)},e.QuadraticBezierCurve.prototype.getTangent=function(t){var i;return i=e.Curve.Utils.tangentQuadraticBezier(t,this.v0.x,this.v1.x,this.v2.x),t=e.Curve.Utils.tangentQuadraticBezier(t,this.v0.y,this.v1.y,this.v2.y),i=new e.Vector2(i,t),i.normalize(),i},e.CubicBezierCurve=function(e,t,i,n){this.v0=e,this.v1=t,this.v2=i,this.v3=n},e.CubicBezierCurve.prototype=Object.create(e.Curve.prototype),e.CubicBezierCurve.prototype.getPoint=function(t){var i;return i=e.Shape.Utils.b3(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t=e.Shape.Utils.b3(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new e.Vector2(i,t)},e.CubicBezierCurve.prototype.getTangent=function(t){var i;return i=e.Curve.Utils.tangentCubicBezier(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t=e.Curve.Utils.tangentCubicBezier(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y),i=new e.Vector2(i,t),i.normalize(),i},e.SplineCurve=function(e){this.points=void 0==e?[]:e},e.SplineCurve.prototype=Object.create(e.Curve.prototype),e.SplineCurve.prototype.getPoint=function(t){var i,n=new e.Vector2,r=[],o=this.points;return i=(o.length-1)*t,t=Math.floor(i),i-=t,r[0]=0==t?t:t-1,r[1]=t,r[2]=t>o.length-2?o.length-1:t+1,r[3]=t>o.length-3?o.length-1:t+2,n.x=e.Curve.Utils.interpolate(o[r[0]].x,o[r[1]].x,o[r[2]].x,o[r[3]].x,i),n.y=e.Curve.Utils.interpolate(o[r[0]].y,o[r[1]].y,o[r[2]].y,o[r[3]].y,i),n},e.EllipseCurve=function(e,t,i,n,r,o,a){this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=o,this.aClockwise=a},e.EllipseCurve.prototype=Object.create(e.Curve.prototype),e.EllipseCurve.prototype.getPoint=function(t){var i=this.aEndAngle-this.aStartAngle;return this.aClockwise||(t=1-t),i=this.aStartAngle+t*i,t=this.aX+this.xRadius*Math.cos(i),i=this.aY+this.yRadius*Math.sin(i),new e.Vector2(t,i)},e.ArcCurve=function(t,i,n,r,o,a){e.EllipseCurve.call(this,t,i,n,n,r,o,a)},e.ArcCurve.prototype=Object.create(e.EllipseCurve.prototype),e.Curve.Utils={tangentQuadraticBezier:function(e,t,i,n){return 2*(1-e)*(i-t)+2*e*(n-i)},tangentCubicBezier:function(e,t,i,n,r){return-3*t*(1-e)*(1-e)+3*i*(1-e)*(1-e)-6*e*i*(1-e)+6*e*n*(1-e)-3*e*e*n+3*e*e*r},tangentSpline:function(e){return 6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e)},interpolate:function(e,t,i,n,r){var e=.5*(i-e),n=.5*(n-t),o=r*r;return(2*t-2*i+e+n)*r*o+(-3*t+3*i-2*e-n)*o+e*r+t}},e.Curve.create=function(t,i){return t.prototype=Object.create(e.Curve.prototype),t.prototype.getPoint=i,t},e.LineCurve3=e.Curve.create(function(e,t){this.v1=e,this.v2=t},function(t){var i=new e.Vector3;return i.subVectors(this.v2,this.v1),i.multiplyScalar(t),i.add(this.v1),i}),e.QuadraticBezierCurve3=e.Curve.create(function(e,t,i){this.v0=e,this.v1=t,this.v2=i},function(t){var i,n;return i=e.Shape.Utils.b2(t,this.v0.x,this.v1.x,this.v2.x),n=e.Shape.Utils.b2(t,this.v0.y,this.v1.y,this.v2.y),t=e.Shape.Utils.b2(t,this.v0.z,this.v1.z,this.v2.z),new e.Vector3(i,n,t)}),e.CubicBezierCurve3=e.Curve.create(function(e,t,i,n){this.v0=e,this.v1=t,this.v2=i,this.v3=n},function(t){var i,n;return i=e.Shape.Utils.b3(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x),n=e.Shape.Utils.b3(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y),t=e.Shape.Utils.b3(t,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new e.Vector3(i,n,t)}),e.SplineCurve3=e.Curve.create(function(e){this.points=void 0==e?[]:e},function(t){var i,n=new e.Vector3,r=[],o=this.points,t=(o.length-1)*t;i=Math.floor(t),t-=i,r[0]=0==i?i:i-1,r[1]=i,r[2]=i>o.length-2?o.length-1:i+1,r[3]=i>o.length-3?o.length-1:i+2,i=o[r[0]];var a=o[r[1]],s=o[r[2]],r=o[r[3]];return n.x=e.Curve.Utils.interpolate(i.x,a.x,s.x,r.x,t),n.y=e.Curve.Utils.interpolate(i.y,a.y,s.y,r.y,t),n.z=e.Curve.Utils.interpolate(i.z,a.z,s.z,r.z,t),n}),e.ClosedSplineCurve3=e.Curve.create(function(e){this.points=void 0==e?[]:e},function(t){var i,n=new e.Vector3,r=[],o=this.points;return i=(o.length-0)*t,t=Math.floor(i),i-=t,t+=t>0?0:(Math.floor(Math.abs(t)/o.length)+1)*o.length,r[0]=(t-1)%o.length,r[1]=t%o.length,r[2]=(t+1)%o.length,r[3]=(t+2)%o.length,n.x=e.Curve.Utils.interpolate(o[r[0]].x,o[r[1]].x,o[r[2]].x,o[r[3]].x,i),n.y=e.Curve.Utils.interpolate(o[r[0]].y,o[r[1]].y,o[r[2]].y,o[r[3]].y,i),n.z=e.Curve.Utils.interpolate(o[r[0]].z,o[r[1]].z,o[r[2]].z,o[r[3]].z,i),n}),e.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},e.CurvePath.prototype=Object.create(e.Curve.prototype),e.CurvePath.prototype.add=function(e){this.curves.push(e)},e.CurvePath.prototype.checkConnection=function(){},e.CurvePath.prototype.closePath=function(){var t=this.curves[0].getPoint(0),i=this.curves[this.curves.length-1].getPoint(1);t.equals(i)||this.curves.push(new e.LineCurve(i,t))},e.CurvePath.prototype.getPoint=function(e){for(var t=e*this.getLength(),i=this.getCurveLengths(),e=0;e<i.length;){if(i[e]>=t)return t=i[e]-t,e=this.curves[e],t=1-t/e.getLength(),e.getPointAt(t);e++}return null},e.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},e.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e,t=[],i=0,n=this.curves.length;for(e=0;n>e;e++)i+=this.curves[e].getLength(),t.push(i);return this.cacheLengths=t},e.CurvePath.prototype.getBoundingBox=function(){var t,i,n,r,o,a,s=this.getPoints();t=i=Number.NEGATIVE_INFINITY,r=o=Number.POSITIVE_INFINITY;var l,c,h,u,f=s[0]instanceof e.Vector3;for(u=f?new e.Vector3:new e.Vector2,c=0,h=s.length;h>c;c++)l=s[c],l.x>t?t=l.x:l.x<r&&(r=l.x),l.y>i?i=l.y:l.y<o&&(o=l.y),f&&(l.z>n?n=l.z:l.z<a&&(a=l.z)),u.add(l);return s={minX:r,minY:o,maxX:t,maxY:i,centroid:u.divideScalar(h)},f&&(s.maxZ=n,s.minZ=a),s},e.CurvePath.prototype.createPointsGeometry=function(e){return e=this.getPoints(e,!0),this.createGeometry(e)},e.CurvePath.prototype.createSpacedPointsGeometry=function(e){return e=this.getSpacedPoints(e,!0),this.createGeometry(e)},e.CurvePath.prototype.createGeometry=function(t){for(var i=new e.Geometry,n=0;n<t.length;n++)i.vertices.push(new e.Vector3(t[n].x,t[n].y,t[n].z||0));return i},e.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},e.CurvePath.prototype.getTransformedPoints=function(e,t){var i,n,r=this.getPoints(e);for(t||(t=this.bends),i=0,n=t.length;n>i;i++)r=this.getWrapPoints(r,t[i]);return r},e.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var i,n,r=this.getSpacedPoints(e);for(t||(t=this.bends),i=0,n=t.length;n>i;i++)r=this.getWrapPoints(r,t[i]);return r},e.CurvePath.prototype.getWrapPoints=function(e,t){var i,n,r,o,a,s,l=this.getBoundingBox();for(i=0,n=e.length;n>i;i++)r=e[i],o=r.x,a=r.y,s=o/l.maxX,s=t.getUtoTmapping(s,o),o=t.getPoint(s),a=t.getNormalVector(s).multiplyScalar(a),r.x=o.x+a.x,r.y=o.y+a.y;return e},e.Gyroscope=function(){e.Object3D.call(this)},e.Gyroscope.prototype=Object.create(e.Object3D.prototype),e.Gyroscope.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(this.translationWorld,this.rotationWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.rotationObject,this.scaleObject),this.matrixWorld.makeFromPositionQuaternionScale(this.translationWorld,this.rotationObject,this.scaleWorld)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,i=this.children.length;i>t;t++)this.children[t].updateMatrixWorld(e)},e.Gyroscope.prototype.translationWorld=new e.Vector3,e.Gyroscope.prototype.translationObject=new e.Vector3,e.Gyroscope.prototype.rotationWorld=new e.Quaternion,e.Gyroscope.prototype.rotationObject=new e.Quaternion,e.Gyroscope.prototype.scaleWorld=new e.Vector3,e.Gyroscope.prototype.scaleObject=new e.Vector3,e.Path=function(t){e.CurvePath.call(this),this.actions=[],t&&this.fromPoints(t)},e.Path.prototype=Object.create(e.CurvePath.prototype),e.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},e.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);
for(var t=1,i=e.length;i>t;t++)this.lineTo(e[t].x,e[t].y)},e.Path.prototype.moveTo=function(){var t=Array.prototype.slice.call(arguments);this.actions.push({action:e.PathActions.MOVE_TO,args:t})},e.Path.prototype.lineTo=function(t,i){var n=Array.prototype.slice.call(arguments),r=this.actions[this.actions.length-1].args,r=new e.LineCurve(new e.Vector2(r[r.length-2],r[r.length-1]),new e.Vector2(t,i));this.curves.push(r),this.actions.push({action:e.PathActions.LINE_TO,args:n})},e.Path.prototype.quadraticCurveTo=function(t,i,n,r){var o=Array.prototype.slice.call(arguments),a=this.actions[this.actions.length-1].args,a=new e.QuadraticBezierCurve(new e.Vector2(a[a.length-2],a[a.length-1]),new e.Vector2(t,i),new e.Vector2(n,r));this.curves.push(a),this.actions.push({action:e.PathActions.QUADRATIC_CURVE_TO,args:o})},e.Path.prototype.bezierCurveTo=function(t,i,n,r,o,a){var s=Array.prototype.slice.call(arguments),l=this.actions[this.actions.length-1].args,l=new e.CubicBezierCurve(new e.Vector2(l[l.length-2],l[l.length-1]),new e.Vector2(t,i),new e.Vector2(n,r),new e.Vector2(o,a));this.curves.push(l),this.actions.push({action:e.PathActions.BEZIER_CURVE_TO,args:s})},e.Path.prototype.splineThru=function(t){var i=Array.prototype.slice.call(arguments),n=this.actions[this.actions.length-1].args,n=[new e.Vector2(n[n.length-2],n[n.length-1])];Array.prototype.push.apply(n,t),n=new e.SplineCurve(n),this.curves.push(n),this.actions.push({action:e.PathActions.CSPLINE_THRU,args:i})},e.Path.prototype.arc=function(e,t,i,n,r,o){var a=this.actions[this.actions.length-1].args;this.absarc(e+a[a.length-2],t+a[a.length-1],i,n,r,o)},e.Path.prototype.absarc=function(e,t,i,n,r,o){this.absellipse(e,t,i,i,n,r,o)},e.Path.prototype.ellipse=function(e,t,i,n,r,o,a){var s=this.actions[this.actions.length-1].args;this.absellipse(e+s[s.length-2],t+s[s.length-1],i,n,r,o,a)},e.Path.prototype.absellipse=function(t,i,n,r,o,a,s){var l=Array.prototype.slice.call(arguments),c=new e.EllipseCurve(t,i,n,r,o,a,s);this.curves.push(c),c=c.getPoint(s?1:0),l.push(c.x),l.push(c.y),this.actions.push({action:e.PathActions.ELLIPSE,args:l})},e.Path.prototype.getSpacedPoints=function(e){e||(e=40);for(var t=[],i=0;e>i;i++)t.push(this.getPoint(i/e));return t},e.Path.prototype.getPoints=function(t,i){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(t,i);var n,r,o,a,s,l,c,h,u,f,p,d,m,t=t||12,g=[];for(n=0,r=this.actions.length;r>n;n++)switch(o=this.actions[n],a=o.action,o=o.args,a){case e.PathActions.MOVE_TO:g.push(new e.Vector2(o[0],o[1]));break;case e.PathActions.LINE_TO:g.push(new e.Vector2(o[0],o[1]));break;case e.PathActions.QUADRATIC_CURVE_TO:for(s=o[2],l=o[3],u=o[0],f=o[1],0<g.length?(a=g[g.length-1],p=a.x,d=a.y):(a=this.actions[n-1].args,p=a[a.length-2],d=a[a.length-1]),o=1;t>=o;o++)m=o/t,a=e.Shape.Utils.b2(m,p,u,s),m=e.Shape.Utils.b2(m,d,f,l),g.push(new e.Vector2(a,m));break;case e.PathActions.BEZIER_CURVE_TO:for(s=o[4],l=o[5],u=o[0],f=o[1],c=o[2],h=o[3],0<g.length?(a=g[g.length-1],p=a.x,d=a.y):(a=this.actions[n-1].args,p=a[a.length-2],d=a[a.length-1]),o=1;t>=o;o++)m=o/t,a=e.Shape.Utils.b3(m,p,u,c,s),m=e.Shape.Utils.b3(m,d,f,h,l),g.push(new e.Vector2(a,m));break;case e.PathActions.CSPLINE_THRU:for(a=this.actions[n-1].args,m=[new e.Vector2(a[a.length-2],a[a.length-1])],a=t*o[0].length,m=m.concat(o[0]),m=new e.SplineCurve(m),o=1;a>=o;o++)g.push(m.getPointAt(o/a));break;case e.PathActions.ARC:for(s=o[0],l=o[1],f=o[2],c=o[3],a=o[4],u=!!o[5],p=a-c,d=2*t,o=1;d>=o;o++)m=o/d,u||(m=1-m),m=c+m*p,a=s+f*Math.cos(m),m=l+f*Math.sin(m),g.push(new e.Vector2(a,m));break;case e.PathActions.ELLIPSE:for(s=o[0],l=o[1],f=o[2],h=o[3],c=o[4],a=o[5],u=!!o[6],p=a-c,d=2*t,o=1;d>=o;o++)m=o/d,u||(m=1-m),m=c+m*p,a=s+f*Math.cos(m),m=l+h*Math.sin(m),g.push(new e.Vector2(a,m))}return n=g[g.length-1],1e-10>Math.abs(n.x-g[0].x)&&1e-10>Math.abs(n.y-g[0].y)&&g.splice(g.length-1,1),i&&g.push(g[0]),g},e.Path.prototype.toShapes=function(){var t,i,n,r,o=[],a=new e.Path;for(t=0,i=this.actions.length;i>t;t++)n=this.actions[t],r=n.args,n=n.action,n==e.PathActions.MOVE_TO&&0!=a.actions.length&&(o.push(a),a=new e.Path),a[n].apply(a,r);if(0!=a.actions.length&&o.push(a),0==o.length)return[];var s;if(r=[],t=!e.Shape.Utils.isClockWise(o[0].getPoints()),1==o.length)return a=o[0],s=new e.Shape,s.actions=a.actions,s.curves=a.curves,r.push(s),r;if(t)for(s=new e.Shape,t=0,i=o.length;i>t;t++)a=o[t],e.Shape.Utils.isClockWise(a.getPoints())?(s.actions=a.actions,s.curves=a.curves,r.push(s),s=new e.Shape):s.holes.push(a);else{for(t=0,i=o.length;i>t;t++)a=o[t],e.Shape.Utils.isClockWise(a.getPoints())?(s&&r.push(s),s=new e.Shape,s.actions=a.actions,s.curves=a.curves):s.holes.push(a);r.push(s)}return r},e.Shape=function(){e.Path.apply(this,arguments),this.holes=[]},e.Shape.prototype=Object.create(e.Path.prototype),e.Shape.prototype.extrude=function(t){return new e.ExtrudeGeometry(this,t)},e.Shape.prototype.makeGeometry=function(t){return new e.ShapeGeometry(this,t)},e.Shape.prototype.getPointsHoles=function(e){var t,i=this.holes.length,n=[];for(t=0;i>t;t++)n[t]=this.holes[t].getTransformedPoints(e,this.bends);return n},e.Shape.prototype.getSpacedPointsHoles=function(e){var t,i=this.holes.length,n=[];for(t=0;i>t;t++)n[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return n},e.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},e.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},e.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},e.Shape.Utils={removeHoles:function(t,i){var n,r,o,a,s,l,c,h,u,f,p=t.concat(),d=p.concat(),m=[];for(s=0;s<i.length;s++){for(l=i[s],Array.prototype.push.apply(d,l),r=Number.POSITIVE_INFINITY,n=0;n<l.length;n++)for(u=l[n],f=[],h=0;h<p.length;h++)c=p[h],c=u.distanceToSquared(c),f.push(c),r>c&&(r=c,o=n,a=h);n=a-1>=0?a-1:p.length-1,r=o-1>=0?o-1:l.length-1;var g=[l[o],p[a],p[n]];h=e.FontUtils.Triangulate.area(g);var v=[l[o],l[r],p[a]];u=e.FontUtils.Triangulate.area(v),f=a,c=o,a+=1,o+=-1,0>a&&(a+=p.length),a%=p.length,0>o&&(o+=l.length),o%=l.length,n=a-1>=0?a-1:p.length-1,r=o-1>=0?o-1:l.length-1,g=[l[o],p[a],p[n]],g=e.FontUtils.Triangulate.area(g),v=[l[o],l[r],p[a]],v=e.FontUtils.Triangulate.area(v),h+u>g+v&&(a=f,o=c,0>a&&(a+=p.length),a%=p.length,0>o&&(o+=l.length),o%=l.length,n=a-1>=0?a-1:p.length-1,r=o-1>=0?o-1:l.length-1),h=p.slice(0,a),u=p.slice(a),f=l.slice(o),c=l.slice(0,o),r=[l[o],l[r],p[a]],m.push([l[o],p[a],p[n]]),m.push(r),p=h.concat(f).concat(c).concat(u)}return{shape:p,isolatedPts:m,allpoints:d}},triangulateShape:function(t,i){var n,r,o,a,s=e.Shape.Utils.removeHoles(t,i),l=s.allpoints,c=s.isolatedPts,s=e.FontUtils.Triangulate(s.shape,!1),h={};for(n=0,r=l.length;r>n;n++)a=l[n].x+":"+l[n].y,void 0!==h[a]&&console.log("Duplicate point",a),h[a]=n;for(n=0,r=s.length;r>n;n++)for(o=s[n],l=0;3>l;l++)a=o[l].x+":"+o[l].y,a=h[a],void 0!==a&&(o[l]=a);for(n=0,r=c.length;r>n;n++)for(o=c[n],l=0;3>l;l++)a=o[l].x+":"+o[l].y,a=h[a],void 0!==a&&(o[l]=a);return s.concat(c)},isClockWise:function(t){return 0>e.FontUtils.Triangulate.area(t)},b2p0:function(e,t){var i=1-e;return i*i*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,i,n){return this.b2p0(e,t)+this.b2p1(e,i)+this.b2p2(e,n)},b3p0:function(e,t){var i=1-e;return i*i*i*t},b3p1:function(e,t){var i=1-e;return 3*i*i*e*t},b3p2:function(e,t){return 3*(1-e)*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,i,n,r){return this.b3p0(e,t)+this.b3p1(e,i)+this.b3p2(e,n)+this.b3p3(e,r)}},e.AnimationHandler=function(){var t=[],i={},n={update:function(e){for(var i=0;i<t.length;i++)t[i].update(e)},addToUpdate:function(e){-1===t.indexOf(e)&&t.push(e)},removeFromUpdate:function(e){e=t.indexOf(e),-1!==e&&t.splice(e,1)},add:function(t){if(void 0!==i[t.name]&&console.log("THREE.AnimationHandler.add: Warning! "+t.name+" already exists in library. Overwriting."),i[t.name]=t,!0!==t.initialized){for(var n=0;n<t.hierarchy.length;n++){for(var r=0;r<t.hierarchy[n].keys.length;r++)if(0>t.hierarchy[n].keys[r].time&&(t.hierarchy[n].keys[r].time=0),void 0!==t.hierarchy[n].keys[r].rot&&!(t.hierarchy[n].keys[r].rot instanceof e.Quaternion)){var o=t.hierarchy[n].keys[r].rot;t.hierarchy[n].keys[r].rot=new e.Quaternion(o[0],o[1],o[2],o[3])}if(t.hierarchy[n].keys.length&&void 0!==t.hierarchy[n].keys[0].morphTargets){for(o={},r=0;r<t.hierarchy[n].keys.length;r++)for(var a=0;a<t.hierarchy[n].keys[r].morphTargets.length;a++){var s=t.hierarchy[n].keys[r].morphTargets[a];o[s]=-1}for(t.hierarchy[n].usedMorphTargets=o,r=0;r<t.hierarchy[n].keys.length;r++){var l={};for(s in o){for(a=0;a<t.hierarchy[n].keys[r].morphTargets.length;a++)if(t.hierarchy[n].keys[r].morphTargets[a]===s){l[s]=t.hierarchy[n].keys[r].morphTargetsInfluences[a];break}a===t.hierarchy[n].keys[r].morphTargets.length&&(l[s]=0)}t.hierarchy[n].keys[r].morphTargetsInfluences=l}}for(r=1;r<t.hierarchy[n].keys.length;r++)t.hierarchy[n].keys[r].time===t.hierarchy[n].keys[r-1].time&&(t.hierarchy[n].keys.splice(r,1),r--);for(r=0;r<t.hierarchy[n].keys.length;r++)t.hierarchy[n].keys[r].index=r}for(r=parseInt(t.length*t.fps,10),t.JIT={},t.JIT.hierarchy=[],n=0;n<t.hierarchy.length;n++)t.JIT.hierarchy.push(Array(r));t.initialized=!0}},get:function(e){return"string"==typeof e?i[e]?i[e]:(console.log("THREE.AnimationHandler.get: Couldn't find animation "+e),null):void 0},parse:function(t){var i=[];if(t instanceof e.SkinnedMesh)for(var n=0;n<t.bones.length;n++)i.push(t.bones[n]);else r(t,i);return i}},r=function(e,t){t.push(e);for(var i=0;i<e.children.length;i++)r(e.children[i],t)};return n.LINEAR=0,n.CATMULLROM=1,n.CATMULLROM_FORWARD=2,n}(),e.Animation=function(t,i,n){this.root=t,this.data=e.AnimationHandler.get(i),this.hierarchy=e.AnimationHandler.parse(t),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.loop=this.isPaused=!0,this.interpolationType=void 0!==n?n:e.AnimationHandler.LINEAR,this.points=[],this.target=new e.Vector3},e.Animation.prototype.play=function(t,i){if(!1===this.isPlaying){this.isPlaying=!0,this.loop=void 0!==t?t:!0,this.currentTime=void 0!==i?i:0;var n,r,o=this.hierarchy.length;for(n=0;o>n;n++){r=this.hierarchy[n],this.interpolationType!==e.AnimationHandler.CATMULLROM_FORWARD&&(r.useQuaternion=!0),r.matrixAutoUpdate=!0,void 0===r.animationCache&&(r.animationCache={},r.animationCache.prevKey={pos:0,rot:0,scl:0},r.animationCache.nextKey={pos:0,rot:0,scl:0},r.animationCache.originalMatrix=r instanceof e.Bone?r.skinMatrix:r.matrix);var a=r.animationCache.prevKey;r=r.animationCache.nextKey,a.pos=this.data.hierarchy[n].keys[0],a.rot=this.data.hierarchy[n].keys[0],a.scl=this.data.hierarchy[n].keys[0],r.pos=this.getNextKeyWith("pos",n,1),r.rot=this.getNextKeyWith("rot",n,1),r.scl=this.getNextKeyWith("scl",n,1)}this.update(0)}this.isPaused=!1,e.AnimationHandler.addToUpdate(this)},e.Animation.prototype.pause=function(){!0===this.isPaused?e.AnimationHandler.addToUpdate(this):e.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},e.Animation.prototype.stop=function(){this.isPaused=this.isPlaying=!1,e.AnimationHandler.removeFromUpdate(this)},e.Animation.prototype.update=function(t){if(!1!==this.isPlaying){var i,n,r,o,a,s,l,c,h,u=["pos","rot","scl"];h=this.currentTime+=t*this.timeScale,c=this.currentTime%=this.data.length,parseInt(Math.min(c*this.data.fps,this.data.length*this.data.fps),10);for(var f=0,p=this.hierarchy.length;p>f;f++){t=this.hierarchy[f],l=t.animationCache;for(var d=0;3>d;d++){if(i=u[d],a=l.prevKey[i],s=l.nextKey[i],s.time<=h){if(h>c){if(!this.loop)return void this.stop();for(a=this.data.hierarchy[f].keys[0],s=this.getNextKeyWith(i,f,1);s.time<c;)a=s,s=this.getNextKeyWith(i,f,s.index+1)}else do a=s,s=this.getNextKeyWith(i,f,s.index+1);while(s.time<c);l.prevKey[i]=a,l.nextKey[i]=s}t.matrixAutoUpdate=!0,t.matrixWorldNeedsUpdate=!0,n=(c-a.time)/(s.time-a.time),r=a[i],o=s[i],(0>n||n>1)&&(console.log("THREE.Animation.update: Warning! Scale out of bounds:"+n+" on bone "+f),n=0>n?0:1),"pos"===i?(i=t.position,this.interpolationType===e.AnimationHandler.LINEAR?(i.x=r[0]+(o[0]-r[0])*n,i.y=r[1]+(o[1]-r[1])*n,i.z=r[2]+(o[2]-r[2])*n):(this.interpolationType===e.AnimationHandler.CATMULLROM||this.interpolationType===e.AnimationHandler.CATMULLROM_FORWARD)&&(this.points[0]=this.getPrevKeyWith("pos",f,a.index-1).pos,this.points[1]=r,this.points[2]=o,this.points[3]=this.getNextKeyWith("pos",f,s.index+1).pos,n=.33*n+.33,r=this.interpolateCatmullRom(this.points,n),i.x=r[0],i.y=r[1],i.z=r[2],this.interpolationType===e.AnimationHandler.CATMULLROM_FORWARD&&(n=this.interpolateCatmullRom(this.points,1.01*n),this.target.set(n[0],n[1],n[2]),this.target.sub(i),this.target.y=0,this.target.normalize(),n=Math.atan2(this.target.x,this.target.z),t.rotation.set(0,n,0)))):"rot"===i?e.Quaternion.slerp(r,o,t.quaternion,n):"scl"===i&&(i=t.scale,i.x=r[0]+(o[0]-r[0])*n,i.y=r[1]+(o[1]-r[1])*n,i.z=r[2]+(o[2]-r[2])*n)}}}},e.Animation.prototype.interpolateCatmullRom=function(e,t){var i,n,r,o,a,s,l=[],c=[];return i=(e.length-1)*t,n=Math.floor(i),i-=n,l[0]=0===n?n:n-1,l[1]=n,l[2]=n>e.length-2?n:n+1,l[3]=n>e.length-3?n:n+2,n=e[l[0]],o=e[l[1]],a=e[l[2]],s=e[l[3]],l=i*i,r=i*l,c[0]=this.interpolate(n[0],o[0],a[0],s[0],i,l,r),c[1]=this.interpolate(n[1],o[1],a[1],s[1],i,l,r),c[2]=this.interpolate(n[2],o[2],a[2],s[2],i,l,r),c},e.Animation.prototype.interpolate=function(e,t,i,n,r,o,a){return e=.5*(i-e),n=.5*(n-t),(2*(t-i)+e+n)*a+(-3*(t-i)-2*e-n)*o+e*r+t},e.Animation.prototype.getNextKeyWith=function(t,i,n){for(var r=this.data.hierarchy[i].keys,n=this.interpolationType===e.AnimationHandler.CATMULLROM||this.interpolationType===e.AnimationHandler.CATMULLROM_FORWARD?n<r.length-1?n:r.length-1:n%r.length;n<r.length;n++)if(void 0!==r[n][t])return r[n];return this.data.hierarchy[i].keys[0]},e.Animation.prototype.getPrevKeyWith=function(t,i,n){for(var r=this.data.hierarchy[i].keys,n=this.interpolationType===e.AnimationHandler.CATMULLROM||this.interpolationType===e.AnimationHandler.CATMULLROM_FORWARD?n>0?n:0:n>=0?n:n+r.length;n>=0;n--)if(void 0!==r[n][t])return r[n];return this.data.hierarchy[i].keys[r.length-1]},e.KeyFrameAnimation=function(t,i,n){for(this.root=t,this.data=e.AnimationHandler.get(i),this.hierarchy=e.AnimationHandler.parse(t),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.loop=this.isPaused=!0,this.JITCompile=void 0!==n?n:!0,t=0,i=this.hierarchy.length;i>t;t++){var n=this.data.hierarchy[t].sids,r=this.hierarchy[t];if(this.data.hierarchy[t].keys.length&&n){for(var o=0;o<n.length;o++){var a=n[o],s=this.getNextKeyWith(a,t,0);s&&s.apply(a)}r.matrixAutoUpdate=!1,this.data.hierarchy[t].node.updateMatrix(),r.matrixWorldNeedsUpdate=!0}}},e.KeyFrameAnimation.prototype.play=function(t,i){if(!this.isPlaying){this.isPlaying=!0,this.loop=void 0!==t?t:!0,this.currentTime=void 0!==i?i:0,this.startTimeMs=i,this.startTime=1e7,this.endTime=-this.startTime;var n,r,o,a=this.hierarchy.length;for(n=0;a>n;n++)r=this.hierarchy[n],o=this.data.hierarchy[n],r.useQuaternion=!0,void 0===o.animationCache&&(o.animationCache={},o.animationCache.prevKey=null,o.animationCache.nextKey=null,o.animationCache.originalMatrix=r instanceof e.Bone?r.skinMatrix:r.matrix),r=this.data.hierarchy[n].keys,r.length&&(o.animationCache.prevKey=r[0],o.animationCache.nextKey=r[1],this.startTime=Math.min(r[0].time,this.startTime),this.endTime=Math.max(r[r.length-1].time,this.endTime));this.update(0)}this.isPaused=!1,e.AnimationHandler.addToUpdate(this)},e.KeyFrameAnimation.prototype.pause=function(){this.isPaused?e.AnimationHandler.addToUpdate(this):e.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},e.KeyFrameAnimation.prototype.stop=function(){this.isPaused=this.isPlaying=!1,e.AnimationHandler.removeFromUpdate(this);for(var t=0;t<this.data.hierarchy.length;t++){var i=this.hierarchy[t],n=this.data.hierarchy[t];if(void 0!==n.animationCache){var r=n.animationCache.originalMatrix;i instanceof e.Bone?(r.copy(i.skinMatrix),i.skinMatrix=r):(r.copy(i.matrix),i.matrix=r),delete n.animationCache}}},e.KeyFrameAnimation.prototype.update=function(t){if(this.isPlaying){var i,n,r,o,a,s,l,c=this.data.JIT.hierarchy;if(s=this.currentTime+=t*this.timeScale,a=this.currentTime%=this.data.length,a<this.startTimeMs&&(a=this.currentTime=this.startTimeMs+a),o=parseInt(Math.min(a*this.data.fps,this.data.length*this.data.fps),10),(l=s>a)&&!this.loop){for(var t=0,h=this.hierarchy.length;h>t;t++){var u=this.data.hierarchy[t].keys,c=this.data.hierarchy[t].sids;if(r=u.length-1,o=this.hierarchy[t],u.length){for(u=0;u<c.length;u++)a=c[u],(s=this.getPrevKeyWith(a,t,r))&&s.apply(a);this.data.hierarchy[t].node.updateMatrix(),o.matrixWorldNeedsUpdate=!0}}this.stop()}else if(!(a<this.startTime)){for(t=0,h=this.hierarchy.length;h>t;t++){r=this.hierarchy[t],i=this.data.hierarchy[t];var u=i.keys,f=i.animationCache;if(this.JITCompile&&void 0!==c[t][o])r instanceof e.Bone?(r.skinMatrix=c[t][o],r.matrixWorldNeedsUpdate=!1):(r.matrix=c[t][o],r.matrixWorldNeedsUpdate=!0);else if(u.length){if(this.JITCompile&&f&&(r instanceof e.Bone?r.skinMatrix=f.originalMatrix:r.matrix=f.originalMatrix),i=f.prevKey,n=f.nextKey,i&&n){if(n.time<=s){if(l&&this.loop)for(i=u[0],n=u[1];n.time<a;)i=n,n=u[i.index+1];else if(!l)for(var p=u.length-1;n.time<a&&n.index!==p;)i=n,n=u[i.index+1];f.prevKey=i,f.nextKey=n}n.time>=a?i.interpolate(n,a):i.interpolate(n,n.time)}this.data.hierarchy[t].node.updateMatrix(),r.matrixWorldNeedsUpdate=!0}}if(this.JITCompile&&void 0===c[0][o])for(this.hierarchy[0].updateMatrixWorld(!0),t=0;t<this.hierarchy.length;t++)c[t][o]=this.hierarchy[t]instanceof e.Bone?this.hierarchy[t].skinMatrix.clone():this.hierarchy[t].matrix.clone()}}},e.KeyFrameAnimation.prototype.getNextKeyWith=function(e,t,i){for(t=this.data.hierarchy[t].keys,i%=t.length;i<t.length;i++)if(t[i].hasTarget(e))return t[i];return t[0]},e.KeyFrameAnimation.prototype.getPrevKeyWith=function(e,t,i){for(t=this.data.hierarchy[t].keys,i=i>=0?i:i+t.length;i>=0;i--)if(t[i].hasTarget(e))return t[i];return t[t.length-1]},e.CubeCamera=function(t,i,n){e.Object3D.call(this);var r=new e.PerspectiveCamera(90,1,t,i);r.up.set(0,-1,0),r.lookAt(new e.Vector3(1,0,0)),this.add(r);var o=new e.PerspectiveCamera(90,1,t,i);o.up.set(0,-1,0),o.lookAt(new e.Vector3(-1,0,0)),this.add(o);var a=new e.PerspectiveCamera(90,1,t,i);a.up.set(0,0,1),a.lookAt(new e.Vector3(0,1,0)),this.add(a);var s=new e.PerspectiveCamera(90,1,t,i);s.up.set(0,0,-1),s.lookAt(new e.Vector3(0,-1,0)),this.add(s);var l=new e.PerspectiveCamera(90,1,t,i);l.up.set(0,-1,0),l.lookAt(new e.Vector3(0,0,1)),this.add(l);var c=new e.PerspectiveCamera(90,1,t,i);c.up.set(0,-1,0),c.lookAt(new e.Vector3(0,0,-1)),this.add(c),this.renderTarget=new e.WebGLRenderTargetCube(n,n,{format:e.RGBFormat,magFilter:e.LinearFilter,minFilter:e.LinearFilter}),this.updateCubeMap=function(e,t){var i=this.renderTarget,n=i.generateMipmaps;i.generateMipmaps=!1,i.activeCubeFace=0,e.render(t,r,i),i.activeCubeFace=1,e.render(t,o,i),i.activeCubeFace=2,e.render(t,a,i),i.activeCubeFace=3,e.render(t,s,i),i.activeCubeFace=4,e.render(t,l,i),i.generateMipmaps=n,i.activeCubeFace=5,e.render(t,c,i)}},e.CubeCamera.prototype=Object.create(e.Object3D.prototype),e.CombinedCamera=function(t,i,n,r,o,a,s){e.Camera.call(this),this.fov=n,this.left=-t/2,this.right=t/2,this.top=i/2,this.bottom=-i/2,this.cameraO=new e.OrthographicCamera(t/-2,t/2,i/2,i/-2,a,s),this.cameraP=new e.PerspectiveCamera(n,t/i,r,o),this.zoom=1,this.toPerspective()},e.CombinedCamera.prototype=Object.create(e.Camera.prototype),e.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near,this.far=this.cameraP.far,this.cameraP.fov=this.fov/this.zoom,this.cameraP.updateProjectionMatrix(),this.projectionMatrix=this.cameraP.projectionMatrix,this.inPerspectiveMode=!0,this.inOrthographicMode=!1},e.CombinedCamera.prototype.toOrthographic=function(){var e=this.cameraP.aspect,t=(this.cameraP.near+this.cameraP.far)/2,t=Math.tan(this.fov/2)*t,e=2*t*e/2,t=t/this.zoom,e=e/this.zoom;this.cameraO.left=-e,this.cameraO.right=e,this.cameraO.top=t,this.cameraO.bottom=-t,this.cameraO.updateProjectionMatrix(),this.near=this.cameraO.near,this.far=this.cameraO.far,this.projectionMatrix=this.cameraO.projectionMatrix,this.inPerspectiveMode=!1,this.inOrthographicMode=!0},e.CombinedCamera.prototype.setSize=function(e,t){this.cameraP.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2},e.CombinedCamera.prototype.setFov=function(e){this.fov=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},e.CombinedCamera.prototype.updateProjectionMatrix=function(){this.inPerspectiveMode?this.toPerspective():(this.toPerspective(),this.toOrthographic())},e.CombinedCamera.prototype.setLens=function(t,i){void 0===i&&(i=24);var n=2*e.Math.radToDeg(Math.atan(i/(2*t)));return this.setFov(n),n},e.CombinedCamera.prototype.setZoom=function(e){this.zoom=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},e.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},e.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0,this.rotation.y=Math.PI,this.rotation.z=0,this.rotationAutoUpdate=!1},e.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0,this.rotation.y=-Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},e.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0,this.rotation.y=Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},e.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},e.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},e.CircleGeometry=function(t,i,n,r){e.Geometry.call(this);var o,t=t||50,n=void 0!==n?n:0,r=void 0!==r?r:2*Math.PI,i=void 0!==i?Math.max(3,i):8,a=[];o=new e.Vector3;var s=new e.Vector2(.5,.5);for(this.vertices.push(o),a.push(s),o=0;i>=o;o++){var l=new e.Vector3,c=n+o/i*r;l.x=t*Math.cos(c),l.y=t*Math.sin(c),this.vertices.push(l),a.push(new e.Vector2((l.x/t+1)/2,(l.y/t+1)/2))}for(n=new e.Vector3(0,0,1),o=1;i>=o;o++)this.faces.push(new e.Face3(o,o+1,0,[n,n,n])),this.faceVertexUvs[0].push([a[o],a[o+1],s]);this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new e.Sphere(new e.Vector3,t)},e.CircleGeometry.prototype=Object.create(e.Geometry.prototype),e.CubeGeometry=function(t,i,n,r,o,a){function s(t,i,n,r,o,a,s,c){var h,u=l.widthSegments,f=l.heightSegments,p=o/2,d=a/2,m=l.vertices.length;"x"===t&&"y"===i||"y"===t&&"x"===i?h="z":"x"===t&&"z"===i||"z"===t&&"x"===i?(h="y",f=l.depthSegments):("z"===t&&"y"===i||"y"===t&&"z"===i)&&(h="x",u=l.depthSegments);var g=u+1,v=f+1,y=o/u,b=a/f,x=new e.Vector3;for(x[h]=s>0?1:-1,o=0;v>o;o++)for(a=0;g>a;a++){var w=new e.Vector3;w[t]=(a*y-p)*n,w[i]=(o*b-d)*r,w[h]=s,l.vertices.push(w)}for(o=0;f>o;o++)for(a=0;u>a;a++)t=new e.Face4(a+g*o+m,a+g*(o+1)+m,a+1+g*(o+1)+m,a+1+g*o+m),t.normal.copy(x),t.vertexNormals.push(x.clone(),x.clone(),x.clone(),x.clone()),t.materialIndex=c,l.faces.push(t),l.faceVertexUvs[0].push([new e.Vector2(a/u,1-o/f),new e.Vector2(a/u,1-(o+1)/f),new e.Vector2((a+1)/u,1-(o+1)/f),new e.Vector2((a+1)/u,1-o/f)])}e.Geometry.call(this);var l=this;this.width=t,this.height=i,this.depth=n,this.widthSegments=r||1,this.heightSegments=o||1,this.depthSegments=a||1,t=this.width/2,i=this.height/2,n=this.depth/2,s("z","y",-1,-1,this.depth,this.height,t,0),s("z","y",1,-1,this.depth,this.height,-t,1),s("x","z",1,1,this.width,this.depth,i,2),s("x","z",1,-1,this.width,this.depth,-i,3),s("x","y",1,-1,this.width,this.height,n,4),s("x","y",-1,-1,this.width,this.height,-n,5),this.computeCentroids(),this.mergeVertices()},e.CubeGeometry.prototype=Object.create(e.Geometry.prototype),e.CylinderGeometry=function(t,i,n,r,o,a){e.Geometry.call(this),this.radiusTop=t=void 0!==t?t:20,this.radiusBottom=i=void 0!==i?i:20,this.height=n=void 0!==n?n:100,this.radiusSegments=r=r||8,this.heightSegments=o=o||1,this.openEnded=a=void 0!==a?a:!1;var s,l,c=n/2,h=[],u=[];for(l=0;o>=l;l++){var f=[],p=[],d=l/o,m=d*(i-t)+t;for(s=0;r>=s;s++){var g=s/r,v=new e.Vector3;v.x=m*Math.sin(2*g*Math.PI),v.y=-d*n+c,v.z=m*Math.cos(2*g*Math.PI),this.vertices.push(v),f.push(this.vertices.length-1),p.push(new e.Vector2(g,1-d))}h.push(f),u.push(p)}for(n=(i-t)/n,s=0;r>s;s++)for(0!==t?(f=this.vertices[h[0][s]].clone(),p=this.vertices[h[0][s+1]].clone()):(f=this.vertices[h[1][s]].clone(),p=this.vertices[h[1][s+1]].clone()),f.setY(Math.sqrt(f.x*f.x+f.z*f.z)*n).normalize(),p.setY(Math.sqrt(p.x*p.x+p.z*p.z)*n).normalize(),l=0;o>l;l++){var d=h[l][s],m=h[l+1][s],g=h[l+1][s+1],v=h[l][s+1],y=f.clone(),b=f.clone(),x=p.clone(),w=p.clone(),_=u[l][s].clone(),S=u[l+1][s].clone(),M=u[l+1][s+1].clone(),C=u[l][s+1].clone();this.faces.push(new e.Face4(d,m,g,v,[y,b,x,w])),this.faceVertexUvs[0].push([_,S,M,C])}if(!1===a&&t>0)for(this.vertices.push(new e.Vector3(0,c,0)),s=0;r>s;s++)d=h[0][s],m=h[0][s+1],g=this.vertices.length-1,y=new e.Vector3(0,1,0),b=new e.Vector3(0,1,0),x=new e.Vector3(0,1,0),_=u[0][s].clone(),S=u[0][s+1].clone(),M=new e.Vector2(S.u,0),this.faces.push(new e.Face3(d,m,g,[y,b,x])),this.faceVertexUvs[0].push([_,S,M]);if(!1===a&&i>0)for(this.vertices.push(new e.Vector3(0,-c,0)),s=0;r>s;s++)d=h[l][s+1],m=h[l][s],g=this.vertices.length-1,y=new e.Vector3(0,-1,0),b=new e.Vector3(0,-1,0),x=new e.Vector3(0,-1,0),_=u[l][s+1].clone(),S=u[l][s].clone(),M=new e.Vector2(S.u,1),this.faces.push(new e.Face3(d,m,g,[y,b,x])),this.faceVertexUvs[0].push([_,S,M]);this.computeCentroids(),this.computeFaceNormals()},e.CylinderGeometry.prototype=Object.create(e.Geometry.prototype),e.ExtrudeGeometry=function(t,i){"undefined"!=typeof t&&(e.Geometry.call(this),t=t instanceof Array?t:[t],this.shapebb=t[t.length-1].getBoundingBox(),this.addShapeList(t,i),this.computeCentroids(),this.computeFaceNormals())},e.ExtrudeGeometry.prototype=Object.create(e.Geometry.prototype),e.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var i=e.length,n=0;i>n;n++)this.addShape(e[n],t)},e.ExtrudeGeometry.prototype.addShape=function(t,i){function n(e,t,i){return t||console.log("die"),t.clone().multiplyScalar(i).add(e)}function r(t,i,n){var r=e.ExtrudeGeometry.__v1,o=e.ExtrudeGeometry.__v2,a=e.ExtrudeGeometry.__v3,s=e.ExtrudeGeometry.__v4,l=e.ExtrudeGeometry.__v5,c=e.ExtrudeGeometry.__v6;return r.set(t.x-i.x,t.y-i.y),o.set(t.x-n.x,t.y-n.y),r=r.normalize(),o=o.normalize(),a.set(-r.y,r.x),s.set(o.y,-o.x),l.copy(t).add(a),c.copy(t).add(s),l.equals(c)?s.clone():(l.copy(i).add(a),c.copy(n).add(s),a=r.dot(s),s=c.sub(l).dot(s),0===a&&(console.log("Either infinite or no solutions!"),console.log(0===s?"Its finite solutions.":"Too bad, no solutions.")),s/=a,0>s?(i=Math.atan2(i.y-t.y,i.x-t.x),t=Math.atan2(n.y-t.y,n.x-t.x),i>t&&(t+=2*Math.PI),n=(i+t)/2,t=-Math.cos(n),n=-Math.sin(n),new e.Vector2(t,n)):r.multiplyScalar(s).add(l).sub(t).clone())}function o(n,r){var o,a;for(j=n.length;0<=--j;){o=j,a=j-1,0>a&&(a=n.length-1);for(var s=0,l=b+2*g,s=0;l>s;s++){var c=N*s,h=N*(s+1),u=r+o+c,c=r+a+c,f=r+a+h,h=r+o+h,p=n,d=s,m=l,v=o,y=a,u=u+P,c=c+P,f=f+P,h=h+P;E.faces.push(new e.Face4(u,c,f,h,null,null,S)),u=M.generateSideWallUV(E,t,p,i,u,c,f,h,d,m,v,y),E.faceVertexUvs[0].push(u)}}}function a(t,i,n){E.vertices.push(new e.Vector3(t,i,n))}function s(n,r,o,a){n+=P,r+=P,o+=P,E.faces.push(new e.Face3(n,r,o,null,null,_)),n=a?M.generateBottomUV(E,t,i,n,r,o):M.generateTopUV(E,t,i,n,r,o),E.faceVertexUvs[0].push(n)}var l,c,h,u,f,p=void 0!==i.amount?i.amount:100,d=void 0!==i.bevelThickness?i.bevelThickness:6,m=void 0!==i.bevelSize?i.bevelSize:d-2,g=void 0!==i.bevelSegments?i.bevelSegments:3,v=void 0!==i.bevelEnabled?i.bevelEnabled:!0,y=void 0!==i.curveSegments?i.curveSegments:12,b=void 0!==i.steps?i.steps:1,x=i.extrudePath,w=!1,_=i.material,S=i.extrudeMaterial,M=void 0!==i.UVGenerator?i.UVGenerator:e.ExtrudeGeometry.WorldUVGenerator;x&&(l=x.getSpacedPoints(b),w=!0,v=!1,c=void 0!==i.frames?i.frames:new e.TubeGeometry.FrenetFrames(x,b,!1),h=new e.Vector3,u=new e.Vector3,f=new e.Vector3),v||(m=d=g=0);var C,T,A,E=this,P=this.vertices.length,y=t.extractPoints(y),k=y.shape,y=y.holes;if(x=!e.Shape.Utils.isClockWise(k)){for(k=k.reverse(),T=0,A=y.length;A>T;T++)C=y[T],e.Shape.Utils.isClockWise(C)&&(y[T]=C.reverse());x=!1}var R=e.Shape.Utils.triangulateShape(k,y),x=k;for(T=0,A=y.length;A>T;T++)C=y[T],k=k.concat(C);var L,D,F,G,N=k.length,V=R.length,O=[],j=0,I=x.length;for(L=I-1,D=j+1;I>j;j++,L++,D++)L===I&&(L=0),D===I&&(D=0),O[j]=r(x[j],x[L],x[D]);var U,z=[],B=O.concat();for(T=0,A=y.length;A>T;T++){for(C=y[T],U=[],j=0,I=C.length,L=I-1,D=j+1;I>j;j++,L++,D++)L===I&&(L=0),D===I&&(D=0),U[j]=r(C[j],C[L],C[D]);z.push(U),B=B.concat(U)}for(L=0;g>L;L++){for(C=L/g,F=d*(1-C),D=m*Math.sin(C*Math.PI/2),j=0,I=x.length;I>j;j++)G=n(x[j],O[j],D),a(G.x,G.y,-F);for(T=0,A=y.length;A>T;T++)for(C=y[T],U=z[T],j=0,I=C.length;I>j;j++)G=n(C[j],U[j],D),a(G.x,G.y,-F)}for(D=m,j=0;N>j;j++)G=v?n(k[j],B[j],D):k[j],w?(u.copy(c.normals[0]).multiplyScalar(G.x),h.copy(c.binormals[0]).multiplyScalar(G.y),f.copy(l[0]).add(u).add(h),a(f.x,f.y,f.z)):a(G.x,G.y,0);for(C=1;b>=C;C++)for(j=0;N>j;j++)G=v?n(k[j],B[j],D):k[j],w?(u.copy(c.normals[C]).multiplyScalar(G.x),h.copy(c.binormals[C]).multiplyScalar(G.y),f.copy(l[C]).add(u).add(h),a(f.x,f.y,f.z)):a(G.x,G.y,p/b*C);for(L=g-1;L>=0;L--){for(C=L/g,F=d*(1-C),D=m*Math.sin(C*Math.PI/2),j=0,I=x.length;I>j;j++)G=n(x[j],O[j],D),a(G.x,G.y,p+F);for(T=0,A=y.length;A>T;T++)for(C=y[T],U=z[T],j=0,I=C.length;I>j;j++)G=n(C[j],U[j],D),w?a(G.x,G.y+l[b-1].y,l[b-1].x+F):a(G.x,G.y,p+F)}if(v){for(d=0*N,j=0;V>j;j++)p=R[j],s(p[2]+d,p[1]+d,p[0]+d,!0);for(d=N*(b+2*g),j=0;V>j;j++)p=R[j],s(p[0]+d,p[1]+d,p[2]+d,!1)}else{for(j=0;V>j;j++)p=R[j],s(p[2],p[1],p[0],!0);for(j=0;V>j;j++)p=R[j],s(p[0]+N*b,p[1]+N*b,p[2]+N*b,!1)}for(p=0,o(x,p),p+=x.length,T=0,A=y.length;A>T;T++)C=y[T],o(C,p),p+=C.length},e.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(t,i,n,r,o,a){return i=t.vertices[o].x,o=t.vertices[o].y,n=t.vertices[a].x,a=t.vertices[a].y,[new e.Vector2(t.vertices[r].x,t.vertices[r].y),new e.Vector2(i,o),new e.Vector2(n,a)]},generateBottomUV:function(e,t,i,n,r,o){return this.generateTopUV(e,t,i,n,r,o)},generateSideWallUV:function(t,i,n,r,o,a,s,l){var i=t.vertices[o].x,n=t.vertices[o].y,o=t.vertices[o].z,r=t.vertices[a].x,c=t.vertices[a].y,a=t.vertices[a].z,h=t.vertices[s].x,u=t.vertices[s].y,s=t.vertices[s].z,f=t.vertices[l].x,p=t.vertices[l].y,t=t.vertices[l].z;return.01>Math.abs(n-c)?[new e.Vector2(i,1-o),new e.Vector2(r,1-a),new e.Vector2(h,1-s),new e.Vector2(f,1-t)]:[new e.Vector2(n,1-o),new e.Vector2(c,1-a),new e.Vector2(u,1-s),new e.Vector2(p,1-t)]}},e.ExtrudeGeometry.__v1=new e.Vector2,e.ExtrudeGeometry.__v2=new e.Vector2,e.ExtrudeGeometry.__v3=new e.Vector2,e.ExtrudeGeometry.__v4=new e.Vector2,e.ExtrudeGeometry.__v5=new e.Vector2,e.ExtrudeGeometry.__v6=new e.Vector2,e.ShapeGeometry=function(t,i){e.Geometry.call(this),!1==t instanceof Array&&(t=[t]),this.shapebb=t[t.length-1].getBoundingBox(),this.addShapeList(t,i),this.computeCentroids(),this.computeFaceNormals()},e.ShapeGeometry.prototype=Object.create(e.Geometry.prototype),e.ShapeGeometry.prototype.addShapeList=function(e,t){for(var i=0,n=e.length;n>i;i++)this.addShape(e[i],t);return this},e.ShapeGeometry.prototype.addShape=function(t,i){void 0===i&&(i={});var n,r,o,a=i.material,s=void 0===i.UVGenerator?e.ExtrudeGeometry.WorldUVGenerator:i.UVGenerator,l=this.vertices.length;n=t.extractPoints(void 0!==i.curveSegments?i.curveSegments:12);var c=n.shape,h=n.holes;if(!e.Shape.Utils.isClockWise(c))for(c=c.reverse(),n=0,r=h.length;r>n;n++)o=h[n],e.Shape.Utils.isClockWise(o)&&(h[n]=o.reverse());var u=e.Shape.Utils.triangulateShape(c,h);for(n=0,r=h.length;r>n;n++)o=h[n],c=c.concat(o);for(h=c.length,r=u.length,n=0;h>n;n++)o=c[n],this.vertices.push(new e.Vector3(o.x,o.y,0));for(n=0;r>n;n++)h=u[n],c=h[0]+l,o=h[1]+l,h=h[2]+l,this.faces.push(new e.Face3(c,o,h,null,null,a)),this.faceVertexUvs[0].push(s.generateBottomUV(this,t,i,c,o,h))
},e.LatheGeometry=function(t,i,n,r){e.Geometry.call(this);for(var i=i||12,n=n||0,r=r||2*Math.PI,o=1/(t.length-1),a=1/i,s=0,l=i;l>=s;s++)for(var c=n+s*a*r,h=Math.cos(c),u=Math.sin(c),c=0,f=t.length;f>c;c++){var p=t[c],d=new e.Vector3;d.x=h*p.x-u*p.y,d.y=u*p.x+h*p.y,d.z=p.z,this.vertices.push(d)}for(n=t.length,s=0,l=i;l>s;s++)for(c=0,f=t.length-1;f>c;c++)r=i=c+n*s,u=i+n,h=i+1+n,this.faces.push(new e.Face4(r,u,h,i+1)),h=s*a,i=c*o,r=h+a,u=i+o,this.faceVertexUvs[0].push([new e.Vector2(h,i),new e.Vector2(r,i),new e.Vector2(r,u),new e.Vector2(h,u)]);this.mergeVertices(),this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},e.LatheGeometry.prototype=Object.create(e.Geometry.prototype),e.PlaneGeometry=function(t,i,n,r){e.Geometry.call(this),this.width=t,this.height=i,this.widthSegments=n||1,this.heightSegments=r||1;for(var n=t/2,o=i/2,r=this.widthSegments,a=this.heightSegments,s=r+1,l=a+1,c=this.width/r,h=this.height/a,u=new e.Vector3(0,0,1),t=0;l>t;t++)for(i=0;s>i;i++)this.vertices.push(new e.Vector3(i*c-n,-(t*h-o),0));for(t=0;a>t;t++)for(i=0;r>i;i++)n=new e.Face4(i+s*t,i+s*(t+1),i+1+s*(t+1),i+1+s*t),n.normal.copy(u),n.vertexNormals.push(u.clone(),u.clone(),u.clone(),u.clone()),this.faces.push(n),this.faceVertexUvs[0].push([new e.Vector2(i/r,1-t/a),new e.Vector2(i/r,1-(t+1)/a),new e.Vector2((i+1)/r,1-(t+1)/a),new e.Vector2((i+1)/r,1-t/a)]);this.computeCentroids()},e.PlaneGeometry.prototype=Object.create(e.Geometry.prototype),e.RingGeometry=function(t,i,n,r,o,a){e.Geometry.call(this);for(var t=t||0,i=i||50,o=void 0!==o?o:0,a=void 0!==a?a:2*Math.PI,n=void 0!==n?Math.max(3,n):8,r=void 0!==r?Math.max(3,r):8,s=[],l=t,c=(i-t)/r,t=0;r>=t;t++){for(i=0;n>=i;i++){var h=new e.Vector3,u=o+i/n*a;h.x=l*Math.cos(u),h.y=l*Math.sin(u),this.vertices.push(h),s.push(new e.Vector2((h.x/l+1)/2,-(h.y/l+1)/2+1))}l+=c}for(o=new e.Vector3(0,0,1),t=0;r>t;t++)for(a=t*n,i=0;n>=i;i++){var u=i+a,c=u+t,h=u+n+t,f=u+n+1+t;this.faces.push(new e.Face3(c,h,f,[o,o,o])),this.faceVertexUvs[0].push([s[c],s[h],s[f]]),c=u+t,h=u+n+1+t,f=u+1+t,this.faces.push(new e.Face3(c,h,f,[o,o,o])),this.faceVertexUvs[0].push([s[c],s[h],s[f]])}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new e.Sphere(new e.Vector3,l)},e.RingGeometry.prototype=Object.create(e.Geometry.prototype),e.SphereGeometry=function(t,i,n,r,o,a,s){e.Geometry.call(this),this.radius=t=t||50,this.widthSegments=i=Math.max(3,Math.floor(i)||8),this.heightSegments=n=Math.max(2,Math.floor(n)||6),this.phiStart=r=void 0!==r?r:0,this.phiLength=o=void 0!==o?o:2*Math.PI,this.thetaStart=a=void 0!==a?a:0,this.thetaLength=s=void 0!==s?s:Math.PI;var l,c,h=[],u=[];for(c=0;n>=c;c++){var f=[],p=[];for(l=0;i>=l;l++){var d=l/i,m=c/n,g=new e.Vector3;g.x=-t*Math.cos(r+d*o)*Math.sin(a+m*s),g.y=t*Math.cos(a+m*s),g.z=t*Math.sin(r+d*o)*Math.sin(a+m*s),this.vertices.push(g),f.push(this.vertices.length-1),p.push(new e.Vector2(d,1-m))}h.push(f),u.push(p)}for(c=0;c<this.heightSegments;c++)for(l=0;l<this.widthSegments;l++){var i=h[c][l+1],n=h[c][l],r=h[c+1][l],o=h[c+1][l+1],a=this.vertices[i].clone().normalize(),s=this.vertices[n].clone().normalize(),f=this.vertices[r].clone().normalize(),p=this.vertices[o].clone().normalize(),d=u[c][l+1].clone(),m=u[c][l].clone(),g=u[c+1][l].clone(),v=u[c+1][l+1].clone();Math.abs(this.vertices[i].y)===this.radius?(this.faces.push(new e.Face3(i,r,o,[a,f,p])),this.faceVertexUvs[0].push([d,g,v])):Math.abs(this.vertices[r].y)===this.radius?(this.faces.push(new e.Face3(i,n,r,[a,s,f])),this.faceVertexUvs[0].push([d,m,g])):(this.faces.push(new e.Face4(i,n,r,o,[a,s,f,p])),this.faceVertexUvs[0].push([d,m,g,v]))}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new e.Sphere(new e.Vector3,t)},e.SphereGeometry.prototype=Object.create(e.Geometry.prototype),e.TextGeometry=function(t,i){var i=i||{},n=e.FontUtils.generateShapes(t,i);i.amount=void 0!==i.height?i.height:50,void 0===i.bevelThickness&&(i.bevelThickness=10),void 0===i.bevelSize&&(i.bevelSize=8),void 0===i.bevelEnabled&&(i.bevelEnabled=!1),e.ExtrudeGeometry.call(this,n,i)},e.TextGeometry.prototype=Object.create(e.ExtrudeGeometry.prototype),e.TorusGeometry=function(t,i,n,r,o){for(e.Geometry.call(this),this.radius=t||100,this.tube=i||40,this.radialSegments=n||8,this.tubularSegments=r||6,this.arc=o||2*Math.PI,o=new e.Vector3,t=[],i=[],n=0;n<=this.radialSegments;n++)for(r=0;r<=this.tubularSegments;r++){var a=r/this.tubularSegments*this.arc,s=2*n/this.radialSegments*Math.PI;o.x=this.radius*Math.cos(a),o.y=this.radius*Math.sin(a);var l=new e.Vector3;l.x=(this.radius+this.tube*Math.cos(s))*Math.cos(a),l.y=(this.radius+this.tube*Math.cos(s))*Math.sin(a),l.z=this.tube*Math.sin(s),this.vertices.push(l),t.push(new e.Vector2(r/this.tubularSegments,n/this.radialSegments)),i.push(l.clone().sub(o).normalize())}for(n=1;n<=this.radialSegments;n++)for(r=1;r<=this.tubularSegments;r++){var o=(this.tubularSegments+1)*n+r-1,a=(this.tubularSegments+1)*(n-1)+r-1,s=(this.tubularSegments+1)*(n-1)+r,l=(this.tubularSegments+1)*n+r,c=new e.Face4(o,a,s,l,[i[o],i[a],i[s],i[l]]);c.normal.add(i[o]),c.normal.add(i[a]),c.normal.add(i[s]),c.normal.add(i[l]),c.normal.normalize(),this.faces.push(c),this.faceVertexUvs[0].push([t[o].clone(),t[a].clone(),t[s].clone(),t[l].clone()])}this.computeCentroids()},e.TorusGeometry.prototype=Object.create(e.Geometry.prototype),e.TorusKnotGeometry=function(t,i,n,r,o,a,s){function l(t,i,n,r,o,a){var s=Math.cos(t);return Math.cos(i),i=Math.sin(t),t*=n/r,n=Math.cos(t),s*=.5*o*(2+n),i=.5*o*(2+n)*i,o=.5*a*o*Math.sin(t),new e.Vector3(s,i,o)}for(e.Geometry.call(this),this.radius=t||100,this.tube=i||40,this.radialSegments=n||64,this.tubularSegments=r||8,this.p=o||2,this.q=a||3,this.heightScale=s||1,this.grid=Array(this.radialSegments),n=new e.Vector3,r=new e.Vector3,o=new e.Vector3,t=0;t<this.radialSegments;++t)for(this.grid[t]=Array(this.tubularSegments),i=0;i<this.tubularSegments;++i){var c=2*(t/this.radialSegments)*this.p*Math.PI,s=2*(i/this.tubularSegments)*Math.PI,a=l(c,s,this.q,this.p,this.radius,this.heightScale),c=l(c+.01,s,this.q,this.p,this.radius,this.heightScale);n.subVectors(c,a),r.addVectors(c,a),o.crossVectors(n,r),r.crossVectors(o,n),o.normalize(),r.normalize(),c=-this.tube*Math.cos(s),s=this.tube*Math.sin(s),a.x+=c*r.x+s*o.x,a.y+=c*r.y+s*o.y,a.z+=c*r.z+s*o.z,this.grid[t][i]=this.vertices.push(new e.Vector3(a.x,a.y,a.z))-1}for(t=0;t<this.radialSegments;++t)for(i=0;i<this.tubularSegments;++i){var o=(t+1)%this.radialSegments,a=(i+1)%this.tubularSegments,n=this.grid[t][i],r=this.grid[o][i],o=this.grid[o][a],a=this.grid[t][a],s=new e.Vector2(t/this.radialSegments,i/this.tubularSegments),c=new e.Vector2((t+1)/this.radialSegments,i/this.tubularSegments),h=new e.Vector2((t+1)/this.radialSegments,(i+1)/this.tubularSegments),u=new e.Vector2(t/this.radialSegments,(i+1)/this.tubularSegments);this.faces.push(new e.Face4(n,r,o,a)),this.faceVertexUvs[0].push([s,c,h,u])}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},e.TorusKnotGeometry.prototype=Object.create(e.Geometry.prototype),e.TubeGeometry=function(t,i,n,r,o,a){e.Geometry.call(this),this.path=t,this.segments=i||64,this.radius=n||1,this.radiusSegments=r||8,this.closed=o||!1,a&&(this.debug=new e.Object3D),this.grid=[];var s,l,c,h,u,f,p,d,o=this.segments+1,a=new e.Vector3,i=new e.TubeGeometry.FrenetFrames(this.path,this.segments,this.closed);for(f=i.tangents,p=i.normals,d=i.binormals,this.tangents=f,this.normals=p,this.binormals=d,i=0;o>i;i++)for(this.grid[i]=[],r=i/(o-1),u=t.getPointAt(r),r=f[i],s=p[i],l=d[i],this.debug&&(this.debug.add(new e.ArrowHelper(r,u,n,255)),this.debug.add(new e.ArrowHelper(s,u,n,16711680)),this.debug.add(new e.ArrowHelper(l,u,n,65280))),r=0;r<this.radiusSegments;r++)c=2*(r/this.radiusSegments)*Math.PI,h=-this.radius*Math.cos(c),c=this.radius*Math.sin(c),a.copy(u),a.x+=h*s.x+c*l.x,a.y+=h*s.y+c*l.y,a.z+=h*s.z+c*l.z,this.grid[i][r]=this.vertices.push(new e.Vector3(a.x,a.y,a.z))-1;for(i=0;i<this.segments;i++)for(r=0;r<this.radiusSegments;r++)o=this.closed?(i+1)%this.segments:i+1,a=(r+1)%this.radiusSegments,t=this.grid[i][r],n=this.grid[o][r],o=this.grid[o][a],a=this.grid[i][a],f=new e.Vector2(i/this.segments,r/this.radiusSegments),p=new e.Vector2((i+1)/this.segments,r/this.radiusSegments),d=new e.Vector2((i+1)/this.segments,(r+1)/this.radiusSegments),s=new e.Vector2(i/this.segments,(r+1)/this.radiusSegments),this.faces.push(new e.Face4(t,n,o,a)),this.faceVertexUvs[0].push([f,p,d,s]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},e.TubeGeometry.prototype=Object.create(e.Geometry.prototype),e.TubeGeometry.FrenetFrames=function(t,i,n){new e.Vector3;var r=new e.Vector3;new e.Vector3;var o,a,s,l=[],c=[],h=[],u=new e.Vector3,f=new e.Matrix4,i=i+1;for(this.tangents=l,this.normals=c,this.binormals=h,o=0;i>o;o++)a=o/(i-1),l[o]=t.getTangentAt(a),l[o].normalize();for(c[0]=new e.Vector3,h[0]=new e.Vector3,t=Number.MAX_VALUE,o=Math.abs(l[0].x),a=Math.abs(l[0].y),s=Math.abs(l[0].z),t>=o&&(t=o,r.set(1,0,0)),t>=a&&(t=a,r.set(0,1,0)),t>=s&&r.set(0,0,1),u.crossVectors(l[0],r).normalize(),c[0].crossVectors(l[0],u),h[0].crossVectors(l[0],c[0]),o=1;i>o;o++)c[o]=c[o-1].clone(),h[o]=h[o-1].clone(),u.crossVectors(l[o-1],l[o]),1e-4<u.length()&&(u.normalize(),r=Math.acos(l[o-1].dot(l[o])),c[o].applyMatrix4(f.makeRotationAxis(u,r))),h[o].crossVectors(l[o],c[o]);if(n)for(r=Math.acos(c[0].dot(c[i-1])),r/=i-1,0<l[0].dot(u.crossVectors(c[0],c[i-1]))&&(r=-r),o=1;i>o;o++)c[o].applyMatrix4(f.makeRotationAxis(l[o],r*o)),h[o].crossVectors(l[o],c[o])},e.PolyhedronGeometry=function(t,i,n,r){function o(t){var i=t.normalize().clone();i.index=l.vertices.push(i)-1;var n=Math.atan2(t.z,-t.x)/2/Math.PI+.5,t=Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5;return i.uv=new e.Vector2(n,1-t),i}function a(t,i,n){var r=new e.Face3(t.index,i.index,n.index,[t.clone(),i.clone(),n.clone()]);r.centroid.add(t).add(i).add(n).divideScalar(3),r.normal.copy(r.centroid).normalize(),l.faces.push(r),r=Math.atan2(r.centroid.z,-r.centroid.x),l.faceVertexUvs[0].push([s(t.uv,t,r),s(i.uv,i,r),s(n.uv,n,r)])}function s(t,i,n){return 0>n&&1===t.x&&(t=new e.Vector2(t.x-1,t.y)),0===i.x&&0===i.z&&(t=new e.Vector2(n/2/Math.PI+.5,t.y)),t.clone()}e.Geometry.call(this);for(var n=n||1,r=r||0,l=this,c=0,h=t.length;h>c;c++)o(new e.Vector3(t[c][0],t[c][1],t[c][2]));for(var u=this.vertices,t=[],c=0,h=i.length;h>c;c++){var f=u[i[c][0]],p=u[i[c][1]],d=u[i[c][2]];t[c]=new e.Face3(f.index,p.index,d.index,[f.clone(),p.clone(),d.clone()])}for(c=0,h=t.length;h>c;c++){p=t[c],u=r,i=Math.pow(2,u),Math.pow(4,u);for(var u=o(l.vertices[p.a]),f=o(l.vertices[p.b]),m=o(l.vertices[p.c]),p=[],d=0;i>=d;d++){p[d]=[];for(var g=o(u.clone().lerp(m,d/i)),v=o(f.clone().lerp(m,d/i)),y=i-d,b=0;y>=b;b++)p[d][b]=0==b&&d==i?g:o(g.clone().lerp(v,b/y))}for(d=0;i>d;d++)for(b=0;2*(i-d)-1>b;b++)u=Math.floor(b/2),0==b%2?a(p[d][u+1],p[d+1][u],p[d][u]):a(p[d][u+1],p[d+1][u+1],p[d+1][u])}for(c=0,h=this.faceVertexUvs[0].length;h>c;c++)r=this.faceVertexUvs[0][c],t=r[0].x,i=r[1].x,u=r[2].x,f=Math.max(t,Math.max(i,u)),p=Math.min(t,Math.min(i,u)),f>.9&&.1>p&&(.2>t&&(r[0].x+=1),.2>i&&(r[1].x+=1),.2>u&&(r[2].x+=1));for(this.mergeVertices(),c=0,h=this.vertices.length;h>c;c++)this.vertices[c].multiplyScalar(n);this.computeCentroids(),this.boundingSphere=new e.Sphere(new e.Vector3,n)},e.PolyhedronGeometry.prototype=Object.create(e.Geometry.prototype),e.IcosahedronGeometry=function(t,i){this.radius=t,this.detail=i;var n=(1+Math.sqrt(5))/2;e.PolyhedronGeometry.call(this,[[-1,n,0],[1,n,0],[-1,-n,0],[1,-n,0],[0,-1,n],[0,1,n],[0,-1,-n],[0,1,-n],[n,0,-1],[n,0,1],[-n,0,-1],[-n,0,1]],[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]],t,i)},e.IcosahedronGeometry.prototype=Object.create(e.Geometry.prototype),e.OctahedronGeometry=function(t,i){e.PolyhedronGeometry.call(this,[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]],t,i)},e.OctahedronGeometry.prototype=Object.create(e.Geometry.prototype),e.TetrahedronGeometry=function(t,i){e.PolyhedronGeometry.call(this,[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]],[[2,1,0],[0,3,2],[1,3,0],[2,3,1]],t,i)},e.TetrahedronGeometry.prototype=Object.create(e.Geometry.prototype),e.ParametricGeometry=function(t,i,n,r){e.Geometry.call(this);var o,a,s,l,c=this.vertices,h=this.faces,u=this.faceVertexUvs[0],r=void 0===r?!1:r,f=i+1;for(o=0;n>=o;o++)for(l=o/n,a=0;i>=a;a++)s=a/i,s=t(s,l),c.push(s);var p,d,m,g;for(o=0;n>o;o++)for(a=0;i>a;a++)t=o*f+a,c=o*f+a+1,l=(o+1)*f+a,s=(o+1)*f+a+1,p=new e.Vector2(a/i,o/n),d=new e.Vector2((a+1)/i,o/n),m=new e.Vector2(a/i,(o+1)/n),g=new e.Vector2((a+1)/i,(o+1)/n),r?(h.push(new e.Face3(t,c,l)),h.push(new e.Face3(c,s,l)),u.push([p,d,m]),u.push([d,g,m])):(h.push(new e.Face4(t,c,s,l)),u.push([p,d,g,m]));this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},e.ParametricGeometry.prototype=Object.create(e.Geometry.prototype),e.ConvexGeometry=function(t){function i(t){var i=t.length();return new e.Vector2(t.x/i,t.y/i)}e.Geometry.call(this);for(var n=[[0,1,2],[0,2,1]],r=3;r<t.length;r++){var o=r,a=t[o].clone(),s=a.length();a.x+=2e-6*s*(Math.random()-.5),a.y+=2e-6*s*(Math.random()-.5),a.z+=2e-6*s*(Math.random()-.5);for(var s=[],l=0;l<n.length;){var c,h=n[l],u=a,f=t[h[0]];c=f;var p=t[h[1]],d=t[h[2]],m=new e.Vector3,g=new e.Vector3;if(m.subVectors(d,p),g.subVectors(c,p),m.cross(g),m.normalize(),c=m,f=c.dot(f),c.dot(u)>=f){for(u=0;3>u;u++){for(f=[h[u],h[(u+1)%3]],c=!0,p=0;p<s.length;p++)if(s[p][0]===f[1]&&s[p][1]===f[0]){s[p]=s[s.length-1],s.pop(),c=!1;break}c&&s.push(f)}n[l]=n[n.length-1],n.pop()}else l++}for(p=0;p<s.length;p++)n.push([s[p][0],s[p][1],o])}for(o=0,a=Array(t.length),r=0;r<n.length;r++)for(s=n[r],l=0;3>l;l++)void 0===a[s[l]]&&(a[s[l]]=o++,this.vertices.push(t[s[l]])),s[l]=a[s[l]];for(r=0;r<n.length;r++)this.faces.push(new e.Face3(n[r][0],n[r][1],n[r][2]));for(r=0;r<this.faces.length;r++)s=this.faces[r],this.faceVertexUvs[0].push([i(this.vertices[s.a]),i(this.vertices[s.b]),i(this.vertices[s.c])]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},e.ConvexGeometry.prototype=Object.create(e.Geometry.prototype),e.AxisHelper=function(t){var t=t||1,i=new e.Geometry;i.vertices.push(new e.Vector3,new e.Vector3(t,0,0),new e.Vector3,new e.Vector3(0,t,0),new e.Vector3,new e.Vector3(0,0,t)),i.colors.push(new e.Color(16711680),new e.Color(16755200),new e.Color(65280),new e.Color(11206400),new e.Color(255),new e.Color(43775)),t=new e.LineBasicMaterial({vertexColors:e.VertexColors}),e.Line.call(this,i,t,e.LinePieces)},e.AxisHelper.prototype=Object.create(e.Line.prototype),e.ArrowHelper=function(t,i,n,r){e.Object3D.call(this),void 0===r&&(r=16776960),void 0===n&&(n=1),this.position=i,this.useQuaternion=!0,i=new e.Geometry,i.vertices.push(new e.Vector3(0,0,0)),i.vertices.push(new e.Vector3(0,1,0)),this.line=new e.Line(i,new e.LineBasicMaterial({color:r})),this.line.matrixAutoUpdate=!1,this.add(this.line),i=new e.CylinderGeometry(0,.05,.25,5,1),i.applyMatrix((new e.Matrix4).makeTranslation(0,.875,0)),this.cone=new e.Mesh(i,new e.MeshBasicMaterial({color:r})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(n)},e.ArrowHelper.prototype=Object.create(e.Object3D.prototype),e.ArrowHelper.prototype.setDirection=function(){var t,i=new e.Vector3;return function(e){.999<e.y?this.quaternion.set(0,0,0,1):-.999>e.y?this.quaternion.set(1,0,0,0):(i.set(e.z,0,-e.x).normalize(),t=Math.acos(e.y),this.quaternion.setFromAxisAngle(i,t))}}(),e.ArrowHelper.prototype.setLength=function(e){this.scale.set(e,e,e)},e.ArrowHelper.prototype.setColor=function(e){this.line.material.color.setHex(e),this.cone.material.color.setHex(e)},e.BoxHelper=function(t){var t=t||1,i=new e.Geometry,t=[new e.Vector3(t,t,t),new e.Vector3(-t,t,t),new e.Vector3(-t,-t,t),new e.Vector3(t,-t,t),new e.Vector3(t,t,-t),new e.Vector3(-t,t,-t),new e.Vector3(-t,-t,-t),new e.Vector3(t,-t,-t)];i.vertices.push(t[0],t[1],t[1],t[2],t[2],t[3],t[3],t[0],t[4],t[5],t[5],t[6],t[6],t[7],t[7],t[4],t[0],t[4],t[1],t[5],t[2],t[6],t[3],t[7]),this.vertices=t,e.Line.call(this,i,new e.LineBasicMaterial,e.LinePieces)},e.BoxHelper.prototype=Object.create(e.Line.prototype),e.BoxHelper.prototype.update=function(e){var t=e.geometry;null===t.boundingBox&&t.computeBoundingBox();var i=t.boundingBox.min,t=t.boundingBox.max,n=this.vertices;n[0].set(t.x,t.y,t.z),n[1].set(i.x,t.y,t.z),n[2].set(i.x,i.y,t.z),n[3].set(t.x,i.y,t.z),n[4].set(t.x,t.y,i.z),n[5].set(i.x,t.y,i.z),n[6].set(i.x,i.y,i.z),n[7].set(t.x,i.y,i.z),this.geometry.computeBoundingSphere(),this.geometry.verticesNeedUpdate=!0,this.matrixAutoUpdate=!1,this.matrixWorld=e.matrixWorld},e.CameraHelper=function(t){function i(e,t,i){n(e,i),n(t,i)}function n(t,i){r.vertices.push(new e.Vector3),r.colors.push(new e.Color(i)),void 0===a[t]&&(a[t]=[]),a[t].push(r.vertices.length-1)}e.Line.call(this);var r=new e.Geometry,o=new e.LineBasicMaterial({color:16777215,vertexColors:e.FaceColors}),a={};i("n1","n2",16755200),i("n2","n4",16755200),i("n4","n3",16755200),i("n3","n1",16755200),i("f1","f2",16755200),i("f2","f4",16755200),i("f4","f3",16755200),i("f3","f1",16755200),i("n1","f1",16755200),i("n2","f2",16755200),i("n3","f3",16755200),i("n4","f4",16755200),i("p","n1",16711680),i("p","n2",16711680),i("p","n3",16711680),i("p","n4",16711680),i("u1","u2",43775),i("u2","u3",43775),i("u3","u1",43775),i("c","t",16777215),i("p","c",3355443),i("cn1","cn2",3355443),i("cn3","cn4",3355443),i("cf1","cf2",3355443),i("cf3","cf4",3355443),e.Line.call(this,r,o,e.LinePieces),this.camera=t,this.matrixWorld=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()},e.CameraHelper.prototype=Object.create(e.Line.prototype),e.CameraHelper.prototype.update=function(){var t=new e.Vector3,i=new e.Camera,n=new e.Projector;return function(){function e(e,o,a,s){if(t.set(o,a,s),n.unprojectVector(t,i),e=r.pointMap[e],void 0!==e)for(o=0,a=e.length;a>o;o++)r.geometry.vertices[e[o]].copy(t)}var r=this;i.projectionMatrix.copy(this.camera.projectionMatrix),e("c",0,0,-1),e("t",0,0,1),e("n1",-1,-1,-1),e("n2",1,-1,-1),e("n3",-1,1,-1),e("n4",1,1,-1),e("f1",-1,-1,1),e("f2",1,-1,1),e("f3",-1,1,1),e("f4",1,1,1),e("u1",.7,1.1,-1),e("u2",-.7,1.1,-1),e("u3",0,2,-1),e("cf1",-1,0,1),e("cf2",1,0,1),e("cf3",0,-1,1),e("cf4",0,1,1),e("cn1",-1,0,-1),e("cn2",1,0,-1),e("cn3",0,-1,-1),e("cn4",0,1,-1),this.geometry.verticesNeedUpdate=!0}}(),e.DirectionalLightHelper=function(t,i){e.Object3D.call(this),this.matrixAutoUpdate=!1,this.light=t;var n=new e.SphereGeometry(i,4,2),r=new e.MeshBasicMaterial({fog:!1,wireframe:!0});r.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightSphere=new e.Mesh(n,r),this.lightSphere.matrixWorld=this.light.matrixWorld,this.lightSphere.matrixAutoUpdate=!1,this.add(this.lightSphere),n=new e.Geometry,n.vertices.push(this.light.position),n.vertices.push(this.light.target.position),n.computeLineDistances(),r=new e.LineDashedMaterial({dashSize:4,gapSize:4,opacity:.75,transparent:!0,fog:!1}),r.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new e.Line(n,r),this.add(this.targetLine)},e.DirectionalLightHelper.prototype=Object.create(e.Object3D.prototype),e.DirectionalLightHelper.prototype.update=function(){this.lightSphere.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.computeLineDistances(),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},e.GridHelper=function(t,i){for(var n=new e.Geometry,r=new e.LineBasicMaterial({vertexColors:e.VertexColors}),o=new e.Color(4473924),a=new e.Color(8947848),s=-t;t>=s;s+=i){n.vertices.push(new e.Vector3(-t,0,s)),n.vertices.push(new e.Vector3(t,0,s)),n.vertices.push(new e.Vector3(s,0,-t)),n.vertices.push(new e.Vector3(s,0,t));var l=0===s?o:a;n.colors.push(l,l,l,l)}e.Line.call(this,n,r,e.LinePieces)},e.GridHelper.prototype=Object.create(e.Line.prototype),e.HemisphereLightHelper=function(t,i){e.Object3D.call(this),this.light=t;var n=new e.SphereGeometry(i,4,2);n.applyMatrix((new e.Matrix4).makeRotationX(-Math.PI/2));for(var r=0;8>r;r++)n.faces[r].materialIndex=4>r?0:1;r=new e.MeshBasicMaterial({fog:!1,wireframe:!0}),r.color.copy(t.color).multiplyScalar(t.intensity);var o=new e.MeshBasicMaterial({fog:!1,wireframe:!0});o.color.copy(t.groundColor).multiplyScalar(t.intensity),this.lightSphere=new e.Mesh(n,new e.MeshFaceMaterial([r,o])),this.lightSphere.position=t.position,this.lightSphere.lookAt(new e.Vector3),this.add(this.lightSphere)},e.HemisphereLightHelper.prototype=Object.create(e.Object3D.prototype),e.HemisphereLightHelper.prototype.update=function(){this.lightSphere.lookAt(new e.Vector3),this.lightSphere.material.materials[0].color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightSphere.material.materials[1].color.copy(this.light.groundColor).multiplyScalar(this.light.intensity)},e.PointLightHelper=function(t,i){e.Object3D.call(this),this.matrixAutoUpdate=!1,this.light=t;var n=new e.SphereGeometry(i,4,2),r=new e.MeshBasicMaterial({fog:!1,wireframe:!0});r.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightSphere=new e.Mesh(n,r),this.lightSphere.matrixWorld=this.light.matrixWorld,this.lightSphere.matrixAutoUpdate=!1,this.add(this.lightSphere)},e.PointLightHelper.prototype=Object.create(e.Object3D.prototype),e.PointLightHelper.prototype.update=function(){this.lightSphere.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},e.SpotLightHelper=function(t,i){e.Object3D.call(this),this.matrixAutoUpdate=!1,this.light=t;var n=new e.SphereGeometry(i,4,2),r=new e.MeshBasicMaterial({fog:!1,wireframe:!0});r.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightSphere=new e.Mesh(n,r),this.lightSphere.matrixWorld=this.light.matrixWorld,this.lightSphere.matrixAutoUpdate=!1,this.add(this.lightSphere),n=new e.CylinderGeometry(1e-4,1,1,8,1,!0),n.applyMatrix((new e.Matrix4).makeTranslation(0,-.5,0)),n.applyMatrix((new e.Matrix4).makeRotationX(-Math.PI/2)),r=new e.MeshBasicMaterial({fog:!1,wireframe:!0,opacity:.3,transparent:!0}),r.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightCone=new e.Mesh(n,r),this.lightCone.position=this.light.position,n=t.distance?t.distance:1e4,r=n*Math.tan(t.angle),this.lightCone.scale.set(r,r,n),this.lightCone.lookAt(this.light.target.position),this.add(this.lightCone)},e.SpotLightHelper.prototype=Object.create(e.Object3D.prototype),e.SpotLightHelper.prototype.update=function(){var e=this.light.distance?this.light.distance:1e4,t=e*Math.tan(this.light.angle);this.lightCone.scale.set(t,t,e),this.lightCone.lookAt(this.light.target.position),this.lightSphere.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightCone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},e.ImmediateRenderObject=function(){e.Object3D.call(this),this.render=function(){}},e.ImmediateRenderObject.prototype=Object.create(e.Object3D.prototype),e.LensFlare=function(t,i,n,r,o){e.Object3D.call(this),this.lensFlares=[],this.positionScreen=new e.Vector3,this.customUpdateCallback=void 0,void 0!==t&&this.add(t,i,n,r,o)},e.LensFlare.prototype=Object.create(e.Object3D.prototype),e.LensFlare.prototype.add=function(t,i,n,r,o,a){void 0===i&&(i=-1),void 0===n&&(n=0),void 0===a&&(a=1),void 0===o&&(o=new e.Color(16777215)),void 0===r&&(r=e.NormalBlending),n=Math.min(n,Math.max(0,n)),this.lensFlares.push({texture:t,size:i,distance:n,x:0,y:0,z:0,scale:1,rotation:1,opacity:a,color:o,blending:r})},e.LensFlare.prototype.updateLensFlares=function(){var e,t,i=this.lensFlares.length,n=2*-this.positionScreen.x,r=2*-this.positionScreen.y;for(e=0;i>e;e++)t=this.lensFlares[e],t.x=this.positionScreen.x+n*t.distance,t.y=this.positionScreen.y+r*t.distance,t.wantedRotation=.25*t.x*Math.PI,t.rotation+=.25*(t.wantedRotation-t.rotation)},e.MorphBlendMesh=function(t,i){e.Mesh.call(this,t,i),this.animationsMap={},this.animationsList=[];var n=this.geometry.morphTargets.length;this.createAnimation("__default",0,n-1,n/1),this.setAnimationWeight("__default",1)},e.MorphBlendMesh.prototype=Object.create(e.Mesh.prototype),e.MorphBlendMesh.prototype.createAnimation=function(e,t,i,n){t={startFrame:t,endFrame:i,length:i-t+1,fps:n,duration:(i-t)/n,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1},this.animationsMap[e]=t,this.animationsList.push(t)},e.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t,i=/([a-z]+)(\d+)/,n={},r=this.geometry,o=0,a=r.morphTargets.length;a>o;o++){var s=r.morphTargets[o].name.match(i);if(s&&1<s.length){var l=s[1];n[l]||(n[l]={start:1/0,end:-1/0}),s=n[l],o<s.start&&(s.start=o),o>s.end&&(s.end=o),t||(t=l)}}for(l in n)s=n[l],this.createAnimation(l,s.start,s.end,e);this.firstAnimation=t},e.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){(e=this.animationsMap[e])&&(e.direction=1,e.directionBackwards=!1)},e.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){(e=this.animationsMap[e])&&(e.direction=-1,e.directionBackwards=!0)},e.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var i=this.animationsMap[e];i&&(i.fps=t,i.duration=(i.end-i.start)/i.fps)},e.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var i=this.animationsMap[e];i&&(i.duration=t,i.fps=(i.end-i.start)/i.duration)},e.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var i=this.animationsMap[e];i&&(i.weight=t)},e.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var i=this.animationsMap[e];i&&(i.time=t)},e.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0;return(e=this.animationsMap[e])&&(t=e.time),t},e.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1;return(e=this.animationsMap[e])&&(t=e.duration),t},e.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("animation["+e+"] undefined")},e.MorphBlendMesh.prototype.stopAnimation=function(e){(e=this.animationsMap[e])&&(e.active=!1)},e.MorphBlendMesh.prototype.update=function(t){for(var i=0,n=this.animationsList.length;n>i;i++){var r=this.animationsList[i];if(r.active){var o=r.duration/r.length;r.time+=r.direction*t,r.mirroredLoop?(r.time>r.duration||0>r.time)&&(r.direction*=-1,r.time>r.duration&&(r.time=r.duration,r.directionBackwards=!0),0>r.time&&(r.time=0,r.directionBackwards=!1)):(r.time%=r.duration,0>r.time&&(r.time+=r.duration));var a=r.startFrame+e.Math.clamp(Math.floor(r.time/o),0,r.length-1),s=r.weight;a!==r.currentFrame&&(this.morphTargetInfluences[r.lastFrame]=0,this.morphTargetInfluences[r.currentFrame]=1*s,this.morphTargetInfluences[a]=0,r.lastFrame=r.currentFrame,r.currentFrame=a),o=r.time%o/o,r.directionBackwards&&(o=1-o),this.morphTargetInfluences[r.currentFrame]=o*s,this.morphTargetInfluences[r.lastFrame]=(1-o)*s}}},e.LensFlarePlugin=function(){function t(e,t){var n=i.createProgram(),r=i.createShader(i.FRAGMENT_SHADER),o=i.createShader(i.VERTEX_SHADER),a="precision "+t+" float;\n";return i.shaderSource(r,a+e.fragmentShader),i.shaderSource(o,a+e.vertexShader),i.compileShader(r),i.compileShader(o),i.attachShader(n,r),i.attachShader(n,o),i.linkProgram(n),n}var i,n,r,o,a,s,l,c,h,u,f,p,d;this.init=function(m){i=m.context,n=m,r=m.getPrecision(),o=new Float32Array(16),a=new Uint16Array(6),m=0,o[m++]=-1,o[m++]=-1,o[m++]=0,o[m++]=0,o[m++]=1,o[m++]=-1,o[m++]=1,o[m++]=0,o[m++]=1,o[m++]=1,o[m++]=1,o[m++]=1,o[m++]=-1,o[m++]=1,o[m++]=0,o[m++]=1,m=0,a[m++]=0,a[m++]=1,a[m++]=2,a[m++]=0,a[m++]=2,a[m++]=3,s=i.createBuffer(),l=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,s),i.bufferData(i.ARRAY_BUFFER,o,i.STATIC_DRAW),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,l),i.bufferData(i.ELEMENT_ARRAY_BUFFER,a,i.STATIC_DRAW),c=i.createTexture(),h=i.createTexture(),i.bindTexture(i.TEXTURE_2D,c),i.texImage2D(i.TEXTURE_2D,0,i.RGB,16,16,0,i.RGB,i.UNSIGNED_BYTE,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.bindTexture(i.TEXTURE_2D,h),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,16,16,0,i.RGBA,i.UNSIGNED_BYTE,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),0>=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS)?(u=!1,f=t(e.ShaderFlares.lensFlare,r)):(u=!0,f=t(e.ShaderFlares.lensFlareVertexTexture,r)),p={},d={},p.vertex=i.getAttribLocation(f,"position"),p.uv=i.getAttribLocation(f,"uv"),d.renderType=i.getUniformLocation(f,"renderType"),d.map=i.getUniformLocation(f,"map"),d.occlusionMap=i.getUniformLocation(f,"occlusionMap"),d.opacity=i.getUniformLocation(f,"opacity"),d.color=i.getUniformLocation(f,"color"),d.scale=i.getUniformLocation(f,"scale"),d.rotation=i.getUniformLocation(f,"rotation"),d.screenPosition=i.getUniformLocation(f,"screenPosition")},this.render=function(t,r,o,a){var t=t.__webglFlares,m=t.length;if(m){var g=new e.Vector3,v=a/o,y=.5*o,b=.5*a,x=16/a,w=new e.Vector2(x*v,x),_=new e.Vector3(1,1,0),S=new e.Vector2(1,1),M=d,x=p;i.useProgram(f),i.enableVertexAttribArray(p.vertex),i.enableVertexAttribArray(p.uv),i.uniform1i(M.occlusionMap,0),i.uniform1i(M.map,1),i.bindBuffer(i.ARRAY_BUFFER,s),i.vertexAttribPointer(x.vertex,2,i.FLOAT,!1,16,0),i.vertexAttribPointer(x.uv,2,i.FLOAT,!1,16,8),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,l),i.disable(i.CULL_FACE),i.depthMask(!1);var C,T,A,E,P;for(C=0;m>C;C++)if(x=16/a,w.set(x*v,x),E=t[C],g.set(E.matrixWorld.elements[12],E.matrixWorld.elements[13],E.matrixWorld.elements[14]),g.applyMatrix4(r.matrixWorldInverse),g.applyProjection(r.projectionMatrix),_.copy(g),S.x=_.x*y+y,S.y=_.y*b+b,u||0<S.x&&S.x<o&&0<S.y&&S.y<a)for(i.activeTexture(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,c),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGB,S.x-8,S.y-8,16,16,0),i.uniform1i(M.renderType,0),i.uniform2f(M.scale,w.x,w.y),i.uniform3f(M.screenPosition,_.x,_.y,_.z),i.disable(i.BLEND),i.enable(i.DEPTH_TEST),i.drawElements(i.TRIANGLES,6,i.UNSIGNED_SHORT,0),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,h),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,S.x-8,S.y-8,16,16,0),i.uniform1i(M.renderType,1),i.disable(i.DEPTH_TEST),i.activeTexture(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,c),i.drawElements(i.TRIANGLES,6,i.UNSIGNED_SHORT,0),E.positionScreen.copy(_),E.customUpdateCallback?E.customUpdateCallback(E):E.updateLensFlares(),i.uniform1i(M.renderType,2),i.enable(i.BLEND),T=0,A=E.lensFlares.length;A>T;T++)P=E.lensFlares[T],.001<P.opacity&&.001<P.scale&&(_.x=P.x,_.y=P.y,_.z=P.z,x=P.size*P.scale/a,w.x=x*v,w.y=x,i.uniform3f(M.screenPosition,_.x,_.y,_.z),i.uniform2f(M.scale,w.x,w.y),i.uniform1f(M.rotation,P.rotation),i.uniform1f(M.opacity,P.opacity),i.uniform3f(M.color,P.color.r,P.color.g,P.color.b),n.setBlending(P.blending,P.blendEquation,P.blendSrc,P.blendDst),n.setTexture(P.texture,1),i.drawElements(i.TRIANGLES,6,i.UNSIGNED_SHORT,0));i.enable(i.CULL_FACE),i.enable(i.DEPTH_TEST),i.depthMask(!0)}}},e.ShadowMapPlugin=function(){var t,i,n,r,o,a,s=new e.Frustum,l=new e.Matrix4,c=new e.Vector3,h=new e.Vector3,u=new e.Vector3;this.init=function(s){t=s.context,i=s;var s=e.ShaderLib.depthRGBA,l=e.UniformsUtils.clone(s.uniforms);n=new e.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:l}),r=new e.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:l,morphTargets:!0}),o=new e.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:l,skinning:!0}),a=new e.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:l,morphTargets:!0,skinning:!0}),n._shadowPass=!0,r._shadowPass=!0,o._shadowPass=!0,a._shadowPass=!0
},this.render=function(e,t){i.shadowMapEnabled&&i.shadowMapAutoUpdate&&this.update(e,t)},this.update=function(f,p){var d,m,g,v,y,b,x,w,_,S=[];for(v=0,t.clearColor(1,1,1,1),t.disable(t.BLEND),t.enable(t.CULL_FACE),t.frontFace(t.CCW),t.cullFace(i.shadowMapCullFace===e.CullFaceFront?t.FRONT:t.BACK),i.setDepthTest(!0),d=0,m=f.__lights.length;m>d;d++)if(g=f.__lights[d],g.castShadow)if(g instanceof e.DirectionalLight&&g.shadowCascade)for(y=0;y<g.shadowCascadeCount;y++){var M;if(g.shadowCascadeArray[y])M=g.shadowCascadeArray[y];else{_=g,x=y,M=new e.DirectionalLight,M.isVirtual=!0,M.onlyShadow=!0,M.castShadow=!0,M.shadowCameraNear=_.shadowCameraNear,M.shadowCameraFar=_.shadowCameraFar,M.shadowCameraLeft=_.shadowCameraLeft,M.shadowCameraRight=_.shadowCameraRight,M.shadowCameraBottom=_.shadowCameraBottom,M.shadowCameraTop=_.shadowCameraTop,M.shadowCameraVisible=_.shadowCameraVisible,M.shadowDarkness=_.shadowDarkness,M.shadowBias=_.shadowCascadeBias[x],M.shadowMapWidth=_.shadowCascadeWidth[x],M.shadowMapHeight=_.shadowCascadeHeight[x],M.pointsWorld=[],M.pointsFrustum=[],w=M.pointsWorld,b=M.pointsFrustum;for(var C=0;8>C;C++)w[C]=new e.Vector3,b[C]=new e.Vector3;w=_.shadowCascadeNearZ[x],_=_.shadowCascadeFarZ[x],b[0].set(-1,-1,w),b[1].set(1,-1,w),b[2].set(-1,1,w),b[3].set(1,1,w),b[4].set(-1,-1,_),b[5].set(1,-1,_),b[6].set(-1,1,_),b[7].set(1,1,_),M.originalCamera=p,b=new e.Gyroscope,b.position=g.shadowCascadeOffset,b.add(M),b.add(M.target),p.add(b),g.shadowCascadeArray[y]=M,console.log("Created virtualLight",M)}x=g,w=y,_=x.shadowCascadeArray[w],_.position.copy(x.position),_.target.position.copy(x.target.position),_.lookAt(_.target),_.shadowCameraVisible=x.shadowCameraVisible,_.shadowDarkness=x.shadowDarkness,_.shadowBias=x.shadowCascadeBias[w],b=x.shadowCascadeNearZ[w],x=x.shadowCascadeFarZ[w],_=_.pointsFrustum,_[0].z=b,_[1].z=b,_[2].z=b,_[3].z=b,_[4].z=x,_[5].z=x,_[6].z=x,_[7].z=x,S[v]=M,v++}else S[v]=g,v++;for(d=0,m=S.length;m>d;d++){if(g=S[d],g.shadowMap||(y=e.LinearFilter,i.shadowMapType===e.PCFSoftShadowMap&&(y=e.NearestFilter),g.shadowMap=new e.WebGLRenderTarget(g.shadowMapWidth,g.shadowMapHeight,{minFilter:y,magFilter:y,format:e.RGBAFormat}),g.shadowMapSize=new e.Vector2(g.shadowMapWidth,g.shadowMapHeight),g.shadowMatrix=new e.Matrix4),!g.shadowCamera){if(g instanceof e.SpotLight)g.shadowCamera=new e.PerspectiveCamera(g.shadowCameraFov,g.shadowMapWidth/g.shadowMapHeight,g.shadowCameraNear,g.shadowCameraFar);else{if(!(g instanceof e.DirectionalLight)){console.error("Unsupported light type for shadow");continue}g.shadowCamera=new e.OrthographicCamera(g.shadowCameraLeft,g.shadowCameraRight,g.shadowCameraTop,g.shadowCameraBottom,g.shadowCameraNear,g.shadowCameraFar)}f.add(g.shadowCamera),!0===f.autoUpdate&&f.updateMatrixWorld()}if(g.shadowCameraVisible&&!g.cameraHelper&&(g.cameraHelper=new e.CameraHelper(g.shadowCamera),g.shadowCamera.add(g.cameraHelper)),g.isVirtual&&M.originalCamera==p){for(y=p,v=g.shadowCamera,b=g.pointsFrustum,_=g.pointsWorld,c.set(1/0,1/0,1/0),h.set(-1/0,-1/0,-1/0),x=0;8>x;x++)w=_[x],w.copy(b[x]),e.ShadowMapPlugin.__projector.unprojectVector(w,y),w.applyMatrix4(v.matrixWorldInverse),w.x<c.x&&(c.x=w.x),w.x>h.x&&(h.x=w.x),w.y<c.y&&(c.y=w.y),w.y>h.y&&(h.y=w.y),w.z<c.z&&(c.z=w.z),w.z>h.z&&(h.z=w.z);v.left=c.x,v.right=h.x,v.top=h.y,v.bottom=c.y,v.updateProjectionMatrix()}for(v=g.shadowMap,b=g.shadowMatrix,y=g.shadowCamera,y.position.getPositionFromMatrix(g.matrixWorld),u.getPositionFromMatrix(g.target.matrixWorld),y.lookAt(u),y.updateMatrixWorld(),y.matrixWorldInverse.getInverse(y.matrixWorld),g.cameraHelper&&(g.cameraHelper.visible=g.shadowCameraVisible),g.shadowCameraVisible&&g.cameraHelper.update(),b.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),b.multiply(y.projectionMatrix),b.multiply(y.matrixWorldInverse),l.multiplyMatrices(y.projectionMatrix,y.matrixWorldInverse),s.setFromMatrix(l),i.setRenderTarget(v),i.clear(),_=f.__webglObjects,g=0,v=_.length;v>g;g++)x=_[g],b=x.object,x.render=!1,!b.visible||!b.castShadow||(b instanceof e.Mesh||b instanceof e.ParticleSystem)&&b.frustumCulled&&!s.intersectsObject(b)||(b._modelViewMatrix.multiplyMatrices(y.matrixWorldInverse,b.matrixWorld),x.render=!0);for(g=0,v=_.length;v>g;g++)x=_[g],x.render&&(b=x.object,x=x.buffer,C=b.material instanceof e.MeshFaceMaterial?b.material.materials[0]:b.material,w=0<b.geometry.morphTargets.length&&C.morphTargets,C=b instanceof e.SkinnedMesh&&C.skinning,w=b.customDepthMaterial?b.customDepthMaterial:C?w?a:o:w?r:n,x instanceof e.BufferGeometry?i.renderBufferDirect(y,f.__lights,null,w,x,b):i.renderBuffer(y,f.__lights,null,w,x,b));for(_=f.__webglObjectsImmediate,g=0,v=_.length;v>g;g++)x=_[g],b=x.object,b.visible&&b.castShadow&&(b._modelViewMatrix.multiplyMatrices(y.matrixWorldInverse,b.matrixWorld),i.renderImmediateObject(y,f.__lights,null,n,b))}d=i.getClearColor(),m=i.getClearAlpha(),t.clearColor(d.r,d.g,d.b,m),t.enable(t.BLEND),i.shadowMapCullFace===e.CullFaceFront&&t.cullFace(t.BACK)}},e.ShadowMapPlugin.__projector=new e.Projector,e.SpritePlugin=function(){function t(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}var i,n,r,o,a,s,l,c,h,u;this.init=function(t){i=t.context,n=t,r=t.getPrecision(),o=new Float32Array(16),a=new Uint16Array(6),t=0,o[t++]=-1,o[t++]=-1,o[t++]=0,o[t++]=0,o[t++]=1,o[t++]=-1,o[t++]=1,o[t++]=0,o[t++]=1,o[t++]=1,o[t++]=1,o[t++]=1,o[t++]=-1,o[t++]=1,o[t++]=0,o[t++]=1,t=0,a[t++]=0,a[t++]=1,a[t++]=2,a[t++]=0,a[t++]=2,a[t++]=3,s=i.createBuffer(),l=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,s),i.bufferData(i.ARRAY_BUFFER,o,i.STATIC_DRAW),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,l),i.bufferData(i.ELEMENT_ARRAY_BUFFER,a,i.STATIC_DRAW);var t=e.ShaderSprite.sprite,f=i.createProgram(),p=i.createShader(i.FRAGMENT_SHADER),d=i.createShader(i.VERTEX_SHADER),m="precision "+r+" float;\n";i.shaderSource(p,m+t.fragmentShader),i.shaderSource(d,m+t.vertexShader),i.compileShader(p),i.compileShader(d),i.attachShader(f,p),i.attachShader(f,d),i.linkProgram(f),c=f,h={},u={},h.position=i.getAttribLocation(c,"position"),h.uv=i.getAttribLocation(c,"uv"),u.uvOffset=i.getUniformLocation(c,"uvOffset"),u.uvScale=i.getUniformLocation(c,"uvScale"),u.rotation=i.getUniformLocation(c,"rotation"),u.scale=i.getUniformLocation(c,"scale"),u.alignment=i.getUniformLocation(c,"alignment"),u.color=i.getUniformLocation(c,"color"),u.map=i.getUniformLocation(c,"map"),u.opacity=i.getUniformLocation(c,"opacity"),u.useScreenCoordinates=i.getUniformLocation(c,"useScreenCoordinates"),u.sizeAttenuation=i.getUniformLocation(c,"sizeAttenuation"),u.screenPosition=i.getUniformLocation(c,"screenPosition"),u.modelViewMatrix=i.getUniformLocation(c,"modelViewMatrix"),u.projectionMatrix=i.getUniformLocation(c,"projectionMatrix"),u.fogType=i.getUniformLocation(c,"fogType"),u.fogDensity=i.getUniformLocation(c,"fogDensity"),u.fogNear=i.getUniformLocation(c,"fogNear"),u.fogFar=i.getUniformLocation(c,"fogFar"),u.fogColor=i.getUniformLocation(c,"fogColor"),u.alphaTest=i.getUniformLocation(c,"alphaTest")},this.render=function(r,o,a,f){var p=r.__webglSprites,d=p.length;if(d){var m=h,g=u,v=f/a,a=.5*a,y=.5*f;i.useProgram(c),i.enableVertexAttribArray(m.position),i.enableVertexAttribArray(m.uv),i.disable(i.CULL_FACE),i.enable(i.BLEND),i.bindBuffer(i.ARRAY_BUFFER,s),i.vertexAttribPointer(m.position,2,i.FLOAT,!1,16,0),i.vertexAttribPointer(m.uv,2,i.FLOAT,!1,16,8),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,l),i.uniformMatrix4fv(g.projectionMatrix,!1,o.projectionMatrix.elements),i.activeTexture(i.TEXTURE0),i.uniform1i(g.map,0);var b=m=0,x=r.fog;x?(i.uniform3f(g.fogColor,x.color.r,x.color.g,x.color.b),x instanceof e.Fog?(i.uniform1f(g.fogNear,x.near),i.uniform1f(g.fogFar,x.far),i.uniform1i(g.fogType,1),b=m=1):x instanceof e.FogExp2&&(i.uniform1f(g.fogDensity,x.density),i.uniform1i(g.fogType,2),b=m=2)):(i.uniform1i(g.fogType,0),b=m=0);for(var w,_,S=[],x=0;d>x;x++)w=p[x],_=w.material,w.visible&&0!==_.opacity&&(_.useScreenCoordinates?w.z=-w.position.z:(w._modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,w.matrixWorld),w.z=-w._modelViewMatrix.elements[14]));for(p.sort(t),x=0;d>x;x++)w=p[x],_=w.material,w.visible&&0!==_.opacity&&_.map&&_.map.image&&_.map.image.width&&(i.uniform1f(g.alphaTest,_.alphaTest),!0===_.useScreenCoordinates?(i.uniform1i(g.useScreenCoordinates,1),i.uniform3f(g.screenPosition,(w.position.x*n.devicePixelRatio-a)/a,(y-w.position.y*n.devicePixelRatio)/y,Math.max(0,Math.min(1,w.position.z))),S[0]=n.devicePixelRatio,S[1]=n.devicePixelRatio):(i.uniform1i(g.useScreenCoordinates,0),i.uniform1i(g.sizeAttenuation,_.sizeAttenuation?1:0),i.uniformMatrix4fv(g.modelViewMatrix,!1,w._modelViewMatrix.elements),S[0]=1,S[1]=1),o=r.fog&&_.fog?b:0,m!==o&&(i.uniform1i(g.fogType,o),m=o),o=1/(_.scaleByViewport?f:1),S[0]*=o*v*w.scale.x,S[1]*=o*w.scale.y,i.uniform2f(g.uvScale,_.uvScale.x,_.uvScale.y),i.uniform2f(g.uvOffset,_.uvOffset.x,_.uvOffset.y),i.uniform2f(g.alignment,_.alignment.x,_.alignment.y),i.uniform1f(g.opacity,_.opacity),i.uniform3f(g.color,_.color.r,_.color.g,_.color.b),i.uniform1f(g.rotation,w.rotation),i.uniform2fv(g.scale,S),n.setBlending(_.blending,_.blendEquation,_.blendSrc,_.blendDst),n.setDepthTest(_.depthTest),n.setDepthWrite(_.depthWrite),n.setTexture(_.map,0),i.drawElements(i.TRIANGLES,6,i.UNSIGNED_SHORT,0));i.enable(i.CULL_FACE)}}},e.DepthPassPlugin=function(){this.enabled=!1,this.renderTarget=null;var t,i,n,r,o,a,s=new e.Frustum,l=new e.Matrix4;this.init=function(s){t=s.context,i=s;var s=e.ShaderLib.depthRGBA,l=e.UniformsUtils.clone(s.uniforms);n=new e.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:l}),r=new e.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:l,morphTargets:!0}),o=new e.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:l,skinning:!0}),a=new e.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:l,morphTargets:!0,skinning:!0}),n._shadowPass=!0,r._shadowPass=!0,o._shadowPass=!0,a._shadowPass=!0},this.render=function(e,t){this.enabled&&this.update(e,t)},this.update=function(c,h){var u,f,p,d,m,g;for(t.clearColor(1,1,1,1),t.disable(t.BLEND),i.setDepthTest(!0),!0===c.autoUpdate&&c.updateMatrixWorld(),h.matrixWorldInverse.getInverse(h.matrixWorld),l.multiplyMatrices(h.projectionMatrix,h.matrixWorldInverse),s.setFromMatrix(l),i.setRenderTarget(this.renderTarget),i.clear(),g=c.__webglObjects,u=0,f=g.length;f>u;u++)p=g[u],m=p.object,p.render=!1,!m.visible||(m instanceof e.Mesh||m instanceof e.ParticleSystem)&&m.frustumCulled&&!s.intersectsObject(m)||(m._modelViewMatrix.multiplyMatrices(h.matrixWorldInverse,m.matrixWorld),p.render=!0);var v;for(u=0,f=g.length;f>u;u++)p=g[u],!p.render||(m=p.object,p=p.buffer,m instanceof e.ParticleSystem&&!m.customDepthMaterial)||((v=m.material instanceof e.MeshFaceMaterial?m.material.materials[0]:m.material)&&i.setMaterialFaces(m.material),d=0<m.geometry.morphTargets.length&&v.morphTargets,v=m instanceof e.SkinnedMesh&&v.skinning,d=m.customDepthMaterial?m.customDepthMaterial:v?d?a:o:d?r:n,p instanceof e.BufferGeometry?i.renderBufferDirect(h,c.__lights,null,d,p,m):i.renderBuffer(h,c.__lights,null,d,p,m));for(g=c.__webglObjectsImmediate,u=0,f=g.length;f>u;u++)p=g[u],m=p.object,m.visible&&(m._modelViewMatrix.multiplyMatrices(h.matrixWorldInverse,m.matrixWorld),i.renderImmediateObject(h,c.__lights,null,n,m));u=i.getClearColor(),f=i.getClearAlpha(),t.clearColor(u.r,u.g,u.b,f),t.enable(t.BLEND)}},e.ShaderFlares={lensFlareVertexTexture:{vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.1, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility = (       visibility.r / 9.0 ) *\n( 1.0 - visibility.g / 9.0 ) *\n(       visibility.b / 9.0 ) *\n( 1.0 - visibility.a / 9.0 );\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"uniform lowp int renderType;\nuniform sampler2D map;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"},lensFlare:{vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"precision mediump float;\nuniform lowp int renderType;\nuniform sampler2D map;\nuniform sampler2D occlusionMap;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * visibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"}},e.ShaderSprite={sprite:{vertexShader:"uniform int useScreenCoordinates;\nuniform int sizeAttenuation;\nuniform vec3 screenPosition;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 alignment;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position + alignment;\nvec2 rotatedPosition;\nrotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;\nrotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;\nvec4 finalPosition;\nif( useScreenCoordinates != 0 ) {\nfinalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );\n} else {\nfinalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition * ( sizeAttenuation == 1 ? 1.0 : finalPosition.z );\n}\ngl_Position = finalPosition;\n}",fragmentShader:"uniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nuniform int fogType;\nuniform vec3 fogColor;\nuniform float fogDensity;\nuniform float fogNear;\nuniform float fogFar;\nuniform float alphaTest;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\nif ( texture.a < alphaTest ) discard;\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\nif ( fogType > 0 ) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = 0.0;\nif ( fogType == 1 ) {\nfogFactor = smoothstep( fogNear, fogFar, depth );\n} else {\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n}\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}\n}"}},t.exports=e}()},{}],49:[function(e,t){t.exports=function(e,t){"use strict";var i,n,r=e.dollar,o=function(){return i};return o.export=function(e){e.Canvas=i.Canvas},i={initialized:!1,canvasObject:null,canvas:null,container:null,_update:function(){this.initialized&&this.canvasObject&&this.canvasObject._update()},hide:function(){this.canvas&&this.canvasObject.hide()},remove:function(){this.canvasObject&&this.canvasObject.remove()},removeCameraAndLights:function(){this.scene.remove(this.camera),this.scene.remove(this.pointLight),this.scene.remove(this.pointLight2),this.scene.add(this.ambientLight),this.camera=null,this.lights.length=0},init:function(e){this.container=t.getContainer(e),this.initialized=!0,null===this.canvasObject&&(this.canvasObject=i._Canvas(e),this.canvas=this.canvasObject.canvas,this.container.append?this.container.append(this.canvas):this.container.appendChild(this.canvas)),t.running||t.start()},setSize:function(e,t){this.canvasObject.setSize(e,t)},setupCameraAndLights:function(){var e=t.modes["3d"].obj;"3d"===t.mode&&e.removeCameraAndLights(),e.camera=new THREE.OrthographicCamera(t.width/-2,t.width/2,t.height/2,t.height/-2,1,1.00000001),e.camera.position.z=1,e.resolution=.5,e.renderer.setSize(t.width,t.height)},Canvas:function(e){return"3d"===t.mode&&t.modes["3d"].obj.remove(),i.intialized||t.init("2d",e),i.canvasObject.show(),i.canvasObject}.bind(i),_Canvas:function(){var i=document.createElement("canvas"),o=i.getContext("2d"),a=o;return r.extend(a,{top:0,bottom:i.height,left:0,right:i.width,center:{x:i.width/2,y:i.height/2},init:function(){t.running||t.start()},setSize:function(e,i){this.width=this.right=e,this.height=this.bottom=i,this.center.x=this.width/2,this.center.y=this.height/2,this.canvas.style.width=e+"px",this.canvas.style.height=i+"px",this.canvas.width=this.width*t.resolution,this.canvas.height=this.height*t.resolution},removeCameraAndLights:function(){},canvas:i,is3D:"3d"===t.mode,texture:{needsUpdate:function(){}},remove:function(){a.hide(),a.draw=function(){},t.modes["2d"].canvas=null},show:function(){i.style.display="block"},hide:function(){i.style.display="none"},shouldClear:!1,_fill:a.fill,_stroke:a.stroke,_rotate:a.rotate,rotate:function(e){this.translate(this.center.x,this.center.y),this._rotate(e),this.translate(-this.center.x,-this.center.y)},fill:function(e){return"undefined"!=typeof e&&(isNaN(e)||(e="rgb("+e+","+e+","+e+")"),this.fillStyle=e),this._fill(),this.texture.needsUpdate=!0,this},fade:function(e,t){var i=this.alpha;this.fillStyle="undefined"==typeof t?"black":t,this.alpha=e,this.fillRect(0,0,this.width,this.height),this.alpha=i},stroke:function(e,t){return"undefined"!=typeof e&&(isNaN(e)||(e="rgb("+e+","+e+","+e+")"),this.strokeStyle=e),"undefined"!=typeof t&&(this.lineWidth=t),this._stroke(),this.texture.needsUpdate=!0,this},_update:function(){this.shouldClear&&this.clear(),this.save();for(var e=0;e<this.graph.length;e++){var t=this.graph[e];t._update(),t.update&&t.update(),t.draw()}this.draw(),this.restore()},draw:function(){},clear:function(){return this.clearRect(0,0,this.right,this.bottom),this.texture.needsUpdate=!0,this},line:function(e,t,i,n){return this.beginPath(),this.moveTo(e,t),this.lineTo(i,n),this.closePath(),this},circle:function(e,t,i){return i>0&&(this.save(),this.translate(e,t),this.beginPath(),this.arc(0,0,i,0,2*Math.PI),this.closePath(),this.restore()),this},square:function(e,t,i){return this.beginPath(),this.moveTo(e,t),this.lineTo(e+i,t),this.lineTo(e+i,t+i),this.lineTo(e,t+i),this.lineTo(e,t),this.closePath(),this},rectangle:function(e,t,i,n){return this.beginPath(),this.moveTo(e,t),this.lineTo(e+i,t),this.lineTo(e+i,t+n),this.lineTo(e,t+n),this.lineTo(e,t),this.closePath(),this},shapes:{Shape:function(){var t={ctx:a,stroke:null,fill:"gray",mods:[],_update:function(){for(var e=0;e<this.mods.length;e++){var t,i,n,r=this.mods[e];switch(t=this[r.name](),i=r.name.toUpperCase(),r.type){case"+":n="number"==typeof r.modulator?t+r.modulator*r.mult:t+r.modulator.getValue()*r.mult;break;case"++":n+="number"==typeof r.modulator?t+Math.abs(r.modulator*r.mult):t+Math.abs(r.modulator.getValue()*r.mult);break;case"-":n="number"==typeof r.modulator?t-r.modulator*r.mult:t-r.modulator.getValue()*r.mult;break;case"=":n="number"==typeof r.modulator?r.modulator:r.modulator.getValue()*r.mult}this[r.name](n)}},remove:function(){a.graph.splice(a.graph.indexOf(this),1)},changeZ:function(e){r=e},mod:function(e,t,i,n){return this.mods.push({name:e,modulator:t,type:i||"+",mult:n||1}),this},removeMod:function(e){if(e)for(var t=this.mods.length-1;t>=0;t--){var i=this.mods[t];i.name===e&&this.mods.splice(t,1)}else this.mods=[]}};a.shouldClear=!0;var i=0,n=0,r=(height=.2,a.graph.length);Object.defineProperties(t,{x:{configurable:!0,get:function(){return i},set:function(e){i=e}},y:{configurable:!0,get:function(){return n},set:function(e){n=e}},z:{get:function(){return r},set:function(e){a.reorderGraph(),a.graph.splice(a.graph.indexOf(this),1),a.graph.splice(e,0,this),r=e}}});var o=({min:0,max:1,timescale:"graphics",output:e.LINEAR},{x:a.zeroToOne,y:a.zeroToOne});return e.createProxyProperties(t,o),a.graph.push(t),t},Rectangle:function(){var t=a.shapes.Shape(),i={width:a.zeroToOne,height:a.zeroToOne};t.draw=function(){a.rectangle(Math.floor(this.x()*a.width),Math.floor(this.y()*a.height),Math.floor(this.width()*a.width),Math.floor(this.height()*a.height)),this.stroke&&a.stroke(this.stroke),this.fill&&a.fill(this.fill)};var n=height=.2;return Object.defineProperties(t,{width:{configurable:!0,get:function(){return n},set:function(e){n=e}},height:{configurable:!0,get:function(){return height},set:function(e){height=e}}}),e.createProxyProperties(t,i),"object"==typeof arguments[0]&&r.extend(t,arguments[0]),t},Polygon:function(){var t=a.shapes.Shape(),i={radius:a.zeroToOne,sides:{min:3,max:20,output:e.LINEAR,timescale:"graphics"}};t.draw=function(){a.polygon(Math.floor(this.x()*a.width),Math.floor(this.y()*a.height),Math.floor(this.radius()*a.width),this.sides()),this.stroke&&a.stroke(this.stroke),this.fill&&a.fill(this.fill)};var n=.2,o=5;return Object.defineProperties(t,{radius:{configurable:!0,get:function(){return n},set:function(e){n=e}},sides:{configurable:!0,get:function(){return o},set:function(e){o=e}}}),e.createProxyProperties(t,i),"object"==typeof arguments[0]&&r.extend(t,arguments[0]),t}},zeroToOne:{min:0,max:1,timescale:"graphics",output:e.LINEAR},reorderGraph:function(){if(z>v)for(var e=v;e<a.graph.length;e++)a.graph[e].changeZ(a.graph[e].z+1)},graph:[],update:function(){return this.texture.needsUpdate=!0,this},polygon:function(e,t,i,n){for(var r=360/n,o=1;n>=o;o++){var a=r*o,s=2*Math.PI*(a/360),l=Math.round(Math.sin(s)*i)+e,c=Math.round(Math.cos(s)*i)+t;1===o?(this.beginPath(),this.moveTo(l,c)):this.lineTo(l,c)}var a=r,s=2*Math.PI*(a/360),l=Math.round(Math.sin(s)*i)+e,c=Math.round(Math.cos(s)*i)+t;return this.lineTo(l,c),this.closePath(),this},randomColor:function(){return"#"+Math.random().toString(16).slice(2,8)},width:i.width,height:i.height,sprite:null,createSprite:function(){return a.texture=new t.THREE.Texture(i),a.sprite=new t.THREE.Mesh(new t.THREE.PlaneGeometry(i.width,i.height,1,1),new t.THREE.MeshBasicMaterial({map:a.texture,affectedByDistance:!1,useScreenCoordinates:!0})),a.sprite.position.x=a.sprite.position.y=a.sprite.position.z=0,a.texture.needsUpdate=!0,a.sprite}}),n=a,Object.defineProperties(a,{fps:{get:function(){return null!==t.fps?t.fps:60},set:function(e){t.fps=e}},alpha:{get:function(){return this.globalAlpha},set:function(e){this.globalAlpha=e}}}),a}},o}},{}],50:[function(e,t){t.exports=function(e,t){"use strict";var i=e.dollar,n=function(e){var n=i.extend({},{canvas:null,ctx:null,initialized:!1,renderer:null,scene:null,camera:null,lights:[],running:!1,init:function(){this.container=t.getContainer(e),this.initialized&&this.setSize(t.width,t.height),this.createRenderer(),this.createScene(),this.createLights(),t.running||t.start(),this.show(),this.initialized=!0,this.running=!0,t.mode="3d"},setSize:function(e,t){this.renderer.setSize(e,t),this.renderer.domElement.style.width=e+"px",this.renderer.domElement.style.height=t+"px",this.createCameras()},_update:function(){this.initialized&&this.running&&(this.renderer.clear(),t.PostProcessing&&t.PostProcessing.fx.length?t.PostProcessing.composer.render():this.renderer.render(this.scene,this.camera))},createRenderer:function(){null===this.renderer&&(this.renderer=new t.THREE.WebGLRenderer,this.initalized||(this.container.append?this.container.append(this.renderer.domElement):this.container.appendChild(this.renderer.domElement)),this.canvas=this.renderer.domElement)},createScene:function(){null===this.scene&&(this.scene=new t.THREE.Scene)},createCameras:function(){if(null===this.camera){var e=45,i=t.width/t.height,n=.1,r=1e4;this.camera=new t.THREE.PerspectiveCamera(e,i,n,r),this.scene.add(this.camera)}this.camera.updateProjectionMatrix(),this.camera.position.z=250,this.camera.lookAt(this.scene.position)},createLights:function(){this.lights.length>1||(this.ambientLight=new t.THREE.AmbientLight(16777215),this.pointLight=new t.THREE.PointLight(16777215),this.pointLight.position.x=100,this.pointLight.position.y=100,this.pointLight.position.z=-130,this.pointLight2=new t.THREE.PointLight(6710886),this.pointLight2.position.x=0,this.pointLight2.position.y=0,this.pointLight2.position.z=260,this.lights=[this.pointLight,this.pointLight2],this.scene.add(this.pointLight),this.scene.add(this.pointLight2))},removeCameraAndLights:function(){this.scene.remove(this.camera),this.scene.remove(this.pointLight),this.scene.remove(this.pointLight2),this.scene.add(this.ambientLight),this.camera=null,this.lights.length=0},remove:function(){this.hide(),this.running=!1,this.removeCameraAndLights();for(var e=0;e<this.scene.children.length;e++)this.scene.remove(this.scene.children[e])},show:function(){n.canvas.style.display="block"},hide:function(){n.canvas.style.display="none"}});return n};return n}},{}],51:[function(e,t){t.exports=function(e,t,i){"use strict";var n=e.dollar,r=function(){var e=rndf(-50,50,3);return{x:e[0],y:e[1],z:e[2]}},o=[["Vec2","Vector2","vec2"],["Vec3","Vector3","vec3"],["Vec4","Vector4","vec4"]].forEach(function(t){var n=t[0],r=t[1]||t[0],o=t[2]||"f";window[n]=function(){var t,a=Array.prototype.slice.call(arguments,0);if(Array.isArray(a[0])){for(var s=[],l=0;l<a[0].length;l++)s[l]=a[0][l];a=s}return t=e.construct(i[r],a),t.name=n,t.shaderType=o,t}}),o={Cube:{width:50,height:50,depth:50},Sphere:{radius:50,segments:16,rings:16},Tetrahedron:{radius:50,detail:0},Octahedron:{radius:50,detail:0},Icosahedron:{radius:50,detail:0},Cylinder:{radiusTop:20,radiusBottom:20,height:100,radiusSegments:8,heightSegments:1,openEnded:!1},Parametric:{func:r,slices:8,stacks:8},Torus:{radius:50,tube:10,radialSegments:8,tubularSegments:8,arc:2*Math.PI},TorusKnot:{radius:50,tube:5,radialSegments:64,tubularSegments:8,p:5,q:3,heightScale:1},Plane:{width:150,height:150,segmentsWidth:1,segmentsHeight:1}},a=["rotation","scale","position"],s=function(t,i,n){{var r;e.processArguments(t,i)}if("object"==typeof t[0]){r=[];for(var o in n){var a="undefined"!=typeof t[0][o]?t[0][o]:n[o];r.push(a)}for(var s in t[0])n[s]||(r[s]=t[0][s])}else if(Array.isArray(t))r=t;else{r=[];for(var o in n)r.push(n[o])}return r},l={rotation:{min:0,max:2*Math.PI,output:e.LINEAR,wrap:!0,timescale:"graphics"},scale:{min:0,max:2,output:e.LINEAR,wrap:!1,timescale:"graphics"},position:{min:-100,max:100,output:e.LINEAR,wrap:!1,timescale:"graphics"}},c={"export":function(e){n.extend(e,c)}};for(var h in o)!function(){var r=h,u=o[h],f=function(){null===t.modes["3d"].obj?t.init("3d",null):(t.modes["3d"].obj.init(),t.modes["3d"].obj.show(),t.mode="3d"),t.running=!0;var o=s(arguments,r,u);if(this.name=r,o.color&&n.isArray(o.color)){var c=o.color;o.color=Color().rgb(255*c[0],255*c[1],255*c[2]).hexString()}this.color=new i.Color(o.color)||new i.Color(16777215);var h="undefined"!=typeof arguments[0]&&arguments[0].shader;h?(this.material=new i.ShaderMaterial(arguments[0].shader.material||arguments[0].shader),arguments[0].shader.material&&(arguments[0].shader.target=this)):this.material=o.texture?new i.MeshBasicMaterial({map:o.texture,affectedByDistance:!1,useScreenCoordinates:!0}):new i.MeshPhongMaterial({color:this.color,shading:i.FlatShading,shininess:50}),this.geometry=e.construct(i[r+"Geometry"],o),this.mesh=new i.Mesh(this.geometry,this.material),this.spinX=this.spinY=this.spinZ=0,this.mappingProperties=l,this.mappingObjects=[];for(var f={x:"X",y:"Y",z:"Z"},p=0;p<a.length;p++)!function(t){{var i=a[p],o="scale"===i?Vec3(1,1,1):Vec3(),s=function(){t.mesh[i].set(o.x,o.y,o.z)};o.x,o.y,o.z}o.name=r+"."+i,o.seq=t.seq,Object.defineProperty(t,i,{configurable:!0,get:function(){return o},set:function(e){switch(n.type(e)){case"object":"number"==typeof e.x&&(o.x=e.x),"number"==typeof e.y&&(o.y=e.y),"number"==typeof e.z&&(o.z=e.z);break;case"array":"number"==typeof e[0]&&(o.x=e[0]),"number"==typeof e[1]&&(o.y=e[1]),"number"==typeof e[2]&&(o.z=e[2]);break;case"number":o.x=o.y=o.z=e}return s(),o}}),e.defineProperty(t,i,!0,!0,l[i],!0,!1,!0),Object.defineProperties(t[i],{x:{get:function(){return o.x},set:function(e){o.x=e,s()},configurable:!0},y:{get:function(){return o.y},set:function(e){o.y=e,s()},configurable:!0},z:{get:function(){return o.z},set:function(e){o.z=e,s()},configurable:!0}});for(var c in f)!function(){var n=c;e.defineProperty(t[i],c,!0,!0,l[i],!0),t[i][n].modObject=t,t[i][n].modName=i+"."+n,t[i][n].set=function(e){o[n]=e,s()}}()}(this);this.update=function(){},this._update=function(){for(var e=0;e<this.mods.length;e++){var t,i,n,r=this.mods[e];if(r.name.indexOf(".")>-1){var o=r.name.split(".");switch(t=this[o[0]][o[1]](),i=o[1].toUpperCase(),r.type){case"+":n="number"==typeof r.modulator?t+r.modulator*r.mult:t+r.modulator.getValue()*r.mult;break;case"++":n+="number"==typeof r.modulator?t+Math.abs(r.modulator*r.mult):t+Math.abs(r.modulator.getValue()*r.mult);break;case"-":n="number"==typeof r.modulator?t-r.modulator*r.mult:t-r.modulator.getValue()*r.mult;break;case"=":n="number"==typeof r.modulator?r.modulator:r.modulator.getValue()*r.mult}this[o[0]][o[1]].set(n)}else{var a="number"==typeof r.modulator?r.modulator:r.modulator.getValue();switch(r.type){case"+":this[r.name].x+=a*r.mult,this[r.name].y+=a*r.mult,this[r.name].z+=a*r.mult;break;case"++":this[r.name].x+=Math.abs(a*r.mult),this[r.name].y+=Math.abs(a*r.mult),this[r.name].z+=Math.abs(a*r.mult);break;case"-":this[r.name].x-=a*r.mult,this[r.name].y-=a*r.mult,this[r.name].z-=a*r.mult;break;case"=":this[r.name].x=a*r.mult,this[r.name].y=a*r.mult,this[r.name].z=a*r.mult}}}},this.mods=[],this.remove=this.kill=function(e){return t.modes["3d"].obj.scene.remove(this.mesh),e||t.graph.splice(t.graph.indexOf(this),1),this},this.replaceWith=function(){this._},this.mod=function(e,t,i,n){return this.mods.push({name:e,modulator:t,type:i||"+",mult:n||1}),this},this.removeMod=function(e){if(e)for(var t=this.mods.length-1;t>=0;t--){var i=this.mods[t];i.name===e&&this.mods.splice(t,1)}else this.mods=[]},this.ramp=function(e,t,i,n){3===arguments.length&&(n=i,i=t,t=this[e])},this.spin=function(e,t,i){return 1===arguments.length?0!==e?this.mod("rotation",e):(this.removeMod("rotation",0),this.removeMod("rotation.x",0),this.removeMod("rotation.y",0),this.removeMod("rotation.z",0)):0===arguments.length?this.removeMod("rotation"):(0!==e?this.mod("rotation.x",e):this.removeMod("rotation.x"),0!==t?this.mod("rotation.y",t):this.removeMod("rotation.y"),0!==i?this.mod("rotation.z",i):this.removeMod("rotation.z")),this},arguments[0]&&(arguments[0].scale&&(this.scale=arguments[0].scale),arguments[0].rotation&&(this.scale=arguments[0].rotation),arguments[0].position&&(this.scale=arguments[0].position)),t.modes["3d"].obj.scene.add(this.mesh),t.graph.push(this),this.mappings=[],Object.defineProperty(this,"_",{get:function(){this.seq.isRunning&&this.seq.disconnect();
for(var e=0;e<this.mappings.length;e++)this.mappings[e].remove();this.clearMarks&&this.clearMarks(),this.remove(),console.log(r+" is removed.")},set:function(){}}),Object.defineProperty(this,"color",{get:function(){return this.material.color},set:function(e){n.isArray(e)&&(e=Color().rgb(255*e[0],255*e[1],255*e[2]).hexString()),this.material.color.set(e)}}),this.toString=function(){return this.name},console.log(r+" is created.")};c[r]=function(){return e.construct(f,arguments)}}();return c.Knot=c.TorusKnot,c}},{}],52:[function(e,t){t.exports=function(e){"use strict";var t={Stripes:function(){var e=["varying vec2 p;","uniform float xCount;","uniform float yCount;","uniform float blend;","uniform sampler2D tDiffuse;","uniform vec3 colorX;","uniform vec3 colorY;","","void main() {","  vec3 color;","  float x = p.x * xCount;","  float y = p.y * yCount;","	 int stripeX = int(mod( x, 2.));","	 int stripeY = int(mod( y, 2.));","","  if( stripeX == 1 || stripeY == 1) {","    color = colorX;","  }else{","    color = vec3(0., 0., 0.);","  }","","  vec3 prev = texture2D( tDiffuse, p ).rgb;","  gl_FragColor = vec4( mix(color, prev, blend), 1. );","}"].join("\n"),t=Shader(e);return t.uniform("xCount",4,1,100,"float"),t.uniform("yCount",4,1,100,"float"),t.uniform("blend",0,1,0,"float"),t.uniforms.colorX={type:"c",value:{r:1,g:1,b:1}},t.uniforms.colorY={type:"c",value:{r:1,g:1,b:1}},Object.defineProperties(t,{colorX:{get:function(){return t.uniforms.colorX.value},set:function(e){t.uniforms.colorX.value=Color(e)}},colorY:{get:function(){return t.uniforms.colorY.value},set:function(e){t.uniforms.colorY.value=Color(e)}}}),t},Circles:function(){var e=["uniform float time;","uniform float thickness;","uniform float speed;","uniform float radius;","uniform float x;","uniform float y;","uniform sampler2D tDiffuse;","uniform vec3 color;","varying vec2 p;","","void main() {","  vec2 uv = 2. * p - 1.;","  float _speed = 20. * speed;","  float edgeDistance = radius * thickness;","  float dist = distance( p, vec2(x,y) );","  float growth = mod(time, 1.) / -_speed;","","  float moddist = mod( dist + growth, radius );","  float _out = smoothstep( moddist, moddist+edgeDistance, radius / 2. );","  _out += smoothstep( moddist, moddist-edgeDistance, radius / 2.);","","  gl_FragColor = vec4( vec3(1.- _out), 1. );","}"].join("\n"),t=Shader(e);t.uniform("blend",1,0,1,"float"),t.uniform("thickness",.1,0,1,"float"),t.uniform("x",.5,0,1,"float"),t.uniform("y",.5,0,1,"float"),t.uniform("speed",1,-1,1,"float"),t.uniform("radius",.05,0,1,"float"),t.uniforms.color={type:"c",value:{r:1,g:0,b:0}};var i=t.__lookupSetter__("speed"),n=t.__lookupGetter__("speed");return Object.defineProperties(t,{speed:{get:function(){return n()},set:function(e){e=e>0?1-e:-1-e,i(e)}}}),t},Pixellate:function(){var e=["uniform sampler2D tDiffuse;","uniform float amount;","uniform float blend;","varying vec2 vUv;","void main() {","	vec2 sd = vec2( amount );","	vec2 samplePos = vUv - mod( vUv, sd );","	vec4 p = texture2D( tDiffuse, samplePos );","	vec4 pp = texture2D( tDiffuse, vUv );","	vec3 _blend = (p.rgb * vec3( blend ) ) + ( pp.rgb * vec3(1.0 - blend ) );","	gl_FragColor = vec4( _blend, 1. );","}"].join("\n"),t=["varying vec2 vUv;","void main() {","	vUv = uv;","	gl_Position = vec4( position[0],position[1],position[2], 1.0 );","}"].join("\n"),i=Shader(e,t);return i.uniform("amount",.01,0,1,"float"),i.uniform("blend",1,0,1,"float"),i},"export":function(e){e.Pixellate=t.Pixellate,e.Stripes=t.Stripes,e.Circles=t.Circles}};return t}},{}],53:[function(e,t){t.exports=function(t){"use strict";var i=t.dollar,n={Color:e("color"),canvas:null,canvas2D:null,canvas3D:null,ctx:null,width:0,height:0,running:!1,resolution:1,fps:null,graph:[],initialized:!1,mode:null,defaultContainer:"#contentCell",THREE:e("../external/three/three.min"),"export":function(e){n.Geometry.export(e),n.modes["2d"].constructor.export(e),n.PostProcessing.export(e),n.GibberShaders.export(e),e.Video=n.Video},getContainer:function(e){var t;return t="undefined"==typeof e||null===e?document.querySelector(null!==document.querySelector(n.defaultContainer)?n.defaultContainer:"body"):e.bodyElement},init:function(e,r){if("3d"===e&&!window.WebGLRenderingContext){var o="Your browser does not support WebGL.2D drawing will work, but 3D geometries and shaders are not supported.";t.Environment.Message.post(o)}var a=this.mode;this.mode=e||"3d",null===this.modes[this.mode].canvas&&(this.modes[this.mode].obj=this.modes[this.mode].constructor(r)),console.log("_MODE",a),null!==a&&"undefined"!=typeof a&&a!==this.mode&&this.modes[a].obj.hide(),this.modes[this.mode].obj.init&&this.modes[this.mode].obj.init(r),this.canvas=null!==this.modes[this.mode].canvas?this.modes[this.mode].canvas:this.modes[this.mode].canvas=this.modes[this.mode].obj.canvas,this.canvas.parent="undefined"==typeof r||null===r?document.querySelector(n.defaultContainer):r.bodyElement||r,this.positionCanvas(this.canvas),this.assignWidthAndHeight(!0),this.modes[this.mode].obj.setSize(this.width*this.resolution,this.height*this.resolution);var s=this.resolution,l=this;Object.defineProperty(this,"resolution",{get:function(){return s},set:function(e){s=e,l.assignWidthAndHeight()}});var c=!1;Object.defineProperty(this,"running",{get:function(){return c},set:function(e){e!==c&&(c===!0?(l.render(),c=e):(c=e,l.render()))}}),this.start();var h=function(e){n.width=e.w,n.height=e.h,n.modes["2d"].obj&&n.modes["2d"].obj.setSize(e.w,e.h),n.modes["3d"].obj&&n.modes["3d"].obj.setSize(e.w,e.h)};i.subscribe("/layout/contentResize",h),i.subscribe("/layout/resizeWindow",function(e){e.h-=i("thead").height(),e.h-=i("tfoot").height(),h(e)}),this.initialized=!0},positionCanvas:function(e){var t=document.querySelector("body"),i=e.parent===t;e.style.left=0,e.style.top=0,e.style.position=i?"fixed":"relative",e.style.float=i?"none":"left",e.style.overflow="hidden",e.style.display="block",i&&(t.style.margin=0)},start:function(){this.running=!0,window.requestAnimationFrame(this.render)},useCanvasAsTexture:function(e){var t=e.createSprite();n.initialized&&"2d"!==n.mode||n.init("3d"),n.modes["3d"].obj.scene.add(t),n.modes["2d"].obj.setupCameraAndLights(),n.graph.push(e)},clear:function(){if(this.running){for(var e=0;e<this.graph.length;e++)this.graph[e].remove(!0);this.graph.length=0;for(var t in this.modes){var i=this.modes[t];i.obj&&i.obj.remove()}if(this.PostProcessing){for(var n=this.PostProcessing.fx-1;n>=0;n--)this.PostProcessing.fx[n].remove();this.PostProcessing.fx.length=0,this.PostProcessing.isRunning=!1}if("3d"===this.mode)for(var e=0;e<this.modes["3d"].obj.scene.children.length;e++){var r=this.modes["3d"].obj.scene.children[e];this.modes["3d"].obj.scene.remove(r)}this.running=!1}},render:function(){if(this.running){for(var e=0;e<this.graph.length;e++)this.graph[e]._update(),this.graph[e].update();this.modes[this.mode].obj._update(),null===this.fps||this.fps>=55?window.requestAnimationFrame(this.render):setTimeout(function(){n.render()},1e3/this.fps)}},test:function(){var e=new n.THREE.CubeGeometry(50,50,50),t=new n.THREE.Color(0).setRGB(.5,0,0),i=new n.THREE.MeshPhongMaterial({color:t,shading:n.THREE.FlatShading,shininess:50}),r=new n.THREE.Mesh(e,i);return this.scene.add(r),this.graph.push(r),r},showStats:function(){this.stats=new Stats,this.stats.domElement.style.position="absolute",this.stats.domElement.style.top="0px",this.stats.domElement.style.right="0px",i("body").append(this.stats.domElement)},assignWidthAndHeight:function(e){var r=n.modes[this.mode].canvas,o=r.parentElement;n.width=o===document.querySelector("body")?o.offsetWidth:o.offsetWidth||o.width(),n.height=o===document.querySelector("body")?o.offsetHeight:i(i("#contentCell").children()[0]).height()||o.offsetHeight,null!==document.querySelector("#header")&&o===window&&null===t.Environment.Layout.fullScreenColumn,n.canvas.style.zIndex=-1,e||"2d"===n.mode||(n.modes["3d"].obj.renderer.setSize(n.width*n.resolution,n.height*n.resolution),n.modes["3d"].obj.renderer.domElement.style.width=n.width+"px",n.modes["3d"].obj.renderer.domElement.style.height=n.height+"px")}};return n.render=n.render.bind(n),n.modes={"2d":{constructor:e("./2d")(t,n),canvas:null,obj:null},"3d":{constructor:e("./3d")(t,n),canvas:null,obj:null}},n.Geometry=e("./geometry")(t,n,n.THREE),e("../external/three/postprocessing/EffectComposer"),e("../external/three/postprocessing/RenderPass"),e("../external/three/postprocessing/MaskPass"),e("../external/three/postprocessing/ShaderPass"),e("../external/three/postprocessing/CopyShader"),e("../external/three/postprocessing/shaders/DotScreenShader"),e("../external/three/postprocessing/DotScreenPass"),e("../external/three/postprocessing/FilmPass"),e("../external/three/postprocessing/shaders/FilmShader"),e("../external/three/postprocessing/shaders/KaleidoShader"),e("../external/three/postprocessing/shaders/EdgeShader"),e("../external/three/postprocessing/shaders/FocusShader"),e("../external/three/postprocessing/shaders/ShaderGodRays"),e("../external/three/postprocessing/shaders/BleachBypassShader"),e("../external/three/postprocessing/shaders/ColorifyShader"),n.PostProcessing=e("./postprocessing")(t,n),n.PostProcessing.init(),n.Shaders=e("./shader")(t,n),n.GibberShaders=e("./gibber_shaders")(t,n),n.Video=e("./video")(t,n),n}},{"../external/three/postprocessing/CopyShader":33,"../external/three/postprocessing/DotScreenPass":34,"../external/three/postprocessing/EffectComposer":35,"../external/three/postprocessing/FilmPass":36,"../external/three/postprocessing/MaskPass":37,"../external/three/postprocessing/RenderPass":38,"../external/three/postprocessing/ShaderPass":39,"../external/three/postprocessing/shaders/BleachBypassShader":40,"../external/three/postprocessing/shaders/ColorifyShader":41,"../external/three/postprocessing/shaders/DotScreenShader":42,"../external/three/postprocessing/shaders/EdgeShader":43,"../external/three/postprocessing/shaders/FilmShader":44,"../external/three/postprocessing/shaders/FocusShader":45,"../external/three/postprocessing/shaders/KaleidoShader":46,"../external/three/postprocessing/shaders/ShaderGodRays":47,"../external/three/three.min":48,"./2d":49,"./3d":50,"./geometry":51,"./gibber_shaders":52,"./postprocessing":54,"./shader":55,"./video":56,color:29}],54:[function(e,t){t.exports=function(e){"use strict";var t={Dots:{angle:{min:0,max:2*Math.PI,output:e.LINEAR,wrap:!0,timescale:"graphics"},scale:{min:0,max:1,output:e.LINEAR,timescale:"graphics"}},Film:{nIntensity:{min:0,max:1,output:e.LINEAR,timescale:"graphics"},sIntensity:{min:0,max:1,output:e.LINEAR,timescale:"graphics"},sCount:{min:0,max:2048,output:e.LINEAR,timescale:"graphics"}},Kaleidoscope:{angle:{min:0,max:2*Math.PI,output:e.LINEAR,wrap:!0,timescale:"graphics"},sides:{min:2,max:36,output:e.LINEAR,timescale:"graphics"}},Focus:{screenWidth:{min:0,max:1024,output:e.LINEAR,timescale:"graphics"},screenHeight:{min:0,max:1024,output:e.LINEAR,timescale:"graphics"},sampleDistance:{min:0,max:2,output:e.LINEAR,timescale:"graphics"},waveFactor:{min:0,max:.05,output:e.LINEAR,timescale:"graphics"}},Bleach:{opacity:{min:0,max:1,output:e.LINEAR,timescale:"graphics"}},Shader:{amp:{min:0,max:1,output:e.LINEAR,timescale:"graphics"},time:{min:0,max:1,output:e.LINEAR,timescale:"graphics"}}},i={Dots:{properties:{angle:.5,scale:.035,center:new THREE.Vector2(.5,.5)},type:"uniforms",init:function(e){var t=e.center?new THREE.Vector2(e.center[0],e.center[1]):new THREE.Vector2(.5,.5);return new THREE.DotScreenPass(t,e.angle,e.scale,e.mix)}},Film:{properties:{nIntensity:1,sIntensity:.5,sCount:1024,grayscale:!1,mix:1},type:"uniforms",init:function(e){return e=e||{},e.nIntensity=e.nIntensity||1,e.sIntensity=e.sIntensity||.5,e.sCount=e.sCount||1024,e.grayscale=e.grayscale||!1,e.mix=e.mix||1,new THREE.FilmPass(e.nIntensity,e.sIntensity,e.sCount,e.grayscale,e.mix)}},Kaleidoscope:{properties:{sides:6,angle:0},init:function(e){return e=e||{},e.sides=e.sides||6,e.angle=e.angle||0,new THREE.ShaderPass(THREE.KaleidoShader)}},Edge:{properties:{aspect:new THREE.Vector2(512,512)},init:function(e){return e=e||{},e.aspect=e.aspect||i.Edge.properties.aspect,new THREE.ShaderPass(THREE.EdgeShader)}},Focus:{properties:{screenWidth:1024,screenHeight:1024,sampleDistance:2,waveFactor:.1},init:function(){return new THREE.ShaderPass(THREE.FocusShader)}},Godrays:{properties:{},init:function(){return new THREE.ShaderPass(THREE.ShaderGodRays)}},Bleach:{properties:{opacity:1},init:function(){return new THREE.ShaderPass(THREE.BleachBypassShader)}},Colorify:{properties:{color:new THREE.Color(16711680)},init:function(e){e=e||{},console.log(e.color),e.color="string"==typeof e.color?new THREE.Color(Color(e.color).hexString()):i.Colorify.properties.color;var t=new THREE.ShaderPass(THREE.ColorifyShader);return t.uniforms.color.value=e.color,t}},Shader:{properties:{amp:.1,time:0},fragment:null,vertex:null,init:function(t,i){var n=null,r=null,o=null,a=null;return t&&"object"==typeof t&&(r=t,t=e.Graphics.PostProcessing.defs+r.value),i&&"object"==typeof i&&(n=i,i=n.value),a=e.Graphics.Shaders.make(t,i),null!==a&&(o=new THREE.ShaderPass(a)),null!==o&&(o.fragmentText=a.fragmentText,o.vertexText=a.vertexText,n&&(o.columnV=n,n.shader=o),r&&(o.columnF=r,r.shader=o)),o}}},n={"export":function(e){for(var t in i)e[t]=n[t]},composer:null,fx:[],isRunning:!1,defs:["#define PI 3.14159265358979323846264","float rand(vec2 co){","  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);","}\n"].join("\n"),start:function(){this.composer=new THREE.EffectComposer(e.Graphics.modes["3d"].obj.renderer),this.renderScene=new THREE.RenderPass(e.Graphics.modes["3d"].obj.scene,e.Graphics.modes["3d"].obj.camera),this.renderScene.clear=!0,this.renderScene.renderToScreen=!0,this.composer.addPass(this.renderScene),this.isRunning=!0},init:function(){for(var r in i)!function(){var a=r,s=i[r],l=t[r],c=function(){if(null===e.Graphics.canvas?e.Graphics.init("3d"):"2d"===e.Graphics.mode&&e.Graphics.useCanvasAsTexture(e.Graphics.modes["2d"].obj.canvasObject),e.Graphics.running=!0,"Shader"!==a)var i=Array.prototype.slice.call(arguments,0),r=s.init.call(s,i);else r=s.init(arguments[0],arguments[1]);if(e.createProxyProperties(r,{}),r.uniform=function(i,n,a,s,l){a=isNaN(a)?0:a,s=isNaN(s)?1:s,n=isNaN(n)&&"object"!=typeof n?a+(s-a)/2:n,"undefined"==typeof r.mappingProperties[i]&&(t[i]=r.mappingProperties[i]={min:a,max:s,output:e.LINEAR,timescale:"graphics"});var c=o(n,l,i),h=(c[0],c[1]),u=c[2];if("undefined"==typeof r.uniforms[i]&&r.columnF){var f=u;f+=r.columnF.editor.getValue(),r.columnF.editor.setValue(f)}return r.uniforms[i]={type:h,value:n},Object.defineProperty(r,i,{configurable:!0,get:function(){return r.uniforms[i].value},set:function(e){return r.uniforms[i].value=e}}),e.createProxyProperty(r,i,!0),r[i]=n,r},null===r)return void console.log("SHADER ERROR... aborting");n.isRunning||n.start(),r.renderToScreen=!0,r.name=a,r.sequencers=[],n.fx.length>0&&(n.fx[n.fx.length-1].renderToScreen=!1),n.composer.addPass(r),n.fx.push(r),n.defineProperties(r),console.log(r,l);for(var c in l){var h=l[c];r.uniform(c,r[c],h.min,h.max,r.uniforms[c].type)}return $.extend(r,n.shader),e.Graphics.graph.push(r),r.update=function(){},r._update=function(){for(var e=0;e<r.mods.length;e++){var t=r.mods[e],i=r[t.name],n=t.name;switch(n=n.charAt(0).toUpperCase()+n.substr(1),Array.isArray(i)&&(i=i[0]),t.type){case"+":r[n].value="number"==typeof t.modulator?i+t.modulator:i+t.modulator.getValue()*t.mult;break;case"++":r[n].value="number"==typeof t.modulator?i+t.modulator:i+Math.abs(t.modulator.getValue()*t.mult);break;case"-":r[n].value="number"==typeof t.modulator?i-t.modulator:i-t.modulator.getValue()*t.mult;break;case"=":r[n].value="number"==typeof t.modulator?t.modulator:t.modulator.getValue()*t.mult}r[n].oldSetter.call(this,r[n].value)}"undefined"!=typeof r.time&&(r.time+=1/60),r.update()},r.mods=[],r.mod=function(e,t,i,n){this.mods.push({name:e,modulator:t,type:i||"+",mult:n||1})},r.removeMod=function(e){if(e)for(var t=0;t<this.mods.length;t++){var i=this.mods[t];if(i.name===e){this.mods.splice(t,1);break}}},r.replaceWith=function(e){for(var t=0;t<this.sequencers.length;t++)this.sequencers[t].target=e,e.sequencers.push(this.sequencers[t]);for(var t=0;t<this.mappingObjects.length;t++){var i=this.mappingObjects[t];if(i.targets.length>0)for(var n=0;n<i.targets.length;n++){var r=i.targets[n];e.mappingProperties[i.name]?r[0].mapping.replace(e,i.name,i.Name):r[0].mapping.remove()}}this.remove()},r.properties=s.properties,e.processArguments2(r,Array.prototype.slice.call(arguments,0),r.name),r.mappings=[],Object.defineProperty(r,"_",{get:function(){r.seq.isRunning&&r.seq.disconnect();for(var e=0;e<r.mappings.length;e++)r.mappings[e].remove();r.clearMarks&&r.clearMarks(),r.remove()},set:function(){}}),r};n[a]=c}()},defineProperties:function(e){for(var t in i[e.name].properties)!function(){var n=t,r=i[e.name].properties[n];Object.defineProperty(e,n,{configurable:!0,get:function(){return r},set:function(t){r=t,e.uniforms[n].value=r}})}(e)},shader:{remove:function(){n.composer.passes.splice(n.composer.passes.indexOf(this),1),n.fx.splice(n.fx.indexOf(this),1),n.fx.length>0&&(n.fx[n.fx.length-1].renderToScreen=!0);for(var e in this.mappingProperties){var t=e.charAt(0).toUpperCase()+e.slice(1);"object"==typeof this[t].mapping&&this[t].mapping.remove()}}}},r=([["Vec2","Vector2","vec2"],["Vec3","Vector3","vec3"],["Vec4","Vector4","vec4"]].forEach(function(t){var i=t[0],n=t[1]||t[0],r=t[2]||"f";window[i]=function(){var t,o=Array.prototype.slice.call(arguments,0);if(Array.isArray(o[0])){for(var a=[],s=0;s<o[0].length;s++)a[s]=o[0][s];o=a}return t=e.construct(THREE[n],o),t.name=i,t.shaderType=r,t}}),{vec2:"v2",vec3:"v3",vec4:"v4","int":"i","float":"f"}),o=function(e,t,i){var n=null,o=null,a="",s=!1;if(t){if(t in r)n=t;else for(var l in r)if(r[l]===t){n=l;break}}else if(Array.isArray(e)){var c=e[0],h=c.shaderType||typeof c;if("number"===h){var u=c%1===0;u&&(u=e.every(function(e){return e%1===0})),n=u?"int":"float"}else n=h;s=!0}else"object"==typeof e?n=e.shaderType||"float":(n=typeof e,"number"===n&&(console.log("CHECKING FLOAT VS INT"),n=e%1===0?"int":"float"));return a="uniform "+n+" "+i,a+=s?"["+e.length+"];\n":";\n",o=r[n],s&&(o+=n.indexOf("vec")>-1?"v":"v1"),[n,o,a]};return n}},{}],55:[function(e,t){t.exports=function(e,t){var i=(e.Graphics,{make:function(e,t){var n={uniforms:{tDiffuse:{type:"t",value:null},amp:{type:"f",value:0},time:{type:"f",value:0}},fragmentShader:e||i.defaultFragment,vertexShader:t||i.defaultVertex};return n},defaultFragment:["uniform float amp;","uniform sampler2D tDiffuse;","uniform float time;","varying vec2 p;","","void main() {","  gl_FragColor = texture2D( tDiffuse, p ).rgba;","}"].join("\n"),defaultVertex:["varying vec2 p;","void main() {","p = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),Material:function(n,r){var o={},a="object"==typeof n?n.value:n,s="object"==typeof r?r.value:r,l={uniforms:{tDiffuse:{type:"t",value:null},amp:{type:"f",value:0},time:{type:"f",value:0}},fragmentShader:a||i.defaultFragment,vertexShader:s||i.defaultVertex};l.fragmentShader=t.PostProcessing.defs+l.fragmentShader,e.Graphics.running?"2d"===e.Graphics.mode&&e.Graphics.use("3d"):e.Graphics.init("3d");var c=new THREE.ShaderMaterial(l);"object"==typeof n&&(n.shader=o),"object"==typeof r&&(r.shader=o),o.fragmentText=c.fragmentShader,o.vertexText=c.vertexShader,Object.defineProperty(o,"material",{get:function(){return c},set:function(e){c=e,this.target&&(this.target.mesh.material=c)}});var h=null;Object.defineProperty(o,"target",{get:function(){return h},set:function(e){h=e,h.mesh&&(h.mesh.material=this.material,h.mesh.material.needsUpdate=!0)}}),t.graph.push(o),o.update=function(){};o._update=function(){for(var e=0;e<o.mods.length;e++){var t=o.mods[e],i=o[t.name],n=t.name;switch(n=n.charAt(0).toUpperCase()+n.substr(1),Array.isArray(i)&&(i=i[0]),t.type){case"+":o[n].value="number"==typeof t.modulator?i+t.modulator:i+t.modulator.getValue()*t.mult;break;case"++":o[n].value="number"==typeof t.modulator?i+t.modulator:i+Math.abs(t.modulator.getValue()*t.mult);break;case"-":o[n].value="number"==typeof t.modulator?i-t.modulator:i-t.modulator.getValue()*t.mult;break;case"=":o[n].value="number"==typeof t.modulator?t.modulator:t.modulator.getValue()*t.mult}o[n].oldSetter.call(this,o[n].value)}o.update()},o.mods=[],o.mod=function(e,t,i,n){this.mods.push({name:e,modulator:t,type:i||"+",mult:n||1})},o.removeMod=function(e){if(e)for(var t=0;t<this.mods.length;t++){var i=this.mods[t];if(i.name===e){this.mods.splice(t,1);break}}},o.remove=function(){},o.uniforms=l.uniforms;var u=o.mappingProperties={amp:{min:0,max:1,output:e.LINEAR,timescale:"graphics"},time:{min:0,max:1,output:e.LINEAR,timescale:"graphics"}};o.mappingObjects=[],o.uniform=function(t,i,n,r){return n=isNaN(n)?0:n,r=isNaN(r)?1:r,i=isNaN(i)?n+(r-n)/2:i,"undefined"==typeof o.mappingProperties[t]&&(u[t]=o.mappingProperties[t]={min:n,max:r,output:e.LINEAR,timescale:"graphics"}),"undefined"==typeof o.uniforms[t]&&(o.uniforms[t]={type:"f",value:i}),Object.defineProperty(o,t,{configurable:!0,get:function(){return i},set:function(e){i=e,o.material.uniforms[t].value=e}}),e.createProxyProperty(o,t),o[t.charAt(0).toUpperCase()+t.slice(1)].timescale="graphics",o};for(var f in u){var p=u[f];o.uniform(f,p.min,p.max,o[f])}return o}});return i}},{}],56:[function(e,t){t.exports=function(e,t){"use strict";navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,URL=URL||webkitURL;var i,n,r=null,o=function(){return null!==r?r:("undefined"==typeof i&&(n=document.createElement("video"),n.width=320,n.height=240,n.autoplay=!0),null===r&&(navigator.getUserMedia({video:!0,audio:!1},function(e){n.stream=e,n.src=URL.createObjectURL(e)},function(e){console.log("Failed to get a stream due to",e)}),r=new t.THREE.Texture(n),r.video=n,r.remove=function(){t.graph.splice(t.graph.indexOf(r),1),r=null,n.stream.stop()},r.stop=function(){t.graph.splice(t.graph.indexOf(r),1),r=null,n.stream.stop()},r.update=function(){},r._update=function(){n.readyState===n.HAVE_ENOUGH_DATA&&(r.needsUpdate=!0)},t.graph.push(r)),r)};return o}},{}],57:[function(e,t){!function(){function i(e){return 0>e?-1:1}var n=e("jquery"),r={extend:function(e,t){for(var i in t){{i.split(".")}e[i]=t[i]instanceof Array&&t[i].length<100?t[i].slice(0):t[i]}return e},isAndroid:function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("android")>-1}(),keyCodeToChar:{8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause/Break",20:"Caps Lock",27:"Esc",32:"Space",33:"Page Up",34:"Page Down",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",91:"Windows",93:"Right Click",96:"Numpad 0",97:"Numpad 1",98:"Numpad 2",99:"Numpad 3",100:"Numpad 4",101:"Numpad 5",102:"Numpad 6",103:"Numpad 7",104:"Numpad 8",105:"Numpad 9",106:"Numpad *",107:"Numpad +",109:"Numpad -",110:"Numpad .",111:"Numpad /",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"Num Lock",145:"Scroll Lock",182:"My Computer",183:"My Calculator",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},panels:[],mouseDown:!1,useTouch:"ontouchstart"in document.documentElement,widgets:[]};r.Presets={dictionary:"undefined"==typeof localStorage.interfacejs?{}:JSON.parse(localStorage.interfacejs),save:function(e){for(var t=[],i=0;i<r.panels.length;i++){var n=r.panels[i];t[i]=[];for(var o=0;o<n.children.length;o++){var a=n.children[o];if("object"==typeof a.children){for(var s=[],l=0;l<a.children.length;l++)s[l]=a.children[l].value;t[i][o]=s}else t[i][o]=a.value}this.dictionary[e]=t,localStorage.interfacejs=JSON.stringify(this.dictionary)}},load:function(e){for(var t=this.dictionary[e],i=0;i<r.panels.length;i++)for(var n=r.panels[i],o=0;o<n.children.length;o++){var a=n.children[o];if("object"==typeof a.children)for(var s=0;s<a.children.length;s++)a.children[s].setValue(t[i][o][s]);else a.setValue(t[i][o])}},list:function(){return Object.keys(this.dictionary)}},r.Panel=function(){var e=this,t=arguments.length>=1?arguments[0].container:void 0;r.extend(this,{type:"Panel",active:!0,children:[],shouldDraw:[],fps:30,useRelativeSizesAndPositions:!0,labelSize:"12px",font:"normal 12px Helvetica",serializeMe:["fps","useRelativeSizesAndPositions","labelSize","font","background","fill","stroke","backgroundColor"],container:function(){if("undefined"==typeof t){n("body").css({margin:0,padding:0});var e=n('<div id="container">');return e.css({width:n(window).width(),height:n(window).height(),display:"block",margin:0,padding:0,position:"absolute",left:0,top:0}),n("body").append(e),e}return t}(),canvas:document.createElement("canvas"),touchEvent:function(t){if(e.active){console.log(t),"undefined"==typeof t.changedTouches&&t.originalEvent&&(t.changedTouches=t.originalEvent.changedTouches);for(var i=0;i<t.changedTouches.length;i++)for(var n=t.changedTouches.item(i),r=0;r<e.children.length;r++)n.x=n.pageX-e.x,n.y=n.pageY-e.y,n.type=t.type,e.children[r].touchEvent(n);t.preventDefault()}},mouseEvent:function(t){if(e.active){"mousedown"===t.type?r.mouseDown=!0:"mouseup"===t.type&&(r.mouseDown=!1);for(var i={x:t.offsetX||t.pageX-e.x,y:t.offsetY||t.pageY-e.y,type:t.type},n=0;n<e.children.length;n++)e.children[n].mouseEvent(i)}},init:function(){var e=n(this.container).offset();this.width=n(this.container).width(),this.height=n(this.container).height(),this.x=e.left,this.y=e.top,isNaN(this.x)&&(this.x=0),isNaN(this.y)&&(this.y=0),n(this.canvas).attr({width:this.width,height:this.height}),n(this.container).css({"user-select":"none","-webkit-user-select":"none"}),n(this.container).append(this.canvas),this.ctx=this.canvas.getContext("2d"),this.ctx.translate(.5,.5),this.ctx.lineWidth=1,r.useTouch?(n(this.container).on("touchstart",this.touchEvent),n(this.container).on("touchmove",this.touchEvent),n(this.container).on("touchend",this.touchEvent)):(n(this.container).on("mousedown",this.mouseEvent),n(this.container).on("mousemove",this.mouseEvent),n(this.container).on("mouseup",this.mouseEvent)),n(this.container).css({outline:"none"}),n(this.container).attr("tabindex",5),n(this.container).on("keydown",this.keydown.bind(this)),n(this.container).on("keyup",this.keyup.bind(this))},keydown:function(e){for(var t=0;t<this.children.length;t++)this.children[t].onkeydown&&this.children[t].onkeydown(e)},keyup:function(e){for(var t=0;t<this.children.length;t++)this.children[t].onkeyup&&this.children[t].onkeyup(e)},draw:function(){if(this.active){for(var e=0;e<this.shouldDraw.length;e++)this.shouldDraw[e].draw();this.shouldDraw.length=0}},getWidgetWithName:function(e){for(var t=0;t<this.children.length;t++)if(this.children[t].name===e)return this.children[t]},redoBoundaries:function(){var e=n(this.container).offset();this.width=n(this.container).width(),this.height=n(this.container).height(),this.x=e.left,this.y=e.top,isNaN(this.x)&&(this.x=0),isNaN(this.y)&&(this.y=0),n(this.canvas).attr({width:this.width,height:this.height}),this.ctx.translate(.5,.5),this.ctx.lineWidth=1,this.refresh()},refresh:function(){if(this.active){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);for(var e=0;e<this.children.length;e++)this.children[e].draw()}},add:function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];t.panel=this,t.canvas=this.canvas,t.container=this.container,t.ctx=this.ctx,this.children.push(t),t._init&&!t.added&&t._init(),t.oninit&&!t.added&&t.oninit(),t.draw(),t.added=!0,"function"==typeof t.add&&t.add()}},clear:function(){this.ctx.clearRect(0,0,this.width,this.height),this.children.length=0},remove:function(e){if(this.ctx.clearRect(e._x(),e._y(),e._width(),e._height()),"undefined"!=typeof e.children&&"XY"!==e.type)for(var t=0;t<e.children.length;t++)this.children.splice(this.children.indexOf(e.children[t]),1),r.widgets.splice(r.widgets.indexOf(e.children[t]),1);else this.children.indexOf(e)>-1&&(this.children.splice(this.children.indexOf(e),1),r.widgets.splice(r.widgets.indexOf(e),1),"function"==typeof e.remove&&e.remove())}}),"undefined"!=typeof arguments[0]&&r.extend(this,arguments[0]),this.backgroundColor&&this.setBackgroundColor(this.backgroundColor),this.init(),this.timer=setInterval(function(){e.draw()},Math.round(1e3/this.fps));var i="#000",o="#666",a="#999",s="transparent",e=this,l=this.useRelativeSizesAndPositions;Object.defineProperties(this,{useRelativeSizesAndPositions:{get:function(){return l},set:function(e){if(e!==l)if(l=e,e===!1)for(var t=0;t<this.children.length;t++){var i=this.children[t];i.bounds=[Math.round(i.x*this.width),Math.round(i.y*this.height),Math.round(i.width*this.width),Math.round(i.height*this.height)]}else for(var t=0;t<this.children.length;t++){var i=this.children[t];i.bounds=[i.x/this.width,i.y/this.height,i.width/this.width,i.height/this.height]}this.refresh()}},background:{get:function(){return s},set:function(e){s=e,n(this.container).css({backgroundColor:s})}},childBackground:{get:function(){return i},set:function(t){i=t,e.refresh()}},childStroke:{get:function(){return a},set:function(t){a=t,e.refresh()}},childFill:{get:function(){return o},set:function(t){o=t,e.refresh()}}}),arguments[0]&&(arguments[0].childBackground&&(this.childBackground=arguments[0].childBackground),arguments[0].childFill&&(this.childFill=arguments[0].childFill),arguments[0].childStroke&&(this.childStroke=arguments[0].childStroke)),r.panels.push(this)};var o=function(e){switch(e){case"mousedown":return"touchmousedown";case"mousemove":return"touchmousemove";case"mouseup":return"touchmouseup";default:return e}},a=function(e){switch(e){case"touchstart":return"touchmousedown";case"touchmove":return"touchmousemove";case"touchend":return"touchmouseup";default:return e}},s=0,l={hasFocus:!1,requiresFocus:!0,min:0,max:1,value:0,lastValue:null,name:null,events:{ontouchstart:null,ontouchmove:null,ontouchend:null,onmousedown:null,onmousemove:null,onmouseup:null,ontouchmousedown:null,ontouchmousemove:null,ontouchmouseup:null,onvaluechange:null,onboundschange:null}};r.Widget={init:function(e){this.added=!1,r.extend(this,l),"undefined"==typeof e&&(e={}),this.name=e.name||this.type+"_"+s++,this.target="OSC",this.key="/"+this.name,r.extend(this,e),this.bounds&&(this.x=e.bounds[0],this.y=e.bounds[1],this.width=e.bounds[2],this.height=e.bounds[3]),this.colors&&(this.background=e.colors[0],this.fill=e.colors[1],this.stroke=e.colors[2]),this.focusedTouches=[],this.value&&this.setValue(this.value,!0);{var t=this.bounds||[this.x,this.y,this.width,this.height],i=this.x,n=this.y,o=this.width,a=this.height;this.value}Object.defineProperties(this,{bounds:{configurable:!0,get:function(){return t},set:function(e){t=e,this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3],this.onboundschange&&this.onboundschange()}},x:{configurable:!0,get:function(){return i},set:function(e){this.clear(),i=e,this.onboundschange&&this.onboundschange(),this.refresh()}},y:{configurable:!0,get:function(){return n},set:function(e){this.clear(),n=e,this.onboundschange&&this.onboundschange(),this.refresh()}},width:{configurable:!0,get:function(){return o},set:function(e){this.clear(),o=e,this.onboundschange&&this.onboundschange(),this.refresh()}},height:{configurable:!0,get:function(){return a},set:function(e){this.clear(),a=e,this.onboundschange&&this.onboundschange(),this.refresh()}}}),r.widgets.push(this)},clear:function(){this.panel&&this.panel.ctx.clearRect(this._x(),this._y(),this._width(),this._height())},refresh:function(){this.panel&&-1===this.panel.shouldDraw.indexOf(this)&&this.panel.shouldDraw.push(this)},setValue:function(e,t){var i=this.max-this.min,n=e;
this.value=e,0!==this.min||1!==this.max?(n-=this.min,this._value=n/i):this._value=this.value,t||this.refresh()},hitTest:function(e){return e.x>=this._x()&&e.x<=this._x()+this._width()&&e.y>=this._y()&&e.y<=this._y()+this._height()?!0:!1},mouseEvent:function(e){var t=this.hitTest(e),i=o(e.type);(t||this.hasFocus||!this.requiresFocus)&&("mousedown"===e.type&&(this.hasFocus=!0),this[e.type]&&this[e.type](e,t),this["on"+e.type]&&this["on"+e.type](e,t),this["on"+i]&&this["on"+i](e,t)),"mouseup"===e.type&&(this.hasFocus=!1)},touchEvent:function(e){var t=this.hitTest(e),i=a(e.type);if((t||this.hasFocus||!this.requiresFocus)&&("touchstart"===e.type&&(this.focusedTouches.push(e),this.hasFocus=!0),this[e.type]&&this[e.type](e,t),this["on"+e.type]&&this["on"+e.type](e,t),this["on"+i]&&this["on"+i](e,t)),"touchend"===e.type)for(var n=0;n<this.focusedTouches.length;n++)if(this.focusedTouches[n].id===e.id){this.focusedTouches.splice(n,1),0===this.focusedTouches.length&&(this.hasFocus=!1);break}},draw:function(){},sendTargetMessage:function(){if(this.target&&this.key)if("OSC"===this.target){if(r.OSC)if("undefined"==typeof this.values){var e="string"==typeof this.value?"s":"f";r.OSC.send(this.key,e,[this.value])}else if("undefined"==typeof this.sendValues){for(var e="",t=0;t<this.values.length;t++)e+="string"==typeof this.value?"s":"f";r.OSC.send(this.key,e,this.values)}else this.sendValues()}else"MIDI"===this.target?r.MIDI&&"undefined"==typeof this.values&&r.MIDI.send(this.key[0],this.key[1],this.key[2],this.value):"function"==typeof this.target[this.key]?this.target[this.key](this.values||this.value):this.target[this.key]=this.values||this.value},_background:function(){return this.background||this.panel.childBackground},_stroke:function(){return this.stroke||this.panel.childStroke},_fill:function(){return this.fill||this.panel.childFill},_x:function(){return this.panel.useRelativeSizesAndPositions?Math.floor(this.x*this.panel.width):this.x},_y:function(){return this.panel.useRelativeSizesAndPositions?Math.floor(this.y*this.panel.height):this.y},_width:function(){return this.panel.useRelativeSizesAndPositions?Math.floor(this.width*this.panel.width):this.width},_height:function(){return this.panel.useRelativeSizesAndPositions?Math.floor(this.height*this.panel.height):this.height},_font:function(){var e=this.font||this.panel.font;return e},label:null,_serializeMe:["background","stroke","fill","x","y","width","height","value","label","onmousedown","onmousemove","onmouseup","ontouchmousedown","ontouchmousemove","ontouchmouseup","ontouchstart","ontouchmove","ontouchend","onvaluechange","name","type","target","key"]},r.Slider=function(){r.extend(this,{type:"Slider",isVertical:!0,serializeMe:["isVertical"],draw:function(){var e=this._x(),t=this._y(),i=this._width(),n=this._height();this.ctx.fillStyle=this._background(),this.ctx.fillRect(e,t,i,n),this.ctx.fillStyle=this._fill(),this.isVertical?this.ctx.fillRect(e,t+n-this._value*n,i,this._value*n):this.ctx.fillRect(e,t,i*this._value,n),this.label&&(this.ctx.fillStyle=this._stroke(),this.ctx.textBaseline="middle",this.ctx.textAlign="center",this.ctx.font=this._font(),this.ctx.fillText(this.label,e+i/2,t+n/2)),this.ctx.strokeStyle=this._stroke(),this.ctx.strokeRect(e,t,i,n)},changeValue:function(e,t){(this.hasFocus||!this.requiresFocus)&&(this._value=this.isVertical?1-t/this._height():e/this._width(),this._value<0?this._value=0:this._value>1&&(this._value=1),this.value=this.min+(this.max-this.min)*this._value,this.value!==this.lastValue&&(this.sendTargetMessage(),this.onvaluechange&&this.onvaluechange(),this.refresh(),this.lastValue=this.value))},mousedown:function(e,t){t&&r.mouseDown&&this.changeValue(e.x-this._x(),e.y-this._y())},mousemove:function(e,t){t&&r.mouseDown&&this.changeValue(e.x-this._x(),e.y-this._y())},mouseup:function(e,t){t&&r.mouseDown&&this.changeValue(e.x-this._x(),e.y-this._y())},touchstart:function(e,t){t&&this.changeValue(e.x-this._x(),e.y-this._y())},touchmove:function(e,t){t&&this.changeValue(e.x-this._x(),e.y-this._y())},touchend:function(e,t){t&&this.changeValue(e.x-this._x(),e.y-this._y())}}).init(arguments[0])},r.Slider.prototype=r.Widget,r.Crossfader=function(){r.extend(this,{type:"Crossfader",crossfaderWidth:30,serializeMe:["crossfaderWidth"],_value:.5,draw:function(){var e=this._x(),t=this._y(),i=this._width(),n=this._height();this.ctx.fillStyle=this._background(),this.ctx.fillRect(e,t,i,n),this.ctx.fillStyle=this._fill(),this.ctx.fillRect(e+(i-this.crossfaderWidth)*this._value,t,this.crossfaderWidth,n),this.ctx.strokeStyle=this._stroke(),this.ctx.strokeRect(e,t,i,n)},changeValue:function(e){(this.hasFocus||!this.requiresFocus)&&(this._value=e/this._width(),this._value<0?this._value=0:this._value>1&&(this._value=1),this.value=this.min+(this.max-this.min)*this._value,this.value!==this.lastValue&&(this.sendTargetMessage(),this.onvaluechange&&this.onvaluechange(),this.refresh(),this.lastValue=this.value))},mousedown:function(e){this.changeValue(e.x-this._x(),e.y-this._y())},mousemove:function(e){this.changeValue(e.x-this._x(),e.y-this._y())},mouseup:function(e){this.changeValue(e.x-this._x(),e.y-this._y())},touchstart:function(e,t){t&&this.changeValue(e.x-this._x(),e.y-this._y())},touchmove:function(e,t){t&&this.changeValue(e.x-this._x(),e.y-this._y())},touchend:function(e,t){t&&this.changeValue(e.x-this._x(),e.y-this._y())}}).init(arguments[0])},r.Crossfader.prototype=r.Widget,r.Button=function(){r.extend(this,{type:"Button",_value:0,serializeMe:["mode","label"],mode:"toggle",isMouseOver:!1,isTouchOver:!1,label:null,requiresFocus:!1,draw:function(){var e=this._x(),t=this._y(),i=this._width(),n=this._height();this.ctx.fillStyle=this._value?this._fill():this._background(),this.ctx.fillRect(e,t,i,n),null!==this.label&&(this.ctx.fillStyle=this._stroke(),this.ctx.textBaseline="middle",this.ctx.textAlign="center",this.ctx.font=this._font(),this.ctx.fillText(this.label,e+i/2,t+n/2)),this.ctx.strokeStyle=this._stroke(),this.ctx.strokeRect(e,t,i,n)},changeValue:function(){(this.hasFocus||!this.requiresFocus)&&(this._value=!this._value,this.value=this._value?this.max:this.min,(this.value!==this.lastValue||"contact"===this.mode)&&(this.sendTargetMessage(),this.onvaluechange&&this.onvaluechange(),this.draw(),this.lastValue=this.value))},setValue:function(e,t){var i=this.max-this.min,n=e;this.value=e,0!==this.min||1!==this.max?(n-=this.min,this._value=n/i):this._value=this.value,this.lastValue=this.value,t||"contact"===this.mode||this.refresh()},mousedown:function(e,t){if(t&&r.mouseDown&&(this.isMouseOver=!0,this.changeValue(),"contact"===this.mode)){var i=this;setTimeout(function(){i._value=0,i.draw()},75)}},mousemove:function(e,t){if(!this.requiresFocus&&t&&r.mouseDown&&!this.isMouseOver)if(this.isMouseOver=!0,"contact"!==this.mode)this.changeValue();else{this._value=1,this.draw();var i=this;setTimeout(function(){i._value=0,i.draw()},75)}else!t&&this.isMouseOver&&(console.log("moved off!"),this.isMouseOver=!1)},mouseup:function(){"momentary"===this.mode&&(this.changeValue(),this.isMouseOver=!1)},touchstart:function(e,t){if(t&&(this.isTouchOver=!0,this.changeValue(),"contact"===this.mode)){var i=this;setTimeout(function(){i._value=0,i.draw()},75)}},touchmove:function(e,t){if(this.requiresFocus||!t||this.isTouchOver)!t&&this.isTouchOver&&(this.isTouchOver=!1);else if(this.isTouchOver=!0,"contact"!==this.mode)this.changeValue();else{this._value=1,this.draw();var i=this;setTimeout(function(){i._value=0,i.draw()},75)}},touchend:function(){this.isTouchOver=!1,"momentary"===this.mode&&this.changeValue()}}).init(arguments[0])},r.Button.prototype=r.Widget,r.ButtonV=function(){r.extend(this,{type:"ButtonV",_value:0,serializeMe:["mode","label"],mode:"toggle",isMouseOver:!1,isTouchOver:!1,label:null,points:[{x:0,y:0},{x:0,y:1},{x:1,y:1},{x:1,y:0},{x:0,y:0}],textLocation:{x:.5,y:.5},draw:function(){var e=this._x(),t=this._y(),i=0,n=this._width(),r=this._height();for(this.ctx.fillStyle=this._value?this._fill():this._background(),this.ctx.beginPath(),this.ctx.strokeStyle=this._stroke(),i;i<this.points.length;i++)0===i?this.ctx.moveTo(e+this.points[i].x*n,t+this.points[i].y*r):this.ctx.lineTo(e+this.points[i].x*n,t+this.points[i].y*r);this.ctx.lineTo(e+this.points[0].x*n,t+this.points[0].y*r),this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke(),null!==this.label&&(this.ctx.fillStyle=this._stroke(),this.ctx.textBaseline="middle",this.ctx.textAlign="center",this.ctx.font=this._font(),this.ctx.fillText(this.label,e+n*this.textLocation.x,t+r*this.textLocation.y))},changeValue:function(){(this.hasFocus||!this.requiresFocus)&&(this._value=!this._value,this.value=this._value?this.max:this.min,(this.value!==this.lastValue||"contact"===this.mode)&&(this.sendTargetMessage(),this.onvaluechange&&this.onvaluechange(),this.draw(),this.lastValue=this.value))},hitTest:function(e){var t=this._width(),i=this._height(),n=this._x(),r=this._y();if(e.x>=n&&e.x<=n+t&&e.y>=r&&e.y<=r+i){var o=0,a=this.points,s=0;for(o;o<a.length-1;o++)if(a[o+1].x>a[o].x){if(a[o].x*t+n<=e.x&&e.x<a[o+1].x*t+n){var l=(a[o+1].y-a[o].y)/(a[o+1].x-a[o].x)*i/t*(e.x-a[o].x*t+n)+a[o].y*i+r;l-e.y<0&&s++}}else if(a[o+1].x<a[o].x&&a[o].x*t+n>=e.x&&e.x>a[o+1].x*t+n){var l=(a[o+1].y-a[o].y)/(a[o+1].x-a[o].x)*i/t*(e.x-a[o].x*t+n)+a[o].y*i+r;l-e.y<0&&s++}if(s%2==1)return!0}return!1},setValue:function(e,t){var i=this.max-this.min,n=e;this.value=e,0!==this.min||1!==this.max?(n-=this.min,this._value=n/i):this._value=this.value,this.lastValue=this.value,t||"contact"===this.mode||this.refresh()},mousedown:function(e,t){if(t&&r.mouseDown&&(this.isMouseOver=!0,this.changeValue(),"contact"===this.mode)){var i=this;setTimeout(function(){i._value=0,i.draw()},75)}},mousemove:function(e,t){if(!this.requiresFocus&&t&&r.mouseDown&&!this.isMouseOver)if(this.isMouseOver=!0,"contact"!==this.mode)this.changeValue();else{this._value=1,this.draw();var i=this;setTimeout(function(){i._value=0,i.draw()},75)}else if(!t&&this.isMouseOver)if(this.isMouseOver=!1,"contact"!==this.mode)this.changeValue();else{this._value=1,this.draw();var i=this;setTimeout(function(){i._value=0,i.draw()},75)}},mouseup:function(){"momentary"===this.mode&&(this.requiresFocus||!this.requiresFocus&&this.isMouseOver)&&(this.isMouseOver=!1,this.changeValue())},touchstart:function(e,t){if(t&&(this.isTouchOver=!0,this.changeValue(),"contact"===this.mode)){var i=this;setTimeout(function(){i._value=0,i.draw()},75)}},touchmove:function(e,t){if(this.requiresFocus||!t||this.isTouchOver)if(!t&&this.isTouchOver)if(this.isTouchOver=!1,"contact"!==this.mode)this.changeValue();else{this._value=1,this.draw();var i=this;setTimeout(function(){i._value=0,i.draw()},75)}else!t&&this.isTouchOver&&(this.isTouchOver=!1);else if(this.isTouchOver=!0,"contact"!==this.mode)this.changeValue();else{this._value=1,this.draw();var i=this;setTimeout(function(){i._value=0,i.draw()},75)}},touchend:function(){this.isTouchOver=!1,(this.requiresFocus||!this.requiresFocus&&this.isTouchOver)&&(this.isTouchOver=!1,this.changeValue())}}).init(arguments[0])},r.ButtonV.prototype=r.Widget,r.Piano=function(){r.extend(this,{type:"Piano",_value:0,serializeMe:["mode","label"],mode:"toggle",isMouseOver:!1,isTouchOver:!1,label:null,startletter:"C",startoctave:3,endletter:"C",endoctave:5,target:null,noteLabels:!1,_initialized:!1,keyMap:["Z","S","X","D","C","V","G","B","H","N","J","M",","],children:[],play:function(e,t){isNaN(t)&&(t=4410),"undefined"!=typeof Gibber&&(t=Gibber.Clock.time(t));var i=this.children[e];i&&(i.changeValue(),future(function(){1==i._value&&i.changeValue()},t))},onkeyup:function(e){var t=r.keyCodeToChar[e.keyCode],i=this.keyMap.indexOf(t),n=this.children[i];"undefined"!=typeof n&&1==n._value&&n.changeValue()},onkeydown:function(e){var t=r.keyCodeToChar[e.keyCode],i=this.keyMap.indexOf(t),n=this.children[i];"undefined"!=typeof n&&0==n._value&&n.changeValue()},onvaluechange:function(){this.values=[this.frequency,this.value]},onboundschange:function(){this._initialized&&this.placeKeys()},draw:function(){for(var e=0;e<this.children.length;e++)this.children[e].refresh();return this},placeKeys:function(){var e=(this._x(),this._y(),this._width(),this._height(),this.startoctave),t=0,i=0,n=["0","C","C#/Db","D","D#/Eb","E","F","F#/Gb","G","G#/Ab","A","A#/Bb","B"],o=["0","C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],a=[0,1,2,2,3,3,4,5,5,6,6,7,7],s=i+12*this.endoctave-(t+12*this.startoctave)+1,l=a[i]+7*this.endoctave-(a[t]+7*this.startoctave)+1,c=0;if(this._initialized){this.clear();for(var h=this.children.length-1;h>=0;h--){var u=this.children.pop();this.panel.remove(u)}}for(var h=1;13>h;h++)this.startletter===o[h]&&(t=h),this.endletter===o[h]&&(i=h);[2,4,7,9,11].indexOf(i)>-1&&l--;for(var h=0;s-1>h;h++){var f,p,d,m,g,v;switch(t){case 1:f=[{x:0,y:0},{x:.6,y:0},{x:.6,y:.625},{x:1,y:.625},{x:1,y:1},{x:0,y:1},{x:0,y:0}],d=this._fill(),p={x:.5,y:.75},m=this._background(),g=[c/l*this.width+this.x,this.y,this.width/l,this.height],v=this.noteLabels?n[t]+e:null;break;case 2:f=[{x:.1,y:0},{x:.7,y:0},{x:.7,y:1},{x:.1,y:1},{x:.1,y:0}],p={x:.3925,y:.5},d=this._background(),m=this._fill(),g=[(c-.5)/l*this.width+this.x,this.y,this.width/l,.625*this.height],v=this.noteLabels?n[t]:null;break;case 3:f=[{x:.2,y:0},{x:.8,y:0},{x:.8,y:.625},{x:1,y:.625},{x:1,y:1},{x:0,y:1},{x:0,y:.625},{x:.2,y:.625},{x:.2,y:0}],p={x:.5,y:.75},d=this._fill(),m=this._background(),g=[c/l*this.width+this.x,this.y,this.width/l,this.height],v=this.noteLabels?n[t]:null;break;case 4:f=[{x:.3,y:0},{x:.9,y:0},{x:.9,y:1},{x:.3,y:1},{x:.3,y:0}],p={x:.6075,y:.5},d=this._background(),m=this._fill(),g=[(c-.5)/l*this.width+this.x,this.y,this.width/l,.625*this.height],v=this.noteLabels?n[t]:null;break;case 5:f=[{x:1,y:0},{x:.4,y:0},{x:.4,y:.625},{x:0,y:.625},{x:0,y:1},{x:1,y:1},{x:1,y:0}],p={x:.5,y:.75},d=this._fill(),m=this._background(),g=[c/l*this.width+this.x,this.y,this.width/l,this.height],v=this.noteLabels?n[t]:null;break;case 6:f=[{x:0,y:0},{x:.57142857,y:0},{x:.57142857,y:.625},{x:1,y:.625},{x:1,y:1},{x:0,y:1},{x:0,y:0}],p={x:.5,y:.75},d=this._fill(),m=this._background(),g=[c/l*this.width+this.x,this.y,this.width/l,this.height],v=this.noteLabels?n[t]:null;break;case 7:f=[{x:.07142857,y:0},{x:.64285714,y:0},{x:.64285714,y:1},{x:.07142857,y:1},{x:.07142857,y:0}],p={x:.3925,y:.5},d=this._background(),m=this._fill(),g=[(c-.5)/l*this.width+this.x,this.y,this.width/l,.625*this.height],v=this.noteLabels?n[t]:null;break;case 8:f=[{x:.14285714,y:0},{x:.71428571,y:0},{x:.71428571,y:.625},{x:1,y:.625},{x:1,y:1},{x:0,y:1},{x:0,y:.625},{x:.14285714,y:.625},{x:.14285714,y:0}],p={x:.5,y:.75},d=this._fill(),m=this._background(),g=[c/l*this.width+this.x,this.y,this.width/l,this.height],v=this.noteLabels?n[t]:null;break;case 9:f=[{x:.21428571,y:0},{x:.78571428,y:0},{x:.78571428,y:1},{x:.21428571,y:1},{x:.21428571,y:0}],d=this._background(),m=this._fill(),g=[(c-.5)/l*this.width+this.x,this.y,this.width/l,.625*this.height],v=this.noteLabels?n[t]:null;break;case 10:f=[{x:.28571428,y:0},{x:.85714285,y:0},{x:.85714285,y:.625},{x:1,y:.625},{x:1,y:1},{x:0,y:1},{x:0,y:.625},{x:.28571428,y:.625},{x:.28571428,y:0}],d=this._fill(),m=this._background(),p={x:.5,y:.75},g=[c/l*this.width+this.x,this.y,this.width/l,this.height],v=this.noteLabels?n[t]:null;break;case 11:f=[{x:.35714285,y:0},{x:.92857142,y:0},{x:.92857142,y:1},{x:.35714285,y:1},{x:.35714285,y:0}],d=this._background(),m=this._fill(),p={x:.6075,y:.5},g=[(c-.5)/l*this.width+this.x,this.y,this.width/l,.625*this.height],v=this.noteLabels?n[t]:null;break;case 12:f=[{x:1,y:0},{x:.42857142,y:0},{x:.42857142,y:.625},{x:0,y:.625},{x:0,y:1},{x:1,y:1},{x:1,y:0}],d=this._fill(),m=this._background(),p={x:.5,y:.75},g=[c/l*this.width+this.x,this.y,this.width/l,this.height],v=this.noteLabels?n[t]:null}var y=new r.ButtonV({points:f,textLocation:p,target:this.target,onvaluechange:this.onvaluechange,frequency:261.626*Math.pow(2,(t+12*e-49)/12),background:d,fill:m,stroke:this._stroke(),bounds:g,label:v,requiresFocus:!1,mode:"momentary"});-1===[2,4,7,9,11].indexOf(t)&&c++,this.children.push(y),this.panel.add(y),t++,t>12&&(t=1,e++)}if(2==t||4==t||7==t||9==t||11==t)var b=new r.ButtonV({points:[{x:.166,y:0},{x:.5,y:0},{x:.5,y:1},{x:.166,y:1},{x:.166,y:0}],target:this.target,onvaluechange:this.onvaluechange,background:this._background(),frequency:261.626*Math.pow(2,(t+12*e-49)/12),bounds:[(c-.5)/l*this.width+this.x,this.y,this.width/l,.625*this.height],label:this.noteLabels?n[t]:null,stroke:this._stroke(),requiresFocus:!1,mode:"momentary"});else if(1==t)var b=new r.ButtonV({textLocation:{x:.5,y:.75},target:this.target,onvaluechange:this.onvaluechange,frequency:261.626*Math.pow(2,(t+12*e-49)/12),background:this._fill(),fill:this._background(),stroke:this._stroke(),bounds:[c/l*this.width+this.x,this.y,this.width/l,this.height],label:this.noteLabels?n[t]+e:null,requiresFocus:!1,mode:"momentary"});else if(4==t)var b=new r.ButtonV({textLocation:{x:.5,y:.75},target:this.target,onvaluechange:this.onvaluechange,frequency:261.626*Math.pow(2,(t+12*e-49)/12),background:this._fill(),fill:this._background(),stroke:this._stroke(),bounds:[c/l*this.width+this.x,this.y,this.width/l,this.height],label:this.noteLabels?n[t]:null,requiresFocus:!1,mode:"momentary"});else var b=new r.ButtonV({points:[{x:1,y:0},{x:.33,y:0},{x:.33,y:.625},{x:0,y:.625},{x:0,y:1},{x:1,y:1},{x:1,y:0}],textLocation:{x:.5,y:.75},target:this.target,onvaluechange:this.onvaluechange,frequency:261.626*Math.pow(2,(t+12*e-49)/12),background:this._fill(),fill:this._background(),stroke:this._stroke(),bounds:[c/l*this.width+this.x,this.y,this.width/l,this.height],label:this.noteLabels?n[t]:null,requiresFocus:!1,mode:"momentary"});this.children.push(b),this.panel.add(b),this._initialized=!0},_init:function(){this.placeKeys()}}).init(arguments[0])},r.Piano.prototype=r.Widget,r.Knob=function(){r.extend(this,{type:"Knob",_value:0,serializeMe:["usesRotation","knobBuffer"],knobBuffer:3,lastPosition:0,usesRotation:!0,draw:function(){var e=this._x(),t=this._y(),i=this._width(),n=(this._height(),i/2);this.ctx.clearRect(e,t,2*n,2*n),this.ctx.strokeStyle=this._stroke(),this.ctx.fillStyle=this._background();var r=.6*Math.PI,o=.4*Math.PI;if(this.ctx.beginPath(),this.ctx.arc(e+n,t+n,n-this.knobBuffer,r,o,!1),this.ctx.arc(e+n,t+n,.3*(n-this.knobBuffer),o,r,!0),this.ctx.closePath(),this.ctx.fill(),this.ctx.fillStyle=this._fill(),this.centerZero){var a,s=1.5*Math.PI;a=this._value>=.5?Math.PI*(1.5+1.8*(this._value-.5)):Math.PI*(1.5-.9*(1-2*this._value)),this._value>1.8*Math.PI&&(this._value-=1.8*Math.PI),this.ctx.beginPath(),this.ctx.arc(e+n,t+n,n-this.knobBuffer,s,a,this._value<.5),this.ctx.arc(e+n,t+n,.3*(n-this.knobBuffer),a,s,this._value>.5),this.ctx.closePath(),this.ctx.fill()}else{if(this.isInverted)var l=Math.PI*(.4-1.8*this._value);else{var l=.6*Math.PI+1.8*this._value*Math.PI;l>2*Math.PI&&(l-=2*Math.PI)}this.ctx.beginPath(),this.isInverted?(this.ctx.arc(e+n,t+n,n-this.knobBuffer,o,l,!0),this.ctx.arc(e+n,t+n,.3*(n-this.knobBuffer),l,o,!1)):(this.ctx.arc(e+n,t+n,n-this.knobBuffer,r,l,!1),this.ctx.arc(e+n,t+n,.3*(n-this.knobBuffer),l,r,!0)),this.ctx.closePath(),this.ctx.fill()}this.ctx.beginPath(),this.ctx.arc(e+n,t+n,n-this.knobBuffer,r,o,!1),this.ctx.arc(e+n,t+n,.3*(n-this.knobBuffer),o,r,!0),this.ctx.closePath(),this.ctx.stroke(),null!==this.label&&(this.ctx.fillStyle=this._stroke(),this.ctx.textBaseline="middle",this.ctx.textAlign="center",this.ctx.font=this._font(),this.ctx.fillText(this.label,e+n,t+2.25*n))},setValue:function(e,t){var i=this.max-this.min,n=e;this.lastValue=this.value,this.value=e,0!==this.min||1!==this.max?(n-=this.min,this._value=n/i):this._value=this.value,this.value!==this.lastValue&&(this.sendTargetMessage(),this.onvaluechange&&this.onvaluechange(),this.refresh(),this.lastValue=this.value),t||this.refresh()},changeValue:function(e,t){if(this.hasFocus||!this.requiresFocus){var i=this._width()/2;if(this.lastValue=this.value,this.usesRotation){var n=i-e,r=i-t,o=Math.PI+Math.atan2(r,n);this._value=(o+1.5*Math.PI)%(2*Math.PI)/(2*Math.PI),this.lastRotationValue>.8&&this._value<.2?this._value=1:this.lastRotationValue<.2&&this._value>.8&&(this._value=0)}else-1!=this.lastPosition&&(this._value-=(t-this.lastPosition)/(2*i));this._value>1&&(this._value=1),this._value<0&&(this._value=0),this.lastRotationValue=this._value,this.lastPosition=t;var a=this.max-this.min;this.value=this.min+this._value*a,this.value!==this.lastValue&&(this.sendTargetMessage(),this.onvaluechange&&this.onvaluechange(),this.refresh(),this.lastValue=this.value)}},hitTest:function(e){return e.x>=this._x()&&e.x<this._x()+this._width()&&e.y>=this._y()&&e.y<this._y()+this._width()?!0:!1},mousedown:function(e){this.lastPosition=e.y-this._y(),this.changeValue(e.x-this._x(),e.y-this._y())},mousemove:function(e){this.changeValue(e.x-this._x(),e.y-this._y())},mouseup:function(){},touchstart:function(e){this.lastPosition=e.y-this._y(),this.changeValue(e.x-this._x(),e.y-this._y())},touchmove:function(e){this.changeValue(e.x-this._x(),e.y-this._y())},touchend:function(){},_init:function(){var e=this.width,t=this.height;Object.defineProperty(this,"width",{configurable:!0,get:function(){return e},set:function(i){this.clear(),e=t=i,this.refresh()}}),Object.defineProperty(this,"height",{configurable:!0,get:function(){return t},set:function(e){t=e}})}}).init(arguments[0])},r.Knob.prototype=r.Widget,r.XY=function(){var e=this,t={x:0,y:0},n={x:0,y:0},o={x:0,y:0},s=0;r.extend(this,{type:"XY",_value:0,serializeMe:["childWidth","childHeight","numChildren","usePhysics","values","friction","maxVelocity","detectCollisions","fps"],childWidth:25,childHeight:25,children:[],values:[],_values:[],numChildren:1,usePhysics:!0,friction:.9,activeTouch:null,maxVelocity:10,detectCollisions:!0,touchCount:0,timer:null,fps:30,outputInitialValues:!0,rainbow:function(){for(var e=0;e<this.children.length;e++){var t=this.children[e];t.fill=r.XY.colors[e%r.XY.colors.length]}},remove:function(){this.stopAnimation(),r.widgets.splice(r.widgets.indexOf(this),1)},add:function(){this.usePhysics&&this.startAnimation()},startAnimation:function(){null===this.timer&&(this.timer=setInterval(function(){e.refresh()},1/this.fps*1e3))},stopAnimation:function(){clearInterval(this.timer),this.timer=null},animate:function(){for(var e=(this._x(),this._y(),this._width()),t=this._height(),n=!1,r=0;r<this.children.length;r++){var o=(moveY=!1,this.children[r]);o.x+o.vx<e&&o.x+o.vx>0?o.x+=o.vx:o.x+o.vx>=e&&o.vx>0?o.vx*=-1:o.x+o.vx<=0&&o.vx<0?o.vx*=-1:o.x+=o.vx,o.y+o.vy<t&&o.y+o.vy>0?o.y+=o.vy:o.y+o.vy>=t&&o.vy>0?o.vy*=-1:o.y+o.vy<=0&&o.vy<0?o.vy*=-1:o.y+=o.vy,o.vx*=this.friction,o.vy*=this.friction;var a=o.x/e,s=o.y/t,l=this.max-this.min;(this.values[o.id].x!==a||this.values[o.id].y!==s)&&(this.values[o.id].x=this.min+l*a,this.values[o.id].y=this.min+l*s,n=!0),this.detectCollisions&&(o.collideFlag?o.collideFlag=!1:this.collisionTest(o)),o.vx=Math.abs(o.vx)>this.maxVelocity?this.maxVelocity*i(o.vx):o.vx,o.vy=Math.abs(o.vy)>this.maxVelocity?this.maxVelocity*i(o.vy):o.vy}n&&(this.sendTargetMessage(),this.onvaluechange&&this.onvaluechange())},sendValues:function(){var e="";this._values.length=0;for(var t=0;t<this.values.length;t++)e+="ff",this._values.push(this.values[t].x),this._values.push(this.values[t].y);"OSC"===this.target&&r.OSC&&r.OSC.send(this.key,e,this._values)},collisionTest:function(e){for(var t=2*this.childWidth*2*this.childWidth,i=0;i<this.children.length;i++){var n=this.children[i];if(e.id!==n.id){var r=Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2);t>r&&this.collide(e,n)}}},collide:function(e,r){t.x=e.x-r.x,t.y=e.y-r.y,n.x=e.vx-r.vx,n.y=e.vy-r.vy,s=Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2)),o.x=t.x/s,o.y=t.y/s;var a=o.x*n.x+o.y*n.y;r.vx=e.vx+a*o.x,r.vy=e.vy+a*o.y,e.vx=r.vx-a*o.x,e.vy=r.vy-a*o.y,r.x-=o.x,r.y-=o.y,e.x+=o.x,e.y+=o.y,e.vx=Math.abs(e.vx)>this.maxVelocity?this.maxVelocity*i(e.vx):e.vx,e.vy=Math.abs(e.vy)>this.maxVelocity?this.maxVelocity*i(e.vy):e.vy,r.vx=Math.abs(r.vx)>this.maxVelocity?this.maxVelocity*i(r.vx):r.vx,r.vy=Math.abs(r.vy)>this.maxVelocity?this.maxVelocity*i(r.vy):r.vy,e.collideFlag=!0,r.collideFlag=!0},draw:function(){var e=this._x(),t=this._y(),i=this._width(),n=this._height();this.usePhysics&&this.animate(),this.ctx.fillStyle=this._background(),this.ctx.strokeStyle=this._stroke(),this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(e,t),this.ctx.lineTo(e+i,t),this.ctx.lineTo(e+i,t+n),this.ctx.lineTo(e,t+n),this.ctx.lineTo(e,t),this.ctx.fill(),this.ctx.stroke(),this.ctx.clip(),this.ctx.fillStyle=this._fill();for(var r=0;r<this.children.length;r++){var o=this.children[r];this.ctx.lineWidth=2,this.ctx.fillStyle=o.fill||this._fill(),this.ctx.beginPath(),this.ctx.arc(e+o.x,t+o.y,this.childWidth,0,2*Math.PI,!0),this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke(),this.ctx.textBaseline="middle",this.ctx.textAlign="center",this.ctx.fillStyle=this._stroke(),this.ctx.font=this._font(),this.ctx.fillText(o.id,e+o.x,t+o.y)}this.ctx.closePath(),this.ctx.restore()},changeValue:function(e,t,i){(this.hasFocus||!this.requiresFocus)&&(e.x=t,e.x<0&&(e.x=0),e.x>this._width()&&(e.x=this._width()),e.y=i,e.y<0&&(e.y=0),e.y>this._height()&&(e.y=this._height()),this.values[e.id].x=t/this._width(),this.values[e.id].y=i/this._height(),this.onvaluechange&&this.onvaluechange(),this.usePhysics||(this.sendTargetMessage(),this.refresh()))},makeChildren:function(){for(var e=0;e<this.numChildren;e++){var t=Math.random()*this._width(),i=Math.random()*this._height();this.children.push({id:e,x:t,y:i,vx:0,vy:0,collideFlag:!1,isActive:!1,lastPosition:null}),this.values.push({x:null,y:null})}},touchEvent:function(e){var t=this.hitTest(e),i=a(e.type);t?("touchstart"===e.type?(this.hasFocus=!0,this.touchCount++,this.trackTouch(e.x-this._x(),e.y-this._y(),e)):this[e.type]&&this[e.type](e,t,e.childID),this["on"+e.type]&&this["on"+e.type](e,t,e.childId),this["on"+i]&&this["on"+i](e,t)):"touchend"===e.type&&(this.touchCount--,0===this.touchCount?this.hasFocus=!1:this.touchCount<0&&(this.touchCount=0),this.touchend(e),this["on"+e.type]&&this["on"+e.type](e,t,e.childId),this["on"+i]&&this["on"+i](e,t))},trackMouse:function(e,t){for(var i=1e4,n=null,r=null,o=0;o<this.children.length;o++){var a=this.children[o],s=Math.abs(a.x-e),l=Math.abs(a.y-t);i>s+l&&(i=s+l,n=a,r=o)}n.isActive=!0,n.vx=0,n.vy=0,null!=n&&this.changeValue(n,e,t),this.activeTouch=n,this.activeTouch.lastTouch=null,this.lastTouched=n},mousedown:function(e){this.hitTest(e)&&this.trackMouse(e.x-this._x(),e.y-this._y())},mousemove:function(e){if(this.hitTest(e)&&null!==this.activeTouch){if(null===this.activeTouch.lastTouch)this.activeTouch.lastTouch={x:e.x-this._x(),y:e.y-this._y()};else{var t={x:e.x-this._x(),y:e.y-this._y()};this.activeTouch.velocity={x:t.x-this.activeTouch.lastTouch.x,y:t.y-this.activeTouch.lastTouch.y},this.activeTouch.lastTouch=t}this.changeValue(this.activeTouch,e.x-this._x(),e.y-this._y())}},mouseup:function(){null!==this.activeTouch&&(this.activeTouch.vx=this.activeTouch.velocity.x,this.activeTouch.vy=this.activeTouch.velocity.y,this.activeTouch.lastTouch=null,this.activeTouch=null);for(var e=0;e<this.children.length;e++)this.children[e].isActive=!1},trackTouch:function(e,t,i){for(var n=1e4,r=null,o=null,a=0;a<this.children.length;a++){var s=this.children[a],l=Math.abs(s.x-e),c=Math.abs(s.y-t);n>l+c&&!s.isActive&&(n=l+c,r=s,o=a)}return r.isActive=!0,r.vx=0,r.vy=0,r.identifier=i.identifier,r.childID=o,null!=r&&this.changeValue(r,e,t),this.lastTouched=r,r.childID},touchstart:function(){},touchmove:function(e){for(var t=0;t<this.children.length;t++)if(_t=this.children[t],e.identifier==_t.identifier){this.changeValue(_t,e.x-this._x(),e.y-this._y());var i={x:e.x-this._x(),y:e.y-this._y()};null!==_t.lastPosition&&(_t.velocity={x:i.x-_t.lastPosition.x,y:i.y-_t.lastPosition.y}),_t.lastPosition=i}},touchend:function(e){for(var t=!1,i=null,n=0;n<this.children.length;n++){var r=this.children[n];e.identifier===r.identifier&&(r.vx=r.velocity.x,r.vy=r.velocity.y,r.lastPosition=null,r.isActive=!1,t=!0,i=n.childID)}t&&(this.touchUp=i)},_init:function(){this.makeChildren(),this.outputInitialValues&&this.sendTargetMessage()}}).init(arguments[0]),this.requiresFocus=!1,this.half=this.childWidth/2;var l=this.numChildren;Object.defineProperty(this,"numChildren",{get:function(){return l},set:function(e){for(;e>l;)this.children.push({id:this.children.length,x:Math.random()*this._width(),y:Math.random()*this._height(),vx:0,vy:0,collideFlag:!1,isActive:!1,lastPosition:null}),this.values.push({x:null,y:null}),l++;for(;l>e;)this.chidren.pop(),this.values.pop(),l--;this.refresh(),l=e}})},r.XY.prototype=r.Widget,r.XY.colors=["rgba(255,0,0,.35)","rgba(0,255,0,.35)","rgba(0,0,255,.35)","rgba(0,255,255,.35)","rgba(255,0,255,.35)","rgba(255,255,0,.35)"],r.Menu=function(){r.extend(this,{type:"Menu",_value:0,serializeMe:["options","fontSize"],options:[],fontSize:15,touchEvent:function(e){this.hitTest(e)&&e.stopPropagation()},_init:function(){this.element=n("<select>");for(var e=0;e<this.options.length;e++){var t=n("<option>"+this.options[e]+"</option>");this.element.append(t)}this.element.css({position:"absolute",backgroundColor:this._background(),color:this._stroke(),left:this._x()+this.panel.x,top:this._y()+this.panel.y,width:this._width(),height:this._height(),fontSize:this.fontSize,display:"block",border:"1px solid "+this._stroke()}),this.css&&this.element.css(this.css);var i=this;this.element.change(function(){var e=i.value;i.value=i.element.val(),i.sendTargetMessage(),i.onvaluechange(i.value,e)}),this.element.val(-1!==this.options.indexOf(this.value)?this.value:this.options[0]),n(this.container).append(this.element)}}).init(arguments[0])},r.Menu.prototype=r.Widget,r.Label=function(){r.extend(this,{type:"Label",serializeMe:["size","style","hAlign","vAlign","font"],size:12,style:"normal",hAlign:"center",vAlign:"top",font:"sans-serif",draw:function(){this.ctx.font=this.style+" "+this.size+"px "+this.font,this.ctx.textAlign=this.hAlign,this.ctx.textBaseline=this.vAlign;var e,t,i=this.ctx.measureText(this.lastValue),n={x:0,y:this._y()-this.size/2,width:i.width,height:this.size};switch(this.hAlign){case"center":e=this._x()+this._width()/2,n.x=e-i.width/2;break;case"left":e=this._x(),n.x=e;break;case"right":e=this._x()+this._width(),n.x=e-i.width}switch(this.vAlign){case"middle":t=this._y()+this._height()/2,n.y=t-i.height/2;break;case"top":t=this._y(),n.y=t;break;case"bottom":t=this._y()+this._height(),n.y=t-i.height}this.ctx.clearRect(n.x,n.y,n.width,2*n.height),this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(this._x(),this._y()),this.ctx.lineTo(this._x()+this._width(),this._y()),this.ctx.lineTo(this._x()+this._width(),this._y()+this._height()),this.ctx.lineTo(this._x(),this._y()+this._height()),this.ctx.lineTo(this._x(),this._y()),this.ctx.closePath(),this.ctx.clip(),this.ctx.fillStyle=this._stroke(),this.ctx.fillText(this.value,e,t),this.ctx.restore(),this.lastValue=this.value}}).init(arguments[0]),this.lastValue=this.value},r.Label.prototype=r.Widget,r.TextField=function(){r.extend(this,{type:"TextField",serializeMe:["fontSize"],fontSize:15,touchEvent:function(e){if(this.hitTest(e)){var t=document.createEvent("TouchEvent");t.initUIEvent("touchstart",!0,!0),t.view=window,t.screenX=e.screenX,t.screenY=e.screenY,t.clientX=e.clientX,t.clientY=e.clientY,t.bubbles=!1,t.view=window,t.altKey=!1,t.ctrlKey=!1,t.shiftKey=!1,t.metaKey=!1,this.element.dispatchEvent(t)}},_init:function(){this.element=n("<input>"),0!==this.value&&this.element.val(this.value),this.element.css({position:"absolute",backgroundColor:this._background(),color:this._fill(),left:this._x()+this.panel.x,top:this._y()+this.panel.y,width:this._width(),height:this._height(),fontSize:this.fontSize,display:"block",border:"1px solid "+this._stroke()}),this.css&&this.element.css(this.css);var e=this;this.element.change(function(){var t=e.value;e.value=e.element.val(),e.sendTargetMessage(),e.onvaluechange(e.value,t)}),n(this.container).append(this.element)}}).init(arguments[0])},r.TextField.prototype=r.Widget,r.MultiSlider=function(){r.extend(this,{type:"MultiSlider",isVertical:!0,serializeMe:["isVertical","count","values"],values:[],_values:[],count:16,draw:function(){var e=this._x(),t=this._y(),i=this._width(),n=this._height(),r=i/this.count;
this.ctx.fillStyle=this._background(),this.ctx.fillRect(e,t,i,n),this.ctx.fillStyle=this._fill(),this.ctx.strokeStyle=this._stroke();for(var o=0;o<this.count;o++){var a=o*r+e;this.ctx.fillRect(a,t+n-this._values[o]*n,r,this._values[o]*n),this.ctx.strokeRect(a,t,r,n)}},setValue:function(e,t){this.values[e]=t,this._values[e]=t,this.refresh()},changeValue:function(e,t){if(this.hasFocus||!this.requiresFocus){var i=this._width(),n=i/this.count,o=Math.floor(e/n);_value=0,_value=1-t/this._height(),0>_value?_value=0:_value>1&&(_value=1),this.values[o]=this.min+(this.max-this.min)*_value,this._values[o]=_value,"OSC"!==this.target?this.sendTargetMessage():r.OSC&&r.OSC.send(this.key,"if",[o,this.values[o]]),this.onvaluechange&&this.onvaluechange(o,this.values[o]),this.refresh()}},mousedown:function(e,t){t&&r.mouseDown&&this.changeValue(e.x-this._x(),e.y-this._y())},mousemove:function(e,t){t&&r.mouseDown&&this.changeValue(e.x-this._x(),e.y-this._y())},mouseup:function(e,t){t&&r.mouseDown&&this.changeValue(e.x-this._x(),e.y-this._y())},touchstart:function(e,t){t&&this.changeValue(e.x-this._x(),e.y-this._y())},touchmove:function(e,t){t&&this.changeValue(e.x-this._x(),e.y-this._y())},touchend:function(e,t){t&&this.changeValue(e.x-this._x(),e.y-this._y())},onvaluechange:function(){}}).init(arguments[0]);var e=this.x,t=this.y,i=this.width,n=this.height,o=[e,t,i,n],a=this.count;delete this.bounds,Object.defineProperties(this,{x:{get:function(){return e},set:function(t){e=t,this.refresh()}},y:{get:function(){return t},set:function(e){t=e,this.refresh()}},width:{get:function(){return i},set:function(e){i=e,this.refresh()}},height:{get:function(){return n},set:function(e){n=e,this.refresh()}},bounds:{get:function(){return o},set:function(r){o=r,e=o[0],t=o[1],i=o[2],n=o[3],this.refresh()}},count:{get:function(){return a},set:function(e){a=e,this.refresh()}}})},r.MultiSlider.prototype=r.Widget,r.MultiButton=function(){r.extend(this,{type:"MultiButton",mode:"toggle",serializeMe:["mode","rows","columns","requiresFocus"],rows:8,values:[],_values:[],lastValues:[],mouseOver:null,columns:8,draw:function(){var e=this._x(),t=this._y(),i=this._width(),n=this._height(),r=i/this.columns,o=n/this.rows;this.ctx.strokeStyle=this._stroke();for(var a=0;a<this.rows;a++)for(var s=0;s<this.columns;s++){var l=e+s*r,c=t+a*o,h=a*this.columns+s;this.ctx.fillStyle=this._values[h]?this._fill():this._background(),this.ctx.fillRect(l,c,r,o),this.ctx.strokeRect(l,c,r,o)}},setValue:function(e,t,i){var n=e*this.columns+t;this._values[n]=this.values[n]=this.lastValues[n]=i,this.draw()},changeValue:function(e,t){if(this.hasFocus||!this.requiresFocus){var i=this._width(),n=this._height(),o=i/this.columns,a=Math.floor(e/o),s=n/this.rows,l=Math.floor(t/s),c=l*this.columns+a;if(c!==this.mouseOver){if(this._values[c]=!this._values[c],this.values[c]=this._values[c]?this.max:this.min,(this.values[c]!==this.lastValues[c]||"contact"===this.mode)&&("OSC"!==this.target?this.sendTargetMessage():r.OSC&&r.OSC.send(this.key,"iif",[l,a,this.values[c]]),this.onvaluechange&&this.onvaluechange(l,a,this.values[c]),this.draw(),this.lastValues[c]=this.values[c],"contact"===this.mode)){var h=this;setTimeout(function(){h._values[c]=0,h.draw()},75)}this.mouseOver=c}}},mousedown:function(e,t){t&&r.mouseDown&&this.changeValue(e.x-this._x(),e.y-this._y())},mousemove:function(e,t){t&&r.mouseDown&&this.changeValue(e.x-this._x(),e.y-this._y())},mouseup:function(e,t){t&&r.mouseDown&&this.changeValue(e.x-this._x(),e.y-this._y()),this.mouseOver=null},touchstart:function(e,t){t&&this.changeValue(e.x-this._x(),e.y-this._y())},touchmove:function(e,t){t&&this.changeValue(e.x-this._x(),e.y-this._y())},touchend:function(e,t){t&&this.changeValue(e.x-this._x(),e.y-this._y())}}).init(arguments[0]),this.requiresFocus=!1;var e=this.x,t=this.y,i=this.width,n=this.height,o=[e,t,i,n];rows=this.rows,columns=this.columns,delete this.bounds,Object.defineProperties(this,{x:{get:function(){return e},set:function(t){e=t,this.refresh()}},y:{get:function(){return t},set:function(e){t=e,this.refresh()}},width:{get:function(){return i},set:function(e){i=e,this.refresh()}},height:{get:function(){return n},set:function(e){n=e,this.refresh()}},bounds:{get:function(){return o},set:function(r){o=r,e=o[0],t=o[1],i=o[2],n=o[3],this.refresh()}},rows:{get:function(){return rows},set:function(e){rows=e,this.refresh()}},columns:{get:function(){return columns},set:function(e){columns=e,this.refresh()}}})},r.MultiButton.prototype=r.Widget,r.Accelerometer=function(){var e=this,t=9.80665;r.extend(this,{type:"Accelerometer",serializeMe:["delay"],delay:100,min:0,max:1,values:[0,0,0],update:function(t){var i=t.acceleration;e.x=e.values[0]=e.min+(0-e.hardwareMin+i.x)/e.hardwareRange*e.max,e.y=e.values[1]=e.min+(0-e.hardwareMin+i.y)/e.hardwareRange*e.max,e.z=e.values[2]=e.min+(0-e.hardwareMin+i.z)/e.hardwareRange*e.max,"undefined"!=typeof e.onvaluechange&&e.onvaluechange(e.x,e.y,e.z),e.sendTargetMessage()},start:function(){return window.addEventListener("devicemotion",this.update,!0),this},stop:function(){return window.removeEventListener("devicemotion",this.update),this}}).init(arguments[0]),r.isAndroid?(this.hardwareMin=t,this.hardwareMax=t):(this.hardwareMin=-2.307*t,this.hardwareMax=2.307*t),this.hardwareRange=this.hardwareMax-this.hardwareMin},r.Accelerometer.prototype=r.Widget,r.Orientation=function(){var e=this;r.extend(this,{type:"Orientation",serializeMe:["delay"],delay:100,values:[0,0,0],update:function(t){e.roll=e.values[0]=e.min+(90+t.gamma)/180*e.max,e.pitch=e.values[1]=e.min+(180+t.beta)/360*e.max,e.yaw=e.values[2]=e.min+t.alpha/360*e.max,isNaN(t.webkitCompassHeading)||(e.heading=e.min+t.webkitCompassHeading/360*e.max),e.sendTargetMessage(),"undefined"!=typeof e.onvaluechange&&e.onvaluechange(e.pitch,e.roll,e.yaw,e.heading)},start:function(){return window.addEventListener("deviceorientation",function(t){e.update(t)},!0),this},stop:function(){window.removeEventListener("deviceorientation")}}).init(arguments[0])},r.Orientation.prototype=r.Widget,r.Range=function(){r.extend(this,{type:"Range",serializeMe:["handleSize"],handleSize:20,values:[0,1],_values:[0,1],draw:function(){var e=this._x(),t=this._y(),i=this._width(),n=this._height();this.ctx.fillStyle=this._background(),this.ctx.clearRect(e,t,i,n);var r=e+this._values[1]*i-this.handleSize,o=e+this._values[0]*i;this.ctx.fillStyle=this._background(),this.ctx.fillRect(e,t,i,n),this.ctx.fillStyle=this._fill(),this.ctx.fillRect(o,t,r-o,n),this.ctx.fillStyle=this._stroke(),this.ctx.fillRect(o,t,this.handleSize,n),this.ctx.fillRect(r,t,this.handleSize,n),this.ctx.strokeStyle=this._stroke(),this.ctx.strokeRect(e,t,i,n)},changeValue:function(e,t){if(this.hasFocus||!this.requiresFocus){var i=this.isVertical?1-t/this._height():e/this._width();0>i?i=0:i>1&&(i=1);var n=this.max-this.min;Math.abs(i-this._values[0])<Math.abs(i-this._values[1])?(this._values[0]=i,this.values[0]=this.min+n*i):(this._values[1]=i,this.values[1]=this.min+n*i),this.refresh(),(this.values[0]!==this.lastLeftValue||this.values[1]!==this.lastRightValue)&&(this.onvaluechange&&this.onvaluechange(this.values[0],this.values[1]),this.refresh(),this.lastLeftValue=this.values[0],this.lastRightValue=this.values[1],this.sendTargetMessage())}},mousedown:function(e,t){t&&r.mouseDown&&this.changeValue(e.x-this._x(),e.y-this._y())},mousemove:function(e,t){t&&r.mouseDown&&this.changeValue(e.x-this._x(),e.y-this._y())},mouseup:function(e,t){t&&r.mouseDown&&this.changeValue(e.x-this._x(),e.y-this._y())},touchstart:function(e,t){t&&this.changeValue(e.x-this._x(),e.y-this._y())},touchmove:function(e,t){t&&this.changeValue(e.x-this._x(),e.y-this._y())},touchend:function(e,t){t&&this.changeValue(e.x-this._x(),e.y-this._y())}}).init(arguments[0])},r.Range.prototype=r.Widget,r.Paint=function(){r.extend(this,{lines:[],startTime:0,isAnimating:!1,animationPoint:0,timer:null,shouldLoop:!0,prevTimestamp:null,values:[0,0],draw:function(){var e=this._x(),t=this._y(),i=this._width(),n=this._height();if(this.ctx.fillStyle=this._background(),this.ctx.strokeStyle=this._stroke(),this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(e,t),this.ctx.lineTo(e+i,t),this.ctx.lineTo(e+i,t+n),this.ctx.lineTo(e,t+n),this.ctx.lineTo(e,t),this.ctx.fill(),this.ctx.stroke(),this.ctx.clip(),this.ctx.fillStyle=this._fill(),this.lines.length>=1){this.ctx.lineWidth=8;for(var r=0;r<this.lines.length;r++){var o=this.lines[r];if(o.length>=2){this.ctx.moveTo(o[0].x*i,o[0].y*n),this.ctx.beginPath();for(var a=1;a<o.length-2;a++){var s=(o[a].x+o[a+1].x)/2,l=(o[a].y+o[a+1].y)/2;this.ctx.quadraticCurveTo(o[a].x*i,o[a].y*n,s*i,l*n)}this.ctx.stroke()}}}this.ctx.restore()},animate:function(){var e=this;if(this.isAnimating!==!1){var t=this.lines[0],i=t[this.animationPoint],n=t[this.animationPoint+1];if(this.animationPoint>=t.length-1){if(this.shouldLoop)return this.animationPoint=0,this.draw(),void(this.timeout=setTimeout(function(){e.animate()},5));if(this.ctx.fillStyle=this._background(),this.ctx.fillRect(0,0,this._width(),this._height()),0!==this.speedMod)return}this.ctx.save(),this.ctx.strokeStyle="#f00",this.ctx.lineWidth=8,this.ctx.beginPath(),this.ctx.moveTo(i.x*this._width(),i.y*this._height()),this.ctx.lineTo(n.x*this._width(),n.y*this._height()),this.ctx.stroke(),this.ctx.restore(),this.timeout=setTimeout(function(){e.animate()},i.timestamp-this.prevTimestamp),this.prevTimestamp=i.timestamp,this.animationPoint++,this.values=[i.x,i.y],this.sendTargetMessage()}},startAnimation:function(){this.animate()},stopAnimation:function(){this.timer&&clearInterval(this.timer)},mousedown:function(e){this.hitTest(e)&&(this.lines=[],this.animationPoint=0,0===this.lines.length&&(this.startTime=Date.now()),this.lines.push([]),this.isDrawing=!0,this.isAnimating=!1)},mousemove:function(e){if(this.hitTest(e)&&null!==this.activeTouch&&this.isDrawing){var t=this.lines[this.lines.length-1];t&&(t.push({x:e.x/this._width(),y:e.y/this._height(),timestamp:Date.now()-this.startTime}),this.draw())}},mouseup:function(){this.isDrawing=!1,this.lines.length>0&&(this.isAnimating=!0,this.animate())}}).init(arguments[0])},r.Paint.prototype=r.Widget,r.defineChildProperties=function(e,t){for(var i=0;i<t.length;i++)!function(){var n=t[i],r=e[n];Object.defineProperty(e,n,{get:function(){return r},set:function(t){r=t;for(var i=0;i<e.children.length;i++)e.children[i][n]=r}})}()},t.exports=r}()},{jquery:58}],58:[function(e,t){!function(e,i){"object"==typeof t&&"object"==typeof t.exports?t.exports=e.document?i(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return i(e)}:i(e)}("undefined"!=typeof window?window:this,function(e,t){function i(e){var t=e.length,i=J.type(e);return"function"===i||J.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===i||0===t||"number"==typeof t&&t>0&&t-1 in e}function n(e,t,i){if(J.isFunction(t))return J.grep(e,function(e,n){return!!t.call(e,n,e)!==i});if(t.nodeType)return J.grep(e,function(e){return e===t!==i});if("string"==typeof t){if(st.test(t))return J.filter(t,e,i);t=J.filter(t,e)}return J.grep(e,function(e){return W.call(t,e)>=0!==i})}function r(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}function o(e){var t=dt[e]={};return J.each(e.match(pt)||[],function(e,i){t[i]=!0}),t}function a(){Q.removeEventListener("DOMContentLoaded",a,!1),e.removeEventListener("load",a,!1),J.ready()}function s(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=J.expando+Math.random()}function l(e,t,i){var n;if(void 0===i&&1===e.nodeType)if(n="data-"+t.replace(xt,"-$1").toLowerCase(),i=e.getAttribute(n),"string"==typeof i){try{i="true"===i?!0:"false"===i?!1:"null"===i?null:+i+""===i?+i:bt.test(i)?J.parseJSON(i):i}catch(r){}yt.set(e,t,i)}else i=void 0;return i}function c(){return!0}function h(){return!1}function u(){try{return Q.activeElement}catch(e){}}function f(e,t){return J.nodeName(e,"table")&&J.nodeName(11!==t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function p(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function d(e){var t=Nt.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function m(e,t){for(var i=0,n=e.length;n>i;i++)vt.set(e[i],"globalEval",!t||vt.get(t[i],"globalEval"))}function g(e,t){var i,n,r,o,a,s,l,c;if(1===t.nodeType){if(vt.hasData(e)&&(o=vt.access(e),a=vt.set(t,o),c=o.events)){delete a.handle,a.events={};for(r in c)for(i=0,n=c[r].length;n>i;i++)J.event.add(t,r,c[r][i])}yt.hasData(e)&&(s=yt.access(e),l=J.extend({},s),yt.set(t,l))}}function v(e,t){var i=e.getElementsByTagName?e.getElementsByTagName(t||"*"):e.querySelectorAll?e.querySelectorAll(t||"*"):[];return void 0===t||t&&J.nodeName(e,t)?J.merge([e],i):i}function y(e,t){var i=t.nodeName.toLowerCase();"input"===i&&Mt.test(e.type)?t.checked=e.checked:("input"===i||"textarea"===i)&&(t.defaultValue=e.defaultValue)}function b(t,i){var n,r=J(i.createElement(t)).appendTo(i.body),o=e.getDefaultComputedStyle&&(n=e.getDefaultComputedStyle(r[0]))?n.display:J.css(r[0],"display");return r.detach(),o}function x(e){var t=Q,i=It[e];return i||(i=b(e,t),"none"!==i&&i||(jt=(jt||J("<iframe frameborder='0' width='0' height='0'/>")).appendTo(t.documentElement),t=jt[0].contentDocument,t.write(),t.close(),i=b(e,t),jt.detach()),It[e]=i),i}function w(e,t,i){var n,r,o,a,s=e.style;return i=i||Bt(e),i&&(a=i.getPropertyValue(t)||i[t]),i&&(""!==a||J.contains(e.ownerDocument,e)||(a=J.style(e,t)),zt.test(a)&&Ut.test(t)&&(n=s.width,r=s.minWidth,o=s.maxWidth,s.minWidth=s.maxWidth=s.width=a,a=i.width,s.width=n,s.minWidth=r,s.maxWidth=o)),void 0!==a?a+"":a}function _(e,t){return{get:function(){return e()?void delete this.get:(this.get=t).apply(this,arguments)}}}function S(e,t){if(t in e)return t;for(var i=t[0].toUpperCase()+t.slice(1),n=t,r=Kt.length;r--;)if(t=Kt[r]+i,t in e)return t;return n}function M(e,t,i){var n=qt.exec(t);return n?Math.max(0,n[1]-(i||0))+(n[2]||"px"):t}function C(e,t,i,n,r){for(var o=i===(n?"border":"content")?4:"width"===t?1:0,a=0;4>o;o+=2)"margin"===i&&(a+=J.css(e,i+_t[o],!0,r)),n?("content"===i&&(a-=J.css(e,"padding"+_t[o],!0,r)),"margin"!==i&&(a-=J.css(e,"border"+_t[o]+"Width",!0,r))):(a+=J.css(e,"padding"+_t[o],!0,r),"padding"!==i&&(a+=J.css(e,"border"+_t[o]+"Width",!0,r)));return a}function T(e,t,i){var n=!0,r="width"===t?e.offsetWidth:e.offsetHeight,o=Bt(e),a="border-box"===J.css(e,"boxSizing",!1,o);if(0>=r||null==r){if(r=w(e,t,o),(0>r||null==r)&&(r=e.style[t]),zt.test(r))return r;n=a&&($.boxSizingReliable()||r===e.style[t]),r=parseFloat(r)||0}return r+C(e,t,i||(a?"border":"content"),n,o)+"px"}function A(e,t){for(var i,n,r,o=[],a=0,s=e.length;s>a;a++)n=e[a],n.style&&(o[a]=vt.get(n,"olddisplay"),i=n.style.display,t?(o[a]||"none"!==i||(n.style.display=""),""===n.style.display&&St(n)&&(o[a]=vt.access(n,"olddisplay",x(n.nodeName)))):(r=St(n),"none"===i&&r||vt.set(n,"olddisplay",r?i:J.css(n,"display"))));for(a=0;s>a;a++)n=e[a],n.style&&(t&&"none"!==n.style.display&&""!==n.style.display||(n.style.display=t?o[a]||"":"none"));return e}function E(e,t,i,n,r){return new E.prototype.init(e,t,i,n,r)}function P(){return setTimeout(function(){$t=void 0}),$t=J.now()}function k(e,t){var i,n=0,r={height:e};for(t=t?1:0;4>n;n+=2-t)i=_t[n],r["margin"+i]=r["padding"+i]=e;return t&&(r.opacity=r.width=e),r}function R(e,t,i){for(var n,r=(ii[t]||[]).concat(ii["*"]),o=0,a=r.length;a>o;o++)if(n=r[o].call(i,t,e))return n}function L(e,t,i){var n,r,o,a,s,l,c,h,u=this,f={},p=e.style,d=e.nodeType&&St(e),m=vt.get(e,"fxshow");i.queue||(s=J._queueHooks(e,"fx"),null==s.unqueued&&(s.unqueued=0,l=s.empty.fire,s.empty.fire=function(){s.unqueued||l()}),s.unqueued++,u.always(function(){u.always(function(){s.unqueued--,J.queue(e,"fx").length||s.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(i.overflow=[p.overflow,p.overflowX,p.overflowY],c=J.css(e,"display"),h="none"===c?vt.get(e,"olddisplay")||x(e.nodeName):c,"inline"===h&&"none"===J.css(e,"float")&&(p.display="inline-block")),i.overflow&&(p.overflow="hidden",u.always(function(){p.overflow=i.overflow[0],p.overflowX=i.overflow[1],p.overflowY=i.overflow[2]}));for(n in t)if(r=t[n],Zt.exec(r)){if(delete t[n],o=o||"toggle"===r,r===(d?"hide":"show")){if("show"!==r||!m||void 0===m[n])continue;d=!0}f[n]=m&&m[n]||J.style(e,n)}else c=void 0;if(J.isEmptyObject(f))"inline"===("none"===c?x(e.nodeName):c)&&(p.display=c);else{m?"hidden"in m&&(d=m.hidden):m=vt.access(e,"fxshow",{}),o&&(m.hidden=!d),d?J(e).show():u.done(function(){J(e).hide()}),u.done(function(){var t;vt.remove(e,"fxshow");for(t in f)J.style(e,t,f[t])});for(n in f)a=R(d?m[n]:0,n,u),n in m||(m[n]=a.start,d&&(a.end=a.start,a.start="width"===n||"height"===n?1:0))}}function D(e,t){var i,n,r,o,a;for(i in e)if(n=J.camelCase(i),r=t[n],o=e[i],J.isArray(o)&&(r=o[1],o=e[i]=o[0]),i!==n&&(e[n]=o,delete e[i]),a=J.cssHooks[n],a&&"expand"in a){o=a.expand(o),delete e[n];for(i in o)i in e||(e[i]=o[i],t[i]=r)}else t[n]=r}function F(e,t,i){var n,r,o=0,a=ti.length,s=J.Deferred().always(function(){delete l.elem}),l=function(){if(r)return!1;for(var t=$t||P(),i=Math.max(0,c.startTime+c.duration-t),n=i/c.duration||0,o=1-n,a=0,l=c.tweens.length;l>a;a++)c.tweens[a].run(o);return s.notifyWith(e,[c,o,i]),1>o&&l?i:(s.resolveWith(e,[c]),!1)},c=s.promise({elem:e,props:J.extend({},t),opts:J.extend(!0,{specialEasing:{}},i),originalProperties:t,originalOptions:i,startTime:$t||P(),duration:i.duration,tweens:[],createTween:function(t,i){var n=J.Tween(e,c.opts,t,i,c.opts.specialEasing[t]||c.opts.easing);return c.tweens.push(n),n},stop:function(t){var i=0,n=t?c.tweens.length:0;if(r)return this;for(r=!0;n>i;i++)c.tweens[i].run(1);return t?s.resolveWith(e,[c,t]):s.rejectWith(e,[c,t]),this}}),h=c.props;for(D(h,c.opts.specialEasing);a>o;o++)if(n=ti[o].call(c,e,h,c.opts))return n;return J.map(h,R,c),J.isFunction(c.opts.start)&&c.opts.start.call(e,c),J.fx.timer(J.extend(l,{elem:e,anim:c,queue:c.opts.queue})),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always)}function G(e){return function(t,i){"string"!=typeof t&&(i=t,t="*");var n,r=0,o=t.toLowerCase().match(pt)||[];if(J.isFunction(i))for(;n=o[r++];)"+"===n[0]?(n=n.slice(1)||"*",(e[n]=e[n]||[]).unshift(i)):(e[n]=e[n]||[]).push(i)}}function N(e,t,i,n){function r(s){var l;return o[s]=!0,J.each(e[s]||[],function(e,s){var c=s(t,i,n);return"string"!=typeof c||a||o[c]?a?!(l=c):void 0:(t.dataTypes.unshift(c),r(c),!1)}),l}var o={},a=e===wi;return r(t.dataTypes[0])||!o["*"]&&r("*")}function V(e,t){var i,n,r=J.ajaxSettings.flatOptions||{};for(i in t)void 0!==t[i]&&((r[i]?e:n||(n={}))[i]=t[i]);return n&&J.extend(!0,e,n),e}function O(e,t,i){for(var n,r,o,a,s=e.contents,l=e.dataTypes;"*"===l[0];)l.shift(),void 0===n&&(n=e.mimeType||t.getResponseHeader("Content-Type"));if(n)for(r in s)if(s[r]&&s[r].test(n)){l.unshift(r);break}if(l[0]in i)o=l[0];else{for(r in i){if(!l[0]||e.converters[r+" "+l[0]]){o=r;break}a||(a=r)}o=o||a}return o?(o!==l[0]&&l.unshift(o),i[o]):void 0}function j(e,t,i,n){var r,o,a,s,l,c={},h=e.dataTypes.slice();if(h[1])for(a in e.converters)c[a.toLowerCase()]=e.converters[a];for(o=h.shift();o;)if(e.responseFields[o]&&(i[e.responseFields[o]]=t),!l&&n&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l=o,o=h.shift())if("*"===o)o=l;else if("*"!==l&&l!==o){if(a=c[l+" "+o]||c["* "+o],!a)for(r in c)if(s=r.split(" "),s[1]===o&&(a=c[l+" "+s[0]]||c["* "+s[0]])){a===!0?a=c[r]:c[r]!==!0&&(o=s[0],h.unshift(s[1]));break}if(a!==!0)if(a&&e["throws"])t=a(t);else try{t=a(t)}catch(u){return{state:"parsererror",error:a?u:"No conversion from "+l+" to "+o}}}return{state:"success",data:t}}function I(e,t,i,n){var r;if(J.isArray(t))J.each(t,function(t,r){i||Ci.test(e)?n(e,r):I(e+"["+("object"==typeof r?t:"")+"]",r,i,n)});else if(i||"object"!==J.type(t))n(e,t);else for(r in t)I(e+"["+r+"]",t[r],i,n)}function U(e){return J.isWindow(e)?e:9===e.nodeType&&e.defaultView}var z=[],B=z.slice,H=z.concat,q=z.push,W=z.indexOf,X={},Y=X.toString,K=X.hasOwnProperty,$={},Q=e.document,Z="2.1.1",J=function(e,t){return new J.fn.init(e,t)},et=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,tt=/^-ms-/,it=/-([\da-z])/gi,nt=function(e,t){return t.toUpperCase()};J.fn=J.prototype={jquery:Z,constructor:J,selector:"",length:0,toArray:function(){return B.call(this)},get:function(e){return null!=e?0>e?this[e+this.length]:this[e]:B.call(this)},pushStack:function(e){var t=J.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return J.each(this,e,t)},map:function(e){return this.pushStack(J.map(this,function(t,i){return e.call(t,i,t)}))},slice:function(){return this.pushStack(B.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,i=+e+(0>e?t:0);return this.pushStack(i>=0&&t>i?[this[i]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:q,sort:z.sort,splice:z.splice},J.extend=J.fn.extend=function(){var e,t,i,n,r,o,a=arguments[0]||{},s=1,l=arguments.length,c=!1;for("boolean"==typeof a&&(c=a,a=arguments[s]||{},s++),"object"==typeof a||J.isFunction(a)||(a={}),s===l&&(a=this,s--);l>s;s++)if(null!=(e=arguments[s]))for(t in e)i=a[t],n=e[t],a!==n&&(c&&n&&(J.isPlainObject(n)||(r=J.isArray(n)))?(r?(r=!1,o=i&&J.isArray(i)?i:[]):o=i&&J.isPlainObject(i)?i:{},a[t]=J.extend(c,o,n)):void 0!==n&&(a[t]=n));return a},J.extend({expando:"jQuery"+(Z+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===J.type(e)},isArray:Array.isArray,isWindow:function(e){return null!=e&&e===e.window},isNumeric:function(e){return!J.isArray(e)&&e-parseFloat(e)>=0},isPlainObject:function(e){return"object"!==J.type(e)||e.nodeType||J.isWindow(e)?!1:e.constructor&&!K.call(e.constructor.prototype,"isPrototypeOf")?!1:!0},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?X[Y.call(e)]||"object":typeof e},globalEval:function(e){var t,i=eval;e=J.trim(e),e&&(1===e.indexOf("use strict")?(t=Q.createElement("script"),t.text=e,Q.head.appendChild(t).parentNode.removeChild(t)):i(e))},camelCase:function(e){return e.replace(tt,"ms-").replace(it,nt)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,o=0,a=e.length,s=i(e);if(n){if(s)for(;a>o&&(r=t.apply(e[o],n),r!==!1);o++);else for(o in e)if(r=t.apply(e[o],n),r===!1)break}else if(s)for(;a>o&&(r=t.call(e[o],o,e[o]),r!==!1);o++);else for(o in e)if(r=t.call(e[o],o,e[o]),r===!1)break;return e},trim:function(e){return null==e?"":(e+"").replace(et,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(i(Object(e))?J.merge(n,"string"==typeof e?[e]:e):q.call(n,e)),n},inArray:function(e,t,i){return null==t?-1:W.call(t,e,i)},merge:function(e,t){for(var i=+t.length,n=0,r=e.length;i>n;n++)e[r++]=t[n];return e.length=r,e},grep:function(e,t,i){for(var n,r=[],o=0,a=e.length,s=!i;a>o;o++)n=!t(e[o],o),n!==s&&r.push(e[o]);return r},map:function(e,t,n){var r,o=0,a=e.length,s=i(e),l=[];if(s)for(;a>o;o++)r=t(e[o],o,n),null!=r&&l.push(r);else for(o in e)r=t(e[o],o,n),null!=r&&l.push(r);return H.apply([],l)},guid:1,proxy:function(e,t){var i,n,r;return"string"==typeof t&&(i=e[t],t=e,e=i),J.isFunction(e)?(n=B.call(arguments,2),r=function(){return e.apply(t||this,n.concat(B.call(arguments)))},r.guid=e.guid=e.guid||J.guid++,r):void 0},now:Date.now,support:$}),J.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){X["[object "+t+"]"]=t.toLowerCase()});var rt=function(e){function t(e,t,i,n){var r,o,a,s,l,c,u,p,d,m;if((t?t.ownerDocument||t:I)!==L&&R(t),t=t||L,i=i||[],!e||"string"!=typeof e)return i;if(1!==(s=t.nodeType)&&9!==s)return[];if(F&&!n){if(r=yt.exec(e))if(a=r[1]){if(9===s){if(o=t.getElementById(a),!o||!o.parentNode)return i;if(o.id===a)return i.push(o),i}else if(t.ownerDocument&&(o=t.ownerDocument.getElementById(a))&&O(t,o)&&o.id===a)return i.push(o),i}else{if(r[2])return J.apply(i,t.getElementsByTagName(e)),i;if((a=r[3])&&w.getElementsByClassName&&t.getElementsByClassName)return J.apply(i,t.getElementsByClassName(a)),i}if(w.qsa&&(!G||!G.test(e))){if(p=u=j,d=t,m=9===s&&e,1===s&&"object"!==t.nodeName.toLowerCase()){for(c=C(e),(u=t.getAttribute("id"))?p=u.replace(xt,"\\$&"):t.setAttribute("id",p),p="[id='"+p+"'] ",l=c.length;l--;)c[l]=p+f(c[l]);d=bt.test(e)&&h(t.parentNode)||t,m=c.join(",")}if(m)try{return J.apply(i,d.querySelectorAll(m)),i}catch(g){}finally{u||t.removeAttribute("id")}}}return A(e.replace(lt,"$1"),t,i,n)}function i(){function e(i,n){return t.push(i+" ")>_.cacheLength&&delete e[t.shift()],e[i+" "]=n}var t=[];return e}function n(e){return e[j]=!0,e}function r(e){var t=L.createElement("div");try{return!!e(t)}catch(i){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function o(e,t){for(var i=e.split("|"),n=e.length;n--;)_.attrHandle[i[n]]=t}function a(e,t){var i=t&&e,n=i&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||Y)-(~e.sourceIndex||Y);if(n)return n;if(i)for(;i=i.nextSibling;)if(i===t)return-1;return e?1:-1}function s(e){return function(t){var i=t.nodeName.toLowerCase();return"input"===i&&t.type===e}}function l(e){return function(t){var i=t.nodeName.toLowerCase();return("input"===i||"button"===i)&&t.type===e}}function c(e){return n(function(t){return t=+t,n(function(i,n){for(var r,o=e([],i.length,t),a=o.length;a--;)i[r=o[a]]&&(i[r]=!(n[r]=i[r]))})})}function h(e){return e&&typeof e.getElementsByTagName!==X&&e}function u(){}function f(e){for(var t=0,i=e.length,n="";i>t;t++)n+=e[t].value;return n}function p(e,t,i){var n=t.dir,r=i&&"parentNode"===n,o=z++;return t.first?function(t,i,o){for(;t=t[n];)if(1===t.nodeType||r)return e(t,i,o)}:function(t,i,a){var s,l,c=[U,o];if(a){for(;t=t[n];)if((1===t.nodeType||r)&&e(t,i,a))return!0}else for(;t=t[n];)if(1===t.nodeType||r){if(l=t[j]||(t[j]={}),(s=l[n])&&s[0]===U&&s[1]===o)return c[2]=s[2];if(l[n]=c,c[2]=e(t,i,a))return!0}}}function d(e){return e.length>1?function(t,i,n){for(var r=e.length;r--;)if(!e[r](t,i,n))return!1;return!0}:e[0]}function m(e,i,n){for(var r=0,o=i.length;o>r;r++)t(e,i[r],n);return n}function g(e,t,i,n,r){for(var o,a=[],s=0,l=e.length,c=null!=t;l>s;s++)(o=e[s])&&(!i||i(o,n,r))&&(a.push(o),c&&t.push(s));return a}function v(e,t,i,r,o,a){return r&&!r[j]&&(r=v(r)),o&&!o[j]&&(o=v(o,a)),n(function(n,a,s,l){var c,h,u,f=[],p=[],d=a.length,v=n||m(t||"*",s.nodeType?[s]:s,[]),y=!e||!n&&t?v:g(v,f,e,s,l),b=i?o||(n?e:d||r)?[]:a:y;if(i&&i(y,b,s,l),r)for(c=g(b,p),r(c,[],s,l),h=c.length;h--;)(u=c[h])&&(b[p[h]]=!(y[p[h]]=u));if(n){if(o||e){if(o){for(c=[],h=b.length;h--;)(u=b[h])&&c.push(y[h]=u);o(null,b=[],c,l)}for(h=b.length;h--;)(u=b[h])&&(c=o?tt.call(n,u):f[h])>-1&&(n[c]=!(a[c]=u))}}else b=g(b===a?b.splice(d,b.length):b),o?o(null,a,b,l):J.apply(a,b)})}function y(e){for(var t,i,n,r=e.length,o=_.relative[e[0].type],a=o||_.relative[" "],s=o?1:0,l=p(function(e){return e===t},a,!0),c=p(function(e){return tt.call(t,e)>-1},a,!0),h=[function(e,i,n){return!o&&(n||i!==E)||((t=i).nodeType?l(e,i,n):c(e,i,n))}];r>s;s++)if(i=_.relative[e[s].type])h=[p(d(h),i)];else{if(i=_.filter[e[s].type].apply(null,e[s].matches),i[j]){for(n=++s;r>n&&!_.relative[e[n].type];n++);return v(s>1&&d(h),s>1&&f(e.slice(0,s-1).concat({value:" "===e[s-2].type?"*":""})).replace(lt,"$1"),i,n>s&&y(e.slice(s,n)),r>n&&y(e=e.slice(n)),r>n&&f(e))}h.push(i)}return d(h)}function b(e,i){var r=i.length>0,o=e.length>0,a=function(n,a,s,l,c){var h,u,f,p=0,d="0",m=n&&[],v=[],y=E,b=n||o&&_.find.TAG("*",c),x=U+=null==y?1:Math.random()||.1,w=b.length;for(c&&(E=a!==L&&a);d!==w&&null!=(h=b[d]);d++){if(o&&h){for(u=0;f=e[u++];)if(f(h,a,s)){l.push(h);break}c&&(U=x)}r&&((h=!f&&h)&&p--,n&&m.push(h))}if(p+=d,r&&d!==p){for(u=0;f=i[u++];)f(m,v,a,s);if(n){if(p>0)for(;d--;)m[d]||v[d]||(v[d]=Q.call(l));v=g(v)}J.apply(l,v),c&&!n&&v.length>0&&p+i.length>1&&t.uniqueSort(l)}return c&&(U=x,E=y),m};return r?n(a):a}var x,w,_,S,M,C,T,A,E,P,k,R,L,D,F,G,N,V,O,j="sizzle"+-new Date,I=e.document,U=0,z=0,B=i(),H=i(),q=i(),W=function(e,t){return e===t&&(k=!0),0},X="undefined",Y=1<<31,K={}.hasOwnProperty,$=[],Q=$.pop,Z=$.push,J=$.push,et=$.slice,tt=$.indexOf||function(e){for(var t=0,i=this.length;i>t;t++)if(this[t]===e)return t;return-1},it="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",nt="[\\x20\\t\\r\\n\\f]",rt="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",ot=rt.replace("w","w#"),at="\\["+nt+"*("+rt+")(?:"+nt+"*([*^$|!~]?=)"+nt+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+ot+"))|)"+nt+"*\\]",st=":("+rt+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+at+")*)|.*)\\)|)",lt=new RegExp("^"+nt+"+|((?:^|[^\\\\])(?:\\\\.)*)"+nt+"+$","g"),ct=new RegExp("^"+nt+"*,"+nt+"*"),ht=new RegExp("^"+nt+"*([>+~]|"+nt+")"+nt+"*"),ut=new RegExp("="+nt+"*([^\\]'\"]*?)"+nt+"*\\]","g"),ft=new RegExp(st),pt=new RegExp("^"+ot+"$"),dt={ID:new RegExp("^#("+rt+")"),CLASS:new RegExp("^\\.("+rt+")"),TAG:new RegExp("^("+rt.replace("w","w*")+")"),ATTR:new RegExp("^"+at),PSEUDO:new RegExp("^"+st),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+nt+"*(even|odd|(([+-]|)(\\d*)n|)"+nt+"*(?:([+-]|)"+nt+"*(\\d+)|))"+nt+"*\\)|)","i"),bool:new RegExp("^(?:"+it+")$","i"),needsContext:new RegExp("^"+nt+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+nt+"*((?:-\\d)?\\d*)"+nt+"*\\)|)(?=[^-]|$)","i")},mt=/^(?:input|select|textarea|button)$/i,gt=/^h\d$/i,vt=/^[^{]+\{\s*\[native \w/,yt=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,bt=/[+~]/,xt=/'|\\/g,wt=new RegExp("\\\\([\\da-f]{1,6}"+nt+"?|("+nt+")|.)","ig"),_t=function(e,t,i){var n="0x"+t-65536;return n!==n||i?t:0>n?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320)};try{J.apply($=et.call(I.childNodes),I.childNodes),$[I.childNodes.length].nodeType}catch(St){J={apply:$.length?function(e,t){Z.apply(e,et.call(t))}:function(e,t){for(var i=e.length,n=0;e[i++]=t[n++];);e.length=i-1}}}w=t.support={},M=t.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},R=t.setDocument=function(e){var t,i=e?e.ownerDocument||e:I,n=i.defaultView;return i!==L&&9===i.nodeType&&i.documentElement?(L=i,D=i.documentElement,F=!M(i),n&&n!==n.top&&(n.addEventListener?n.addEventListener("unload",function(){R()},!1):n.attachEvent&&n.attachEvent("onunload",function(){R()})),w.attributes=r(function(e){return e.className="i",!e.getAttribute("className")}),w.getElementsByTagName=r(function(e){return e.appendChild(i.createComment("")),!e.getElementsByTagName("*").length}),w.getElementsByClassName=vt.test(i.getElementsByClassName)&&r(function(e){return e.innerHTML="<div class='a'></div><div class='a i'></div>",e.firstChild.className="i",2===e.getElementsByClassName("i").length}),w.getById=r(function(e){return D.appendChild(e).id=j,!i.getElementsByName||!i.getElementsByName(j).length}),w.getById?(_.find.ID=function(e,t){if(typeof t.getElementById!==X&&F){var i=t.getElementById(e);return i&&i.parentNode?[i]:[]}},_.filter.ID=function(e){var t=e.replace(wt,_t);return function(e){return e.getAttribute("id")===t}}):(delete _.find.ID,_.filter.ID=function(e){var t=e.replace(wt,_t);return function(e){var i=typeof e.getAttributeNode!==X&&e.getAttributeNode("id");return i&&i.value===t}}),_.find.TAG=w.getElementsByTagName?function(e,t){return typeof t.getElementsByTagName!==X?t.getElementsByTagName(e):void 0}:function(e,t){var i,n=[],r=0,o=t.getElementsByTagName(e);if("*"===e){for(;i=o[r++];)1===i.nodeType&&n.push(i);return n}return o},_.find.CLASS=w.getElementsByClassName&&function(e,t){return typeof t.getElementsByClassName!==X&&F?t.getElementsByClassName(e):void 0},N=[],G=[],(w.qsa=vt.test(i.querySelectorAll))&&(r(function(e){e.innerHTML="<select msallowclip=''><option selected=''></option></select>",e.querySelectorAll("[msallowclip^='']").length&&G.push("[*^$]="+nt+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||G.push("\\["+nt+"*(?:value|"+it+")"),e.querySelectorAll(":checked").length||G.push(":checked")
}),r(function(e){var t=i.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&G.push("name"+nt+"*[*^$|!~]?="),e.querySelectorAll(":enabled").length||G.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),G.push(",.*:")})),(w.matchesSelector=vt.test(V=D.matches||D.webkitMatchesSelector||D.mozMatchesSelector||D.oMatchesSelector||D.msMatchesSelector))&&r(function(e){w.disconnectedMatch=V.call(e,"div"),V.call(e,"[s!='']:x"),N.push("!=",st)}),G=G.length&&new RegExp(G.join("|")),N=N.length&&new RegExp(N.join("|")),t=vt.test(D.compareDocumentPosition),O=t||vt.test(D.contains)?function(e,t){var i=9===e.nodeType?e.documentElement:e,n=t&&t.parentNode;return e===n||!(!n||1!==n.nodeType||!(i.contains?i.contains(n):e.compareDocumentPosition&&16&e.compareDocumentPosition(n)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},W=t?function(e,t){if(e===t)return k=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n?n:(n=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,1&n||!w.sortDetached&&t.compareDocumentPosition(e)===n?e===i||e.ownerDocument===I&&O(I,e)?-1:t===i||t.ownerDocument===I&&O(I,t)?1:P?tt.call(P,e)-tt.call(P,t):0:4&n?-1:1)}:function(e,t){if(e===t)return k=!0,0;var n,r=0,o=e.parentNode,s=t.parentNode,l=[e],c=[t];if(!o||!s)return e===i?-1:t===i?1:o?-1:s?1:P?tt.call(P,e)-tt.call(P,t):0;if(o===s)return a(e,t);for(n=e;n=n.parentNode;)l.unshift(n);for(n=t;n=n.parentNode;)c.unshift(n);for(;l[r]===c[r];)r++;return r?a(l[r],c[r]):l[r]===I?-1:c[r]===I?1:0},i):L},t.matches=function(e,i){return t(e,null,null,i)},t.matchesSelector=function(e,i){if((e.ownerDocument||e)!==L&&R(e),i=i.replace(ut,"='$1']"),!(!w.matchesSelector||!F||N&&N.test(i)||G&&G.test(i)))try{var n=V.call(e,i);if(n||w.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(r){}return t(i,L,null,[e]).length>0},t.contains=function(e,t){return(e.ownerDocument||e)!==L&&R(e),O(e,t)},t.attr=function(e,t){(e.ownerDocument||e)!==L&&R(e);var i=_.attrHandle[t.toLowerCase()],n=i&&K.call(_.attrHandle,t.toLowerCase())?i(e,t,!F):void 0;return void 0!==n?n:w.attributes||!F?e.getAttribute(t):(n=e.getAttributeNode(t))&&n.specified?n.value:null},t.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},t.uniqueSort=function(e){var t,i=[],n=0,r=0;if(k=!w.detectDuplicates,P=!w.sortStable&&e.slice(0),e.sort(W),k){for(;t=e[r++];)t===e[r]&&(n=i.push(r));for(;n--;)e.splice(i[n],1)}return P=null,e},S=t.getText=function(e){var t,i="",n=0,r=e.nodeType;if(r){if(1===r||9===r||11===r){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)i+=S(e)}else if(3===r||4===r)return e.nodeValue}else for(;t=e[n++];)i+=S(t);return i},_=t.selectors={cacheLength:50,createPseudo:n,match:dt,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(wt,_t),e[3]=(e[3]||e[4]||e[5]||"").replace(wt,_t),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||t.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&t.error(e[0]),e},PSEUDO:function(e){var t,i=!e[6]&&e[2];return dt.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":i&&ft.test(i)&&(t=C(i,!0))&&(t=i.indexOf(")",i.length-t)-i.length)&&(e[0]=e[0].slice(0,t),e[2]=i.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(wt,_t).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=B[e+" "];return t||(t=new RegExp("(^|"+nt+")"+e+"("+nt+"|$)"))&&B(e,function(e){return t.test("string"==typeof e.className&&e.className||typeof e.getAttribute!==X&&e.getAttribute("class")||"")})},ATTR:function(e,i,n){return function(r){var o=t.attr(r,e);return null==o?"!="===i:i?(o+="","="===i?o===n:"!="===i?o!==n:"^="===i?n&&0===o.indexOf(n):"*="===i?n&&o.indexOf(n)>-1:"$="===i?n&&o.slice(-n.length)===n:"~="===i?(" "+o+" ").indexOf(n)>-1:"|="===i?o===n||o.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,i,n,r){var o="nth"!==e.slice(0,3),a="last"!==e.slice(-4),s="of-type"===t;return 1===n&&0===r?function(e){return!!e.parentNode}:function(t,i,l){var c,h,u,f,p,d,m=o!==a?"nextSibling":"previousSibling",g=t.parentNode,v=s&&t.nodeName.toLowerCase(),y=!l&&!s;if(g){if(o){for(;m;){for(u=t;u=u[m];)if(s?u.nodeName.toLowerCase()===v:1===u.nodeType)return!1;d=m="only"===e&&!d&&"nextSibling"}return!0}if(d=[a?g.firstChild:g.lastChild],a&&y){for(h=g[j]||(g[j]={}),c=h[e]||[],p=c[0]===U&&c[1],f=c[0]===U&&c[2],u=p&&g.childNodes[p];u=++p&&u&&u[m]||(f=p=0)||d.pop();)if(1===u.nodeType&&++f&&u===t){h[e]=[U,p,f];break}}else if(y&&(c=(t[j]||(t[j]={}))[e])&&c[0]===U)f=c[1];else for(;(u=++p&&u&&u[m]||(f=p=0)||d.pop())&&((s?u.nodeName.toLowerCase()!==v:1!==u.nodeType)||!++f||(y&&((u[j]||(u[j]={}))[e]=[U,f]),u!==t)););return f-=r,f===n||f%n===0&&f/n>=0}}},PSEUDO:function(e,i){var r,o=_.pseudos[e]||_.setFilters[e.toLowerCase()]||t.error("unsupported pseudo: "+e);return o[j]?o(i):o.length>1?(r=[e,e,"",i],_.setFilters.hasOwnProperty(e.toLowerCase())?n(function(e,t){for(var n,r=o(e,i),a=r.length;a--;)n=tt.call(e,r[a]),e[n]=!(t[n]=r[a])}):function(e){return o(e,0,r)}):o}},pseudos:{not:n(function(e){var t=[],i=[],r=T(e.replace(lt,"$1"));return r[j]?n(function(e,t,i,n){for(var o,a=r(e,null,n,[]),s=e.length;s--;)(o=a[s])&&(e[s]=!(t[s]=o))}):function(e,n,o){return t[0]=e,r(t,null,o,i),!i.pop()}}),has:n(function(e){return function(i){return t(e,i).length>0}}),contains:n(function(e){return function(t){return(t.textContent||t.innerText||S(t)).indexOf(e)>-1}}),lang:n(function(e){return pt.test(e||"")||t.error("unsupported lang: "+e),e=e.replace(wt,_t).toLowerCase(),function(t){var i;do if(i=F?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return i=i.toLowerCase(),i===e||0===i.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var i=e.location&&e.location.hash;return i&&i.slice(1)===t.id},root:function(e){return e===D},focus:function(e){return e===L.activeElement&&(!L.hasFocus||L.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!_.pseudos.empty(e)},header:function(e){return gt.test(e.nodeName)},input:function(e){return mt.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:c(function(){return[0]}),last:c(function(e,t){return[t-1]}),eq:c(function(e,t,i){return[0>i?i+t:i]}),even:c(function(e,t){for(var i=0;t>i;i+=2)e.push(i);return e}),odd:c(function(e,t){for(var i=1;t>i;i+=2)e.push(i);return e}),lt:c(function(e,t,i){for(var n=0>i?i+t:i;--n>=0;)e.push(n);return e}),gt:c(function(e,t,i){for(var n=0>i?i+t:i;++n<t;)e.push(n);return e})}},_.pseudos.nth=_.pseudos.eq;for(x in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})_.pseudos[x]=s(x);for(x in{submit:!0,reset:!0})_.pseudos[x]=l(x);return u.prototype=_.filters=_.pseudos,_.setFilters=new u,C=t.tokenize=function(e,i){var n,r,o,a,s,l,c,h=H[e+" "];if(h)return i?0:h.slice(0);for(s=e,l=[],c=_.preFilter;s;){(!n||(r=ct.exec(s)))&&(r&&(s=s.slice(r[0].length)||s),l.push(o=[])),n=!1,(r=ht.exec(s))&&(n=r.shift(),o.push({value:n,type:r[0].replace(lt," ")}),s=s.slice(n.length));for(a in _.filter)!(r=dt[a].exec(s))||c[a]&&!(r=c[a](r))||(n=r.shift(),o.push({value:n,type:a,matches:r}),s=s.slice(n.length));if(!n)break}return i?s.length:s?t.error(e):H(e,l).slice(0)},T=t.compile=function(e,t){var i,n=[],r=[],o=q[e+" "];if(!o){for(t||(t=C(e)),i=t.length;i--;)o=y(t[i]),o[j]?n.push(o):r.push(o);o=q(e,b(r,n)),o.selector=e}return o},A=t.select=function(e,t,i,n){var r,o,a,s,l,c="function"==typeof e&&e,u=!n&&C(e=c.selector||e);if(i=i||[],1===u.length){if(o=u[0]=u[0].slice(0),o.length>2&&"ID"===(a=o[0]).type&&w.getById&&9===t.nodeType&&F&&_.relative[o[1].type]){if(t=(_.find.ID(a.matches[0].replace(wt,_t),t)||[])[0],!t)return i;c&&(t=t.parentNode),e=e.slice(o.shift().value.length)}for(r=dt.needsContext.test(e)?0:o.length;r--&&(a=o[r],!_.relative[s=a.type]);)if((l=_.find[s])&&(n=l(a.matches[0].replace(wt,_t),bt.test(o[0].type)&&h(t.parentNode)||t))){if(o.splice(r,1),e=n.length&&f(o),!e)return J.apply(i,n),i;break}}return(c||T(e,u))(n,t,!F,i,bt.test(e)&&h(t.parentNode)||t),i},w.sortStable=j.split("").sort(W).join("")===j,w.detectDuplicates=!!k,R(),w.sortDetached=r(function(e){return 1&e.compareDocumentPosition(L.createElement("div"))}),r(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||o("type|href|height|width",function(e,t,i){return i?void 0:e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),w.attributes&&r(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||o("value",function(e,t,i){return i||"input"!==e.nodeName.toLowerCase()?void 0:e.defaultValue}),r(function(e){return null==e.getAttribute("disabled")})||o(it,function(e,t,i){var n;return i?void 0:e[t]===!0?t.toLowerCase():(n=e.getAttributeNode(t))&&n.specified?n.value:null}),t}(e);J.find=rt,J.expr=rt.selectors,J.expr[":"]=J.expr.pseudos,J.unique=rt.uniqueSort,J.text=rt.getText,J.isXMLDoc=rt.isXML,J.contains=rt.contains;var ot=J.expr.match.needsContext,at=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,st=/^.[^:#\[\.,]*$/;J.filter=function(e,t,i){var n=t[0];return i&&(e=":not("+e+")"),1===t.length&&1===n.nodeType?J.find.matchesSelector(n,e)?[n]:[]:J.find.matches(e,J.grep(t,function(e){return 1===e.nodeType}))},J.fn.extend({find:function(e){var t,i=this.length,n=[],r=this;if("string"!=typeof e)return this.pushStack(J(e).filter(function(){for(t=0;i>t;t++)if(J.contains(r[t],this))return!0}));for(t=0;i>t;t++)J.find(e,r[t],n);return n=this.pushStack(i>1?J.unique(n):n),n.selector=this.selector?this.selector+" "+e:e,n},filter:function(e){return this.pushStack(n(this,e||[],!1))},not:function(e){return this.pushStack(n(this,e||[],!0))},is:function(e){return!!n(this,"string"==typeof e&&ot.test(e)?J(e):e||[],!1).length}});var lt,ct=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,ht=J.fn.init=function(e,t){var i,n;if(!e)return this;if("string"==typeof e){if(i="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:ct.exec(e),!i||!i[1]&&t)return!t||t.jquery?(t||lt).find(e):this.constructor(t).find(e);if(i[1]){if(t=t instanceof J?t[0]:t,J.merge(this,J.parseHTML(i[1],t&&t.nodeType?t.ownerDocument||t:Q,!0)),at.test(i[1])&&J.isPlainObject(t))for(i in t)J.isFunction(this[i])?this[i](t[i]):this.attr(i,t[i]);return this}return n=Q.getElementById(i[2]),n&&n.parentNode&&(this.length=1,this[0]=n),this.context=Q,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):J.isFunction(e)?"undefined"!=typeof lt.ready?lt.ready(e):e(J):(void 0!==e.selector&&(this.selector=e.selector,this.context=e.context),J.makeArray(e,this))};ht.prototype=J.fn,lt=J(Q);var ut=/^(?:parents|prev(?:Until|All))/,ft={children:!0,contents:!0,next:!0,prev:!0};J.extend({dir:function(e,t,i){for(var n=[],r=void 0!==i;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(r&&J(e).is(i))break;n.push(e)}return n},sibling:function(e,t){for(var i=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&i.push(e);return i}}),J.fn.extend({has:function(e){var t=J(e,this),i=t.length;return this.filter(function(){for(var e=0;i>e;e++)if(J.contains(this,t[e]))return!0})},closest:function(e,t){for(var i,n=0,r=this.length,o=[],a=ot.test(e)||"string"!=typeof e?J(e,t||this.context):0;r>n;n++)for(i=this[n];i&&i!==t;i=i.parentNode)if(i.nodeType<11&&(a?a.index(i)>-1:1===i.nodeType&&J.find.matchesSelector(i,e))){o.push(i);break}return this.pushStack(o.length>1?J.unique(o):o)},index:function(e){return e?"string"==typeof e?W.call(J(e),this[0]):W.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(J.unique(J.merge(this.get(),J(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),J.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return J.dir(e,"parentNode")},parentsUntil:function(e,t,i){return J.dir(e,"parentNode",i)},next:function(e){return r(e,"nextSibling")},prev:function(e){return r(e,"previousSibling")},nextAll:function(e){return J.dir(e,"nextSibling")},prevAll:function(e){return J.dir(e,"previousSibling")},nextUntil:function(e,t,i){return J.dir(e,"nextSibling",i)},prevUntil:function(e,t,i){return J.dir(e,"previousSibling",i)},siblings:function(e){return J.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return J.sibling(e.firstChild)},contents:function(e){return e.contentDocument||J.merge([],e.childNodes)}},function(e,t){J.fn[e]=function(i,n){var r=J.map(this,t,i);return"Until"!==e.slice(-5)&&(n=i),n&&"string"==typeof n&&(r=J.filter(n,r)),this.length>1&&(ft[e]||J.unique(r),ut.test(e)&&r.reverse()),this.pushStack(r)}});var pt=/\S+/g,dt={};J.Callbacks=function(e){e="string"==typeof e?dt[e]||o(e):J.extend({},e);var t,i,n,r,a,s,l=[],c=!e.once&&[],h=function(o){for(t=e.memory&&o,i=!0,s=r||0,r=0,a=l.length,n=!0;l&&a>s;s++)if(l[s].apply(o[0],o[1])===!1&&e.stopOnFalse){t=!1;break}n=!1,l&&(c?c.length&&h(c.shift()):t?l=[]:u.disable())},u={add:function(){if(l){var i=l.length;!function o(t){J.each(t,function(t,i){var n=J.type(i);"function"===n?e.unique&&u.has(i)||l.push(i):i&&i.length&&"string"!==n&&o(i)})}(arguments),n?a=l.length:t&&(r=i,h(t))}return this},remove:function(){return l&&J.each(arguments,function(e,t){for(var i;(i=J.inArray(t,l,i))>-1;)l.splice(i,1),n&&(a>=i&&a--,s>=i&&s--)}),this},has:function(e){return e?J.inArray(e,l)>-1:!(!l||!l.length)},empty:function(){return l=[],a=0,this},disable:function(){return l=c=t=void 0,this},disabled:function(){return!l},lock:function(){return c=void 0,t||u.disable(),this},locked:function(){return!c},fireWith:function(e,t){return!l||i&&!c||(t=t||[],t=[e,t.slice?t.slice():t],n?c.push(t):h(t)),this},fire:function(){return u.fireWith(this,arguments),this},fired:function(){return!!i}};return u},J.extend({Deferred:function(e){var t=[["resolve","done",J.Callbacks("once memory"),"resolved"],["reject","fail",J.Callbacks("once memory"),"rejected"],["notify","progress",J.Callbacks("memory")]],i="pending",n={state:function(){return i},always:function(){return r.done(arguments).fail(arguments),this},then:function(){var e=arguments;return J.Deferred(function(i){J.each(t,function(t,o){var a=J.isFunction(e[t])&&e[t];r[o[1]](function(){var e=a&&a.apply(this,arguments);e&&J.isFunction(e.promise)?e.promise().done(i.resolve).fail(i.reject).progress(i.notify):i[o[0]+"With"](this===n?i.promise():this,a?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?J.extend(e,n):n}},r={};return n.pipe=n.then,J.each(t,function(e,o){var a=o[2],s=o[3];n[o[1]]=a.add,s&&a.add(function(){i=s},t[1^e][2].disable,t[2][2].lock),r[o[0]]=function(){return r[o[0]+"With"](this===r?n:this,arguments),this},r[o[0]+"With"]=a.fireWith}),n.promise(r),e&&e.call(r,r),r},when:function(e){var t,i,n,r=0,o=B.call(arguments),a=o.length,s=1!==a||e&&J.isFunction(e.promise)?a:0,l=1===s?e:J.Deferred(),c=function(e,i,n){return function(r){i[e]=this,n[e]=arguments.length>1?B.call(arguments):r,n===t?l.notifyWith(i,n):--s||l.resolveWith(i,n)}};if(a>1)for(t=new Array(a),i=new Array(a),n=new Array(a);a>r;r++)o[r]&&J.isFunction(o[r].promise)?o[r].promise().done(c(r,n,o)).fail(l.reject).progress(c(r,i,t)):--s;return s||l.resolveWith(n,o),l.promise()}});var mt;J.fn.ready=function(e){return J.ready.promise().done(e),this},J.extend({isReady:!1,readyWait:1,holdReady:function(e){e?J.readyWait++:J.ready(!0)},ready:function(e){(e===!0?--J.readyWait:J.isReady)||(J.isReady=!0,e!==!0&&--J.readyWait>0||(mt.resolveWith(Q,[J]),J.fn.triggerHandler&&(J(Q).triggerHandler("ready"),J(Q).off("ready"))))}}),J.ready.promise=function(t){return mt||(mt=J.Deferred(),"complete"===Q.readyState?setTimeout(J.ready):(Q.addEventListener("DOMContentLoaded",a,!1),e.addEventListener("load",a,!1))),mt.promise(t)},J.ready.promise();var gt=J.access=function(e,t,i,n,r,o,a){var s=0,l=e.length,c=null==i;if("object"===J.type(i)){r=!0;for(s in i)J.access(e,t,s,i[s],!0,o,a)}else if(void 0!==n&&(r=!0,J.isFunction(n)||(a=!0),c&&(a?(t.call(e,n),t=null):(c=t,t=function(e,t,i){return c.call(J(e),i)})),t))for(;l>s;s++)t(e[s],i,a?n:n.call(e[s],s,t(e[s],i)));return r?e:c?t.call(e):l?t(e[0],i):o};J.acceptData=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType},s.uid=1,s.accepts=J.acceptData,s.prototype={key:function(e){if(!s.accepts(e))return 0;var t={},i=e[this.expando];if(!i){i=s.uid++;try{t[this.expando]={value:i},Object.defineProperties(e,t)}catch(n){t[this.expando]=i,J.extend(e,t)}}return this.cache[i]||(this.cache[i]={}),i},set:function(e,t,i){var n,r=this.key(e),o=this.cache[r];if("string"==typeof t)o[t]=i;else if(J.isEmptyObject(o))J.extend(this.cache[r],t);else for(n in t)o[n]=t[n];return o},get:function(e,t){var i=this.cache[this.key(e)];return void 0===t?i:i[t]},access:function(e,t,i){var n;return void 0===t||t&&"string"==typeof t&&void 0===i?(n=this.get(e,t),void 0!==n?n:this.get(e,J.camelCase(t))):(this.set(e,t,i),void 0!==i?i:t)},remove:function(e,t){var i,n,r,o=this.key(e),a=this.cache[o];if(void 0===t)this.cache[o]={};else{J.isArray(t)?n=t.concat(t.map(J.camelCase)):(r=J.camelCase(t),t in a?n=[t,r]:(n=r,n=n in a?[n]:n.match(pt)||[])),i=n.length;for(;i--;)delete a[n[i]]}},hasData:function(e){return!J.isEmptyObject(this.cache[e[this.expando]]||{})},discard:function(e){e[this.expando]&&delete this.cache[e[this.expando]]}};var vt=new s,yt=new s,bt=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,xt=/([A-Z])/g;J.extend({hasData:function(e){return yt.hasData(e)||vt.hasData(e)},data:function(e,t,i){return yt.access(e,t,i)},removeData:function(e,t){yt.remove(e,t)},_data:function(e,t,i){return vt.access(e,t,i)},_removeData:function(e,t){vt.remove(e,t)}}),J.fn.extend({data:function(e,t){var i,n,r,o=this[0],a=o&&o.attributes;if(void 0===e){if(this.length&&(r=yt.get(o),1===o.nodeType&&!vt.get(o,"hasDataAttrs"))){for(i=a.length;i--;)a[i]&&(n=a[i].name,0===n.indexOf("data-")&&(n=J.camelCase(n.slice(5)),l(o,n,r[n])));vt.set(o,"hasDataAttrs",!0)}return r}return"object"==typeof e?this.each(function(){yt.set(this,e)}):gt(this,function(t){var i,n=J.camelCase(e);if(o&&void 0===t){if(i=yt.get(o,e),void 0!==i)return i;if(i=yt.get(o,n),void 0!==i)return i;if(i=l(o,n,void 0),void 0!==i)return i}else this.each(function(){var i=yt.get(this,n);yt.set(this,n,t),-1!==e.indexOf("-")&&void 0!==i&&yt.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){yt.remove(this,e)})}}),J.extend({queue:function(e,t,i){var n;return e?(t=(t||"fx")+"queue",n=vt.get(e,t),i&&(!n||J.isArray(i)?n=vt.access(e,t,J.makeArray(i)):n.push(i)),n||[]):void 0},dequeue:function(e,t){t=t||"fx";var i=J.queue(e,t),n=i.length,r=i.shift(),o=J._queueHooks(e,t),a=function(){J.dequeue(e,t)};"inprogress"===r&&(r=i.shift(),n--),r&&("fx"===t&&i.unshift("inprogress"),delete o.stop,r.call(e,a,o)),!n&&o&&o.empty.fire()},_queueHooks:function(e,t){var i=t+"queueHooks";return vt.get(e,i)||vt.access(e,i,{empty:J.Callbacks("once memory").add(function(){vt.remove(e,[t+"queue",i])})})}}),J.fn.extend({queue:function(e,t){var i=2;return"string"!=typeof e&&(t=e,e="fx",i--),arguments.length<i?J.queue(this[0],e):void 0===t?this:this.each(function(){var i=J.queue(this,e,t);J._queueHooks(this,e),"fx"===e&&"inprogress"!==i[0]&&J.dequeue(this,e)})},dequeue:function(e){return this.each(function(){J.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var i,n=1,r=J.Deferred(),o=this,a=this.length,s=function(){--n||r.resolveWith(o,[o])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";a--;)i=vt.get(o[a],e+"queueHooks"),i&&i.empty&&(n++,i.empty.add(s));return s(),r.promise(t)}});var wt=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,_t=["Top","Right","Bottom","Left"],St=function(e,t){return e=t||e,"none"===J.css(e,"display")||!J.contains(e.ownerDocument,e)},Mt=/^(?:checkbox|radio)$/i;!function(){var e=Q.createDocumentFragment(),t=e.appendChild(Q.createElement("div")),i=Q.createElement("input");i.setAttribute("type","radio"),i.setAttribute("checked","checked"),i.setAttribute("name","t"),t.appendChild(i),$.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,t.innerHTML="<textarea>x</textarea>",$.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue}();var Ct="undefined";$.focusinBubbles="onfocusin"in e;var Tt=/^key/,At=/^(?:mouse|pointer|contextmenu)|click/,Et=/^(?:focusinfocus|focusoutblur)$/,Pt=/^([^.]*)(?:\.(.+)|)$/;J.event={global:{},add:function(e,t,i,n,r){var o,a,s,l,c,h,u,f,p,d,m,g=vt.get(e);if(g)for(i.handler&&(o=i,i=o.handler,r=o.selector),i.guid||(i.guid=J.guid++),(l=g.events)||(l=g.events={}),(a=g.handle)||(a=g.handle=function(t){return typeof J!==Ct&&J.event.triggered!==t.type?J.event.dispatch.apply(e,arguments):void 0}),t=(t||"").match(pt)||[""],c=t.length;c--;)s=Pt.exec(t[c])||[],p=m=s[1],d=(s[2]||"").split(".").sort(),p&&(u=J.event.special[p]||{},p=(r?u.delegateType:u.bindType)||p,u=J.event.special[p]||{},h=J.extend({type:p,origType:m,data:n,handler:i,guid:i.guid,selector:r,needsContext:r&&J.expr.match.needsContext.test(r),namespace:d.join(".")},o),(f=l[p])||(f=l[p]=[],f.delegateCount=0,u.setup&&u.setup.call(e,n,d,a)!==!1||e.addEventListener&&e.addEventListener(p,a,!1)),u.add&&(u.add.call(e,h),h.handler.guid||(h.handler.guid=i.guid)),r?f.splice(f.delegateCount++,0,h):f.push(h),J.event.global[p]=!0)},remove:function(e,t,i,n,r){var o,a,s,l,c,h,u,f,p,d,m,g=vt.hasData(e)&&vt.get(e);if(g&&(l=g.events)){for(t=(t||"").match(pt)||[""],c=t.length;c--;)if(s=Pt.exec(t[c])||[],p=m=s[1],d=(s[2]||"").split(".").sort(),p){for(u=J.event.special[p]||{},p=(n?u.delegateType:u.bindType)||p,f=l[p]||[],s=s[2]&&new RegExp("(^|\\.)"+d.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=f.length;o--;)h=f[o],!r&&m!==h.origType||i&&i.guid!==h.guid||s&&!s.test(h.namespace)||n&&n!==h.selector&&("**"!==n||!h.selector)||(f.splice(o,1),h.selector&&f.delegateCount--,u.remove&&u.remove.call(e,h));a&&!f.length&&(u.teardown&&u.teardown.call(e,d,g.handle)!==!1||J.removeEvent(e,p,g.handle),delete l[p])}else for(p in l)J.event.remove(e,p+t[c],i,n,!0);J.isEmptyObject(l)&&(delete g.handle,vt.remove(e,"events"))}},trigger:function(t,i,n,r){var o,a,s,l,c,h,u,f=[n||Q],p=K.call(t,"type")?t.type:t,d=K.call(t,"namespace")?t.namespace.split("."):[];if(a=s=n=n||Q,3!==n.nodeType&&8!==n.nodeType&&!Et.test(p+J.event.triggered)&&(p.indexOf(".")>=0&&(d=p.split("."),p=d.shift(),d.sort()),c=p.indexOf(":")<0&&"on"+p,t=t[J.expando]?t:new J.Event(p,"object"==typeof t&&t),t.isTrigger=r?2:3,t.namespace=d.join("."),t.namespace_re=t.namespace?new RegExp("(^|\\.)"+d.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=n),i=null==i?[t]:J.makeArray(i,[t]),u=J.event.special[p]||{},r||!u.trigger||u.trigger.apply(n,i)!==!1)){if(!r&&!u.noBubble&&!J.isWindow(n)){for(l=u.delegateType||p,Et.test(l+p)||(a=a.parentNode);a;a=a.parentNode)f.push(a),s=a;s===(n.ownerDocument||Q)&&f.push(s.defaultView||s.parentWindow||e)}for(o=0;(a=f[o++])&&!t.isPropagationStopped();)t.type=o>1?l:u.bindType||p,h=(vt.get(a,"events")||{})[t.type]&&vt.get(a,"handle"),h&&h.apply(a,i),h=c&&a[c],h&&h.apply&&J.acceptData(a)&&(t.result=h.apply(a,i),t.result===!1&&t.preventDefault());return t.type=p,r||t.isDefaultPrevented()||u._default&&u._default.apply(f.pop(),i)!==!1||!J.acceptData(n)||c&&J.isFunction(n[p])&&!J.isWindow(n)&&(s=n[c],s&&(n[c]=null),J.event.triggered=p,n[p](),J.event.triggered=void 0,s&&(n[c]=s)),t.result}},dispatch:function(e){e=J.event.fix(e);var t,i,n,r,o,a=[],s=B.call(arguments),l=(vt.get(this,"events")||{})[e.type]||[],c=J.event.special[e.type]||{};if(s[0]=e,e.delegateTarget=this,!c.preDispatch||c.preDispatch.call(this,e)!==!1){for(a=J.event.handlers.call(this,e,l),t=0;(r=a[t++])&&!e.isPropagationStopped();)for(e.currentTarget=r.elem,i=0;(o=r.handlers[i++])&&!e.isImmediatePropagationStopped();)(!e.namespace_re||e.namespace_re.test(o.namespace))&&(e.handleObj=o,e.data=o.data,n=((J.event.special[o.origType]||{}).handle||o.handler).apply(r.elem,s),void 0!==n&&(e.result=n)===!1&&(e.preventDefault(),e.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,e),e.result}},handlers:function(e,t){var i,n,r,o,a=[],s=t.delegateCount,l=e.target;if(s&&l.nodeType&&(!e.button||"click"!==e.type))for(;l!==this;l=l.parentNode||this)if(l.disabled!==!0||"click"!==e.type){for(n=[],i=0;s>i;i++)o=t[i],r=o.selector+" ",void 0===n[r]&&(n[r]=o.needsContext?J(r,this).index(l)>=0:J.find(r,this,null,[l]).length),n[r]&&n.push(o);n.length&&a.push({elem:l,handlers:n})}return s<t.length&&a.push({elem:this,handlers:t.slice(s)}),a},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var i,n,r,o=t.button;return null==e.pageX&&null!=t.clientX&&(i=e.target.ownerDocument||Q,n=i.documentElement,r=i.body,e.pageX=t.clientX+(n&&n.scrollLeft||r&&r.scrollLeft||0)-(n&&n.clientLeft||r&&r.clientLeft||0),e.pageY=t.clientY+(n&&n.scrollTop||r&&r.scrollTop||0)-(n&&n.clientTop||r&&r.clientTop||0)),e.which||void 0===o||(e.which=1&o?1:2&o?3:4&o?2:0),e}},fix:function(e){if(e[J.expando])return e;var t,i,n,r=e.type,o=e,a=this.fixHooks[r];for(a||(this.fixHooks[r]=a=At.test(r)?this.mouseHooks:Tt.test(r)?this.keyHooks:{}),n=a.props?this.props.concat(a.props):this.props,e=new J.Event(o),t=n.length;t--;)i=n[t],e[i]=o[i];return e.target||(e.target=Q),3===e.target.nodeType&&(e.target=e.target.parentNode),a.filter?a.filter(e,o):e},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==u()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===u()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&J.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(e){return J.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,i,n){var r=J.extend(new J.Event,i,{type:e,isSimulated:!0,originalEvent:{}});n?J.event.trigger(r,null,t):J.event.dispatch.call(t,r),r.isDefaultPrevented()&&i.preventDefault()}},J.removeEvent=function(e,t,i){e.removeEventListener&&e.removeEventListener(t,i,!1)},J.Event=function(e,t){return this instanceof J.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&e.returnValue===!1?c:h):this.type=e,t&&J.extend(this,t),this.timeStamp=e&&e.timeStamp||J.now(),void(this[J.expando]=!0)):new J.Event(e,t)},J.Event.prototype={isDefaultPrevented:h,isPropagationStopped:h,isImmediatePropagationStopped:h,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=c,e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=c,e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=c,e&&e.stopImmediatePropagation&&e.stopImmediatePropagation(),this.stopPropagation()}},J.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){J.event.special[e]={delegateType:t,bindType:t,handle:function(e){var i,n=this,r=e.relatedTarget,o=e.handleObj;return(!r||r!==n&&!J.contains(n,r))&&(e.type=o.origType,i=o.handler.apply(this,arguments),e.type=t),i}}}),$.focusinBubbles||J.each({focus:"focusin",blur:"focusout"},function(e,t){var i=function(e){J.event.simulate(t,e.target,J.event.fix(e),!0)};J.event.special[t]={setup:function(){var n=this.ownerDocument||this,r=vt.access(n,t);r||n.addEventListener(e,i,!0),vt.access(n,t,(r||0)+1)},teardown:function(){var n=this.ownerDocument||this,r=vt.access(n,t)-1;r?vt.access(n,t,r):(n.removeEventListener(e,i,!0),vt.remove(n,t))}}}),J.fn.extend({on:function(e,t,i,n,r){var o,a;if("object"==typeof e){"string"!=typeof t&&(i=i||t,t=void 0);for(a in e)this.on(a,t,i,e[a],r);return this}if(null==i&&null==n?(n=t,i=t=void 0):null==n&&("string"==typeof t?(n=i,i=void 0):(n=i,i=t,t=void 0)),n===!1)n=h;else if(!n)return this;return 1===r&&(o=n,n=function(e){return J().off(e),o.apply(this,arguments)},n.guid=o.guid||(o.guid=J.guid++)),this.each(function(){J.event.add(this,e,n,i,t)})},one:function(e,t,i,n){return this.on(e,t,i,n,1)},off:function(e,t,i){var n,r;if(e&&e.preventDefault&&e.handleObj)return n=e.handleObj,J(e.delegateTarget).off(n.namespace?n.origType+"."+n.namespace:n.origType,n.selector,n.handler),this;if("object"==typeof e){for(r in e)this.off(r,t,e[r]);return this}return(t===!1||"function"==typeof t)&&(i=t,t=void 0),i===!1&&(i=h),this.each(function(){J.event.remove(this,e,i,t)})},trigger:function(e,t){return this.each(function(){J.event.trigger(e,t,this)})},triggerHandler:function(e,t){var i=this[0];return i?J.event.trigger(e,t,i,!0):void 0}});var kt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Rt=/<([\w:]+)/,Lt=/<|&#?\w+;/,Dt=/<(?:script|style|link)/i,Ft=/checked\s*(?:[^=]|=\s*.checked.)/i,Gt=/^$|\/(?:java|ecma)script/i,Nt=/^true\/(.*)/,Vt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Ot={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Ot.optgroup=Ot.option,Ot.tbody=Ot.tfoot=Ot.colgroup=Ot.caption=Ot.thead,Ot.th=Ot.td,J.extend({clone:function(e,t,i){var n,r,o,a,s=e.cloneNode(!0),l=J.contains(e.ownerDocument,e);if(!($.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||J.isXMLDoc(e)))for(a=v(s),o=v(e),n=0,r=o.length;r>n;n++)y(o[n],a[n]);if(t)if(i)for(o=o||v(e),a=a||v(s),n=0,r=o.length;r>n;n++)g(o[n],a[n]);else g(e,s);return a=v(s,"script"),a.length>0&&m(a,!l&&v(e,"script")),s},buildFragment:function(e,t,i,n){for(var r,o,a,s,l,c,h=t.createDocumentFragment(),u=[],f=0,p=e.length;p>f;f++)if(r=e[f],r||0===r)if("object"===J.type(r))J.merge(u,r.nodeType?[r]:r);else if(Lt.test(r)){for(o=o||h.appendChild(t.createElement("div")),a=(Rt.exec(r)||["",""])[1].toLowerCase(),s=Ot[a]||Ot._default,o.innerHTML=s[1]+r.replace(kt,"<$1></$2>")+s[2],c=s[0];c--;)o=o.lastChild;J.merge(u,o.childNodes),o=h.firstChild,o.textContent=""}else u.push(t.createTextNode(r));for(h.textContent="",f=0;r=u[f++];)if((!n||-1===J.inArray(r,n))&&(l=J.contains(r.ownerDocument,r),o=v(h.appendChild(r),"script"),l&&m(o),i))for(c=0;r=o[c++];)Gt.test(r.type||"")&&i.push(r);return h},cleanData:function(e){for(var t,i,n,r,o=J.event.special,a=0;void 0!==(i=e[a]);a++){if(J.acceptData(i)&&(r=i[vt.expando],r&&(t=vt.cache[r]))){if(t.events)for(n in t.events)o[n]?J.event.remove(i,n):J.removeEvent(i,n,t.handle);vt.cache[r]&&delete vt.cache[r]}delete yt.cache[i[yt.expando]]}}}),J.fn.extend({text:function(e){return gt(this,function(e){return void 0===e?J.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=e)
})},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=f(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=f(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var i,n=e?J.filter(e,this):this,r=0;null!=(i=n[r]);r++)t||1!==i.nodeType||J.cleanData(v(i)),i.parentNode&&(t&&J.contains(i.ownerDocument,i)&&m(v(i,"script")),i.parentNode.removeChild(i));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(J.cleanData(v(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return J.clone(this,e,t)})},html:function(e){return gt(this,function(e){var t=this[0]||{},i=0,n=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Dt.test(e)&&!Ot[(Rt.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(kt,"<$1></$2>");try{for(;n>i;i++)t=this[i]||{},1===t.nodeType&&(J.cleanData(v(t,!1)),t.innerHTML=e);t=0}catch(r){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=arguments[0];return this.domManip(arguments,function(t){e=this.parentNode,J.cleanData(v(this)),e&&e.replaceChild(t,this)}),e&&(e.length||e.nodeType)?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t){e=H.apply([],e);var i,n,r,o,a,s,l=0,c=this.length,h=this,u=c-1,f=e[0],m=J.isFunction(f);if(m||c>1&&"string"==typeof f&&!$.checkClone&&Ft.test(f))return this.each(function(i){var n=h.eq(i);m&&(e[0]=f.call(this,i,n.html())),n.domManip(e,t)});if(c&&(i=J.buildFragment(e,this[0].ownerDocument,!1,this),n=i.firstChild,1===i.childNodes.length&&(i=n),n)){for(r=J.map(v(i,"script"),p),o=r.length;c>l;l++)a=i,l!==u&&(a=J.clone(a,!0,!0),o&&J.merge(r,v(a,"script"))),t.call(this[l],a,l);if(o)for(s=r[r.length-1].ownerDocument,J.map(r,d),l=0;o>l;l++)a=r[l],Gt.test(a.type||"")&&!vt.access(a,"globalEval")&&J.contains(s,a)&&(a.src?J._evalUrl&&J._evalUrl(a.src):J.globalEval(a.textContent.replace(Vt,"")))}return this}}),J.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){J.fn[e]=function(e){for(var i,n=[],r=J(e),o=r.length-1,a=0;o>=a;a++)i=a===o?this:this.clone(!0),J(r[a])[t](i),q.apply(n,i.get());return this.pushStack(n)}});var jt,It={},Ut=/^margin/,zt=new RegExp("^("+wt+")(?!px)[a-z%]+$","i"),Bt=function(e){return e.ownerDocument.defaultView.getComputedStyle(e,null)};!function(){function t(){a.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",a.innerHTML="",r.appendChild(o);var t=e.getComputedStyle(a,null);i="1%"!==t.top,n="4px"===t.width,r.removeChild(o)}var i,n,r=Q.documentElement,o=Q.createElement("div"),a=Q.createElement("div");a.style&&(a.style.backgroundClip="content-box",a.cloneNode(!0).style.backgroundClip="",$.clearCloneStyle="content-box"===a.style.backgroundClip,o.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute",o.appendChild(a),e.getComputedStyle&&J.extend($,{pixelPosition:function(){return t(),i},boxSizingReliable:function(){return null==n&&t(),n},reliableMarginRight:function(){var t,i=a.appendChild(Q.createElement("div"));return i.style.cssText=a.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",i.style.marginRight=i.style.width="0",a.style.width="1px",r.appendChild(o),t=!parseFloat(e.getComputedStyle(i,null).marginRight),r.removeChild(o),t}}))}(),J.swap=function(e,t,i,n){var r,o,a={};for(o in t)a[o]=e.style[o],e.style[o]=t[o];r=i.apply(e,n||[]);for(o in t)e.style[o]=a[o];return r};var Ht=/^(none|table(?!-c[ea]).+)/,qt=new RegExp("^("+wt+")(.*)$","i"),Wt=new RegExp("^([+-])=("+wt+")","i"),Xt={position:"absolute",visibility:"hidden",display:"block"},Yt={letterSpacing:"0",fontWeight:"400"},Kt=["Webkit","O","Moz","ms"];J.extend({cssHooks:{opacity:{get:function(e,t){if(t){var i=w(e,"opacity");return""===i?"1":i}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(e,t,i,n){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var r,o,a,s=J.camelCase(t),l=e.style;return t=J.cssProps[s]||(J.cssProps[s]=S(l,s)),a=J.cssHooks[t]||J.cssHooks[s],void 0===i?a&&"get"in a&&void 0!==(r=a.get(e,!1,n))?r:l[t]:(o=typeof i,"string"===o&&(r=Wt.exec(i))&&(i=(r[1]+1)*r[2]+parseFloat(J.css(e,t)),o="number"),null!=i&&i===i&&("number"!==o||J.cssNumber[s]||(i+="px"),$.clearCloneStyle||""!==i||0!==t.indexOf("background")||(l[t]="inherit"),a&&"set"in a&&void 0===(i=a.set(e,i,n))||(l[t]=i)),void 0)}},css:function(e,t,i,n){var r,o,a,s=J.camelCase(t);return t=J.cssProps[s]||(J.cssProps[s]=S(e.style,s)),a=J.cssHooks[t]||J.cssHooks[s],a&&"get"in a&&(r=a.get(e,!0,i)),void 0===r&&(r=w(e,t,n)),"normal"===r&&t in Yt&&(r=Yt[t]),""===i||i?(o=parseFloat(r),i===!0||J.isNumeric(o)?o||0:r):r}}),J.each(["height","width"],function(e,t){J.cssHooks[t]={get:function(e,i,n){return i?Ht.test(J.css(e,"display"))&&0===e.offsetWidth?J.swap(e,Xt,function(){return T(e,t,n)}):T(e,t,n):void 0},set:function(e,i,n){var r=n&&Bt(e);return M(e,i,n?C(e,t,n,"border-box"===J.css(e,"boxSizing",!1,r),r):0)}}}),J.cssHooks.marginRight=_($.reliableMarginRight,function(e,t){return t?J.swap(e,{display:"inline-block"},w,[e,"marginRight"]):void 0}),J.each({margin:"",padding:"",border:"Width"},function(e,t){J.cssHooks[e+t]={expand:function(i){for(var n=0,r={},o="string"==typeof i?i.split(" "):[i];4>n;n++)r[e+_t[n]+t]=o[n]||o[n-2]||o[0];return r}},Ut.test(e)||(J.cssHooks[e+t].set=M)}),J.fn.extend({css:function(e,t){return gt(this,function(e,t,i){var n,r,o={},a=0;if(J.isArray(t)){for(n=Bt(e),r=t.length;r>a;a++)o[t[a]]=J.css(e,t[a],!1,n);return o}return void 0!==i?J.style(e,t,i):J.css(e,t)},e,t,arguments.length>1)},show:function(){return A(this,!0)},hide:function(){return A(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){St(this)?J(this).show():J(this).hide()})}}),J.Tween=E,E.prototype={constructor:E,init:function(e,t,i,n,r,o){this.elem=e,this.prop=i,this.easing=r||"swing",this.options=t,this.start=this.now=this.cur(),this.end=n,this.unit=o||(J.cssNumber[i]?"":"px")},cur:function(){var e=E.propHooks[this.prop];return e&&e.get?e.get(this):E.propHooks._default.get(this)},run:function(e){var t,i=E.propHooks[this.prop];return this.pos=t=this.options.duration?J.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):E.propHooks._default.set(this),this}},E.prototype.init.prototype=E.prototype,E.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=J.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){J.fx.step[e.prop]?J.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[J.cssProps[e.prop]]||J.cssHooks[e.prop])?J.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},E.propHooks.scrollTop=E.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},J.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},J.fx=E.prototype.init,J.fx.step={};var $t,Qt,Zt=/^(?:toggle|show|hide)$/,Jt=new RegExp("^(?:([+-])=|)("+wt+")([a-z%]*)$","i"),ei=/queueHooks$/,ti=[L],ii={"*":[function(e,t){var i=this.createTween(e,t),n=i.cur(),r=Jt.exec(t),o=r&&r[3]||(J.cssNumber[e]?"":"px"),a=(J.cssNumber[e]||"px"!==o&&+n)&&Jt.exec(J.css(i.elem,e)),s=1,l=20;if(a&&a[3]!==o){o=o||a[3],r=r||[],a=+n||1;do s=s||".5",a/=s,J.style(i.elem,e,a+o);while(s!==(s=i.cur()/n)&&1!==s&&--l)}return r&&(a=i.start=+a||+n||0,i.unit=o,i.end=r[1]?a+(r[1]+1)*r[2]:+r[2]),i}]};J.Animation=J.extend(F,{tweener:function(e,t){J.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");for(var i,n=0,r=e.length;r>n;n++)i=e[n],ii[i]=ii[i]||[],ii[i].unshift(t)},prefilter:function(e,t){t?ti.unshift(e):ti.push(e)}}),J.speed=function(e,t,i){var n=e&&"object"==typeof e?J.extend({},e):{complete:i||!i&&t||J.isFunction(e)&&e,duration:e,easing:i&&t||t&&!J.isFunction(t)&&t};return n.duration=J.fx.off?0:"number"==typeof n.duration?n.duration:n.duration in J.fx.speeds?J.fx.speeds[n.duration]:J.fx.speeds._default,(null==n.queue||n.queue===!0)&&(n.queue="fx"),n.old=n.complete,n.complete=function(){J.isFunction(n.old)&&n.old.call(this),n.queue&&J.dequeue(this,n.queue)},n},J.fn.extend({fadeTo:function(e,t,i,n){return this.filter(St).css("opacity",0).show().end().animate({opacity:t},e,i,n)},animate:function(e,t,i,n){var r=J.isEmptyObject(e),o=J.speed(t,i,n),a=function(){var t=F(this,J.extend({},e),o);(r||vt.get(this,"finish"))&&t.stop(!0)};return a.finish=a,r||o.queue===!1?this.each(a):this.queue(o.queue,a)},stop:function(e,t,i){var n=function(e){var t=e.stop;delete e.stop,t(i)};return"string"!=typeof e&&(i=t,t=e,e=void 0),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,r=null!=e&&e+"queueHooks",o=J.timers,a=vt.get(this);if(r)a[r]&&a[r].stop&&n(a[r]);else for(r in a)a[r]&&a[r].stop&&ei.test(r)&&n(a[r]);for(r=o.length;r--;)o[r].elem!==this||null!=e&&o[r].queue!==e||(o[r].anim.stop(i),t=!1,o.splice(r,1));(t||!i)&&J.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,i=vt.get(this),n=i[e+"queue"],r=i[e+"queueHooks"],o=J.timers,a=n?n.length:0;for(i.finish=!0,J.queue(this,e,[]),r&&r.stop&&r.stop.call(this,!0),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;a>t;t++)n[t]&&n[t].finish&&n[t].finish.call(this);delete i.finish})}}),J.each(["toggle","show","hide"],function(e,t){var i=J.fn[t];J.fn[t]=function(e,n,r){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(k(t,!0),e,n,r)}}),J.each({slideDown:k("show"),slideUp:k("hide"),slideToggle:k("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){J.fn[e]=function(e,i,n){return this.animate(t,e,i,n)}}),J.timers=[],J.fx.tick=function(){var e,t=0,i=J.timers;for($t=J.now();t<i.length;t++)e=i[t],e()||i[t]!==e||i.splice(t--,1);i.length||J.fx.stop(),$t=void 0},J.fx.timer=function(e){J.timers.push(e),e()?J.fx.start():J.timers.pop()},J.fx.interval=13,J.fx.start=function(){Qt||(Qt=setInterval(J.fx.tick,J.fx.interval))},J.fx.stop=function(){clearInterval(Qt),Qt=null},J.fx.speeds={slow:600,fast:200,_default:400},J.fn.delay=function(e,t){return e=J.fx?J.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,i){var n=setTimeout(t,e);i.stop=function(){clearTimeout(n)}})},function(){var e=Q.createElement("input"),t=Q.createElement("select"),i=t.appendChild(Q.createElement("option"));e.type="checkbox",$.checkOn=""!==e.value,$.optSelected=i.selected,t.disabled=!0,$.optDisabled=!i.disabled,e=Q.createElement("input"),e.value="t",e.type="radio",$.radioValue="t"===e.value}();var ni,ri,oi=J.expr.attrHandle;J.fn.extend({attr:function(e,t){return gt(this,J.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){J.removeAttr(this,e)})}}),J.extend({attr:function(e,t,i){var n,r,o=e.nodeType;if(e&&3!==o&&8!==o&&2!==o)return typeof e.getAttribute===Ct?J.prop(e,t,i):(1===o&&J.isXMLDoc(e)||(t=t.toLowerCase(),n=J.attrHooks[t]||(J.expr.match.bool.test(t)?ri:ni)),void 0===i?n&&"get"in n&&null!==(r=n.get(e,t))?r:(r=J.find.attr(e,t),null==r?void 0:r):null!==i?n&&"set"in n&&void 0!==(r=n.set(e,i,t))?r:(e.setAttribute(t,i+""),i):void J.removeAttr(e,t))},removeAttr:function(e,t){var i,n,r=0,o=t&&t.match(pt);if(o&&1===e.nodeType)for(;i=o[r++];)n=J.propFix[i]||i,J.expr.match.bool.test(i)&&(e[n]=!1),e.removeAttribute(i)},attrHooks:{type:{set:function(e,t){if(!$.radioValue&&"radio"===t&&J.nodeName(e,"input")){var i=e.value;return e.setAttribute("type",t),i&&(e.value=i),t}}}}}),ri={set:function(e,t,i){return t===!1?J.removeAttr(e,i):e.setAttribute(i,i),i}},J.each(J.expr.match.bool.source.match(/\w+/g),function(e,t){var i=oi[t]||J.find.attr;oi[t]=function(e,t,n){var r,o;return n||(o=oi[t],oi[t]=r,r=null!=i(e,t,n)?t.toLowerCase():null,oi[t]=o),r}});var ai=/^(?:input|select|textarea|button)$/i;J.fn.extend({prop:function(e,t){return gt(this,J.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[J.propFix[e]||e]})}}),J.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(e,t,i){var n,r,o,a=e.nodeType;if(e&&3!==a&&8!==a&&2!==a)return o=1!==a||!J.isXMLDoc(e),o&&(t=J.propFix[t]||t,r=J.propHooks[t]),void 0!==i?r&&"set"in r&&void 0!==(n=r.set(e,i,t))?n:e[t]=i:r&&"get"in r&&null!==(n=r.get(e,t))?n:e[t]},propHooks:{tabIndex:{get:function(e){return e.hasAttribute("tabindex")||ai.test(e.nodeName)||e.href?e.tabIndex:-1}}}}),$.optSelected||(J.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null}}),J.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){J.propFix[this.toLowerCase()]=this});var si=/[\t\r\n\f]/g;J.fn.extend({addClass:function(e){var t,i,n,r,o,a,s="string"==typeof e&&e,l=0,c=this.length;if(J.isFunction(e))return this.each(function(t){J(this).addClass(e.call(this,t,this.className))});if(s)for(t=(e||"").match(pt)||[];c>l;l++)if(i=this[l],n=1===i.nodeType&&(i.className?(" "+i.className+" ").replace(si," "):" ")){for(o=0;r=t[o++];)n.indexOf(" "+r+" ")<0&&(n+=r+" ");a=J.trim(n),i.className!==a&&(i.className=a)}return this},removeClass:function(e){var t,i,n,r,o,a,s=0===arguments.length||"string"==typeof e&&e,l=0,c=this.length;if(J.isFunction(e))return this.each(function(t){J(this).removeClass(e.call(this,t,this.className))});if(s)for(t=(e||"").match(pt)||[];c>l;l++)if(i=this[l],n=1===i.nodeType&&(i.className?(" "+i.className+" ").replace(si," "):"")){for(o=0;r=t[o++];)for(;n.indexOf(" "+r+" ")>=0;)n=n.replace(" "+r+" "," ");a=e?J.trim(n):"",i.className!==a&&(i.className=a)}return this},toggleClass:function(e,t){var i=typeof e;return"boolean"==typeof t&&"string"===i?t?this.addClass(e):this.removeClass(e):this.each(J.isFunction(e)?function(i){J(this).toggleClass(e.call(this,i,this.className,t),t)}:function(){if("string"===i)for(var t,n=0,r=J(this),o=e.match(pt)||[];t=o[n++];)r.hasClass(t)?r.removeClass(t):r.addClass(t);else(i===Ct||"boolean"===i)&&(this.className&&vt.set(this,"__className__",this.className),this.className=this.className||e===!1?"":vt.get(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",i=0,n=this.length;n>i;i++)if(1===this[i].nodeType&&(" "+this[i].className+" ").replace(si," ").indexOf(t)>=0)return!0;return!1}});var li=/\r/g;J.fn.extend({val:function(e){var t,i,n,r=this[0];{if(arguments.length)return n=J.isFunction(e),this.each(function(i){var r;1===this.nodeType&&(r=n?e.call(this,i,J(this).val()):e,null==r?r="":"number"==typeof r?r+="":J.isArray(r)&&(r=J.map(r,function(e){return null==e?"":e+""})),t=J.valHooks[this.type]||J.valHooks[this.nodeName.toLowerCase()],t&&"set"in t&&void 0!==t.set(this,r,"value")||(this.value=r))});if(r)return t=J.valHooks[r.type]||J.valHooks[r.nodeName.toLowerCase()],t&&"get"in t&&void 0!==(i=t.get(r,"value"))?i:(i=r.value,"string"==typeof i?i.replace(li,""):null==i?"":i)}}}),J.extend({valHooks:{option:{get:function(e){var t=J.find.attr(e,"value");return null!=t?t:J.trim(J.text(e))}},select:{get:function(e){for(var t,i,n=e.options,r=e.selectedIndex,o="select-one"===e.type||0>r,a=o?null:[],s=o?r+1:n.length,l=0>r?s:o?r:0;s>l;l++)if(i=n[l],!(!i.selected&&l!==r||($.optDisabled?i.disabled:null!==i.getAttribute("disabled"))||i.parentNode.disabled&&J.nodeName(i.parentNode,"optgroup"))){if(t=J(i).val(),o)return t;a.push(t)}return a},set:function(e,t){for(var i,n,r=e.options,o=J.makeArray(t),a=r.length;a--;)n=r[a],(n.selected=J.inArray(n.value,o)>=0)&&(i=!0);return i||(e.selectedIndex=-1),o}}}}),J.each(["radio","checkbox"],function(){J.valHooks[this]={set:function(e,t){return J.isArray(t)?e.checked=J.inArray(J(e).val(),t)>=0:void 0}},$.checkOn||(J.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),J.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){J.fn[t]=function(e,i){return arguments.length>0?this.on(t,null,e,i):this.trigger(t)}}),J.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,i){return this.on(e,null,t,i)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,i,n){return this.on(t,e,i,n)},undelegate:function(e,t,i){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",i)}});var ci=J.now(),hi=/\?/;J.parseJSON=function(e){return JSON.parse(e+"")},J.parseXML=function(e){var t,i;if(!e||"string"!=typeof e)return null;try{i=new DOMParser,t=i.parseFromString(e,"text/xml")}catch(n){t=void 0}return(!t||t.getElementsByTagName("parsererror").length)&&J.error("Invalid XML: "+e),t};var ui,fi,pi=/#.*$/,di=/([?&])_=[^&]*/,mi=/^(.*?):[ \t]*([^\r\n]*)$/gm,gi=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,vi=/^(?:GET|HEAD)$/,yi=/^\/\//,bi=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,xi={},wi={},_i="*/".concat("*");try{fi=location.href}catch(Si){fi=Q.createElement("a"),fi.href="",fi=fi.href}ui=bi.exec(fi.toLowerCase())||[],J.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:fi,type:"GET",isLocal:gi.test(ui[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":_i,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":J.parseJSON,"text xml":J.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?V(V(e,J.ajaxSettings),t):V(J.ajaxSettings,e)},ajaxPrefilter:G(xi),ajaxTransport:G(wi),ajax:function(e,t){function i(e,t,i,a){var l,h,v,y,x,_=t;2!==b&&(b=2,s&&clearTimeout(s),n=void 0,o=a||"",w.readyState=e>0?4:0,l=e>=200&&300>e||304===e,i&&(y=O(u,w,i)),y=j(u,y,w,l),l?(u.ifModified&&(x=w.getResponseHeader("Last-Modified"),x&&(J.lastModified[r]=x),x=w.getResponseHeader("etag"),x&&(J.etag[r]=x)),204===e||"HEAD"===u.type?_="nocontent":304===e?_="notmodified":(_=y.state,h=y.data,v=y.error,l=!v)):(v=_,(e||!_)&&(_="error",0>e&&(e=0))),w.status=e,w.statusText=(t||_)+"",l?d.resolveWith(f,[h,_,w]):d.rejectWith(f,[w,_,v]),w.statusCode(g),g=void 0,c&&p.trigger(l?"ajaxSuccess":"ajaxError",[w,u,l?h:v]),m.fireWith(f,[w,_]),c&&(p.trigger("ajaxComplete",[w,u]),--J.active||J.event.trigger("ajaxStop")))}"object"==typeof e&&(t=e,e=void 0),t=t||{};var n,r,o,a,s,l,c,h,u=J.ajaxSetup({},t),f=u.context||u,p=u.context&&(f.nodeType||f.jquery)?J(f):J.event,d=J.Deferred(),m=J.Callbacks("once memory"),g=u.statusCode||{},v={},y={},b=0,x="canceled",w={readyState:0,getResponseHeader:function(e){var t;if(2===b){if(!a)for(a={};t=mi.exec(o);)a[t[1].toLowerCase()]=t[2];t=a[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===b?o:null},setRequestHeader:function(e,t){var i=e.toLowerCase();return b||(e=y[i]=y[i]||e,v[e]=t),this},overrideMimeType:function(e){return b||(u.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>b)for(t in e)g[t]=[g[t],e[t]];else w.always(e[w.status]);return this},abort:function(e){var t=e||x;return n&&n.abort(t),i(0,t),this}};if(d.promise(w).complete=m.add,w.success=w.done,w.error=w.fail,u.url=((e||u.url||fi)+"").replace(pi,"").replace(yi,ui[1]+"//"),u.type=t.method||t.type||u.method||u.type,u.dataTypes=J.trim(u.dataType||"*").toLowerCase().match(pt)||[""],null==u.crossDomain&&(l=bi.exec(u.url.toLowerCase()),u.crossDomain=!(!l||l[1]===ui[1]&&l[2]===ui[2]&&(l[3]||("http:"===l[1]?"80":"443"))===(ui[3]||("http:"===ui[1]?"80":"443")))),u.data&&u.processData&&"string"!=typeof u.data&&(u.data=J.param(u.data,u.traditional)),N(xi,u,t,w),2===b)return w;c=u.global,c&&0===J.active++&&J.event.trigger("ajaxStart"),u.type=u.type.toUpperCase(),u.hasContent=!vi.test(u.type),r=u.url,u.hasContent||(u.data&&(r=u.url+=(hi.test(r)?"&":"?")+u.data,delete u.data),u.cache===!1&&(u.url=di.test(r)?r.replace(di,"$1_="+ci++):r+(hi.test(r)?"&":"?")+"_="+ci++)),u.ifModified&&(J.lastModified[r]&&w.setRequestHeader("If-Modified-Since",J.lastModified[r]),J.etag[r]&&w.setRequestHeader("If-None-Match",J.etag[r])),(u.data&&u.hasContent&&u.contentType!==!1||t.contentType)&&w.setRequestHeader("Content-Type",u.contentType),w.setRequestHeader("Accept",u.dataTypes[0]&&u.accepts[u.dataTypes[0]]?u.accepts[u.dataTypes[0]]+("*"!==u.dataTypes[0]?", "+_i+"; q=0.01":""):u.accepts["*"]);for(h in u.headers)w.setRequestHeader(h,u.headers[h]);if(u.beforeSend&&(u.beforeSend.call(f,w,u)===!1||2===b))return w.abort();x="abort";for(h in{success:1,error:1,complete:1})w[h](u[h]);if(n=N(wi,u,t,w)){w.readyState=1,c&&p.trigger("ajaxSend",[w,u]),u.async&&u.timeout>0&&(s=setTimeout(function(){w.abort("timeout")},u.timeout));try{b=1,n.send(v,i)}catch(_){if(!(2>b))throw _;i(-1,_)}}else i(-1,"No Transport");return w},getJSON:function(e,t,i){return J.get(e,t,i,"json")},getScript:function(e,t){return J.get(e,void 0,t,"script")}}),J.each(["get","post"],function(e,t){J[t]=function(e,i,n,r){return J.isFunction(i)&&(r=r||n,n=i,i=void 0),J.ajax({url:e,type:t,dataType:r,data:i,success:n})}}),J.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){J.fn[t]=function(e){return this.on(t,e)}}),J._evalUrl=function(e){return J.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},J.fn.extend({wrapAll:function(e){var t;return J.isFunction(e)?this.each(function(t){J(this).wrapAll(e.call(this,t))}):(this[0]&&(t=J(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this)},wrapInner:function(e){return this.each(J.isFunction(e)?function(t){J(this).wrapInner(e.call(this,t))}:function(){var t=J(this),i=t.contents();i.length?i.wrapAll(e):t.append(e)})},wrap:function(e){var t=J.isFunction(e);return this.each(function(i){J(this).wrapAll(t?e.call(this,i):e)})},unwrap:function(){return this.parent().each(function(){J.nodeName(this,"body")||J(this).replaceWith(this.childNodes)}).end()}}),J.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0},J.expr.filters.visible=function(e){return!J.expr.filters.hidden(e)};var Mi=/%20/g,Ci=/\[\]$/,Ti=/\r?\n/g,Ai=/^(?:submit|button|image|reset|file)$/i,Ei=/^(?:input|select|textarea|keygen)/i;J.param=function(e,t){var i,n=[],r=function(e,t){t=J.isFunction(t)?t():null==t?"":t,n[n.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(void 0===t&&(t=J.ajaxSettings&&J.ajaxSettings.traditional),J.isArray(e)||e.jquery&&!J.isPlainObject(e))J.each(e,function(){r(this.name,this.value)});else for(i in e)I(i,e[i],t,r);return n.join("&").replace(Mi,"+")},J.fn.extend({serialize:function(){return J.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=J.prop(this,"elements");return e?J.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!J(this).is(":disabled")&&Ei.test(this.nodeName)&&!Ai.test(e)&&(this.checked||!Mt.test(e))}).map(function(e,t){var i=J(this).val();return null==i?null:J.isArray(i)?J.map(i,function(e){return{name:t.name,value:e.replace(Ti,"\r\n")}}):{name:t.name,value:i.replace(Ti,"\r\n")}}).get()}}),J.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(e){}};var Pi=0,ki={},Ri={0:200,1223:204},Li=J.ajaxSettings.xhr();e.ActiveXObject&&J(e).on("unload",function(){for(var e in ki)ki[e]()}),$.cors=!!Li&&"withCredentials"in Li,$.ajax=Li=!!Li,J.ajaxTransport(function(e){var t;return $.cors||Li&&!e.crossDomain?{send:function(i,n){var r,o=e.xhr(),a=++Pi;if(o.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(r in e.xhrFields)o[r]=e.xhrFields[r];e.mimeType&&o.overrideMimeType&&o.overrideMimeType(e.mimeType),e.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest");for(r in i)o.setRequestHeader(r,i[r]);t=function(e){return function(){t&&(delete ki[a],t=o.onload=o.onerror=null,"abort"===e?o.abort():"error"===e?n(o.status,o.statusText):n(Ri[o.status]||o.status,o.statusText,"string"==typeof o.responseText?{text:o.responseText}:void 0,o.getAllResponseHeaders()))}},o.onload=t(),o.onerror=t("error"),t=ki[a]=t("abort");try{o.send(e.hasContent&&e.data||null)}catch(s){if(t)throw s}},abort:function(){t&&t()}}:void 0}),J.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return J.globalEval(e),e}}}),J.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),J.ajaxTransport("script",function(e){if(e.crossDomain){var t,i;return{send:function(n,r){t=J("<script>").prop({async:!0,charset:e.scriptCharset,src:e.url}).on("load error",i=function(e){t.remove(),i=null,e&&r("error"===e.type?404:200,e.type)}),Q.head.appendChild(t[0])},abort:function(){i&&i()}}}});var Di=[],Fi=/(=)\?(?=&|$)|\?\?/;J.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Di.pop()||J.expando+"_"+ci++;return this[e]=!0,e}}),J.ajaxPrefilter("json jsonp",function(t,i,n){var r,o,a,s=t.jsonp!==!1&&(Fi.test(t.url)?"url":"string"==typeof t.data&&!(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&Fi.test(t.data)&&"data");return s||"jsonp"===t.dataTypes[0]?(r=t.jsonpCallback=J.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,s?t[s]=t[s].replace(Fi,"$1"+r):t.jsonp!==!1&&(t.url+=(hi.test(t.url)?"&":"?")+t.jsonp+"="+r),t.converters["script json"]=function(){return a||J.error(r+" was not called"),a[0]},t.dataTypes[0]="json",o=e[r],e[r]=function(){a=arguments},n.always(function(){e[r]=o,t[r]&&(t.jsonpCallback=i.jsonpCallback,Di.push(r)),a&&J.isFunction(o)&&o(a[0]),a=o=void 0}),"script"):void 0}),J.parseHTML=function(e,t,i){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(i=t,t=!1),t=t||Q;var n=at.exec(e),r=!i&&[];return n?[t.createElement(n[1])]:(n=J.buildFragment([e],t,r),r&&r.length&&J(r).remove(),J.merge([],n.childNodes))};var Gi=J.fn.load;J.fn.load=function(e,t,i){if("string"!=typeof e&&Gi)return Gi.apply(this,arguments);var n,r,o,a=this,s=e.indexOf(" ");return s>=0&&(n=J.trim(e.slice(s)),e=e.slice(0,s)),J.isFunction(t)?(i=t,t=void 0):t&&"object"==typeof t&&(r="POST"),a.length>0&&J.ajax({url:e,type:r,dataType:"html",data:t}).done(function(e){o=arguments,a.html(n?J("<div>").append(J.parseHTML(e)).find(n):e)}).complete(i&&function(e,t){a.each(i,o||[e.responseText,t,e])}),this},J.expr.filters.animated=function(e){return J.grep(J.timers,function(t){return e===t.elem}).length};var Ni=e.document.documentElement;J.offset={setOffset:function(e,t,i){var n,r,o,a,s,l,c,h=J.css(e,"position"),u=J(e),f={};"static"===h&&(e.style.position="relative"),s=u.offset(),o=J.css(e,"top"),l=J.css(e,"left"),c=("absolute"===h||"fixed"===h)&&(o+l).indexOf("auto")>-1,c?(n=u.position(),a=n.top,r=n.left):(a=parseFloat(o)||0,r=parseFloat(l)||0),J.isFunction(t)&&(t=t.call(e,i,s)),null!=t.top&&(f.top=t.top-s.top+a),null!=t.left&&(f.left=t.left-s.left+r),"using"in t?t.using.call(e,f):u.css(f)}},J.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){J.offset.setOffset(this,e,t)});var t,i,n=this[0],r={top:0,left:0},o=n&&n.ownerDocument;if(o)return t=o.documentElement,J.contains(t,n)?(typeof n.getBoundingClientRect!==Ct&&(r=n.getBoundingClientRect()),i=U(o),{top:r.top+i.pageYOffset-t.clientTop,left:r.left+i.pageXOffset-t.clientLeft}):r},position:function(){if(this[0]){var e,t,i=this[0],n={top:0,left:0};return"fixed"===J.css(i,"position")?t=i.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),J.nodeName(e[0],"html")||(n=e.offset()),n.top+=J.css(e[0],"borderTopWidth",!0),n.left+=J.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-J.css(i,"marginTop",!0),left:t.left-n.left-J.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||Ni;e&&!J.nodeName(e,"html")&&"static"===J.css(e,"position");)e=e.offsetParent;return e||Ni})}}),J.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,i){var n="pageYOffset"===i;J.fn[t]=function(r){return gt(this,function(t,r,o){var a=U(t);return void 0===o?a?a[i]:t[r]:void(a?a.scrollTo(n?e.pageXOffset:o,n?o:e.pageYOffset):t[r]=o)},t,r,arguments.length,null)}}),J.each(["top","left"],function(e,t){J.cssHooks[t]=_($.pixelPosition,function(e,i){return i?(i=w(e,t),zt.test(i)?J(e).position()[t]+"px":i):void 0})}),J.each({Height:"height",Width:"width"},function(e,t){J.each({padding:"inner"+e,content:t,"":"outer"+e},function(i,n){J.fn[n]=function(n,r){var o=arguments.length&&(i||"boolean"!=typeof n),a=i||(n===!0||r===!0?"margin":"border");return gt(this,function(t,i,n){var r;return J.isWindow(t)?t.document.documentElement["client"+e]:9===t.nodeType?(r=t.documentElement,Math.max(t.body["scroll"+e],r["scroll"+e],t.body["offset"+e],r["offset"+e],r["client"+e])):void 0===n?J.css(t,i,a):J.style(t,i,n,a)},t,o?n:void 0,o,null)}})}),J.fn.size=function(){return this.length},J.fn.andSelf=J.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return J});var Vi=e.jQuery,Oi=e.$;return J.noConflict=function(t){return e.$===J&&(e.$=Oi),t&&e.jQuery===J&&(e.jQuery=Vi),J},typeof t===Ct&&(e.jQuery=e.$=J),J})},{}],59:[function(e,t){t.exports=function(e){var t=e.Interface,i={hasPageButtons:!1,layout:{bounds:[0,0,1,1],widget:null,sacrosanct:!1,parent:null,id:0,children:[]},getBestChildForNewWidget:function(e){function t(e){if(0===e.children.length)null===e.widget?e.bounds[2]+e.bounds[3]>i&&(n=e,i=e.bounds[2]+e.bounds[3]):(e.bounds[2]+e.bounds[3])/2>i&&(n=e,i=(e.bounds[2]+e.bounds[3])/2);else for(var r=0;r<e.children.length;r++){var o=e.children[r];t(o,i)}}var i=0;e=0;var n=this.layout;return t(n),n},placeWidget:function(e,t){null===e&&console.log("ALERT ALERT ALERT ALERT ALERT ALERT ALERT ALERT ALERT ALERT ALERT ALERT");var i=null;if(i=this.getBestChildForNewWidget(0),null===i.widget)i.widget=e,e.bounds=i.bounds,e.div=i;else{var n,r,o=i.widget,a=i.bounds[2]>i.bounds[3]?0:1;n=0==a?i.bounds[2]/2:i.bounds[2],r=1==a?i.bounds[3]/2:i.bounds[3];var s={bounds:[i.bounds[0],i.bounds[1],n,r],widget:o,sacrosanct:!1,parent:i,children:[]},l=0==a?i.bounds[0]+n:i.bounds[0],c=1==a?i.bounds[1]+r:i.bounds[1],h={bounds:[l,c,n,r],widget:e,sacrosanct:t,parent:i,children:[]};s.widget.div=s,s.widget.bounds=s.bounds,h.widget.bounds=h.bounds,h.widget.div=h,i.children.push(s),i.children.push(h),i.widget=null}},removeWidget:function(e){e.div.widget=null;var t=e.div.parent;if(null!==t){var i=jQuery.inArray(e.div,t.children),n=1===i?0:1;null===t.children[n].widget&&(t.children=[],t.widget=null)}else e.div.children=[];this.redoLayout()},reset:function(){this.layout={bounds:[0,0,1,1],widget:null,sacrosanct:!1,parent:null,id:0,children:[]}},redoLayout:function(){this.layout={bounds:[0,0,1,1],widget:null,sacrosanct:!1,parent:null,id:0,children:[]};for(var e=0;e<t.panel.children.length;e++){var i=t.panel.children[e];
i.useAutogui&&this.placeWidget(i)}}};return i}},{}],60:[function(e,t){t.exports=function(t){var i=t.dollar,n=e("./mouse.js"),r={value:{min:0,max:1,output:t.LINEAR,wrap:!1,timescale:"interface"}},o=0,a=e("interface.js"),s={autogui:e("./autogui")(t),mode:"local",client:0,panel:null,socket:null,callbacks:{},newPanel:function(e){"undefined"==typeof e?e=t.isInstrument?{bodyElement:document.querySelector("body")}:Layout.addColumn():e.bodyElement.innerHTML="",e.bodyElement.length&&(e.bodyElement=e.bodyElement[0]);var n=new a.Panel({container:e.bodyElement,useRelativeSizesAndPositions:!0,font:"normal 16px Helvetica"});return n.canvas.style.position="relative",n.canvas.style.width=e.bodyElement.style.width,n.canvas.style.height=e.bodyElement.style.height,this.panel=n,this.panel.column=e,e.onresize=this.onresize.bind(n),s.autogui.reset(),e.onclose=function(){s.panel=null},i.subscribe("/gibber/clear",function(){e.close()}),n},onresize:function(){i(this.canvas).css({position:"relative",width:i(this.column.bodyElement).width(),height:i(this.column.bodyElement).height()}),this.redoBoundaries()},initializers:{Accelerometer:function(e){var i={x:{min:0,max:1,output:t.LINEAR,wrap:!1,timescale:"interface"},y:{min:0,max:1,output:t.LINEAR,wrap:!1,timescale:"interface"},z:{min:0,max:1,output:t.LINEAR,wrap:!1,timescale:"interface"}};return delete e.x,delete e.y,delete e.z,t.createProxyProperties(e,i,!1),e.onvaluechange=function(t,i,n){console.log(t,i,n),e.x(t),e.y(i),e.z(n)},e.start(),e},Orientation:function(e){var i={x:{min:0,max:1,output:t.LINEAR,wrap:!1,timescale:"interface"},y:{min:0,max:1,output:t.LINEAR,wrap:!1,timescale:"interface"},z:{min:0,max:1,output:t.LINEAR,wrap:!1,timescale:"interface"}};return delete e.x,delete e.y,delete e.z,t.createProxyProperties(e,i,!1),e.onvaluechange=function(t,i,n){e.x(t),e.y(i),e.z(n)},e.start(),e},XY:function(e){for(var i={x:{min:0,max:1,output:t.LINEAR,wrap:!1,timescale:"interface"},y:{min:0,max:1,output:t.LINEAR,wrap:!1,timescale:"interface"}},n=0;n<e.values.length;n++)!function(){var r=n,o=e.values[r],a=0,s=0;Object.defineProperties(o,{x:{configurable:!0,get:function(){return a},set:function(e){a=e}},y:{configurable:!0,get:function(){return s},set:function(e){s=e}}}),t.createProxyProperties(o,i,!1),e[r]=o}()},HBox:function(e){for(var t=0;t<e.children.length;t++)!function(){var i=e.children[t];i.kill(),i.panel=e.proxyPanel,Object.defineProperty(e,t,{configurable:!0,get:function(){return i},set:function(){}})}();var i=e.add;e.add=function(){var t=Array.prototype.slice.call(arguments,0);t=t.map(function(e){return e.kill()});for(var n=e.children.length,r=0;r<t.length;r++)!function(){var i=t[r];Object.defineProperty(e,n++,{configurable:!0,get:function(){return i},set:function(){}})}();return i.apply(e,t)},e.layout(),e.draw()},VBox:function(e){for(var t=0;t<e.children.length;t++)!function(){var i=e.children[t];i.kill(),i.panel=e.proxyPanel,Object.defineProperty(e,t,{configurable:!0,get:function(){return i},set:function(){}})}();var i=e.add;e.add=function(){var t=Array.prototype.slice.call(arguments,0);return t=t.map(function(e){return e.kill()}),i.apply(e,t)},e.layout(),e.draw()},MultiSlider:function(e){var i={value:{min:0,max:1,output:t.LINEAR,wrap:!1,timescale:"interface"}};e.children=[];for(var n=0;n<e.count;n++)!function(){var r=n,o={},a=e.values[n];Object.defineProperties(o,{value:{configurable:!0,get:function(){return a},set:function(e){a=e}}}),t.createProxyProperties(o,i,!1),e[r]=o,e.children.push(o),o.valueOf=function(){return this.value()},o.index=r}();e.length=e.count,e.onvaluechange=function(t,i){e[t].value=i}},Patchbay:function(e){e.onconnection=function(e,t){t.object[t.name]=e.object[e.Name]},e.ondisconnection=function(e,t){t.object[t.Name].mapping.remove()},e._createConnection=e.createConnection,e.createConnection=function(t){var i=(this.points[t[0]],this.points[t[1]]);return"Out"===i.Name?void console.log("You can't feed input to an Out patch point"):void e._createConnection(t)}},Paint:function(e){var i={x:{min:0,max:1,output:t.LINEAR,wrap:!1,timescale:"interface"},y:{min:0,max:1,output:t.LINEAR,wrap:!1,timescale:"interface"}},n=e.value,r=0,o=0;Object.defineProperties(n,{x:{get:function(){return r},set:function(e){r=e}},y:{get:function(){return o},set:function(e){o=e}}}),t.createProxyProperties(n,i,!1)},Piano:function(e){var t=e.target;Object.defineProperty(e,"target",{get:function(){return t},set:function(i){t=i;for(var n=0;n<e.children.length;n++)e.children[n].target=t,e.children[n].key="undefined"!=typeof t.note?"note":"frequency",e.children[n].sendTargetMessage=function(){this.target&&this.target.note&&this.target.note(this.frequency,this.value)}}}),e.onboundschange=function(){this._initialized&&this.placeKeys(),this.target=this.target}}},defaults:{XY:{childWidth:40,fill:"rgba(255,255,255,.1)",stroke:"#aaa",numChildren:2,usePhysics:!1},Piano:{startletter:"C",startoctave:3,endletter:"C",endoctave:4,background:"white",fill:"black"}},nonGraphical:["Accelerometer","Orientation"],widget:function(e,n){var l=-1!==s.nonGraphical.indexOf(n);if("local"===this.mode){null!==s.panel||l||s.newPanel(),"undefined"==typeof e&&(e={mode:"toggle"}),s.defaults[n]&&(e=i.extend(s.defaults[n],e));var c=new a[n](e);if(c.type="mapping","undefined"==typeof c.bounds[0]&&(l||(s.autogui.placeWidget(c,!1),c.useAutogui=!0)),l||t.Interface.panel.add(c),s.initializers[n])s.initializers[n](c,e);else{var h="value",u=r[h],f=i.extend({},u,{Name:h.charAt(0).toUpperCase()+h.slice(1),propertyName:h,type:"mapping",value:1,object:c,targets:[]});Object.defineProperty(f.object,f.Name,{get:function(){return f},set:function(e){"object"==typeof e&&"mapping"===e.type&&t.createMappingObject(f,e)}}),c.mappingObjects=[f],c.mappingProperties=r,c.replaceWith=function(e){c.target&&(e.target=c.target),c.key&&(e.key=c.key),s.panel.remove(c),s.panel.add(e),e.setValue(c.value);for(var t=0;t<this.mappingObjects.length;t++){var i=this.mappingObjects[t];if(i.targets.length>0)for(var n=0;n<i.targets.length;n++){var r=i.targets[n];e.mappingProperties[i.propertyName]?r[0].mapping.replace(e,i.propertyName,i.Name):r[0].mapping.remove()}}}}return"number"==typeof c.value&&(c.valueOf=function(){return c.value}),c.mappings=[],c.kill=c.remove=function(){for(var e=0;e<c.mappings.length;e++)c.mappings[e].remove();return c.clearMarks&&c.clearMarks(),l||(c.useAutogui?(s.autogui.removeWidget(c),c.panel.remove(c)):c.panel.remove(c)),c},Object.defineProperty(c,"_",{get:function(){return c.kill()},set:function(){}}),c}e=e||{};var c={value:0,type:"mapping",min:0,max:1,client:this.client,remoteID:"/"+(e.name||o++),mappings:[],setValue:function(e){this.value=e;var t={address:"/clients/"+this.client+this.remoteID,parameters:[e]};s.socket.send(JSON.stringify(t))},kill:function(){var e={address:"/clients/"+this.client+"/interface/removeWidget",parameters:[c.remoteID]};s.socket.send(JSON.stringify(e));for(var t=0;t<c.mappings.length;t++)c.mappings[t].remove();c.clearMarks&&c.clearMarks(),c.useAutogui&&s.autogui.removeWidget(c)},replaceWith:function(){this.kill()}};Object.defineProperty(c,"_",{get:function(){c.kill()},set:function(){}});var h="value",u=r[h],f=i.extend({},u);i.extend(f,{Name:h.charAt(0).toUpperCase()+h.slice(1),propertyName:h,type:"mapping",value:1,object:c,targets:[]}),Object.defineProperty(f.object,f.Name,{get:function(){return f},set:function(e){"object"==typeof e&&"mapping"===e.type&&t.createMappingObject(f,e)}});var p="";Object.defineProperty(c,"label",{get:function(){return p},set:function(e){p=e;var t={address:"/clients/"+this.client+"/interface/setLabel",parameters:[c.remoteID,p]};s.socket.send(JSON.stringify(t))}}),c.mappingObjects=[f],c.mappingProperties=r,this.callbacks[c.remoteID]=function(e){c.value=e.parameters[0],c.onvaluechange&&c.onvaluechange()};var d={address:"/clients/"+this.client+"/interface/addWidget",parameters:[{type:n,target:"OSC",key:c.remoteID,name:c.remoteID}]};return this.socket.send(JSON.stringify(d)),c},use:function(e,i){if("remote"===e){if(null===s.socket||3===s.socket.readyState){var n=JSON.stringify({address:"/createLivecodeServer",parameters:[]}),r=s.socket=new WebSocket("ws://127.0.0.1:10001");s.socket.onopen=function(){r.send(n)},s.socket.onmessage=function(e){var t;try{t=JSON.parse(e.data)}catch(i){return void console.error("ERROR on parsing JSON",i)}s.callbacks[t.address]&&s.callbacks[t.address](t)},window.OSC=t.Interface.socket,window.OSC.callbacks=t.Interface.callbacks}s.mode="remote",s.client=i}else s.mode="local"},clear:function(e){var t=isNaN(e)?s.client:e;if("*"===e&&(t="*"),"remote"===s.mode){var i={address:"/clients/"+t+"/interface/clear",parameters:[]};s.socket.send(JSON.stringify(i))}},button:function(e){return s.widget(e,"Button")},slider:function(e){return s.widget(e,"Slider")},multislider:function(e){return s.widget(e,"MultiSlider")},knob:function(e){return s.widget(e,"Knob")},xy:function(e){return s.widget(e,"XY")},piano:function(e){return s.widget(e,"Piano")},paint:function(e){return s.widget(e,"Paint")},patchbay:function(e){return s.widget(e,"Patchbay")},crossfader:function(e){return s.widget(e,"Crossfader")},accelerometer:function(e){return s.widget(e,"Accelerometer")},orientation:function(e){return s.widget(e,"Orientation")},patchbay:function(e){if(arguments.length>1||e.name){var t={points:Array.prototype.slice.call(arguments,0)};e=t}return s.widget(e,"Patchbay")},hbox:function(e){if(arguments.length>1||e.name){var t={children:Array.prototype.slice.call(arguments,0)};e=t}return s.widget(e,"HBox")},vbox:function(e){if(arguments.length>1||e.name){var t={children:Array.prototype.slice.call(arguments,0)};e=t}return s.widget(e,"VBox")},"export":function(e){e.Button=s.button,e.Slider=s.slider,e.MultiSlider=s.multislider,e.Knob=s.knob,e.XY=s.xy,e.Keyboard=s.piano,e.Paint=s.paint,e.Panel=s.newPanel.bind(s),e.Patchbay=s.patchbay,e.HBox=s.hbox,e.VBox=s.vbox,e.Crossfader=s.crossfader,e.Accelerometer=s.accelerometer,e.Orientation=s.orientation,e.Mouse=n(t)}};return s.use=a.use,s.clear=a.clear,s}},{"./autogui":59,"./mouse.js":61,"interface.js":57}],61:[function(e,t){t.exports=function(e){"use strict";var t=null,i=e.dollar,n=0,r={x:{min:0,max:1,timescale:"interface",output:e.LINEAR},y:{min:0,max:1,timescale:"interface",output:e.LINEAR},shiftX:{min:0,max:1,timescale:"interface",output:e.LINEAR},shiftY:{min:0,max:1,timescale:"interface",output:e.LINEAR},ctrlX:{min:0,max:1,timescale:"interface",output:e.LINEAR},ctrlY:{min:0,max:1,timescale:"interface",output:e.LINEAR},button:{min:0,max:1,timescale:"interface",output:e.LINEAR}};if(null!==t)return t;t={};var o=0,a=0;if(i.extend(t,{x:0,y:0,prevX:0,prevY:0,shiftX:0,shiftY:0,prevShiftX:0,prevShiftY:0,button:0,isOn:!1,name:"Mouse",_onmousemove:function(i){var r="",s="";i.shiftKey&&(r="shift"),i.ctrlKey&&(r="ctrl"),s=""===r?"":r.charAt(0).toUpperCase()+r.slice(1),t["prev"+s+"X"]=o,t["prev"+s+"Y"]=a,o=t[r+(""===r?"x":"X")]=i.pageX-window.scrollX,a=t[r+(""===r?"y":"Y")]=i.pageY-window.scrollY,e.Environment&&(a-=n,t[r+(""===r?"y":"Y")]-=n),"function"==typeof t.onvaluechange&&t.onvaluechange()},_onmousedown:function(){t.button=1,"function"==typeof t.onvaluechange&&t.onvaluechange()},_onmouseup:function(){t.button=0,"function"==typeof t.onvaluechange&&t.onvaluechange()},on:function(){if(!t.isOn){if(t.isOn=!0,e.Environment){if(t.X.max=t.ww=i(window).width(),e.Environment.Layout.isFullScreen)t.Y.max=t.wh=i(window).height();else{var r=i(window).height()-i("thead").height()-i("tfoot").height();t.Y.max=t.wh=r}n=i("thead").height()}else t.X.max=window.innerWidth,t.Y.max=window.innerHeight;window.onmousemove=t._onmousemove}},off:function(){t.isOn&&(i(window).off("mousemove",t._onmousemove),t.isOn=!1)},toggle:function(){t.isOn?t.off():t.on()}}),e.Environment)if(e.Environment.Layout.isFullScreen)r.x.max=i(window).width(),r.y.max=i(window).height();else{var s=i(window).height()-i("thead").height()-i("tfoot").height();r.x.max=i(window).width(),r.y.max=s}else r.x.max=window.innerWidth,r.y.max=window.innerHeight;for(var l in r)!function(){var e=l.charAt(0).toUpperCase()+l.slice(1),i=t[l];Object.defineProperty(t,e,{configurable:!0,get:function(){return"Button"!==e&&t.on(),i},set:function(e){return i=e,t}})}();return i.subscribe("/layout/contentResize",function(e){t.ww=t.X.max=e.w,t.wh=t.Y.max=e.h}),window.onmousedown=t._onmousedown,window.onmouseup=t._onmouseup,e.createProxyProperties(t,r,!0),t}},{}],62:[function(e,t){!function(){var i=e("gibber.core.lib");i.Audio=e("gibber.audio.lib")(i),i.Graphics=e("gibber.graphics.lib")(i),i.Interface=e("gibber.interface.lib")(i),i.Communication=e("gibber.communication.lib")(i),t.exports=i}()},{"gibber.audio.lib":4,"gibber.communication.lib":22,"gibber.core.lib":25,"gibber.graphics.lib":53,"gibber.interface.lib":60}]},{},[62])(62)});